<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <title>DHT Protocol</title>
  </head>
  <body>
    <sub style="margin: 1em 0px 0.1em; font-weight: normal; letter-spacing: -1px;">
      Переклад українською - <a href="mailto:ac2epsilon@gmail.com">Арсеній
        Чеботарьов</a> - Ніжин 2017</sub><br>
    <p> </p>
    <div id="header" style="margin: 0px; width: 700px; border-bottom: 2px solid rgb(238, 238, 238); color: rgb(51, 51, 51); font-family: &quot;Trebuchet MS&quot;, sans-serif; font-size: 10px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">
      <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;"><a
          href="http://www.bittorrent.org/index.html" style="color: rgb(102, 102, 102); text-decoration: none; border: 0px;">BitTorrent<span
            style="font-weight: bold; color: rgb(0, 153, 255);">.org <br>
          </span></a></h1>
      <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;"><a
          href="http://www.bittorrent.org/index.html" style="color: rgb(102, 102, 102); text-decoration: none; border: 0px;"><span
            style="font-weight: bold; color: rgb(0, 153, 255);">BEP5: DHT
            Protocol<br>
          </span></a></h1>
    </div>
    <div id="second" style="color: rgb(51, 51, 51); font-family: &quot;Trebuchet MS&quot;, sans-serif; font-size: 10px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-style: initial; text-decoration-color: initial;">
      <table class="docinfo" frame="void" rules="none" style="border: 0px; margin-left: 4em;">
        <colgroup><col class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;"><col
            class="docinfo-content"></colgroup>
        <tbody valign="top">
          <tr class="bep field">
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">BEP:</th>
            <td class="field-body" style="font-size: 9pt; padding: 10px;">5</td>
          </tr>
          <tr class="title field">
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">Заголовок:</th>
            <td class="field-body" style="font-size: 9pt; padding: 10px;">DHT
              протокол</td>
          </tr>
          <tr>
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">Версія:</th>
            <td style="font-size: 9pt; padding: 10px;">369b2bc90d29397f18f6a51ce517f65780cc0b13</td>
          </tr>
          <tr class="last-modified field">
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">Останні
              зміни:</th>
            <td class="field-body" style="font-size: 9pt; padding: 10px;">Mon
              May 1 15:42:08 2017 -0700</td>
          </tr>
          <tr>
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">Автор:</th>
            <td style="font-size: 9pt; padding: 10px;">Andrew Loewenstern &lt;<a
                class="reference external" href="mailto:drue%40bittorrent.com" style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">drue<span>@</span>bittorrent<span>.</span>com</a>&gt;,
              Arvid Norberg &lt;<a class="reference external" href="mailto:arvid%40bittorrent.com"
                style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">arvid<span>@</span>bittorrent<span>.</span>com</a>&gt;</td>
          </tr>
          <tr>
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">Статус:</th>
            <td style="font-size: 9pt; padding: 10px;">Прийнято</td>
          </tr>
          <tr class="type field">
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">Тип:</th>
            <td class="field-body" style="font-size: 9pt; padding: 10px;">Стандартний
              шлях</td>
          </tr>
          <tr class="created field">
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">Створений:</th>
            <td class="field-body" style="font-size: 9pt; padding: 10px;">31-Jan-2008</td>
          </tr>
          <tr class="post-history field">
            <th class="docinfo-name" style="margin: 0px; font-size: 1.2em; text-align: right; vertical-align: middle;">Історія:</th>
            <td class="field-body" style="font-size: 9pt; padding: 10px;">22-March-2013:
              Додане "implied_port" до повідомлення announce_peer, щоб покращити
              підтримку NAT</td>
          </tr>
        </tbody>
      </table>
      <p style="font-size: 1.3em; line-height: 1.5em;">BitTorrent використовує
        "розполілену рідку хеш таблицю" (DHT) для зберігання контактної
        інформації про вузли для "безтрекерних" торентів. Фактично, кожний вузол
        стає трекером. Протокол базується на Kademila<span>&nbsp;</span><a class="footnote-reference"
          href="http://www.bittorrent.org/beps/bep_0005.html#kademlia" id="id1"
          style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">[1]</a><span>
          та реалізований зверху</span> UDP.</p>
      <p style="font-size: 1.3em; line-height: 1.5em;">Будь ласка занотуйте
        термінологію, що використовується в цьому докуенті, щоб уникнути
        непорозумінь. Сторона ("peer") є клієнт-сервер, що слухає на TCP порту,
        та реалізує протокол BitTorrent. Вузол ("node") є клієнт-сервер, що
        слухає на UDP порту, та реалізує протокол розподіленої хеш таблиці. DHT
        складаєься з вузлів, та зберігає розміщення вузлів. Клієнти BitTorrent
        включають вузли DHT, що використовуєтся для зв'язку з іншими вузлами в
        DHT, щоб отримати розміщення вузлів для завантаження з них по протоколу
        BitTorrent.</p>
      <div class="section" id="overview">
        <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;">Огляд</h1>
        <p style="font-size: 1.3em; line-height: 1.5em;">Кожинй вузол має
          глобально унікальний ідентифікатор, відомий як ідентифікатор вузла
          "node ID." ID вузлів обираються довільно, з того ж 160-бітного
          простору, що і інфо-хеші BitTorrent<span> </span><a class="footnote-reference"
            href="http://www.bittorrent.org/beps/bep_0005.html#entropy" id="id2"
            style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">[2]</a>.
          Для порівняння двох ID вузлів, або між вузлом та інфо-хешем на
          "близкість" використовується "дистанційна метрика". Вузли повинні
          підтримувати таблицю маршрутизації, що містить контактну інформацію
          для обмеженої кількості інших вузлів. Таблиця маршрутизації стає більш
          детальною, по мірі того, як ID стають ближчими до власного ID вузла.
          Вузли знають про багато інних вузлів в DHT, що мають ID, які "близькі"
          до їх власних, але мають тільки декілька контактів з ID, що дуже
          далекі від них згудно метрики.</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">В Kademlia метрика
          відстані є XOR, та результат інтерпретується як ціле без знака.<span>&nbsp;</span><tt
            class="docutils literal">distance(A,B) = |A xor B|</tt><span> Меньші
            значення ближчі.&nbsp;</span></p>
        <p style="font-size: 1.3em; line-height: 1.5em;">Коли вузол бажає знайти
          вузли в торенті, він використовує метрику дистанції для порівняння
          інфо-хешу торента з ID вузлів у власній таблиці маршрутизації. Потім
          він зв'язується з вузлами, що знають про ID, найближчі до інфо-хешу,
          та запитують їх щодо контактної інформації про сторони, що наразі
          завантажують торент. Якщо контектний вузол знає щодо ціх сторін для
          даного торента, контактна інформація про сторону повертається в якості
          відповіді. Інакше, вузол, я яким зв'язались, мусить відповісти списком
          з контактної інформації про вузли з власної таблиці маршрутизації, що
          ще ближчі до інфо-хешу торента. Оригінальний вузол циклічно опитує
          вузли, що ближчі до цільового інфо-хешу, доки не знайде любі близькі
          вузли. Після того, як пошук вичерпано, клієнт вставляє контактну
          інформацію сторони для себе в відповідаючі вузли з ID, найближчих до
          інфо-хешу торента.</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">Повернуте значення для
          запиту сторін включає прозоре значення, відоме як "токен". Для того,
          що вузол анонсував, що його контролююча сторона завантажує торент, він
          має презентувати токен, отриманий від від того ж опитаного вузла, в
          останній запит щодо сторін. Коли вузол намагається "анонсувати"
          торент, опитаний вузол перевіряє токен на IP адресу запитуючого вузла.
          Це не дає зловмисним вузлам від підписування інших вузлів на торенти.
          Оскільки токен просто повертається запитуючим вузлом до того самого
          вузла, з якого він отримав токен, реалізація не визначена. Токени
          мають сприйматись на протязі розумного відтинку часу, після того, ак
          вони були видані. Реалізація BitTorrent використовує хеш SHA1 від IP
          адреси, конкатенований з секретом, що змінюється кожні п'ять хвилин,
          та сприймаються токени віком до десяти хвилин.&nbsp;</p>
      </div>
      <div class="section" id="routing-table">
        <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;">Таблиця
          маршрутизації</h1>
        <p style="font-size: 1.3em; line-height: 1.5em;">Кожний вузол підтримує
          таблицю маршрутизації для відомих гарних вузлів. Вузли в таблиці
          маршрутизації використовуються як початкові точки для запитів до DHT.
          Вузли з таблиці маршрутизації повертаються у відповідь до запитів з
          інших вузлів.&nbsp;</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">Не всі вузли, які нам
          відомі, є однакові. Деякі "гарні", але інші ні. Багато вузлів, що
          використовують DHT, в змозі надсилати запити та отримувати відповіді,
          але не в змозі відповідати на запити від інших вузлів. Важливо, щоб
          таблиця маршрутизації кожного вузла містила тільки відомі гарні вузли.
          Гарний вузол є такий, що відповідає на один з наших запитів
          щонайбільше протягом останніх 15 хвилин. Вузол також гарний, якщо він
          відповідав на один з наших запитів, та надсилав нам запити
          щонайбільше&nbsp; за останні 15 хвилин. Після 15 хвилин неактивності
          вузол стає під питанням. Вузли стають поганими, коли вони схибили
          відповідсти на декілька запитів поспіль. Вузли, що відомі як гарні,
          мають преоритет над вузлами з невідомим статусом.&nbsp;</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">Таблиця маршрутизації
          покриває весь простір ID вузлів, від 0 до 2<sup>160</sup>. Таблиця
          маршрутизації поділена на "кошики", кожний з яких покриває частину
          простору. Пуста таблиця має один кошик, з диапазоном у просторі ID від
          min=0, до max=2<sup>160</sup>. Коли вузол з ID "N" вставляєтсья в
          таблицю, він надходить в кошик з min &lt;= N &lt; max. Порожня таблиця
          має тільки один кошик, так що вузол розміщується в ньому. Кожний кошик
          може містити тільки K вузлів, наразі вісім, до того, як стати
          "повним". Коли кошик заповнюється відомо гарними вузлами, до нього не
          можуть додаватись інші вузли, за винятком коли ваш власний ID підпадає
          до диапазону кошика. В цьому випадку кошик замінюється на два нові
          кошика, кожний з половини старого кошика, та ці вузли зі сторого
          кошика розподіляються на два нових. Для нової таблиці тільки з одного
          кошика повний кошик завжди поділяється на два нових, що покривають
          диапазони 0..2<sup>159</sup><span> та</span> 2<sup>159</sup>..2<sup>160</sup>.</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">Коли кошик повний
          гарних вузлів, новий вузол просто відкидаються. Якщо про деякі вузли в
          корзині відомо, що вони стали погані, тоді вони замінюються один по
          одному на нові вузли. Якщо є деякі вузли в корзині під питанням, що не
          були на зв'язку більше 15 хвилин, тоді вони починають пінгуватись
          починаючи з найпізніше бачених. Якщо пінгований вузол відповідає, тоді
          пінгується наступний останній бачений вузол, доки якійсь з вузлів не
          схибить, або доки всі вузли в корзині не будуть відомі як гарні. Якщо
          вузол в корзині не відповідає на пінг, рекомендовано спробувати ще раз
          перед відкидання вузла, та його заміни на новий вузол. Таким чином,
          таблиця заповнюється стабільними, довго працюючими вузлами.</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">Кожний кошик повинний
          підтримувати властивість "останній змінений", що вказуватиме,
          наскільки "свіжим" є вміст. Коли вузол в кошику пінгується, а той
          відповідає, або коли вузол додадється до кошика, або коли вузол в
          кошику замінюється іншим, властивість останньої зміни для кошика має
          бути оновлений. Кошики, що не були оновлені 15 хвилин, повинні бути
          "оновлені". Це робиться через обрання випадкового ID в диапазоні, та
          виконання для нього пошуку find_nodes. Вузли, що здатні отримувати
          запити від інших вузлів, зазвичай не потребують частого оновлення
          кошика. Вузли, що не здатні отримувати запити від інших вузлів,
          звичайно будуть потребувати переодичного оновлення вузлів, щоб
          переконатись, що в таблиці гарні вузли, коли знадобиться DHT.</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">При вставці першого
          вузла в таблицю маршрутизації, та починає після цього роботу, вузол
          повинен спробувати знайти найближчі до себе вузли в DHT. Він робить це
          через надсилання повідомлень find_node до ближчого та ще ближчого
          вузлів, доки він не зможе знайти ще ближчий. Таблиця маршрутизації
          повинна зберігатись між викликами клієнтського застосунку.</p>
      </div>
      <div class="section" id="bittorrent-protocol-extension">
        <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;">Розширення
          протокола BitTorrent</h1>
        <p style="font-size: 1.3em; line-height: 1.5em;">Протокол BitTorrent був
          розширений для обміну номерами портів UDP між вузлами, що вводяться
          для трекеру. Таким чином, клієнти можуть отримати власні таблиці
          маршрутизації, засіяні автоматично, через завантаження звичайних
          торентів. Тільки но інстальовані клієнти, що намагаються завантажити
          торент без трекера, на першій спробі не будуть мати жодних вузлів в
          своїй таблиці маршрутизації, та будуть потребувати контакти, включені
          в файл торента.</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">Вузли, що підтримують
          DHT, встановлюють останній біт 8-байтів резервованих флагів, що
          входять до обміну рукостискання протокола BitTorrent. Вузол, що
          отримує рукостискання, де вказано, що віддалений взуол підтримує DHT,
          повинен надіслати повідомлення PORT. Воно починається байтом 0x09, там
          має два байта корисного навантаження, що містить UDP порт DHT вузла, в
          мережевому порядку байт. Вузли, що отримують це повідомлення, повинні
          спробувати пропінгувати вузол по отриматому порту, та IP адресі
          віддаленого вузла. Якщо отримана відповідь на цей пінг, вузол повинен
          спробувати вставити інформацію про новий контакт в свою таблицю
          маршрутизації, відповідно до звичайних правил.&nbsp;</p>
      </div>
      <div class="section" id="torrent-file-extensions">
        <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;">Розширення
          файлу торента</h1>
        <p style="font-size: 1.3em; line-height: 1.5em;">Словник безтрекінгового
          торенту не має ключа "announce". Замість цього безтрекінговий торент
          має ключ "nodes". Цей ключ повинен бути встановлений в K найближчих
          вузлів в торенті, що генерується клієнтською таблицею маршрутизації.
          Як альтернатива, ключ може бути встановлений в відомо гарний вузол,
          такий як той, яким оперує людина, що генерує торент. Будь ласка, не
          додавайте автоматично "router.bittorrent.com" до файлів торента, або
          не додавайте цей вузол до клієнтських таблиць маршрутизації.</p>
        <pre class="literal-block" style="margin-left: 4em;">nodes = [["&lt;host&gt;", &lt;port&gt;], ["&lt;host&gt;", &lt;port&gt;], ...]
nodes = [["127.0.0.1", 6881], ["your.router.node", 4804]]
</pre></div>
      <div class="section" id="krpc-protocol">
        <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;">Протокол
          KRPC</h1>
        <p style="font-size: 1.3em; line-height: 1.5em;">Протокол KRPC є простим
          механізмом RPC, що складається з b-енкодованих словників, надісланих
          через UDP. За раз надсилаєтсья один простий пакет запиту, та такий
          самий один пакет надсилається у відповідь. Немає повторних передач. Є
          три типа повідомлень: запит, відповідь та помилка. Для протокола DHT
          існує чотири запита: ping, find_node, get_peers, та announce_peer.</p>
        <p style="font-size: 1.3em; line-height: 1.5em;">Повідомлення KRPC є
          єдиним словником, з трьома ключами, загальними для кожного
          повідомлення, та додатковими ключами, в залежності від типу
          повідомлення. Кожне повідомлення має ключ "t" з текстовим значенням,
          що представляє ID транзакції. Цей ID генерується через опит вузла, та
          повертається у відповідь, так що відповіді можуть корелювати з
          декількома запитами до того самого вузла. ID транзакції повинен бути
          закодований як короткий рядок з бінарних чисел. Типово достатньо 2
          символи, оскількі вони покривають 2^16 окремих запитів. Кожне
          повідомлення також має ключ "y" з одного значення символа, що описує
          тип повідомлення. Значення ключа "y" є одне з наступних: "q" для
          запиту, "r" для відповіді, або "e" для помилки. Ключ "v" повинен бути
          вказаний в кожне повідомлення, та містити рядок з версією клієнта.
          Рядок повинен бути з двох символів з ідентифікатором клієнта,
          зареєстрований в BEP 20<span>&nbsp;</span><a class="footnote-reference"
            href="http://www.bittorrent.org/beps/bep_0005.html#bep-20" id="id3"
            style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">[3]</a><span>,
            за яким слідує два символа ідентифікатора версії</span>. Не всі
          реалізації містять ключ "v", так що клієнти не повинні очікувати його
          присутності.</p>
        <div class="section" id="contact-encoding">
          <h2 style="margin: 0px; padding: 0px 0px 0.5em; font-size: 1.6em; font-weight: normal; border: 0px;">Кодування
            контакта</h2>
          <p style="font-size: 1.3em; line-height: 1.5em;">Контактна інформація
            для вузлів закодовані як 6-байтний рядок. Також відомий як
            "Компакнтна інформація IP-адреса/порт", 4-байтна IP адреса в
            мережевому порядку байтів, та 2 байта для порта в мережевому порядку
            байт, конкатеновані зразу за ними.</p>
          <p style="font-size: 1.3em; line-height: 1.5em;">Контактна інформація
            для вузлів закодована як 26-байтний рядок. Також відомий як
            "Компактна відомість про вузол", це 20-байтний Node ID в мережевому
            порядку байт, а також конкатенована за ним компактна інформація
            IP-адреса/порт.</p>
        </div>
        <div class="section" id="queries">
          <h2 style="margin: 0px; padding: 0px 0px 0.5em; font-size: 1.6em; font-weight: normal; border: 0px;">Запити</h2>
          <p style="font-size: 1.3em; line-height: 1.5em;">Запити, або
            словник-повідомлення KRPC з "y" значенням, рівним"q", містить два
            додаткові ключі; "q" та "a". Ключ "q" має значення-рядок, що містить
            ім'я методу для запиту. Ключ "a" має значення-словник, що містить
            іменовані аргументи до запиту.</p>
        </div>
        <div class="section" id="responses">
          <h2 style="margin: 0px; padding: 0px 0px 0.5em; font-size: 1.6em; font-weight: normal; border: 0px;">Відповіді</h2>
          <p style="font-size: 1.3em; line-height: 1.5em;">Відповіді, або
            словник-повідомлення KRPC з "y" значенням, рівним "r", містять один
            додатковий ключ, "r". Значення&nbsp; "r" є словником, що містить
            іменовані значення результату. Повідомлення відповідей надсилаються
            при успішному завершенні запиту.</p>
        </div>
        <div class="section" id="errors">
          <h2 style="margin: 0px; padding: 0px 0px 0.5em; font-size: 1.6em; font-weight: normal; border: 0px;">Помилки</h2>
          <p style="font-size: 1.3em; line-height: 1.5em;">Помилки, або
            словник-повідомлення KRPC з "y" значенням, рівним "e", містять один
            додатковий ключ, "e". Значення "e" є список. Перший елемент є цілим,
            що представляє код помилки. Другий елемент є рядком, що містить
            повідомлення про помилку. Помилки надсилаються в випадку, коли запит
            не може бути виконаний. Наступна таблиця описує можливі коди
            помилок:</p>
          <table class="docutils" style="border: 0px; margin-left: 4em;" border="1">
            <colgroup><col width="19%"><col width="81%"></colgroup>
            <tbody valign="top">
              <tr>
                <td style="font-size: 9pt; padding: 10px;">Код</td>
                <td style="font-size: 9pt; padding: 10px;">Опис</td>
              </tr>
              <tr>
                <td style="font-size: 9pt; padding: 10px;">201</td>
                <td style="font-size: 9pt; padding: 10px;">Загальна помилка</td>
              </tr>
              <tr>
                <td style="font-size: 9pt; padding: 10px;">202</td>
                <td style="font-size: 9pt; padding: 10px;">Помилка сервера</td>
              </tr>
              <tr>
                <td style="font-size: 9pt; padding: 10px;">203</td>
                <td style="font-size: 9pt; padding: 10px;">Помилка протокола,
                  така як невірно сформований пакет, аргументи або токен</td>
              </tr>
              <tr>
                <td style="font-size: 9pt; padding: 10px;">204</td>
                <td style="font-size: 9pt; padding: 10px;">Невідомий метод</td>
              </tr>
            </tbody>
          </table>
          <p style="font-size: 1.3em; line-height: 1.5em;">Приклади пакетів
            помилок:</p>
          <pre class="literal-block" style="margin-left: 4em;">generic error = {"t":"aa", "y":"e", "e":[201, "A Generic Error Ocurred"]}
bencoded = d1:eli201e23:A Generic Error Ocurrede1:t2:aa1:y1:ee
</pre></div>
      </div>
      <div class="section" id="dht-queries">
        <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;">DHT
          запити</h1>
        <p style="font-size: 1.3em; line-height: 1.5em;">Всі запити мають ключ
          "id", та значення, що містить ID запитуючого вузла. Всі відповіді
          мають ключ "id", та значення ID вузла, що надає відповідь.</p>
        <div class="section" id="ping">
          <h2 style="margin: 0px; padding: 0px 0px 0.5em; font-size: 1.6em; font-weight: normal; border: 0px;">ping</h2>
          <p style="font-size: 1.3em; line-height: 1.5em;">Найбільш базовим
            запитом є пінг. "q" = "ping". Запит пінгу має&nbsp; один аргумент,
            "id" зі значенням 20-байтного рядка, що містить ID надсилача в
            мережевому порядку байт. Відповідна відповідь на пінг має один ключ
            "id", що містить ID відповідаючого вузла.</p>
          <pre class="literal-block" style="margin-left: 4em;">arguments:  {"id" : "&lt;querying nodes id&gt;"}

response: {"id" : "&lt;queried nodes id&gt;"}
</pre>
          <p style="font-size: 1.3em; line-height: 1.5em;">Приклади пакетів</p>
          <pre class="literal-block" style="margin-left: 4em;">ping Query = {"t":"aa", "y":"q", "q":"ping", "a":{"id":"abcdefghij0123456789"}}
bencoded = d1:ad2:id20:abcdefghij0123456789e1:q4:ping1:t2:aa1:y1:qe
</pre>
          <pre class="literal-block" style="margin-left: 4em;">Response = {"t":"aa", "y":"r", "r": {"id":"mnopqrstuvwxyz123456"}}
bencoded = d1:rd2:id20:mnopqrstuvwxyz123456e1:t2:aa1:y1:re
</pre></div>
        <div class="section" id="find-node">
          <h2 style="margin: 0px; padding: 0px 0px 0.5em; font-size: 1.6em; font-weight: normal; border: 0px;">find_node</h2>
          <p style="font-size: 1.3em; line-height: 1.5em;">Пошук вузла
            використовується для пошуку контактної інформації для вузла, згідно
            його заданого ID. "q" == "find_node". Запит find_node має два
            аргументи, "id" містить ID вузла. що запитує, та "target", що
            містить ID вузла, який шукає запит. Коли вузол отримує запит
            find_node, він повинен відповідати ключем "nodes", та значенням в
            вигляді рядка з компактною інформацією про вузел, або K (8)
            найближчих гарних вузлів у власній таблиці маршрутизації.</p>
          <pre class="literal-block" style="margin-left: 4em;">arguments:  {"id" : "&lt;querying nodes id&gt;", "target" : "&lt;id of target node&gt;"}

response: {"id" : "&lt;queried nodes id&gt;", "nodes" : "&lt;compact node info&gt;"}
</pre>
          <p style="font-size: 1.3em; line-height: 1.5em;">Приклади пакетів</p>
          <pre class="literal-block" style="margin-left: 4em;">find_node Query = {"t":"aa", "y":"q", "q":"find_node", "a": {"id":"abcdefghij0123456789", "target":"mnopqrstuvwxyz123456"}}
bencoded = d1:ad2:id20:abcdefghij01234567896:target20:mnopqrstuvwxyz123456e1:q9:find_node1:t2:aa1:y1:qe
</pre>
          <pre class="literal-block" style="margin-left: 4em;">Response = {"t":"aa", "y":"r", "r": {"id":"0123456789abcdefghij", "nodes": "def456..."}}
bencoded = d1:rd2:id20:0123456789abcdefghij5:nodes9:def456...e1:t2:aa1:y1:re
</pre></div>
        <div class="section" id="get-peers">
          <h2 style="margin: 0px; padding: 0px 0px 0.5em; font-size: 1.6em; font-weight: normal; border: 0px;">get_peers</h2>
          <p style="font-size: 1.3em; line-height: 1.5em;">Отримання сторін за
            заданим інфор-херешем торента. "q" = "get_peers". Запит get_peers
            має два аргументи, "id" містить ID вузла, що надсилає запит, та
            "info_hash" містить інфо-хеш торента. Якщо запитаний вузол має
            сторони для інфо-хеша, вони надсилають ключ "values" зі списком
            рядків. Кожний рядок містить інформацію про слорони в "компактному"
            форматі для кожної зі сторін. Якщо опитаний вузол не має інформації
            щодо даний інфохеш, повертається ключ "nodes", що містить K вузлів з
            таблиці маршрутизації, найближчих до інфо-хешу в запиті. В любому
            випадку ключ "token" також включається в повернуте значення.
            Значення токена є потрібним аргументом для майбутнього запита
            announce_peer. Значення токена повинне бути коротким двійниковим
            рядком.</p>
          <pre class="literal-block" style="margin-left: 4em;">arguments:  {"id" : "&lt;querying nodes id&gt;", "info_hash" : "&lt;20-byte infohash of target torrent&gt;"}

response: {"id" : "&lt;queried nodes id&gt;", "token" :"&lt;opaque write token&gt;", "values" : ["&lt;peer 1 info string&gt;", "&lt;peer 2 info string&gt;"]}

or: {"id" : "&lt;queried nodes id&gt;", "token" :"&lt;opaque write token&gt;", "nodes" : "&lt;compact node info&gt;"}
</pre>
          <p style="font-size: 1.3em; line-height: 1.5em;">Приклади пакетів:</p>
          <pre class="literal-block" style="margin-left: 4em;">get_peers Query = {"t":"aa", "y":"q", "q":"get_peers", "a": {"id":"abcdefghij0123456789", "info_hash":"mnopqrstuvwxyz123456"}}
bencoded = d1:ad2:id20:abcdefghij01234567899:info_hash20:mnopqrstuvwxyz123456e1:q9:get_peers1:t2:aa1:y1:qe
</pre>
          <pre class="literal-block" style="margin-left: 4em;">Response with peers = {"t":"aa", "y":"r", "r": {"id":"abcdefghij0123456789", "token":"aoeusnth", "values": ["axje.u", "idhtnm"]}}
bencoded = d1:rd2:id20:abcdefghij01234567895:token8:aoeusnth6:valuesl6:axje.u6:idhtnmee1:t2:aa1:y1:re
</pre>
          <pre class="literal-block" style="margin-left: 4em;">Response with closest nodes = {"t":"aa", "y":"r", "r": {"id":"abcdefghij0123456789", "token":"aoeusnth", "nodes": "def456..."}}
bencoded = d1:rd2:id20:abcdefghij01234567895:nodes9:def456...5:token8:aoeusnthe1:t2:aa1:y1:re
</pre></div>
        <div class="section" id="announce-peer">
          <h2 style="margin: 0px; padding: 0px 0px 0.5em; font-size: 1.6em; font-weight: normal; border: 0px;">announce_peer</h2>
          <p style="font-size: 1.3em; line-height: 1.5em;">Анонсується сторона,
            що контролює запитуючий вузол, завантажує торент на порту.
            announce_peer має чотири аргументи: "id" містить ID запитуючого
            вузла, "info_hash" містить інфо-хеш торента, "port" містить порт як
            ціле, та "token" отримується в відповіді на попередній запит
            get_peers. Запитаний вузол повинен перевірити, що токен був
            попередньо надісланий на ту саму адресу IP, що і вузол, що надсилає
            анонс. Потім запитаний вузол повинен зберігати IP адресу запитуючого
            вузла та наданий номер порта, під даним інфо-хешем в сховищі
            контактної інформацїі сторін.</p>
          <p style="font-size: 1.3em; line-height: 1.5em;">Є опціональний
            аргумент, що називається&nbsp;<span></span><tt class="docutils literal">implied_port</tt><span>,
              зі значенням </span>0 або 1. Якщо він присутній, та не дорівнює
            нуля,&nbsp;<span></span><tt class="docutils literal">port</tt>argument
            повинен бути проігнорований, та порт походження UDP пакету повинен
            бути використаний як порт сторони. Це корисно для сторін за NAT, що
            можуть не знати своїх зовнішних портів, та підтримують uTP, вони
            приймають входящі з'єднання на тому ж порті, що і порт DHT.</p>
          <pre class="literal-block" style="margin-left: 4em;">arguments:  {"id" : "&lt;querying nodes id&gt;",
  "implied_port": &lt;0 or 1&gt;,
  "info_hash" : "&lt;20-byte infohash of target torrent&gt;",
  "port" : &lt;port number&gt;,
  "token" : "&lt;opaque token&gt;"}

response: {"id" : "&lt;queried nodes id&gt;"}
</pre>
          <p style="font-size: 1.3em; line-height: 1.5em;">Приклади пакетів:</p>
          <pre class="literal-block" style="margin-left: 4em;">announce_peers Query = {"t":"aa", "y":"q", "q":"announce_peer", "a": {"id":"abcdefghij0123456789", "implied_port": 1, "info_hash":"mnopqrstuvwxyz123456", "port": 6881, "token": "aoeusnth"}}
bencoded = d1:ad2:id20:abcdefghij01234567899:info_hash20:&lt;br /&gt;
mnopqrstuvwxyz1234564:porti6881e5:token8:aoeusnthe1:q13:announce_peer1:t2:aa1:y1:qe
</pre>
          <pre class="literal-block" style="margin-left: 4em;">Response = {"t":"aa", "y":"r", "r": {"id":"mnopqrstuvwxyz123456"}}
bencoded = d1:rd2:id20:mnopqrstuvwxyz123456e1:t2:aa1:y1:re
</pre></div>
      </div>
      <div class="section" id="references">
        <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;">Посилання</h1>
        <table class="docutils footnote" frame="void" id="kademlia" rules="none"
          style="border: 0px; margin-left: 4em;">
          <colgroup><col class="label"><col></colgroup>
          <tbody valign="top">
            <tr>
              <td class="label" style="font-size: 9pt; padding: 10px;"><a class="fn-backref"
                  href="http://www.bittorrent.org/beps/bep_0005.html#id1" style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">[1]</a></td>
              <td style="font-size: 9pt; padding: 10px;">Peter Maymounkov, David
                Mazieres, "Kademlia: A Peer-to-peer Information System Based on
                the XOR Metric",<span>&nbsp;</span><em>IPTPS 2002</em>.<span>&nbsp;</span><a
                  class="reference external" href="http://www.cs.rice.edu/Conferences/IPTPS02/109.pdf"
                  style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">http://www.cs.rice.edu/Conferences/IPTPS02/109.pdf</a></td>
            </tr>
          </tbody>
        </table>
        <table class="docutils footnote" frame="void" id="entropy" rules="none"
          style="border: 0px; margin-left: 4em;">
          <colgroup><col class="label"><col></colgroup>
          <tbody valign="top">
            <tr>
              <td class="label" style="font-size: 9pt; padding: 10px;"><a class="fn-backref"
                  href="http://www.bittorrent.org/beps/bep_0005.html#id2" style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">[2]</a></td>
              <td style="font-size: 9pt; padding: 10px;">Use SHA1 and plenty of
                entropy to ensure a unique ID.</td>
            </tr>
          </tbody>
        </table>
        <table class="docutils footnote" frame="void" id="bep-20" rules="none" style="border: 0px; margin-left: 4em;">
          <colgroup><col class="label"><col></colgroup>
          <tbody valign="top">
            <tr>
              <td class="label" style="font-size: 9pt; padding: 10px;"><a class="fn-backref"
                  href="http://www.bittorrent.org/beps/bep_0005.html#id3" style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">[3]</a></td>
              <td style="font-size: 9pt; padding: 10px;">BEP_0020. Peer ID
                Conventions. (<a class="reference external" href="http://www.bittorrent.org/beps/bep_0020.html"
                  style="color: rgb(102, 119, 136); text-decoration: none; border-bottom: 1px solid rgb(238, 238, 238);">http://www.bittorrent.org/beps/bep_0020.html</a>)</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="section" id="copyright">
        <h1 style="margin: 1em 0px 0.1em; font-size: 2em; font-weight: normal; letter-spacing: -1px;">Copyright</h1>
        <p style="font-size: 1.3em; line-height: 1.5em;">Цей документ був
          розміщений в публічному домені.</p>
      </div>
    </div>
    <p></p>
  </body>
</html>
