<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title>1. Вступ</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>1. Вступ</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Людським інстинктом є виступати скептиком до нових парадигм. Щоб надати деяку перспективу який далекий шлях ми пройшли, та зміни, що ми сприйняли щодо JVM, давайте почнемо зі швидкого нагадування останніх 20 років.</p></div>
<div class="paragraph"><p>Java 1.2 ввела Collections API, дозволивши нам писати методи, що абстрагувались на змінних колекціях. Це було корисно для написання алгоритмів загального призначення, та стало фундаментальним каменем нашого коду.</p></div>
<div class="paragraph"><p>Але була проблема, ми мали виконувати приведення часу виконання:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="n">public</span> <span class="nc">String</span> <span class="n">first</span><span class="o">(</span><span class="nc">Collection</span> <span class="n">collection</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="o">(</span><span class="nc">String</span><span class="o">)(</span><span class="n">collection</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>У відповідь розробники визначили прикладні об'єкти в своїй бізнес логиці, що ефективно буди Колекціями Речей, а Collection API стало деталлю реалізації.</p></div>
<div class="paragraph"><p>В 2005 Java 5 ввела дженеріки, дозволяючи нам визначати <code>Collection&lt;Thing&gt;</code>, абстрагуючись над контейнером та його елементами. Дженеріки змінили те, як ми пишемо на Java.</p></div>
<div class="paragraph"><p>Автор компілятора дженеріків Java, Martin Odersky, потім створив  Scala з суворішою системою типів, незмінними даними та множинним наслідуванням. Це дало зплав об'єктно-орієнтовного (OOP) та функціонального програмування (FP).</p></div>
<div class="paragraph"><p>Для більшості розробників FP означає використання незмінних даних наскільки це можливо, але змінний стан все ще є потрібним злом, яке треба ізолювати та керувати, наприклад за допомогою акторів Akka або синхронізованих класів. Цей стиль FP призводить до простиших програм, що простіше розпаралелити та розповсюдити, покращення порівняно з  Java. Але це тільки подряпина поверні переваг FP, як ми з'ясуємо в цій книзі.</p></div>
<div class="paragraph"><p>Scala також привносить <code>Future</code>, роблячи простим написання асинхронних застосувань. Але коли <code>Future</code> стає типом повернення, все має бути переписаним, щоб досягти цього, включаючи тести, що тепер є предметом до довільних таймаутів.</p></div>
<div class="paragraph"><p>Ми маємо проблему, подібну до Java 1.0: немає способу абстрагуватись над виконанням, майже так само, як ми не мали шляху абстрагуватись над колекціями.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_1___">1.1 Абстрагування над виконанням</h2>
<div class="sectionbody">
<div class="paragraph"><p>Скажімо, ви бажаєте взаємодіяти з користувачем через інтерфейс командного рядка. Ми можемо читати що друкує користувач, та ми можете писати їм повідомлення.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">trait</span> <span class="nc">TerminalSync</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">read</span><span class="o">()</span><span class="k">:</span> <span class="kt">String</span>
    <span class="k">def</span> <span class="n">write</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
  <span class="o">}</span>

  <span class="k">trait</span> <span class="nc">TerminalAsync</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">read</span><span class="o">()</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
    <span class="k">def</span> <span class="n">write</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Як ми пишемо уніфікований код, що робить щось таке просте, як відлуння користувацького вводу синхронно або асинхронно, в залежності від рантайм реалізації?</p></div>
<div class="paragraph"><p>Ви можете написати синхронну версію, та огорнути її в <code>Future</code>, але тепер ми маємо турбуватись про те, який пул потоків треба задіяти для цієї роботи, або ми можемо зробити <code>Await.result</code> на <code>Future</code>, та ввести блокування потоків. В жодному разі це безліч шаблонного коду, та ми фундаментально маємо справу з різними API, що не є уніфікованими.</p></div>
<div class="paragraph"><p>Ми можемо віришити цю проблему, як Java 1.2, з загальним предком, використовуючи можливості типів вищих порядків (higher kinded types, HKT) Scala.</p></div>
<div class="paragraph"><p>Higher Kinded Types дозволяють нам використовувати конструктор типу в наших параметрах типів, що виглядає як <code>C[_]</code>. Це спосіб сказати, що чим би не було <code>C</code>, воно має приймати параметр типу. Наприклад:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">trait</span> <span class="nc">Foo</span><span class="o">[</span><span class="kt">C</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">create</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p><code>List</code> є конструктором типу, оскільки він приймає тип (як <code>Int</code>), та конструює тип (<code>List[Int]</code>). Ми можемо реалізувати <code>Foo</code> використовуючи <code>List</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">object</span> <span class="nc">FooList</span> <span class="k">extends</span> <span class="nc">Foo</span><span class="o">[</span><span class="kt">List</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">create</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Ми можемо реалізувати <code>Foo</code> для будь-чого з діркою в параметрах типу, як <code>Either[String, _]</code>. Нажаль, це трохи незграбно, і ми маємо створювати псевдоними типів, щоб оманою змусити компілятор прийняти його:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">type</span> <span class="kt">EitherString</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Either</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">T</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>Псевдоними типів не визначають нові типи, вони є простою підстановкою, та не провадять додаткової безпеки типів. Компілятор замінює <code>EitherString[T]</code> на <code>Either[String, T]</code> будь-де. Цей прийом може використовуватись для омани компілятора для сприйняття типів з однією діркою, коли він би інакше думав що їх дві, як коли ми реалізуємо <code>Foo</code> через <code>EitherString</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">object</span> <span class="nc">FooEitherString</span> <span class="k">extends</span> <span class="nc">Foo</span><span class="o">[</span><span class="kt">EitherString</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">create</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Either</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Right</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Альтернитивно, плагін проектора типів дозволяє нам уникати псевдонимівтипів, та використовувати синтаксис <code>?</code>, щоб сказати компілятору, де є дірка типу:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">object</span> <span class="nc">FooEitherString</span> <span class="k">extends</span> <span class="nc">Foo</span><span class="o">[</span><span class="kt">Either</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">?</span><span class="o">]]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">create</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Either</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Right</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Нарешті, є один збочений трюк, що ми можемо використати, коли ми бажаємо ігнорувати конструктор типу. Визначте псевдонім типу як еквівалентний до його параметру:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">type</span> <span class="kt">Id</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="n">T</span>
</pre></div></div></div>
<div class="paragraph"><p>Перед тим як продовжити, зрозумійте, що <code>Id[Int]</code> є та сама річ, що і <code>Int</code>, через підстановку <code>Int</code> в <code>T</code>. Оскільки <code>Id</code> є валідний конструктор типів, ми можемо використовувати <code>Id</code> в реалізації <code>Foo</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">object</span> <span class="nc">FooId</span> <span class="k">extends</span> <span class="nc">Foo</span><span class="o">[</span><span class="kt">Id</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">create</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">i</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Ми бажаємо визначити <code>Terminal</code> для конструктора типів <code>C[_]</code>. Через визначення <code>Now</code> для конструювання його параметру типів (як <code>Id</code>), ми можемо реалізувати загальний інтерфейс для синхронних та асинхронних терміналів:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">trait</span> <span class="nc">Terminal</span><span class="o">[</span><span class="kt">C</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">read</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
    <span class="k">def</span> <span class="n">write</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
  <span class="o">}</span>

  <span class="k">type</span> <span class="kt">Now</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="n">X</span>

  <span class="k">object</span> <span class="nc">TerminalSync</span> <span class="k">extends</span> <span class="nc">Terminal</span><span class="o">[</span><span class="kt">Now</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">read</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">???</span>
    <span class="k">def</span> <span class="n">write</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">???</span>
  <span class="o">}</span>

  <span class="k">object</span> <span class="nc">TerminalAsync</span> <span class="k">extends</span> <span class="nc">Terminal</span><span class="o">[</span><span class="kt">Future</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">read</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
    <span class="k">def</span> <span class="n">write</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Ми можемо мислити <code>C</code> як <code>Context</code>, оскільки ми кажемо “в контексті виконання `Now`” або “в `Future`”.</p></div>
<div class="paragraph"><p>Але ми нічого не знаємо про C, і ми не можемо нічого робити з <code>C[String]</code>. Що нам треба є різновид оточення виконання, що дозволяє нам викликати метод, що повертає <code>C[T]</code>, та потім бути в змозі робить щось з <code>T</code>, включаючи виклик іншого метода на <code>Terminal</code>. Нам також треба спосіб огорнути значення, як <code>C[_]</code>. Ця сигнатура робить гарно:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">trait</span> <span class="nc">Execution</span><span class="o">[</span><span class="kt">C</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">chain</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">c</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">C</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
    <span class="k">def</span> <span class="n">create</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">b</span><span class="k">:</span> <span class="kt">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>дозволяючи нам писати:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="n">echo</span><span class="o">[</span><span class="kt">C</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">t</span><span class="k">:</span> <span class="kt">Terminal</span><span class="o">[</span><span class="kt">C</span><span class="o">],</span> <span class="n">e</span><span class="k">:</span> <span class="kt">Execution</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">e</span><span class="o">.</span><span class="n">chain</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="n">read</span><span class="o">)</span> <span class="o">{</span> <span class="n">in</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=&gt;</span>
      <span class="n">e</span><span class="o">.</span><span class="n">chain</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="n">in</span><span class="o">))</span> <span class="o">{</span> <span class="k">_:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span>
        <span class="n">e</span><span class="o">.</span><span class="n">create</span><span class="o">(</span><span class="n">in</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Тепер ми можемо поділити реалізацію <code>echo</code> між синхронними та асинхронними шляхами. Ви можете написати мок реалізацію <code>Terminal[Now]</code>, та використовувати його в наших тестах без жодних таймаутів.</p></div>
<div class="paragraph"><p>Реалізації <code>Execution[Now]</code> та <code>Execution[Future]</code> повторно використовуються загальними методами, як <code>echo</code>.</p></div>
<div class="paragraph"><p>Але код для <code>echo</code> жахливий!</p></div>
<div class="paragraph"><p>Можливості неявних класів мови Scala надають <code>C</code> деякі методи. Ми будемо називати ці методи <code>flatMap</code> та <code>map</code> з причин, що за мить стануть яснішими. Кожний метод приймає неявний <code>Execution[C]</code>, але це нічого більше, ніж <code>flatMap</code> та <code>map</code>, що ми використовували для <code>Seq</code>, <code>Option</code> та <code>Future</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">object</span> <span class="nc">Execution</span> <span class="o">{</span>
    <span class="k">implicit</span> <span class="k">class</span> <span class="nc">Ops</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">c</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="o">{</span>
      <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">C</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="k">implicit</span> <span class="n">e</span><span class="k">:</span> <span class="kt">Execution</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
            <span class="n">e</span><span class="o">.</span><span class="n">chain</span><span class="o">(</span><span class="n">c</span><span class="o">)(</span><span class="n">f</span><span class="o">)</span>
      <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">e</span><span class="k">:</span> <span class="kt">Execution</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
            <span class="n">e</span><span class="o">.</span><span class="n">chain</span><span class="o">(</span><span class="n">c</span><span class="o">)(</span><span class="n">f</span> <span class="n">andThen</span> <span class="n">e</span><span class="o">.</span><span class="n">create</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">echo</span><span class="o">[</span><span class="kt">C</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">t</span><span class="k">:</span> <span class="kt">Terminal</span><span class="o">[</span><span class="kt">C</span><span class="o">],</span> <span class="n">e</span><span class="k">:</span> <span class="kt">Execution</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">t</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">flatMap</span> <span class="o">{</span> <span class="n">in</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=&gt;</span>
      <span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="n">in</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="k">_:</span> <span class="kt">Unit</span> <span class="o">=&gt;</span>
        <span class="n">in</span>
      <span class="o">}</span>
    <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Тепер ми можемо розкрити, чому ми використовували <code>flatMap</code> як ім'я метода: воно дозволяє нам використовувати розширений <code>for</code>, що є тільки синтаксичним цукром над вкладеними <code>flatMap</code> та <code>map</code>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">def</span> <span class="n">echo</span><span class="o">[</span><span class="kt">C</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">t</span><span class="k">:</span> <span class="kt">Terminal</span><span class="o">[</span><span class="kt">C</span><span class="o">],</span> <span class="n">e</span><span class="k">:</span> <span class="kt">Execution</span><span class="o">[</span><span class="kt">C</span><span class="o">])</span><span class="k">:</span> <span class="kt">C</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">for</span> <span class="o">{</span>
      <span class="n">in</span> <span class="k">&lt;-</span> <span class="n">t</span><span class="o">.</span><span class="n">read</span>
       <span class="k">_</span> <span class="k">&lt;-</span> <span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="o">(</span><span class="n">in</span><span class="o">)</span>
    <span class="o">}</span> <span class="k">yield</span> <span class="n">in</span>
</pre></div></div></div>
<div class="paragraph"><p>Наш <code>Execution</code> має ту саму сигнатуру, що і трейт в <code>Scalaz</code> з назвою <code>Monad</code>, за винятком що <code>chain</code> є <code>bind</code>, та <code>create</code> є <code>pure</code>. Ми кажемо, що <code>C</code> є монадичним, коли доступне неявне <code>Monad[C]</code>. На додаток <code>Scalaz</code> має псевдоним типу <code>Id</code>.</p></div>
<div class="paragraph"><p>Висновок такий: якщо ми пишемо методи, що оперують з монадичними типами, тоді ми можемо записати послідовний код, що абстрагується над контектстом виконання. Тут ми показали абстрагування над синхронним та асинхронним виконанням, але це може бути також для більш суворої обробки помилок (де <code>C[_]</code> є <code>Either[Error, _])</code>, керування доступом до мінливого стану, виконання I/O, або аудиту сессії.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_1_2___">1.2 Чисто функціональне прогрумування</h2>
<div class="sectionbody">
<div class="paragraph"><p>Функціональне програмування є актом написання програм з чистих функцій. Чисті функції мають три властивості:</p></div>
<div class="paragraph"><p>Повні: повертають значення для кожного можливого вводу
Детерміністичні: повертають те саме значення для того самого вводу
Безгрішні: немає (прямої) взаємодії зі світом або станом програми.</p></div>
<div class="paragraph"><p>Разом ці властивості надають нам безпрецендентну здатність продумувати код. Наприклад, вхідні значення простіше ізолювати за допомогою повноти, кешування можливе коли функції детерміністичні, та взаємодію зі світом простіше контролювати та тестувати, коли функції безгрішні.</p></div>
<div class="paragraph"><p>Різновид речей, що порушують ці принципи, є побічні ефекти: прямо отримуючи доступ або змінюючи змінний стан (тобто, маючи <code>var</code> в класі або використовуючи старий нечистий API), комунікація з зовнішними ресурсами (як файли або мережевий пошук), або закидання та перехоплення виключень.</p></div>
<div class="paragraph"><p>Ми пишемо чисті функції уникаючи виключень, та взаємодіючи зі світом через безпечний контекст виконання <code>F[_]</code>.</p></div>
<div class="paragraph"><p>В попередньому розділі ми абстрагувались над виконанням, та визначили  <code>echo[Id]</code> та <code>echo[Future]</code>. Ми могли обгрунтовано очікувати, що виклик любого <code>echo</code> не буде виконувати жодних побічних ефектів, оскільки вони чисті. Однак якщо ми використовуємо <code>Future</code> або <code>Id</code> як контекст виконання, наше застосування почне слухати на <code>stdin</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">val</span> <span class="n">futureEcho</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">echo</span><span class="o">[</span><span class="kt">Future</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>Ми зруйнували чистоту, та більше не пишемо FP код: <code>futureEcho</code> є результатом виконання <code>echo</code> один раз. <code>Future</code> поєднує визначення програми з її інтерпретацією (її виконанням). Як результат, застосування, побудовані на <code>Future</code>, складно промислювати.</p></div>
<div class="paragraph"><p>Вираз посилково прозорий, якщо він може бути замінений відповідним значенням без зміни поведінки програми.</p></div>
<div class="paragraph"><p>Чисті функції посилково прозорі, дозволяючи гарно використовувати код, опитимізувати продуктивність, розуміти та контролювати програму.</p></div>
<div class="paragraph"><p>Нечисті функції не є посилково прозорими. Ми не можемо замінити <code>echo[Future]</code> на значення, таке як <code>val futureEcho</code>, оскільки бридкий користувач може надрукувати дещо інше іншого разу.</p></div>
<div class="paragraph"><p>Ми можемо визначити простий безпечний контекст виконання <code>F[_]</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">final</span> <span class="k">class</span> <span class="nc">IO</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">val</span> <span class="n">interpret</span><span class="k">:</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">interpret</span><span class="o">()))</span>
    <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">IO</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">interpret</span><span class="o">()).</span><span class="n">interpret</span><span class="o">())</span>
  <span class="o">}</span>
  <span class="k">object</span> <span class="nc">IO</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="o">=&gt;</span><span class="n">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IO</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="n">a</span><span class="o">)</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>що ліниво обчислює голову. <code>IO</code> є просто структурою даних, що посилається (потенційно) на нечистий код, та насправді нічого не виконує. Ми можемо реалізувати <code>Terminal[IO]</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">object</span> <span class="nc">TerminalIO</span> <span class="k">extends</span> <span class="nc">Terminal</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">read</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>           <span class="k">=</span> <span class="nc">IO</span> <span class="o">{</span> <span class="n">io</span><span class="o">.</span><span class="nc">StdIn</span><span class="o">.</span><span class="n">readLine</span> <span class="o">}</span>
    <span class="k">def</span> <span class="n">write</span><span class="o">(</span><span class="n">t</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nc">IO</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>та викликати <code>echo[IO]</code> щоб повернути значення:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="k">val</span> <span class="n">delayed</span><span class="k">:</span> <span class="kt">IO</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">echo</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>Ця <code>val delayed</code> може використовуватись повторно, але це тільки визначення роботи, що була зроблена. Ми можемо відобразити <code>String</code> та скласти додаткові програми, майже так само, як ми могли робити  <code>map</code> на <code>Future</code>. <code>IO</code> честний з нами в тому, що ми залежимо від деякої взаємодії зі світом, але не шкодить нам щодо доступу до виводу від цієї взаємодії.</p></div>
<div class="paragraph"><p>Нечистий код всередині <code>IO</code> обчислюється тільки коли ми <code>.interpret()</code> значення, що є нечистою дією:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span>  <span class="n">delayed</span><span class="o">.</span><span class="n">interpret</span><span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Застосування, складене з <code>IO</code> програм, інтерпретується тільки раз, в методі <code>main</code>, що також називається кінцем світу.</p></div>
<div class="paragraph"><p>В цій книзі ми розширимо концепції, введені в цій главі, та покажемо, як писати керовані, чисті функції, що досягають наших бізнес цілей.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2019-07-06 01:43:39 EEST
</div>
</div>
</body>
</html>
