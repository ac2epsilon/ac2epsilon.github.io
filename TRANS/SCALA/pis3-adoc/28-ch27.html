<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="__27">Глава 27</h2>
<div class="sectionbody">
</div>
</div>
<h1 id="_">Анотації</h1>
<div class="sect1">
<h2 id="_27_1____">27.1 Для чого потрібні анотації?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Є багато речей, які ви можете робити з програмою, крім компіляції та виконання. Ось деякі приклади:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Автоматична генерація документації з Scaladoc.
</p>
</li>
<li>
<p>
Форматування коду, так щоб він співпадав з вашим стилем.
</p>
</li>
<li>
<p>
Перевірка коду на загальні помилки, як відкриття файлу, та за деяких шляхів виконання відсутність його закриття.
</p>
</li>
<li>
<p>
Експериментальна перевірка типів, наприклад, щоб керувати побічними ефектами або для гарантії властивостей власності.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Такі інструменти називаються інструментами мета-програмування, оскількі вони є програмами, що приймають інші програми на вході. Анотації підтримують ці інструменти, дозволяючи програмісту  включати директиви для таких інструментів через джерельний код. Такі директиви дозволяють інструментам бути більш ефективними, порівняно з тим, якщо вони не мали б користувацького вводу. Наприклад, анотації можуть покращити попередньо перелічені інструменти наступним чином:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Генератор документації може бути проінструктований, що певний метод треба документувати як застарілий.
</p>
</li>
<li>
<p>
Форматувальник може бути проінструктований перестрибнути через частини програми, що були дбайливо відформатовані вручну.
</p>
</li>
<li>
<p>
Перевіряч незачинених файлів може бути поінструктований ігнорувати певний файл, що перевіряється на зачиненість вручну.
</p>
</li>
<li>
<p>
Перевіряч побічних ефектів може бути поінструктований перевірити, що вказаний метод не має побічних ефектів.
</p>
</li>
</ol></div>
<div class="paragraph"><p>У всіх ціх випадках теоретично має бути можливим для програмної мови провадити способи вставити додаткову інформацію. Фактично, більшість з цього напряму підтримується в тій чи іншій мові. Однак для кожної мови існує дуже багато таких інструментів, щоб напряму підтримувати їх всі. Більше того, вся ця інформація повністю ігнорується компілятором, який кінець кінцем лише бажає зробити код робочим.</p></div>
<div class="paragraph"><p>Філософія Scala в випадках як цей є включати мінімальну, ортогональну підтримку в основній мові, так що потім може бути написаний широкий загал інструмнтів мета програмування. В цьому випадку ця мінімальна підтримка є система анотацій. Компілятор розуміє тільки одну можливість, анотації, але він не додає жодного значення до окремих анотацій. Кожний інструмент мета програмування може визначати та використовувати свої особливі анотації.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_27_2__">27.2 Синтаксис анотацій</h2>
<div class="sectionbody">
<div class="paragraph"><p>Типове визначення анотації виглядає ось так:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="nd">@deprecated</span> <span class="k">def</span> <span class="n">bigMistake</span><span class="o">()</span> <span class="k">=</span> <span class="c1">//...</span>
</pre></div></div></div>
<div class="paragraph"><p>Анотацією є частина <code>@deprecated</code>, і вона стосується повністю до метода <code>bigMistake</code> (не показаний — він дуже жахливий). В цьому випадку метод помічений як дещо, що автор <code>bigMistake</code> бажав би, щоб ви не використовували. Можливо <code>bigMistake</code> буде повністю видалений з наступної версії коду.</p></div>
<div class="paragraph"><p>В попередньому прикладі метод анотований як <code>@deprecated</code>. Анотації дозволяються також в інших місцях. Анотації дозволяються на любому різновиді анотації або визначення, включаючи <code>val</code>, <code>var</code>, <code>def</code>, <code>class</code>, <code>object</code>, <code>trait</code> та <code>type</code>. Анотація стосується повністю до декларації або визначення, що слідує за ним:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="nd">@deprecated</span> <span class="k">class</span> <span class="nc">QuickAndDirty</span> <span class="o">{</span>
<span class="c1">//...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Анотації також можуть бути застосовані до виразу, як з анотацією <code>@unchecked</code> для порівняння шаблонів (див. Главу 15). Щоб зробити це, поставьте дві крапки (<code>:</code>) після виразу, та потім напишіть анотацію. Синтаксично це виглядає так, якби анотація була використаною як тип:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="o">(</span><span class="n">e</span><span class="k">:</span> <span class="kt">@unchecked</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
<span class="c1">// non-exhaustive cases...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Нарешті, анотації можуть бути розташовані на типах. Анотовані типи описані далі в цій главі.</p></div>
<div class="paragraph"><p>Досі показані анотації були просто символом <code>@</code>, за яким слідує склас анотації. Така проста анотація загальна та корисна, але анотації мають багатшу загальну форму:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="nd">@annot</span><span class="o">(</span><span class="n">exp_</span><span class="o">{</span><span class="mi">1</span><span class="o">},</span> <span class="n">exp_</span><span class="o">{</span><span class="mi">2</span><span class="o">},</span> <span class="o">...)</span>
</pre></div></div></div>
<div class="paragraph"><p><code>annot</code> вказує клас анотації. Всі анотації мають включати цю частину. Частини <code>exp</code> є аргументами анотації. Для анотацій як <code>@deprecated</code>, що не потребує жодних елементів, ви звичайно можете полишити дужки, але ви можете записати <code>@deprecated()</code>, якщо бажаєте. Для анотацій, що мають аргументи, покладайте аргументи в дужки, наприклад, <code>@serial(1234)</code>.</p></div>
<div class="paragraph"><p>Точна форма аргументів, які ви можете надати до анотації, залежить від окремого класу анотації. Більшість процесорів дозволяють вам надавати безпосередні константи, як <code>123</code> або <code>"hello"</code>. Сам компілятор, однак, підтримує довільні вирази, доки вони проходять перевірку типів. Деякі анотації класів можуть це використовувати, наприклад, щоб дозволити вам посилатись на інші змінні, крім таких з поля зору:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="nd">@cool</span> <span class="k">val</span> <span class="n">normal</span> <span class="k">=</span> <span class="s">&quot;Hello&quot;</span>
<span class="nd">@coolerThan</span><span class="o">(</span><span class="n">normal</span><span class="o">)</span> <span class="k">val</span> <span class="n">fonzy</span> <span class="k">=</span> <span class="s">&quot;Heeyyy&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Внутрішньо Scala представляє анотації як просто виклик конструктора на класі анотатора — замініть <code>@</code> на <code>new</code>, і ви матимете валідний вираз створення примірника. Це означає, що іменовані та аргументи по замовчанню  підтримуються природно, оскільки Scala вже має іменовані та аргументи по замовчанню для викликів методів та конструкторів. Одне з доволі заплутаних питань щодо анотацій, що концептуально приймають інші анотації як аргументи, чого потребують деякі фреймворки. Ви не можете писати анотації напряму як аргументи до анотацій, оскільки анотації не є валідними виразами. В таких випадках ви маєте використовувати <code>new</code> замість <code>@</code>, як проілюстровано тут:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="n">scala</span><span class="o">&gt;</span> <span class="k">import</span> <span class="nn">annotation._</span>
<span class="k">import</span> <span class="nn">annotation._</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">strategy</span><span class="o">(</span><span class="n">arg</span><span class="k">:</span> <span class="kt">Annotation</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Annotation</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">strategy</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">delayed</span> <span class="k">extends</span> <span class="nc">Annotation</span>
<span class="n">defined</span> <span class="k">class</span> <span class="nc">delayed</span>

<span class="n">scala</span><span class="o">&gt;</span> <span class="nd">@strategy</span><span class="o">(</span><span class="nd">@delayed</span><span class="o">)</span> <span class="k">def</span> <span class="n">f</span><span class="o">()</span> <span class="k">=</span> <span class="o">{}</span>
<span class="o">&lt;</span><span class="n">console</span><span class="k">&gt;:</span><span class="mi">1</span><span class="k">:</span> <span class="kt">error:</span> <span class="kt">illegal</span> <span class="kt">start</span> <span class="kt">of</span> <span class="kt">simple</span> <span class="kt">expression</span>
      <span class="nd">@strategy</span><span class="o">(</span><span class="nd">@delayed</span><span class="o">)</span> <span class="k">def</span> <span class="n">f</span><span class="o">()</span> <span class="k">=</span> <span class="o">{}</span>
                <span class="o">^</span>
<span class="n">scala</span><span class="o">&gt;</span> <span class="nd">@strategy</span><span class="o">(</span><span class="k">new</span> <span class="n">delayed</span><span class="o">)</span> <span class="k">def</span> <span class="n">f</span><span class="o">()</span> <span class="k">=</span> <span class="o">{}</span>
<span class="n">f</span><span class="k">:</span> <span class="o">()</span><span class="kt">Unit</span>
</pre></div></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_27_3__">27.3 Стандартні анотації</h2>
<div class="sectionbody">
<div class="paragraph"><p>Scala включає декілька стандартних анотацій. Вони призначені для можливостей, що використовуються досі загально, щоб заслужити розташування в специфікації мови, але не досить фундаментальні, щоб отримати свій власний синтаксис. З часом буде тонка струмка нових анотацій, що будуть додані до стандарту в такий самий спосіб.</p></div>
<div class="sect2">
<h3 id="__2">Застаріння</h3>
<div class="paragraph"><p>Іноді ви пишете клас або метод, про який потім бажаєте, щоб його не було. Однак коли він вже доступний, код, написаний іншими людьми може викликати цей метод. Таким чином ви не можете просто видалити цей метод, оскільки після цього код інших людей перестане компілюватись.</p></div>
<div class="paragraph"><p>Застаріння дозволяє вам елегантно видалити метод або клас, що виявився помилкою. Ви помічаєте метод або клас як застарілий, та потім будь хто при виклику цього методу або класу буде отримувати попередження про застарілість. Їм краще дослухатись до цього попередження та оновити їхній код! Ідея в тому, що після спливання віповідного проміжку часу ви відчуватимете безпечним в припущенні, що всі помірковані клієнти припинять доступатись до застарілого класу або методу, і, таким чином, що ви можете безпечно видалити його.</p></div>
<div class="paragraph"><p>Ви відмічаєте метод як застарілий просто написавши перед ним <code>@deprecated</code>. Наприклад:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="nd">@deprecated</span> <span class="k">def</span> <span class="n">bigMistake</span><span class="o">()</span> <span class="k">=</span>
<span class="c1">//...</span>
</pre></div></div></div>
<div class="paragraph"><p>Така анотація призведе до того, що Scala компілятор додасть повідомлення про застарілість кожного разу, коли код Scala отримує доступ до метода.</p></div>
<div class="paragraph"><p>Якщо ви надасте рядок як аргумент до <code>@deprecated</code>, цей рядок буде виданий разом з повідомленням про помилку. Використовуйте це повідомлення для пояснення розробникам, що вони повинні використовувати замість застарілого метода.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="nd">@deprecated</span><span class="o">(</span><span class="s">&quot;use newShinyMethod() instead&quot;</span><span class="o">)</span>
<span class="k">def</span> <span class="n">bigMistake</span><span class="o">()</span> <span class="k">=</span> <span class="c1">//...</span>
</pre></div></div></div>
<div class="paragraph"><p>Тепер викликачі будуть отримувати таке повідомлення:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="n">$</span> <span class="n">scalac</span> <span class="o">-</span><span class="n">deprecation</span> <span class="nc">Deprecation2</span><span class="o">.</span><span class="n">scala</span>
<span class="nc">Deprecation2</span><span class="o">.</span><span class="n">scala</span><span class="k">:</span><span class="err">33</span><span class="kt">:</span> <span class="kt">warning:</span> <span class="kt">method</span> <span class="kt">bigMistake</span> <span class="kt">in</span> <span class="kt">objectDeprecation2</span> <span class="kt">is</span> <span class="kt">deprecated:</span> <span class="kt">use</span> <span class="kt">newShinyMethod</span><span class="o">()</span> <span class="kt">instead</span>
    <span class="n">bigMistake</span><span class="o">()</span>
    <span class="o">^</span>
<span class="n">one</span> <span class="n">warning</span> <span class="n">found</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="__">Мінливі поля</h3>
<div class="paragraph"><p>Конкурентно програмування негарно міксується з загальним змінним станом. З цієї причини фокус підтримки конкурентності Scala є передача повідомлень, та мінімум загального змінного стану. Дивіться Главу 32 щодо деталей.</p></div>
<div class="paragraph"><p>Тим не менш, іноді програмісти бажають використати змінний стан в їх конкурентних програмах. Анотація <code>@volatile</code> допомагає в таких випадках. Вона інформує компілятор, що розглядувана змінна буде використана в декількох потоках. Такі змінні реалізовані так, що читання та запис до них повільнішій, але доступ з декількох потоків поводиться більш передбачувано.</p></div>
<div class="paragraph"><p>Ключове слово <code>@volatile</code> дає різні гарантії на різних платформах. Однак на Java платформі ви отримаєте ту саму поведінку, якби ви написали поле в Java коді, і помітили його за допомогою модифікатора Java <code>volatile</code>.</p></div>
</div>
<div class="sect2">
<h3 id="___2">Бінарна сериалізація</h3>
<div class="paragraph"><p>Багато мов включають фреймворк для бінарної сериалізації. Фреймворк сериалізації допомагає вам конвертувати об'єкти в потоки байтів і навпаки. Це корисно, якщо ви бажаєте зберігти об'єкти на диску, або надіслати їх по мережі. XML може допомогти для тих же цілей (дивіться Главу 28), але він має інші недоліки відносно швидкості, використання простору, гнучкості та портабельності.</p></div>
<div class="paragraph"><p>Scala не має власного фреймворку сериалізації. Замість цього вам слідує використовувати фреймворк для вашої підлеглої платформи. Що робить Scala, це провадить три анотації, що корисні для різних фреймворків. Також компілятор Scala для платформи Java інтерпретує ці анотації в Java спосіб (дивіться Главу 31).</p></div>
<div class="paragraph"><p>Перша анотація вказує, чи клас взагалі серіалізується. Більшість класів сериалізуються, але не всі. Вказівник на сокет або GUI вікно, наприклад, не можуть бути серіалізовані. По замовчанню клас не розглядається як серіалізуємий. Вам слідує додати анотацію @<code>serializable</code> до любого класу, що буде серіалізуватись.</p></div>
<div class="paragraph"><p>Друга анотація допомагає мати справу зі змінами серіалізованих класів з плином часу. Ви можете додати серійний номер до поточної версії класу, через додавання анотації, як <code>@SerialVersionUID(1234)</code>, де <code>1234</code> має бути замінено на ваш серійний номер. Фреймворк повинен зберігати це число в згенерованому байтовому потоці. Коли потім ви перезавантажите байтовий потік, та спробуєте конвертувати його на об'єкт, фреймворк може перевірити, що поточна версія класу має той самий номер версії, що і версія в байтовому потоці. Якщо ви бажаєте зробити сериалізація-несумісні зміни до вашого класу, тоді ви можете змінити номер версії. Тоді фреймворк буде автоматично відхиляти завантаження старих примірників класу.</p></div>
<div class="paragraph"><p>Нарешті, Scala провадить анотацію <code>@transient</code> для полів, що взагалі не мають бути серіалізовані. Якщо ви помітите поле як <code>@transient</code>, тоді фреймворк не повинен зберігати поле, навіть коли оточуючий об'єкт серіалізується. Коли об'єкт завантажується, поле буде відновлене в значення по замовчанню для типу поля, анотованого як <code>@transient</code>.</p></div>
</div>
<div class="sect2">
<h3 id="___code_get_code__code_set_code">Автоматичні методи <code>get</code> та <code>set</code></h3>
<div class="paragraph"><p>Scala код звичайно не потребує явних методів <code>get</code> та <code>set</code> для полів, оскілько Scala змішує синтаксис для доступу до полів та виклик методів. Однак, деякі платформ-специфічні фреймворки очікують методи <code>get</code> та <code>set</code>. Для ціх цілей Scala провадить анотацію <code>@scala.reflect.BeanProperty</code>. Якщо ви додаєте цю анотацію до поля, компілятор буде автоматично генерувати <code>get</code> та <code>set</code> для вас. Якщо ви анотуєте поле на ім'я <code>crazy</code>, <code>get</code> метод буде названий <code>getCrazy</code>, та <code>set</code> метод буде названий <code>setCrazy</code>.</p></div>
<div class="paragraph"><p>Згенеровані методи <code>get</code> та <code>set</code> доступні тільки після того, як прохід компілятора буде завершено. Таким чином ви не можете викликати ці методи <code>get</code> та <code>set</code> з кода, що ви компілюєте, разом з анотованим полем. Це не має бути проблемою на практиці, оскільки в Scala коді ви можете отримувати доступ до полів напряму. Ця можливість призначеня для підтримкм фреймворків, що очікують звичайних методів <code>get</code> та <code>set</code>, та типово ви не компілюєте фреймворк, та код, що його використовує, одночасно.</p></div>
</div>
<div class="sect2">
<h3 id="_tailrec">Tailrec</h3>
<div class="paragraph"><p>Ви будете типово додавати анотацію <code>@tailrec</code> до метода, що має хвостову рекурсію, наприклад тому, що ви очікуєте, що інакше рекурсія буде занадто глибокою. Щоб переконатись, що компілятор Scala виконує хвостову рекурсію метода з оптимізацією, описаною в Розділі 8.9, ви можете додати <code>@tailrec</code> перед визначенням метода. Якщо оптимізація не може бути виконана, ви будете отримувати попередження, разом з поясненням причини.</p></div>
</div>
<div class="sect2">
<h3 id="_unchecked">Unchecked</h3>
<div class="paragraph"><p>Анотація <code>@unchecked</code> інтерпретується компілятором під час порівняння шаблонів. Вона каже компілятору не турбуватись, якщо вираз <code>match</code> здається не враховує деякі випадки. Дивіться Розділ 15.5 для деталей.</p></div>
</div>
<div class="sect2">
<h3 id="___3">Природні методи</h3>
<div class="paragraph"><p>Анотація <code>@native</code> інформує компілятор, що реалізація метода надається скоріше середовищем виконання, ніж кодом Scala. Компілятор буде перемикати відповідний флаг на виході, і покладається на розробника надати реалізацію, використовуючі механізми, такі як Java Native Interface (JNI).</p></div>
<div class="paragraph"><p>При використанні анотації <code>@native</code> тіло метода має бути надане, але воно не потрапить на вихід. Наприклад, ось як декларується метод <code>beginCountdown</code>, що буде наданий під час виконання:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="nd">@native</span>
<span class="k">def</span> <span class="n">beginCountdown</span><span class="o">()</span> <span class="k">=</span> <span class="o">{}</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_27_4_">27.4 Висновок</h2>
<div class="sectionbody">
<div class="paragraph"><p>Ця глава описує платформ-незалежні аспекти анотацій, про які вам скоріше всього треба знати. Перед усім вона розповідає про синтаксис анотацій, оскіль використання анотацій є значно більш загальним, ніж використання нових. Друге, вона показує, як використовувати декілька анотацій, що підтримуються стандартним компілятором Scala, включаючи <code>@deprecated</code>, <code>@volatile</code>, <code>@serializable</code>, <code>@BeanProperty</code>, <code>@tailrec</code> та <code>@unchecked</code>.</p></div>
<div class="paragraph"><p>Глава 31 дає додаткову, Java-специфічну інформацію по анотаціях. Це покриває анотації, доступні тільки при цілі на Java, додаткове значення стандартних анотацій при цілі на Java, як взаємодіяти з Java-базованими анотаціями, і як використовувати Java-базовані механізми для визначення та обробки анотацій вScala.</p></div>
<div class="paragraph"><p>Анотації є структурованою інформацією, доданою до програмного джерельного коду. Як коментарі, вони можуть бути розпорошені по програмі та приєднані до кожної змінної, методу, виразу або іншому елементу програми. На відміну від коментарів, вони мають структуру,  таким чином спрощуючи машинну обробку.</p></div>
<div class="paragraph"><p>Ця глава показує, як використовувати анотації в Scala. Вона також показує їх загальний синтаксис, та як використовувати декілька стандартних анотацій.</p></div>
<div class="paragraph"><p>Ця глава не показує, як писати нові інструменти обробки анотацій, оскільки це за межами цієї книги. Глава 31 показує один прийом, але він не поодинокий. Замість цього, ця глава фокусується на тому, як використовувати анотації, оскільки більш загально використовувати анотації, ніж визначати нові процесори анотацій.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2019-04-12 22:30:52 EEST
</div>
</div>
</body>
</html>
