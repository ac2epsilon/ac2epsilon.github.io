<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0047)http://exploring.liftweb.net/onepage/index.html -->
<html  lang="en"  xmlns<=""  code=""  xml:lang="en"  xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta  http-equiv="content-type"  content="application/xhtml+xml; charset=UTF-8" />
    <title> Exploring Lift </title>
    <!-- scripts for highlighter -->
    <script  src="./ExploringLift_files/shCore.js"  type="text/javascript"></script>
    <script  src="./ExploringLift_files/shBrushXml.js"  type="text/javascript"></script>
    <script  src="./ExploringLift_files/shBrushScala.js"  type="text/javascript"></script>
    <script  src="./ExploringLift_files/shBrushBash.js"  type="text/javascript"></script>
    <!-- CSS for highlighter -->
    <link  type="text/css"  rel="stylesheet"  href="./ExploringLift_files/shCore.css" />
    <link  type="text/css"  rel="stylesheet"  href="./ExploringLift_files/shThemeDefault.css" />
    <link  media="screen"  type="text/css"  href="./ExploringLift_files/lyx.css"
       rel="stylesheet" />
  </head>
  <body  <=""  code="">
    <div  id="globalWrapper">
      <h1  class="title"> <span  class="giant">Дослідження Lift</span> </h1>
      <h2  class="author">Редакція Lift 2.0 </h2>
      <h2  class="author">Написано </h2>
      <h2  class="author"> Derek Chen-Becker, Marius Danciu та Tyler Weir </h2>
      <div  class="Unindented"> Copyright © 2008, 2009, 2010, 2011 by Derek
        Chen-Becker, Marius Danciu, David Pollak, та Tyler Weir.<br />
        Ця робота ліцензована під Creative Commons Attribution-No Derivative
        Works 3.0 Unported License.<br />
        Переклад українською: Арсеній Чеботарьов, Ніжин, 2016</div>
      <div  class="Indented">Домашня сторінка для <i>Exploring Lift</i> є <a  href="http://exploring.liftweb.net/"
           class="FlexURL">http://exploring.liftweb.net</a>. Там ви можете
        знайти актуальну копію тексту, а також посилання на списки розсилки,
        відсліджування проблем та джерельний код. </div>
      <div  class="fulltoc">
        <div  class="tocheader">Зміст</div>
        <div  class="tocindent">
          <div  class="toc"> <a  href="#toc-Chapter--1"  class="Link">Глава: 
              Присвячення</a> </div>
          <div  class="toc"> <a  href="#toc-Chapter--2"  class="Link">Глава: 
              Подяки</a> </div>
        </div>
        <div  class="toc"> <a  href="#toc-Part-I"  class="Link">Частина
            I: Основи</a> </div>
        <div  class="tocindent">
          <div  class="toc"> <a  href="#toc-Chapter-1"  class="Link">Глава
              1: Ласкаво просимо до Lift!</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-1.1"  class="Link">Розділ
                1.1: Чому Lift?</a> </div>
            <div  class="toc"> <a  href="#toc-Section-1.2"  class="Link">Розділ
                1.2: Що потрібно знати перед початком</a> </div>
            <div  class="toc"> <a  href="#toc-Section-1.3"  class="Link">Розділ
                1.3: Типографічні домовленості</a> </div>
            <div  class="toc"> <a  href="#toc-Section-1.4"  class="Link">Розділ
                1.4: Отримання додаткової інформації щодо Lift</a> </div>
            <div  class="toc"> <a  href="#toc-Section-1.5"  class="Link">Розділ
                1.5: Ваше перше застосування Lift</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-2"  class="Link">Глава
              2: PocketChange</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-2.1"  class="Link">Розділ
                2.1: Визначення моделі</a> </div>
            <div  class="toc"> <a  href="#toc-Section-2.2"  class="Link">Розділ
                2.2: Ваш перший шаблон</a> </div>
            <div  class="toc"> <a  href="#toc-Section-2.3"  class="Link">Розділ
                2.3: Написання фрагментів</a> </div>
            <div  class="toc"> <a  href="#toc-Section-2.4"  class="Link">Розділ
                2.4: Маленька перчинка AJAX</a> </div>
            <div  class="toc"> <a  href="#toc-Section-2.5"  class="Link">Розділ
                2.5: Висновок</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-3"  class="Link">Глава
              3: Підгрунтя Lift</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-3.1"  class="Link">Розділ
                3.1: Вступ до Lift</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.2"  class="Link">Розділ
                3.2: Bootstrap</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-3.2.1"  class="Link">Підрозділ
                  3.2.1: Розрішення класів</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-3.3"  class="Link">Розділ
                3.3: Зауваження щодо стандартних імпортів</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.4"  class="Link">Розділ
                3.4: Головні об'єкти Lift</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-3.4.1"  class="Link">Підрозділ
                  3.4.1: Об'єкт S</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-3.4.2"  class="Link">Підрозділ
                  3.4.2: SHtml</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-3.4.3"  class="Link">Підрозділ
                  3.4.3: LiftRules</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-3.5"  class="Link">Розділ
                3.5: Процес відображення</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.6"  class="Link">Розділ
                3.6: Повідомлення зауваження, попередження та помилок</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.7"  class="Link">Розділ
                3.7: Перезапис URL</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.8"  class="Link">Розділ
                3.8: Власні функції відправки</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.9"  class="Link">Розділ
                3.9: Перенаправлення HTTP</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.10"  class="Link">Розділ
                3.10: Cookies</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.11"  class="Link">Розділ
                3.11: Стан сесії та запиту</a> </div>
            <div  class="toc"> <a  href="#toc-Section-3.12"  class="Link">Розділ
                3.12: Висновок</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-4"  class="Link">Глава
              4: Шаблони в Lift</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-4.1"  class="Link">Розділ
                4.1: Шаблони XML</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-4.1.1"  class="Link">Підрозділ
                  4.1.1: Пошук шаблону XML</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.1.2"  class="Link">Підрозділ
                  4.1.2: Обробка шаблону XML</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-4.2"  class="Link">Розділ
                4.2: Дружні до дезайнера шаблони</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-4.2.1"  class="Link">Підрозділ
                  4.2.1: Визначення елементу вмісту</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.2.2"  class="Link">Підрозділ
                  4.2.2: Виклик уривків через атрибути класу</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.2.3"  class="Link">Підрозділ
                  4.2.3: Прив'язування через CSS перетворення</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-4.3"  class="Link">Розділ
                4.3: Підтримка HTML5</a> </div>
            <div  class="toc"> <a  href="#toc-Section-4.4"  class="Link">Розділ
                4.4: Перегляди</a> </div>
            <div  class="toc"> <a  href="#toc-Section-4.5"  class="Link">Розділ
                4.5: Теги</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-4.5.1"  class="Link">Підрозділ
                  4.5.1: a</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.2"  class="Link">Підрозділ
                  4.5.2: bind</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.3"  class="Link">Підрозділ
                  4.5.3: bind-at</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.4"  class="Link">Підрозділ
                  4.5.4: children</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.5"  class="Link">Підрозділ
                  4.5.5: comet</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.6"  class="Link">Підрозділ
                  4.5.6: CSS</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.7"  class="Link">Підрозділ
                  4.5.7: embed </a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.8"  class="Link">Підрозділ
                  4.5.8: form</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.9"  class="Link">Підрозділ
                  4.5.9: HTML5</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.10"  class="Link">Підрозділ
                  4.5.10: ignore</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.11"  class="Link">Підрозділ
                  4.5.11: lazy-load</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.12"  class="Link">Підрозділ
                  4.5.12: loc</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.13"  class="Link">Підрозділ
                  4.5.13: Menu</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.14"  class="Link">Підрозділ
                  4.5.14: Msgs</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.15"  class="Link">Підрозділ
                  4.5.15: SkipDocType</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.16"  class="Link">Підрозділ
                  4.5.16: snippet</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.17"  class="Link">Підрозділ
                  4.5.17: surround</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.18"  class="Link">Підрозділ
                  4.5.18: tail</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.19"  class="Link">Підрозділ
                  4.5.19: TestCond</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.20"  class="Link">Підрозділ
                  4.5.20: with-param</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.21"  class="Link">Підрозділ
                  4.5.21: with-resource-id</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.22"  class="Link">Підрозділ
                  4.5.22: VersionInfo</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-4.5.23"  class="Link">Підрозділ
                  4.5.23: XmlGroup</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-4.6"  class="Link">Розділ
                4.6: Злиття заголовку та підвалин</a> </div>
            <div  class="toc"> <a  href="#toc-Section-4.7"  class="Link">Розділ
                4.7: Вбудовування</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-5"  class="Link">Глава
              5: Фрагменти</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-5.1"  class="Link">Розділ
                5.1: Тег фрагменту</a> </div>
            <div  class="toc"> <a  href="#toc-Section-5.2"  class="Link">Розділ
                5.2: Відправка фрагменту</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-5.2.1"  class="Link">Підрозділ
                  5.2.1: Неявна відправка через рефлексію</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-5.2.2"  class="Link">Підрозділ
                  5.2.2: Явна відправка</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-5.2.3"  class="Link">Підрозділ
                  5.2.3: По-запитне перевідображення</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-5.3"  class="Link">Розділ
                5.3: Методи фрагменту</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-5.3.1"  class="Link">Підрозділ
                  5.3.1: Зв'язування значень у фрагментах</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-5.3.2"  class="Link">Підрозділ
                  5.3.2: Перетворення CSS селектора</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-5.3.3"  class="Link">Підрозділ
                  5.3.3: Фрагменти з та без стану</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-5.3.4"  class="Link">Підрозділ
                  5.3.4: Швидке обчислення</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-5.4"  class="Link">Розділ
                5.4: Обробка XHTML атрибутів у фрагментах</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-5.4.1"  class="Link">Підрозділ
                  5.4.1: Прямі маніпуляції в коді</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-5.4.2"  class="Link">Підрозділ
                  5.4.2: Прохідні атрибути XHTML</a> </div>
            </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-6"  class="Link">Глава
              6: Форми в Lift</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-6.1"  class="Link">Розділ
                6.1: Підгрунтя форми</a> </div>
            <div  class="toc"> <a  href="#toc-Section-6.2"  class="Link">Розділ
                6.2: Атрибути для елементів форми</a> </div>
            <div  class="toc"> <a  href="#toc-Section-6.3"  class="Link">Розділ
                6.3: Огляд елементів форми</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-6.3.1"  class="Link">Підрозділ
                  6.3.1: checkbox</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.2"  class="Link">Підрозділ
                  6.3.2: hidden</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.3"  class="Link">Підрозділ
                  6.3.3: link</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.4"  class="Link">Підрозділ
                  6.3.4: text та password</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.5"  class="Link">Підрозділ
                  6.3.5: textarea</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.6"  class="Link">Підрозділ
                  6.3.6: submit</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.7"  class="Link">Підрозділ
                  6.3.7: multiselect</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.8"  class="Link">Підрозділ
                  6.3.8: radio</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.9"  class="Link">Підрозділ
                  6.3.9: select</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.10"  class="Link">Підрозділ
                  6.3.10: selectObj</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-6.3.11"  class="Link">Підрозділ
                  6.3.11: untrustedSelect</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-6.4"  class="Link">Розділ
                6.4: Завантаження файлів</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-7"  class="Link">Глава
              7: SiteMap</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-7.1"  class="Link">Розділ
                7.1: Базове визначення SiteMap</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-7.1.1"  class="Link">Підрозділ
                  7.1.1: Клас Link</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.1.2"  class="Link">Підрозділ
                  7.1.2: ExtLink</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.1.3"  class="Link">Підрозділ
                  7.1.3: Створення елементів меню</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.1.4"  class="Link">Підрозділ
                  7.1.4: Вкладені меню</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.1.5"  class="Link">Підрозділ
                  7.1.5: Налаштування глобального SiteMap</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-7.2"  class="Link">Розділ
                7.2: Налаштування відображення</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-7.2.1"  class="Link">Підрозділ
                  7.2.1: Приховування</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.2.2"  class="Link">Підрозділ
                  7.2.2: Керування текстом меню</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.2.3"  class="Link">Підрозділ
                  7.2.3: Використання &lt;lift:Menu&gt;</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-7.3"  class="Link">Розділ
                7.3: Контрль доступу</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-7.3.1"  class="Link">Підрозділ
                  7.3.1: If</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.3.2"  class="Link">Підрозділ
                  7.3.2: Unless</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-7.4"  class="Link">Розділ
                7.4: Специфічне до сторінки відображення</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-7.4.1"  class="Link">Підрозділ
                  7.4.1: Параметр Template</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.4.2"  class="Link">Підрозділ
                  7.4.2: Параметри Snippet та  LocSnippets</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.4.3"  class="Link">Підрозділ
                  7.4.3: Заголовок</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-7.5"  class="Link">Розділ
                7.5: Різноманітна функціональність меню</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-7.5.1"  class="Link">Підрозділ
                  7.5.1: Test</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.5.2"  class="Link">Підрозділ
                  7.5.2: LocGroup</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-7.6"  class="Link">Розділ
                7.6: Написання вашого власного Loc</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-7.6.1"  class="Link">Підрозділ
                  7.6.1: Відповідні функції</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.6.2"  class="Link">Підрозділ
                  7.6.2: Параметри безпечних типів</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.6.3"  class="Link">Підрозділ
                  7.6.3: Динамічне додавання дочірніх меню</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-7.6.4"  class="Link">Підрозділ
                  7.6.4: Прив'язування вашого власного Loc</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-7.7"  class="Link">Розділ
                7.7: Висновок</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-8"  class="Link">Глава
              8: Фреймворки Mapper та Record</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-8.1"  class="Link">Розділ
                8.1: Вступ до Mapper та MetaMapper</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-8.1.1"  class="Link">Підрозділ
                  8.1.1: Додавання Mapper до вашого проекта</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.2"  class="Link">Підрозділ
                  8.1.2: Встановлення з'єднання з базою даних</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.3"  class="Link">Підрозділ
                  8.1.3: Конструювання Mapper-орієнтовного класу</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.4"  class="Link">Підрозділ
                  8.1.4: Відносини між об'єктами</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.5"  class="Link">Підрозділ
                  8.1.5: Індексування</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.6"  class="Link">Підрозділ
                  8.1.6: Відображення схеми</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.7"  class="Link">Підрозділ
                  8.1.7: Операції стійкості на Entity</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.8"  class="Link">Підрозділ
                  8.1.8: Запити сутностей</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.9"  class="Link">Підрозділ
                  8.1.9: Порівняння QueryParams</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.10"  class="Link">Підрозділ
                  8.1.10: Управління QueryParams</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.1.11"  class="Link">Підрозділ
                  8.1.11: Виконання поєднань трохи дружнішими</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-8.2"  class="Link">Розділ
                8.2: Допоміжна функціональність</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-8.2.1"  class="Link">Підрозділ
                  8.2.1: Генерація відображень</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.2.2"  class="Link">Підрозділ
                  8.2.2: Генерація форм</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.2.3"  class="Link">Підрозділ
                  8.2.3: Валідація</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.2.4"  class="Link">Підрозділ
                  8.2.4: Підтримка CRUD</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.2.5"  class="Link">Підрозділ
                  8.2.5: Зворотні виклики життєвого циклу</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.2.6"  class="Link">Підрозділ
                  8.2.6: Базові типи полів</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.2.7"  class="Link">Підрозділ
                  8.2.7: Визначення власних полів типів в Mapper</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.2.8"  class="Link">Підрозділ
                  8.2.8: ProtoUser та MegaProtoUser</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-8.3"  class="Link">Розділ
                8.3: Просунуті можливості</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-8.3.1"  class="Link">Підрозділ
                  8.3.1: Використання декількох баз даних</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.3.2"  class="Link">Підрозділ
                  8.3.2: Шардінг баз даних</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-8.3.3"  class="Link">Підрозділ
                  8.3.3: SQL-базовані запити</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-8.4"  class="Link">Розділ
                8.4: Журналювання</a> </div>
            <div  class="toc"> <a  href="#toc-Section-8.5"  class="Link">Розділ
                8.5: Підсумок </a> </div>
          </div>
        </div>
        <div  class="toc"> <a  href="#toc-Part-II"  class="Link">Part
            II: Просунуті теми</a> </div>
        <div  class="tocindent">
          <div  class="toc"> <a  href="#toc-Chapter-9"  class="Link">Глава
              9: Просунута архітектура Lift</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-9.1"  class="Link">Розділ
                9.1: Архітектурний огляд</a> </div>
            <div  class="toc"> <a  href="#toc-Section-9.2"  class="Link">Розділ
                9.2: Життєвий цикл запит/відповідь</a> </div>
            <div  class="toc"> <a  href="#toc-Section-9.3"  class="Link">Розділ
                9.3: Відображення функцій Lift</a> </div>
            <div  class="toc"> <a  href="#toc-Section-9.4"  class="Link">Розділ
                9.4: LiftResponse в деталях</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-9.4.1"  class="Link">Підрозділ
                  9.4.1: InMemoryResponse</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.4.2"  class="Link">Підрозділ
                  9.4.2: StreamingResponse</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.4.3"  class="Link">Підрозділ
                  9.4.3: Hierarchy</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.4.4"  class="Link">Підрозділ
                  9.4.4: RedirectWithState</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.4.5"  class="Link">Підрозділ
                  9.4.5: XmlResponse</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-9.5"  class="Link">Розділ
                9.5: Керування сесіями</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-9.5.1"  class="Link">Підрозділ
                  9.5.1: Збір сміття Lift</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-9.6"  class="Link">Розділ
                9.6: Різноманітні можливості Lift</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-9.6.1"  class="Link">Підрозділ
                  9.6.1: Огортання логіки обробки Lift</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.6.2"  class="Link">Підрозділ
                  9.6.2: Передача параметрів шаблону в фрагменти</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.6.3"  class="Link">Підрозділ
                  9.6.3: Обчислення атрибутів за допомогою фрагментів</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.6.4"  class="Link">Підрозділ
                  9.6.4: Обробка атрибутів елементів</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-9.7"  class="Link">Розділ
                9.7: Просунуті можливості об'єкту S</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-9.7.1"  class="Link">Підрозділ
                  9.7.1: Управління cookies</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.7.2"  class="Link">Підрозділ
                  9.7.2: Локалізація та інтернаціоналізація</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.7.3"  class="Link">Підрозділ
                  9.7.3: Управліня часовими поясами</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.7.4"  class="Link">Підрозділ
                  9.7.4: По-сесійні функції DispatchPF</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.7.5"  class="Link">Підрозділ
                  9.7.5: Переписувачі сесій</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.7.6"  class="Link">Підрозділ
                  9.7.6: Доступ до заголовків HTTP</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.7.7"  class="Link">Підрозділ
                  9.7.7: Управління типом документу</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.7.8"  class="Link">Підрозділ
                  9.7.8: Інші функції</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-9.8"  class="Link">Розділ
                9.8: ResourceServer</a> </div>
            <div  class="toc"> <a  href="#toc-Section-9.9"  class="Link">Розділ
                9.9: HTTP аутентифікація</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-9.9.1"  class="Link">Підрозділ
                  9.9.1: Визначення, які ресурси захищати</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.9.2"  class="Link">Підрозділ
                  9.9.2: Провадження перехоплювача аутентифікації</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-9.9.3"  class="Link">Підрозділ
                  9.9.3: Ієрархія ролей</a> </div>
            </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-10"  class="Link">Глава
              10: Lift та JavaScript</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-10.1"  class="Link">Розділ
                10.1: Вищі рівні абстракції JavaScript</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-10.1.1"  class="Link">Підрозділ
                  10.1.1: Огляд JsCmd та JsExp</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-10.1.2"  class="Link">Підрозділ
                  10.1.2: Приклади абстракцій JavaScript</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-10.2"  class="Link">Розділ
                10.2: JQuery та інші фреймворки JavaScript</a> </div>
            <div  class="toc"> <a  href="#toc-Section-10.3"  class="Link">Розділ
                10.3: XML та JavaScript</a> </div>
            <div  class="toc"> <a  href="#toc-Section-10.4"  class="Link">Розділ
                10.4: JSON</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-10.4.1"  class="Link">Підрозділ
                  10.4.1: Форми JSON</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-10.5"  class="Link">Розділ
                10.5: Об'єкт JqSHtml</a> </div>
            <div  class="toc"> <a  href="#toc-Section-10.6"  class="Link">Розділ
                10.6: Повторення</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-11"  class="Link">Глава
              11: AJAX та Comet в Lift</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-11.1"  class="Link">Розділ
                11.1: Що таке AJAX та Comet, насправді?</a> </div>
            <div  class="toc"> <a  href="#toc-Section-11.2"  class="Link">Розділ
                11.2: Використання JAX в Lift</a> </div>
            <div  class="toc"> <a  href="#toc-Section-11.3"  class="Link">Розділ
                11.3: Більш складний приклад AJAX</a> </div>
            <div  class="toc"> <a  href="#toc-Section-11.4"  class="Link">Розділ
                11.4: AJAX генератори в деталях</a> </div>
            <div  class="toc"> <a  href="#toc-Section-11.5"  class="Link">Розділ
                11.5: Comet та Lift</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-11.5.1"  class="Link">Підрозділ
                  11.5.1: Актори в Scala</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-11.5.2"  class="Link">Підрозділ
                  11.5.2: Побудова застосування Comet в Lift</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-11.6"  class="Link">Розділ
                11.6: Координація між декількома клієнтами Comet</a> </div>
            <div  class="toc"> <a  href="#toc-Section-11.7"  class="Link">Розділ
                11.7: Підсумок</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-12"  class="Link">Глава
              12: JPA інтеграція</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-12.1"  class="Link">Розділ
                12.1: Вступ до JPA</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-12.1.1"  class="Link">Підрозділ
                  12.1.1: Використання класів сутностей в Scala</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-12.1.2"  class="Link">Підрозділ
                  12.1.2: Використання дескриптора orm.xml</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-12.1.3"  class="Link">Підрозділ
                  12.1.3: Робота з приєднаними та від'єднанимо об'єктами</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-12.2"  class="Link">Розділ
                12.2: Отримання по-сесійного EntityManager</a> </div>
            <div  class="toc"> <a  href="#toc-Section-12.3"  class="Link">Розділ
                12.3: Обробка транзакцій</a> </div>
            <div  class="toc"> <a  href="#toc-Section-12.4"  class="Link">Розділ
                12.4: ScalaEntityManager та ScalaQuery</a> </div>
            <div  class="toc"> <a  href="#toc-Section-12.5"  class="Link">Розділ
                12.5: Оперування сутностями</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-12.5.1"  class="Link">Підрозділ
                  12.5.1: Зберігання, злиття та видалення сутностей</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-12.5.2"  class="Link">Підрозділ
                  12.5.2: Завантаження сутності</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-12.5.3"  class="Link">Підрозділ
                  12.5.3: Завантаження декількох сутностей</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-12.5.4"  class="Link">Підрозділ
                  12.5.4: Розумне використання запитів</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-12.5.5"  class="Link">Підрозділ
                  12.5.5: Перетворення властивостей колекцій</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-12.5.6"  class="Link">Підрозділ
                  12.5.6: Важливість flush() та виключень</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-12.5.7"  class="Link">Підрозділ
                  12.5.7: Валідація сутностей</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-12.6"  class="Link">Розділ
                12.6: Підтримка користувацьких типів</a> </div>
            <div  class="toc"> <a  href="#toc-Section-12.7"  class="Link">Розділ
                12.7: Виконання застосування</a> </div>
            <div  class="toc"> <a  href="#toc-Section-12.8"  class="Link">Розділ
                12.8: Сумуючи докупи</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-13"  class="Link">Глава
              13: Інтеграція з третіми сторонами</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-13.1"  class="Link">Розділ
                13.1: Інтеграція OpenID</a> </div>
            <div  class="toc"> <a  href="#toc-Section-13.2"  class="Link">Розділ
                13.2: AMQP </a> </div>
            <div  class="toc"> <a  href="#toc-Section-13.3"  class="Link">Розділ
                13.3: PayPal</a> </div>
            <div  class="toc"> <a  href="#toc-Section-13.4"  class="Link">Розділ
                13.4: Facebook</a> </div>
            <div  class="toc"> <a  href="#toc-Section-13.5"  class="Link">Розділ
                13.5: XMPP</a> </div>
            <div  class="toc"> <a  href="#toc-Section-13.6"  class="Link">Розділ
                13.6: Інтеграція з Lucene/Compass</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-14"  class="Link">Глава
              14: Віджети Lift </a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-14.1"  class="Link">Розділ
                14.1: Поточні віджети Lift</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-14.1.1"  class="Link">Підрозділ
                  14.1.1: Віджет TableSorter</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-14.1.2"  class="Link">Підрозділ
                  14.1.2: Віджети Calendar</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-14.1.3"  class="Link">Підрозділ
                  14.1.3: Віджет потоку RSS</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-14.1.4"  class="Link">Підрозділ
                  14.1.4: Віджет Gravatar</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-14.1.5"  class="Link">Підрозділ
                  14.1.5: Віджет TreeView</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-14.1.6"  class="Link">Підрозділ
                  14.1.6: Віджет Sparklines</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-14.2"  class="Link">Розділ
                14.2: Як побудувати віджет</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Chapter-15"  class="Link">Глава
              15: RESTful веб сервіси</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-15.1"  class="Link">Розділ
                15.1: Деяке підгрунтя REST</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-15.1.1"  class="Link">Підрозділ
                  15.1.1: Трохи більше про HTTP</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-15.1.2"  class="Link">Підрозділ
                  15.1.2: Визначення REST</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-15.1.3"  class="Link">Підрозділ
                  15.1.3: Порівняння архітектур XML-RPC з REST </a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-15.2"  class="Link">Розділ
                15.2: Простий API для PocketChange</a> </div>
            <div  class="toc"> <a  href="#toc-Section-15.3"  class="Link">Розділ
                15.3: Додавання допоміжних методів REST до наших сутностей</a> </div>
            <div  class="toc"> <a  href="#toc-Section-15.4"  class="Link">Розділ
                15.4: Декілька підходів до обробки REST</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-15.4.1"  class="Link">Підрозділ
                  15.4.1: Використання власної відправки</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-15.4.2"  class="Link">Підрозділ
                  15.4.2: Використання трейта RestHelper</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-15.5"  class="Link">Розділ
                15.5: Обробка PUT</a> </div>
            <div  class="toc"> <a  href="#toc-Section-15.6"  class="Link">Розділ
                15.6: Цикли запиту та відповіді для нашого API</a> </div>
            <div  class="toc"> <a  href="#toc-Section-15.7"  class="Link">Розділ
                15.7: Розширення API для повернення потоків Atom</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-15.7.1"  class="Link">Підрозділ
                  15.7.1: Приклад запиту Atom</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-15.7.2"  class="Link">Підрозділ
                  15.7.2: Додавання тегу потоку до сторінки разунку</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-15.8"  class="Link">Розділ
                15.8: Висновок</a> </div>
          </div>
        </div>
        <div  class="toc"> <a  href="#toc-Part-III"  class="Link">Part
            III: Додатки</a> </div>
        <div  class="tocindent">
          <div  class="toc"> <a  href="#toc-Appendix-A"  class="Link">Appendix
              A: Короткий тур по Maven</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-A.1"  class="Link">Розділ
                A.1: Що таке Maven?</a> </div>
            <div  class="toc"> <a  href="#toc-Section-A.2"  class="Link">Розділ
                A.2: Життєви цикли, фази та цілі</a> </div>
            <div  class="toc"> <a  href="#toc-Section-A.3"  class="Link">Розділ
                A.3: Репозитарії</a> </div>
            <div  class="toc"> <a  href="#toc-Section-A.4"  class="Link">Розділ
                A.4: Плагіни</a> </div>
            <div  class="toc"> <a  href="#toc-Section-A.5"  class="Link">Розділ
                A.5: Залежності</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-A.5.1"  class="Link">Підрозділ
                  A.5.1: Додавання залежності</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-A.6"  class="Link">Розділ
                A.6: Подальші ресурси</a> </div>
            <div  class="toc"> <a  href="#toc-Section-A.7"  class="Link">Розділ
                A.7: Обрис проекту</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Appendix-B"  class="Link">Appendix
              B: Обробка повідомлень</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-B.1"  class="Link">Розділ
                B.1: Надсилання повідомлень</a> </div>
            <div  class="toc"> <a  href="#toc-Section-B.2"  class="Link">Розділ
                B.2: Відображення повідомлень</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Appendix-C"  class="Link">Appendix
              C: Lift допоміжники</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-C.1"  class="Link">Розділ
                C.1: Вступ</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.2"  class="Link">Розділ
                C.2: Box (або клас Scala Option не стероїдах)</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.3"  class="Link">Розділ
                C.3: ActorPing</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.4"  class="Link">Розділ
                C.4: ClassHelpers</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.5"  class="Link">Розділ
                C.5: CodeHelpers</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.6"  class="Link">Розділ
                C.6: ControlHelpers</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.7"  class="Link">Розділ
                C.7: CSSHelpers</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.8"  class="Link">Розділ
                C.8: BindHelpers</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.9"  class="Link">Розділ
                C.9: HttpHelpers</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.10"  class="Link">Розділ
                C.10: JSON</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.11"  class="Link">Розділ
                C.11: LD</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.12"  class="Link">Розділ
                C.12: ListHelpers</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.13"  class="Link">Розділ
                C.13: NamedPartialFunctions</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.14"  class="Link">Розділ
                C.14: SecurityHelpers</a> </div>
            <div  class="toc"> <a  href="#toc-Section-C.15"  class="Link">Розділ
                C.15: TimeHelpers</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Appendix-D"  class="Link">Appendix
              D: Інтернаціоналізація</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-D.1"  class="Link">Розділ
                D.1: Локалізовані шаблони</a> </div>
            <div  class="toc"> <a  href="#toc-Section-D.2"  class="Link">Розділ
                D.2: Пакунки ресурсів</a> </div>
            <div  class="toc"> <a  href="#toc-Section-D.3"  class="Link">Розділ
                D.3: Важливе зауваження щодо розрішення ресурсних пакунків</a> </div>
            <div  class="toc"> <a  href="#toc-Section-D.4"  class="Link">Розділ
                D.4: Локалізовані рядки в коді Scala</a> </div>
            <div  class="toc"> <a  href="#toc-Section-D.5"  class="Link">Розділ
                D.5: Форматування локалізованих рядків</a> </div>
            <div  class="toc"> <a  href="#toc-Section-D.6"  class="Link">Розділ
                D.6: Локалізовані рядки в шаблонах</a> </div>
            <div  class="toc"> <a  href="#toc-Section-D.7"  class="Link">Розділ
                D.7: Обчислення локалі</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Appendix-E"  class="Link">Appendix
              E: Журналювання в Lift</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-E.1"  class="Link">Розділ
                E.1: Підвалини журналювання</a> </div>
            <div  class="toc"> <a  href="#toc-Section-E.2"  class="Link">Розділ
                E.2: Базове журналювання</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-E.2.1"  class="Link">Підрозділ
                  E.2.1: Встановка журналювання</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-E.2.2"  class="Link">Підрозділ
                  E.2.2: Отримання Logger</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-E.2.3"  class="Link">Підрозділ
                  E.2.3: Методи журналювання</a> </div>
            </div>
            <div  class="toc"> <a  href="#toc-Section-E.3"  class="Link">Розділ
                E.3: Захісники рівня журналу</a> </div>
            <div  class="toc"> <a  href="#toc-Section-E.4"  class="Link">Розділ
                E.4: Запити журнального відображення</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Appendix-F"  class="Link">Appendix
              F: Надсилання пошти</a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-F.1"  class="Link">Розділ
                F.1: Встановлення</a> </div>
            <div  class="toc"> <a  href="#toc-Section-F.2"  class="Link">Розділ
                F.2: Надсилання пошти</a> </div>
          </div>
          <div  class="toc"> <a  href="#toc-Appendix-G"  class="Link">Appendix
              G: Лістинги коду JPA </a> </div>
          <div  class="tocindent">
            <div  class="toc"> <a  href="#toc-Section-G.1"  class="Link">Розділ
                G.1: Демо бібліотека JPA</a> </div>
            <div  class="tocindent">
              <div  class="toc"> <a  href="#toc-Subsection-G.1.1"  class="Link">Підрозділ
                  G.1.1: Сутність Author</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-G.1.2"  class="Link">Підрозділ
                  G.1.2: Відображення orm.xml</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-G.1.3"  class="Link">Підрозділ
                  G.1.3: Трейт Enumv</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-G.1.4"  class="Link">Підрозділ
                  G.1.4: EnumerationType</a> </div>
              <div  class="toc"> <a  href="#toc-Subsection-G.1.5"  class="Link">Підрозділ
                  G.1.5: JPA web.xml</a> </div>
            </div>
          </div>
        </div>
        <div  class="toc"> <a  href="#Index"  class="Link">Індекс</a> </div>
      </div>
      <div  class="fulltoc">
        <div  class="tocheader">Перелік малюнків</div>
        <div  class="toc"> <a  href="#Figure-2.1"  class="Link">Малюнок
            2.1: Застосування PocketChange</a> </div>
        <div  class="toc"> <a  href="#fig:Architecture-diagram"  class="Link">Малюнок
            9.1: Архітектура</a> </div>
        <div  class="toc"> <a  href="#Figure-9.2"  class="Link">Малюнок
            9.2: Глобальна обробка запиту </a> </div>
        <div  class="toc"> <a  href="#Figure-9.3"  class="Link">Малюнок
            9.3: Обробки запиту HTTP в </a><a  href="#Figure-9.3"  class="Link">Lift
            </a> </div>
        <div  class="toc"> <a  href="#fig:Roles-hierarchy-example"  class="Link">Малюнок
            9.4: Приклад ієрархії ролей</a> </div>
        <div  class="toc"> <a  href="#fig:model-comparisons"  class="Link">Малюнок
            11.1: Порівняння моделі застосування</a> </div>
        <div  class="toc"> <a  href="#Figure-14.1"  class="Link">Малюнок
            14.1: Віджет TableSorter</a> </div>
        <div  class="toc"> <a  href="#Figure-14.2"  class="Link">Малюнок
            14.2: Календар Month-View</a> </div>
        <div  class="toc"> <a  href="#Figure-14.3"  class="Link">Малюнок
            14.3: Календар Week-View</a> </div>
        <div  class="toc"> <a  href="#Figure-14.4"  class="Link">Малюнок
            14.4: Календар Day-View </a> </div>
        <div  class="toc"> <a  href="#Figure-14.5"  class="Link">Малюнок
            14.5: Віджет RSSFeed</a> </div>
        <div  class="toc"> <a  href="#fig:TreeView-widget"  class="Link">Малюнок
            14.6: Віджет TreeView</a> </div>
        <div  class="toc"> <a  href="#fig:Sparklines-bar-chart"  class="Link">Малюнок
            14.7: Стовбчаста діаграма Sparklines</a> </div>
      </div>
      <h1  class="Chapter-"> <a  name="toc-Chapter--1"  class="toc"></a>Присвячення
        </h1>
      <div  class="Unindented"> Derek хоче подякувати своїй жинці, Debbie, за її
        терпіння та підтримку під час написання цієї книжки. Він також хоче
        подякувати своїм двом синам, Dylan та Dean, за те, що підтримують речі
        цикавими та в перспективі.<br />
      </div>
      <div  class="Indented"> Tyler хоче подякувати жінці, Laura, за те що
        надихала його.<br />
      </div>
      <div  class="Indented"> Marius бажає подякувати його жінці, Alina, за її
        терплячість на протязі довгих вихідних, та мирилась з його односкладними
        відповідями на протязі роботи над цією книгою. </div>
      <h1  class="Chapter-"> <a  name="toc-Chapter--2"  class="toc"></a>Подяки</h1>
      <div  class="Unindented"> Ця книга не була б можливою без розробників Lift
        и особливо David Pollak: без його в нас не було б такої можливості. </div>
      <div  class="Indented">Нам також приємно подякувати спільноту Lift, так
        само, як наступних особистостей за значний внесок в вміст цієї книги:
        Adam Cimarosti, Malcolm Gorman, Doug Holton, Hunter Kelly, James Matlik,
        Larry Morroni, Jorge Ortiz, Tim Perrett, Tim Pigden, Dennis Przytarski,
        Thomas Sant Ana, Heiko Seeberger та Eric Willigers. </div>
      <div  class="Indented">Величезна подяка Charles Munat за редагування цієї
        роботи, та до Tim Perrett за допомогу з REST API в Главі 13. </div>
      <h1  class="Part"> <a  name="toc-Part-I"  class="toc">Частина I.</a> 
        Основи</h1>
      <div  class="Unindented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-1"  class="toc">1</a> Ласкаво
        просимо до Lift!<a  name="cha:Welcome-to-Lift!"  class="Label"> </a> </h1>
      <div  class="Unindented">Ласкаво просимо до <i>Дослідження Lift</i>. Ми
        створили цю книгу щоб просвітити вас щодо Lift, що, як ми вважаємо, є
        чудовим фреймворком для побудови конкурентноздатних веб застосувань. 
        Lift розроблений для того, щоб потужні технології зробити просто
        доступними, при цьому підтримуючи загальний фреймворк простим та
        гнучким. Це може здаватись як клише, але наш досвід роботи з Lift робить
        розробку приємною, оскільки він дозволяє сфокусуватись на цікавих частях
        кодування. Наша ціль для цієї книги кінець кінцем в тому, щоб ви були
        здатні та розвинути любе веб застосування, про які ви тільки можете
        подумати. </div>
      <h2  class="Section"> <a  name="toc-Section-1.1"  class="toc">1.1</a> 
        Чому Lift? </h2>
      <div  class="Unindented">Для тих з вас, хто має досвід з іншими веб
        фреймворками, такими як Struts, Tapestry, Rails, і так далі, ви можете
        спитати себе, "Чому інший фреймворк? Чи Lift насправді вирішує проблеми
        інакше, або більш ефективно, ніж ті, що я використовував раніше?"
        Базуючись на нашому досвіді (та інших в зростаючій Lift спільноті),
        відповідь виразна, "Так!", Lift зібрав кращі ідеї з числа інших
        фреймворків, при цьому маючи власні іновативні ідеї. Це та комбінаія
        солідного підгрунтя та нових технолоній, що робить Lift таким потужним.
        В той же час, Lift зміг уникнути помилок, що робили в минулому інші
        фреймворки. В дусі “домовленості вище конфігурації”, Lift має розумні
        замовчання для всього, при цьому роблячи простим налаштування саме того,
        що вам треба: не більше і не менше. Пішли часа файлу XML після іншого
        файла XML, що провадять <i>базову конфігурацію</i> для вашого
        застосування. Замість цього, просте застосування на Lift потребує тільки
        додати LiftFilter до вашого web.xml, та додати один або більше рядків,
        що кажуть  Lift, в якому пакунку знаходиться ваші класи (Розділ <a  href="#sec:Bootstrap"
           class="Reference">3.2↓</a>). Методи, що ви кодуєте, не потрібні для
        реалізації специфічних інтерфейсів (що називаються трейтами), хоча є
        трейти підтримки, що роблять речі значно-значно простішими. Коротко
        кажучи, вам не треба нічого писати,  що напряму не вимагається для
        вирішуваної задачі. Lift призначений для роботи прямо з коробки, та щоб
        зробити вас таким ефективним та продуктивним, наскільки це можливо. </div>
      <div  class="Indented">Одним з ключових сильних сторін Lift є ясне
        розділення презентації вмісту та логіки, базуючись на твердій
        концепції-шаблону  Model-View-Controller<a  href="#index-MVC"  name="entry-MVC-0"
           class="IndexReference">↓</a><span  class="FootOuter"><span  class="SupFootMarker">[A]
             </span><span  class="HoverFoot"><span  class="SupFootMarker">  [A] </span><a
               href="http://java.sun.com/blueprints/patterns/MVC.html"  class="FlexURL">http://java.sun.com/blueprints/patterns/MVC.html</a></span></span>.
        Одна з оригінальних технологій Java веб застосувань, що доки
        використовується, є JSP, або Java Server Pages<span  class="FootOuter"><span
             class="SupFootMarker">  [B] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [B] </span><a  href="http://java.sun.com/products/jsp/"  class="FlexURL">http://java.sun.com/products/jsp/</a></span></span>.
        JSP дозволяє вам змішувати HTML та код Java напряму на сторінці. Хоча це
        спочатку може здатись за гарну ідею, на практиці це болюче. Покладати
        код на ваш рівень презентації ускладнює налаштування, та розуміння, що
        має відбуватись на сторінці, та робить більш складним для людей, що
        пишуть HTML частину, бо вміст не є валідним HTML. Хоча багато сучасних
        програмувацьких та HTML редакторів були модифіковані, щоб вміщати цю
        кашу, правильна підсвітка синтаксису та валідація не допомагають від
        переходу вперед та назад по одному або більше файлам, щоб слідувати за
        ходом сторінки. Lift приймає підхід, що на рівні презентації не повинно
        бути коду, та що рівень презентації має бути досить гнучким, щоб
        вміщувати любе можливе використання. З цього боку Lift використовує
        потужну систему шаблонів, à la Wicket<span  class="FootOuter"><span  class="SupFootMarker"> 
            [C] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [C] </span><a  href="http://wicket.apache.org/"  class="FlexURL">http://wicket.apache.org/</a></span></span>,
        щоб вбудовувати згенеровані користувачем дані на рівень презентації.
        Шаблони Lift побудований на обробці XML можливостей мови Scala<span  class="FootOuter"><span
             class="SupFootMarker">[D] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [D] Не тільки </span>Scala має екстенсивну підтримку бібліотеки
            для XML, але синтаксис XML насправді є частиною мови. Ми розглянемо
            це більш детально, коли ми дійдемо до цього</span></span>, та
        дозволяє такі речі, як вкладені шаблони, просте введення згенерованого
        користувачем вмісту, та покращені можливості прикріплення даних. Для
        тих, хто прийшов з JSP, покращені шаблони Lift та обробка XML дозволяє
        вам просто писати власні бібліотеки тегів, витрачаючи тільки частину
        часу та зусиль.</div>
      <div  class="Indented"> Lift має інші переваги над багатьма іншими веб
        фреймворками: він розроблений спеціально для використання мови
        програмування Scala<a  href="#index-Scala"  name="entry-Scala-0"  class="IndexReference">↓</a>.
        Scala є відносно новою мовою програмування, розроблений Martin Odersky<span
           class="FootOuter"><span  class="SupFootMarker"> [E] </span><span  class="HoverFoot"><span
               class="SupFootMarker"> [E] </span>Martin створив мову
            програмування Pizza, що призвело до проекту Generic Java (GJ), що
            був вбудований в Java 1.5. Його домашня сторінка  <a  href="http://lamp.epfl.ch/%7Eodersky/"
               class="FlexURL">http://lamp.epfl.ch/~odersky/</a></span></span>
        та його група вивчення мов програмування на EPFL Switzerland. Scala
        компілюється в байткод Java та виконується на JVM, що означає, що ви
        можете задіяти екосистему Java бібліотек, так як можете з любим іншим
        веб фреймворком Java. В той же час Scala вводить дуже потужні
        можливості, розроблені щоб зробити вас, розробників, більш
        продуктивними. Серед ціх можливостей є екстремально багата система
        типів, разом з потужним виводом типів, природна обробка XML, повна
        підтримка для замикань та функцій як об'єктів, та екстенсивна
        високорівнева бібліотека. Потужність системи типів, разом з виводом
        типів, привело до того, люди називають Scala “статично-типована
        динамічна мова”<span  class="FootOuter"><span  class="SupFootMarker"> 
            [F] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [F] </span><a  href="http://scala-blogs.org/2007/12/scala-statically-typed-dynamic-language.html"
               class="FlexURL">http://scala-blogs.org/2007/12/scala-statically-typed-dynamic-language.html</a></span></span>.
        Це означає, що ви пишете код так швидко, як ви можете з динамічно
        типізованими мовами (як Python, Ruby, etc.), але ви маєте безпеку типів
        часу компіляції, як в Java. Scala є також гибридною мовою
        функуціонально-програмування (FP) та об'єктно-орієнтованою мовою (OO),
        що означає, що в ви можете отримати потужність високорівневних
        функціональних мов, таких як Haskell або Scheme, при цьому зберігаючи
        модульність та повторне використання OO компонентів. Зокрема, концепція
        FP незмінності заохочується в Scala, що гарно підходить для написання
        високо-конкурентних програм, які досягають високої пропускної здатності.
        Гібридна модель також означає, що якщо ви не торкались до FP до цього,
        ви можете поступово наближатись до цього. За нашим досвідом, Scala
        дозволяє вам робити більше в Lift за допомогою меньшого числа рядів
        коду. Пам'ятайте, що Lift повністю про те, щоб зробити вас більш
        продуктивним! </div>
      <div  class="Indented"> Lift намагається охопити можливості в дуже
        компактній та прямолінійній манері. Потужна підтримка AJAX та Comet в
        Lift дозволяє вам використовувати можливості Web 2.0 з дуже невеликими
        зусиллями. Lift використовує бібліотеку Scala Actor, щоб провадити
        рушійний повідомленнями фреймворк для оновлень Comet. В більшості
        випадків, додавання підтримки Comet до сторінки потребує не більше, ніж
        розширити трейт<span  class="FootOuter"><span  class="SupFootMarker">[G]
             </span><span  class="HoverFoot"><span  class="SupFootMarker">  [G] </span>
            Трейт є конструкцією Scala, що майже схоже на інтерфейс Java.
            Головна різниця в тому, що трейти можуть реалізовати методи та мати
            поля, щоб визначати метод відтворення вашої сторінки, та додавання
            додаткового виклику функції до ваших посилань, щоб направляти
            повідомлення оновлення</span></span>. Lift обробляє все кодування
        бек-енд та на сторінці, щоб провадити опит Comet. Підтримка AJAX включає
        особливі обробники для виконання підписання форм AJAX через JSON, і
        майже кожна функція посилання може просто бути перетворена в версію AJAX
        в декілька торкань. Щоб виконати всі ці дива на стороні клієнта, Lift
        має ієрархію класів для інкапсуляції викликов JavaScript через
        JavaScript, jQuery, та YUI. Мила частина в тому, що ви також можете
        задіяти ці класи, так що код може бути згенерований для вас, та вам не
        потрібно класти логіку JavaScript в ваші шаблони. </div>
      <h2  class="Section"> <a  name="toc-Section-1.2"  class="toc">1.2</a>  Що
        потрібно знати перед початком</h2>
      <div  class="Unindented">Перше і головне, це книга про фреймворк Lift. Є
        декілька речей, що ми очікуємо знання від вас, перед тим, як
        продовжувати: </div>
      <ul>
        <li> Мова Scala та стандартна бібліотека. Ця книга не призначена бути
          вступом в Scala: є декілька дуже гарних книжок, що гідні цієї ролі. Ви
          можете знайти список книжок Scala на сайті Scala, <a  href="http://www.scala-lang.org/node/959"
             class="URL">http://www.scala-lang.org/node/959</a>. </li>
        <li> HTML та XML. Lift значною мірою покладається на XHTML для підтримки
          шаблонів, так що вам слідує розуміти такі речі, як  DocTypes,
          елементи, атрибути та простори імен.</li>
        <li>Загальна обробка HTTP, включаючи надсилання GET та POST, коди
          відповіді, та типи вмісту. </li>
      </ul>
      <h2  class="Section"> <a  name="toc-Section-1.3"  class="toc">1.3</a> 
        Типографічні домовленості</h2>
      <div  class="Unindented">Щоб краще обмінюватись концепціями та прийомами в
        цій книзі, ми адоптували наступні типографічні домовленості: </div>
      <div  class="List"> <code><samp><span  class="List-entry">ClassName</span></samp></code><span
           class="List-contents">Моноширинний текст використовується для
          позначення типів, імена класів, та іншої пов'язаної з кодом
          інформації.</span> </div>
      <div  class="List"> <span  class="List-entry">...</span><span  class="List-contents">Крапки
          в лістингу коду використовуються для індикації пропущеного кода для
          зменшення лістингу. Якщо не вказане інше, приклади коду в цій книзі
          беруться з застосування PocketChange (Глава <a  href="#cha:PocketChange"
             class="Reference">2 на сторінці 1↓</a>), що має повний код,
          доступний на GitHub.</span> </div>
      <h2  class="Section"> <a  name="toc-Section-1.4"  class="toc">1.4</a> 
        Отримання додаткової інформаціїї щодо Lift<a  name="sec:For-more-information"
           class="Label"> </a> </h2>
      <div  class="Unindented"> Lift має дуже активну спільноту користувачів та
        розробників. Починаючи з її створення на початку 2007, спільнота виросла
        до сотен членів по всьому світу. Лідер проекту, David Pollak<span  class="FootOuter"><span
             class="SupFootMarker"> [H] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [H] </span><a  href="http://blog.lostlake.org/"  class="FlexURL">http://blog.lostlake.org/</a></span></span>,
        постійно з'являється в списках розсилки, відповідає на запитання, та
        приймає запити на можливості. Є головна група розробників, хто робить
        над проектом, але доводи приймаються від кожного, хто має гарну
        мотивацію, та може перетворити її на гарний код. Хоча ми намагаємось
        викласти все, що вам треба знати, в цій книзі, є декілька додаткових
        ресурсів, доступних як джерело інформації щодо Lift: </div>
      <ol>
        <li>Перше місце, де треба шукати, це веб сайт Lift на <a  href="http://liftweb.net/"
             class="FlexURL">http://liftweb.net/</a>. Є посилання на безліч
          інформації на сайті. Зокрема:
          <ol>
            <li> Lift Wiki розташований на <a  href="http://www.assembla.com/wiki/show/liftweb"
                 class="FlexURL">http://www.assembla.com/wiki/show/liftweb</a>.
              Wiki підтримує не тільки David, але також багато активних членів
              спільноти Lift, включаючи авторів. Частини книги надихнуті та
              позичені зі вмісту Wiki. Зокрема, там є посилання на всю
              згенеровану документацію, не тільки для стабільної гілки, але
              також для нестабільшої голови, якщо ви відчуваєте себе готовим до
              пригод. Є також екстенсивний розділ HowTo та статті по просунутим
              темам, що охоплюють значний обсяг інформації. </li>
            <li>Список розсилки <a  href="http://groups.google.com/group/liftweb"
                 class="FlexURL">http://groups.google.com/group/liftweb</a> дуже
              активний, та якщо є речі, що не викладені в цій книзі, ви можете
              почуватись вільно запитувати питання там. Є багато дуже розумних
              людей, що можуть відповісти на ваші питання. Будь ласка,
              публікуйте окремі питання щодо книги до Lift Book Google Group на
              <a  href="http://groups.google.com/group/the-lift-book"  class="FlexURL">http://groups.google.com/group/the-lift-book</a>.
              Будь-що інше, специфічне до Lift є чесною грою для списку
              розсилки. </li>
          </ol>
        </li>
        <li> Tim Perrett, інший комітер Lift, пише книгу про Lift для Manning,
          що називається <i>Lift in Action</i>. Більше подробиць може бути
          знайдено на сайті сторінки <a  href="http://www.manning.com/perrett/"
             class="FlexURL">http://www.manning.com/perrett/</a>. </li>
        <li> Lift має канал IRC на <a  href="irc://irc.freenode.net/lift"  class="FlexURL">irc://irc.freenode.net/lift</a>,
          що звичайно має декілька людей в кожний окремий момент. Це чудове
          місце для балачок щодо проблем та ідей навколо Lift. </li>
      </ol>
      <h2  class="Section"> <a  name="toc-Section-1.5"  class="toc">1.5</a> 
        Ваше перше застосування Lift </h2>
      <div  class="Unindented"> Ми казали багато про Lift та його можливості,
        так що тепер докладемо зусиль, та спробуємо створити застосування. Однак
        перед тим, як ми почнемо, ним треба потурбуватись про попередні вимоги:
      </div>
      <div  class="Description"> <span  class="Description-entry">Java 1.5 JDK</span> 
        Lift виконується на Scala, що робить на which runs JVM. Перша річ, що
        вам треба встановити, це сучасна версія Java SE JVM, доступна на <a  href="http://java.sun.com/"
           class="FlexURL">http://java.sun.com/</a>. Останні компілятори Scala
        змінили цільову версію Java на 1.5. Версія 1.4 все що доступна в цій
        якості, але ми будемо вважати, що ви використовуєте 1.5. Приклади в цій
        книзі були протестовані з версією Sun JDK, хоча більшість інших версій
        (як Blackdown або OpenJDK) повинні також робити, без, або з
        мінімальними, змінами. </div>
      <div  class="Description"> <span  class="Description-entry">Maven 2</span> 
        Maven<a  href="#index-Maven"  name="entry-Maven-0"  class="IndexReference">↓</a>
        є інструмент керування проектами, що має екстенсивні можливості для
        побудови, управління залежностями, тестування та звітності. Ми очікуємо,
        що ви знайомі з основним застосуванням Maven для компіляції, пакування
        та тестування. Якщо ви не використовували Maven перед цім, ви можете
        отримати короткий огляд в додатку <a  href="#cha:Maven"  class="Reference">A↓</a>.
        Ви можете завантажити останню версію Maven з <a  href="http://maven.apache.org/"
           class="FlexURL">http://maven.apache.org/</a>. Короткі інструкції по
        встановленню (досить, як для початку) є на сторінці завантаження <a  href="http://maven.apache.org/download.html"
           class="FlexURL">http://maven.apache.org/download.html</a>. </div>
      <div  class="Description"> <span  class="Description-entry">Програмний
          редкатор</span>  Це не є жорсткою вимогою для цього прикладу, але ми
        почнемо кодувати, дуже корисно мати щось більше придатне, ніж Notepad.
        Якщо ви бажаєте повнофункціональну IDE, з підтримкою таких речей, як
        налаштування, постійна перевірка компіляції, таке інше, тоді вас
        зацікавлять плагіна на сайті Scala <a  href="http://www.scala-lang.org/node/91"
           class="FlexURL">http://www.scala-lang.org/node/91</a>. Підтримка
        плагінів: </div>
      <ul>
        <li  class="nested">
          <div  class="List"> <span  class="List-entry">Eclipse</span><span  class="List-contents"><a
                 href="http://www.eclipse.org/"  class="FlexURL">http://www.eclipse.org/</a>
              Розробник Scala Plugin рекомендує використання версію Eclipse
              Classic IDE</span> </div>
          <div  class="List"> <span  class="List-entry">NetBeans</span><span  class="List-contents"><a
                 href="http://www.netbeans.org/"  class="FlexURL">http://www.netbeans.org</a>
              Потребує використання NetBeans 6.5</span> </div>
          <div  class="List"> <span  class="List-entry">IntelliJ</span><span  class="List-contents">IDEA
              <a  href="http://www.jetbrains.com/idea/index.html"  class="FlexURL">http://www.jetbrains.com/idea/index.html</a>
              Потребує версію 8 Beta</span> </div>
          <div  class="Unindented">Якщо вам подобається щось більш легковажне,
            дистрибутив мови Scala іде з плагінами для редакторів, таких як Vim,
            Emacs, jEdit, тощо. Ви можете або завантажити повну дистрибуцію
            Scala з <a  href="http://www.scala-lang.org/"  class="FlexURL">http://www.scala-lang.org/</a>
            та використовувати файли з <code>misc/scala-tool-support</code>,
            або ви можете отримати доступ до останніх версій напряму через
            інтерфейс SVN (Subversion) <a  href="https://lampsvn.epfl.ch/trac/scala/browser/scala-tool-support/trunk/src"
               class="FlexURL">https://lampsvn.epfl.ch/trac/scala/browser/scala-tool-support/trunk/src</a>.
            Отримання цїх плагінів для роботи з вашою IDE або вашому обраному
            редакторі лежить за межами цієї книги. </div>
        </li>
      </ul>
      <div  class="Unindented">Тепер, коли ми маємо передумови, прийшов час
        починати. Ми бажаємо задіяти архитипи Maven <span  class="FootOuter"><span
             class="SupFootMarker">[I] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [I]Архитип, просто кажучи, це шаблон проекту для </span>Maven, що
            провадить налаштування базових атрибутів з командного рядка. Це
            зробить до </span></span> 99% роботи цього прикладу. Перше, змінимо
        каталог до того, де ми бажаємо працювати: </div>
      <pre  class="LyX-Code">cd work
</pre>
      <div  class="Unindented"> Далі використаємо команду Maven <code>archetype:generate</code>
        для створення скелету нашого проекту: </div>
      <pre  class="LyX-Code">mvn archetype:generate -U \
  -DarchetypeGroupId=net.liftweb \
  -DarchetypeArtifactId=lift-archetype-blank \
  -DarchetypeVersion=2.0 \
  -DarchetypeRepository=http://scala-tools.org/repo-releases \
  -DgroupId=demo.helloworld \
  -DartifactId=helloworld \
  -Dversion=1.0-SNAPSHOT
</pre>
      <div  class="Unindented"> Maven повинен вивести декілька сторінок тексту.
        Він має зупинитись, та запитати підтвердити опції конфігурації, в якому
        випадку вам просто треба натиснути <code>&lt;enter&gt;</code>. На кінці
        ви повинні отримати повідомлення, що каже <code>BUILD SUCCESSFUL</code>.
        Тепер ви успішно створили ваш перший проект! Не вірите? Давайте
        виконаємо та переконаємось: </div>
      <pre  class="LyX-Code">cd helloworld
mvn jetty:run
</pre>
      <div  class="Unindented"> Maven має зпродукувати більше тексту, що
        завершується так </div>
      <pre  class="LyX-Code">[INFO] Starting scanner at interval of 5 seconds.
</pre>
      <div  class="Unindented"> Це означає, що тепер ми маємо веб сервер (Jetty<span
           class="FootOuter"><span  class="SupFootMarker"> [J] </span><span  class="HoverFoot"><span
               class="SupFootMarker">  [J] </span><a  href="http://www.mortbay.org/jetty/"
               class="FlexURL">http://www.mortbay.org/jetty/</a></span></span>),
        що виконується на порту 8080 вашої машини. Просто перейдіть на <a  href="http://localhost:8080/"
           class="FlexURL">http://localhost:8080/</a>, і ви побачите вашу першу
        сторінку Lift, стандартний “Hello, world!”. За допомогою всього
        декількох простих команд, ми побудували фунціональне (хоча і обмежене)
        веб застосування. Давайте пройдемо трохи глибше по деталях, та побачимо,
        саме як ці частини пасують одне до одного. Перше, давайте перевіримо
        сторінку index. Коли Lift обслуговує запит, де URL завершується на косу
        лінію, Lift автоматично шукає файл з назвою <code>index.html</code><span
           class="FootOuter"><span  class="SupFootMarker">[K] </span><span  class="HoverFoot"><span
               class="SupFootMarker">  [K] </span>Технічно, він також шукає
            деякі варіації index.html, включаючи любі локалізовані версії
            сторінки, але ми розглянемо це пізніше в розділі в цьому каталозі</span></span>.
        Наприклад, якщо ви спробуєте перейти до <code>http://localhost:8080/test/</code>,
        Lift буде шукати <code>index.html</code> в каталозі  <code>test/</code>
        вашого проекту. Джерела HTML будуть розміщені в <code>src/main/webapp/</code>
        в каталозі вашого проекту. Ось файл <code>index.html</code> з нашого
        проекта Hello World: </div>
      <div  class="Indented">
        <div  class="listing">
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_170829">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
                     href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">h2</code><code  class="xml plain">>Welcome to your project!<!--</code--><code
 class="xml keyword">h2</code><code  class="xml plain">></code></code></div>
                        <code  class="xml plain">
                          <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">p</code><code  class="xml plain">><</code><code
 class="xml keyword">lift:helloWorld.howdy</code> <code  class="xml plain">/><!--</code--><code
 class="xml keyword">p</code><code  class="xml plain">></code></code></div>
                          <code  class="xml plain">
                            <div  class="line number4 index3 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div>
                            <code  class="xml plain"> </code></code></code></div>
                      <code  class="xml plain"><code  class="xml plain"> </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Це може виглядати дивно на перший погляд. Для тих,
        що мають деякий досвід XML, ви можете розпізнати використання префіксних
        елементів. Для тих, хто не знаю знає, що таке префіксні елементи, це
        елемент в формі </div>
      <pre  class="LyX-Code">&lt;prefix:element&gt;
</pre>
      <div  class="Unindented">В нашому випадку ми маємо два елементи : <code>&lt;lift:surround&gt;</code>
        та<br />
        <code> &lt;lift:helloWorld.howdy /&gt;</code>. Lift надає особливого
        значення елементам, що мають префікс “lift”: вони формують базис
        екстенсивної підтримки шаблонів lift, що ми побачимо більш детально в
        розділі <a  href="#sec:Templates"  class="Reference">4.1↓</a>. Коли
        lift обробляє шаблон XML<a  href="#index-template"  name="entry-template-0"
           class="IndexReference">↓</a>, він робить це з найширшого елемента
        всередину. В нашому випадку зовнішній елемент є <code>&lt;lift:surround
          with=”default” at=”content”&gt;</code>. Елемент <code>&lt;lift:surround&gt;</code>
        в основному каже Lift знайти шаблон, що вказаний атрибутом <i>with</i>
        (<i>default</i>, в нашому випадку) та покласти вміст нашого елемента
        всередину цього шаблону. Атрибут <i>at</i> каже Lift де в шаблоні
        покласти наш вміст. В Lift це “заповнення проміжків” називається <i>біндінгом
          (прив'язкою)</i><a  href="#index-binding"  name="entry-binding-0"  class="IndexReference">↓</a>,
        та є фундаментальною конфепцією системи шаблонів Lift. Майже все на
        рівні HTML/XML може розглядатись як вкладені біндінги. Перед тим, як
        перейти до елементу <code>&lt;lift:helloWorld.howdy/&gt;</code>,
        давайте поглянемо на шаблон по замовчанню. Ви можете знайти його в
        каталозі <code>templates-hidden</code> веб застосування. Подібно до <code>WEB-INF</code>
        та <code>META-INF</code> каталоги в веб застосуваннях Java, вміст <code>templates-hidden</code>
        не може бути доступною напряму з боку клієнтів; вони можуть, однак, бути
        доступними, коли воми мають посилання в елементі <code>&lt;lift:surround&gt;</code>.
        Ось вміст файлу <code>default.html</code>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_3483">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
                     href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><code
 class="scala keyword">=</code><code  class="scala string">"<a  href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>"</code> <code
 class="scala plain">xmlns</code><code  class="scala keyword">:</code><code  class="scala plain">lift</code><code
 class="scala keyword">=</code><code  class="scala string">"<a  href="http://liftweb.net/">http://liftweb.net/</a>"</code><code
 class="scala plain">></code></code></div>
                        <code  class="scala plain">
                          <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"></code></div>
                          <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><meta  http-equiv<=""  code="" /><code  class="scala keyword">=</code><code
 class="scala string">"content-type"</code> <code  class="scala plain">content</code><code
 class="scala keyword">=</code><code  class="scala string">"text/html; charset=UTF-8"</code> <code
 class="scala plain">/></code></code></div><code  class="scala plain">
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><meta  name<=""  code="" /><code  class="scala keyword">=</code><code
 class="scala string">"description"</code> <code  class="scala plain">content</code><code
 class="scala keyword">=</code><code  class="scala string">""</code> <code  class="scala plain">/></code></code></div><code
 class="scala plain">
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><meta  name<=""  code="" /><code  class="scala keyword">=</code><code
 class="scala string">"keywords"</code> <code  class="scala plain">content</code><code
 class="scala keyword">=</code><code  class="scala string">""</code> <code  class="scala plain">/></code></code></div><code
 class="scala plain">
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">                </code> </div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><title>demo.helloworld</code><code  class="scala keyword">:</code><code
 class="scala plain">helloworld</code><code  class="scala keyword">:</code><code
 class="scala value">1.0</code><code  class="scala plain">-SNAPSHOT</title></code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><script  id<=""  code=""><code  class="scala keyword">=</code><code
 class="scala string">"jquery"</code> <code  class="scala plain">src</code><code
 class="scala keyword">=</code><code  class="scala string">"/classpath/jquery.js"</code> <code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"text/javascript"</code><code
 class="scala plain">></script></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"></code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">bind name</code><code  class="scala keyword">=</code><code
 class="scala string">"content"</code> <code  class="scala plain">/></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">Menu.builder /></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">msgs/></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"></code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain"></code></div>
                      </code></code></code></code></code></code></code></div><code
 class="scala plain"><code  class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Як ви бачите з цього листингу, це відповідний файл
        XHTML, з тегами <code></code>, <code></code>,
        та <code></code>. Це необхідно, бо Lift не додає їх
        автоматично. Lift просто обробляє XML з кожного шаблона, на який він
        натрапить. Елемент <code></code> та його вміст є заглушкою;
        цікаві речі відбуваються в елементі <code></code>. Тут є
        три елементи: </div>
      <ol>
        <li>Елемент <code><lift:bind  name="”content”"></lift:bind></code> визначає,
          де буде прив'язано (вставлено) вміст нашого файлу <code>index.html</code>.
          Атрибут <i>name</i> повинен співпадати з відповідним атрибутом <i>at</i>
          нашого елемента <code><lift:surround></lift:surround></code>. </li>
        <li>Елемент <code><lift:menu.builder></lift:menu.builder></code>  є спеціальним
          елементом, що будує меню, базуючись на SiteMap<a  href="#index-SiteMap"
 name="entry-SiteMap-0"  class="IndexReference">↓</a> (що буде
          пояснений в главі <a  href="#cha:SiteMap"  class="Reference">7↓</a>).
          SiteMap є високорівневим компонентом директорії сайту, що не тільки
          провадить централізоване місце для визначення меню сайту, але дозволяє
          вам контролювати, коли відображувати окремі посилання (базуючись на,
          скажімо, чи користувач увійшов в систему, та яку роль він має), та
          провадить механізм контроля доступу рівня сторінки. </li>
        <li> Елемент <code><lift:msgs></lift:msgs></code> дозволяє Lift (або вашому
          коду) відображувати повідомлення на сторінці по мірі її відображення.
          Це можуть бути повідомленнями статуса, повідомленнями про помилки,
          тощо. Lift має механізми для встановлення одного або більше повідомлень
          з логіки вашого коду. </li>
      </ol>
      <div  class="Unindented">Тепер давайте подивимось назад на елемент <code><lift:helloworld.howdy></lift:helloworld.howdy></code> з файлу <code>index.html</code>. Цей елемент (та,
        насправді, елемент <code><lift:menu.builder></lift:menu.builder></code>)
        називається <i>фрагментом</i>, та має форму </div>
      <pre  class="LyX-Code"><lift:class.method>
</lift:class.method></pre>
      <div  class="Unindented">Тут <code>class</code> є ім'ям класу Scala,
        визначеним в нашому проекті в пакунку <code>demo.helloworld.snippets</code>
        та <code>method</code> є методом, визначеним в цьому класі. Lift робить
        невелику трансляцію імені файлу, щоб поміняти camel-case назад до
        title-case, та потім шукає клас. В нашому демо клас розташований в <code>src/main/scala/demo/helloworld/snippet/HelloWorld.scala</code>,
        та показаний тут: </div>
      <div  class="Indented">
        <div  class="listing">
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_773448">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">demo.helloworld.snippet</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">HelloWorld {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">howdy </code><code
 class="scala keyword">=</code> <code  class="scala plain"><span>Welcome to helloworld at </span></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">{</code><code  class="scala keyword">new</code> <code  class="scala keyword">_</code><code
 class="scala plain">root</code><code  class="scala keyword">_</code><code  class="scala plain">.java.util.Date}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Як ви можете бачити, метод howdy є досить прямолінійним.
        Lift прикріплює результат виконання метода (в цьому випадку <code>span</code>)
        в місце, де стоїть елемент фрагменту. Є цікавим зауважити, що матод сам
        по собі може повертати інші елементи <code><lift:...></lift:...></code> у
        вмісті, і вони також будуть оброблені. Ця рекурсивна природа композиції
        є частиною фундаментальної потужності Lift; це позначає, що результуючі
        фрагменти та уривки шаблонів у вашому застосуванні є загалом довільними.
        Вам не треба ніколи не писати ту ж функціональність більше одного разу.
      </div>
      <div  class="Indented">Тепер, коли ми розглянули всі справжні елементи
        вмісту, фінальний уривок пазлу є клас <code>Boot</code><a  href="#index-Boot"
 name="entry-Boot-0"  class="IndexReference">↓</a>. Клас <code>Boot</code>
        відповідальний з конфігурацію і встановлення фреймворку Lift. Як ми
        казали раніше в цій главі, більшість Lift має розумні замовчання, так що
        клас <code>Boot</code> в головному містить тільки додатки, що вам
        потрібні. Клас <code>Boot</code> завждирозташовується в пакунку
        bootstrap.liftweb, та показаний тут: </div>
      <div  class="Indented">
        <div  class="listing">
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_79081">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">bootstrap.liftweb</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.sitemap.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.sitemap.Loc.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">Helpers.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces"> </code> </div>
                        <div  class="line number9 index8 alt2"><code  class="scala comments">/**</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">* Клас, що створюється рано, та дозволяє застосуванню</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">* модифікувати оточення Lift</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot {</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// де шукати фрагмент</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.addToPackages(</code><code  class="scala string">"demo.helloworld"</code><code
 class="scala plain">)     </code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// будуємо SiteMap</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">entries </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"Home"</code><code
 class="scala plain">, List(</code><code  class="scala string">"index"</code><code
 class="scala plain">), </code><code  class="scala string">"Home"</code><code  class="scala plain">)) </code><code
 class="scala keyword">::</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Nil </code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.setSiteMap(SiteMap(entries</code><code  class="scala keyword">:_</code><code
 class="scala plain">*))</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Є два основні базові елементи конфігурації,
        розміщені в методі <code>boot</code>. Перший є метод <code>LiftRules.addToPackages</code>.
        Він вказує lift базувати свій пошук в пакунку <code>demo.helloworld</code>.
        Це означає, що фрагменти будуть розміщені в пакунку <code>demo.helloworld.snippets</code>,
        перегляди (розділ <a  href="#sec:Views"  class="Reference">4.4↓</a>)
        буде розміщені в пакунку <code>demo.helloworld.views</code>, таке інше.
        Якщо ви маєте більше однієї ієрархії (тобто декілька пакунків), ви
        можете просто викликати <code>addToPackages</code> декілька разів.
        Другий елемент в класі Boot є встановлення  SiteMenu. Очевидно, в цьому
        демо досить просте меню, але ми будемо розглядати більш цікаві приклади
        в главі SiteMap. </div>
      <div  class="Indented">Тепер, коли ми розглянули базовий приклад, ми
        сподіваємось ви починаєте розуміти, чому Lift є таким потужним, та чому
        він робить вас більш продуктивним. Ми тільки пошкрябали поверхню
        шаблонів Lift та можливостей прив'язування, але те що ми показали є вже
        великий крок. Це лише десять рядків коду Scala, та майже тридціти в XML,
        та ми вже маємо функціональний сайт. Якщо ми бажаємо додати більше
        сторінок, ми вже маємо встановлений набір шаблонів по замовчанню, так що
        нам не треба малювати той же самий рутинний HTML декілька разів. В
        нашому прикладі ми напряму генеруємо для нашого фрагменту <code>helloWorld.howdy</code>,
        але в подальших прикладах ми покажемо, як просто підтягувати вміст <i>з
          самого шаблону </i>у фрагмент, та модифікувати його за потреби. </div>
      <div  class="Indented">В наступних главах ми розглянемо: </div>
      <ul>
        <li>Значно складніші шаблони та прив'язки фрагментів, включаючи ввод
          форм та програмний вибір шаблонів</li>
        <li>Як використовувати SiteMap та його службові класи для провадження
          контекст-свідомого меню сайту та рівня контроля доступом</li>
        <li>Як обробляти стан в вашому застосуванні</li>
        <li>Рівень Lift ORM, Mapper (Глава <a  href="#cha:mapper_and_record"  class="Reference">8↓</a>),
          що провадить потужний, але легковажний, інтерфейс до баз даних</li>
        <li>Розвинену підтримку AJAX та Comet в застосуваннях стилю Lift for Web
          2.0</li>
      </ul>
      <div  class="Unindented">Ми сподіваємось, що ви також захоплені щодо
        розпочати з Lift, як і ми! </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-2"  class="toc">2</a> 
        PocketChange<a  name="cha:PocketChange"  class="Label"> </a> </h1>
      <div  class="Unindented">Як шлях до демонстрації концепцій цієї книги, ми
        збираємось побудувати базове застосування, та потім розбудовувати його
        по мірі просування. З його роозвитком ви будете розуміти все більше про
        Lift. Застосування, що ми обрали, називається Expense Tracker, та
        присвячене персональним фінансам. Ми назвали його <i>PocketChange.</i>
      </div>
      <div  class="Indented">
        <div  class="float"> <a  name="Figure-2.1"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 6in; max-width: 966px; height: auto; max-height: 488px;"
 alt="figure images/pocketchange.png"  src="./ExploringLift_files/pocketchange.png"
 class="embedded" /> </div>
            <div  class="caption"> Малюнок 2.1 Застосування PocketChange</div>
          </div>
        </div>
      </div>
      <div  class="Indented"> PocketChange буде відстежувати ваші витрати,
        підраховувати, скільки ви наразі витрачаєте, дозволить організувати ваші
        дані з використанням тегів, та допоможе візуалізувати ваші дані. На
        протязі подальших глав книги ми додамо декілька цікавих можливостей,
        таких, як AJAX діаграми, та дозволимо декілька людей на один рахунок (з
        допомогою Comet оновлення сутностей). Крім цього ми бажаємо утримувати
        інтерфейс тонким та ясним. </div>
      <div  class="Indented"> Ми збираємось використовувати шаблон <i>View
          First</i> для розробки нашого застосування, оскільки розділення в Lift
        презентації та логіки через шаблони, перегляди та фрагменти добре лягає
        на шаблон <i>View First</i>. Щоб прочитати чудовий папір щодо рішень
        дизайну за підходом Lift до шаблонів та логіки, прочитайте статтю David
        Pollak: <i>Lift View First у</i> Wiki<span  class="FootOuter"><span  class="SupFootMarker"> 
            [L] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [L] </span><a  href="http://www.assembla.com/wiki/show/liftweb/View_First"
 class="FlexURL">http://www.assembla.com/wiki/show/liftweb/View_First</a></span></span>.
      </div>
      <div  class="Indented">Інша важлива річ, що треба занотувати, полягає в
        тому, що ми збираємось зробити обліт застосування, та торкнутися багатьох
        деталей. Ми надамо безліч посилань на глави, де ці речі розкриваються.
        Ця глава насправді призначена тільки для надання вам смаку Lift, так що
        вільно зазирайте наперед, якщо бажаєте знати, як щось працює. Повний код
        джерела цілого застосування PocketChange доступний на GitHub<span  class="FootOuter"><span
 class="SupFootMarker">  [M] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [M] </span><a  href="http://github.com/tjweir/pocketchangeapp"  class="FlexURL">http://github.com/tjweir/pocketchangeapp</a></span></span>.
        Досить балаканини, слід вирушати! </div>
      <h2  class="Section"> <a  name="toc-Section-2.1"  class="toc">2.1</a> 
        Визначення моделі </h2>
      <div  class="Unindented">Перший крок, що ми зробимо - це визначимо
        сутності бази даних, що ми збираємось використовувати в нашому
        застосуванні. Базова функціональність відслідкованих категоризованих
        витрат включає наступні елементи: </div>
      <ul>
        <li> User: користувач застосування</li>
        <li> Account: Специфічний рахунок витрат - ми бажаємо мати більше одного
          для користувача</li>
        <li> Expense: Окрема транзакція витрати, прив'язана до певного рахунку</li>
        <li> Tag: Слово або фраза, що дозволяє нам категорізувати кожну витрату
          для подальшого пошуку і звітності</li>
      </ul>
      <div  class="Unindented">Ми почнемо з User, як показано в лістингу <a  href="#lst:PocketChange-User-entity"
 class="Reference">2.1↓</a>. Ми використаємо клас Lift MegaProtoUser
        (Розділ <a  href="#sub:ProtoUser-and-MegaProtoUser"  class="Reference">8.2.8
          сторінка 1↓</a>), щоб обробляти маже все, що нам треба для керування
        користувачами. Наприклад, з допомогою коду, що ви бачите, ми визначаємо
        цілий менеджмент користувачами для нашого сайту, включаючи сторінку
        реєстрації, сторінку втрати пароля, та сторінку входу. Супроводжуючі
        меню  SiteMap (Розділ <a  href="#cha:SiteMap"  class="Reference">7
          сторінка 1↓</a>) генеруються одним викликом  <code>User.siteMap</code>.
        Як ви можете бачити, ми можемо налаштувати згенерований XHTML, що
        призначений для сторінок управління користувачами, за допомогою
        декількох простих def. Можливості для налаштування, що провадить
        MetaMegaProtoUser, є потужними. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The PocketChange User Entity<a  name="lst:PocketChange-User-entity"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_863729">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.pocketchangeapp.model</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala comments">// Імпорт всіх класів-мепперів</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.mapper.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala comments">// Створюємо клас User розширюючи базовий клас Mapper</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala comments">// MegaProtoUser, що провадить поля по замовчанню, та методи</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala comments">// для користувача сайту.</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">User </code><code  class="scala keyword">extends</code> <code
 class="scala plain">MegaProtoUser[User] {</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">getSingleton </code><code
 class="scala keyword">=</code> <code  class="scala plain">User </code><code  class="scala comments">// посилання на об'єкт-компанйон</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">allAccounts </code><code
 class="scala keyword">:</code> <code  class="scala plain">List[Account] </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">Account.findAll(By(Account.owner, </code><code  class="scala keyword">this</code><code
 class="scala plain">.id))</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala comments">// Створення об'єкта-компанйона класу User (вище).</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala comments">// Цей об'єкт містить глобальні методи та полі, як find, <br />// dbTableName, dbIndexes, etc.</code></div><code
 class="scala keyword">object</code> <code  class="scala plain">User </code><code
 class="scala keyword">extends</code> <code  class="scala plain">User </code><code
 class="scala keyword">with</code> <code  class="scala plain">MetaMegaProtoUser[User] {</code>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">dbTableName </code><code  class="scala keyword">=</code> <code
 class="scala string">"users"</code> <code  class="scala comments">// визначаємо ім'я таблиці</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Провадимо власний шаблон для сторінки-логіну</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">loginXhtml </code><code  class="scala keyword">=</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">surround </code><code  class="scala keyword">with</code><code
 class="scala keyword">=</code><code  class="scala string">"default"</code> <code
 class="scala plain">at</code><code  class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">{ </code><code  class="scala keyword">super</code><code  class="scala plain">.loginXhtml }</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">surround></code></code></div><code
 class="scala plain">
                        <div  class="line number28 index27 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Провадимо власний шаблон для сторінки входу</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">signupXhtml(user</code><code  class="scala keyword">:</code> <code
 class="scala plain">User) </code><code  class="scala keyword">=</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">surround </code><code  class="scala keyword">with</code><code
 class="scala keyword">=</code><code  class="scala string">"default"</code> <code
 class="scala plain">at</code><code  class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">{ </code><code  class="scala keyword">super</code><code  class="scala plain">.signupXhtml(user) }</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">surround></code></code></div><code
 class="scala plain">
                        <div  class="line number34 index33 alt1"><code  class="scala plain">}</code></div>
                      </code></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Зауважте, що ми також додали службовий метод <code>allAccounts</code> до класу User, щоб отримувати всі рахунки для даного користувача. Ми використовуємо метод MetaMapper.findAll, щоб зробити запит по ID власника (Розділ <a
 href="#sub:Querying-for-Entities"  class="Reference">8.1.8 сторінка 1↓</a>), надаючи ID користувача, як ID власника. </div>
      <div  class="Indented">Визначення сутності Account трохи складніше, як показан в Лістингу <a
 href="#lst:PocketChange-Account-entity"  class="Reference">2.1↓</a>. Тут ми визначаємо клас з первинним ключем Long
        , та деякими полями, асоційованими з рахунками. Ми також визначаємо деякі допомоіжні методи для поєднань об'єктів в джойни (Розділ <a
 href="#sub:helper-joins"  class="Reference">8.1.11 сторінка 1↓</a>). Сутності Expense та Tag
        (разом з деякими допоміжними) послідують піздніше, так що ми доки їх не розглядатимемо. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Сутність PocketChange Account<a  name="lst:PocketChange-Account-entity"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_961055">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                      <div  class="line number52 index51 alt1">52</div>
                      <div  class="line number53 index52 alt2">53</div>
                      <div  class="line number54 index53 alt1">54</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.pocketchangeapp.model</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.math.MathContext</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.mapper.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.util.Empty</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala comments">// Клас Account розширює, що відображується на трей в БД з РК Long</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala comments">// та міксується в трейт IdPK, що додає РК "id"</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">Account </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LongKeyedMapper[Account] </code><code  class="scala keyword">with</code> <code
 class="scala plain">IdPK {</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// визначаємо синглтон</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">getSingleton </code><code
 class="scala keyword">=</code> <code  class="scala plain">Account</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// визначаємо відношення many-to-one з User</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">owner </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedLongForeignKey(</code><code
 class="scala keyword">this</code><code  class="scala plain">, User) {</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// додаємо індекс для цього стовпчика</code></div><code
 class="scala spaces">    </code><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">dbIndexed</code><code
 class="scala keyword">_</code><code  class="scala plain">? </code><code  class="scala keyword">=</code> <code
 class="scala keyword">true</code>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Поле контроля доступом, відключений до розгляду SiteMap <br />  // Власник Account зможе розшарювати перегляд на рахунок </code></div><code
 class="scala spaces">  </code><code  class="scala keyword">object</code> <code
 class="scala plain">is</code><code  class="scala keyword">_</code><code  class="scala plain">public </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedBoolean(</code><code
 class="scala keyword">this</code><code  class="scala plain">) {</code>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">defaultValue </code><code  class="scala keyword">=</code> <code
 class="scala keyword">false</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Поле для утримання балансу, до 16 розрядів (DECIMAL64) та 2 після коми</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">balance </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedDecimal(</code><code
 class="scala keyword">this</code><code  class="scala plain">, MathContext.DECIMAL</code><code
 class="scala value">64</code><code  class="scala plain">, </code><code  class="scala value">2</code><code
 class="scala plain">)</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">  </code> </div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">name </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedString(</code><code
 class="scala keyword">this</code><code  class="scala plain">,</code><code  class="scala value">100</code><code
 class="scala plain">)</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">description </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedString(</code><code
 class="scala keyword">this</code><code  class="scala plain">, </code><code  class="scala value">300</code><code
 class="scala plain">)</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">  </code> </div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Службові методи для спрощеного доступу, ми дойдемо до</code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// них в главі про Mapper</code></div>
                        <div  class="line number38 index37 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">admins </code><code
 class="scala keyword">=</code> <code  class="scala plain">AccountAdmin.findAll(By(AccountAdmin.account, </code><code
 class="scala keyword">this</code><code  class="scala plain">.id))</code></div>
                        <div  class="line number39 index38 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">addAdmin (user </code><code
 class="scala keyword">:</code> <code  class="scala plain">User) </code><code  class="scala keyword">=</code></div>
                        <div  class="line number40 index39 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">AccountAdmin.create.account(</code><code  class="scala keyword">this</code><code
 class="scala plain">).administrator(user).save</code></div>
                        <div  class="line number41 index40 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">viewers </code><code
 class="scala keyword">=</code> <code  class="scala plain">AccountViewer.findAll(By(AccountViewer.account, </code><code
 class="scala keyword">this</code><code  class="scala plain">.id))</code></div>
                        <div  class="line number42 index41 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">entries </code><code
 class="scala keyword">=</code> <code  class="scala plain">Expense.getByAcct(</code><code
 class="scala keyword">this</code><code  class="scala plain">, Empty, Empty, Empty)</code></div>
                        <div  class="line number43 index42 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">tags </code><code  class="scala keyword">=</code> <code
 class="scala plain">Tag.findAll(By(Tag.account, </code><code  class="scala keyword">this</code><code
 class="scala plain">.id))</code></div>
                        <div  class="line number44 index43 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">notes </code><code
 class="scala keyword">=</code> <code  class="scala plain">AccountNote.findAll(By(AccountNote.account, </code><code
 class="scala keyword">this</code><code  class="scala plain">.id))</code></div>
                        <div  class="line number45 index44 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number46 index45 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number47 index46 alt2"><code  class="scala comments">// Об'єкт-компан'йон</code></div>
                        <div  class="line number48 index47 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">Account </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Account </code><code  class="scala keyword">with</code> <code
 class="scala plain">LongKeyedMetaMapper[Account] {</code></div>
                        <div  class="line number49 index48 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Метод для пошуку рахунку по власнику та імені</code></div>
                        <div  class="line number50 index49 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">findByName (owner </code><code
 class="scala keyword">:</code> <code  class="scala plain">User, name </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">:</code> <code  class="scala plain">List[Account] </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number51 index50 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Account.findAll(By(Account.owner, owner.id.is), By(Account.name, name))</code></div>
                        <div  class="line number52 index51 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number53 index52 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">... ще методи ...</code></div>
                        <div  class="line number54 index53 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-2.2"  class="toc">2.2</a> Наш перший шаблон</h2>
      <div  class="Unindented">Наступний крок це з'ясувати, як презентувати дані користувачеві. Ми бажаємо отримати головну сторінку сайту, що відображує, в залежності від того, чи користувач увійшов в систему, або запрошення, або підсумок балансу рахунків, з місцем, щоб внести нові витрати. Лістинг <a
 href="#lst:The-welcome-template"  class="Reference">2.2↓</a> показує базовий шаблон, що робить саме це.
        Ми зберігаємо його як <code>index.html</code>. Уважний читач помітить, що ми маємо елемент заголовку, але не тіло. Це XHTML, так як це робить? Цей шаблон використовує тег <code><lift:surround></lift:surround></code> (Розділ <a
 href="#sub:surround-tag"  class="Reference">4.5.17 сторінка 1↓</a>) для встроювання себе в головний шаблон (<code>/templates_hidden/default</code>). Lift, насправді, робить те, що називаєтся “злиття заголовка” (Розділ сторінка <a
 href="#sec:Head-Merge"  class="Reference">1↓</a>) для злиття вмісту тегу <code>head</code> в вашому шаблоні нижче, з елементом <code>head</code> головного шаблона. Теги <code><lift:homepage.summary></lift:homepage.summary></code> та <code><lift:addentry.addentry></lift:addentry.addentry></code> є викликами до методів фрагментів. Фрагменти є кодом підтримки Scala, що провадить дійсну логіку сторінки. Ми розглянемо їх в наступному розділі. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The Welcome Template<a  name="lst:The-welcome-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_866553">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                      <div  class="line number52 index51 alt1">52</div>
                      <div  class="line number53 index52 alt2">53</div>
                      <div  class="line number54 index53 alt1">54</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">head</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml comments"><!-- включаємо всі плагіни --></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">script</code> <code  class="xml color1">type</code><code
 class="xml plain">=</code><code  class="xml string">"text/javascript"</code> <code
 class="xml color1">src</code><code  class="xml plain">=</code><code  class="xml string">"/scripts/date.js"</code><code
 class="xml plain">><!--</code--><code  class="xml keyword">script</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">  </code><code
 class="xml comments"><!--[if IE]></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">  </code><code
 class="xml comments"><script type="text/javascript" src="/scripts/jquery.bgiframe.js"></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">  </code><code
 class="xml comments"></script></code></div>
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">  </code><code
 class="xml comments"><![endif]--></code></div>
                        <div  class="line number9 index8 alt2"><code  class="xml plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">  </code><code
 class="xml comments"><!-- включаємо jQuery DatePicker JavaScript та CSS --></code></div>
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">script</code> <code  class="xml color1">type</code><code
 class="xml plain">=</code><code  class="xml string">"text/javascript"</code> <code
 class="xml color1">src</code><code  class="xml plain">=</code><code  class="xml string">"/scripts/jquery.datePicker.js"</code><code
 class="xml plain">></code></div>
                        <div  class="line number12 index11 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">script</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number13 index12 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">link</code> <code  class="xml color1">rel</code><code
 class="xml plain">=</code><code  class="xml string">"stylesheet"</code> <code  class="xml color1">type</code><code
 class="xml plain">=</code><code  class="xml string">"text/css"</code> <code  class="xml color1">href</code><code
 class="xml plain">=</code><code  class="xml string">"/style/datePicker.css"</code> <code
 class="xml plain">/></code></div>
                        <div  class="line number14 index13 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">head</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number15 index14 alt2"><code  class="xml spaces">    </code><code
 class="xml comments"><!-- Вміст цього елементу буде переданий до методу summary фрагменту</code></div>
                        <div  class="line number16 index15 alt1"><code  class="xml spaces">         </code><code
 class="xml comments">HomePage. Виклик bind в цьому методі буде заміщувати теги </code><code
 class="xml spaces"></code><code  class="xml comments">XML</code></div>
                        <div  class="line number17 index16 alt2"><code  class="xml spaces">         </code><code
 class="xml comments">нижче (тобто account:name) за данними рахунку, та повертає</code></div>
                        <div  class="line number19 index18 alt2"><code  class="xml spaces">         </code><code
 class="xml comments">NodeSeq, щоб замінити елемент lift:HomePage.summary --></code></div>
                        <div  class="line number20 index19 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:HomePage.summary</code><code
 class="xml plain">></code></div>
                        <div  class="line number21 index20 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">div</code> <code  class="xml color1">class</code><code
 class="xml plain">=</code><code  class="xml string">"column span-24 bordered"</code><code
 class="xml plain">></code></div>
                        <div  class="line number22 index21 alt1"><code  class="xml spaces">        </code><code
 class="xml plain"><</code><code  class="xml keyword">h2</code><code  class="xml plain">>Summary of accounts:<!--</code--><code
 class="xml keyword">h2</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number23 index22 alt2"><code  class="xml spaces">        </code><code
 class="xml plain"><</code><code  class="xml keyword">account:entry</code><code
 class="xml plain">></code></div>
                        <div  class="line number24 index23 alt1"><code  class="xml spaces">          </code><code
 class="xml plain"><</code><code  class="xml keyword">acct:name</code> <code  class="xml plain">/> : <</code><code
 class="xml keyword">acct:balance</code> <code  class="xml plain">/> <</code><code
 class="xml keyword">br</code><code  class="xml plain">/></code></div>
                        <div  class="line number25 index24 alt2"><code  class="xml spaces">        </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">account:entry</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number26 index25 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">div</code><code  class="xml plain">>   </code></code></div><code
 class="xml plain">
                        <div  class="line number27 index26 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">hr</code> <code  class="xml plain">/></code></div>
                        <div  class="line number28 index27 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">lift:HomePage.summary</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number29 index28 alt2"><code  class="xml plain">​</code></div>
                        <div  class="line number30 index29 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">div</code> <code  class="xml color1">class</code><code
 class="xml plain">=</code><code  class="xml string">"column span-24"</code><code
 class="xml plain">></code></div>
                        <div  class="line number36 index35 alt1"><code  class="xml spaces">      </code><code
 class="xml comments"><!-- Вміст цього елементу надійде в метод add фрагменту AddEntry. <br />           Буде створений елемент форми з методом POST та <br />           XML теги (як e:account) буддуть замінені на елементи форми<br />	   будуть замінені через виклик в методі add. Ця<br />           форма замінить елемент lift:AddEntry.addentry --></code></div>
                        <div  class="line number37 index36 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:AddEntry.addentry</code> <code
 class="xml color1">form</code><code  class="xml plain">=</code><code  class="xml string">"POST"</code><code
 class="xml plain">></code></div>
                        <div  class="line number38 index37 alt1"><code  class="xml spaces">        </code><code
 class="xml plain"><</code><code  class="xml keyword">div</code> <code  class="xml color1">id</code><code
 class="xml plain">=</code><code  class="xml string">"entryform"</code><code  class="xml plain">></code></div>
                        <div  class="line number39 index38 alt2"><code  class="xml spaces">          </code><code
 class="xml plain"><</code><code  class="xml keyword">div</code> <code  class="xml color1">class</code><code
 class="xml plain">=</code><code  class="xml string">"column span-24"</code><code
 class="xml plain">><</code><code  class="xml keyword">h3</code><code  class="xml plain">>Entry Form<!--</code--><code
 class="xml keyword">h3</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number40 index39 alt1"><code  class="xml spaces">            </code><code
 class="xml plain"><</code><code  class="xml keyword">e:account</code> <code  class="xml plain">/> <</code><code
 class="xml keyword">e:dateOf</code> <code  class="xml plain">/> <</code><code  class="xml keyword">e:desc</code> <code
 class="xml plain">/> <</code><code  class="xml keyword">e:value</code> <code  class="xml plain">/></code></div>
                        <div  class="line number41 index40 alt2"><code  class="xml spaces">            </code><code
 class="xml plain"><</code><code  class="xml keyword">e:tags</code><code  class="xml plain">/><</code><code
 class="xml keyword">button</code><code  class="xml plain">>Add $<!--</code--><code
 class="xml keyword">button</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number42 index41 alt1"><code  class="xml spaces">          </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number43 index42 alt2"><code  class="xml spaces">        </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number44 index43 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">lift:AddEntry.addentry</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number45 index44 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number46 index45 alt1"><code  class="xml plain">​</code></div>
                        <div  class="line number47 index46 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">script</code> <code  class="xml color1">type</code><code
 class="xml plain">=</code><code  class="xml string">"text/javascript"</code><code
 class="xml plain">></code></div>
                        <div  class="line number48 index47 alt1"><code  class="xml spaces">      </code><code
 class="xml plain">Date.format = ’yyyy/mm/dd’;</code></div>
                        <div  class="line number49 index48 alt2"><code  class="xml spaces">      </code><code
 class="xml plain">jQuery(function () {</code></div>
                        <div  class="line number50 index49 alt1"><code  class="xml spaces">        </code><code
 class="xml plain">jQuery(’#entrydate’).datePicker({startDate:’00010101’, </code></div>
                        <div  class="line number51 index50 alt2"><code  class="xml spaces">                                        </code><code
 class="xml plain">clickInput:true});</code></div>
                        <div  class="line number52 index51 alt1"><code  class="xml spaces">      </code><code
 class="xml plain">})</code></div>
                        <div  class="line number53 index52 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">script</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number54 index53 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></code></code></code></code></code></code></code></code></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Як ви можете бачити, у свьому нашому шаблоні немає жодної логіки, тільки добре сформований XML та деякий JavaScript, щоб активізувати функціональність         jQuery datePicker. </div>
      <h2  class="Section"> <a  name="toc-Section-2.3"  class="toc">2.3</a> 
Написання фрагментів</h2>
      <div  class="Unindented">Тепер, коли ми маємо шаблон, нам треба написати фрагменти HomePage та AddEntry, так, щоб ми могли дещо робити на сайті. Перше, давайте подивимось на фрагмент HomePage, показаний на Лістингу <a
 href="#lst:Defining-the-summary-snippet"  class="Reference">2.3↓</a>. Ми пропустили стандартні заголовки Lift
        (Лістинг <a  href="#lst:Standard-import-statements"  class="Reference">3.3↓</a>) щоб зберігти місце. Але ми залишили імпорт <code>java.util.Date</code> та всі наші класи моделей.</div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Визначення фрагменту Summary<a  name="lst:Defining-the-summary-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_100147">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.pocketchangeapp.snippet</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">... стандартні імпорти ...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.com.pocketchangeapp.model.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.util.Date</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">HomePage {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// User.currentUser повертає об'єкт "Box", що або Full</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// (містить User), Failure (містить помилку), або Empty.</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Метод Scala match служить для вибору дії на основі того, чи</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// це Full. Дивіться Box в Lift API.</code></div><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">summary (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">User.currentUser </code><code
 class="scala keyword">match</code> <code  class="scala plain">{</code>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(user) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">val</code> <code  class="scala plain">entries </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">user.allAccounts </code><code
 class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">Nil </code><code  class="scala keyword">=</code><code
 class="scala plain">> Text(</code><code  class="scala string">"Ви не маєте рахунків"</code><code
 class="scala plain">) </code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">accounts </code><code
 class="scala keyword">=</code><code  class="scala plain">> accounts.flatMap({account </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">bind(</code><code  class="scala string">"acct"</code><code
 class="scala plain">, chooseTemplate(</code><code  class="scala string">"account"</code><code
 class="scala plain">, </code><code  class="scala string">"entry"</code><code  class="scala plain">, xhtml),</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">               </code><code
 class="scala string">"name"</code> <code  class="scala plain">-> <a  href<=""  code=""><code
 class="scala keyword">=</code><code  class="scala plain">{</code><code  class="scala string">"/account/"</code> <code
 class="scala plain">+ account.name.is}></code></a></code></div><code  class="scala plain"><a
 href<=""  code="">
                        </a><div  class="line number21 index20 alt2"><a  href<=""
 code=""><code  class="scala spaces">                           </code><code  class="scala plain">{account.name.is}</code></a><code
 class="scala plain">,</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">               </code><code
 class="scala string">"balance"</code> <code  class="scala plain">-> Text(account.balance.toString))</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">})</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">bind(</code><code  class="scala string">"account"</code><code
 class="scala plain">, xhtml, </code><code  class="scala string">"entry"</code> <code
 class="scala plain">-> entries)</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> <lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">embed what</code><code  class="scala keyword">=</code><code
 class="scala string">"welcome_msg"</code> <code  class="scala plain">/></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala plain">}</code></div>
                      </code></code></div><code  class="scala plain"><code  class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Наш перший крок використати метод <code>User.currentUser</code> (провадиться трейтом <code>MetaMegaProtoUser</code>), щоб визначити, чи хтось ввійшов в систему. Цей метод повертає “Box,” що або Full
        (з User) або Empty. (Третій варіант Failure, але ми поки проігноруємо це). Якщо там є користувач, то він є володарем сессії і ми використовуємо метод <code>User.allAccounts</code> для отримання <code>List</code> з усіх рахунків користувача. Якщо користувач не має рахунків, ми повертаємо текстовий вузол XML, що буде закріплений там, де був наш техт в шаблоні. Якщо користувач мар рахунки, ми відображуємо їх на XHTML з використанням функції.
        Для кожного рахунка ми прикріплюємо ім'я рахунка де ми в шаблоні визначили тег <code><acct:name></acct:name></code>, та баланс, де ми визначили <code><acct:balance></acct:balance></code>. Результуючий List з XML NodeSeq входжень використовується для заміни елементу <lift:homepage.summary> в шаблоні. Нарешті, ми перевіряємо випадок, коли користувач не війшов, вставляючи вміст шаблону запрошення (що може бути далі оброблений). Зауважте, що ми можемо вставляти теги Lift таким чином, і вони будуть рекурсивно оброблені. </lift:homepage.summary></div>
      <div  class="Indented">Звичайно, це не видається дуже корисним - відтворювати баланс рахунків, коли ми не в змозі додавати витрати, так що давайте визначимо фрагмент <code>AddEntry</code>. Код показаний в Лістингу <a
 href="#lst:The-addEntry-snippet"  class="Reference">2.3↓</a>. Це виглядає інакше, ніж фрагмент HomePage, загалом тому що ми використовуємо <code>StatefulSnippet</code> (Розділ <a
 href="#sub:Stateless-versus-Stateful"  class="Reference">5.3.3 сторінка 1↓</a>). Первинна різниця в тому, що за допомогою <code>StatefulSnippet</code> використовується той же самий “примірник” фрагменту для кожного запиту в окремій сесії, так що ви можете зберігати змінні, в разі, якщо нам треба, щоб користувач щось виправив на формі. Базова структура фрагменту та ж сама, як і для підсумку: ми робимо деяку роботу (ми опишемо функцію <code>doTagsAndSubmit</code> через момент), та потім прив'язуються значення назад до шаблону. В цьому фрагменті, однак, ми використовуємо методи <code>SHtml.select</code> та <code>SHtml.text</code> для генерації полів форми. Поля <code>text</code>
        просто приймають початкове значення та функцію (замикання), щоб обробити отримане значення. Поле <code>select</code> є трохи більш складним, оскільки ви отримуєте перелік опцій, але в іншому концепція та ж сама. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Фрагмент AddEntry<a  name="lst:The-addEntry-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_824507">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                      <div  class="line number52 index51 alt1">52</div>
                      <div  class="line number53 index52 alt2">53</div>
                      <div  class="line number54 index53 alt1">54</div>
                      <div  class="line number55 index54 alt2">55</div>
                      <div  class="line number56 index55 alt1">56</div>
                      <div  class="line number57 index56 alt2">57</div>
                      <div  class="line number58 index57 alt1">58</div>
                      <div  class="line number59 index58 alt2">59</div>
                      <div  class="line number60 index59 alt1">60</div>
                      <div  class="line number61 index60 alt2">61</div>
                      <div  class="line number62 index61 alt1">62</div>
                      <div  class="line number63 index62 alt2">63</div>
                      <div  class="line number64 index63 alt1">64</div>
                      <div  class="line number65 index64 alt2">65</div>
                      <div  class="line number66 index65 alt1">66</div>
                      <div  class="line number67 index66 alt2">67</div>
                      <div  class="line number68 index67 alt1">68</div>
                      <div  class="line number69 index68 alt2">69</div>
                      <div  class="line number70 index69 alt1">70</div>
                      <div  class="line number71 index70 alt2">71</div>
                      <div  class="line number72 index71 alt1">72</div>
                      <div  class="line number73 index72 alt2">73</div>
                      <div  class="line number74 index73 alt1">74</div>
                      <div  class="line number75 index74 alt2">75</div>
                      <div  class="line number76 index75 alt1">76</div>
                      <div  class="line number77 index76 alt2">77</div>
                      <div  class="line number78 index77 alt1">78</div>
                      <div  class="line number79 index78 alt2">79</div>
                      <div  class="line number80 index79 alt1">80</div>
                      <div  class="line number81 index80 alt2">81</div>
                      <div  class="line number82 index81 alt1">82</div>
                      <div  class="line number83 index82 alt2">83</div>
                      <div  class="line number84 index83 alt1">84</div>
                      <div  class="line number85 index84 alt2">85</div>
                      <div  class="line number86 index85 alt1">86</div>
                      <div  class="line number87 index86 alt2">87</div>
                      <div  class="line number88 index87 alt1">88</div>
                      <div  class="line number89 index88 alt2">89</div>
                      <div  class="line number90 index89 alt1">90</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.pocketchangeapp.snippet</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">... standard imports ...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">com.pocketchangeapp.model.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">com.pocketchangeapp.util.Util</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">java.util.Date</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala comments">/* date | desc | tags | value */</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">AddEntry </code><code  class="scala keyword">extends</code> <code
 class="scala plain">StatefulSnippet {</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Ці мапи елементу "addentry" XML до методу "add" нижче</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">dispatch </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"addentry"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> add </code><code  class="scala keyword">_</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">account </code><code
 class="scala keyword">:</code> <code  class="scala plain">Long </code><code  class="scala keyword">=</code> <code
 class="scala keyword">_</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">date </code><code  class="scala keyword">=</code> <code
 class="scala string">""</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">desc </code><code  class="scala keyword">=</code> <code
 class="scala string">""</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">value </code><code
 class="scala keyword">=</code> <code  class="scala string">""</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// S.param("tag") повертає "Box" та метод "openOr" повертає або</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// вміст цього "ящика" (якщо він "Full"), або пустий </code><code
 class="scala comments">String, </code><code  class="scala comments">якщо</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Box є "Empty". Метод S.param повертає параметри, передані  </code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// переглядачем. В цьому випадку параметру є "tag"</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">tags </code><code  class="scala keyword">=</code> <code
 class="scala plain">S.param(</code><code  class="scala string">"tag"</code><code
 class="scala plain">) openOr </code><code  class="scala string">""</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">  </code> </div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">add(in</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq)</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">User.currentUser </code><code
 class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(user) </code><code
 class="scala keyword">if</code> <code  class="scala plain">user.editable.size > </code><code
 class="scala value">0</code> <code  class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">def</code> <code  class="scala plain">doTagsAndSubmit(t</code><code
 class="scala keyword">:</code> <code  class="scala plain">String) {</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">tags </code><code  class="scala keyword">=</code> <code  class="scala plain">t</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">if</code> <code  class="scala plain">(tags.trim.length </code><code
 class="scala keyword">==</code> <code  class="scala value">0</code><code  class="scala plain">) </code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">S.error(</code><code  class="scala string">"We’re going to need at least one tag."</code><code
 class="scala plain">)</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala spaces">          </code><code
 class="scala comments">// Трактуємо дату коректно, вона іде як yyyy/mm/dd</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">          </code><code
 class="scala keyword">val</code> <code  class="scala plain">entryDate </code><code
 class="scala keyword">=</code> <code  class="scala plain">Util.slashDate.parse(date)</code></div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">          </code><code
 class="scala keyword">val</code> <code  class="scala plain">amount </code><code
 class="scala keyword">=</code> <code  class="scala plain">BigDecimal(value)</code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala spaces">          </code><code
 class="scala keyword">val</code> <code  class="scala plain">currentAccount </code><code
 class="scala keyword">=</code> <code  class="scala plain">Account.find(account).open</code><code
 class="scala keyword">_</code><code  class="scala plain">!</code></div>
                        <div  class="line number38 index37 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number39 index38 alt2"><code  class="scala spaces">          </code><code
 class="scala comments">// Нам треба визначити останній послідовний номер та баланс</code></div>
                        <div  class="line number40 index39 alt1"><code  class="scala spaces">          </code><code
 class="scala comments">// для дати. Цей метод повертає два значення, що кладуться</code></div>
                        <div  class="line number41 index40 alt2"><code  class="scala spaces">          </code><code
 class="scala comments">// в entrySerial та entryBalance відповідно</code></div><code
 class="scala spaces">          </code><code  class="scala keyword">val</code> <code
 class="scala plain">(entrySerial, entryBalance) </code><code  class="scala keyword">=</code>
                        <div  class="line number44 index43 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">Expense.getLastExpenseData(currentAccount, entryDate)</code></div>
                        <div  class="line number45 index44 alt2"><code  class="scala spaces">      </code> </div>
                        <div  class="line number46 index45 alt1"><code  class="scala spaces">          </code><code
 class="scala keyword">val</code> <code  class="scala plain">e </code><code  class="scala keyword">=</code> <code
 class="scala plain">Expense.create.account(account)</code></div>
                        <div  class="line number47 index46 alt2"><code  class="scala spaces">                    </code><code
 class="scala plain">.dateOf(entryDate)</code></div>
                        <div  class="line number48 index47 alt1"><code  class="scala spaces">                    </code><code
 class="scala plain">.serialNumber(entrySerial + </code><code  class="scala value">1</code><code
 class="scala plain">)</code></div>
                        <div  class="line number49 index48 alt2"><code  class="scala spaces">                    </code><code
 class="scala plain">.description(desc)</code></div>
                        <div  class="line number50 index49 alt1"><code  class="scala spaces">                    </code><code
 class="scala plain">.amount(BigDecimal(value)).tags(tags)</code></div>
                        <div  class="line number51 index50 alt2"><code  class="scala spaces">                    </code><code
 class="scala plain">.currentBalance(entryBalance + amount)</code></div>
                        <div  class="line number52 index51 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number53 index52 alt2"><code  class="scala spaces">          </code><code
 class="scala comments">// Метод валідації повертає Nil, якщо немає помилок, та </code></div>
                        <div  class="line number54 index53 alt1"><code  class="scala spaces">          </code><code
 class="scala comments">// повідомлення помилки, якщо помилки знайдені</code></div>
                        <div  class="line number55 index54 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">e.validate </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number56 index55 alt1"><code  class="scala spaces">            </code><code
 class="scala keyword">case</code> <code  class="scala plain">Nil </code><code  class="scala keyword">=</code><code
 class="scala plain">> {</code></div>
                        <div  class="line number57 index56 alt2"><code  class="scala spaces">              </code><code
 class="scala plain">Expense.updateEntries(entrySerial + </code><code  class="scala value">1</code><code
 class="scala plain">, amount)</code></div>
                        <div  class="line number58 index57 alt1"><code  class="scala spaces">              </code><code
 class="scala plain">e.save</code></div>
                        <div  class="line number59 index58 alt2"><code  class="scala spaces">              </code><code
 class="scala keyword">val</code> <code  class="scala plain">acct </code><code  class="scala keyword">=</code> <code
 class="scala plain">Account.find(account).open</code><code  class="scala keyword">_</code><code
 class="scala plain">!</code></div>
                        <div  class="line number60 index59 alt1"><code  class="scala spaces">              </code><code
 class="scala keyword">val</code> <code  class="scala plain">newBalance </code><code
 class="scala keyword">=</code> <code  class="scala plain">acct.balance.is + e.amount.is</code></div>
                        <div  class="line number61 index60 alt2"><code  class="scala spaces">              </code><code
 class="scala plain">acct.balance(newBalance).save</code></div>
                        <div  class="line number62 index61 alt1"><code  class="scala spaces">              </code><code
 class="scala plain">S.notice(</code><code  class="scala string">"Entry added!"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number63 index62 alt2"><code  class="scala spaces">              </code><code
 class="scala comments">// Видалення стану цього фрагменту</code></div>
                        <div  class="line number64 index63 alt1"><code  class="scala spaces">              </code><code
 class="scala plain">unregisterThisSnippet() </code></div>
                        <div  class="line number65 index64 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">}</code></div>
                        <div  class="line number66 index65 alt1"><code  class="scala spaces">            </code><code
 class="scala keyword">case</code> <code  class="scala plain">x </code><code  class="scala keyword">=</code><code
 class="scala plain">> error(x)</code></div>
                        <div  class="line number67 index66 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">}</code></div>
                        <div  class="line number68 index67 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">}</code></div>
                        <div  class="line number69 index68 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number70 index69 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number71 index70 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">val</code> <code  class="scala plain">allAccounts </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number72 index71 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">user.allAccounts.map(acct </code><code  class="scala keyword">=</code><code
 class="scala plain">> (acct.id.toString, acct.name))</code></div>
                        <div  class="line number73 index72 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number74 index73 alt1"><code  class="scala spaces">      </code><code
 class="scala comments">// Розбір через NodeSeq, переданий як "in", шукаючи теги з</code></div>
                        <div  class="line number75 index74 alt2"><code  class="scala spaces">      </code><code
 class="scala comments">// префіксом "e". Коли знайдено, замінюємо тег на NodeSeq</code></div>
                        <div  class="line number76 index75 alt1"><code  class="scala spaces">      </code><code
 class="scala comments">// відповідно до мари нижче (name -> NodeSeq)</code></div>
                        <div  class="line number77 index76 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">bind(</code><code  class="scala string">"e"</code><code  class="scala plain">, in, </code></div>
                        <div  class="line number78 index77 alt1"><code  class="scala spaces">        </code><code
 class="scala string">"account"</code> <code  class="scala plain">-> select(allAccounts, Empty,</code></div>
                        <div  class="line number79 index78 alt2"><code  class="scala spaces">                            </code><code
 class="scala plain">id </code><code  class="scala keyword">=</code><code  class="scala plain">> account </code><code
 class="scala keyword">=</code> <code  class="scala plain">id.toLong),</code></div>
                        <div  class="line number80 index79 alt1"><code  class="scala spaces">        </code><code
 class="scala string">"dateOf"</code> <code  class="scala plain">-> text(Util.slashDate.format(</code><code
 class="scala keyword">new</code> <code  class="scala plain">Date()).toString,</code></div>
                        <div  class="line number81 index80 alt2"><code  class="scala spaces">                         </code><code
 class="scala plain">date </code><code  class="scala keyword">=</code> <code  class="scala keyword">_</code><code
 class="scala plain">,</code></div>
                        <div  class="line number82 index81 alt1"><code  class="scala spaces">                         </code><code
 class="scala string">"id"</code> <code  class="scala plain">-> </code><code  class="scala string">"entrydate"</code><code
 class="scala plain">),</code></div>
                        <div  class="line number83 index82 alt2"><code  class="scala spaces">        </code><code
 class="scala string">"desc"</code> <code  class="scala plain">-> text(</code><code
 class="scala string">"Item Description"</code><code  class="scala plain">, desc </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">),</code></div>
                        <div  class="line number84 index83 alt1"><code  class="scala spaces">        </code><code
 class="scala string">"value"</code> <code  class="scala plain">-> text(</code><code
 class="scala string">"Value"</code><code  class="scala plain">, value </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">),</code></div>
                        <div  class="line number85 index84 alt2"><code  class="scala spaces">        </code><code
 class="scala string">"tags"</code> <code  class="scala plain">-> text(tags, doTagsAndSubmit))</code></div>
                        <div  class="line number86 index85 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number87 index86 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// Якщо немає користувача повертаємо пустий вузол Text</code></div>
                        <div  class="line number88 index87 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> Text(</code><code  class="scala string">""</code><code  class="scala plain">)</code></div>
                        <div  class="line number89 index88 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number90 index89 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Функція <code>doTagsAndSubmit</code> є новим додатком. Його головне призначення обробляти прислані дані, створити та перевірити сутність <code>Expense</code>, та потім повернутись до користувача. Цей шаблон визначення локальної функції для обробки форми є повністю загальною, на відміну до визначення метода в вашому класі. Головна причина цього в визначенні функції локально, та вона замиканнями для любих змінних, визначених в полі зору вашої функції фрагменту. </div>
      <h2  class="Section"> <a  name="toc-Section-2.4"  class="toc">2.4</a> Маленька перчинка AJAX </h2>
      <div  class="Unindented">Доки все ішло досить стандартною платою, так що просунемось трохи далі, та покажемо деякі більш складну функціональность.
        Лістинг <a  href="#lst:Displaying-an-Expense-table"  class="Reference">2.4↓</a> показує шаблон для відтворення таблиці з Expense для користувача, з опціональними датами початка та кінця. Фрагмент <code>Accounts.detail</code> буде визначеня пізніше в цьому розділі. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Відображення таблиці Expense<a  name="lst:Displaying-an-Expense-table"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_643703">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:Accounts.detail</code> <code
 class="xml color1">eager_eval</code><code  class="xml plain">=</code><code  class="xml string">"true"</code><code
 class="xml plain">> </code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">div</code> <code  class="xml color1">class</code><code
 class="xml plain">=</code><code  class="xml string">"column span-24"</code><code
 class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">h2</code><code  class="xml plain">>Summary<!--</code--><code
 class="xml keyword">h2</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">table</code><code  class="xml plain">><</code><code
 class="xml keyword">tr</code><code  class="xml plain">><</code><code  class="xml keyword">th</code><code
 class="xml plain">>Name<!--</code--><code  class="xml keyword">th</code><code  class="xml plain">><</code><code
 class="xml keyword">th</code><code  class="xml plain">>Balance<!--</code--><code
 class="xml keyword">th</code><code  class="xml plain">><!--</code--><code  class="xml keyword">tr</code><code
 class="xml plain">></code></code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">tr</code><code  class="xml plain">><</code><code
 class="xml keyword">td</code><code  class="xml plain">><</code><code  class="xml keyword">acct:name</code> <code
 class="xml plain">/><!--</code--><code  class="xml keyword">td</code><code  class="xml plain">><</code><code
 class="xml keyword">td</code><code  class="xml plain">><</code><code  class="xml keyword">acct:balance</code> <code
 class="xml plain">/><!--</code--><code  class="xml keyword">td</code><code  class="xml plain">><!--</code--><code
 class="xml keyword">tr</code><code  class="xml plain">></code></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">table</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">div</code><code  class="xml plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">h3</code><code  class="xml plain">>Filters:<!--</code--><code
 class="xml keyword">h3</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">table</code><code  class="xml plain">><</code><code
 class="xml keyword">tr</code><code  class="xml plain">><</code><code  class="xml keyword">th</code><code
 class="xml plain">>Start Date<!--</code--><code  class="xml keyword">th</code><code
 class="xml plain">><</code><code  class="xml keyword">td</code><code  class="xml plain">><</code><code
 class="xml keyword">acct:startDate</code> <code  class="xml plain">/><!--</code--><code
 class="xml keyword">td</code><code  class="xml plain">></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">               </code><code
 class="xml plain"><</code><code  class="xml keyword">th</code><code  class="xml plain">>End Date<!--</code--><code
 class="xml keyword">th</code><code  class="xml plain">><</code><code  class="xml keyword">td</code><code
 class="xml plain">><</code><code  class="xml keyword">acct:endDate</code> <code
 class="xml plain">/><!--</code--><code  class="xml keyword">td</code><code  class="xml plain">><!--</code--><code
 class="xml keyword">tr</code><code  class="xml plain">></code></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                        <div  class="line number12 index11 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">table</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number13 index12 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number14 index13 alt1"><code  class="xml plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">div</code> <code  class="xml color1">class</code><code
 class="xml plain">=</code><code  class="xml string">"column span-24"</code> <code
 class="xml plain">></code></div>
                        <div  class="line number16 index15 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">h2</code><code  class="xml plain">>Transactions<!--</code--><code
 class="xml keyword">h2</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number17 index16 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:embed</code> <code  class="xml color1">what</code><code
 class="xml plain">=</code><code  class="xml string">"entry_table"</code> <code
 class="xml plain">/></code></div>
                        <div  class="line number18 index17 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number19 index18 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">lift:Accounts.detail</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number20 index19 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></code></code></code></code></code></code></code></code></code></code></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Тег <lift:embed> (Розділ <a  href="#sub:embed-tag"
 class="Reference">4.5.7 на сторінці 1↓</a>) дозволяє вам включати інший шаблон в цій точці. В нашому випадку, шаблон <code>entry_table</code> показаний в Лістингу <a
 href="#lst:Embedded-Expense-table"  class="Reference">2.4↓</a>. Це дійсно тільки фрагмент, та не призначений бути використаний окремо, бо це не повний документ  XHTML, та він не оточує себе головним шаблоном. Однак він провадить точки прикріплення, які ми можемо заповнити. </lift:embed></div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Вбудована таблиця Expense<a  name="lst:Embedded-Expense-table"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_993888">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">table</code> <code  class="xml color1">class</code><code  class="xml plain">=</code><code
 class="xml string">""</code> <code  class="xml color1">border</code><code  class="xml plain">=</code><code
 class="xml string">"0"</code> <code  class="xml color1">cellpadding</code><code
 class="xml plain">=</code><code  class="xml string">"0"</code> <code  class="xml color1">cellspacing</code><code
 class="xml plain">=</code><code  class="xml string">"1"</code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">    </code><code
 class="xml color1">width</code><code  class="xml plain">=</code><code  class="xml string">"100%"</code><code
 class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">thead</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">tr</code><code  class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">th</code><code  class="xml plain">>Date<!--</code--><code
 class="xml keyword">th</code><code  class="xml plain">><</code><code  class="xml keyword">th</code><code
 class="xml plain">>Description<!--</code--><code  class="xml keyword">th</code><code
 class="xml plain">><</code><code  class="xml keyword">th</code><code  class="xml plain">>Tags<!--</code--><code
 class="xml keyword">th</code><code  class="xml plain">><</code><code  class="xml keyword">th</code><code
 class="xml plain">>Value<!--</code--><code  class="xml keyword">th</code><code
 class="xml plain">></code></code></code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">th</code><code  class="xml plain">>Balance<!--</code--><code
 class="xml keyword">th</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">tr</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">thead</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">tbody</code> <code  class="xml color1">id</code><code
 class="xml plain">=</code><code  class="xml string">"entry_table"</code><code  class="xml plain">></code></div>
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">acct:table</code><code  class="xml plain">></code></div>
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">acct:tableEntry</code><code
 class="xml plain">></code></div>
                        <div  class="line number12 index11 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">tr</code><code  class="xml plain">><</code><code
 class="xml keyword">td</code><code  class="xml plain">><</code><code  class="xml keyword">entry:date</code> <code
 class="xml plain">/><!--</code--><code  class="xml keyword">td</code><code  class="xml plain">><</code><code
 class="xml keyword">td</code><code  class="xml plain">><</code><code  class="xml keyword">entry:desc</code> <code
 class="xml plain">/><!--</code--><code  class="xml keyword">td</code><code  class="xml plain">></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                        <div  class="line number13 index12 alt2"><code  class="xml spaces">        </code><code
 class="xml plain"><</code><code  class="xml keyword">td</code><code  class="xml plain">><</code><code
 class="xml keyword">entry:tags</code> <code  class="xml plain">/><!--</code--><code
 class="xml keyword">td</code><code  class="xml plain">><</code><code  class="xml keyword">td</code><code
 class="xml plain">><</code><code  class="xml keyword">entry:amt</code> <code  class="xml plain">/><!--</code--><code
 class="xml keyword">td</code><code  class="xml plain">></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                        <div  class="line number14 index13 alt1"><code  class="xml spaces">        </code><code
 class="xml plain"><</code><code  class="xml keyword">td</code><code  class="xml plain">><</code><code
 class="xml keyword">entry:balance</code> <code  class="xml plain">/><!--</code--><code
 class="xml keyword">td</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number15 index14 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">tr</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number16 index15 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">acct:tableEntry</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number17 index16 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">acct:table</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number18 index17 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">tbody</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number19 index18 alt2"><code  class="xml plain"><!--</code--><code
 class="xml keyword">table</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></code></code></code></code></code></code></code></code></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Перед тим, як ми дойдемо до частини AJAX коду, давайте визначимо допоміжний метод в нашому фрагменті класу Account, показаний в Лістингу <a
 href="#lst:The-table-helper-function"  class="Reference">2.4↓</a>, щоб згенерувати таблицю XHTML з елементів, що ми будемо відображувати (звичайні імпорти опущені). Загалом, ця функція заштовхує вміст тегу <code><acct:tableentry></acct:tableentry></code> (через метод  <code>Helpers.chooseTemplate</code>, Розділ <a
 href="#sec:BindHelpers"  class="Reference">C.8 на сторінці 1↓</a>), та прикріплює кожний Expense з провадженого списку до нього. Як ви можете бачити в шаблоні <code>entry_table</code>, що відповідає до одного рядка таблиці для кожного елементу. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Допоміжна функція таблиці<a  name="lst:The-table-helper-function"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_855586">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.pocketchangeapp.snippet</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">... imports ...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">Accounts {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">buildExpenseTable(entries </code><code
 class="scala keyword">:</code> <code  class="scala plain">List[Expense], template </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// Повторно викликає bind, для кожного Entry в entries</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">entries.flatMap({ entry </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">bind(</code><code  class="scala string">"entry"</code><code
 class="scala plain">, chooseTemplate(</code><code  class="scala string">"acct"</code><code
 class="scala plain">, </code><code  class="scala string">"tableEntry"</code><code
 class="scala plain">, template),</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">           </code><code
 class="scala string">"date"</code> <code  class="scala plain">-> Text(Util.slashDate.format(entry.dateOf.is)),</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">           </code><code
 class="scala string">"desc"</code> <code  class="scala plain">-> Text(entry.description.is),</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">           </code><code
 class="scala string">"tags"</code> <code  class="scala plain">-> Text(entry.tags.map(</code><code
 class="scala keyword">_</code><code  class="scala plain">.tag.is).mkString(</code><code
 class="scala string">", "</code><code  class="scala plain">)),</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">           </code><code
 class="scala string">"amt"</code> <code  class="scala plain">-> Text(entry.amount.toString),</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">           </code><code
 class="scala string">"balance"</code> <code  class="scala plain">-> Text(entry.currentBalance.toString))</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">   </code><code
 class="scala plain">})</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Фінальна частина нашого уривка <tt>Accounts.detail</tt>, показана в Лістингу <a
 href="#lst:Our-Ajax-snippet"  class="Reference">2.4↓</a>. Ми почнемо з деяких шаблонних викликів щоб знайти <tt>Account</tt> для перегляду, потім ми визначаємо деякі змінні, щоб зберігати стан. Важливо, що це var, так що вони можуть бути захоплені в замиканнях <tt>entryTable</tt>,
        <tt>updateStartDate</tt>, та
        <tt>updateEndDate</tt>, так само, як полями форми AJAX, що ми визначаємо. Єдина магія, що ми маємо використовувати, це генератор поля форми <tt>SHtml.ajaxText</tt> (Глава <a
 href="#cha:AJAX-and-COMET"  class="Reference">11↓</a>), що перетворить наші замикання оновлень в зворотні виклики AJAX. Значення, що повертаються з ціх зворотніх викликів є код JavaScript, що буде виконуватись на стороні клієнта. Ви можете бачити, що є декілька рядків кода, що ми маємо на сторінці, що будуть автоматично оновлювати нашу таблицю Expense, коли ми встановимо початкову та кінечну дату! </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Наш AJAX уривок<a  name="lst:Our-Ajax-snippet"
 class="Label"></a></div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_300806">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                      <div  class="line number52 index51 alt1">52</div>
                      <div  class="line number53 index52 alt2">53</div>
                      <div  class="line number54 index53 alt1">54</div>
                      <div  class="line number55 index54 alt2">55</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.pocketchangeapp.snippet</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">... standard imports ...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">com.pocketchangeapp.model.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">com.pocketchangeapp.util.Util</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Accounts {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">detail (xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">S.param(</code><code
 class="scala string">"name"</code><code  class="scala plain">) </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// Якщо параметр "name" був переданий переглядачем...</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(acctName) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala comments">// Шукаємо рахунок по імені для поточного користувача</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">Account.findByName(User.currentUser.open</code><code  class="scala keyword">_</code><code
 class="scala plain">!, acctName) </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala comments">// Якщо рахунок повернено (як List)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">acct </code><code
 class="scala keyword">::</code> <code  class="scala plain">Nil </code><code  class="scala keyword">=</code><code
 class="scala plain">> {</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">          </code><code
 class="scala comments">// Деякий стан замикання для викликів AJAX</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">          </code><code
 class="scala comments">// Ось Lift-івський "Box" в дії: ми створюємо</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">          </code><code
 class="scala comments">// змінні, щоб містити Date Boxes та ініціюємо його</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">          </code><code
 class="scala comments">// як "Empty" (Empty є субкласом Box)</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">          </code><code
 class="scala keyword">var</code> <code  class="scala plain">startDate </code><code
 class="scala keyword">:</code> <code  class="scala plain">Box[Date] </code><code
 class="scala keyword">=</code> <code  class="scala plain">Empty</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">          </code><code
 class="scala keyword">var</code> <code  class="scala plain">endDate </code><code
 class="scala keyword">:</code> <code  class="scala plain">Box[Date] </code><code
 class="scala keyword">=</code> <code  class="scala plain">Empty</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">          </code><code
 class="scala comments">// Допоміжний методи AJAX. Визначені тут для захоплення</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">          </code><code
 class="scala comments">// змінних замикання вище</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">          </code><code
 class="scala keyword">def</code> <code  class="scala plain">entryTable </code><code
 class="scala keyword">=</code> <code  class="scala plain">buildExpenseTable(</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">Expense.getByAcct(acct, startDate, endDate, Empty),</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">xhtml)</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">          </code><code
 class="scala keyword">def</code> <code  class="scala plain">updateStartDate (date </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">startDate </code><code  class="scala keyword">=</code> <code
 class="scala plain">Util.parseDate(date, Util.slashDate.parse)</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">JsCmds.SetHtml(</code><code  class="scala string">"entry_table"</code><code
 class="scala plain">, entryTable)</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">}</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">          </code><code
 class="scala keyword">def</code> <code  class="scala plain">updateEndDate (date </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">endDate </code><code  class="scala keyword">=</code> <code
 class="scala plain">Util.parseDate(date, Util.slashDate.parse)</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">JsCmds.SetHtml(</code><code  class="scala string">"entry_table"</code><code
 class="scala plain">, entryTable)</code></div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">}</code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number38 index37 alt1"><code  class="scala spaces">          </code><code
 class="scala comments">// Прикріплення даних до переданих в XML eелементів з</code></div>
                        <div  class="line number39 index38 alt2"><code  class="scala spaces">          </code><code
 class="scala comments">// префіксом "acct", відповідно до мапи нижче.</code></div>
                        <div  class="line number40 index39 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">bind(</code><code  class="scala string">"acct"</code><code
 class="scala plain">, xhtml, </code></div>
                        <div  class="line number41 index40 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"name"</code> <code  class="scala plain">-> acct.name.asHtml,</code></div>
                        <div  class="line number42 index41 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"balance"</code> <code  class="scala plain">-> acct.balance.asHtml,</code></div>
                        <div  class="line number43 index42 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"startDate"</code> <code  class="scala plain">-> SHtml.ajaxText(</code><code
 class="scala string">""</code><code  class="scala plain">, updateStartDate),</code></div>
                        <div  class="line number44 index43 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"endDate"</code> <code  class="scala plain">-> SHtml.ajaxText(</code><code
 class="scala string">""</code><code  class="scala plain">, updateEndDate),</code></div>
                        <div  class="line number45 index44 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"table"</code> <code  class="scala plain">-> entryTable)</code></div>
                        <div  class="line number46 index45 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">}</code></div>
                        <div  class="line number47 index46 alt2"><code  class="scala spaces">        </code><code
 class="scala comments">// Ім'я рахунку запроваджені, але не співпали з жодним</code></div>
                        <div  class="line number48 index47 alt1"><code  class="scala spaces">        </code><code
 class="scala comments">// рахунком користувачів</code></div>
                        <div  class="line number49 index48 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> Text(</code><code  class="scala string">"Could not locate account "</code> <code
 class="scala plain">+ acctName)</code></div>
                        <div  class="line number50 index49 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number51 index50 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number52 index51 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// S.param "name" був порожнім</code></div>
                        <div  class="line number53 index52 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> Text(</code><code  class="scala string">"No account name provided"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number54 index53 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number55 index54 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-2.5"  class="toc">2.5</a> <span
 style="font-family: "  consolas","bitstream=""  vera=""  sans=""  mono","courier=""
 new",courier,monospace;"=""></span>Висновок</h2>
      <div  class="Unindented"> Ми надіємось, що цей розділ продемонстрував, яким потужним може бути Lift, при цьому залишаючись стислим та простим до використання. Не турбуйтесь, якщо щось залишилось незрозумілим, ми пояснимо це більш детально по мірі просування далі. Ми продовжимо розширювати цей приклад на протязі книги, так що почувайтесь вільно використовувати  цю главу для посилання,
        або зробіть власну версію PocketChange з git репозитарія, за допомогою наступної команди (вважаємо, ви маєте встановлений git): </div>
      <pre  class="LyX-Code">git clone <a  href="git://github.com/tjweir/pocketchangeapp.git"
 class="FlexURL">git://github.com/tjweir/pocketchangeapp.git</a>
</pre>
      <div  class="Unindented">Тепер час зануритись! </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-3"  class="toc">3</a> Основи Lift<a
 name="cha:Lift-Architecture"  class="Label"> </a> </h1>
      <div  class="Unindented">В цій главі ми охопимо деякі з фундаментальних аспектів написання застосувань lift, включаючи архитектуру бібліотеки Lift, та як обробляти запити. </div>
      <h2  class="Section"> <a  name="toc-Section-3.1"  class="toc">3.1</a> 
Введення в Lift<a  name="sec:Entry-into-Lift"  class="Label"> </a> </h2>
      <div  class="Unindented"> Перший крок в обробці запиту Lift є перехоплення запиту HTTP. В оригінала Lift використовував примірник <tt>java.servlet.Servlet</tt> для обробки надходящих запитів. Це було змінене для використання примірника <tt>java.servlet.Filter</tt> instance<span
 class="FootOuter"><span  class="SupFootMarker"> [N] </span><span  class="HoverFoot"><span
 class="SupFootMarker"> 
              [N]Ви можете бачити дискусію в списці поштової розсилки </span>Lift, що призвело до цієї зміни: <a
 href="http://tinyurl.com/dy9u9d"  class="FlexURL">http://tinyurl.com/dy9u9d</a></span></span>, оскільки це дозволяє контейнеру обробляти любі запити, що не робить Lift (зокрема, статичний вміст). Фільтр діє як тонка огортка зверху існуючого <tt>LiftServlet</tt> (який все ще робить всю роботу), так що не будьте спантеличені, коли подивитесь на Lift
        API, та побачите обоє класи (<tt>LiftFilter</tt> та
        <tt>LiftServlet</tt>). Головна річ, що треба запам'ятати, це що ваш <tt>web.xml</tt><a
 href="#index-web.xml"  name="entry-web.xml-0"  class="IndexReference">↓</a> повинен вказувати фільтр, а не сервлет, як показано в Лістингу <a
 href="#lst:LiftFilter-setup-in-web.xml"  class="Reference">3.1↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:LiftFilter-setup-in-web.xml"  class="Label">
            </a>LiftFilter Setup in web.xml </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_596451">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><!--?</code--><code
 class="xml keyword">xml</code> <code  class="xml color1">version</code><code  class="xml plain">=</code><code
 class="xml string">"1.0"</code> <code  class="xml color1">encoding</code><code
 class="xml plain">=</code><code  class="xml string">"ISO-8859-1"</code><code  class="xml plain">?></code></code></div><code
 class="xml plain">
                        <div  class="line number2 index1 alt1"><code  class="xml plain"></code></div><code
 class="xml plain">
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain">PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain">"<a  href="http://java.sun.com/j2ee/dtds/web-app_2_3.dtd">http://java.sun.com/j2ee/dtds/web-app_2_3.dtd</a>"></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">web-app</code><code  class="xml plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">filter</code><code  class="xml plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">filter-name</code><code  class="xml plain">>LiftFilter<!--</code--><code
 class="xml keyword">filter-name</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">display-name</code><code  class="xml plain">>Lift Filter<!--</code--><code
 class="xml keyword">display-name</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">description</code><code  class="xml plain">>The Filter that intercepts lift calls<!--</code--><code
 class="xml keyword">description</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">filter-class</code><code  class="xml plain">>net.liftweb.http.LiftFilter<!--</code--><code
 class="xml keyword">filter-class</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">filter</code><code  class="xml plain">>      </code></code></div><code
 class="xml plain">
                        <div  class="line number12 index11 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">filter-mapping</code><code
 class="xml plain">></code></div>
                        <div  class="line number13 index12 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">filter-name</code><code  class="xml plain">>LiftFilter<!--</code--><code
 class="xml keyword">filter-name</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number14 index13 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">url-pattern</code><code  class="xml plain">>/*<!--</code--><code
 class="xml keyword">url-pattern</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number15 index14 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">filter-mapping</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number16 index15 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">web-app</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></code></code></code></code></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Повний приклад <tt>web.xml</tt> показаний в Розділі <a
 href="#lst:JPA-web.xml"  class="Reference">G.1.5↓</a>. Зокрема, відображення фільтрів (рядки 13-16) вказують, що Filter відповідальний за все. Коли фільтр отримує запит, він перевіряє набір правил, щоб побачити, чи він може їх обробити. Якщо це запит, щообробляє Lift, він передає його на внутрішній примірник <tt>LiftServlet</tt> для обробки; інакше, він сціплює запит та дозволяє контейнеру обробити його. </div>
      <h2  class="Section"> <a  name="toc-Section-3.2"  class="toc">3.2</a> 
        Розкрутка<a  name="sec:Bootstrap"  class="Label"> </a><a  href="#index-Bootstrap"
 name="entry-Bootstrap-0"  class="IndexReference">↓</a> </h2>
      <div  class="Unindented">Коли Lift стартує застосування, відбувається низка речей, що ви бажаєте встановити перед обробкою любих запитів. Ці речі включають налаштування маню сайта (називається SiteMap,
        Глава <a  href="#cha:SiteMap"  class="Reference">7↓</a>), перезаписування URL (Розділ <a
 href="#sec:URL-Rewriting"  class="Reference">3.7↓</a>), власний диспечер (Розділ <a
 href="#sec:Custom-dispatch-func"  class="Reference">3.8↓</a>), та пошук classpath (Розділ <a
 href="#sub:Class-Resolution"  class="Reference">3.2.1↓</a>). Сервлет Lift шукає клас <tt>bootstrap.liftweb.Boot</tt><a
 href="#index-Boot"  name="entry-Boot-1"  class="IndexReference">↓</a>, та виконує метод <tt>boot</tt> цього класу. Ви можете вказати ваш власний примірник Boot, використовуючи параметр ініціалізації <tt>bootloader<a
 href="#index-bootloader"  name="entry-bootloader-0"  class="IndexReference">↓</a></tt> для <tt>LiftFilter</tt>, як показано В Лістингу <a
 href="#lst:Overriding-bootloader"  class="Reference">3.2↓</a> </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Перекриття класу завантаження<a  name="lst:Overriding-bootloader"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_815663">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">filter</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain">... filter setup here ...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">init-param</code><code  class="xml plain">>     </code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">param-name</code><code  class="xml plain">>bootloader<!--</code--><code
 class="xml keyword">param-name</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">param-value</code><code  class="xml plain">>foo.bar.baz.MyBoot<!--</code--><code
 class="xml keyword">param-value</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">init-param</code><code
 class="xml plain">> </code></code></div><code  class="xml plain">
                        <div  class="line number7 index6 alt2"><code  class="xml plain"><!--</code--><code
 class="xml keyword">filter</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Ваш власний клас завантаження мусить бути суб-класом <tt>Bootable</tt><span
 class="FootOuter"><span  class="SupFootMarker"> 
            [O] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [O] </span><tt>net.liftweb.http.Bootable</tt></span></span>
та реалізувати метод <tt>boot</tt>. Метод <tt>boot</tt> буде виконуватись тілько один раз, так що ви можете покласти сюди також любі виклики ініціалізації для інших бібліотек. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-3.2.1"  class="toc">3.2.1</a> 
        Розрішення класів<a  name="sub:Class-Resolution"  class="Label"> </a> </h3>
      <div  class="Unindented">Як частина нашої дискусії по класу Boot,
        також важливо пояснити, як Lift визначає, де знайти класи для відображення Views та Snippet, коли використовується неявна диспечеризація (ми охопимо це в Розділі <a
 href="#sub:Implicit-Dispatch-Via"  class="Reference">5.2.1↓</a>). Метод
        <tt>LiftRules.addToPackages</tt> каже lift, які пакунки         Scala передивлятись для наданих класів. Lift має неявні розширення до шляхів, що ви введете: зокрема, якщо ви скажете Lift використовувати пакуок <tt>com.pocketchangeapp</tt>, Lift буде дивитись класи View в <tt>com.pocketchangeapp.view</tt>, Comet класи (Розділ <a
 href="#sec:COMET"  class="Reference">11.5↓</a>)
        в <tt>com.pocketchange</tt><tt><tt>app</tt>.comet</tt>, та класи Snippet
        (Глава <a  href="#cha:Snippets"  class="Reference">5↓</a>) в
        <tt>com.pocketchangeapp.snippet</tt>. Метод <tt>addToPackages</tt> повинен майже завжди виконуватись в вашому класі Boot. Мінімальний клас Boot може виглядати так: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Мінімальний клас Boot<a  name="lst:Minimal-Boot-class"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_488097">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.addToPackages(</code><code  class="scala string">"com.pocketchangeapp"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-3.3"  class="toc">3.3</a> Зауваження щодо стандартних імпортів</h2>
      <div  class="Unindented">В цілях збереження місця наступні твердження імпорту вважаються присутніми для всього коду прикладів на протязі залишку книги: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption">Стандартні твердження імпорту<a  name="lst:Standard-import-statements"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_358827">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.common.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">S.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">Helpers.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">scala.xml.</code><code  class="scala keyword">_</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-3.4"  class="toc">3.4</a> 
Головні об'єкти Lift</h2>
      <div  class="Unindented">Перед тим, як ми зануримось в основи Lift, ми бажаємо коротко обсудити три об'єкти, що ви будете щільно використовувати в вашому коді Lift.
        Ми охопимо їх більш детально пізніше в цій главі, та в подальших главах, так що можете вільно перейти далі, якщо бажаєте отримати більше деталей. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-3.4.1"  class="toc">3.4.1</a> 
        S<a  href="#index-S"  name="entry-S-0"  class="IndexReference">↓</a> object<a
 name="sub:S-object"  class="Label">
        </a> </h3>
      <div  class="Unindented">Об'єкт <tt>net.liftweb.http.S</tt>
представляє стан поточного запиту (згідно з David
        Pollak, “S” означає Stateful). Як такий, він використовується для отримання інформації щодо запиту, та модифікації інформації, що відсилається у відповідь. Окрім іншого, він може використовуватись для зауважень (Розділ <a
 href="#cha:Message-Handling"  class="Reference">B↓</a>) , управління cookie (Розділ <a
 href="#sec:Cookies"  class="Reference">3.10↓</a>), локалізації/інтернаціолізації
        (Глава <a  href="#cha:Internationalization"  class="Reference">D↓</a>) та перенаправлення (Розділ <a
 href="#sec:HTTP-redirects"  class="Reference">3.9↓</a>). </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-3.4.2"  class="toc">3.4.2</a> 
        SHtml<a  href="#index-SHtml"  name="entry-SHtml-0"  class="IndexReference">↓</a><a
 name="sub:SHtml"  class="Label"> </a> </h3>
      <div  class="Unindented">Головне призначення об'єкта <tt>net.liftweb.http.SHtml</tt>
        є визначення функцій генерації HTML,
        зокрема тих, що мають справу з полями форми. Ми охопимо форми в деталях в Главі <a
 href="#cha:Forms-in-Lift"  class="Reference">6↓</a>). На додаток до звичайних елементів форм, SHtml
визначає функції для елементів форм AJAX та JSON (Главаs <a  href="#cha:AJAX-and-COMET"
 class="Reference">11↓</a> та <a  href="#cha:Lift-and-Javascript"  class="Reference">10↓</a>, відповідно). </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-3.4.3"  class="toc">3.4.3</a> 
        LiftRules<a  href="#index-LiftRules"  name="entry-LiftRules-0"  class="IndexReference">↓</a> </h3>
      <div  class="Unindented">Об'єкт <tt>net.liftweb.http.LiftRules</tt> є місцем, що обробляється значна більшість глобальної конфігурації Lift. Майже все, що конфігурується щодо Lift, встановлюється на основі змінних в <tt>LiftRules</tt>. Оскільки LiftRules перекриває такий різноманітний диапазон функціональності, wми не будемо розглядати         <tt>LiftRules</tt> напряму, але коли ми будемо розглядати кожний з механізмів Lift, ми будемо торкатись змінних та методів <tt>LiftRules</tt>, що мають відношення до конфігурації цього механізму. </div>
      <h2  class="Section"> <a  name="toc-Section-3.5"  class="toc">3.5</a> Процес відтворення<a
 name="sec:The-Rendering-Process"  class="Label"> </a>
      </h2>
      <div  class="Unindented">Залишок цієї глави, так само, як декілька наступних глав, будуть присвячені стадіям відтворення Lift. Ми починаємо, надаючи короткий огляд процесу, як Lift
        трансформує запит в відповідь<a  href="#index-rendering-pipeline"  name="entry-rendering-pipeline-0"
 class="IndexReference">↓</a>.
        Ми збираємось тільки доторкнутись до найважливіших точок, хоча кроки, що ми обсудимо, будуть впорядковані, як Lift виконує їх. Значно більш деталізований тур щодо конвейера наданий в Розділі <a
 href="#sec:Request/Response-Lifecycle"  class="Reference">9.2↓</a>. Починаючи з початкового запита Lift буде робити наступне: </div>
      <ol>
        <li>Викоанає любе сконфігуроване переписування URL. Це охоплено в Розділі <a
 href="#sec:URL-Rewriting"  class="Reference">3.7↓</a>. </li>
        <li>Виконає любі співпадаючі власні функції диспечеризації. Це поділяється на обоє, диспечеризацію з та без стану, та більш детально розкривається в Розділі <a
 href="#sec:Custom-dispatch-func"  class="Reference">3.8↓</a>. </li>
        <li>Виконує автоматичну обробку запитів Comet та AJAX (Глава <a  href="#cha:AJAX-and-COMET"
 class="Reference">11↓</a>). </li>
        <li>Виконує налаштування та співпадіння SiteMap. SiteMap, описаний в Главі <a
 href="#cha:SiteMap"  class="Reference">7↓</a>, не тільки провадить гарну систему меню на рівні сайту, але може також виконувати контроль безпеки, перезапис URL, та іншу власну функціональність. </li>
        <li>Шукає шаблон XHTML, що має використовуватись для запиту. Це обробляється через три механізми:
          <ol>
            <li> Перевірки <tt>LiftRules.viewDispatch<a  href="#index-viewDispatch"
 name="entry-viewDispatch-0"  class="IndexReference">↓</a><a  href="#index-Views-Explicit-dispatch"
 name="entry-Views-Explicit-dispatch-0"  class="IndexReference">↓</a></tt>
              <tt>RulesSeq</tt>, щоб почабачити, чи визначені влаані правила  диспечера. Ми розкажемо про власну диспечерізацію переглядів в Розділі <a
 href="#sec:Request/Response-Lifecycle"  class="Reference">9.2↓</a>. </li>
            <li>Якщо немає співпадінь <tt>viewDispatch</tt>,
шукається файл шаблону <a  href="#index-template"  name="entry-template-1"  class="IndexReference">↓</a> , що співпадає, та використовується. Ми поговоримо про шаблони, та як вони шукаються, в Розділі <a
 href="#sec:Templates"  class="Reference">4.1↓</a>. </li>
            <li>Якщо файл шаблону не був знайдений, намагаємось знайти перегляд<a
 href="#index-Views"  name="entry-Views-0"  class="IndexReference">↓</a>, базуючись на неявній маршрутизації. Ми розглянемо це в  Розділі <a
 href="#sec:Views"  class="Reference">4.4↓</a>. </li>
          </ol>
        </li>
        <li> Обробляємо шаблон, включаючи вбудування інших шаблонів
          (Розділ <a  href="#sub:embed-tag"  class="Reference">4.5.7↓</a>), злиння елементів зі скомпонованих шаблонів
          (Розділ <a  href="#sec:Head-Merge"  class="Reference">↓</a>), та виконуємо функції уривка (Глава <a
 href="#cha:Snippets"  class="Reference">5↓</a>). </li>
      </ol>
      <div  class="Unindented">Залишок цієї глави буде присвячено, частково, ранішнім стадіям конвеєра відтворення, так само, як деяким зауваженням щодо головної функціональності Lift, як перенаправлення<a
 href="#index-redirect"  name="entry-redirect-0"  class="IndexReference">↓</a>. </div>
      <h2  class="Section"> <a  name="toc-Section-3.6"  class="toc">3.6</a> 
        Повідомлення про зауваження, попередження та помилки<a  name="sub:Notices/Warnings/Errors-messages"
 class="Label"> </a> </h2>
      <div  class="Unindented"> Зворотній зв'язок з користувачем є корисним. Застосування мають бути в змозі повідомляти користувачів про помилки, попереджати про потенційні проблеми, та повідомлять користувача, коли стан системи змінюється. Lift
провадить уніфіковану модель для таких повідомлень, що може використовуватись для статичних сторінок, так само, як для викликів AJAX та Comet. Ми розкриємо підтримку повідомлень в Додатку <a
 href="#cha:Message-Handling"  class="Reference">B↓</a>. </div>
      <h2  class="Section"> <a  name="toc-Section-3.7"  class="toc">3.7</a> Переписування URL <a
 name="sec:URL-Rewriting"  class="Label"> </a> </h2>
      <div  class="Unindented">Тепер, коли ми пройшлись по шаблонах, переглядах, уривках, та тому, як запити диспечеризуються до Class.method, ми можемо обсудити, як перехопити запити та обробити їх бажаним нам шляхом.
        Перезаписування URL <a  href="#index-rewriting"  name="entry-rewriting-0"
 class="IndexReference">↓</a><a  href="#index-URL-rewriting"  name="entry-URL-rewriting-0"
 class="IndexReference">↓</a> є механізмом, що дозволяє вам модифікувати входящі запити, так що вони перенаправляються на інший URL. Це може бути застосоване, окрім іншого, щоб дозволити вам: </div>
      <ul>
        <li>Використовувати дрвужні до користувача, запам'ятовувані URL, як
          <tt>http://www.example.com/budget/2008</tt> </li>
        <li>Використовувати короткі URL, замість довгих, зкладних до запам'ятовування, подібних до <a
 href="http://tinyurl.com/"  class="URL">http://tinyurl.com</a> </li>
        <li>Використовувати порції URL для визначення, як окремий уривок або перегляд відповідатиме. Наприклад, ви можете зробити так, що профіль користувача відображуеться через URL, такий, як <br />
          <tt>http://someplace.com/user/derek</tt>, замість того, що надсилати ім'я користувача як частини рядка запиту. </li>
      </ul>
      <div  class="Unindented">Механізм досить простий для налаштування. Нам треба написати часткову функію від RewriteRequest до RewriteResponse, щоб визначить, чи, та як, ми бажаємо переписати окремий запит. Коли ми маємо часткову функцію, ми модифікуємо конфігурацію         <tt>LiftRules.rewrite</tt>, щоб перехопити ланцюжок обробки Lift. Простіший шлях написати яасткову функцію є твердження порівняння Scala, що дозволить нам вибірково порівнювати деяку або всю інформацію запита. (Зауважте, що для часткової функції порівняння не мають бути вичерпні. В випадку, коли немає порівнянь RewriteRequest, RewriteResponse не буде згенеровано). Також важливо розуміти, що коли виконується функція перезаписування , сесія         Lift ще не створена. Це означає, що ви, загалом, не можете встановити або отримати доступ до властивостей в об'єкті S. RewriteRequest є <tt>case</tt> об'єктом, що містить три елементи: розібраний шлях, запитаний тип, та оригінальний HttpServletRequest<a
 href="#index-HttpServletRequest"  name="entry-HttpServletRequest-0"  class="IndexReference">↓</a>
        object. (Якщо ви не знайомі з кейс класами, ви можете переглянути документацію Scala щодо них. Додавання <tt>case</tt> модифікатора до класа призводить до деяких милих синтаксичних домовленостей).</div>
      <div  class="Indented"> Розібраний шлях запиту опиняється в примірнику кейс класа ParsePath<a
 href="#index-ParsePath"  name="entry-ParsePath-0"  class="IndexReference">↓</a>. Клас ParsePath містить </div>
      <ol>
        <li>Розібраний шлях, як List[String] </li>
        <li>Суфікс запита (тобто, “html”, “xml”, тощо) </li>
        <li>Чи цей шлях відносний до кореня. Якщо так, тоді він буде починатись з /<context-path>, за яким слідує залишок шляху.
          Наприклад, якщо ваше застосування розгорнуте на шляху контексту app (“/app”), та ми бажаємо посилатись на файл
          <webapp-folder>/pages/index.html, тоді відносний до кореня шлях буде /app/pages/index.html. </webapp-folder></context-path></li>
        <li>Чи він завершується на косу (“/”) </li>
      </ol>
      <div  class="Unindented">Три останні властивості корисні тільки в окремих випадках, але розібраний шлях є тим, що дозволяє нам робити магію. Шлях запиту визначений як частини URI між шляхом контексту та рядком запита. Наступна таблиця показує приклади розібраних шляхів для застосування Lift, під шляхом контекста “myapp”: </div>
      <div  class="Indented">
        <div  class="center">
          <table>
            <tbody>
              <tr>
                <td  valign="top"  align="left"> <b><span  class="footnotesize">Запитаннй URL</span></b> </td>
                <td  valign="top"  align="left"> <b><span  class="footnotesize">Розібраний шлях</span></b> </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> <span  class="footnotesize">http://foo.com/myapp/home?test_this=true</span>
                </td>
                <td  valign="top"  align="left"> <span  class="footnotesize">List[String](“home”)</span>
                </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> <span  class="footnotesize">http://foo.com/myapp/user/derek</span>
                </td>
                <td  valign="top"  align="left"> <span  class="footnotesize">List[String](“user”,
                    “derek”)</span> </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> <span  class="footnotesize">http://foo.com/myapp/view/item/14592</span>
                </td>
                <td  valign="top"  align="left"> <span  class="footnotesize">
                    List[String](“view”,”item”,”14592”)</span> </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div  class="Indented">RequestType відображує один з п'яти методів HTTP: GET, POST, HEAD, PUT та DELETE. Вони представлені відповідними GetRequest, PostRequest, тощо. кейс класами, та кейс клас UnknownRequest охоплює все незрозумуле. </div>
      <div  class="Indented"> Гнучкість системи співпадінь Scala - це те, що робить це потужним. Зокрема, коли порівнюються Lists, ми можемо порівняти частини шляху, та захопити інші. Наприклад, уявімо, що ми бажаємо переписати шлях <tt>/account/<account
 name=""></account></tt>, так, щоб він був оброблений шаблоном
        <tt>/viewAcct</tt>, як показано в Лістингу <a  href="#lst:Simple-rewrite-example"
 class="Reference">3.7↓</a>. В цьому випадку ми провадимо два перезаписи. Перший співпадає з /account/<account
 name="">, та перенаправляє до шаблону
        /viewAcct, передаючи acctName як параметр “name”. Другий співпадає з /account/<account
 name="">/<tag>, пересилаючи його на /viewAcct, як раніше, але передаючи обоє параметри,  “name” та “tag”, з acctName та tag співпадіннями з ParsePath, відповідно. Пам'ятайте, що підкреслення (_) в ціх твердженнях співпадіння означає, що ми не опікуємось, що це за параметр, тобто, що тут співпало. </tag></account></account></div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Простий приклад перезапису<a  name="lst:Simple-rewrite-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_761353">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">LiftRules.rewrite.append {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">RewriteRequest(</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">         </code><code
 class="scala plain">ParsePath(List(</code><code  class="scala string">"account"</code><code
 class="scala plain">,acctName),</code><code  class="scala keyword">_</code><code
 class="scala plain">,</code><code  class="scala keyword">_</code><code  class="scala plain">,</code><code
 class="scala keyword">_</code><code  class="scala plain">),</code><code  class="scala keyword">_</code><code
 class="scala plain">,</code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">         </code><code
 class="scala plain">RewriteResponse(</code><code  class="scala string">"viewAcct"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil, Map(</code><code
 class="scala string">"name"</code> <code  class="scala plain">-> acctName))</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">RewriteRequest(</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">         </code><code
 class="scala plain">ParsePath(List(</code><code  class="scala string">"account"</code><code
 class="scala plain">,acctName, tag),</code><code  class="scala keyword">_</code><code
 class="scala plain">,</code><code  class="scala keyword">_</code><code  class="scala plain">,</code><code
 class="scala keyword">_</code><code  class="scala plain">),</code><code  class="scala keyword">_</code><code
 class="scala plain">,</code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">         </code><code
 class="scala plain">RewriteResponse(</code><code  class="scala string">"viewAcct"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil, Map(</code><code
 class="scala string">"name"</code> <code  class="scala plain">-> acctName,</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">                                                </code><code
 class="scala string">"tag"</code> <code  class="scala plain">-> tag)))</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> RewriteResponse<a  href="#index-RewriteResponse"  name="entry-RewriteResponse-0"
 class="IndexReference">↓</a> просто містить новий шлях, яким треба слідувати. Він також приймає Map<a
 href="#index-Map"  name="entry-Map-0"  class="IndexReference">↓</a>, що містить параметри, що будуть доступні через S.param<a
 href="#index-S.param"  name="entry-S.param-0"  class="IndexReference">↓</a><a  href="#index-S"
 name="entry-S-1"  class="IndexReference">↓</a> в уривку або перегляді. Як ми вже встановити, LiftSession (і, таким чином, більшість S)
        не доступна на цей час, так що Map є єдиним шляхом передати інформацію до перезаписаного місця. </div>
      <div  class="Indented">Ми можемо комбінувати співпадіння ParsePath з 
        RequestType та HttpServletRequest, щоб бути дуже специфічним щодо співпадінь.
        Наприклад, якщо ми бажаємо підтримати дієслово DELETE HTTP для RESTful<span
 class="FootOuter"><span  class="SupFootMarker"> [P] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [P] </span></span></span><a  href="#index-RESTful"  name="entry-RESTful-0"
 class="IndexReference">↓</a> інтерфейса через існуючий шаблон, ми можемо переписати, як показано в Лістингу <a
 href="#lst:Complex-rewrite-example"  class="Reference">3.7↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Складний приклад переписування<a  name="lst:Complex-rewrite-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_285000">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">LiftRules.rewrite.append {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">RewriteRequest(ParsePath(</code><code
 class="scala string">"username"</code> <code  class="scala keyword">::</code> <code
 class="scala plain">Nil, </code><code  class="scala keyword">_</code><code  class="scala plain">, </code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">_</code><code
 class="scala plain">),</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">                      </code><code
 class="scala plain">DeleteRequest,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                      </code><code
 class="scala plain">httpreq) </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">                      </code><code
 class="scala keyword">if</code> <code  class="scala plain">isMgmtSubnet(httpreq.getRemoteHost()) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">       </code><code
 class="scala plain">RewriteResponse(</code><code  class="scala string">"deleteUser"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil, Map(</code><code
 class="scala string">"username"</code> <code  class="scala plain">-> username))</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Ми дійдемо до деталей щодо того, як ви можете використовувати це в наступних розділах. Зокрема, SiteMap<a
 href="#index-SiteMap"  name="entry-SiteMap-1"  class="IndexReference">↓</a> (Глава <a
 href="#cha:SiteMap"  class="Reference">7↓</a>) провадить механізм для виконання переписування, в комбінації з елементами меню. </div>
      <h2  class="Section"> <a  name="toc-Section-3.8"  class="toc">3.8</a> Власні функції диспечеризації <a
 name="sec:Custom-dispatch-func"  class="Label">
        </a> </h2>
      <div  class="Unindented">Коли фаза переписування завершена (чи ми пройшли скрізь, чи перенаправлені), наступна фаза є визначення, чи ми потребуємо власну диспечеризацію для запиту. Власна диспечеризація дозволяє вам обробляти співпадаючі запити напряму в методі, замість проходження через систему пошуку шаблонів. Оскільки це обходить шаблони, ви відповідальні за весь вміст відповіді. Типовим прикладом використання може бути веб сервіс<a
 href="#index-web-service"  name="entry-web-service-0"  class="IndexReference">↓</a>, що повертає
        XML, або сервіс, що повертає, скажімо, згенероване зображення або PDF. В цьому сенсі механізм власного диспечера дозволяє вам писати ваші власні “суб-сервлети”, без всього безладу реалізації інтерфейса, та конфігурації їх в web.xml<a
 href="#index-web.xml"  name="entry-web.xml-1"  class="IndexReference">↓</a>. </div>
      <div  class="Indented">Як і з переписуванням, власна диспечеризація реалізована через часткову функцію. В цьому випадку, це функція типу <tt>PartialFunction[Req,<span
 class="formula">()  ⇒ <i>Box</i>[<i>LiftResponse</i>]</span>]</tt>, що виконує всю роботу. <tt>Req</tt> подібне до кейс класу <tt>RewriteRequest</tt>: він провадить шлях як <tt>List[String]</tt>, суфікс запиту, та <tt>RequestType</tt>. Є три шляхи, що ви можете встановити функцію власної диспечеризації: </div>
      <ol>
        <li> Глобально, через <tt>LiftRules.dispatch</tt><a  href="#index-LiftRules-dispatch"
 name="entry-LiftRules-dispatch-0"  class="IndexReference">↓</a><a  href="#index-Custom-dispatch-stateful"
 name="entry-Custom-dispatch-stateful-0"  class="IndexReference">↓</a>
        </li>
        <li>Глобально, через <tt>LiftRules.statelessDispatchTable</tt><a  href="#index-LiftRules-statelessDispatchTable"
 name="entry-LiftRules-statelessDispatchTable-0"  class="IndexReference">↓</a><a
 href="#index-Custom-dispatch-stateless"  name="entry-Custom-dispatch-stateless-0"
 class="IndexReference">↓</a>
        </li>
        <li>По-сессійно, через
          <tt>S.addHighLevelSessionDispatcher</tt><a  href="#index-S-addHighLevelSessionDispatcher"
 name="entry-S-addHighLevelSessionDispatcher-0"  class="IndexReference">↓</a><a
 href="#index-Custom-dispatch-per-session"  name="entry-Custom-dispatch-per-session-0"
 class="IndexReference">↓</a>
        </li>
      </ol>
      <div  class="Unindented">Якщо ви прикріплюєте функцію диспечеризації через 
        <tt>LiftRules.dispatch</tt> або
        <tt>S.addHighLevelSessionDispatcher</tt>, тоді ви маєте повний доступ до об'єкта <tt>S</tt>,
        <tt>SessionVar</tt> та <tt>LiftSession</tt>;
        якщо ви замість цього використовуєте <tt>LiftRules.statelessDispatchTable</tt>, тоді вони не доступні. Результат диспечеризації повинен бути функцією, що повертає <tt>Box[LiftResponse]</tt>. Якщо функція повертає <tt>Empty</tt>, тоді Lift повертає відповідь “404 Not Found”. </div>
      <div  class="Indented">Як конкретний приклад, давайте подивимось на повернення згенерованого зображення графіка з нашого застосування. Є декілька бібліотек для малювання діаграм, але ми, зокрема, поглянемо на  JFreeChart. Перше, давайте напишемо метод, що буде відображати наш баланс рахунку по місяціх минулого року: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption">Метод малювання діаграми<a  name="lst:Charting-method"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_550377">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">chart (endDate </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Box[LiftResponse] </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// запит, встановлення, тощо... </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">buffered </code><code
 class="scala keyword">=</code> <code  class="scala plain">balanceChart.createBufferedImage(width,height)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">chartImage </code><code
 class="scala keyword">=</code> <code  class="scala plain">ChartUtilities.encodeAsPNG(buffered)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// InMemoryResponse є субкласом LiftResponse</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// він приймає Array з Bytes, List[(String,String)] з</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// заголовків, List[Cookie] з кукіз, та ціле як</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// код повернення (тут 200 для HTTP 200: OK)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">Full(InMemoryResponse(chartImage, </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">                        </code><code
 class="scala plain">(</code><code  class="scala string">"Content-Type"</code> <code
 class="scala plain">-> </code><code  class="scala string">"image/png"</code><code
 class="scala plain">) </code><code  class="scala keyword">::</code> <code  class="scala plain">Nil,</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">                        </code><code
 class="scala plain">Nil,</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">                        </code><code
 class="scala value">200</code><code  class="scala plain">))</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Як тільки ми встановили діаграму, ми використовуємо         клас-допоміжник ChartUtilities  з JFreeChart щоб закодувати діаграму в байтовий масив PNG. Ми можемо потім використати Lift InMemoryResponse<a
 href="#index-InMemoryResponse"  name="entry-InMemoryResponse-0"  class="IndexReference">↓</a> для передачі закодованих даних назад з відповідним заголовком Content-Type<a
 href="#index-Type"  name="entry-Type-0"  class="IndexReference">↓</a>. Тепер нам тільки треба перехопити запит в таблиці диспечеризації від Boot класа, як показано в Лістингу 
        <a  href="#lst:Hooking-dispatch-into-Boot"  class="Reference">3.8↓</a>. В цьому випадку ми бажаємо наголосити, що ми можемо отримати діаграму поточного користувача. З цієї причини ми використовуємо <tt>LiftRules.dispatch</tt> на відміну від <tt>LiftRules.statelessDispatch</tt>. Оскільки ми використовуємо часткову функцію для виконання операції співпадіння Scala, випадок, який ми визначаємо тут, використовує метод <tt>unapply</tt>  <tt>Req</tt> об'єкта, ось чому ми повинні провадити тільки аргумент <tt>List[String]</tt>.
        <div  class="listing">
          <div  class="caption"> Перехоплення диспечеризації в Boot<a  name="lst:Hooking-dispatch-into-Boot"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_236218">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">LiftRules.dispatch.append {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(</code><code  class="scala string">"chart"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"balances"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">endDate </code><code
 class="scala keyword">::</code> <code  class="scala plain">Nil, </code><code  class="scala keyword">_</code><code
 class="scala plain">, </code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Charting.chart(endDate) </code><code  class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Як ви можете бачити, ми захопили параметр endDate зі шляха, та передали його в метод діаграми. Це означає, що ми можемо використовувати URL як
        <tt>http://foo.com/chart/balances/20080401</tt> для отримання зображення. Оскільки функція була асоційована з сесією Lift,
        ми можемо також використовувати метод S.param для отримання параметрів рядка запиту, якщо, наприклад, ми бажаємо дозволити декому надсилати опціональні ширину та висоту: </div>
      <pre  class="LyX-Code">val width = S.param(“width”).map(_.toInt) openOr 400
val height = S.param(“height”).map(_.toInt) openOr 300
</pre>
      <div  class="Unindented">Або ви можете використати трохи інший підхід, використовуючи метод <tt>Box.dmap</tt>: </div>
      <pre  class="LyX-Code">val width = S.param(“width”).dmap(400)(_.toInt)
val height = S.param(“height”).dmap(300)(_.toInt)
</pre>
      <div  class="Unindented">Тут dmap ідентичний з функцією map, за тією різницею, що перший аргумент є занченням по замовчанню, якщо <tt>Box</tt> є <tt>Empty</tt>. Є декілька інших субкласів ListResponse , що треба охопити для наших потреб, включаючи відповіді для XHTML, XML, Atom, Javascript, CSS, та JSON. Ми розглянемо їх більш докладно в Розділі <a
 href="#sec:LiftResponse-in-Detail"  class="Reference">9.4↓</a>. </div>
      <h2  class="Section"> <a  name="toc-Section-3.9"  class="toc">3.9</a> Перенаправлення
        HTTP <a  name="sec:HTTP-redirects"  class="Label"> </a> </h2>
      <div  class="Unindented">Перенаправлення HTTP є важливою частиною багатьох веб застосувань. В Lift є два головні шляхи надсилання перенаправлення до клієнта: </div>
      <ol>
        <li> Виклик S.redirectTo. Коли ви робите це, Lift підіймає виключення, та потім його перехоплює. Це означає, що любий код після перенаправлення пропускається. Якщо ви використовуєте StatefulSnippet (Розділ <a
 href="#sub:Stateless-versus-Stateful"  class="Reference">5.3.3↓</a>), використовуйте <tt>this.redirectTo</tt>, так що ваш примірник уривку використовується при обробці перенаправлення.
          <div  class="Unindented">
            <div  style="width: 80%;"  class="Shadowbox"> <b>Важливо:</b> якщо ви використовуєте S.redirectTo в блоці try/catch, вам треба переконатись, що ви не відловлюєте виключення перенаправлення (Scala використовує неперевірені виключення), або перевірте виключення перенаправлення, та знову підійміть його. Якщо ви помилково спіймаєте виключення перенаправлення, тоді саме перенаправленя не відбудеться.</div>
          </div>
        </li>
        <li> Коли вам треба повернути LiftResponse, ви можете просто повернути відповідь RedirectResponse або RedirectWithState. </li>
      </ol>
      <div  class="Unindented">Відповідь RedirectWithState дозволяє вам вказати функцію, що треба виконати, коли обробляється перенаправлений запит. Ви можете також надіслати повідомлення Lift (повідомлення. попередження або помилки), що будуть відображені на перенаправленій сторінці, так само, як кукіз, що будуть відіслані в перенаправлення. Подбіним чином є перевантажена версія S.redirectTo, що дозволяє вам вказати функцію, що має бути виконана, коли буде оброблятись переназначення. </div>
      <h2  class="Section"> <a  name="toc-Section-3.10"  class="toc">3.10</a> Кукіз<a
 name="sec:Cookies"  class="Label"> </a> </h2>
      <div  class="Unindented"> Кукіз<span  class="FootOuter"><span  class="SupFootMarker"> 
            [Q] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Q] </span><a  href="http://java.sun.com/products/servlet/2.2/javadoc/javax/servlet/http/Cookie.html"
 class="URL">http://java.sun.com/products/servlet/2.2/javadoc/javax/servlet/http/Cookie.html</a></span></span>
є корисним інструментом, коли ви бажаєте сталих даних між сесіями користувача.        Кукіз в основі є токеном з рядка даних, що зберігається на машині користувача. Хоча вони досить корисні, є декілька речей, що ви повинні мати на увазі: </div>
      <ol>
        <li>Переглядач користувача може відключити кукіз, і в такому випадку вам треба приготуватись для роботи без кукіз, або сповістити користувача, що йому потрібно ввімкнути кукіз для вашого сайта </li>
        <li>Кукіз відносно небезпечні<span  class="FootOuter"><span  class="SupFootMarker"> 
              [R] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
                [R]  Дивіться</span><a  href="http://www.w3.org/Security/Faq/wwwsf2.html"
 class="URL">http://www.w3.org/Security/Faq/wwwsf2.html</a>
              (Q10) та <a  href="http://www.cookiecentral.com/faq/"  class="URL">http://www.cookiecentral.com/faq/</a>
              щодо деталей про кукіз, та їх проблеми з безпекою.. Є декіка багів переглядачів, пов'язаних з даними в кукіз, які можуть читати віруси або інші сайти</span></span></li>
        <li>Кукіз просто підробити, так що вам треба переконатись, що ви перевірили любі чултиві дані з кукіз</li>
      </ol>
      <div  class="Unindented">Використання Cookies в Lift є дуже простим. В контексті зі станом, все, що вам треба, провадиться декількома методами на об'єкті S: </div>
      <div  class="Description"> <span  class="Description-entry">addCookie</span> 
Додає кукі, що буде відіслана у відповіді </div>
      <div  class="Description"> <span  class="Description-entry">deleteCookie</span> 
Видаляє кукі (технічно, це додає кукі з максимальним часом життя ноль, так що переглядач видаляє її). Ви можете або видалити кукі по імені, або через об'єкт Cookie</div>
      <div  class="Description"> <span  class="Description-entry">findCookie</span> 
        Шукає кукі за наданим ім'ям, та повертає Box[Cookie]. Empty
        означає, що кукі не існує</div>
      <div  class="Description"> <span  class="Description-entry">receivedCookies</span> 
        Повертає List[Cookie] з усіх кукі, надісланих у запиті</div>
      <div  class="Description"> <span  class="Description-entry">responseCookies</span> Повертає List[Cookie] з кукіз, що будуть надіслані у відповіді</div>
      <div  class="Unindented">Якщо вам треба робити з кукіз в контексті без стану, багато з класів ListResponse (Розділ <a
 href="#sec:LiftResponse-in-Detail"  class="Reference">9.4↓</a>) включають List[Cookie] в свої конструктори або аргументи <tt>apply</tt>. Просто надайте список кукіз, що ви бажаєте встановити, та вони будуть надіслані у відповідь. Якщо ви бажаєте видалити кукі з LiftResponse, ви маєте зробити це вручну, додавши кукі з тим же ім'ям, та <tt>maxage</tt> рівним нулю. </div>
      <h2  class="Section"> <a  name="toc-Section-3.11"  class="toc">3.11 </a>Стан сесії та запиту <a
 name="sec:Session-and-Request"  class="Label">
        </a> </h2>
      <div  class="Unindented"> Lift провадить дуже простий шлях для зберігання даних рівня сесії та запиту, через класи SessionVar та RequestVar. В стилі Lift, ці класи провадять: </div>
      <ul>
        <li>Типо-безпечний доступ до даних, що вони містять</li>
        <li>Мезанізм для провадження значення по замовчанню, якщо сесія або запит досі не існують</li>
        <li>Механізм для очистки даних, коли життєвий цикл змінної завершується</li>
      </ul>
      <div  class="Unindented">Додатково, Lift провадить простий доступ до параметрів запиту HTTP<a
 href="#index-request-parameters"  name="entry-request-parameters-0"  class="IndexReference">↓</a> через метод S.param, що повертає Box[String]. Зауважте, що параметри запиту  HTTP (надіслані через GET або POST) відрізняються від RequestVars в тому, що параметри запиту є значеннями рядків, надісланих як частина запиту; RequestVars, на відміну, використовують внутрішній Map для кожного запиту, так що вони можуть містити любий тип, та ініціалізуються повністю в коді. В цій точці ви можете запитати, для чого можна застосувати RequestVars. Типовий приклад є розділення стану між різними уривками, оскільки немає іншого зв'язку між ними, ніж на рівні шаблону. </div>
      <div  class="Indented"> SessionVars та RequestVars призначені бути реалізованими як об'єкти-синглтони, так що вони доступні будь-де у вашому коді. Лістинг <a
 href="#lst:Defining-a-RequestVar"  class="Reference">3.11↓</a> показує приклад визначення RequestVar, що використовується для зберігання числа елементів, що треба відображувати на сторінці. Ми починаємо, визначаючи об'єкт, як такий, що розширює RequestVar. Ви повинні провадити тип RequestVar, так що Lift знає, що сприймати та повертати. В цьому разі тип є Int. Пргумент конструктора є параметром за-ім'ям, що має обраховуватись до типу var. В нашому випадку ми намагаємось використати змінну запиту HTTP “pageSize,” та якщо вона не присутня або це не ціле, тоді ми беремо замовчання 25. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Визначення RequestVar<a  name="lst:Defining-a-RequestVar"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_946581">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">AccountOps {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">pageSize </code><code
 class="scala keyword">extends</code> <code  class="scala plain">RequestVar[Int](S.param(</code><code
 class="scala string">"pageSize"</code><code  class="scala plain">).map(</code><code
 class="scala keyword">_</code><code  class="scala plain">.toInt) openOr </code><code
 class="scala value">25</code><code  class="scala plain">)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Доступ до значення <tt>RequestVar</tt> робиться через метод <tt>is</tt>. Ви можете також встановити значення, використовуючи метод <tt>apply</tt>, що в Scala синтаксично подібне до використання <tt>RequestVar</tt> як функції. Загальні використання apply в
        Scala аключають доступ до елементів масиву по індексу, та методу об'єкта-компанйона, що можуть апроксимувати власні конструктори. Наприклад, об'єкт         <tt>Loc</tt> (що ми розглянемо в Главі <a
 href="#cha:SiteMap"  class="Reference">7↓</a>), має перевантажений метод
        <tt>apply</tt>, що створює новий примірник класу <tt>Loc</tt>, базуючись на вхідних параметрах. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Доступ до RequestVar<a  name="lst:Accessing-the-RequestVar"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_883983">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// отримуємо значення з AccountOps.pageSize RequestVar</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">query.setMaxResults(AccountOps.pageSize.is)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala comments">// Змінюємо значення RequestVar. Два наступні рядка</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala comments">// кода є еквівалентними:</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">AccountOps.pageSize(</code><code
 class="scala value">50</code><code  class="scala plain">)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">AccountOps.pageSize.apply(</code><code
 class="scala value">50</code><code  class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">На додаток до прийняття параметрів, що визначають значення по замовчанню, ви також можете очистит значення, коли змінна закінчує життєвий цикл. Лістинг <a
 href="#lst:Defining-a-Cleanup"  class="Reference">3.11↓</a> показує приклад відкриття сокета, та його зачинення в кінці запиту. Все це обробляється передачею функції до метода <tt>registerCleanupFunc</tt>. тип функції, що вам треба передати, є <span
 class="formula"><i>CleanUpParam</i> 
          ⇒ <i>Unit</i></span>, де <tt>CleanUpParam</tt> визначений базуючись на тому, чи ви використовуєте <tt>RequestVar</tt> або  <tt>SessionVar</tt>. З <tt>RequestVar</tt>, <tt>CleanUpParam</tt> є типу <tt>Box[LiftSession]</tt>, відображуючи те, що сесія може не бути в полі зору, коли виконується функція очищення. ДЛя <tt>SessionVar</tt> <tt>CleanUpParam</tt> є типу <tt>LiftSession</tt>, оскільки сесія завжди в полі зору для <tt>SessionVar</tt> (він містить посилання на сесію). В нашому прикладі в Лістингу<a
 href="#lst:Defining-a-Cleanup"  class="Reference">3.11↓</a> ми просто ігноруємо вхідні параметри до функції очищення, оскільки закриття сокету є незалежним від жодного стану сесії. Інша важлива річ, що треба запам'ятати, те що ви відповідальні за обробку любих виключень, що можуть піднятись на протязі або ініціалізації, або очистки по замовчанню. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Визначення функції очищення<a  name="lst:Defining-a-Cleanup"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_278602">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">mySocket </code><code  class="scala keyword">extends</code> <code
 class="scala plain">RequestVar[Socket](</code><code  class="scala keyword">new</code> <code
 class="scala plain">Socket(</code><code  class="scala string">"localhost:23"</code><code
 class="scala plain">)) {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">registerCleanupFunc(ignore </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala keyword">this</code><code  class="scala plain">.is.close)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Інформація, що ми тут розкрили, також стосуєтся і до SessionVars; єдина різниця між ними є поле зору іх відповідних життєвих циклів. </div>
      <div  class="Indented">Інше загальне застосування <tt>RequestVar</tt> є передача стану між різними переглядами сторінки (запитами). Ми починаємо, визначивши <tt>RequestVar</tt> на об'єкті, так що воно доступне з усіх методів уривка, що будуть читати або записувати його. Також можливо визначити його на класі, якщо всі уривки, що будуть отримувати доступ до нього, є в цьому класі . Тоді, в частинах вашого кода, що буде переходити на нову сторінку, ви використовуєте перевантажені версії
        <tt>SHtml.link</tt> або<tt> S.redirectTo</tt>, що приймає функцію як другий аргумент щоб “інжектувати” значення, яке ви бажаєте передати через <tt>RequestVar</tt>. Це подібне до використання параметрів запиту на URL для передачі даних, але є дві важливі переваги: </div>
      <ol>
        <li>Ви можете передати любий тип даних через 
          <tt>RequestVar</tt>, на відміну від тільки рядків даних в параметрі запиту. </li>
        <li> Ви насправді передаєте посилання на функцію інжектора, на відміну від самих даних. Це може біти важливо, якщо ви не бажаєте, щоб користувач бавився з переданими даними. Одним прикладом може бути передача вартості товару зі сторінки “перегляд товару” до сторінки “додати до корзини”. </li>
      </ol>
      <div  class="Unindented">Лістинг <a  href="#lst:Passing-an-Account"  class="Reference">3.11↓</a> показує, як передавати Account з таблиці переліку до окремої сторінки редагування Account, з використанням <tt>SHtml.link</tt>, так само, та як ми можемо перейти від сторінки редагування до сторінки перегляду з використанням <tt>S.redirectTo</tt>.
Інший приклад передачі показаний на Лістингу <a  href="#lst:Passing-Detached-Instances"
 class="Reference">12.1.3↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Передача Account до View<a  name="lst:Passing-an-Account"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_310531">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">AccountOps {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">currentAccountVar </code><code
 class="scala keyword">extends</code> <code  class="scala plain">RequestVar[Account](</code><code
 class="scala keyword">null</code><code  class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">manage (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) ... {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">User.currentUser.map({user </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">user.accounts.flatMap({acct </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">bind(</code><code  class="scala string">"acct"</code><code
 class="scala plain">, chooseTemplate(</code><code  class="scala string">"account"</code><code
 class="scala plain">, </code><code  class="scala string">"entry"</code><code  class="scala plain">, xhtml),</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">...</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">          </code><code
 class="scala comments">// Другий аргумент робить інжекцію "acct" val</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">          </code><code
 class="scala comments">// назад до RequestVar</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">link(</code><code  class="scala string">"/editAcct"</code><code
 class="scala plain">, () </code><code  class="scala keyword">=</code><code  class="scala plain">> currentAccountVar(acct), Text(</code><code
 class="scala string">"Edit"</code><code  class="scala plain">))</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">})</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">})</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">edit (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">doSave () {</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">...</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">val</code> <code  class="scala plain">acct </code><code  class="scala keyword">=</code> <code
 class="scala plain">currentAccountVar.is</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">S.redirectTo(</code><code  class="scala string">"/view"</code><code
 class="scala plain">, () </code><code  class="scala keyword">=</code><code  class="scala plain">> currentAccountVar(acct))</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">Одна важлива річ, що треба занотувати, полягає в тому, що змінна інжетора викликається в полі зору <i>наступного </i>запиту. Це означає, що якщо ви бажаєте значення, повернуте функцією, в точці, де ви викликаєте link або redirectTo, вам треба захопити її в val. Інакше функція буде визиватись <i>після</i> перенаправлення або пов'язання, що може призвести до іншого значення, ніж ви очікували. Як ви можете бачити з Лістинга <a
 href="#lst:Passing-an-Account"  class="Reference">3.11↑</a>, ми встановили val в вашому методі doSave перед перенаправленням. Якщо ви спробуєте щось подібне до  </div>
      <pre  class="LyX-Code">S.redirectTo("/view", () => currentAccountVar(currentAccountVar.is))
</pre>
      <div  class="Unindented">замість цього, ми можемо отримати значення по замовчанню для нашої RequestVar (в цьому випадку null). </div>
      <h2  class="Section"> <a  name="toc-Section-3.12"  class="toc">3.12 </a>Висновок   </h2>
      <div  class="Unindented">Ми розглянули багато матеріалу, та все ще багато залишилось. Надіємось, ця глава провадить надійний базис для початку, перед дослідженням залишку книги. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-4"  class="toc">4</a> Шаблони в Lift </h1>
      <div  class="Unindented"> An XHTML page, being the central component of a
        web application, is likewise the central component of Lift’s request
        processing. In Lift, we go a step further and utilize a flexible yet
        powerful templating engine that allows us to compose an XHTML<a  href="#index-XHTML"
 name="entry-XHTML-0"  class="IndexReference">↓</a> page not only out
        of one or more XML<a  href="#index-XML"  name="entry-XML-0"  class="IndexReference">↓</a> files, but also from
        methods that can programmaticaly generate template XML. Additionally,
        Lift 2.2<a  href="#index-Lift-2.2"  name="entry-Lift-2.2-0"  class="IndexReference">↓</a> brings
        designer-friendly templates (Розділ <a  href="#sec:Designer-Friendly-Templates"
 class="Reference">4.2↓</a>) and HTML5 support (Розділ <a  href="#sec:HTML5-Support"
 class="Reference">4.3↓</a>). Designer-friendly templates, in
        particular, can simplify working with a designer because they allow
        templates to be fully valid XHTML or HTML5. </div>
      <div  class="Indented"> In this chapter we’ll discuss template
        capabilities and syntax, including built-in tags provided by Lift that
        perform special template processing (Розділ <a  href="#sec:ArchTags"  class="Reference">4.5↓</a>). We will also cover how you can write
        your own View classes, Scala code that can programmatically generate
        template XML (Розділ <a  href="#sec:Views"  class="Reference">4.4↓</a>). We’ll finish up the chapter with some
        discussion on miscellaneous templating functionality. </div>
      <h2  class="Section"> <a  name="toc-Section-4.1"  class="toc">4.1</a> 
        Template XML<a  name="sec:Templates"  class="Label"> </a> </h2>
      <div  class="Unindented"> Templates<a  href="#index-Templates"  name="entry-Templates-0"
 class="IndexReference">↓</a> form the
        backbone of Lift’s flexibility and power. A template is an XML document
        that contains Lift-specific tags, see <a  href="#sec:ArchTags"  class="Reference">4.5↓</a>, as well as whatever content you want
        returned to the user. </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> A note on nomenclature:
            typically when people discuss “templates” in books or on the mailing
            list they’re talking about XML files. We’ll cover programmatic
            generation of template XML in Розділ <a  href="#sec:Views"  class="Reference">4.4↓</a>. </div>
        </div>
      </div>
      <div  class="Indented"> Lift includes several built-in XML tags for
        specific actions. These utilize prefixed XML elements and are of the
        form <tt><lift:tag_name></lift:tag_name></tt>. Lift also allows you
        to define your own tags, which are called <i>snippets</i><a  href="#index-snippets"
 name="entry-snippets-0"  class="IndexReference">↓</a> (Глава <a  href="#cha:Snippets"
 class="Reference">5↓</a>). These user-defined tags are linked to
        Scala methods and these methods can process the XML contents of the
        snippet tag, or can generate their own content from scratch. A simple
        template is shown in Listing <a  href="#lst:Sample-template"  class="Reference">4.1↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Sample Template<a  name="lst:Sample-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_686572">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">head</code><code  class="xml plain">><</code><code
 class="xml keyword">title</code><code  class="xml plain">>Hello!<!--</code--><code
 class="xml keyword">title</code><code  class="xml plain">><!--</code--><code  class="xml keyword">head</code><code
 class="xml plain">></code></code></code></div><code  class="xml plain"><code  class="xml plain">
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:Hello.world</code> <code
 class="xml plain">/></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Notice the tags that are of the form
        <tt><lift:name></lift:name></tt> which in this case are
        <tt><lift:surround></lift:surround></tt> and
        <tt><lift:snippet>. </lift:snippet></tt>These are two examples of
        Lift-specific tags. We’ll discuss all of the tags that users will use in
        Розділ <a  href="#sec:ArchTags"  class="Reference">4.5↓</a>, but let’s briefly discuss the two shown
        here. We use the built-in <tt><lift:surround><a  href="#index-lift:surround"
 name="entry-lift:surround-0"  class="IndexReference">↓</a></lift:surround></tt>
        tag (Розділ <a  href="#sub:surround-tag"  class="Reference">4.5.17↓</a>) to make Lift embed our current
        template inside the “default” template. We also use
        <tt><lift:snippet></lift:snippet></tt> tag (aliased to Hello.world)
        to execute a snippet that we defined. In this instance, we execute the
        method <tt>world</tt> in the class <tt>Hello
        </tt>to generate some content. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.1.1"  class="toc">4.1.1</a> 
        Locating Template XML </h3>
      <div  class="Unindented"> During request processing, Lift first tries to
        match against the <tt>LiftRules.viewDispatch<a  href="#index-viewDispatch"
 name="entry-viewDispatch-1"  class="IndexReference">↓</a><a  href="#index-Views-Explicit-dispatch"
 name="entry-Views-Explicit-dispatch-1"  class="IndexReference">↓</a></tt>
        function to see if an explicit View method is defined for the request.
        If there isn’t a <tt>viewDispatch</tt> match, then Lift next
        tries to locate a file in the template directory tree (typically in a
        WAR archive) that matches the request. Lift tries several suffixes
        (html, xhtml, htm, and no suffix) and also tries to match based on the
        client’s <tt>Accept-Language</tt> header. The pattern Lift
        uses is: </div>
      <pre  class="LyX-Code"><path  to=""  template="">[_<language  tag="">][.<suffix>]
</suffix></language></path></pre>
      <div  class="Unindented"> Because Lift will implicitly search for
        suffixes, it’s best to leave the suffix off of your links within the web
        app. If you have a link with an href of
        <tt>/test/template.xhtml</tt>, it will only match that file,
        but if you use <tt>/test/template</tt> for the href and you
        have the following templates in your web app: </div>
      <ul>
        <li> <tt>/test/template.xhtml</tt> </li>
        <li> <tt>/test/template_es_ES.xhtml (Spanish localized for
          Spain)</tt> </li>
        <li> <tt>/test/template_ja.xhtml</tt> </li>
      </ul>
      <div  class="Unindented"> then Lift will use the appropriate template
        based on the user’s requested language if a corresponding template is
        available. For more information regarding internationalization please
        see Appendix <a  href="#cha:Internationalization"  class="Reference">D↓</a>. In addition to normal templates, your
        application can make use of hidden templates<a  href="#index-hidden-templates"
 name="entry-hidden-templates-0"  class="IndexReference">↓</a>. These
        are templates that are located under the
        <tt>/templates-hidden</tt> directory of your web app.
        Technically, Lift hides files in any directory ending in “-hidden”, but
        templates-hidden is somewhat of a de facto standard. Like the
        <tt>WEB-INF</tt> directory, the contents cannot be directly
        requested by clients. They can, however, be used by other templates
        through mechanisms such as the
        <tt><lift:surround></lift:surround></tt> and
        <tt><lift:embed></lift:embed></tt> tags (Розділ <a  href="#sub:embed-tag"
 class="Reference">4.5.7↓</a>). If a static file can’t be located then
        Lift will attempt to locate a View class (Розділ <a  href="#sec:Views"  class="Reference">4.4↓</a>) that will process the request. If Lift
        cannot locate an appropriate template based on the request path then it
        will return a 404 to the user. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.1.2"  class="toc">4.1.2</a> 
        Processing Template XML </h3>
      <div  class="Unindented"> Once Lift has located the correct template, the
        next step is to process the contents. It is important to understand that
        Lift processes XML tags recursively, from the outermost tag to the
        innermost tag. That means that in our example Listing <a  href="#lst:Sample-template"
 class="Reference">4.1↑</a>, the surround tag gets processed first. In
        this case the surround loads the default template and embeds our content
        at the appropriate location. The next tag to be processed is the
        <tt><lift:hello.world></lift:hello.world></tt> snippet. This tag is
        essentially an alias for the lift:snippet tag (specifically,
        <tt><lift:snippet  type="“Hello:world”"></lift:snippet></tt>) , and will
        locate the Hello class and execute the world method on it. If you omit
        the “method” part of the type and only specify the class
        (<tt><lift:hello></lift:hello></tt> or <tt><lift:snippet  type="“Hello”"></lift:snippet></tt>), then Lift will attempt to call the
        <tt>render</tt> method of the class. </div>
      <div  class="Indented"> To give a more complex example that illustrates
        the order of tag processing, consider Listing <a  href="#lst:A-Recursive-Tag"
 class="Reference">4.1.2↓</a>. In this example we have several nested
        snippet tags, starting with <tt><a.snippet></a.snippet></tt>.
        Listing <a  href="#lst:Recursive-Tag-Snippets"  class="Reference">4.1.2↓</a> shows the backing code for this example.
        Snippets are covered in more detail in Глава <a  href="#cha:Snippets"  class="Reference">5↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Recursive Tag Processing Example<a  name="lst:A-Recursive-Tag"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_928359">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:A.snippet</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">p</code><code  class="xml plain">>Hello, <</code><code
 class="xml keyword">A:name</code> <code  class="xml plain">/>!<!--</code--><code
 class="xml keyword">p</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">p</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:B.snippet</code><code
 class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">B:title</code> <code  class="xml plain">/></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:C.snippet</code> <code
 class="xml plain">/></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">lift:B.snippet</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">p</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number9 index8 alt2"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:A.snippet</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The first thing that happens is that the contents
        of the <tt><lift:a.snippet></lift:a.snippet></tt> tag are passed as a
        <tt>NodeSeq</tt> argument to the
        <tt>A.snippet</tt> method. In the
        <tt>A.snippet</tt> method we bind<a  href="#index-bind"  name="entry-bind-0"
 class="IndexReference">↓</a>, or replace, the
        <tt><a:name></a:name></tt> tag with an XML Text node of “The
        A snippet”. The rest of the input is left as-is and is returned to Lift
        for more processing. Lift examines the returned
        <tt>NodeSeq</tt> for more lift tags and finds the
        <tt><lift:b.snippet></lift:b.snippet></tt> tag. The contents of the
        <tt><lift:b.snippet></lift:b.snippet></tt> tag are passed as a
        <tt>NodeSeq</tt> argument to the
        <tt>B.snippet</tt> method, where the <tt><b.title></b.title></tt> tag is bound with the XML Text node “The B snippet”.
        The rest of the contents are left unchanged and the transformed
        <tt>NodeSeq</tt> is returned to Lift, which scans for and
        finds the <tt><lift:c.snippet></lift:c.snippet></tt> tag. Since there
        are no child elements for the <tt><lift:c.snippet></lift:c.snippet></tt> tag, the <tt>C.snippet</tt> method is
        invoked with an empty <tt>NodeSeq</tt> and the
        <tt>C.snippet</tt> returns the Text node “The C snippet”. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The Recursive Tag Snippets Code<a  name="lst:Recursive-Tag-Snippets"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_244295">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">... standard Lift imports ...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">A {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">snippet (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"A"</code><code  class="scala plain">, xhtml, </code><code
 class="scala string">"name"</code> <code  class="scala plain">-> Text(</code><code
 class="scala string">"The A snippet"</code><code  class="scala plain">))</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">B {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">snippet (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"B"</code><code  class="scala plain">, xhtml, </code><code
 class="scala string">"title"</code> <code  class="scala plain">-> Text(</code><code
 class="scala string">"The B snippet"</code><code  class="scala plain">))</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">C {</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">snippet (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">Text(</code><code  class="scala string">"The C snippet"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> While the contents of the
        <tt>A.snippet</tt> tag are passed to the
        <tt>A.snippet</tt> method, there’s no requirement that the
        contents are actually used. For example, consider what would happen if
        we swapped the B and C snippet tags in our template, as shown in Listing
        <a  href="#lst:The-Swapped-Recursive"  class="Reference">4.1.2↓</a>. In this example, the
        <tt>C.snippet</tt> method is called before the
        <tt>B.snippet</tt> method. Since our
        <tt>C.snippet</tt> method returns straight XML that doesn’t
        contain the B snippet tag, the B snippet will never be executed! We’ll
        cover how the <tt>eager_eval</tt> tag attribute can be used
        to reverse this behavior in Розділ <a  href="#sub:Eager-Eval"  class="Reference">5.3.4↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The Swapped Recursive Snippet Template<a  name="lst:The-Swapped-Recursive"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_862038">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:A.snippet</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">p</code><code  class="xml plain">>Hello, <</code><code
 class="xml keyword">A:name</code> <code  class="xml plain">/>!<!--</code--><code
 class="xml keyword">p</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">p</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:C.snippet</code><code
 class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:B.snippet</code><code
 class="xml plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">        </code><code
 class="xml plain"><</code><code  class="xml keyword">B:title</code> <code  class="xml plain">/></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">lift:B.snippet</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">lift:C.snippet</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">p</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number10 index9 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:A.snippet</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number11 index10 alt2"><code  class="xml comments"><!-- After the A and C snippets have been processed: --></code></div>
                        <div  class="line number12 index11 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">p</code><code  class="xml plain">>Hello, The A snippet<!--</code--><code
 class="xml keyword">p</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number13 index12 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">p</code><code  class="xml plain">>The C snippet<!--</code--><code
 class="xml keyword">p</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see, templates are a nice way of
        setting up your layout and then writing a few methods to fill in the XML
        fragments that make up your web applications. They provide a simple way
        to generate a uniform look for your site, particularly if you assemble
        your templates using the surround and embed tags. If you’d like
        programmatic control over the template XML used for a particular
        request, you’ll want to use a View, which is discussed in the next
        section. </div>
      <h2  class="Section"> <a  name="toc-Section-4.2"  class="toc">4.2</a> 
        Designer-Friendly Templates<a  name="sec:Designer-Friendly-Templates"  class="Label">
        </a><a  href="#index-Templates-Designer-friendly"  name="entry-Templates-Designer-friendly-0"
 class="IndexReference">↓</a><a  href="#index-Designer-friendly-templates"  name="entry-Designer-friendly-templates-0"
 class="IndexReference">↓</a>
      </h2>
      <div  class="Unindented"> New in Lift 2.2 is the ability to use fully
        valid XHTML (or HTML5, which we’ll discuss in Розділ <a  href="#sec:HTML5-Support"
 class="Reference">4.3↓</a>) for your templates. There are a number of
        features involved in designer-friendly templates (or DFTs for short), so
        let’s go through each one. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.2.1"  class="toc">4.2.1</a> 
        Determining the Content Element<a  href="#index-Templates-content-element"
 name="entry-Templates-content-element-0"  class="IndexReference">↓</a>
      </h3>
      <div  class="Unindented"> In XML-based templates, the entire XML file is
        considered to hold the contents of the template. In DFTs, we want to be
        able to include the full XHTML or HTML5 markup, including tags like
        <tt><doctype></doctype></tt>,
        <tt></tt>, etc. without necessarily including
        all of that in the output of the template (for example, in an embedded
        template). Lift supports choosing a child element of the template to
        represent the actual contents via the use of one of two related
        mechanisms. </div>
      <div  class="Indented"> The first mechanism is to put a
        <tt>lift:content_id</tt> attribute on the HTML element, as
        shown in Listing <a  href="#lst:Assigning-a-Content-ID-HTML"  class="Reference">4.2.1↓</a>. The drawback to this approach is that
        you have to specify the “lift” namespace in the html tag or you might
        get validation errors. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Assigning a Content ID on the HTML element<a  name="lst:Assigning-a-Content-ID-HTML"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  html"  id="highlighter_468641">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="html plain"></code></div><code
 class="html plain">
                        <div  class="line number2 index1 alt1"><code  class="html spaces">    </code><code
 class="html plain">"<a  href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"></code></div>
                        <div  class="line number3 index2 alt2"><code  class="html spaces"> </code><code
 class="html plain"><</code><code  class="html keyword">html</code> <code  class="html color1">xmlns</code><code
 class="html plain">=</code><code  class="html string">"<a  href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>"</code></div>
                        <div  class="line number4 index3 alt1"><code  class="html spaces">       </code><code
 class="html color1">xmlns:lift</code><code  class="html plain">=</code><code  class="html string">"<a
 href="http://liftweb.net/">http://liftweb.net</a>"</code></div>
                        <div  class="line number5 index4 alt2"><code  class="html spaces">       </code><code
 class="html color1">lift:content_id</code><code  class="html plain">=</code><code
 class="html string">"real_content"</code><code  class="html plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="html spaces">   </code><code
 class="html plain"><</code><code  class="html keyword">head</code><code  class="html plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="html spaces">    </code><code
 class="html plain"><</code><code  class="html keyword">title</code><code  class="html plain">>Not really<!--</code--><code
 class="html keyword">title</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number8 index7 alt1"><code  class="html spaces">   </code><code
 class="html plain"><!--</code--><code  class="html keyword">head</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number9 index8 alt2"><code  class="html spaces">   </code><code
 class="html plain"><</code><code  class="html keyword">body</code><code  class="html plain">></code></div>
                        <div  class="line number10 index9 alt1"><code  class="html spaces">     </code><code
 class="html plain"><</code><code  class="html keyword">div</code> <code  class="html color1">id</code><code
 class="html plain">=</code><code  class="html string">"real_content"</code><code
 class="html plain">></code></div>
                        <div  class="line number11 index10 alt2"><code  class="html spaces">       </code><code
 class="html plain"><</code><code  class="html keyword">h1</code><code  class="html plain">>Welcome to your project!<!--</code--><code
 class="html keyword">h1</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number12 index11 alt1"><code  class="html spaces">     </code><code
 class="html plain"><!--</code--><code  class="html keyword">div</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number13 index12 alt2"><code  class="html spaces">   </code><code
 class="html plain"><!--</code--><code  class="html keyword">body</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number14 index13 alt1"><code  class="html spaces"> </code><code
 class="html plain"><!--</code--><code  class="html keyword">html</code><code  class="html plain">></code></code></div><code
 class="html plain">
                      </code></code></code></code></code></code></code></div><code
 class="html plain"><code  class="html plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The second, safer approach, is to specific the
        <tt>lift:content_id</tt> marker as part of the body
        element’s <tt>class</tt> attribute, as shown in Listing <a  href="#lst:Assigning-a-Content-ID-Body"
 class="Reference">4.2.1↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Assigning a Content ID in the Body class<a  name="lst:Assigning-a-Content-ID-Body"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  html"  id="highlighter_598737">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="html plain"></code></div><code
 class="html plain">
                        <div  class="line number2 index1 alt1"><code  class="html spaces">    </code><code
 class="html plain">"<a  href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"></code></div>
                        <div  class="line number3 index2 alt2"><code  class="html spaces"> </code><code
 class="html plain"><</code><code  class="html keyword">html</code> <code  class="html color1">xmlns</code><code
 class="html plain">=</code><code  class="html string">"<a  href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>"</code><code
 class="html plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="html spaces">   </code><code
 class="html plain"><</code><code  class="html keyword">head</code><code  class="html plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="html spaces">    </code><code
 class="html plain"><</code><code  class="html keyword">title</code><code  class="html plain">>Not really<!--</code--><code
 class="html keyword">title</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number6 index5 alt1"><code  class="html spaces">   </code><code
 class="html plain"><!--</code--><code  class="html keyword">head</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number7 index6 alt2"><code  class="html spaces">   </code><code
 class="html plain"><</code><code  class="html keyword">body</code> <code  class="html color1">class</code><code
 class="html plain">=</code><code  class="html string">"lift:content_id=real_content"</code><code
 class="html plain">></code></div>
                        <div  class="line number8 index7 alt1"><code  class="html spaces">     </code><code
 class="html plain"><</code><code  class="html keyword">div</code> <code  class="html color1">id</code><code
 class="html plain">=</code><code  class="html string">"real_content"</code><code
 class="html plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="html spaces">       </code><code
 class="html plain"><</code><code  class="html keyword">h1</code><code  class="html plain">>Welcome to your project!<!--</code--><code
 class="html keyword">h1</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number10 index9 alt1"><code  class="html spaces">     </code><code
 class="html plain"><!--</code--><code  class="html keyword">div</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number11 index10 alt2"><code  class="html spaces">   </code><code
 class="html plain"><!--</code--><code  class="html keyword">body</code><code  class="html plain">></code></code></div><code
 class="html plain">
                        <div  class="line number12 index11 alt1"><code  class="html spaces"> </code><code
 class="html plain"><!--</code--><code  class="html keyword">html</code><code  class="html plain">></code></code></div><code
 class="html plain">
                      </code></code></code></code></code></code></code></div><code
 class="html plain"><code  class="html plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.2.2"  class="toc">4.2.2</a> 
        Invoking Snippets Via the Class Attribute<a  href="#index-Snippets-invoking-via-class-attributes"
 name="entry-Snippets-invoking-via-class-attributes-0"  class="IndexReference">↓</a>
      </h3>
      <div  class="Unindented"> In XML-based templates, Lift looks for tags with
        the “lift” prefix to process. In DFTs, the <tt>class</tt>
        attribute is used instead for invocation. This form of invocation is
        discussed in more detail in Розділ <a  href="#sec:The-Snippet-Tag"  class="Reference">5.1 on page 1↓</a>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.2.3"  class="toc">4.2.3</a> 
        Binding via CSS transforms<a  href="#index-Binding-with-CSS"  name="entry-Binding-with-CSS-0"
 class="IndexReference">↓</a> </h3>
      <div  class="Unindented"> Lift 2.2 introduces a new feature for binding
        values into snippet markup by using CSS id and class attributes instead
        of prefixed XML elements. This support is detailed in Розділ <a  href="#sub:CSS-Selector-Transforms"
 class="Reference">5.3.2 on page 1↓</a>. </div>
      <h2  class="Section"> <a  name="toc-Section-4.3"  class="toc">4.3</a> 
        HTML5 Support<a  name="sec:HTML5-Support"  class="Label"> </a><a  href="#index-HTML5"
 name="entry-HTML5-0"  class="IndexReference">↓</a><a  href="#index-HTML-Version-5"
 name="entry-HTML-Version-5-0"  class="IndexReference">↓</a><a  href="#index-Templates-HTML5"
 name="entry-Templates-HTML5-0"  class="IndexReference">↓</a> </h2>
      <h2  class="Section"> <a  name="toc-Section-4.4"  class="toc">4.4</a> 
        Views<a  name="sec:Views"  class="Label"> </a><a  href="#index-Views"  name="entry-Views-1"
 class="IndexReference">↓</a> </h2>
      <div  class="Unindented"> We just discussed Templates and saw that through
        a combination of an XML file, Lift tags, and Scala code we can respond
        to requests made by a user. You can also generate an XHTML response
        entirely in code using a View. Custom dispatch is a similar method which
        can be used to programmatically return any kind of response (not just
        XHTML), and is covered in more depth in Розділ <a  href="#sec:Custom-dispatch-func"
 class="Reference">3.8↑</a>. </div>
      <div  class="Indented"> A view function is a normal Scala method of type <span
 class="formula">()  ⇒ <i>scala</i>.<i>xml</i>.<i>NodeSeq</i></span><a  href="#index-NodeSeq"
 name="entry-NodeSeq-0"  class="IndexReference">↓</a>. The
        <tt>NodeSeq</tt> that’s returned from a view is processed
        for template tags in the same way that XML loaded from a static file
        would be. As we showed in Розділ <a  href="#sec:The-Rendering-Process"  class="Reference">3.5↑</a>, there are two ways that a View can be
        invoked. The first is by defining a partial function for
        <tt>LiftRules.viewDispatch<a  href="#index-viewDispatch"  name="entry-viewDispatch-2"
 class="IndexReference">↓</a><a  href="#index-Views-Explicit-dispatch"  name="entry-Views-Explicit-dispatch-2"
 class="IndexReference">↓</a></tt>,
        which allows you to dispatch to any statically-available method (i.e. on
        an <tt>object</tt>, not a <tt>class</tt>), or to
        a <tt>LiftView</tt> (explained in a moment) object for any
        arbitrary request path. The second way that a View can be invoked is by
        reflection: if the first element of the request path matches the class
        name of the View (as defined in Розділ <a  href="#sub:Class-Resolution"
 class="Reference">3.2.1↑</a>), then the second element is used to
        look up the View function depending on which trait the View class
        implements. For performance reasons, explicit dispatch via
        <tt>LiftRules.viewDispatch</tt> is recommended because
        reflection incurs a significant cost for each request. When you use
        <tt>LiftRules.viewDispatch</tt>, you need to provide an
        instance of <tt>scala.lang.Either</tt> to differentiate the
        dispatch type: a <tt>scala.lang.Left</tt> indicates a method
        returning a <tt>Box[NodeSeq]</tt>, while a
        <tt>scala.lang.Right</tt> indicates a
        <tt>LiftView</tt> object. If you want to dispatch a request
        to a <tt>LiftView</tt> object, the match in the
        <tt>LiftRules.viewDispatch</tt> is made on all path
        components except the last one (e.g. <tt>List.init</tt>),
        and that object’s <tt>dispatch</tt> method is checked
        against the last component of the path to further determine which method
        on the object will handle the request. Listing <a  href="#lst:Explicit-View-Dispatch"
 class="Reference">4.4↓</a> shows how we can define an RSS view as a
        feed using explicit dispatch. Note that we use extraction on the
        requested path in this case to provide account-specific feeds and a
        security token to prevent feed browsing. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Explicit View Dispatch<a  name="lst:Explicit-View-Dispatch"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_129231">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// In Boot.boot:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">LiftRules.viewDispatch.append {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// This is an explicit dispatch to a particular method based on the path</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">List(</code><code
 class="scala string">"Expenses"</code><code  class="scala plain">, </code><code
 class="scala string">"recent"</code><code  class="scala plain">, acctId, authToken) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Left(() </code><code  class="scala keyword">=</code><code  class="scala plain">> Full(RSSView.recent(acctId, authToken)))</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// This is a dispatch via the same LiftView object. The path</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// "/Site/news" will match this dispatch because of our dispatch</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// method defined in RSSView. The path "/Site/stuff/news" will not</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// match because the dispatch will be attempted on List("Site","stuff")</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">List(</code><code
 class="scala string">"Site"</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">> Right(RSSView)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala comments">// Define the View object:</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">RSSView </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LiftView {</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">dispatch </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"news"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> siteNews</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">recent(acctId </code><code
 class="scala keyword">:</code> <code  class="scala plain">String, authToken </code><code
 class="scala keyword">:</code> <code  class="scala plain">String)() </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">     </code><code
 class="scala comments">// User auth, account retrieval here</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">     </code><code
 class="scala plain">...</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">     </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">surround </code><code  class="scala keyword">with</code><code
 class="scala keyword">=</code><code  class="scala string">"rss"</code> <code  class="scala plain">at</code><code
 class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">       </code><code
 class="scala plain">...</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">     </code><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">surround></code></code></div><code
 class="scala plain">
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Display a general RSS feed for the entire site</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">siteNews() </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{ ... }</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala plain">}</code></div>
                      </code></code></div><code  class="scala plain"><code  class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> If you want to use reflection for dispatch<a  href="#index-Views-Implicit-dispatch"
 name="entry-Views-Implicit-dispatch-0"  class="IndexReference">↓</a><a  href="#index-Views-Reflection-dispatch"
 name="entry-Views-Reflection-dispatch-0"  class="IndexReference">↓</a>
        then there are two traits that you can use when implementing a view
        class: one is the <tt>LiftView</tt><a  href="#index-LiftView"  name="entry-LiftView-0"
 class="IndexReference">↓</a> trait, the
        other is the <tt>InsecureLiftView</tt><a  href="#index-InsecureLiftView"
 name="entry-InsecureLiftView-0"  class="IndexReference">↓</a> trait,
        both under the <tt>net.liftweb.http</tt> package. As you may
        be able to tell from the names, we would prefer that you extend the
        <tt>LiftView</tt> trait. The
        <tt>InsecureLiftView</tt> determines method dispatch by
        turning a request path into a class and method name. For example, if we
        have a path <tt>/MyStuff/enumerate</tt>, then Lift will look
        for a class called <tt>MyStuff</tt> in the view subpackage
        (class resolution is covered in Розділ <a  href="#sub:Class-Resolution"
 class="Reference">3.2.1↑</a>) and if it finds
        <tt>MyStuff</tt> and it has a method called
        <tt>enumerate</tt>, then Lift will execute the
        <tt>enumerate</tt> method and return its result to the user.
        The main concern here is that Lift uses reflection<a  href="#index-reflection"
 name="entry-reflection-0"  class="IndexReference">↓</a> to get the
        method with <tt>InsecureLiftView</tt>, so it can access any
        method in the class, even ones that you don’t intend to make public. A
        better way to invoke a View is to extend the
        <tt>LiftView</tt> trait, which defines a dispatch partial
        function. This dispatch function maps a string (the “method name”) to a
        function that will return a <tt>NodeSeq</tt>. Listing <a  href="#lst:Dispatch-in-LiftView"
 class="Reference">4.4↓</a> shows a custom
        <tt>LiftView</tt> class where the path
        <tt>/ExpenseView/enumerate</tt> will map to the
        <tt>ExpenseView.doEnumerate</tt> method. If a user attempts
        to go to <tt>/ExpenseView/privateMethod</tt> they’ll get a
        404 because <tt>privateMethod</tt> is not defined in the
        dispatch method. If, however, our <tt>ExpenseView</tt> class
        implemented the <tt>InsecureLiftView</tt> trait and someone
        visited <tt>/ExpenseView/privateMethod</tt>, we would lose
        our hard drive (on Unix at least). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Dispatch in LiftView<a  name="lst:Dispatch-in-LiftView"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_121846">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">ExpenseView </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LiftView {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">dispatch </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"enumerate"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> doEnumerate </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">doEnumerate () </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{  </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">surround </code><code  class="scala keyword">with</code><code
 class="scala keyword">=</code><code  class="scala string">"default"</code> <code
 class="scala plain">at</code><code  class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">     </code><code
 class="scala plain">{ expenseItems.toTable }</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">surround></code></code></div><code
 class="scala plain">
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">privateMethod () </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">Runtime.getRuntime.exec(</code><code  class="scala string">"rm -rf /"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">}</code></div>
                      </code></code></div><code  class="scala plain"><code  class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> A major difference between Views and other
        programmatic rendering approaches (such as Custom Dispatch) is that the
        <tt>NodeSeq</tt> returned from the View method is processed
        for template tags including <tt>surrounds</tt> and
        <tt>includes</tt>, just as it would be for a snippet. That
        means that you can use the full power of the templating system from
        within your View, as shown in Listing <a  href="#lst:Dispatch-in-LiftView"
 class="Reference">4.4↑</a>’s <tt>doEnumerate</tt> method.
      </div>
      <div  class="Indented"> Since you can choose not to include any of the
        pre-defined template XHTML, you can easily generate any XML-based
        content, such as Atom or RSS feeds, using a View. </div>
      <h2  class="Section"> <a  name="toc-Section-4.5"  class="toc">4.5</a> 
        Tags<a  name="sec:ArchTags"  class="Label"> </a> </h2>
      <div  class="Unindented"> In the earlier sections on Templates and Views
        we briefly touched on some of Lift’s built-in tags, namely,
        <tt><lift:snippet></lift:snippet></tt> and
        <tt><lift:surround<  tt="">/>. In this section we’ll go
        into more detail on those tags as well as cover the rest of Lift’s tags.
      </lift:surround<></tt></div><tt>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.1"  class="toc">4.5.1</a> 
        a<a  name="sub:a-tag"  class="Label"> </a><a  href="#index-Tags-a"  name="entry-Tags-a-0"
 class="IndexReference">↓</a><a  href="#index-SHtml-a"  name="entry-SHtml-a-0"  class="IndexReference">↓</a><a
 href="#index-AJAX-anchor-tag"  name="entry-AJAX-anchor-tag-0"  class="IndexReference">↓</a> </h3>
      <div  class="Unindented"> The <tt><lift:a></lift:a></tt> tag is
        used internally by <tt>SHtml.a</tt> to create an anchor tag
        that will call an AJAX function when clicked. This tag is generally not
        used directly by developers. See Розділ <a  href="#sub:AJAX-Generators-in-detail"
 class="Reference">11.4 on page 1↓</a> for more details. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.2"  class="toc">4.5.2</a> 
        bind<a  name="sub:bind-tag"  class="Label"> </a><a  href="#index-Tags-bind"
 name="entry-Tags-bind-0"  class="IndexReference">↓</a><a  href="#index-binding"
 name="entry-binding-1"  class="IndexReference">↓</a> </h3>
      <pre  class="LyX-Code">Usage: <lift:bind  name="”binding_name”">
</lift:bind></pre>
      <div  class="Unindented"> The <tt><lift:bind></lift:bind></tt> tag
        is used as a placeholder for insertion of content within included
        templates when using the <tt><lift:surround> and</lift:surround></tt>
        <tt><lift:embed></lift:embed></tt> tags. See Розділ <a  href="#sec:Binding"
 class="Reference">4.7↓</a> for examples and discussion. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.3"  class="toc">4.5.3</a> 
        bind-at<a  name="sub:bind-at-tag"  class="Label"> </a><a  href="#index-Tags-bind-at"
 name="entry-Tags-bind-at-0"  class="IndexReference">↓</a><a  href="#index-binding"
 name="entry-binding-2"  class="IndexReference">↓</a> </h3>
      <pre  class="LyX-Code">Usage: <lift:bind-at  name="”binding_name”">contents</lift:bind-at>
</pre>
      <div  class="Unindented"> The <tt><lift:bind-at></lift:bind-at></tt>
        tag is used to replace named <tt><lift:bind></lift:bind></tt>
        tags within <tt><lift:surround></lift:surround></tt> and
        <tt><lift:embed></lift:embed></tt> tags. See Розділ <a  href="#sec:Binding"
 class="Reference">4.7↓</a> for examples and discussion. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.4"  class="toc">4.5.4</a> 
        children<a  name="sub:children-tag"  class="Label"> </a><a  href="#index-Tags-children"
 name="entry-Tags-children-0"  class="IndexReference">↓</a><a  href="#index-children"
 name="entry-children-0"  class="IndexReference">↓</a> </h3>
      <pre  class="LyX-Code">Usage: <lift:children>...multiple xml nodes here...</lift:children>
</pre>
      <div  class="Unindented"> The purpose of the
        <tt><lift:children></lift:children></tt> tag is to allow you to
        create fragment templates with more than one root element that still
        parse as valid XML. For example, Listing <a  href="#lst:A-Non-Conforming-XML"
 class="Reference">4.5.4↓</a> shows a template that we might want to
        embed into other templates. The problem is that XML requires a single
        root element, and in this case we have two. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Non-Conforming XML Fragment<a  name="lst:A-Non-Conforming-XML"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_836560">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">div</code><code  class="xml plain">>First Div<!--</code--><code
 class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">div</code><code  class="xml plain">>Second Div<!--</code--><code
 class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></div><code  class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> By using the
        <tt><lift:children></lift:children></tt> tag, as shown in Listing <a  href="#lst:A-Conforming-XML"
 class="Reference">4.5.4↓</a>, we have a valid XML file. Lift
        essentially replaces the <tt><lift:children></lift:children></tt> tag
        with its contents. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Conforming XML Fragment<a  name="lst:A-Conforming-XML"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_991278">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:children</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">div</code><code  class="xml plain">>First Div<!--</code--><code
 class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number3 index2 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">div</code><code  class="xml plain">>Second Div<!--</code--><code
 class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number4 index3 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:children</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.5"  class="toc">4.5.5</a> 
        comet<a  name="sub:comet-tag"  class="Label"> </a><a  href="#index-Tags-comet"
 name="entry-Tags-comet-0"  class="IndexReference">↓</a><a  href="#index-Comet"
 name="entry-Comet-0"  class="IndexReference">↓</a> </h3>
      <pre  class="LyX-Code"><tt>Usage: <lift:comet  type="ClassName"  name="”optional”/"></lift:comet></tt>
</pre>
      <div  class="Unindented"> The <tt><lift:comet></lift:comet></tt> tag
        embeds a Comet actor into your page. The class of the Comet actor is
        specified by the <tt>type</tt> attribute. The
        <tt>name</tt> attribute tells Lift to create a unique
        instance of the Comet actor; for example, you could have one Comet actor
        for site updates and another for admin messages. The contents of the tag
        are used by the Comet actor to bind a response. Listing <a  href="#lst:Ledger-Entry-Comet"
 class="Reference">4.5.5↓</a> shows an example of a Comet binding that
        displays expense entries as they’re added. Comet is covered in more
        detail in Глава <a  href="#cha:AJAX-and-COMET"  class="Reference">11↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Account Entry Comet<a  name="lst:Ledger-Entry-Comet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_863808">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">div</code> <code  class="xml color1">class</code><code  class="xml plain">=</code><code
 class="xml string">"accountUpdates"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:comet</code> <code  class="xml color1">type</code><code
 class="xml plain">=</code><code  class="xml string">"AccountMonitor"</code><code
 class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">ul</code><code  class="xml plain">><</code><code
 class="xml keyword">account:entries</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">li</code><code  class="xml plain">><</code><code
 class="xml keyword">entry:time</code><code  class="xml plain">/> : <</code><code
 class="xml keyword">entry:user</code> <code  class="xml plain">/> : <</code><code
 class="xml keyword">entry:amount</code> <code  class="xml plain">/><!--</code--><code
 class="xml keyword">li</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">account:entries</code><code
 class="xml plain">><!--</code--><code  class="xml keyword">ul</code><code  class="xml plain">></code></code></code></div><code
 class="xml plain"><code  class="xml plain">
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">lift:comet</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number7 index6 alt2"><code  class="xml plain"><!--</code--><code
 class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As we mention in the <tt>embed</tt>
        tag documentation, mixing Comet with AJAX responses can be a bit tricky
        due to the embedded JavaScript that Comet uses. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.6"  class="toc">4.5.6</a> 
        CSS<a  name="sub:CSS-tag"  class="Label"> </a><a  href="#index-Tags-CSS"
 name="entry-Tags-CSS-0"  class="IndexReference">↓</a><a  href="#index-CSS"  name="entry-CSS-0"
 class="IndexReference">↓</a> </h3>
      <pre  class="LyX-Code">Usage: <lift:css.blueprint>
       <lift:css.fancytype>
</lift:css.fancytype></lift:css.blueprint></pre>
      <div  class="Unindented"> The <tt><lift:css></lift:css></tt> tag
        is used to insert the blueprint<span  class="FootOuter"><span  class="SupFootMarker"> 
            [S] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [S] </span><a  href="http://www.blueprintcss.org/"  class="FlexURL">http://www.blueprintcss.org/</a></span></span>
        and (optionally) fancyType <span  class="FootOuter"><span  class="SupFootMarker"> 
            [T] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [T] </span><a  href="http://anthonygthomas.com/2010/02/15/blueprint-optional-fancy-type-plugin/"
 class="FlexURL">http://anthonygthomas.com/2010/02/15/blueprint-optional-fancy-type-plugin/</a></span></span>
        CSS stylesheets </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.7"  class="toc">4.5.7</a> 
        embed<a  href="#index-embed"  name="entry-embed-0"  class="IndexReference">↓</a><a
 name="sub:embed-tag"  class="Label"> </a> <a  href="#index-Tags-embed"  name="entry-Tags-embed-0"
 class="IndexReference">↓</a> </h3>
      <pre  class="LyX-Code">Usage:<tt> <lift:embed  what="template_name"></lift:embed></tt>
</pre>
      <div  class="Unindented"> The <tt>embed</tt> tag allows you to
        embed a template within another template. This can be used to assemble
        your pages from multiple smaller templates, and it also allows you to
        access templates from JavaScript commands (Глава <a  href="#cha:Lift-and-Javascript"
 class="Reference">10↓</a>). As with the <tt>surround</tt>
        tag, the template name can be either the base filename or a
        fully-qualified path. </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> <span  class="small">Note
              that if you use the embed tag to access templates from within a
              JsCmd (typically an AJAX call), any JavaScript in the embedded
              template won’t be executed. This includes, but is not limited to,
              Comet widgets.</span> </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.8"  class="toc">4.5.8</a> 
        form </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.9"  class="toc">4.5.9</a> 
        HTML5 </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.10"  class="toc">4.5.10</a> 
        ignore </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.11"  class="toc">4.5.11</a> 
        lazy-load </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.12"  class="toc">4.5.12</a> 
        loc </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.13"  class="toc">4.5.13</a> 
        Menu </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.14"  class="toc">4.5.14</a> 
        Msgs </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.15"  class="toc">4.5.15</a> 
        SkipDocType </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.16"  class="toc">4.5.16</a> 
        snippet </h3>
      <div  class="Unindented"> The snippet tag is covered in detail in Розділ <a
 href="#sec:The-Snippet-Tag"  class="Reference">5.1 on page 1↓</a>, part of the chapter on
        snippets. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.17"  class="toc">4.5.17</a> 
        surround<a  href="#index-surround"  name="entry-surround-0"  class="IndexReference">↓</a><a
 href="#index-Tags-surround"  name="entry-Tags-surround-0"  class="IndexReference">↓</a><a
 name="sub:surround-tag"  class="Label"> </a> </h3>
      <pre  class="LyX-Code">Usage:<tt> <lift:surround  with="template_name"  at="”binding”"></lift:surround></tt>
<tt>         children</tt>
<tt>       </tt>
</pre>
      <div  class="Unindented"> The <tt>surround</tt> tag surrounds
        the child nodes with the named template. The child nodes are inserted
        into the named template at the binding point specified by the
        <tt>at</tt> parameter (we’ll cover the bind tag in Розділ <a  href="#sub:bind-tag"
 class="Reference">4.5.2↑</a>).
        Typically, templates that will be used to surround other templates are
        incomplete by themselves, so we usually store them in the
        <tt><app root>/templates-hidden</app root></tt> subdirectory so
        that they can’t be accessed directly. Having said that, “incomplete”
        templates may be placed in any directory that templates would normally
        go in. The most common usage of <tt>surround</tt> is to
        permit you to use a “master” template for your site CSS, menu, etc. An
        example use of <tt>surround</tt> is shown in Listing <a  href="#lst:Surrounding-your-page"
 class="Reference">4.5.17↓</a>. We’ll show the counterpart master
        template in the section on the bind tag. Note also that the surrounding
        template name can be either a fully-qualified path (i.e.
        “/templates-hidden/default”), or just the base filename (“default”). In
        the latter case, Lift will search all subdirectories of the app root for
        the template. By default, Lift will use “/templates-hidden/default” if
        you don’t specify a <tt>with</tt> attribute, so Listings <a  href="#lst:Surrounding-your-page"
 class="Reference">4.5.17↓</a> and <a  href="#lst:Surrounding-with-the-default-template"
 class="Reference">4.5.17↓</a> are equivalent. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Surrounding Your Page<a  name="lst:Surrounding-your-page"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_587591">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">p</code><code  class="xml plain">>Welcome to PocketChange!<!--</code--><code
 class="xml keyword">p</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number3 index2 alt2"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></div><code  class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Surrounding with the default template<a  name="lst:Surrounding-with-the-default-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_403291">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">p</code><code  class="xml plain">>Welcome to PocketChange!<!--</code--><code
 class="xml keyword">p</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number3 index2 alt2"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></div><code  class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that you can use multiple surround templates
        for different functionality, and surrounds can be nested. For example,
        you might want to have a separate template for your administrative pages
        that adds a menu to your default template. In that case, your
        <tt>admin.html</tt> could look like Listing <a  href="#lst:Adding-an-Admin-menu"
 class="Reference">4.5.17↓</a>. As you can see, we’ve named our bind
        point in the admin template “content” so that we keep things consistent
        for the rest of our templates. So if, for example, we were going to nest
        the template in Listing <a  href="#lst:Surrounding-your-page"  class="Reference">4.5.17↑</a> above into the
        <tt>admin.html</tt> template in Listing <a  href="#lst:Adding-an-Admin-menu"
 class="Reference">4.5.17↓</a>, all we’d need to do is change it’s
        <tt>with</tt> attribute from “default” to “admin.” </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Adding an Admin Menu<a  name="lst:Adding-an-Admin-menu"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_476659">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:Admin.menu</code> <code
 class="xml plain">/></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:bind</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code> <code  class="xml plain">/></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></div><code  class="xml plain">
                    </code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> <span  class="small">You
              cannot have a hidden template with the same name as a
              sub-directory of your webapp directory. For example, if you had an
              admin.html template in /templates-hidden, you could not also have
              an admin directory. </span> </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.18"  class="toc">4.5.18</a> 
        tail </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.19"  class="toc">4.5.19</a> 
        TestCond </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.20"  class="toc">4.5.20</a> 
        with-param </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.21"  class="toc">4.5.21</a> 
        with-resource-id </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.22"  class="toc">4.5.22</a> 
        VersionInfo </h3>
      <h3  class="Subsection"> <a  name="toc-Subsection-4.5.23"  class="toc">4.5.23</a> 
        XmlGroup </h3>
      <h2  class="Section"> <a  name="toc-Section-4.6"  class="toc">4.6</a> 
        Head and Tail Merge<a  name="sec:Head-Tail-Merge"  class="Label"> </a>
      </h2>
      <div  class="Unindented"> Another feature of Lift’s template processing is
        the ability to merge the HTML <tt>head</tt><a  href="#index-head"  name="entry-head-0"
 class="IndexReference">↓</a> element in a
        template with the <tt>head</tt> element in the surrounding
        template. In our example, Listing <a  href="#lst:Sample-template"  class="Reference">4.1↑</a>, notice that we’ve specified a
        <tt>head</tt> tag inside the template. Without the head
        merge, this <tt>head</tt> tag would show up in the default
        template where our template gets bound. Lift is smart about this,
        though, and instead takes the content of the <tt>head</tt>
        element and merges it into the outer template’s
        <tt>head</tt> element. This means that you can use a
        <tt>surround</tt> tag to keep a uniform default template,
        but still do things such as changing the title of the page, adding
        scripts or special CSS, etc. For example, if you have a table in a page
        that you’d like to style with jQuery’s TableSorter, you could add a head
        element to insert the appropriate script: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using Head Merge<a  name="lst:Using-Head-Merge"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_183529">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"foo"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">head</code><code  class="xml plain">><</code><code  class="xml keyword">script</code> <code
 class="xml color1">src</code><code  class="xml plain">=</code><code  class="xml string">"/scripts/tablesorter.js"</code> <code
 class="xml color1">type</code><code  class="xml plain">=</code><code  class="xml string">"text/javascript"</code> <code
 class="xml plain">/><</code><code  class="xml keyword">head</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml plain">...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></div><code  class="xml plain">
                    </code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In this manner, you’ll import TableSorter for this
        template alone. </div>
      <h2  class="Section"> <a  name="toc-Section-4.7"  class="toc">4.7</a> 
        Binding<a  name="sec:Binding"  class="Label"> </a> </h2>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-5"  class="toc">5</a> 
        Snippets<a  href="#index-Snippets"  name="entry-Snippets-0"  class="IndexReference">↓</a><a
 name="cha:Snippets"  class="Label"> </a> </h1>
      <div  class="Unindented"> Put simply, a snippet is a Scala method that
        transforms input XML into output XML<a  href="#index-XML"  name="entry-XML-1"
 class="IndexReference">↓</a>. Snippets act as
        independent (or dependent, if you want) pieces of logic that you insert
        into your page to perform rendering. As such, snippets form the backbone
        of Lift’s View-First<a  href="#index-View-First"  name="entry-View-First-0"
 class="IndexReference">↓</a> rendering
        architecture. Although snippets aren’t the only mechanism Lift has for
        rendering page views (see Views, Розділ <a  href="#sec:Views"  class="Reference">4.4 on page 1↑</a>, Custom Dispatch, Розділ <a
 href="#sec:Custom-dispatch-func"  class="Reference">3.8 on page 1↑</a>, or even the REST API, Глава <a
 href="#cha:Web-Services"  class="Reference">15↓</a>), they’re so widely used and so important
        that we feel they warrant their own chapter. </div>
      <div  class="Indented"> In this chapter we will cover the ins and outs of
        snippets, from the snippet tag that you place in your templates, through
        how the snippet method is resolved, to the snippet method definition
        itself. We’ll also cover related topics and some advanced functionality
        in snippets for those looking to push Lift’s boundaries. </div>
      <h2  class="Section"> <a  name="toc-Section-5.1"  class="toc">5.1</a> The
        Snippet Tag<a  href="#index-snippet"  name="entry-snippet-0"  class="IndexReference">↓</a><a
 href="#index-Tags-snippet"  name="entry-Tags-snippet-0"  class="IndexReference">↓</a><a
 name="sec:The-Snippet-Tag"  class="Label"> </a><a  name="sub:snippet-tag"  class="Label"> </a>
      </h2>
      <pre  class="LyX-Code"><tt>Usage: <lift:snippet  type="snippetName"  ...options...=""></lift:snippet></tt>
       <lift:snippetname  ...options...="">
       <div  class="”lift:snippetName?opt1=...;opt2=...;opt3=...”">
</div></lift:snippetname></pre>
      <div  class="Unindented"> The snippet tag is what you use to tell Lift
        where and how to invoke a snippet method on given XML content. The most
        important part of the tag is the snippet name, which is used to resolve
        which snippet method will process the snippet tag contents. We’ll cover
        how the snippet name is resolved to a concrete method in section <a  href="#sub:Snippet-Dispatch"
 class="Reference">5.2↓</a>. </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note that there is a
            shorthand for the <tt>type</tt> attribute simply by
            appending the snippet name after the <tt>lift:</tt>
            prefix. If you use this shorthand, make sure to avoid naming your
            snippets the same as Lift’s built-in tags, such as
            <tt>surround</tt>, <tt>children</tt>,
            <tt>embed</tt>, etc. </div>
        </div>
      </div>
      <div  class="Indented"> In addition to the the <tt>type</tt>
        attribute, Lift will process several other options: </div>
      <div  class="Description"> <span  class="Description-entry">form</span> 
        If the <tt>form<a  href="#index-Forms-snippet-tag"  name="entry-Forms-snippet-tag-0"
 class="IndexReference">↓</a></tt>
        attribute is included with a value of either “POST” or “GET”, then an
        appropriate form tag will be emitted into the XHTML using the specified
        submission method. If you omit this tag from a snippet that generates a
        form, the form elements will display but the form won’t submit. </div>
      <div  class="Description"> <span  class="Description-entry">multipart</span> <a
 href="#index-Forms-multipart"  name="entry-Forms-multipart-0"  class="IndexReference">↓</a><a
 href="#index-Forms-file-upload"  name="entry-Forms-file-upload-0"  class="IndexReference">↓</a>The
        <tt>multipart</tt> attribute is a boolean (the default is
        false, specify “yes”, “true” or “1” to enable) that specifies whether a
        generated form tag should be set to use multipart form submission. This
        is most typically used for file uploads (Розділ <a  href="#sec:File-Uploads"
 class="Reference">6.4↓</a>). If you don’t also specify the
        <tt>form</tt> attribute then this won’t do anything. </div>
      <div  class="Description"> <span  class="Description-entry">eager_eval</span> <a
 href="#index-Snippets-eager_eval"  name="entry-Snippets-eager_eval-0"  class="IndexReference">↓</a>The
        eager_eval attribute is a boolean (the default is false, specify “yes”,
        “true” or “1” to enable) that controls the order of processing for the
        snippet tag contents. Normally, the snippet is processed and then the
        XML returned from the snippet is further processed for Lift tags.
        Enabling eager_eval reverses this order so that the contents of the
        snippet tag are processed first. We cover this in more detail with an
        example in Розділ <a  href="#sub:Eager-Eval"  class="Reference">5.3.4↓</a>. </div>
      <div  class="Unindented"> With Lift 2.2’s Designer-Friendly Templates
        (Розділ <a  href="#sec:Designer-Friendly-Templates"  class="Reference">4.2 on page 1↑</a>), you can also specify a snippet
        tag as part of the class attribute for a given element. Attributes for
        snippets invoked in this manner are passed via a query string. Listing <a
 href="#lst:Invoking-Snippets-Via-Class"  class="Reference">5.1↓</a> shows an example of how we can use the
        standard <tt>lift:surround</tt> processing by modiying the
        <tt>class</tt> of our content element. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Invoking Snippets Via the Class Attribute<a  name="lst:Invoking-Snippets-Via-Class"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_950873">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><code
 class="scala string">"-//W3C//DTD XHTML 1.0 Transitional//EN"</code></code></div><code
 class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala string">"<a  href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"</code><code
 class="scala plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code><code
 class="scala plain"><code  class="scala keyword">=</code><code  class="scala string">"<a
 href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>"</code><code
 class="scala plain">></code></code></div><code  class="scala plain">
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">   </code><code
 class="scala plain"></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><title>>Not really</title></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">   </code><code
 class="scala plain"></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">   </code><code
 class="scala plain"><code  class="scala keyword">class</code><code  class="scala keyword">=</code><code
 class="scala string">"lift:content_id=real_content"</code><code  class="scala plain">></code></code></div><code
 class="scala plain">
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">     </code><code
 class="scala plain"><div  <=""  code=""><code  class="scala keyword">class</code><code
 class="scala keyword">=</code><code  class="scala string">"lift:surround?with=default;at=content"</code> <code
 class="scala plain">id</code><code  class="scala keyword">=</code><code  class="scala string">"real_content"</code><code
 class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">       </code><code
 class="scala plain"><h<  code=""><code  class="scala value">1</code><code  class="scala plain">>Welcome to your project!</code></h<><code
 class="scala plain"><code  class="scala value">1</code><code  class="scala plain">></code></code></code></div><code
 class="scala plain"><code  class="scala plain">
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">     </code><code
 class="scala plain"></code></div></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">   </code><code
 class="scala plain"></code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces"> </code><code
 class="scala plain"></code></div>
                      </code></code></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-5.2"  class="toc">5.2</a> 
        Snippet Dispatch<a  name="sub:Snippet-Dispatch"  class="Label"> </a><a  href="#index-Snippets-Dispatch"
 name="entry-Snippets-Dispatch-0"  class="IndexReference">↓</a> </h2>
      <div  class="Unindented"> The first step taken by Lift when evaluating a
        snippet tag is to resolve what snippet method will actually process the
        content. There are several mechanisms that are used to resolve the
        method, but they can be broken down into two main approaches: dispatch
        via reflection and explicit dispatch. In addition, Lift allows
        per-request remapping of snippet names via
        <tt>S.mapSnippet</tt><a  href="#index-mapSnippet"  name="entry-mapSnippet-0"
 class="IndexReference">↓</a>. We’ll cover
        each in the following sections. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.2.1"  class="toc">5.2.1</a> 
        Implicit Dispatch Via Reflection<a  href="#index-Reflection"  name="entry-Reflection-0"
 class="IndexReference">↓</a><a  href="#index-Snippets-Implicit-dispatch"  name="entry-Snippets-Implicit-dispatch-0"
 class="IndexReference">↓</a><a  name="sub:Implicit-Dispatch-Via"  class="Label"> </a> </h3>
      <div  class="Unindented"> The simplest, and default, approach to resolving
        snippet names is to use implicit dispatch via reflection. When using
        implicit dispatch, Lift will use the snippet name specified in the
        snippet tag to first locate a class. Lift will then either instantiate a
        class, or if it’s a stateful snippet (we’ll cover stateful snippets in
        Розділ <a  href="#sub:Stateless-versus-Stateful"  class="Reference">5.3.3↓</a>), retrieve the current instance. One
        Lift has a class instance, it uses the snippet name to further determine
        which method in the class to execute. There are three ways to specify
        this: </div>
      <ol>
        <li> Via the <tt>type</tt> attribute on the snippet tag. The
          value should be
          “<tt>ClassName</tt>:<tt>method</tt>” for the
          particular snippet method you want to have handle the tag </li>
        <li> Via a tag suffix of <tt>Class.method</tt>. This is the
          same as specifying the <tt>type=”Class:method”</tt>
          attribute </li>
        <li> Via a tag suffix of just <tt>Class</tt>. This will use
          the <tt>render</tt> method on the specified class to
          handle the tag </li>
      </ol>
      <div  class="Unindented"> Classes are resolved as specified in Розділ <a  href="#sub:Class-Resolution"
 class="Reference">3.2.1↑</a>. </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> The most important thing
            to remember when using implicit dispatch is that your snippet
            classes must be members of a <tt>snippet</tt> subpackage
            as registered by <tt>LiftRules.addToPackages</tt>. For
            example, if you have
            <tt>LiftRules.addToPackages(“com.foo”)</tt> in your
            <tt>Boot.boot</tt> method, snippets should be members of
            <tt>com.foo.snippet</tt>. </div>
        </div>
      </div>
      <div  class="Indented"> Listing <a  href="#lst:Snippet-tag-equivalence"  class="Reference">5.2.1↓</a> shows three equivalent snippet tags.
        Note: these are only equivalent because the method name is “render.” If
        we had chosen a different method, e.g., “list,” then the third example
        below will still call a “render” method. </div>
      <div  class="Indented">
        <div  class="center"> <tt>
          <div  style="width: 75%;"  class="Shadowbox"> It’s important to note
            that with pure implicit dispatch, Java’s reflection allows access to
            <i>any</i> method on the enclosing class, no matter what the
            protection on the method is set to (e.g. private, protected).
            Because of this, it’s possible to invoke private and protected
            methods via implicit dispatch, which could be a security
            concern.This is one reason that we recommend using either
            DispatchSnippet or explicit dispatch for production sites. We’ll
            cover both of these approaches momentarily.
            <div  class="PlainVisible"> Another important note is that lookup
              via reflection is relatively expensive<span  class="FootOuter"><span
 class="SupFootMarker">  [U] </span><span  class="HoverFoot"><span  class="SupFootMarker">  [U] </span>See <a
 href="http://www.jguru.com/faq/view.jsp?EID=246569"  class="FlexURL">http://www.jguru.com/faq/view.jsp?EID=246569</a>
                  for a more thorough explanation</span></span> operation, yet
              another reason that we recommend explicit dispatch for production
              sites. </div>
          </div>
          </tt> </div>
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Snippet Tag Equivalence<a  name="lst:Snippet-tag-equivalence"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_177072">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">snippet </code><code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"MyClass:render"</code> <code
 class="scala plain">/></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">MyClass.render /></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">MyClass /></code></lift<></code></div><code
 class="scala plain">
                      </code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In addition to “pure” implicit dispatch, you can
        exert a little more control on which method in a given class handles a
        snippet by implementing the <tt>net.liftweb.http.DispatchSnippet<a  href="#index-DispatchSnippet"
 name="entry-DispatchSnippet-0"  class="IndexReference">↓</a></tt>
        trait. This trait contains a single method, dispatch, of type <span  class="formula"><i>PartialFunction</i>[<i>String</i>,
           <i>NodeSeq</i> ⇒ <i>NodeSeq</i>]</span> that maps the method name
        (the “method” part of “Class.method” or “Class:method” as described
        above) to a particular method. Only method names defined in the dispatch
        PartialFunction can be executed; any methods that aren’t covered by the
        partial function will result in a snippet failure. Listing <a  href="#lst:Using-DispatchSnippet-to-select"
 class="Reference">5.2.1↓</a> shows how you can control the dispatch
        by providing a custom <tt>dispatch</tt> def. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using DispatchSnippet to Control Snippet Method
            Selection<a  name="lst:Using-DispatchSnippet-to-select"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_707283">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.foo.snippet</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">scala.xml.{NodeSeq,Text}</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.DispatchSnippet</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">SomeSnippetClass </code><code  class="scala keyword">extends</code> <code
 class="scala plain">DispatchSnippet {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">dispatch </code><code
 class="scala keyword">:</code> <code  class="scala plain">DispatchIt </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// We have to use a partially-applied (trailing "_") version</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// of the functions that we dispatch to</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"foo"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> myFooMethod </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"bar"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> someOtherBarMethod </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> catchAllMethod </code><code  class="scala keyword">_</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">myFooMethod (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{ ... }</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">someOtherBarMethod (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{ ... }</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">catchAllMethod(xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">Text(</code><code  class="scala string">"You’re being naughty!"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> To summarize, implicit dispatch is the default
        method by which Lift resolves snippet tag names to the actual class and
        method that will process the snippet tag contents. Although implicit
        dispatch is simple to use and works well, security concerns lead us to
        recommend the use of the <tt>DispatchSnippet<a  href="#index-DispatchSnippet"
 name="entry-DispatchSnippet-1"  class="IndexReference">↓</a></tt>
        trait. Even with <tt>DispatchSnippet</tt>, however, the
        implicit class resolution still uses reflection, so if you’re trying to
        make things performant you should use explicit dispatch instead. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.2.2"  class="toc">5.2.2</a> 
        Explicit Dispatch<a  href="#index-Snippets-Explicit-Dispatch"  name="entry-Snippets-Explicit-Dispatch-0"
 class="IndexReference">↓</a><a  name="sub:Explicit-Dispatch"  class="Label"> </a> </h3>
      <div  class="Unindented"> Explicit dispatch allows you to have direct
        control over which methods will be executed for a given snippet name.
        There are two ways that you can define snippet name to method mappings:
        via <tt>LiftRules.snippetDispatch</tt>, which points Lift to
        <tt>DispatchSnippet</tt> instances, and
        <tt>LiftRules.snippets</tt>, which points Lift directly at
        methods. </div>
      <div  class="Indented"> Let’s first take a look at
        <tt>LiftRules.snippetDispatch</tt>, the more generic option.
        When a snippet tag is encountered with a snippet name of the form
        <tt>A.B</tt> or <tt>A:B</tt>, Lift will take the
        first portion (<tt>A</tt>) and use that as the lookup for
        <tt>snippetDispatch</tt>. The
        <tt>PartialFunction</tt> needs to return an instance of
        <tt>DispatchSnippet</tt>, so typically you will implement
        your explicit dispatch snippets using an <tt>object</tt>
        instead of a <tt>class</tt>. Listing <a  href="#lst:Defining-an-Explicit-snippet"
 class="Reference">5.2.2↓</a> shows how we define our object. Note
        that the <tt>dispatch</tt> method will be executed with the
        “<tt>B</tt>” portion of the snippet name (as we defined
        above) as its argument. Other than the fact that it’s an object, the
        definition is essentially identical to our implicit dispatch class in
        Listing <a  href="#lst:Using-DispatchSnippet-to-select"  class="Reference">5.2.1↑</a>.
        <div  class="listing">
          <div  class="caption"> Defining an Explicit Snippet Object<a  name="lst:Defining-an-Explicit-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_224008">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// The package *doesn’t* need to be "snippet" because there’s</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala comments">// no reflection involved here</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.foo.logic</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">scala.xml.{NodeSeq,Text}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.DispatchSnippet</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">HelloWorld </code><code  class="scala keyword">extends</code> <code
 class="scala plain">DispatchSnippet {</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// We define dispatch as a val so that it doesn’t get re-created</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// on each request </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">dispatch </code><code
 class="scala keyword">:</code> <code  class="scala plain">DispatchIt </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">name </code><code
 class="scala keyword">=</code><code  class="scala plain">> render(name) </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">render (name </code><code
 class="scala keyword">:</code> <code  class="scala plain">String)(ignore </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">Text(</code><code  class="scala string">"Hello, world! Invoked as "</code> <code
 class="scala plain">+ name)</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now that we have our snippet object, we can bind
        it to a particular snippet name in our <tt>Boot.boot</tt>
        method, as shown in Listing <a  href="#lst:Binding-Our-Explicit-snippet"
 class="Reference">5.2.2↓</a>. It’s interesting to note that this is
        actually how Lift defines many of its tags, such as
        <tt><lift:embed></lift:embed></tt>,
        <tt><lift:surround></lift:surround></tt>, and
        <tt><lift:comet></lift:comet></tt>. In our case, we’ve bound our
        snippet object to <tt><lift:helloworld></lift:helloworld></tt>, and
        because our <tt>DispatchSnippet</tt> uses a simple variable
        binding for its <tt>dispatch</tt> method case, we can invoke
        the same snippet with <tt><lift:helloworld.hey></lift:helloworld.hey></tt>, <tt><lift:helloworld.useless></lift:helloworld.useless></tt>,
        or even
        <tt><lift:helloworld.this_is_getting_silly></lift:helloworld.this_is_getting_silly></tt>, and
        the snippet will tell us what name it was invoked with
        (<tt><lift:helloworld></lift:helloworld></tt> will invoke with the name
        “render”, following Lift’s normal snippet tag conventions). Noe that if
        you’re setting up a dispatch for a <tt>StatefulSnippet</tt><a  href="#index-StatefulSnippet"
 name="entry-StatefulSnippet-0"  class="IndexReference">↓</a><a  href="#index-Snippets-stateful"
 name="entry-Snippets-stateful-0"  class="IndexReference">↓</a>,
        return a new instance of your <tt>StatefulSnippet</tt>
        class. <tt>StatefulSnippet</tt> instances will properly
        register themselves ahead of the <tt>snippetDispatch</tt>
        partial function on each successive request. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Binding Our Explicit Snippet Object<a  name="lst:Binding-Our-Explicit-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_896981">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.snippetDispatch.append {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala string">"HelloWorld"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> com.foo.logic.HelloWorld</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala comments">// For StatefulSnippets, return a *new instance*</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala string">"HelloConversation"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">new</code> <code  class="scala plain">com.foo.logic.StatefulHelloWorld</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now let’s look at
        <tt>LiftRules.snippets</tt>. This is a more fine-grained
        approach to explicit dispatch that doesn’t require the
        <tt>DispatchSnippet</tt> trait. Instead, we bind a list of
        snippet name components corresponding to the parts of the snippet name
        separated by either “:” or “.”, and point it directly at a given snippet
        method. Assuming we’re using the same snippet object in Listing <a  href="#lst:Defining-an-Explicit-snippet"
 class="Reference">5.2.2↑</a>, we can bind the
        <tt><lift:helloworld></lift:helloworld></tt> tag by setting up
        <tt>LiftRules.snippets</tt> in our Boot.boot method as shown
        in Listing <a  href="#lst:Explicitly-Binding-a-snippet"  class="Reference">5.2.2↓</a>. Notice that in order to bind the same
        way that we did with <tt>snippetDispatch</tt>, we need two
        lines to match the un-suffixed and suffixed versions. If you omit the
        un-suffixed line you will get a snippet failure.
        <div  class="listing">
          <div  class="caption"> Explicitly Binding a Snippet Method<a  name="lst:Explicitly-Binding-a-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_478611">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">com.foo.logic</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.snippets.append {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala comments">// Matches a tag without a suffix (<lift:helloworld>)</lift:helloworld></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">List(</code><code
 class="scala string">"HelloWorld"</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">> HelloWorld.render(</code><code
 class="scala string">"no name"</code><code  class="scala plain">) </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">List(</code><code
 class="scala string">"HelloWorld"</code><code  class="scala plain">, name) </code><code
 class="scala keyword">=</code><code  class="scala plain">> HelloWorld.render(name) </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.2.3"  class="toc">5.2.3</a> 
        Per-request Remapping<a  href="#index-Snippets-Per-request-remapping"  name="entry-Snippets-Per-request-remapping-0"
 class="IndexReference">↓</a>
      </h3>
      <div  class="Unindented"> The final piece of snippet mapping that we want
        to discuss is per-request remapping. The S.mapSnippet method allows you
        to modify which snippet method will service a given snippet tag within
        your page processing. For example, Listing <a  href="#lst:Remapping-A-Snippet"
 class="Reference">5.2.3↓</a> shows how we can conditionally “blank” a
        snippet based on logic in a second snippet. This functionality isn’t
        used frequently as the other types of snippet dispatch, but it’s here in
        case you need it. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Remapping A Snippet<a  name="lst:Remapping-A-Snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_534184">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">scala.xml.NodeSeq</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.S</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">Display {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">header (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// If simple is set, we don’t display complexStuff</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">S.param(</code><code  class="scala string">"simple"</code><code
 class="scala plain">).foreach {</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">S.mapSnippet(</code><code  class="scala string">"complexStuff"</code><code
 class="scala plain">, ignore </code><code  class="scala keyword">=</code><code
 class="scala plain">> Text(</code><code  class="scala string">""</code><code  class="scala plain">))</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">complexStuff (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-5.3"  class="toc">5.3</a> 
        Snippet Methods<a  name="sec:Snippets"  class="Label"> </a> </h2>
      <div  class="Unindented"> Now that we’ve examined how Lift determines
        which snippet to execute, let’s look at what a snippet method actually
        does. A snippet method is essentially a transform, taking a single
        <tt>scala.xml.NodeSeq</tt><a  href="#index-NodeSeq"  name="entry-NodeSeq-1"
 class="IndexReference">↓</a> argument and
        returning a <tt>NodeSeq</tt>. </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note: Although Scala can
            often infer return types, it’s important to explicitly specify the
            return type of your snippet methods as <tt>NodeSeq</tt>.
            Failure to do so may prevent Lift from locating the snippet method
            if you’re using implicit dispatch (Розділ <a  href="#sub:Implicit-Dispatch-Via"
 class="Reference">5.2.1↑</a>), in which case the snippet won’t
            execute! </div>
        </div>
      </div>
      <div  class="Indented"> The argument passed to the snippet method is the
        XML content of the snippet tag. Because Lift processes XML from the root
        element down to the child elements (outside-in), the contents of the
        snippet tag aren’t processed until <i>after</i> the snippet method
        processes them. You may reverse the order of processing by specifying
        the <tt>eager_eval</tt> attribute on the tag (Розділ <a  href="#sub:Eager-Eval"
 class="Reference">5.3.4↓</a>). As an example, let’s say we wanted a
        snippet that would output the current balance of our ledger, shown in
        Listing <a  href="#lst:Returning-tags-snippet"  class="Reference">5.3↓</a>. We simply return an XML Text node with
        the formatted balance. Note that the XML result from a snippet is itself
        processed recursively, so the <tt>lift:Util.time</tt>
        snippet will be processed after our snippet method returns. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Returning Tags from a Snippet<a  name="lst:Returning-tags-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_391437">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Ledger {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">balance (content </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"></code><p><code  class="scala plain">{currentLedger.formattedBalance}</code></p></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">as of <lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">Util.time /><p></p></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </code></div><code  class="scala plain">
                    </code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> It is this hierarchical processing of template
        tags that makes Lift so flexible. For those of you coming to Lift with
        some JSP experience, Lift is designed to let you write something similar
        to tag libraries, but that are much more powerful and much simpler to
        use. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.3.1"  class="toc">5.3.1</a> 
        Binding Values in Snippets<a  name="sub:Binding-Values-in-snippets"  class="Label">
        </a><a  href="#index-Binding"  name="entry-Binding-0"  class="IndexReference">↓</a><a
 href="#index-Snippets-binding"  name="entry-Snippets-binding-0"  class="IndexReference">↓</a> </h3>
      <div  class="Unindented"> So far we’ve shown our snippets generating
        complete output and ignoring the input to the method. Lift actually
        provides some very nice facilities for using the input
        <tt>NodeSeq</tt> within your snippet to help keep
        presentation and code separate. First, remember that the input
        <tt>NodeSeq</tt> consists of the child elements for the
        snippet tag in your template. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Snippet Tag Children<a  name="lst:Snippet-tag-children"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_696856">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">Ledger.balance></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><ledger<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">balance/> as of <ledger<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">time /></code></ledger<></code></ledger<></code></div><code
 class="scala plain"><code  class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala plain"><code
 class="scala keyword">:</code><code  class="scala plain">Ledger.balance></code></code></div><code
 class="scala plain">
                      </code></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> For example, given a template containing the
        snippet tag shown in Listing <a  href="#lst:Snippet-tag-children"  class="Reference">5.3.1↑</a>, the Ledger.balance method receives </div>
      <pre  class="LyX-Code"><ledger:balance> as of <ledger:time>
</ledger:time></ledger:balance></pre>
      <div  class="Unindented"> as its input parameter. This is perfectly
        correct XML, although it may look a little strange at first unless
        you’ve used prefixed elements in XML before. The key is that Lift allows
        you to selectively “bind”, or replace, these elements with data inside
        your snippet. The <tt>Helpers.bind</tt><span  class="FootOuter"><span  class="SupFootMarker"> [V] </span><span
 class="HoverFoot"><span  class="SupFootMarker"> 
              [V] </span>net.liftweb.util.Helpers. Technically the bind method
            is overloaded, and can even fill in values for the lift:bind tag,
            but this is advanced usage and we’re not going to cover that here.</span></span>
        method takes three arguments: </div>
      <ol>
        <li> The prefix for the tags you wish to bind, in this instance,
          “ledger” </li>
        <li> The <tt>NodeSeq</tt> that contains the tags you wish to
          bind </li>
        <li> One or more <tt>BindParam</tt> elements that map the
          tag name to a replacement value </li>
      </ol>
      <div  class="Unindented"> While you can create your own
        <tt>BindParam</tt> instances by hand, we generally recommend
        importing <tt>Helpers._</tt>, which among other things
        contains a convenient implicit conversion to BindParam using the “->”
        operator. With this knowledge in hand, we can change our previous
        definition of the balance method in Listing <a  href="#lst:Returning-tags-snippet"
 class="Reference">5.3↑</a> to that in Listing <a  href="#lst:Binding-the-ledger-balance"
 class="Reference">5.3.1↓</a> below. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Binding the Ledger Balance<a  name="lst:Binding-the-ledger-balance"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_378783">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Ledger {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">balance (content </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq ) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">bind (</code><code  class="scala string">"ledger"</code><code
 class="scala plain">, content,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">          </code><code
 class="scala string">"balance"</code> <code  class="scala plain">-> Text(currentLedger.formattedBalance),</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">          </code><code
 class="scala string">"time"</code> <code  class="scala plain">-> Text((</code><code
 class="scala keyword">new</code> <code  class="scala plain">java.util.Date).toString))</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see here, we actually gain a line of
        code over our previous effort, but the trade-off makes it far simpler
        for us to change the layout just by editing the template. </div>
      <div  class="Indented"> One last aspect of binding that we want to discuss
        is that any attributes set on the input elements that are being bound
        will be discarded<a  href="#index-Attributes-discarded-in-bind"  name="entry-Attributes-discarded-in-bind-0"
 class="IndexReference">↓</a>
        if you use the “->” binding operator. See Розділ <a  href="#sec:Handling-XHTML-Attributes"
 class="Reference">5.4↓</a> for more details on how you manipulate
        attributes in bindings, including how you can retain attributes on
        binding elements from your templates by using the “-%>”<a  href="#index-Attributes--%%3E-operator"
 name="entry-Attributes--%>-operator-0"  class="IndexReference">↓</a>
        binding operator instead. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.3.2"  class="toc">5.3.2</a> 
        CSS Selector Transforms<a  name="sub:CSS-Selector-Transforms"  class="Label">
        </a><a  href="#index-CSS-selector-transforms"  name="entry-CSS-selector-transforms-0"
 class="IndexReference">↓</a><a  href="#index-Binding-with-CSS"  name="entry-Binding-with-CSS-1"
 class="IndexReference">↓</a><a  href="#index-Snippets-binding-with-CSS"  name="entry-Snippets-binding-with-CSS-0"
 class="IndexReference">↓</a><a  href="#index-CSS-Transforms"  name="entry-CSS-Transforms-0"
 class="IndexReference">↓</a> </h3>
      <div  class="Unindented"> In addition to the binding support detailed in
        Розділ <a  href="#sub:Binding-Values-in-snippets"  class="Reference">5.3.1↑</a>, Lift 2.2 introduces binding via CSS
        transforms as part of its support for designer friendly templates. These
        allow you to bind values into template XHTML (or HTML5, see Розділ <a  href="#sec:HTML5-Support"
 class="Reference">4.3 on page 1↑</a>) by using the attributes on
        specific elements. Let’s start by looking at a basic example,
        corresponding to the examples in Розділ <a  href="#sub:Binding-Values-in-snippets"
 class="Reference">5.3.1↑</a>. </div>
      <div  class="Indented"> Listing <a  href="#lst:A-Simple-CSS-snippet"  class="Reference">5.3.2↓</a> shows a Designer-Friendly version of
        Listing <a  href="#lst:Snippet-tag-children"  class="Reference">5.3.1↑</a>. You can see that we’re invoking the
        <tt>Ledger.balance</tt> snippet via the class attribute, and
        we’ve specified the binding elements as normal
        <tt><span></span></tt> elements with <tt>id</tt>
        attributes. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Simple CSS Snippet<a  name="lst:A-Simple-CSS-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_395356">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><div
 <=""  code=""><code  class="scala keyword">class</code><code  class="scala keyword">=</code><code
 class="scala string">"lift:Ledger.balance"</code><code  class="scala plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><span  id<=""  code=""><code  class="scala keyword">=</code><code
 class="scala string">"balance"</code><code  class="scala plain">>$</code><code
 class="scala value">0</code><code  class="scala plain"></code></span><code  class="scala plain"> as of <span
 id<=""  code=""><code  class="scala keyword">=</code><code  class="scala string">"time"</code><code
 class="scala plain">>midnight</code></span></code></code></div><code  class="scala plain"><code
 class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala plain"></code></div></code></code></code></div><code
 class="scala plain"><code  class="scala plain">
                      </code></code></div><code  class="scala plain"><code  class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now, we need to perform the CSS transform within
        our snippet. The binding implicits for CSS transforms are found on the
        <tt>net.liftweb.util.BindHelpers</tt> object/trait, so you
        should import it (in particular, the
        <tt>strToCssBindPromoter</tt> method). Listing <a  href="#lst:Binding-the-Ledger-with-CSS"
 class="Reference">5.3.2↓</a> shows how we modify the snippet in
        Listing <a  href="#lst:Binding-the-ledger-balance"  class="Reference">5.3.1↑</a> to utilize the new CSS transform. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Binding the Ledger Balance with CSS<a  name="lst:Binding-the-Ledger-with-CSS"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_358910">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.BindHelpers.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Ledger {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">balance </code><code
 class="scala keyword">=</code> <code  class="scala string">"#balance"</code> <code
 class="scala keyword">#</code><code  class="scala plain">> currentLedger.formattedBalance &</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala string">"#time"</code> <code  class="scala keyword">#</code><code
 class="scala plain">> (</code><code  class="scala keyword">new</code> <code  class="scala plain">java.util.Date).toString</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see in this example, CSS transforms are
        comprised of three parts: the transform selector, the transform operator
        (<tt>#></tt>), and the right hand side value. This value
        can be a number of different things, which we’ll cover in Розділ <a  href="#sub:Replacement-Values"
 class="Reference">5.3.2.2↓</a>, but in our case we’re using a
        <tt>MappedField</tt> and a <tt>String</tt>.
        Additionally, you can chain transforms together with the
        <tt>&</tt> operator. </div>
      <h4  class="Subsubsection"> <a  name="toc-Subsubsection-5.3.2.1"  class="toc">5.3.2.1</a> 
        CSS Selector Syntax </h4>
      <div  class="Unindented"> The selector syntax is based on a subset of CSS,
        so if you already know that you’re well on your way. The syntax can
        operate on elements based on id or class, and can also operate on
        attributes of those elements. Let’s look at the basic syntax: </div>
      <ul>
        <li> <tt>#foo</tt> - Selects the element with an
          <tt>id</tt> attribute of “foo” </li>
        <li> <tt>.foo</tt> - Selects all elements with a CSS
          <tt>class</tt> of “foo” </li>
        <li> <tt>@foo</tt> - Selects all elements with a
          <tt>name</tt> attribute of “foo” </li>
        <li> <tt>attrName=attrValue</tt> - Selects all elements with
          an attribute of “attrName” equal to “attrValue” </li>
        <li> <tt>element</tt> - Selects all “element” elements (e.g.
          span, h1, etc.) </li>
        <li> <tt>:type</tt> - Selects all elements with a
          <tt>type</tt> of “type”. The type must be one of:
          <ul>
            <li> <tt>button</tt> </li>
            <li> <tt>checkbox</tt> </li>
            <li> <tt>file</tt> </li>
            <li> <tt>password</tt> </li>
            <li> <tt>radio</tt> </li>
            <li> <tt>reset</tt> </li>
            <li> <tt>submit</tt> </li>
            <li> <tt>text</tt> </li>
          </ul>
        </li>
        <li> <tt>*</tt> - Selects all elements </li>
      </ul>
      <div  class="Unindented"> The element matching the selector is replaced by
        the result of processing the replacement. That means that in the example
        of Listing <a  href="#lst:A-Simple-CSS-snippet"  class="Reference">5.3.2↑</a> the <tt>span</tt> elements
        will be replaced with straight Text elements, resulting in the markup
        shown in Listing <a  href="#lst:Sample-CSS-Transform-result"  class="Reference">5.3.2.1↓</a> (in other words, no remaining markup).
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Sample CSS Transform Result<a  name="lst:Sample-CSS-Transform-result"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_111430">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain">$12.42 as of Fri Jan 14 08:29:50 MST 2011</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> You can further refine the replacement with an
        optional qualifier. We’ve already seen how omitting the qualifer results
        in wholesale replacement of the matching element, but there are a few
        additional options: </div>
      <ul>
        <li> <tt>*</tt> - Replaces the children of the selected
          element. For example, if we changed our selector in Listing <a  href="#lst:Binding-the-Ledger-with-CSS"
 class="Reference">5.3.2↑</a> from <tt>“#balance”</tt>
          to <tt>“#balance *”</tt>, we would be replacing the text
          node child (“$0”), with the resulting markup:
          <pre  class="LyX-Code"><span  id="balance">$12.42</span> as of Fri Jan 14 08:29:50 MST 2011
</pre>
          <div  class="Unindented"> Note that when we perform child replacement,
            the parent’s attributes<a  href="#index-CSS-Transforms-attribute-copying"
 name="entry-CSS-Transforms-attribute-copying-0"  class="IndexReference">↓</a>
            are carried over to the resulting element. There is an exception to
            this in the case of iterated replacements, which we’ll cover in
            Розділ <a  href="#sub:Replacement-Values"  class="Reference">5.3.2.2↓</a>. </div>
        </li>
        <li> <tt>*+</tt> - Appends to the children of the selected
          element. For example, given the template
          <pre  class="LyX-Code"><span  id="love">I love </span>
</pre>
          <div  class="Unindented"> The transform </div>
          <pre  class="LyX-Code">"#love *+" #> "figs"
</pre>
          <div  class="Unindented"> Would result in the markup </div>
          <pre  class="LyX-Code"><span  id="love">I love figs</span>
</pre> </li>
        <li> <tt>-*</tt> - Prepends to the children of the selected
          element. This operates the same as appending. </li>
        <li> <tt>[name]</tt> - <a  href="#index-CSS-Transforms-attribute-replacement"
 name="entry-CSS-Transforms-attribute-replacement-0"  class="IndexReference">↓</a>Sets
          the value of the <tt>”name”</tt> attribute on the selected
          element. If the attribute already exists on the selected element, its
          value is replaced, otherwise the attribute is added. For example, if
          we wanted to replace both the link text and <tt>href</tt>
          of a link via CSS transform for the template
          <pre  class="LyX-Code"><a  href="#">ReplaceMe</a>
</pre>
          <div  class="Unindented"> We could perform this by chaining two
            selections together, one for the child element (link text) and one
            for the <tt>href</tt> attribute: </div>
          <pre  class="LyX-Code">"a *" #> "This is the link text"& 
  "a [href]" #> "http://foo.com/bar"
</pre>
          <div  class="Unindented"> Note that the order of the selections is not
            important. </div>
        </li>
        <li> <tt>[name+]</tt> - Appends a value to the attribute on
          the selected element. If the attribute doesn’t already exist on the
          element then this behaves the same as the <tt>[name]</tt>
          qualifier. One example would be adding to the
          <tt>class</tt> attribute for a given element:
          <pre  class="LyX-Code">"tr [class+]" #> (if (index % 2) "odd" else "even")
</pre> </li>
        <li> <tt>^^</tt> - Makes the selected element the root of
          the returned elements. This can be used to select a particular element
          from a template, similar to
          <tt>BindHelpers.chooseTemplate</tt>. The right hand side
          for the selected element is ignored, but you can chain further
          transforms to modify the returned element. For example, if we decided
          to only output the balance in Listing <a  href="#lst:A-Simple-CSS-snippet"
 class="Reference">5.3.2↑</a>, we could do so by changing our
          snippet code to:
          <pre  class="LyX-Code">def balance = "#balance ^^" #> "ignore" &
  "#balance" #> currentLedger.formattedBalance
</pre> </li>
      </ul>
      <h4  class="Subsubsection"> <a  name="toc-Subsubsection-5.3.2.2"  class="toc">5.3.2.2</a> 
        Right Hand Side Values<a  name="sub:Replacement-Values"  class="Label">
        </a> </h4>
      <div  class="Unindented"> The right hand side of a CSS transform operates
        on the selected element to either transform or replace it. It can be one
        of: </div>
      <ul>
        <li> <tt>String</tt> constant - returns a Text node for the
          <tt>String</tt>. For example, in Listing <a  href="#lst:Binding-the-Ledger-with-CSS"
 class="Reference">5.3.2↑</a>:
          <pre  class="LyX-Code">"#time" #> (new java.util.Date).toString
</pre> </li>
        <li> A <tt>NodeSeq</tt> constant - returns the
          <tt>NodeSeq</tt> itself. In Listing <a  href="#lst:Binding-the-Ledger-with-CSS"
 class="Reference">5.3.2↑</a> we could have done this instead:
          <pre  class="LyX-Code">"#time" #> Text((new java.util.Date).toString)
</pre> </li>
        <li> <span  class="formula"><i>NodeSeq</i> ⇒ <i>NodeSeq</i></span> - a
          function that transforms the selected element. Note that CSS
          transforms extend <span  class="formula"><i>NodeSeq</i> ⇒ <i>NodeSeq</i></span>,
          so you can nest transforms like
          <pre  class="LyX-Code">// Select the element with id "entry" and then bind its 
// nested "name" element
"#entry" #> { "#name" #> account.name }
</pre> </li>
        <li> <tt>net.liftweb.util.Bindable</tt> - Instances that
          implement the <tt>Bindable</tt> trait will be
          automatically converted into a <tt>NodeSeq</tt>. Among
          other things, <tt>MappedField</tt> and
          <tt>Record.Field</tt> support this, which allows us to use
          instances directly:
          <pre  class="LyX-Code">"#description" #> account.description
</pre> </li>
        <li> <tt>Boolean</tt>, <tt>Int</tt>,
          <tt>Long</tt> or <tt>Symbol</tt> - These are
          automatically promoted to a <tt>String</tt> via the
          <tt>net.liftweb.util.StringPromotable</tt> trait and
          implicits on its companion object
          <pre  class="LyX-Code">"#viewperm" #> account.isViewableBy(someUser)
</pre> </li>
        <li> A <tt>Box</tt>, <tt>Option</tt> or
          <tt>Seq</tt> of <tt>String</tt>,
          <tt>NodeSeq</tt>, <tt>Bindable</tt> or values
          convertable by <tt>StringPromotable</tt> - These will be
          converted into a <tt>net.liftweb.util.IterableConst</tt>,
          which is used to compute a <tt>Seq[NodeSeq]</tt>. If your
          selector replaces the children of the selected element (*), the
          <tt>IterableConst</tt> is applied to the selected element
          once for each item in the <tt>Seq</tt>. In other words,
          you get a copy of the selected element for each original input. For
          example, given the template:
          <pre  class="LyX-Code"><h2>Account names:</h2>
<ul>
<li  id="item">Account</li>
</ul>
</pre>
          <div  class="Unindented"> We can iterate over a list of accounts with
            the CSS transform: </div>
          <pre  class="LyX-Code">"#item *" #> accounts.map(_.name.toString)
</pre>
          <div  class="Unindented"> Which, assuming a set of accounts named “A”,
            “B”, and “C”, results in: </div>
          <pre  class="LyX-Code"><h2>Account names:</h2>
<ul>
<li  id="item">A</li>
  <li>B</li>
  <li>C</li>
</ul>
</pre>
          <div  class="Unindented">
            <div  class="center">
              <div  style="width: 80%;"  class="Shadowbox"> Note that the
                <tt>id</tt> attribute is only placed on the first
                transformed element. Subsequent replacements strip the
                <tt>id</tt> attribute so that it remains unique on
                the page. This special handling applies only to the
                <tt>id</tt> attribute; other attributes, such as
                <tt>class</tt>, are not similarly stripped. </div>
            </div>
          </div>
          <div  class="Indented"> Passing in a
            <tt>None</tt>/<tt>Empty</tt> will remove the
            selected element. For example, you can delete an attribute<a  href="#index-CSS-Transforms-deleting-attribute"
 name="entry-CSS-Transforms-deleting-attribute-0"  class="IndexReference">↓</a><a
 href="#index-Attributes-delete-with-CSS-transform"  name="entry-Attributes-delete-with-CSS-transform-0"
 class="IndexReference">↓</a>
            with the following code: </div>
          <pre  class="LyX-Code">val blank: Option[String] = None
"#thing [class]" #> blank
</pre> </li>
        <li> A <tt>Box</tt>, <tt>Option</tt> or
          <tt>Seq</tt> of <span  class="formula"><i>NodeSeq</i>  ⇒ <i>NodeSeq</i></span>
          - These will be converted into a
          <tt>net.liftweb.util.IterableFunc</tt>, and follow the
          same rules for replacement as <tt>IterableConst</tt> (e.g.
          child replacement repetition). </li>
      </ul>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.3.3"  class="toc">5.3.3</a> 
        Stateless versus Stateful Snippets<a  name="sub:Stateless-versus-Stateful"
 class="Label"> </a><a  href="#index-StatefulSnippet"  name="entry-StatefulSnippet-1"
 class="IndexReference">↓</a><a  href="#index-Snippets-stateful-vs-stateless"  name="entry-Snippets-stateful-vs-stateless-0"
 class="IndexReference">↓</a>
      </h3>
      <div  class="Unindented"> The lifecycle of a snippet is stateless by
        default. That means that for each request, Lift creates a new instance
        of the snippet class to execute (or uses the same staic method if using
        explicit dispatch, Розділ <a  href="#sub:Explicit-Dispatch"  class="Reference">5.2.2↑</a>). Any changes you make to instance
        variables will be discarded after the request is processed. If you want
        to keep some state around, you have a couple of options: </div>
      <ul>
        <li> Store the state in a cookie<a  href="#index-cookie"  name="entry-cookie-0"
 class="IndexReference">↓</a> (Розділ <a  href="#sec:Cookies"  class="Reference">3.10↑</a>). This can be useful if you have data
          that you want to persist across sessions. The down side is that you
          have to manage the cookie as well as deal with any security
          implications for the data in the cookie as it’s stored on the user’s
          machine. </li>
        <li> Store the state in a <tt>SessionVar</tt><a  href="#index-SessionVar"
 name="entry-SessionVar-0"  class="IndexReference">↓</a> (Розділ <a  href="#sec:Session-and-Request"
 class="Reference">3.11↑</a>). This is a little easier to manage
          than cookies, but you still have to handle adding and removing the
          session data if you don’t want it around for the duration of the
          session. As with a cookie, it is global, which means that it will be
          the same for all snippet instances for a given session. </li>
        <li> Pass the state around in a <tt>RequestVar</tt><a  href="#index-RequestVar"
 name="entry-RequestVar-0"  class="IndexReference">↓</a> by setting
          “injector” functions in your page transition functions (e.g.
          <tt>SHtml.link</tt>, <tt>S.redirectTo</tt>,
          etc). We cover this technique in Розділ <a  href="#sec:Session-and-Request"
 class="Reference">3.11↑</a>. </li>
        <li> Use a <tt>StatefulSnippet</tt><a  href="#index-StatefulSnippet"  name="entry-StatefulSnippet-2"
 class="IndexReference">↓</a>
          subclass. This is ideal for small, conversational state, such as a
          form that spans multiple pages or for a page where you have multiple
          variables that you want to be able to tweak individually. </li>
      </ul>
      <div  class="Unindented"> Using a <tt>StatefulSnippet</tt> is
        very similar to using a normal snippet but with the addition of a few
        mechanisms. First, the <tt>State</tt>fulSnippet trait
        extends <tt>DispatchSnippet</tt> (see Розділ <a  href="#sub:Implicit-Dispatch-Via"
 class="Reference">5.2.1↑</a>), allowing you to define which methods
        handle which snippets based on the <tt>dispatch</tt> method.
        Because Scala allows <tt>def</tt>s to be implemented by
        <tt>var</tt>s in subclasses, we can redefine the dispatch
        behavior as a result of snippet processing. </div>
      <div  class="Indented"> Another thing to remember when using
        <tt>StatefulSnippet</tt>s is that when you render a form, a
        hidden field is added to the form that permits the same instance of the
        <tt>StatefulSnippet</tt> that created the form to be the
        target of the form submission. If you need to link to a different page,
        but would like the same snippet instance to handle snippets on that
        page, use the <tt>StatefulSnippet.link</tt> method (instead
        of <tt>SHtml.link</tt>); similarly, if you need to redirect
        to a different page, the <tt>StatefulSnippet</tt> trait
        defines a <tt>redirectTo</tt> method. In either of these
        instances, a function map is added to the link or redirect,
        respectively, that causes the instance to be reattached. </div>
      <div  class="Indented"> When might you use a stateful snippet? Consider a
        multi-part form where you’d like to have a user enter data over several
        pages. You’ll want the application to maintain the previously entered
        data while you validate the current entry, but you don’t want to have to
        deal with a lot of hidden form variables. Using a
        <tt>StatefulSnippet</tt> instance greatly simplifies writing
        the snippet because you can keep all of your pertinent information
        around as instance variables instead of having to insert and extract
        them from every request, link, etc. </div>
      <div  class="Indented"> Listing <a  href="#lst:Using-a-StatefulSnippet"  class="Reference">5.3.3↓</a> shows an example of a stateful snippet
        that handles the above example. Note that for this example, the URL (and
        therefore, the template) don’t change between pages. The template we use
        is shown in Listing <a  href="#lst:The-StatefulSnippet-Example"  class="Reference">5.3.3↓</a>. Remember to call
        <tt>unregisterThisSnippet()</tt> when you’re finished with
        your workflow in order to stop the current instance from being used. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using a StatefulSnippet<a  name="lst:Using-a-StatefulSnippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_995541">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                      <div  class="line number52 index51 alt1">52</div>
                      <div  class="line number53 index52 alt2">53</div>
                      <div  class="line number54 index53 alt1">54</div>
                      <div  class="line number55 index54 alt2">55</div>
                      <div  class="line number56 index55 alt1">56</div>
                      <div  class="line number57 index56 alt2">57</div>
                      <div  class="line number58 index57 alt1">58</div>
                      <div  class="line number59 index58 alt2">59</div>
                      <div  class="line number60 index59 alt1">60</div>
                      <div  class="line number61 index60 alt2">61</div>
                      <div  class="line number62 index61 alt1">62</div>
                      <div  class="line number63 index62 alt2">63</div>
                      <div  class="line number64 index63 alt1">64</div>
                      <div  class="line number65 index64 alt2">65</div>
                      <div  class="line number66 index65 alt1">66</div>
                      <div  class="line number67 index66 alt2">67</div>
                      <div  class="line number68 index67 alt1">68</div>
                      <div  class="line number69 index68 alt2">69</div>
                      <div  class="line number70 index69 alt1">70</div>
                      <div  class="line number71 index70 alt2">71</div>
                      <div  class="line number72 index71 alt1">72</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">... standard Lift imports ...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">scala.xml.Text</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">BridgeKeeper </code><code  class="scala keyword">extends</code> <code
 class="scala plain">StatefulSnippet {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Define the dispatch for snippets. Note that we are defining</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// it as a var so that the snippet for each portion of the </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// multi-part form can update it after validation.</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">dispatch </code><code
 class="scala keyword">:</code> <code  class="scala plain">DispatchIt </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// We default to dispatching the "challenge" snippet to our</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// namePage snippet method. We’ll update this below</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"challenge"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> firstPage </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Define our state variables:</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">(name,quest,color) </code><code
 class="scala keyword">=</code> <code  class="scala plain">(</code><code  class="scala string">""</code><code
 class="scala plain">,</code><code  class="scala string">""</code><code  class="scala plain">,</code><code
 class="scala string">""</code><code  class="scala plain">)</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Our first form page</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">firstPage (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">processName (nm </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) {</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">name </code><code  class="scala keyword">=</code> <code  class="scala plain">nm</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">if</code> <code  class="scala plain">(name !</code><code
 class="scala keyword">=</code> <code  class="scala string">""</code><code  class="scala plain">) {</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">dispatch </code><code  class="scala keyword">=</code> <code
 class="scala plain">{ </code><code  class="scala keyword">case</code> <code  class="scala string">"challenge"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> questPage </code><code
 class="scala keyword">_</code> <code  class="scala plain">}</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">S.error(</code><code  class="scala string">"You must provide a name!"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"form"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">         </code><code
 class="scala string">"question"</code> <code  class="scala plain">-> Text(</code><code
 class="scala string">"What is your name?"</code><code  class="scala plain">),</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">         </code><code
 class="scala string">"answer"</code> <code  class="scala plain">-> SHtml.text(name, processName))</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">questPage (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">processQuest (qst </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) {</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">quest </code><code  class="scala keyword">=</code> <code  class="scala plain">qst</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">if</code> <code  class="scala plain">(quest !</code><code
 class="scala keyword">=</code> <code  class="scala string">""</code><code  class="scala plain">) {</code></div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">dispatch </code><code  class="scala keyword">=</code> <code
 class="scala plain">{ </code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala spaces">          </code><code
 class="scala keyword">case</code> <code  class="scala string">"challenge"</code> <code
 class="scala keyword">if</code> <code  class="scala plain">name </code><code  class="scala keyword">==</code> <code
 class="scala string">"Arthur"</code> <code  class="scala keyword">=</code><code
 class="scala plain">> swallowPage </code><code  class="scala keyword">_</code></div>
                        <div  class="line number38 index37 alt1"><code  class="scala spaces">          </code><code
 class="scala keyword">case</code> <code  class="scala string">"challenge"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> colorPage </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number39 index38 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">}</code></div>
                        <div  class="line number40 index39 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number41 index40 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">S.error(</code><code  class="scala string">"You must provide a quest!"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number42 index41 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number43 index42 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number44 index43 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"form"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number45 index44 alt2"><code  class="scala spaces">         </code><code
 class="scala string">"question"</code> <code  class="scala plain">-> Text(</code><code
 class="scala string">"What is your quest?"</code><code  class="scala plain">),</code></div>
                        <div  class="line number46 index45 alt1"><code  class="scala spaces">         </code><code
 class="scala string">"answer"</code> <code  class="scala plain">-> SHtml.text(quest, processQuest))</code></div>
                        <div  class="line number47 index46 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number48 index47 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number49 index48 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">colorPage (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number50 index49 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">processColor (clr </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) {</code></div>
                        <div  class="line number51 index50 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">color </code><code  class="scala keyword">=</code> <code  class="scala plain">clr</code></div>
                        <div  class="line number52 index51 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">if</code> <code  class="scala plain">(color.toLowercase.contains </code><code
 class="scala string">"No,"</code><code  class="scala plain">) {</code></div>
                        <div  class="line number53 index52 alt2"><code  class="scala spaces">        </code><code
 class="scala comments">// This is a cleanup that removes the mapping for this</code></div>
                        <div  class="line number54 index53 alt1"><code  class="scala spaces">        </code><code
 class="scala comments">// StatefulSnippet from the session. This will happen </code></div>
                        <div  class="line number55 index54 alt2"><code  class="scala spaces">        </code><code
 class="scala comments">// over time with GC, but it’s best practice to manually </code></div>
                        <div  class="line number56 index55 alt1"><code  class="scala spaces">        </code><code
 class="scala comments">// do this when you’re finished with the snippet</code></div>
                        <div  class="line number57 index56 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">this</code><code  class="scala plain">.unregisterThisSnippet()</code></div>
                        <div  class="line number58 index57 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">S.redirectTo(</code><code  class="scala string">"/pitOfEternalPeril"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number59 index58 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala keyword">if</code> <code
 class="scala plain">(color !</code><code  class="scala keyword">=</code> <code
 class="scala string">""</code><code  class="scala plain">) {</code></div>
                        <div  class="line number60 index59 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">this</code><code  class="scala plain">.unregisterThisSnippet()</code></div>
                        <div  class="line number61 index60 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">S.redirectTo(</code><code  class="scala string">"/scene24"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number62 index61 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number63 index62 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">S.error(</code><code  class="scala string">"You must provide a color!"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number64 index63 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number65 index64 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number66 index65 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"form"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number67 index66 alt2"><code  class="scala spaces">         </code><code
 class="scala string">"question"</code> <code  class="scala plain">-> Text(</code><code
 class="scala string">"What is your favorite color?"</code><code  class="scala plain">),</code></div>
                        <div  class="line number68 index67 alt1"><code  class="scala spaces">         </code><code
 class="scala string">"answer"</code> <code  class="scala plain">-> SHtml.text(color, processColor))</code></div>
                        <div  class="line number69 index68 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number70 index69 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// and so on for the swallowPage snippet</code></div>
                        <div  class="line number71 index70 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number72 index71 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The StatefulSnippet Example Template<a  name="lst:The-StatefulSnippet-Example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_421665">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:BridgeKeeper.challenge</code> <code
 class="xml color1">form</code><code  class="xml plain">=</code><code  class="xml string">"POST"</code><code
 class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">form:question</code> <code
 class="xml plain">/> : <</code><code  class="xml keyword">form:answer</code> <code
 class="xml plain">/> <</code><code  class="xml keyword">br</code> <code  class="xml plain">/></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">input</code> <code  class="xml color1">type</code><code
 class="xml plain">=</code><code  class="xml string">"submit"</code> <code  class="xml color1">value</code><code
 class="xml plain">=</code><code  class="xml string">"Answer"</code> <code  class="xml plain">/></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">lift:BridgeKeeper.challenge</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number6 index5 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></div><code  class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> If you’re using implicit dispatch (Розділ <a  href="#sub:Implicit-Dispatch-Via"
 class="Reference">5.2.1↑</a>), then you’re done. If you want to use
        explicit dispatch<a  href="#index-Snippets-explicit-dispatch-with-StatefulSnippet"
 name="entry-Snippets-explicit-dispatch-with-StatefulSnippet-0"  class="IndexReference">↓</a><a
 href="#index-StatefulSnippet-explicit-dispatch"  name="entry-StatefulSnippet-explicit-dispatch-0"
 class="IndexReference">↓</a>,
        however, you need to do a little more work than usual in the
        <tt>LiftRules.snippetDispatch</tt> setup. Listing <a  href="#lst:Explicit-Dispatch-with-stateful"
 class="Reference">5.3.3↓</a> shows how we can bind our own
        StatefulSnippet classes without using reflection. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Explicit Dispatch with Stateful Snippets<a  name="lst:Explicit-Dispatch-with-stateful"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_828516">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// In your boot method:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">LiftRules.snippetDispatch.append {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// S.snippetForClass checks to see if an instance has already</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// registered. This is the case after form submission or when</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// we use the StatefulSnippet.link or .redirectTo methods</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala string">"BridgeKeeper"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> S.snippetForClass(</code><code
 class="scala string">"TestHello"</code><code  class="scala plain">) openOr {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// If we haven’t already registered an instance, create one</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">inst </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">com.test.TestHello</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// The name is what Lift uses to locate an instance (S.snippetForClass)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// We need to add it so that the Stateful callback functions can</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// self-register</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">inst.addName(</code><code  class="scala string">"TestHello"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// Register this instance for the duration of the request</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">S.overrideSnippetForClass(</code><code  class="scala string">"TestHello"</code><code
 class="scala plain">, inst)</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">inst</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.3.4"  class="toc">5.3.4</a> 
        Eager Evaluation<a  name="sub:Eager-Eval"  class="Label"> </a> </h3>
      <div  class="Unindented"> As we mentioned in Розділ <a  href="#sec:Snippets"
 class="Reference">5.3↑</a>, Lift processes the contents of a snippet
        tag after it processes the tag itself. If you want the contents of a
        snippet tag to be processed <i>before</i> the snippet, then you need to
        specify the <tt>eager_eval</tt><a  href="#index-eager-eval"  name="entry-eager-eval-0"
 class="IndexReference">↓</a> attribute on
        the tag: </div>
      <pre  class="LyX-Code"><lift:hello.world  eager_eval="”true”">...</lift:hello.world>
</pre>
      <div  class="Unindented"> This is especially useful if you’re using an
        embedded<a  href="#index-embed"  name="entry-embed-1"  class="IndexReference">↓</a><a
 href="#index-Templates-embedded"  name="entry-Templates-embedded-0"  class="IndexReference">↓</a><a
 href="#index-Tags-embed"  name="entry-Tags-embed-1"  class="IndexReference">↓</a> template
        (Розділ <a  href="#sub:embed-tag"  class="Reference">4.5.7↑</a>). Consider Listing <a
 href="#lst:Embedding-and-eager"  class="Reference">5.3.4↓</a>: in this case, the
        <tt>eager_eval</tt> parameter makes Lift process the
        <tt><lift:embed></lift:embed></tt> tag before it executes the
        <tt>Hello.world</tt> snippet method. If the “formTemplate”
        template looks like Listing <a  href="#lst:The-formTemplate-template"  class="Reference">5.3.4↓</a>, then the
        <tt>Hello.world</tt> snippet sees the
        <tt><hello:name></hello:name></tt> and <tt><hello:time></hello:time></tt> XML tags as its <tt>NodeSeq</tt> input. If
        the <tt>eager_eval</tt> attribute is removed, however, the
        Hello.world snippet sees only a <tt><lift:embed></lift:embed></tt> tag that will be processed after it returns. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Embedding and eager evaluation<a  name="lst:Embedding-and-eager"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_87656">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:Hello.world</code> <code  class="xml color1">eager_eval</code><code
 class="xml plain">=</code><code  class="xml string">"true"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:embed</code> <code  class="xml color1">what</code><code
 class="xml plain">=</code><code  class="xml string">"formTemplate"</code> <code
 class="xml plain">/></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:Hello.world</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></div><code  class="xml plain">
                    </code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The formTemplate template<a  name="lst:The-formTemplate-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_494061">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:children</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">hello:name</code> <code  class="xml plain">/></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">hello:time</code> <code  class="xml plain">/></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:children</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></div><code  class="xml plain">
                    </code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-5.4"  class="toc">5.4</a> <a  name="sec:Handling-XHTML-Attributes"
 class="Label"> </a>Handling
        XHTML Attributes in Snippets<a  href="#index-Attributes"  name="entry-Attributes-0"
 class="IndexReference">↓</a><a  href="#index-XML-attribute-handling"  name="entry-XML-attribute-handling-0"
 class="IndexReference">↓</a> </h2>
      <div  class="Unindented"> It’s a common requirement that elements contain
        XHTML attributes to control things like style, provide an id, register
        javascript event handlers, and other functionality. Lift provides two
        main approaches to applying attributes to elements either in your
        snippet code or directly in the XHTML template. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.4.1"  class="toc">5.4.1</a> <a
 name="sub:Direct-attr-manip"  class="Label"> </a>Direct Manipulation
        in Code </h3>
      <div  class="Unindented"> You can apply attributes directly to XHTML
        elements using the “%” operator<a  href="#index-Attributes-%-operator"  name="entry-Attributes-%-operator-0"
 class="IndexReference">↓</a> to
        apply a<br />
        <tt>scala.xml.UnprefixedAttribute</tt> instance<span  class="FootOuter"><span
 class="SupFootMarker"> [W] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [W] </span>there’s a corresponding
            <tt>PrefixedAttribute</tt> as well</span></span> to an
        element. Lift’s <tt>net.liftweb.util.Helpers</tt> trait
        contains an implicit conversion from a
        <tt>Pair[String,_]</tt> to an
        <tt>UnprefixedAttribute</tt> called
        <tt>pairToUnprefixed</tt> that allows you to use a simpler
        syntax. You may chain invocations of “%” to apply multiple attributes.
        For example, Listing <a  href="#lst:Applying-Attributes-percent"  class="Reference">5.4.1↓</a> shows how you can apply an “id” and
        “class” attribute to a text box and to a normal paragraph. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Applying-Attributes-percent"  class="Label">
            </a>Applying Attributes with <tt>%</tt> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_728885">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">myInput </code><code  class="scala keyword">=</code> <code
 class="scala plain">SHtml.text(</code><code  class="scala string">""</code><code
 class="scala plain">, processText(</code><code  class="scala keyword">_</code><code
 class="scala plain">)) </code><code  class="scala keyword">%</code> <code  class="scala plain">(</code><code
 class="scala string">"id"</code> <code  class="scala plain">-> </code><code  class="scala string">"inputField"</code><code
 class="scala plain">) </code><code  class="scala keyword">%</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">(</code><code  class="scala string">"class"</code> <code  class="scala plain">-> </code><code
 class="scala string">"highlighted"</code><code  class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note that the % metadata
            mechanism is actually part of the Scala XML library. Specifically,
            <tt>scala.xml.Elem</tt> has a <tt>%</tt>
            method that allows the user to update the attributes on a given XML
            element by passing in a
            <tt>scala.xml.UnprefixedAttribute</tt>. We suggest
            reading more about this in the Scala API documents, or in the Scala
            XML docbook at <a  href="http://burak.emir.googlepages.com/scalaxbook.docbk.html"
 class="URL">http://burak.emir.googlepages.com/scalaxbook.docbk.html</a>.
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-5.4.2"  class="toc">5.4.2</a> <a
 name="sub:XHTML-Attribute-Pass-through"  class="Label"> </a>XHTML
        Attribute Pass-through<a  href="#index-Attributes-binding"  name="entry-Attributes-binding-0"
 class="IndexReference">↓</a><a  href="#index-XML-preserving-attributes"  name="entry-XML-preserving-attributes-0"
 class="IndexReference">↓</a>
      </h3>
      <div  class="Unindented"> The second main approach to modifying XHTML
        attributes is to specify them directly in your templates. This has the
        benefit of allowing your template designers to directly manipulate
        things like style-related attributes and keeping the markup and the
        logic separate. Listing <a  href="#lst:Snippet-mixin-attributes"  class="Reference">5.4.2↓</a> shows how you can utilize the “-%>”<a
 href="#index-Attributes--%%3E-operator"  name="entry-Attributes--%>-operator-1"
 class="IndexReference">↓</a>
        binding operator instead of “->” to preserve attributes. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Snippet mixin attributes <a  name="lst:Snippet-mixin-attributes"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_875417">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// the markup</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">Ledger.balance></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><ledger<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">time id</code><code  class="scala keyword">=</code><code  class="scala string">"myId"</code><code
 class="scala plain">/></code></ledger<></code></div><code  class="scala plain">
                        <div  class="line number4 index3 alt1"><code  class="scala plain"><code
 class="scala keyword">:</code><code  class="scala plain">Ledger.balance></code></code></div><code
 class="scala plain">
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala comments">// The snippet class</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">Ledger {</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">balance (content </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq ) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">bind (</code><code  class="scala string">"ledger"</code><code
 class="scala plain">, content,</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">          </code><code
 class="scala string">"time"</code> <code  class="scala plain">-</code><code  class="scala keyword">%</code><code
 class="scala plain">> <span>{(</span></code><code  class="scala keyword">new</code> <code
 class="scala plain">java.util.Date).toString})</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">}</code></div>
                      </code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The resulting node will be something like </div>
      <pre  class="LyX-Code"><tt><span  id="”myId”">Sat Mar 28 16:43:48 EET 2009</span></tt>
</pre>
      <div  class="Unindented"> In addition to the “-%>” binding operator,
        there is also the “_id_>” <a  href="#index-_id_%3E-operator"  name="entry-_id_>-operator-0"
 class="IndexReference">↓</a>operator,
        which uses the element’s name as its “id” attribute. Listing shows a
        snippet method using the “_id_>” attribute and Listing shows the
        resulting markup. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Binding-with-the_id_"  class="Label">
            </a>Binding with the _id_> operator </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_878660">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">idByName (xhtml </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"example"</code><code
 class="scala plain">, xhtml, </code><code  class="scala string">"name"</code> <code
 class="scala keyword">_</code><code  class="scala plain">id</code><code  class="scala keyword">_</code><code
 class="scala plain">> <span>Fred</span>)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Markup-bound-using_id_"  class="Label">
            </a>Markup bound using _id_> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_243561">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml comments"><!-- Input: --></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">lift:HelloWorld.idByName</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain">Hi, <</code><code  class="xml keyword">example:name</code> <code
 class="xml plain">/> </code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:HelloWorld.idByName</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number5 index4 alt2"><code  class="xml plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml comments"><!-- Output: --></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml plain">Hi, <</code><code
 class="xml keyword">span</code> <code  class="xml color1">id</code><code  class="xml plain">=</code><code
 class="xml string">"name"</code><code  class="xml plain">>Fred<!--</code--><code
 class="xml keyword">span</code><code  class="xml plain">> </code></code></div><code
 class="xml plain">
                      </code></code></div><code  class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-6"  class="toc">6</a> Forms
        in Lift<a  name="cha:Forms-in-Lift"  class="Label"> </a> </h1>
      <div  class="Unindented"> In this chapter we’re going to discuss the
        specifics of how you generate and process forms with Lift. Besides
        standard GET/POST form processing, Lift provides AJAX forms (Глава <a  href="#cha:AJAX-and-COMET"
 class="Reference">11↓</a>) as well as JSON form processing (Розділ <a  href="#sub:JSON-forms"
 class="Reference">10.4.1↓</a>), but we’re going to focus on the
        standard stuff here. We’re going to assume that you have a general
        knowledge of basic HTML form tags as well as how CGI<a  href="#index-CGI"
 name="entry-CGI-0"  class="IndexReference">↓</a> form processing
        works. </div>
      <h2  class="Section"> <a  name="toc-Section-6.1"  class="toc">6.1</a> 
        Form Fundamentals<a  name="sec:Form-Fundamentals"  class="Label"> </a>
      </h2>
      <div  class="Unindented"> Let’s start with the basics of Lift form
        processing. A form in Lift is usually produced via a snippet that
        contains the additional <tt>form</tt> attribute. As we
        mentioned in Розділ <a  href="#sub:snippet-tag"  class="Reference">5.1↑</a>, this attribute takes the value GET or
        POST, and when present makes the snippet code embed the proper form tags
        around the snippet HTML. Listing <a  href="#lst:An-example-form-template"
 class="Reference">6.1↓</a> shows an example of a form that we will be
        discussing throughout this section. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> An Example Form Template<a  name="lst:An-example-form-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_367677">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">Ledger.add form</code><code
 class="scala keyword">=</code><code  class="scala string">"POST"</code><code  class="scala plain">></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><entry<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">description /> <entry<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">amount /><br /></code></entry<></code></entry<></code></div><code
 class="scala plain"><code  class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><entry<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">submit /></code></entry<></code></div><code  class="scala plain">
                        <div  class="line number4 index3 alt1"><code  class="scala plain"><code
 class="scala keyword">:</code><code  class="scala plain">Ledger.add></code></code></div><code
 class="scala plain">
                      </code></code></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The first thing to understand about Lift’s form
        support is that you generally don’t use the HTML tags for form elements
        directly, but rather you use generator functions on<br />
        <tt>net.liftweb.http.SHtml</tt>. The main reason for this is
        that it allows Lift to set up all of the internal plumbing so that you
        keep your code simple. Additionally, we use Lift’s binding mechanism
        (Розділ <a  href="#sub:Binding-Values-in-snippets"  class="Reference">5.3.1↑</a>) to “attach” the form elements in the
        proper location. In our example in Listing <a  href="#lst:An-example-form-template"
 class="Reference">6.1↑</a>, we have bindings for a description field,
        an amount, and a submit button. </div>
      <div  class="Indented"> Our next step is to define the form snippet
        itself. Corresponding to our example template is Listing <a  href="#lst:An-example-form-snippet"
 class="Reference">6.1↓</a>. This shows our add method with a few vars
        to hold the form data and a binding to the proper form elements. We’ll
        cover the <tt>processEntryAdd</tt> method in a moment; for
        now let’s look at what we have inside the add method. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> An Example Form Snippet<a  name="lst:An-example-form-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_261349">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">add (xhtml </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">desc </code><code  class="scala keyword">=</code> <code
 class="scala string">""</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">amount </code><code
 class="scala keyword">=</code> <code  class="scala string">"0"</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">processEntryAdd () { ... }</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"entry"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">       </code><code
 class="scala string">"description"</code> <code  class="scala plain">-> SHtml.text(desc, desc </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">),</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">       </code><code
 class="scala string">"amount"</code> <code  class="scala plain">-> SHtml.text(amount, amount </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">),</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">       </code><code
 class="scala string">"submit"</code> <code  class="scala plain">-> SHtml.submit(</code><code
 class="scala string">"Add"</code><code  class="scala plain">, processEntryAdd))</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> First, you may be wondering why we use vars
        defined inside the method. Normally, these vars would be locally scoped
        (stack-based) and would be discarded as soon as the method returns. The
        beauty of Scala and Lift is that the right hand argument of each of the
        SHtml functions is actually a function itself. Because these functions,
        also known as anonymous closures<a  href="#index-closure"  name="entry-closure-0"
 class="IndexReference">↓</a>, reference
        variables in local scope, Scala magically transforms them to heap
        variables behind the scenes. Lift, in turn, adds the function callbacks
        for each form element into its session state so that when the form is
        submitted, the appropriate closure is called and the state is updated.
        This is also why we define the <tt>processEntryAdd</tt>
        function inside of the <tt>add</tt> method: by doing so, the
        <tt>processEntryAdd</tt> function <i>also</i> has access to
        the closure variables. In our example, we’re using Scala’s placeholder
        “_” shorthand<span  class="FootOuter"><span  class="SupFootMarker"> [X] </span><span
 class="HoverFoot"><span  class="SupFootMarker">  [X] </span>For
            more details on placeholders, see the <i>Scala Language
              Specification</i>, section 6.23</span></span> to define our
        functions. Your description processing function could also be defined
        as: </div>
      <pre  class="LyX-Code">newDesc => description = newDesc
</pre>
      <div  class="Unindented"> One important thing to remember, however, is
        that each new invocation of the add method (for each page view) will get
        its own unique instance of the variables that we’ve defined. That means
        that if you want to retain values between submission and re-rendering of
        the form, you’ll want to use <tt>RequestVar</tt>s (Розділ <a  href="#sec:Session-and-Request"
 class="Reference">3.11↑</a>) or a
        <tt>StatefulSnippet</tt> (Розділ <a  href="#sub:Stateless-versus-Stateful"
 class="Reference">5.3.3↑</a>) instead . Generally you will only use
        vars defined within the snippet method when your form doesn’t require
        validation and you don’t need any of the submitted data between snippet
        executions. An example of using <tt>RequestVar</tt>s for
        your form data would be if you want to do form validation and retain
        submitted values if validation fails, as shown in Listing <a  href="#lst:Using-RequestVars-with-forms"
 class="Reference">6.1↓</a>. In this instance, we set an error message
        (more in Глава <a  href="#cha:Message-Handling"  class="Reference">B↓</a>). Since we don’t explicitly redirect, the
        same page is loaded (the default “action” for a page in Lift is the page
        itself) and the current RequestVar value of description is used as the
        default value of the text box. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using RequestVars with Forms<a  name="lst:Using-RequestVars-with-forms"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_12319">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">description </code><code  class="scala keyword">extends</code> <code
 class="scala plain">RequestVar(</code><code  class="scala string">""</code><code
 class="scala plain">)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">amount </code><code  class="scala keyword">extends</code> <code
 class="scala plain">RequestVar(</code><code  class="scala string">"0"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">add (xhtml </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">processEntryAdd () </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">(amount.toDouble <</code><code
 class="scala keyword">=</code> <code  class="scala value">0</code><code  class="scala plain">) {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">S.error(</code><code  class="scala string">"Invalid amount"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala comments">// ... process Add ...</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">redirectTo(...)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"entry"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">       </code><code
 class="scala string">"description"</code> <code  class="scala plain">-> SHtml.text(description.is, description(</code><code
 class="scala keyword">_</code><code  class="scala plain">)),</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The next thing to look at is how the form elements
        are generated. We use the SHtml helper object to generate a form element
        of the appropriate type for each variable. In our case, we just want
        text fields for the description and amount, but SHtml provides a number
        of other form element types that we’ll be covering later in this
        section. Generally, an element generator takes an argument for the
        initial value as well as a function to process the submitted value.
        Usually both of these arguments will use a variable, but there’s nothing
        stopping you from doing something such as </div>
      <pre  class="LyX-Code">“description” -> SHtml.text(“”, println(“Description = “ + _))
</pre>
      <div  class="Unindented"> Finally, our submit function executes the
        partially applied <tt>processEntryAdd</tt> function, which,
        having access to the variables we’ve defined, can do whatever it needs
        to do when the submit button is pressed. </div>
      <h2  class="Section"> <a  name="toc-Section-6.2"  class="toc">6.2</a> <a  name="sec:Attributes-for-Form-Elems"
 class="Label"> </a>Attributes
        for Form Elements<a  href="#index-Attributes-in-form-elements"  name="entry-Attributes-in-form-elements-0"
 class="IndexReference">↓</a>
      </h2>
      <div  class="Unindented"> In addition to the approaches shown in Розділ <a
 href="#sec:Handling-XHTML-Attributes"  class="Reference">5.4↑</a>, the SHtml generator functions allow you
        to apply attributes by passing the attribute name/value pairs as final
        arguments. This is usually simpler, and in some cases is much simpler
        than using the “%” operator directly. For example, checkbox and radio
        form elements are acutally returned as ChoiceHolder instances, which do
        not directly support the “%” operator. Listing <a  href="#lst:Applying-Attributes-vararg"
 class="Reference">6.2↓</a> shows how to apply the same attributes as
        Listing <a  href="#lst:Applying-Attributes-percent"  class="Reference">5.4.1↑</a> using the varargs approach. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Applying-Attributes-vararg"  class="Label">
            </a>Applying Attributes as Varargs </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_90494">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">myInput </code><code  class="scala keyword">=</code> <code
 class="scala plain">SHtml.text(</code><code  class="scala string">""</code><code
 class="scala plain">, processText(</code><code  class="scala keyword">_</code><code
 class="scala plain">), </code><code  class="scala string">"id"</code> <code  class="scala plain">-> </code><code
 class="scala string">"inputField"</code><code  class="scala plain">,</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala string">"class"</code> <code  class="scala plain">-> </code><code
 class="scala string">"highlighted"</code><code  class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-6.3"  class="toc">6.3</a> An
        Overview of Form Elements </h2>
      <div  class="Unindented"> Now that we’ve covered the basics of forms,
        we’re going to go into a little more detail for each form element
        generator method on SHtml. The <tt>a</tt> method (all 3
        variants) as well as the <tt>ajax</tt>* methods are specific
        to AJAX forms, which are covered in detail in Глава <a  href="#cha:AJAX-and-COMET"
 class="Reference">11↓</a>. The <tt>json*</tt> methods are
        covered in Розділ <a  href="#sub:JSON-forms"  class="Reference">10.4.1↓</a>. We’ll be covering the fileUpload
        method in detail in Розділ <a  href="#sec:File-Uploads"  class="Reference">6.4↓</a>. One final note before we dive in is that
        most generator methods have an overload with a trailing asterisk (i.e.
        <tt>hidden_*</tt>); these are generally equivalent to the
        overloads without an asterisk but are intended for Lift’s internal use.
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.1"  class="toc">6.3.1</a> 
        checkbox </h3>
      <div  class="Unindented"> The <tt>checkbox</tt> method
        generates a checkbox form element, taking an initial Boolean value as
        well as a function <span  class="formula">(<i>Boolean</i>)  ⇒ <i>Any</i></span>
        that is called when the checkbox is submitted. If you’ve done a lot of
        HTML form processing you might wonder how this actually occurs, since <i>an
          unchecked checkbox is not actually submitted as part of a form</i>.
        Lift works around this by adding a hidden form element for each checkbox
        with the same element name, but with a false value, to ensure that the
        callback function is always called. Because more than one XML node is
        returned by the generator, you can’t use the % metadata mechanism to set
        attributes on the check box element. Instead, use attribute pairs as
        arguments to the generator function as outlined in Розділ <a  href="#sub:Direct-attr-manip"
 class="Reference">5.4.1↑</a>. </div>
      <div  class="Indented"> For example, Listing <a  href="#lst:A-checkbox-example"
 class="Reference">6.3.1↓</a> shows a checkbox with an id of “snazzy”
        and a class attribute set to “woohoo.” </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Checkbox Example<a  name="lst:A-checkbox-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_441080">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">SHtml.checkbox</code><code
 class="scala keyword">_</code><code  class="scala plain">id(</code><code  class="scala keyword">false</code><code
 class="scala plain">, </code><code  class="scala keyword">if</code> <code  class="scala plain">(</code><code
 class="scala keyword">_</code><code  class="scala plain">) frobnicate(), </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">                  </code><code
 class="scala plain">Full(</code><code  class="scala string">"snazzy"</code><code
 class="scala plain">), </code><code  class="scala string">"class"</code> <code
 class="scala plain">-> </code><code  class="scala string">"woohoo"</code><code
 class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.2"  class="toc">6.3.2</a> 
        hidden </h3>
      <div  class="Unindented"> The <tt>hidden</tt> method generates
        a hidden form field. Unlike the HTML hidden field, the hidden tag is not
        intended to hold a plain value; rather, in Lift it takes a function <span
 class="formula">() ⇒ <i>Any</i></span> argument that is called when
        the form is submitted. As with most of the other generators, it also
        takes a final varargs sequence of
        <tt>Pair[String,String]</tt> attributes to be added to the
        XML node. Listing <a  href="#lst:A-hidden-example"  class="Reference">6.3.2↓</a> shows an example of using a hidden field
        to “log” information. (When the form is submitted, “Form was submitted”
        will be printed to stdout. This can be a useful trick for debugging if
        you’re not using a full-blown IDE.) </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Hidden Example<a  name="lst:A-hidden-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_527031">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">SHtml.hidden(() </code><code
 class="scala keyword">=</code><code  class="scala plain">> println(</code><code
 class="scala string">"Form was submitted"</code><code  class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.3"  class="toc">6.3.3</a> 
        link </h3>
      <div  class="Unindented"> The link method generates a standard HTML link
        to a page (an <tt><a></a></tt><a> tag, or anchor</a><a  href="#index-anchor"
 name="entry-anchor-0"  class="IndexReference">↓</a>), but also
        ensures that a given function is executed when the link is clicked. The
        first argument is the web context relative link path, the second
        argument is the <span  class="formula">() ⇒ <i>Any</i></span> function
        that will be executed when the link is clicked, and the third argument
        is a NodeSeq that will make up the body of the link. You may optionally
        pass one or more <tt>Pair[String,String]</tt> attributes to
        be added to the link element. Listing <a  href="#lst:A-link-example"  class="Reference">6.3.3↓</a> shows using a link to load an
        <tt>Expense</tt> entry for editing from within a table. In
        this case we’re using a <tt>RequestVar</tt> to hold the
        entry to edit, so the link function is a closure that loads the current
        <tt>Expense</tt> entry. This combination of link and
        <tt>RequestVar</tt>s is a common pattern for passing objects
        between different pages. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Link Example<a  name="lst:A-link-example"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_351718">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">currentExpense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">RequestVar[Box[Expense]](Empty)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">list (xhtml </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">entriesXml </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">entries.map(entry </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">bind(</code><code  class="scala string">"entry"</code><code
 class="scala plain">, chooseTemplate(</code><code  class="scala string">"expense"</code><code
 class="scala plain">, </code><code  class="scala string">"entries"</code><code
 class="scala plain">, xhtml),</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">...</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala string">"edit"</code> <code  class="scala plain">-> SHtml.link(</code><code
 class="scala string">"/editExpense"</code><code  class="scala plain">, </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> currentExpense(Full(entry)),</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">Text(</code><code  class="scala string">"Edit"</code><code
 class="scala plain">)))</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.4"  class="toc">6.3.4</a> 
        text and password </h3>
      <div  class="Unindented"> The text and password methods generate standard
        <tt>text</tt> and <tt>password</tt>
        <tt>input</tt> fields, respectively. While both take string
        default values and <span  class="formula">(<i>String</i>) ⇒ <i>Any</i></span>
        functions to process the return, the password text field masks typed
        characters and doesn’t allow copying the value from the box on the
        client side. Listing <a  href="#lst:A-text-field"  class="Reference">6.3.4↓</a> shows an example of using both text and
        password for a login page. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Text Field Example<a  name="lst:A-text-field"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_568025">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">login(xhtml </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">user </code><code  class="scala keyword">=</code> <code
 class="scala string">""</code><code  class="scala plain">; </code><code  class="scala keyword">var</code> <code
 class="scala plain">pass </code><code  class="scala keyword">=</code> <code  class="scala string">""</code><code
 class="scala plain">;</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">auth () </code><code
 class="scala keyword">=</code> <code  class="scala plain">{ ... }</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"login"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">       </code><code
 class="scala string">"user"</code> <code  class="scala plain">-> SHtml.text(user, user </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">, </code><code
 class="scala string">"maxlength"</code> <code  class="scala plain">-> </code><code
 class="scala string">"40"</code><code  class="scala plain">)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">       </code><code
 class="scala string">"pass"</code> <code  class="scala plain">-> SHtml.password(pass, pass </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">       </code><code
 class="scala string">"submit"</code> <code  class="scala plain">-> SHtml.submit(</code><code
 class="scala string">"Login"</code><code  class="scala plain">, auth))</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Alternatively, you might want the user (but not
        the password) to be stored in a <tt>RequestVar</tt> so that
        if the authentication fails the user doesn’t have to retype it. Listing
        <a  href="#lst:A-RV-text-field"  class="Reference">6.3.4↓</a> shows how the snippet would look in this
        case. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A RequestVar Text Field Example<a  name="lst:A-RV-text-field"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_563751">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">user </code><code  class="scala keyword">extends</code> <code
 class="scala plain">RequestVar[String](</code><code  class="scala string">""</code><code
 class="scala plain">)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">login(xhtml </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">pass </code><code  class="scala keyword">=</code> <code
 class="scala string">""</code><code  class="scala plain">;</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">auth () </code><code
 class="scala keyword">=</code> <code  class="scala plain">{ ... }</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"login"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">       </code><code
 class="scala string">"user"</code> <code  class="scala plain">-> SHtml.text(user.is, user(</code><code
 class="scala keyword">_</code><code  class="scala plain">), </code><code  class="scala string">"maxlength"</code> <code
 class="scala plain">-> </code><code  class="scala string">"40"</code><code  class="scala plain">),</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">       </code><code
 class="scala string">"pass"</code> <code  class="scala plain">-> SHtml.password(pass, pass </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">),</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">       </code><code
 class="scala string">"submit"</code> <code  class="scala plain">-> SHtml.submit(</code><code
 class="scala string">"Login"</code><code  class="scala plain">, auth))</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.5"  class="toc">6.3.5</a> 
        textarea </h3>
      <div  class="Unindented"> The textarea method generates a
        <tt>textarea</tt> HTML form element. Generally the
        functionality mirrors that of <tt>text</tt>, although
        because it’s a <tt>textarea</tt>, you can control width and
        height by adding <tt>cols</tt> and <tt>rows</tt>
        attributes as shown in Listing <a  href="#lst:A-textarea-example"  class="Reference">6.3.5↓</a>. (You can, of course, add any other HTML
        attributes in the same manner.) </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Textarea Example<a  name="lst:A-textarea-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_315671">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">noteText </code><code  class="scala keyword">=</code> <code
 class="scala string">""</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">notes </code><code  class="scala keyword">=</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">SHtml.textarea(noteText, noteText </code><code  class="scala keyword">=</code> <code
 class="scala keyword">_</code><code  class="scala plain">, </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                 </code><code
 class="scala string">"cols"</code> <code  class="scala plain">-> </code><code  class="scala string">"80"</code><code
 class="scala plain">, </code><code  class="scala string">"rows"</code> <code  class="scala plain">-> </code><code
 class="scala string">"8"</code><code  class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.6"  class="toc">6.3.6</a> 
        submit </h3>
      <div  class="Unindented"> Submit generates the submit form element
        (typically a button). It requires two parameters: a String value to use
        as the button label, and a function <span  class="formula">() ⇒ <i>Any</i></span>
        that can be used to process your form results. One important thing to
        note about submit is that form elements are processed in the order that
        they appear in the HTML document. This means that you should put your
        submit element last in your forms: any items after the submit element
        won’t have been “set” by the time the submit function is called.
        Listings <a  href="#lst:A-text-field"  class="Reference">6.3.4↑</a> and <a
 href="#lst:A-RV-text-field"  class="Reference">6.3.4↑</a> use the
        <tt>SHtml.submit</tt> method for the authentication handler
        invocation. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.7"  class="toc">6.3.7</a> 
        multiselect </h3>
      <div  class="Unindented"> Up to this point we’ve covered some fairly
        simple form elements. Multiselect is a bit more complex in that it
        doesn’t just process single values. Instead, it allows you to select
        multiple elements out of an initial Seq and then process each selected
        element individually. Listing <a  href="#lst:Using-multiselect"  class="Reference">6.3.7↓</a> shows using a multiselect to allow the
        user to select multiple categories for a ledger entry. We assume that a
        Category entity has an id synthetic key as well as a String name value.
        The first thing we do is map the collection of all categories into pairs
        of (<tt>value</tt>, <tt>display</tt>) strings.
        The value is what will be returned to our processing function, while the
        display string is what will be shown in the select box for the user.
        Next, we turn the current entry’s categories into a Seq of just value
        strings, and we create a Set variable to hold the returned values.
        Finally, we do our form binding. In this example we use a helper
        function, <tt>loadCategory</tt> (not defined here), that
        takes a String representing a Category’s primary key and returns the
        category. We then use this helper method to update the Set that we
        created earlier. Note that the callback function will be executed <i>for
          each selected item</i> in the multiselect, which is why the callback
        takes a String argument instead of a <tt>Set[String]</tt>.
        This is also why we have to use our own set to manage the values.
        Depending on your use case, you may or may not need to store the
        returned values in a collection. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using multiselect<a  name="lst:Using-multiselect"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_479110">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">mySnippet ... {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">possible </code><code
 class="scala keyword">=</code> <code  class="scala plain">allCategories.map(c </code><code
 class="scala keyword">=</code><code  class="scala plain">> (c.id.toString, c.name))</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">current </code><code
 class="scala keyword">=</code> <code  class="scala plain">currentEntry.categories.map(c </code><code
 class="scala keyword">=</code><code  class="scala plain">> c.id.toString)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">updated </code><code
 class="scala keyword">=</code> <code  class="scala plain">Set.empty[Category]</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">bind (..., </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala string">"categories"</code> <code  class="scala plain">-> </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">SHtml.multiselect(possible, current, updated +</code><code
 class="scala keyword">=</code> <code  class="scala plain">loadCategory(</code><code
 class="scala keyword">_</code><code  class="scala plain">)))</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.8"  class="toc">6.3.8</a> 
        radio </h3>
      <div  class="Unindented"> The radio method generates a set of radio
        buttons that take String values and return a single String (the selected
        button) on form submission. The values are used as labels for the Radio
        buttons, so you may need to set up a <tt>Map</tt> to
        translate back into useful values. The radio method also takes a
        Box[String] that can be used to pre-select one of the buttons. The value
        of the Box must match one of the option values, or if you pass Empty no
        buttons will be selected. Listing <a  href="#lst:Using-radio-for"  class="Reference">6.3.8↓</a> shows an example of using radio to
        select a color. In this example, we use a <tt>Map</tt> from
        color names to the actual color values for the translation. To minimize
        errors, we use the <tt>keys</tt> property of the Map to
        generate the list of options. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using radio for Colors<a  name="lst:Using-radio-for"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_177977">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">java.awt.Color</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">myColor </code><code  class="scala keyword">:</code> <code
 class="scala plain">Color </code><code  class="scala keyword">=</code> <code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">colorMap </code><code  class="scala keyword">=</code> <code
 class="scala plain">Map(</code><code  class="scala string">"Red"</code> <code  class="scala plain">-> Color.red,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                   </code><code
 class="scala string">"White"</code> <code  class="scala plain">-> Color.white,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">                   </code><code
 class="scala string">"Blue"</code> <code  class="scala plain">-> Color.blue)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">colors </code><code  class="scala keyword">=</code> <code  class="scala plain">SHtml.radio(colorMap.keys.toList, Empty, myColor </code><code
 class="scala keyword">=</code> <code  class="scala plain">colorMap(</code><code
 class="scala keyword">_</code><code  class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.9"  class="toc">6.3.9</a> 
        select </h3>
      <div  class="Unindented"> The select method is very similar to the
        multiselect method except that only one item may be selected from the
        list of options. That also means that the default option is a
        <tt>Box[String]</tt> instead of a
        <tt>Seq[String]</tt>. As with
        <tt>multiselect</tt>, you pass a sequence of (value,
        display) pairs as the options for the select, and process the return
        with a <span  class="formula">(<i>String</i>) ⇒ <i>Any</i></span>
        function. Listing <a  href="#lst:A-select-example"  class="Reference">6.3.9↓</a> shows an example of using a select to
        choose an account to view. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A select Example<a  name="lst:A-select-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_809329">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">selectedAccount </code><code  class="scala keyword">:</code> <code
 class="scala plain">Account </code><code  class="scala keyword">=</code> <code
 class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">accounts </code><code  class="scala keyword">=</code> <code
 class="scala plain">User.accounts.map(acc </code><code  class="scala keyword">=</code><code
 class="scala plain">> (acc.id.toString, acc.name))</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">chooseAccount </code><code  class="scala keyword">=</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">SHtml.select(accounts, Empty, </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">               </code><code
 class="scala plain">selectedAccount </code><code  class="scala keyword">=</code> <code
 class="scala plain">loadAccount(</code><code  class="scala keyword">_</code><code
 class="scala plain">), </code><code  class="scala string">"class"</code> <code
 class="scala plain">-> </code><code  class="scala string">"myselect"</code><code
 class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> An important thing to note is that Lift will
        verify that the value submitted in the form matches one of the options
        that was passed in. If you need to do dynamic updating of the list, then
        you’ll need to use <tt>untrustedSelect</tt> (Розділ <a  href="#sub:untrustedSelect"
 class="Reference">6.3.11↓</a>). </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.10"  class="toc">6.3.10</a> 
        selectObj </h3>
      <div  class="Unindented"> One of the drawbacks with the select and
        multiselect generators is that they deal only in Strings; if you want to
        select objects you need to provide your own code for mapping from the
        strings. The <tt>selectObj</tt> generator method handles all
        of this for you. Instead of passing a sequence of (value string, display
        string) pairs, you pass in a sequence of (object, display string) pairs.
        Similarly, the default value is a <tt>Box[T]</tt> and the
        callback function is <span  class="formula">(<i>T</i>) ⇒ <i>Any</i></span>
        , where T is the type of the object (<tt>selectObj</tt> is a
        generic function). Listing <a  href="#lst:Using-selectObj-for"  class="Reference">6.3.10↓</a> shows a reworking of our radio example
        (Listing <a  href="#lst:Using-radio-for"  class="Reference">6.3.8↑</a>) to select Colors directly. Note that we
        set the select to default to <tt>Color.red</tt> by passing
        in a <tt>Full</tt> Box. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using selectObj for Colors<a  name="lst:Using-selectObj-for"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_199829">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">... standard Lift imports ...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.awt.Color</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">SelectSnippet {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">chooseColor (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">var</code> <code  class="scala plain">myColor </code><code
 class="scala keyword">=</code> <code  class="scala plain">Color.red</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">options </code><code
 class="scala keyword">=</code> <code  class="scala plain">List(Color.red, Color.white, Color.blue)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">colors </code><code
 class="scala keyword">=</code> <code  class="scala plain">SHtml.selectObj(options, Full(myColor), myColor </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">bind(...)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-6.3.11"  class="toc">6.3.11</a> 
        untrustedSelect<a  name="sub:untrustedSelect"  class="Label"> </a> </h3>
      <div  class="Unindented"> The <tt>untrustedSelect</tt>
        generator is essentially the same as the select generator, except that
        the value returned in the form isn’t validated against the original
        option sequence. This can be useful if you want to update the selection
        on the client side using JavaScript. </div>
      <h2  class="Section"> <a  name="toc-Section-6.4"  class="toc">6.4</a> 
        File Uploads<a  name="sec:File-Uploads"  class="Label"> </a><a  href="#index-File-uploads"
 name="entry-File-uploads-0"  class="IndexReference">↓</a><a  href="#index-Forms-File-uploads"
 name="entry-Forms-File-uploads-0"  class="IndexReference">↓</a> </h2>
      <div  class="Unindented"> File uploads are a special case of form
        submission that allow the client to send a local file to the server.
        This is accomplished by using multipart forms. You can enable this by
        setting the <tt>multipart</tt> attribute on your snippet tag
        to <tt>true</tt>. Listing <a  href="#lst:File-upload-template"  class="Reference">6.4↓</a> shows how we can add a file upload to our
        existing expense entry form so that users can attach scanned receipts to
        their expenses. We modify our template to add a new form, shown below.
        Note the <tt>multipart=”true” </tt>attribute. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> File Upload Template<a  name="lst:File-upload-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_141362">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">... existing form fields ...</code></div><div  class="line number5 index4 alt2"><code
 class="scala spaces">  </code><code  class="scala plain"></code></div><div  class="line number6 index5 alt1"><code
 class="scala spaces">  </code><code  class="scala plain">...</code></div><div  class="line number7 index6 alt2"><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">AddEntry.addEntry></code></code></div><table
 cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">AddEntry.addEntry form</code><code
 class="scala keyword">=</code><code  class="scala string">"POST"</code> <code  class="scala plain">multipart</code><code
 class="scala keyword">=</code><code  class="scala string">"true"</code><code  class="scala plain">></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">... existing headers ...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"></code></div></code></div></td><td>Receipt (JPEG or PNG)</td>
                        
                        <td><e<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">receipt /></code></e<></td>
                        
                        
                      
                    
                  </tr>
                </tbody>
              </table><code  class="scala plain">
            </code></div><code  class="scala plain">
          </code></div><code  class="scala plain">
        </code></div><code  class="scala plain">
      </code></div><code  class="scala plain">
      <div  class="Indented"> On the server side, Listing <a  href="#lst:File-upload-snippet"
 class="Reference">6.4↓</a> shows how we modify the existing
        <tt>addEntry</tt> snippet to handle the (optional) file
        attachment. We’ve added some logic to the existing form submission
        callback to check to make sure that the image is of the proper type,
        then we use the <tt>SHtml</tt> file upload generator with a
        callback that sets our <tt>fileHolder</tt> variable. The
        callback for the <tt>fileUpload</tt> generator takes a
        <tt>FileParamHolder</tt>, a special case class that contains
        information about the uploaded file. The FileParamHolder case class has
        four parameters: </div>
      <div  class="List"> <span  class="List-entry"><tt>name</tt></span><span  class="List-contents">The name of the form field that this file is
          associated with, as sent by the client</span> </div>
      <div  class="List"> <span  class="List-entry"><tt>mimeType</tt></span><span
 class="List-contents">The mime type as sent by the client</span> </div>
      <div  class="List"> <span  class="List-entry"><tt>filename</tt></span><span
 class="List-contents">The filename as sent by the client</span> </div>
      <div  class="List"> <span  class="List-entry"><tt>file</tt></span><span  class="List-contents">An <tt>Array[Byte]</tt> containing
          the uploaded file contents</span> </div>
      <div  class="Unindented"> In our example, we want to save the file data
        into a <tt>MappedBinary</tt> field on our expense entry. You
        could just as easily process the data in place using a
        <tt>scala.io.Source</tt> or<br />
        <tt>java.io.ByteArrayInputStream</tt>, or output it using a
        <tt>java.io.FileOutputStream</tt>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> File Upload Snippet<a  name="lst:File-upload-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_729298">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">AddEntry {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Add a variable to hold the FileParamHolder on submission</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">fileHolder </code><code
 class="scala keyword">:</code> <code  class="scala plain">Box[FileParamHolder] </code><code
 class="scala keyword">=</code> <code  class="scala plain">Empty</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">doTagsAndSubmit (t </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">e </code><code  class="scala keyword">:</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">=</code> <code
 class="scala plain">...</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// Add the optional receipt if it’s the correct type</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">receiptOk </code><code
 class="scala keyword">=</code> <code  class="scala plain">fileHolder </code><code
 class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala comments">// An empty upload gets reported with a null mime type,</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">      </code><code
 class="scala comments">// so we need to handle this special case</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(FileParamHolder(</code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">null</code><code
 class="scala plain">, </code><code  class="scala keyword">_</code><code  class="scala plain">, </code><code
 class="scala keyword">_</code><code  class="scala plain">)) </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala keyword">true</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(FileParamHolder(</code><code
 class="scala keyword">_</code><code  class="scala plain">, mime, </code><code  class="scala keyword">_</code><code
 class="scala plain">, data))</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">if</code> <code  class="scala plain">mime.startsWith(</code><code
 class="scala string">"image/"</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">> {</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">e.receipt(data).receiptMime(mime)</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">          </code><code
 class="scala keyword">true</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">}</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(</code><code
 class="scala keyword">_</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">> {</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">S.error(</code><code  class="scala string">"Invalid receipt attachment"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">false</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala keyword">true</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">(e.validate, receiptOk) </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"e"</code><code  class="scala plain">, in,</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">       </code><code
 class="scala plain">...</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala spaces">       </code><code
 class="scala string">"receipt"</code> <code  class="scala plain">-> SHtml.fileUpload(fileHolder </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">),</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">       </code><code
 class="scala string">"tags"</code> <code  class="scala plain">-> SHtml.text(tags, doTagsAndSubmit))</code></div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> By default<a  href="#index-Forms-saving-file-uploads-to-disk"
 name="entry-Forms-saving-file-uploads-to-disk-0"  class="IndexReference">↓</a>,
        Lift will utilize the <tt>InMemoryFileParamHolder</tt> <a  href="#index-InMemoryFileParamHolder"
 name="entry-InMemoryFileParamHolder-0"  class="IndexReference">↓</a>to
        represent uploaded file data. This implementation reads the uploaded
        data directly into memory (you retrieve the byte array with the
        <tt>file</tt> val). If you would prefer to have Lift write
        uploaded data to disk and then give you a server-local filename to work
        with, you can use the <tt>LiftRules.handleMimeFile</tt>
        configuration hook to instead use the
        <tt>OnDiskFileParamHolder</tt><a  href="#index-OnDiskFileParamHolder"  name="entry-OnDiskFileParamHolder-0"
 class="IndexReference">↓</a>,
        as shown in Listing <a  href="#lst:Using-OnDiskFileParamHolder"  class="Reference">6.4↓</a>. The OnDiskFileParamHolder class has an
        additional property, <tt>localFile</tt>, that is a
        <tt>java.io.File</tt> object for the temporary upload file.
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Using-OnDiskFileParamHolder"  class="Label">
            </a>Using OnDiskFileParamHolder </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_206526">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// in Boot.boot:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">LiftRules.handleMimeFile </code><code
 class="scala keyword">=</code> <code  class="scala plain">OnDiskFileParamHolder.apply</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-7"  class="toc">7</a> SiteMap<a
 name="cha:SiteMap"  class="Label"> </a> </h1>
      <div  class="Unindented"> SiteMap is a very powerful part of Lift that
        does essentially what it says: provides a map (menu) for your site. Of
        course, if all it did was generate a set of links on your page, we
        wouldn’t have a whole chapter dedicated to it. SiteMap not only handles
        the basic menu generation functionality, but also provides: </div>
      <ul>
        <li> Access control mechanisms that deal not only with whether a menu
          item is visible, but also whether the page it points to is accessible
        </li>
        <li> Grouping of menu items so that you can easily display portions of
          menus where you want them </li>
        <li> Nested menus so you can have hierarchies </li>
        <li> Request rewriting (similar to Розділ <a  href="#sec:URL-Rewriting"
 class="Reference">3.7↑</a>) </li>
        <li> State-dependent computations for such things as page titles,
          page-specific snippets, etc. </li>
      </ul>
      <div  class="Unindented"> The beauty of SiteMap is that it’s very easy to
        start out with the basic functionality and then expand on it as you
        grow. </div>
      <h2  class="Section"> <a  name="toc-Section-7.1"  class="toc">7.1</a> 
        Basic SiteMap Definition<a  name="sec:Basic-SiteMap-Definition"  class="Label">
        </a> </h2>
      <div  class="Unindented"> Let’s start with our basic menu for
        PocketChange. To keep things simple, we’ll just define four menu items
        to begin: </div>
      <ol>
        <li> A home page that displays the user’s entries when the user is
          logged in, or a welcome page when the user is not </li>
        <li> A logout link when the user is logged in, log in and registration
          links and pages when the user is not </li>
        <li> Pages to view or edit the user’s profile, available only when the
          user is logged in </li>
        <li> A help page, available whether the user is logged in or not </li>
      </ol>
      <div  class="Unindented"> We’ll assume that we have the corresponding
        pages, "<tt>homepage</tt>", "<tt>login</tt>",
        "<tt>logout</tt>", and "<tt>profile</tt>,"
        written and functional. We’ll also assume that the help page(s) reside
        under the "<tt>help</tt>" subdirectory to keep things neat,
        and that the entry to help is <tt>/help/index</tt>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.1.1"  class="toc">7.1.1</a> 
        The Link Class<a  name="sub:The-Link-Class"  class="Label"> </a> </h3>
      <div  class="Unindented"> The Link class<span  class="FootOuter"><span  class="SupFootMarker"> 
            [Y]  </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Y] </span><tt>net.liftweb.sitemap.Loc.Link</tt></span></span>
        is a fundamental part of Menu definitions. The <tt>Link
        </tt>class contains two parameters: a
        <tt>List[String]</tt> of path components, and a boolean
        value that controls whether prefix matching is enabled. The path
        components represent the portion of the URI following your web context,
        split on the "/" character. Listing <a  href="#lst:Link-Path-Components"
 class="Reference">7.1.1↓</a> shows how you would use Link to
        represent the "/utils/index" page. Of course, instead of
        <tt>“utils” :: “index” :: Nil</tt>, you could as easily use
        <tt>List(“utils”, “index”)</tt> if you prefer. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Link Path Components<a  name="lst:Link-Path-Components"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_620139">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">myUtilsIndex </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">Link(</code><code  class="scala string">"utils"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"index"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil, </code><code  class="scala keyword">false</code><code
 class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Prefix matching allows the path components you
        specify to match any longer paths as well. Following our first example,
        if you wanted to match anything under the utils directory (say, for
        access control), you would set the second parameter to
        <tt>true</tt>, as shown in Listing <a  href="#lst:Link-Prefix-Matching"
 class="Reference">7.1.1↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Link Prefix Matching<a  name="lst:Link-Prefix-Matching"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_44829">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">allUtilPages </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">Link(</code><code  class="scala string">"utils"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil, </code><code  class="scala keyword">true</code><code
 class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.1.2"  class="toc">7.1.2</a> 
        ExtLink </h3>
      <div  class="Unindented"> The ExtLink object can be used to create a Link
        instance using your own full link URL. As its name implies, it would
        usually be used for an external location. Listing <a  href="#lst:Using-ExtLink"
 class="Reference">7.1.2↓</a> shows a menu item that points to a
        popular website. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using ExtLink<a  name="lst:Using-ExtLink"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_186214">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">goodReference </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"reference"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">                             </code><code
 class="scala plain">ExtLink(</code><code  class="scala string">"<a  href="http://www.liftweb.net/">http://www.liftweb.net/</a>"</code><code
 class="scala plain">),</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">                             </code><code
 class="scala string">"LiftWeb"</code><code  class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.1.3"  class="toc">7.1.3</a> 
        Creating Menu Entries </h3>
      <div  class="Unindented"> Menu entries are created using the Menu<span  class="FootOuter"><span
 class="SupFootMarker">  [Z] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Z] </span><tt>net.liftweb.sitemap.Menu</tt></span></span>
        class, and its corresponding Menu object. A Menu, in turn, holds a Loc<span
 class="FootOuter"><span  class="SupFootMarker"> [A] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [A] </span><tt>net.liftweb.sitemap.Loc</tt></span></span>
        trait instance, which is where most of the interesting things happen. A
        menu can also hold one or more child menus, which we’ll cover in Розділ
        <a  href="#sub:Nested-Menus"  class="Reference">7.1.4↓</a>. Note that the Loc object has several
        implicit methods that make defining Locs easier, so you generally want
        to import them into scope . The simplest way is to import
        <tt>net.liftweb.sitemap.Loc._</tt>, but you can import
        specific methods by name if you prefer. A Loc can essentially be thought
        of as a link in the menu, and contains four basic items: </div>
      <ol>
        <li> The name of the Loc: this must be unique across your sitemap
          because it can be used to look up specific Menu items if you customize
          your menu display (Розділ <a  href="#sub:Using-lift-Menu"  class="Reference">7.2.3↓</a>) </li>
        <li> The link to which the Loc refers: usually this will referernce a
          specific page, but Lift allows a single Loc to match based on prefix
          as well (Розділ <a  href="#sub:The-Link-Class"  class="Reference">7.1.1↑</a>) </li>
        <li> The text of the menu item, which will be displayed to the user: you
          can use a static string or you can generate it with a function (Розділ
          <a  href="#sub:menu-LinkText"  class="Reference">7.2.2↓</a>) </li>
        <li> An optional set of LocParam parameters that control the behavior
          and appearance of the menu item (see Розділs <a  href="#sec:Customizing-Display"
 class="Reference">7.2↓</a>,<a  href="#sec:SiteMap-Access-Control"  class="Reference">7.3↓</a>, <a
 href="#sec:Misc-Menu"  class="Reference">7.5↓</a>, and <a  href="#sec:Page-Specific-Rendering"
 class="Reference">7.4↓</a>) </li>
      </ol>
      <div  class="Unindented"> For our example, we’ll tackle the help page link
        first, because it’s the simplest (essentially, it’s a static link). The
        definition is shown in Listing <a  href="#lst:Help-Menu-Definition"  class="Reference">7.1.3↓</a>. We’re assuming that you’ve imported the
        Loc implicit methods to keep things simple. We’ll cover instantiating
        the classes directly in later sections of this chapter. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Help Menu Definition<a  name="lst:Help-Menu-Definition"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_252477">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">helpMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"helpHome"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">                        </code><code
 class="scala plain">(</code><code  class="scala string">"help"</code> <code  class="scala keyword">::</code> <code
 class="scala string">""</code> <code  class="scala keyword">::</code> <code  class="scala plain">Nil) -> </code><code
 class="scala keyword">true</code><code  class="scala plain">,</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">                        </code><code
 class="scala string">"Help"</code><code  class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Here we’ve named the menu item "helpHome." We can
        use this name to refer back to this menu item elsewhere in our code. The
        second parameter is a <tt>Pair[List[String],Boolean]</tt>
        which converts directly to a Link class with the given parameters (see
        Розділ <a  href="#sub:The-Link-Class"  class="Reference">7.1.1↑</a> above). In this instance, by passing in
        true, we’re saying that anything under the help directory will also
        match. If you just use a List[String], the implicit conversion is to a
        Link with prefix matching disabled. Note that SiteMap won’t allow access
        to any pages that don’t match any Menu entries, so by doing this we’re
        allowing full access to all of the help files without having to specify
        a menu entry for each. The final parameter, "Help," is the text for the
        menu link, should we choose to generate a menu link from this SiteMap
        entry. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.1.4"  class="toc">7.1.4</a> 
        Nested Menus<a  name="sub:Nested-Menus"  class="Label"> </a> </h3>
      <div  class="Unindented"> The Menu class supports child menus by passing
        them in as final constructor parameters. For instance, if we wanted to
        have an "about" menu under Help, we could define the menu as shown in
        Listing <a  href="#lst:Nested-Menu-Definition"  class="Reference">7.1.4↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Nested Menu Definition<a  name="lst:Nested-Menu-Definition"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_120023">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">aboutMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"about"</code><code
 class="scala plain">, </code><code  class="scala string">"help"</code> <code  class="scala keyword">::</code> <code
 class="scala string">"about"</code> <code  class="scala keyword">::</code> <code
 class="scala plain">Nil, </code><code  class="scala string">"About"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">helpMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(...as defined above...), aboutMenu)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> When the menu is rendered it will have a child
        menu for About. Child menus are only rendered by default when the
        current page matches their parent’s Loc. That means that, for instance
        the following links would show in an "About" child menu item: </div>
      <ul>
        <li> <tt>/help/index</tt> </li>
        <li> <tt>/help/usage</tt> </li>
      </ul>
      <div  class="Unindented"> But the following would not: </div>
      <ul>
        <li> <tt>/index</tt> </li>
        <li> <tt>/site/example</tt> </li>
      </ul>
      <div  class="Unindented"> We’ll cover how you can customize the rendering
        of the menus in Розділ <a  href="#sub:Using-lift-Menu"  class="Reference">7.2.3↓</a>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.1.5"  class="toc">7.1.5</a> 
        Setting the Global SiteMap </h3>
      <div  class="Unindented"> Once you have all of your menu items defined,
        you need to set them as your SiteMap. As usual, we do this in the Boot
        class by calling the <tt>setSiteMap</tt> method on
        LiftRules, as shown in Listing <a  href="#lst:Setting-the-SiteMap"  class="Reference">7.1.5↓</a>. The <tt>setSiteMap</tt>
        method takes a SiteMap object that can be constructed using your menu
        items as arguments. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Setting the SiteMap<a  name="lst:Setting-the-SiteMap"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_856541">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">LiftRules.setSiteMap(SiteMap(homeMenu, profileMenu, ...))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> When you’re dealing with large menus, and in
        particular when your model objects create their own menus (see
        MegaProtoUser, Розділ <a  href="#sub:ProtoUser-and-MegaProtoUser"  class="Reference">8.2.8↓</a> ), then it can be more convenient to
        define List[Menu] and set that. Listing <a  href="#lst:Using-List-Menu-for"
 class="Reference">7.1.5↓</a> shows this usage. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using List[Menu] for SiteMap<a  name="lst:Using-List-Menu-for"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_392698">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">menus </code><code  class="scala keyword">=</code> <code  class="scala plain">Menu(Loc(</code><code
 class="scala string">"HomePage"</code><code  class="scala plain">, </code><code
 class="scala string">""</code><code  class="scala plain">, </code><code  class="scala string">"Home"</code><code
 class="scala plain">),...) </code><code  class="scala keyword">::</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">Menu(...) </code><code  class="scala keyword">::</code> <code
 class="scala plain">Nil</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">LiftRules.setSiteMap(SiteMap(menus </code><code
 class="scala keyword">:</code> <code  class="scala keyword">_</code><code  class="scala plain">*))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The key to using List for your menus is to
        explicitly define the type of the parameter as "_*" so that it’s treated
        as a set of varargs instead of a single argument of type List[Menu]. </div>
      <h2  class="Section"> <a  name="toc-Section-7.2"  class="toc">7.2</a> 
        Customizing Display<a  name="sec:Customizing-Display"  class="Label"> </a>
      </h2>
      <div  class="Unindented"> There are many cases where you may want to
        change the way that particular menu items are displayed. For instance,
        if you’re using a Menu item for access control on a subdirectory, you
        may not want the menu item displayed at all. We’ll discuss how you can
        control appearance, text, etc. in this section. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.2.1"  class="toc">7.2.1</a> 
        Hidden<a  name="sub:menu-Hidden"  class="Label"> </a> </h3>
      <div  class="Unindented"> The Hidden LocParam does exactly what it says:
        hides the menu item from the menu display. All other menu features still
        work. There is a variety of reasons why you might not want a link
        displayed. A common use, shown in Listing <a  href="#lst:Hidden-Menus"  class="Reference">7.2.1↓</a>, is where the point of the item is to
        restrict access to a particular subdirectory based on some condition.
        (We’ll cover the <tt>If</tt> tag in Розділ <a  href="#sub:menu-If"  class="Reference">7.3.1↓</a>.) </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Hidden Menus<a  name="lst:Hidden-Menus"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_345048">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">receiptImages </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"receipts"</code><code
 class="scala plain">, </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">(</code><code  class="scala string">"receipts"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil) -> </code><code
 class="scala keyword">true</code><code  class="scala plain">,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">          </code><code
 class="scala string">"Receipts"</code><code  class="scala plain">,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">Hidden, If(...)))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that in this example we’ve used the implicit
        conversion from <tt>Pair[String,Boolean]</tt> to
        <tt>Link</tt> to make this Menu apply to everything under
        the "<tt>receipts</tt>" directory. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.2.2"  class="toc">7.2.2</a> 
        Controlling the Menu Text<a  name="sub:menu-LinkText"  class="Label"> </a>
      </h3>
      <div  class="Unindented"> The <tt>LinkText</tt> class is what
        defines the function that will return the text to display for a given
        menu item. As we’ve shown, this can easily be set using the implicit
        conversion for string<span  class="formula">  → </span><tt>LinkText</tt>
        from <tt>Loc</tt>. As an added bonus, the implicit
        conversion actually takes a by-name <tt>String</tt> for the
        parameter. This means that you can just as easily pass in a function to
        generate the link text as a static string. For example, with our profile
        link we may want to make the link say "<username>’s profile".
        Listing <a  href="#lst:Customizing-Link-Text"  class="Reference">7.2.2↓</a> shows how we can do this by defining a
        helper method, assuming that there’s another method that will return the
        current user’s name (we use the ubiquitous <tt>Foo</tt>
        object here). </username></div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Customizing Link Text<a  name="lst:Customizing-Link-Text"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_305394">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">profileText </code><code  class="scala keyword">=</code> <code
 class="scala plain">Foo.currentUser + </code><code  class="scala string">"’s profile"</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">profileMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"Profile"</code><code
 class="scala plain">, </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">                           </code><code
 class="scala string">"profile"</code> <code  class="scala keyword">::</code> <code
 class="scala plain">Nil,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                           </code><code
 class="scala plain">profileText, ...))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Of course, if you want you can construct the
        <tt>LinkText</tt> instance directly by passing in a
        constructor function that returns a <tt>NodeSeq</tt>. The
        function that you use with <tt>LinkText</tt> takes a
        type-safe input parameter, which we’ll discuss in more detail in Розділ
        <a  href="#sub:Type-Safe-Params"  class="Reference">7.6.2↓</a>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.2.3"  class="toc">7.2.3</a> 
        Using <lift:menu><a  name="sub:Using-lift-Menu"  class="Label"> </a>
      </lift:menu></h3>
      <div  class="Unindented"> So far we’ve covered the Scala side of things.
        The other half of the magic is the special
        <tt><lift:menu></lift:menu></tt> tag. It’s this tag that handles
        the rendering of your menus into XHTML. The Menu tag uses a built-in
        snippet<span  class="FootOuter"><span  class="SupFootMarker">  [B] </span><span
 class="HoverFoot"><span  class="SupFootMarker">  [B] </span>net.liftweb.builtin.snippet.Menu</span></span>
        to provide several rendering methods. The most commonly used method is
        the <tt>Menu.builder</tt> snippet. This snippet renders your
        entire menu structure as an unordered list
        (<tt></tt><ul><tt></tt> in XHTML). Listing <a  href="#lst:Rendering-with-Menu.title"
 class="Reference">7.2.3↓</a> shows an example of using the Menu tag
        to build the default menu (yes, it’s that easy). </ul></div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Rendering with <lift:menu.title><a  name="lst:Rendering-with-Menu.title"
 class="Label"> </a> </lift:menu.title></div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_265887">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">div</code> <code  class="xml color1">class</code><code  class="xml plain">=</code><code
 class="xml string">"menu"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:Menu.builder</code> <code
 class="xml plain">/></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml plain"><!--</code--><code
 class="xml keyword">div</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></div><code  class="xml plain">
                    </code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Of course, Lift offers more customization on this
        snippet than just emitting some XHTML. By specifying some prefixed
        attributes on the tag itself, you can add attributes directly to the
        menu elements. The following prefixes are valid for attributes: </div>
      <ul>
        <li> <tt>ul</tt> - Adds the specified attribute to the
          <tt></tt><ul><tt></tt> element that makes up the menu 
        <li> <tt>li</tt> - Adds the specified attribute to each
          <tt></tt></li><li> element for the menu </li>
        <li> <tt>li_item</tt> - Adds the specified attribute to the
          current page’s menu item </li>
        <li> <tt>li_path</tt> - Adds the specified attribute to the
          current page’s breadcrumb trail (the breadcrumb trail is the set of
          menu items that are direct ancestors in the menu tree) </li>
      </ul>
      <div  class="Unindented"> The suffix of the attributes represents the name
        of the HTML attribute that will be added to that element, and can be
        anything. It will be passed directly through. For instance, we can add
        CSS<a  href="#index-CSS"  name="entry-CSS-1"  class="IndexReference">↓</a> classes to our menu
        and elements fairly easily, as shown in Listing <a  href="#lst:Using-Attribues-with-Menu.builder"
 class="Reference">7.2.3↓</a>. Notice that we also add a little
        JavaScript to our current menu item. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using Attribues with Menu.builder<a  name="lst:Using-Attribues-with-Menu.builder"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_979752">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:Menu.builder</code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml color1">li:class</code><code  class="xml plain">=</code><code  class="xml string">"menuitem"</code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml color1">li_item:class</code><code  class="xml plain">=</code><code  class="xml string">"selectedMenu"</code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml color1">li_item:onclick</code><code  class="xml plain">=</code><code
 class="xml string">"javascript:alert(’Already selected!’);"</code> <code  class="xml plain">/></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In addition to rendering the menu itself, the Menu
        class offers a few other tricks. The <tt>Menu.title</tt><a  href="#index-Menu.title"
 name="entry-Menu.title-0"  class="IndexReference">↓</a> snippet can
        be used to render the title of the page, which by default is the name
        parameter of the Loc for the menu (the first parameter). If you write
        your own Loc implementation (Розділ <a  href="#sec:Writing-Your-Own-Loc"
 class="Reference">7.6↓</a>), or you use the Title<a  href="#index-Title"  name="entry-Title-0"
 class="IndexReference">↓</a>
        <tt>LocParam</tt> (Розділ <a  href="#sub:menu-Title"  class="Reference">7.4.3↓</a>), you can overide the title to be
        whatever you’d like. Listing <a  href="#lst:Rendering-the-Title"  class="Reference">7.2.3↓</a> shows how you use
        <tt>Menu.title</tt>. In this particular example the title
        will be rendered as "<tt>Home Page</tt>". </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Rendering the Menu Title<a  name="lst:Rendering-the-Title"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_719146">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// In Boot:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">MyMenu </code><code  class="scala keyword">=</code> <code  class="scala plain">Menu(Loc(</code><code
 class="scala string">"Home Page"</code><code  class="scala plain">, </code><code
 class="scala string">"index"</code> <code  class="scala keyword">::</code> <code
 class="scala plain">Nil, </code><code  class="scala string">"Home"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala comments">// In template (or wherever)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain"><title><lift</code><code
 class="scala keyword">:</code><code  class="scala plain">Menu.title/></title></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The next snippet in the Menu class is
        <tt>item</tt>. The <tt>Menu.item</tt> snippet
        allows you to render a particular menu item by specifying the name
        attribute (matching the first parameter to Loc). As with
        <tt>Menu.builder</tt>, it allows you to specify additional
        prefixed attributes for the link to be passed to the emitted item.
        Because it applies these attributes to the link itself, the only valid
        prefix is "<tt>a</tt>". Additionally, if you specify child
        elements for the snippet tag, they will be used instead of the default
        link text. Listing <a  href="#lst:Using-Menu.item"  class="Reference">7.2.3↓</a> shows an example using our
        "<tt>Home Page</tt>" menu item defined in Listing <a  href="#lst:Rendering-the-Title"
 class="Reference">7.2.3↑</a>. As you can see, we’ve added some
        replacement text as well as specifying a CSS<a  href="#index-CSS"  name="entry-CSS-2"
 class="IndexReference">↓</a> class for the link.
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using Menu.item<a  name="lst:Using-Menu.item"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_209932">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:Menu.item</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"Home Page"</code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml color1">a:class</code><code  class="xml plain">=</code><code  class="xml string">"homeLink"</code><code
 class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">b</code><code  class="xml plain">>Go Home<!--</code--><code
 class="xml keyword">b</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number4 index3 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">lift:Menu.item</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></div><code  class="xml plain"><code  class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The final snippet that the Menu class provides is
        the <tt>Menu.group</tt> method. We’re going to cover the use
        of <tt>Menu.group</tt> in detail in Розділ <a  href="#sub:LocGroup"  class="Reference">7.5.2↓</a>. </div>
      <h2  class="Section"> <a  name="toc-Section-7.3"  class="toc">7.3</a> 
        Access Control<a  name="sec:SiteMap-Access-Control"  class="Label"> </a>
      </h2>
      <div  class="Unindented"> So far we’ve covered how to control the display
        side of Menus; now we’ll take a look at some of the plumbing behind the
        scenes. One important function of a Menu is that it controls access to
        the pages in your application. If no Menu matches a given request, then
        the user gets a 404 Not Found error. Other than this binary control of
        "matches<span  class="formula">  → </span>display" and "doesn’t match<span
 class="formula"> → </span>don’t display",
        <tt>SiteMap</tt> provides for arbitrary access checks
        through the <tt>If</tt> and <tt>Unless</tt>
        <tt>LocParams</tt>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.3.1"  class="toc">7.3.1</a> 
        If<a  name="sub:menu-If"  class="Label"> </a> </h3>
      <div  class="Unindented"> The <tt>If</tt><a  href="#index-If"  name="entry-If-0"
 class="IndexReference">↓</a>
        <tt>LocParam</tt> takes a test function, <span  class="formula">()
           ⇒ <i>Boolean</i></span>, as well as failure message function, <span  class="formula">() ⇒ <i>LiftResponse</i></span>, as its arguments.
        When the <tt>Loc</tt> that uses the <tt>If</tt>
        clause matches a given path, the test function is executed, and if true
        then the page is displayed as normal. If the function evaluates to
        false, then the failure message function is executed and its result is
        sent to the user. There’s an implicit conversion in
        <tt>Loc</tt> from a <tt>String</tt> to a
        response which converts to a <tt>RedirectWithState</tt><a  href="#index-RedirectWithState"
 name="entry-RedirectWithState-0"  class="IndexReference">↓</a>
        instance (Розділ <a  href="#sec:HTTP-redirects"  class="Reference">3.9↑</a>). The redirect is to the location
        specified by <tt>LiftRules.siteMapFailRedirectLocation</tt>,
        which is the root of your webapp ("/") by default. If you want, you can
        change this in <tt>LiftRules</tt> for a global setting, or
        you can provide your own <tt>LiftResponse</tt><a  href="#index-LiftResponse"
 name="entry-LiftResponse-0"  class="IndexReference">↓</a>. Listing <a  href="#lst:Using-the-If-LocParam"
 class="Reference">7.3.1↓</a> shows a revision of the profile menu
        that we defined in Listing <a  href="#lst:Customizing-Link-Text"  class="Reference">7.2.2↑</a>, extended to check whether the user is
        logged in. If the user isn’t logged in, we redirect to the login page. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using the If LocParam<a  name="lst:Using-the-If-LocParam"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_243320">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">loggedIn </code><code  class="scala keyword">=</code> <code
 class="scala plain">If(() </code><code  class="scala keyword">=</code><code  class="scala plain">> User.loggedIn</code><code
 class="scala keyword">_</code><code  class="scala plain">?,</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">                  </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> RedirectResponse(</code><code
 class="scala string">"/login"</code><code  class="scala plain">))</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">profileMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"Profile"</code><code
 class="scala plain">, </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                           </code><code
 class="scala string">"profile"</code> <code  class="scala keyword">::</code> <code
 class="scala plain">Nil,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">                           </code><code
 class="scala plain">profileText, loggedIn))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.3.2"  class="toc">7.3.2</a> 
        Unless<a  name="sub:menu-Unless"  class="Label"> </a> </h3>
      <div  class="Unindented"> The <tt>Unless</tt><a  href="#index-Unless"  name="entry-Unless-0"
 class="IndexReference">↓</a>
        <tt>LocParam</tt> is essentially the mirror of
        <tt>If</tt>. The exact same rules apply, except that the
        page is displayed only if the test function returns false. The reason
        that there are two classes to represent this behavior is that it’s
        generally clearer when a predicate is read as "working" when it returns
        true. </div>
      <h2  class="Section"> <a  name="toc-Section-7.4"  class="toc">7.4</a> 
        Page-Specific Rendering<a  name="sec:Page-Specific-Rendering"  class="Label">
        </a> </h2>
      <div  class="Unindented"> Page specific rendering with
        <tt>SiteMap</tt> is an advanced technique that provides a
        lot of flexibility for making pages render differently depending on
        state. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.4.1"  class="toc">7.4.1</a> 
        The Template Parameter<a  name="sub:The-Template-Parameter"  class="Label">
        </a> </h3>
      <div  class="Unindented"> Generally, the template that will be used for a
        page is derived from the path of the request. The
        <tt>Template</tt> <tt>LocParam</tt>, however,
        allows you to completely override this mechanism and provide any
        template you want by passing in a function <span  class="formula">() ⇒ <i>NodeSeq</i></span>.
        Going back to our example menus (Розділ <a  href="#sec:Basic-SiteMap-Definition"
 class="Reference">7.1↑</a>), we’d like the welcome page to show
        either the user’s entries or a plain welcome screen depending on whether
        they’re logged in. One approach to this is shown in Listing <a  href="#lst:Override-Templates"
 class="Reference">7.4.1↓</a>. In this example, we create a
        <tt>Template</tt> class that generates the appropriate
        template and then bind it into the home page menu
        <tt>Loc</tt>. (See the Lift API for more on the Template
        class.) </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Overriding Templates<a  name="lst:Override-Templates"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_56970">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">homepageTempl </code><code  class="scala keyword">=</code> <code
 class="scala plain">Template({ () </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">surround </code><code  class="scala keyword">with</code><code
 class="scala keyword">=</code><code  class="scala string">"default"</code> <code
 class="scala plain">at</code><code  class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">{ </code><code  class="scala keyword">if</code> <code  class="scala plain">(User.loggedIn</code><code
 class="scala keyword">_</code><code  class="scala plain">?) { </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">Entries.list /> </code></lift<></code></div><code  class="scala plain">
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">embed what</code><code  class="scala keyword">=</code><code
 class="scala string">"welcome"</code> <code  class="scala plain">/></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">surround></code></code></div><code
 class="scala plain">
                        <div  class="line number10 index9 alt1"><code  class="scala plain">})</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">homeMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"Home Page"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">                        </code><code
 class="scala string">""</code> <code  class="scala keyword">::</code> <code  class="scala plain">Nil,</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">                        </code><code
 class="scala string">"Home Page"</code><code  class="scala plain">, homepageTempl))</code></div>
                      </code></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.4.2"  class="toc">7.4.2</a> 
        The Snippet and LocSnippets Parameters </h3>
      <div  class="Unindented"> Besides overriding the template for a page
        render (admittedly, a rather coarse approach), SiteMap has two
        mechanisms for overriding or defining the behavior of specific snippets.
        The first, Snippet, allows you to define the dispatch for a single
        snippet based on the name of the snippet. Listing <a  href="#lst:Using-the-Snippet-locparam"
 class="Reference">7.4.2↓</a> shows how we could use Snippet to
        achieve the same result for the home page rendering as we just did with
        the Template parameter. All we need to do is use the
        <lift:homepage> snippet on our main page and the snippet mapping
        will dispatch based on the state. (Here we’ve moved the welcome text
        into a Utils.welcome snippet.) </lift:homepage></div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using the Snippet LocParam<a  name="lst:Using-the-Snippet-locparam"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_74858">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">homeSnippet </code><code  class="scala keyword">=</code> <code
 class="scala plain">Snippet(</code><code  class="scala string">"homepage"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">if</code> <code  class="scala plain">(User.loggedIn</code><code
 class="scala keyword">_</code><code  class="scala plain">?) {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Entries.list </code><code  class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Utils.welcome </code><code  class="scala keyword">_</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">})</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">homeMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"Home Page"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">                        </code><code
 class="scala string">""</code> <code  class="scala keyword">::</code> <code  class="scala plain">Nil,</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">                        </code><code
 class="scala string">"Home Page"</code><code  class="scala plain">, homeSnippet))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The LocSnippets trait extends the concept of
        Snippet to provide a full dispatch partial function. This allows you to
        define multiple snippet mappings associated with a particular Loc. To
        simplify things, Lift provides a DispatchLocSnippets trait that has
        default implementations for <tt>apply</tt> and
        <tt>isDefinedAt</tt>; that means you only need to provide a
        <tt>dispatch</tt> method implementation for it to work.
        Listing <a  href="#lst:Using-LocSnippets"  class="Reference">7.4.2↓</a> shows an example of using
        DispatchLocSnippets for a variety of snippets. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using LocSnippets<a  name="lst:Using-LocSnippets"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_459498">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">entrySnippets </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">DispatchLocSnippets {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">dispatch </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"entries"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> Entries.list </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"add"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> Entries.newEntry </code><code
 class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.4.3"  class="toc">7.4.3</a> 
        Title<a  name="sub:menu-Title"  class="Label"> </a> </h3>
      <div  class="Unindented"> As we mentioned in Розділ <a  href="#sub:Using-lift-Menu"
 class="Reference">7.2.3↑</a>, the Title LocParam can be used to
        provide a state-dependent title for a page. The Title case class simply
        takes a function <span  class="formula">(<i>T</i>) ⇒ <i>NodeSeq</i></span>,
        where T is a type-safe parameter (we’ll cover this in Розділ <a  href="#sub:Type-Safe-Params"
 class="Reference">7.6.2↓</a>). Generally you can ignore this
        parameter if you want to, which is what we do in Listing <a  href="#lst:Customizing-the-Title"
 class="Reference">7.4.3↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Customizing the Title<a  name="lst:Customizing-the-Title"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_587707">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">userTitle </code><code  class="scala keyword">=</code> <code
 class="scala plain">Title((</code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">if</code> <code  class="scala plain">(User.loggedIn</code><code
 class="scala keyword">_</code><code  class="scala plain">?) {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Text(User.name + </code><code  class="scala string">"’s Account"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Text(</code><code  class="scala string">"Welcome to PocketChange"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">})</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">homeMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"Home Page"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">                        </code><code
 class="scala string">""</code> <code  class="scala keyword">::</code> <code  class="scala plain">Nil,</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">                        </code><code
 class="scala string">"Home Page"</code><code  class="scala plain">, homepageTempl, userTitle))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-7.5"  class="toc">7.5</a> 
        Miscellaneous Menu Functionality<a  name="sec:Misc-Menu"  class="Label">
        </a> </h2>
      <div  class="Unindented"> These are LocParams that don’t quite fit into
        the other categories. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.5.1"  class="toc">7.5.1</a> 
        Test<a  name="sub:menu-Test"  class="Label"> </a> </h3>
      <div  class="Unindented"> Test is intended to be used to ensure that a
        given request has the proper parameters before servicing. With Test, you
        provide a function, <span  class="formula">(<i>Req</i>) ⇒ <i>Boolean</i></span>
        that is passed the full Req object. Note that the test is performed when
        SiteMap tries to locate the correct menu, as opposed to If and Unless,
        which are tested after the proper Loc has been identified. Returning a
        false means that this Loc doesn’t match the request, so SiteMap will
        continue to search through your Menus to find an appropriate Loc. As an
        example, we could check to make sure that a given request comes from
        Opera (the Req object provides convenience methods to test for different
        browsers; see the Lift API for a full list) with the code in Listing <a
 href="#lst:Testing-the-Request"  class="Reference">7.5.1↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Testing the Request<a  name="lst:Testing-the-Request"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_217869">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">onlyOpera </code><code  class="scala keyword">=</code> <code
 class="scala plain">Test(req </code><code  class="scala keyword">=</code><code
 class="scala plain">> req.isOpera)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">operaMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(</code><code  class="scala string">"Opera"</code><code
 class="scala plain">, </code><code  class="scala string">"opera"</code> <code  class="scala keyword">::</code> <code
 class="scala plain">Nil, </code><code  class="scala string">"Only Opera"</code><code
 class="scala plain">, onlyOpera))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.5.2"  class="toc">7.5.2</a> 
        LocGroup<a  name="sub:LocGroup"  class="Label"> </a> </h3>
      <div  class="Unindented"> The LocGroup param allows you to categorize your
        menu items. The <tt>Menu.group</tt> snippet (mentioned in
        Розділ <a  href="#sub:Using-lift-Menu"  class="Reference">7.2.3↑</a>) allows you to render the menu items for
        a specific group. A menu item may be associated with one or more groups.
        Simply add a LocGroup param with string arguments for the group names,
        as shown in Listing <a  href="#lst:Categorizing-your-Menu"  class="Reference">7.5.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Categorizing Your Menu<a  name="lst:Categorizing-your-Menu"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_267457">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">siteMenu </code><code  class="scala keyword">=</code> <code
 class="scala plain">Menu(Loc(...,LocGroup(</code><code  class="scala string">"admin"</code><code
 class="scala plain">, </code><code  class="scala string">"site"</code><code  class="scala plain">)))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In your templates, you then specify the binding of
        the menu as shown in Listing <a  href="#lst:Binding-a-Menu-group"  class="Reference">7.5.2↓</a>. As you can see, we’ve also added a
        prefixed attribute to control the CSS<a  href="#index-CSS"  name="entry-CSS-3"
 class="IndexReference">↓</a> class of the links
        ("a" is the only valid prefix), and we’ve added some body XHTML for
        display. In particular, the <menu:bind> tag controls where the
        menu items are rendered. If you don’t provide body elements, or if you
        provide body elements without the <menu:bind> element, your body
        XHTML will be ignored and the menu will be rendered directly. </menu:bind></menu:bind></div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Binding a Menu Group<a  name="lst:Binding-a-Menu-group"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_292607">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><div
 <=""  code=""><code  class="scala keyword">class</code><code  class="scala keyword">=</code><code
 class="scala string">"site"</code><code  class="scala plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"></code><ul><code  class="scala plain"></code></ul></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">Menu.group group</code><code  class="scala keyword">=</code><code
 class="scala string">"site"</code></lift<></code></div><code  class="scala plain">
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">a</code><code  class="scala keyword">:</code><code  class="scala keyword">class</code><code
 class="scala keyword">=</code><code  class="scala string">"siteLink"</code><code
 class="scala plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">   </code><code
 class="scala plain"><li><menu<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">bind /></code></menu<></li></code></div><code  class="scala plain">
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">Menu.group></code></code></div><code
 class="scala plain">
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"></code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain"></code></div></code></code></code></code></div><code
 class="scala plain"><code  class="scala plain">
                      </code></code></div><code  class="scala plain"><code  class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-7.6"  class="toc">7.6</a> 
        Writing Your Own Loc<a  name="sec:Writing-Your-Own-Loc"  class="Label">
        </a> </h2>
      <div  class="Unindented"> As we’ve shown, there’s a lot of functionality
        available for your Menu items. If you need more control, though, the Loc
        trait offers some functionality, such as rewriting, that doesn’t have a
        direct correspondence in a LocParam element. The basic definition of a
        Loc implementation covers a lot of the same things. The following vals
        and defs are abstract, so you must implement them yourself: </div>
      <ul>
        <li> def name: the name that can be used to retrieve the menu via
          Menu.item </li>
        <li> def link: the actual link; you can use the implicit conversions
          from List[String] or Pair[List[String],Boolean], or you can create the
          Link object yourself </li>
        <li> def text: the text that will be displayed to the user; you can use
          the implicit conversion from String, or you can provide your own
          LinkText instance </li>
        <li> def params: must return a List[LocParam] that is used to control
          behavior as we’ve shown in the previous sections </li>
        <li> def defaultParams: used for type-safe rewriting, which we’ll cover
          in Розділ <a  href="#sub:Type-Safe-Params"  class="Reference">7.6.2↓</a> </li>
      </ul>
      <div  class="Unindented"> Essentially, these mirror the params that are
        required when you use Loc.apply to generate a Loc. We’re going to write
        our own Loc implementation for our Expenses in this section to
        demonstrate how this works. Because this overlaps with existing
        functionality in the PocketChange application, we’ll be using a branch
        in the PocketChange app. You can pull the new branch with the command </div>
      <pre  class="LyX-Code">git checkout --track -b custom-loc origin/custom-loc
</pre>
      <div  class="Unindented"> You can then switch back and forth between the
        branches with the commands: </div>
      <pre  class="LyX-Code">git checkout master
git checkout custom-loc
</pre>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.6.1"  class="toc">7.6.1</a> 
        Corresponding Functions </h3>
      <div  class="Unindented"> Table <a  href="#tab:LocParam-Methods-in-loc"  class="Reference">7.1↓</a> lists the LocParams and their
        corresponding methods in Loc, with notes to explain any differences in
        definition or usage. If yould prefer to use the LocParams instead, just
        define the <tt>params</tt> method on Loc to return a list of
        the LocParams you want. </div>
      <div  class="Indented">
        <div  class="float"> <a  name="tab:LocParam-Methods-in-loc"  class="Label">
          </a>
          <div  class="table">
            <div  class="center">
              <table>
                <tbody>
                  <tr>
                    <td  valign="top"  align="center"  style="width: 1in;">
                      Hidden </td>
                    <td  valign="top"  align="center"  style="width: 1.5in;">
                      N/A </td>
                    <td  valign="top"  align="center"  style="width: 2.5in;"> To
                      make your Loc hidden, add a Hidden LocParam to your params
                      method return value </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="center"  style="width: 1in;">
                      If/Unless </td>
                    <td  valign="top"  align="center"  style="width: 1.5in;">
                      override testAccess </td>
                    <td  valign="top"  align="center"  style="width: 2.5in;">
                      You need to return an Either to indicate success
                      (Left[Boolean]) or failure (Right[Box[LiftResponse]]) </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="center"  style="width: 1in;">
                      Template </td>
                    <td  valign="top"  align="center"  style="width: 1.5in;">
                      override calcTemplate </td>
                    <td  valign="top"  align="center"  style="width: 2.5in;">
                      Return a Box[NodeSeq] </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="center"  style="width: 1in;">
                      Snippet and LocSnippets </td>
                    <td  valign="top"  align="center"  style="width: 1.5in;">
                      override snippets </td>
                    <td  valign="top"  align="center"  style="width: 2.5in;">
                      Snippet is a PartialFunction[String, Box[ParamType]),
                      NodeSeq => NodeSeq], which lets you use the type-safe
                      parameter to control behavior. </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="center"  style="width: 1in;">
                      Title </td>
                    <td  valign="top"  align="center"  style="width: 1.5in;">
                      override title </td>
                    <td  valign="top"  align="center"  style="width: 2.5in;">
                      You can override "def title" or "def title(in: ParamType)"
                      depending on whether you want to use type-safe parameters
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="center"  style="width: 1in;"> Test
                    </td>
                    <td  valign="top"  align="center"  style="width: 1.5in;">
                      override doesMatch_? </td>
                    <td  valign="top"  align="center"  style="width: 2.5in;">
                      It’s your responsibility to make sure that the <i>path</i>
                      of the request matches your Loc, since this method is what
                      SiteMap uses to find the proper Loc for a request </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="center"  style="width: 1in;">
                      LocGroup </td>
                    <td  valign="top"  align="center"  style="width: 1.5in;">
                      override inGroup_? </td>
                    <td  valign="top"  align="center"  style="width: 2.5in;">
                      Nothing special here </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div  class="caption"> Table 7.1 LocParam Methods in Loc </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.6.2"  class="toc">7.6.2</a> 
        Type Safe Parameters<a  name="sub:Type-Safe-Params"  class="Label"> </a>
      </h3>
      <div  class="Unindented"> One of the nice features of Loc is that it
        allows you to rewrite requests in a type-safe manner. What this means is
        that we can define a rewrite function on our Loc instance that returns
        not only a standard RewriteResponse, but also a parameter that we can
        define to pass information back to our menu to control behavior. The
        reason that this is type-safe is that we define our Loc on the type of
        the parameter itself. For instance, let’s expand the functionality of
        our app so that we have a page called "acct" that shows the expense
        entries for a given account. We would like this page to be viewable only
        by the owner of the account under normal circumstances, but to allow
        them to share it with other members if they wish to. Let’s start by
        defining our type-safe parameter class as shown in Listing <a  href="#lst:Defining-LedgerInfo"
 class="Reference">7.6.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Defining AccountInfo<a  name="lst:Defining-LedgerInfo"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_697364">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">abstract</code> <code
 class="scala keyword">class</code> <code  class="scala plain">AccountInfo</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">case</code> <code
 class="scala keyword">object</code> <code  class="scala plain">NoSuchAccount </code><code
 class="scala keyword">extends</code> <code  class="scala plain">AccountInfo</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">case</code> <code
 class="scala keyword">object</code> <code  class="scala plain">NotPublic </code><code
 class="scala keyword">extends</code> <code  class="scala plain">AccountInfo</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">case</code> <code
 class="scala keyword">class</code> <code  class="scala plain">FullAccountInfo(account </code><code
 class="scala keyword">:</code> <code  class="scala plain">Account,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">                           </code><code
 class="scala plain">entries </code><code  class="scala keyword">:</code> <code
 class="scala plain">List[Expense]) </code><code  class="scala keyword">extends</code> <code
 class="scala plain">AccountInfo</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> We define a few case classes to indicate various
        states. The FullAccountInfo holds the account itself as well as some
        flags for behavior. Now that we have our parameter type, we can start to
        define our Loc, as shown in Listing <a  href="#lst:Defining-a-Type-Safe-loc"
 class="Reference">7.6.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Defining a Type-Safe Loc<a  name="lst:Defining-a-Type-Safe-loc"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_430417">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">AccountLoc </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Loc[AccountInfo] {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Assuming that an Account instance has a unique
        string ID, we would like to use URL rewriting so that we can access a
        ledger via "/acct/<unique  id="">". Our rewrite function, shown in
        Listing <a  href="#lst:The-Rewrite-Function"  class="Reference">7.6.2↓</a>, handles a few different things at once.
        It handles locating the correct account and then checking the
        permissions if everything else is OK. </unique></div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The Rewrite Function<a  name="lst:The-Rewrite-Function"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_387924">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">rewrite </code><code
 class="scala keyword">=</code> <code  class="scala plain">Full({</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">RewriteRequest(ParsePath(List(</code><code
 class="scala string">"acct"</code><code  class="scala plain">, aid), </code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">_</code><code
 class="scala plain">, </code><code  class="scala keyword">_</code><code  class="scala plain">), </code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">_</code><code
 class="scala plain">) </code><code  class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Account.findAll(By(Account.stringId, aid)) </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">List(account) </code><code
 class="scala keyword">if</code> <code  class="scala plain">account.is</code><code
 class="scala keyword">_</code><code  class="scala plain">public.is </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">(RewriteResponse(</code><code  class="scala string">"account"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil),</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">         </code><code
 class="scala plain">FullAccountInfo(account, account.entries))</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">List(account) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">(RewriteResponse(</code><code  class="scala string">"account"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil),</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">         </code><code
 class="scala plain">NotPublic)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> {</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">(RewriteResponse(</code><code  class="scala string">"account"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil),</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">         </code><code
 class="scala plain">NoSuchAccount)</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">})</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now that we’ve defined the transformation from URL
        to parameter, we need to define the behaviors based on that parameter.
        The account page will show a list of expense entries only if the account
        is located and is public. For this example we’ll use a single template
        and we’ll change the snippet behavior based on our parameter, as shown
        in Listing <a  href="#lst:Defining-Snippet-Behavior"  class="Reference">7.6.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Defining Snippet Behavior<a  name="lst:Defining-Snippet-Behavior"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_391639">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">snippets </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(</code><code  class="scala string">"entries"</code><code
 class="scala plain">, Full(NoSuchAccount)) </code><code  class="scala keyword">=</code><code
 class="scala plain">> {ignore </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Text(</code><code  class="scala string">"Could not locate the requested account"</code><code
 class="scala plain">)}</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(</code><code  class="scala string">"entries"</code><code
 class="scala plain">, Full(NotPublic)) </code><code  class="scala keyword">=</code><code
 class="scala plain">> {ignore </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Text(</code><code  class="scala string">"This account is not publicly viewable"</code><code
 class="scala plain">)}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(</code><code  class="scala string">"entries"</code><code
 class="scala plain">, Full(FullAccountInfo(account, List()))) </code><code  class="scala keyword">=</code><code
 class="scala plain">> {ignore </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Text(</code><code  class="scala string">"No entries for "</code> <code
 class="scala plain">+ account.name.is)}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(</code><code  class="scala string">"entries"</code><code
 class="scala plain">, Full(FullAccountInfo(account, entries))) </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Accounts.show(entries) </code><code  class="scala keyword">_</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In this example, we simply return some text if the
        <tt>Account</tt> can’t be located, isn’t public, or doesn’t
        have any <tt>Expense</tt> entries. Remember that this
        function needs to return a snippet function, which expects a NodeSeq
        parameter. This is why we need to include the
        <tt>ignore</tt> parameter as part of our closures. If our
        <tt>Account</tt> does have entries, we return a real snippet
        method defined in our <tt>Accounts</tt> object. In our
        template, we simply use an entries snippet tag, as shown in Listing <a  href="#lst:Our-Public-Template"
 class="Reference">7.6.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Our Public Template<a  name="lst:Our-Public-Template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_233135">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">surround </code><code
 class="scala keyword">with</code><code  class="scala keyword">=</code><code  class="scala string">"default"</code> <code
 class="scala plain">at</code><code  class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">entries  eager</code><code  class="scala keyword">_</code><code
 class="scala plain">eval</code><code  class="scala keyword">=</code><code  class="scala string">"true"</code><code
 class="scala plain">></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><h<  code=""><code  class="scala value">1</code><code  class="scala plain">><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">Menu.title /></code></lift<></code></h<><code
 class="scala plain"><code  class="scala plain"><code  class="scala value">1</code><code
 class="scala plain">></code></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">embed what</code><code  class="scala keyword">=</code><code
 class="scala string">"entry_table"</code> <code  class="scala plain">/></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">entries></code></code></div><code
 class="scala plain">
                        <div  class="line number6 index5 alt1"><code  class="scala plain"><code
 class="scala keyword">:</code><code  class="scala plain">surround> </code></code></div><code
 class="scala plain">
                      </code></code></code></code></code></code></code></div><code
 class="scala plain"><code  class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> We’re using our embedded table template for the
        body of the table along with the <tt>eager_eval</tt>
        attribute so that we can use the same markup for all occurrences of our
        expense table display. We can also define the title of the page based on
        the <tt>title</tt> parameter, as shown in Listing <a  href="#lst:Defining-the-Title"
 class="Reference">7.6.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Defining the Title<a  name="lst:Defining-the-Title"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_329490">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">title(param </code><code
 class="scala keyword">:</code> <code  class="scala plain">AccountInfo) </code><code
 class="scala keyword">=</code> <code  class="scala plain">param </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">FullAccountInfo(acct, </code><code
 class="scala keyword">_</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Text(</code><code  class="scala string">"Expense summary for "</code> <code
 class="scala plain">+ acct.name.is)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> Text(</code><code  class="scala string">"No account"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.6.3"  class="toc">7.6.3</a> 
        Dynamically Adding Child Menus </h3>
      <div  class="Unindented"> TBW </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-7.6.4"  class="toc">7.6.4</a> 
        Binding Your Custom Loc </h3>
      <h2  class="Section"> <a  name="toc-Section-7.7"  class="toc">7.7</a> 
        Conclusion </h2>
      <div  class="Unindented"> As we’ve shown in this chapter, SiteMap offers a
        wide range of functionality to let you control site navigation and
        access. You can customize the display of your individual items using the
        <tt>LinkText</tt> <tt>LocParam</tt> as well as
        through the functionality of the built-in <tt>Menu</tt>
        <tt>builder</tt> and <tt>item</tt> snippets. You
        can use the <tt>If</tt> and <tt>Unless</tt>
        <tt>LocParam</tt>s to control access to your pages
        programmatically, and you can use the <tt>Test</tt>
        <tt>LocParam</tt> to check the request before it’s even
        dispatched. Page-specific rendering can be customized with the
        <tt>Template</tt>, <tt>Snippet</tt>, and
        <tt>LocSnippet</tt> <tt>LocParam</tt>s, and you
        can group menu items together via the <tt>LocGroup</tt>
        <tt>LocParam</tt>. Finally, you can consolidate all of these
        functions by writing your own <tt>Loc</tt> trait subclass
        directly, and gain the additional benefit of type-safe URL rewriting.
        Together these offer a rich set of tools for building your web site
        exactly they way you want to. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-8"  class="toc">8</a> The
        Mapper and Record Frameworks<a  name="cha:mapper_and_record"  class="Label">
        </a> </h1>
      <div  class="Unindented"> In our experience, most webapps end up needing
        to store user data somewhere. Once you start working with user data,
        though, you start dealing with issues like coding up input forms,
        validation<a  href="#index-validation"  name="entry-validation-0"  class="IndexReference">↓</a>, persistence,
        etc. to handle the data. That’s where the Mapper and Record frameworks
        come in. These frameworks provides a scaffolding for all of your data
        manipulation needs. Mapper is the original Lift persistence framework,
        and it is closely tied to JDBC for its storage. Record is a new
        refactorization of Mapper that is backing-store agnostic at its core, so
        it doesn’t matter whether you want to save your data to JDBC, JPA, or
        even something such as XML. With Record, selecting the proper driver
        will be as simple as hooking the proper traits into your class. </div>
      <div  class="Indented">
        <div  style="width: 100%;"  class="Framed"> The Record framework is
          relatively new to Lift. <strike>The plan is to move to Record as the
            primary ORM framework for Lift sometime post-1.0.</strike> Because
          Record is still under active design and development, and because of
          its current “moving target” status, this chapter is mostly going to
          focus on Mapper. We will, however, provide a few comparitive examples
          of Record functionality to give you a general feel for the flavor of
          the changes. In any case, Mapper will not go away even when record
          comes out, so you can feel secure that any code using Mapper will be
          viable for quite a while. </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-8.1"  class="toc">8.1</a> 
        Introduction to Mapper and MetaMapper </h2>
      <div  class="Unindented"> Let’s start by discussing the relationship
        between the Mapper<a  href="#index-Mapper"  name="entry-Mapper-0"  class="IndexReference">↓</a> and MetaMapper<a
 href="#index-MetaMapper"  name="entry-MetaMapper-0"  class="IndexReference">↓</a> traits (and
        the corresponding Record<a  href="#index-Record"  name="entry-Record-0"
 class="IndexReference">↓</a> and MetaRecord<a  href="#index-MetaRecord"  name="entry-MetaRecord-0"
 class="IndexReference">↓</a>). Mapper
        provides the <i>per-instance</i> functionality for your class, while
        MetaMapper handles the <i>global</i> operations for your class and
        provides a common location to define per-class static specializations of
        things like field order, form generation, and HTML representation. In
        fact, many of the Mapper methods actually delegate to methods on
        MetaMapper. In addition to Mapper and MetaMapper, there is a third
        trait, MappedField, that provides the per-field functionality for your
        class. In Record, the trait is simply called “Field”. The MappedField
        trait lets you define the individual validators as well as filters to
        transform the data and the field name. Under Record, Field adds some
        functionality such as tab order and default error messages for form
        input handling. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.1"  class="toc">8.1.1</a> 
        Adding Mapper to Your Project </h3>
      <div  class="Unindented"> Since Mapper is a separate module, you need to
        add the following dependency to your pom.xml to access it: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Mapper POM Dependency </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_643204">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">project</code> <code  class="xml plain">...></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">dependencies</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">dependency</code><code  class="xml plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">groupId</code><code  class="xml plain">>net.liftweb<!--</code--><code
 class="xml keyword">groupId</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">artifactId</code><code  class="xml plain">>lift-mapper<!--</code--><code
 class="xml keyword">artifactId</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">version</code><code  class="xml plain">>1.0<!--</code--><code
 class="xml keyword">version</code><code  class="xml plain">> </code><code  class="xml comments"><!-- or 1.1-SNAPSHOT, etc --></code></code></div><code
 class="xml plain">
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">dependency</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><!--</code--><code  class="xml keyword">dependencies</code><code
 class="xml plain">></code></code></div><code  class="xml plain">
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">  </code><code
 class="xml plain">...</code></div>
                        <div  class="line number12 index11 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">project</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> You’ll also need the following import in any Scala
        code that uses Mapper: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Mapper Imports </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_53990">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.mapper.</code><code  class="scala keyword">_</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.2"  class="toc">8.1.2</a> 
        Setting Up the Database Connection </h3>
      <div  class="Unindented"> The first thing you need to do is to define the
        database connection. We do this by defining an object called
        <tt>DBVendor</tt> (but you can call it whatever you want).
        This object extends the net.liftweb.mapper.ConnectionManager trait and
        must implement two methods: newConnection and releaseConnection. You can
        make this as sophisticated as you want, with pooling, caching, etc., but
        for now, Listing <a  href="#lst:Setting-up-the-database"  class="Reference">8.1.2↓</a> shows a basic implementation to set up a
        PostgreSQL driver. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Setting Up the Database<a  name="lst:Setting-up-the-database"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_537253">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">.. standard Lift imports ...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.mapper.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.sql.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">DBVendor </code><code  class="scala keyword">extends</code> <code
 class="scala plain">ConnectionManager {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Force load the driver</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">Class.forName(</code><code  class="scala string">"org.postgresql.Driver"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// define methods</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">newConnection(name </code><code
 class="scala keyword">:</code> <code  class="scala plain">ConnectionIdentifier) </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">try</code> <code  class="scala plain">{</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Full(DriverManager.getConnection(</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">           </code><code
 class="scala string">"jdbc:<a  href="postgresql://localhost/mydatabase">postgresql://localhost/mydatabase</a>"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">           </code><code
 class="scala string">"root"</code><code  class="scala plain">, </code><code  class="scala string">"secret"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">catch</code> <code  class="scala plain">{</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">e </code><code  class="scala keyword">:</code> <code
 class="scala plain">Exception </code><code  class="scala keyword">=</code><code
 class="scala plain">> e.printStackTrace; Empty</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">releaseConnection (conn </code><code
 class="scala keyword">:</code> <code  class="scala plain">Connection) { conn.close }</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot {</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">DB.defineConnectionManager(DefaultConnectionIdentifier, DBVendor)</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> A few items to note: </div>
      <ol>
        <li> The <tt>name</tt> parameter for newConnection can be
          used if you need to have connections to multiple distinct databases.
          One specialized case of this is when you’re doing DB sharding
          (horizontal scaling). Multiple database usage is covered in more depth
          in Розділ <a  href="#sub:Multiple-Databases"  class="Reference">8.3.1↓</a> </li>
        <li> The newConnection method needs to return a
          <tt>Box[java.sql.Connection]</tt>. Returning
          <tt>Empty</tt> indicates failure </li>
        <li> The releaseConnection method exists so that you have complete
          control over the lifecycle of the connection. For instance, if you
          were doing connection pooling yourself you would return the connection
          to the available pool rather than closing it </li>
        <li> The <tt>DB.defineConnectionManager</tt> call is what
          binds our manager into Mapper. Without it your manager will never get
          called </li>
      </ol>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.3"  class="toc">8.1.3</a> 
        Constructing a Mapper-enabled Class<a  name="sub:Constructing-a-Mapper-enabled-class"
 class="Label"> </a> </h3>
      <div  class="Unindented"> Now that we’ve covered some basic background, we
        can start constructing some Mapper classes to get more familiar with the
        framework. We’ll start with a simple example of a class for an expense
        transaction from our PocketChange application with the following fields:
      </div>
      <ul>
        <li> Date </li>
        <li> Description: a string with a max length of 100 chars </li>
        <li> Amount: a decimal value with a precision of 16 digits and two
          decimal places </li>
        <li> A reference to the Account that owns the transaction </li>
      </ul>
      <div  class="Unindented"> Given these requirements we can declare our
        <tt>Expense</tt> class as shown in Listing <a  href="#lst:Entry-class-mapper"
 class="Reference">8.1.3↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Expense Class in Mapper<a  name="lst:Entry-class-mapper"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_572931">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.math.MathContext</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LongKeyedMapper[Expense] </code><code  class="scala keyword">with</code> <code
 class="scala plain">IdPK {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">getSingleton </code><code
 class="scala keyword">=</code> <code  class="scala plain">Expense</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">dateOf </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedDateTime(</code><code
 class="scala keyword">this</code><code  class="scala plain">)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">description </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedString(</code><code
 class="scala keyword">this</code><code  class="scala plain">,</code><code  class="scala value">100</code><code
 class="scala plain">)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">amount </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedDecimal(</code><code
 class="scala keyword">this</code><code  class="scala plain">, MathContext.DECIMAL</code><code
 class="scala value">64</code><code  class="scala plain">, </code><code  class="scala value">2</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">account </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedLongForeignKey(</code><code
 class="scala keyword">this</code><code  class="scala plain">, Account)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> For comparison, the Record version is shown in
        Listing <a  href="#lst:Entry-class-record"  class="Reference">8.1.3↓</a>. This example already shows some
        functionality that hasn’t been ported over to Record from Mapper; among
        other things, the <tt>IdPK</tt> trait, and foreign key
        fields (many to one mappings) are missing. The other minor differences
        are that the <tt>getSingleton</tt> method has been renamed
        to <tt>meta</tt>, and the Field traits use different names
        under the Record framework (i.e. <tt>DateTimeField</tt> vs
        <tt>MappedDateTime</tt>). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Entry Class in Record<a  name="lst:Entry-class-record"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_927002">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.math.MathContext</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.record.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">KeyedRecord[Expense,Long] {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">meta </code><code  class="scala keyword">=</code> <code
 class="scala plain">Expense</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">primaryKey </code><code
 class="scala keyword">=</code> <code  class="scala plain">id</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">id </code><code
 class="scala keyword">extends</code> <code  class="scala plain">LongField(</code><code
 class="scala keyword">this</code><code  class="scala plain">) </code><code  class="scala keyword">with</code> <code
 class="scala plain">KeyField[Long,Expense]</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">dateOf </code><code
 class="scala keyword">extends</code> <code  class="scala plain">DateTimeField(</code><code
 class="scala keyword">this</code><code  class="scala plain">)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">description </code><code
 class="scala keyword">extends</code> <code  class="scala plain">StringField(</code><code
 class="scala keyword">this</code><code  class="scala plain">, </code><code  class="scala value">100</code><code
 class="scala plain">)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">amount </code><code
 class="scala keyword">extends</code> <code  class="scala plain">DecimalField(</code><code
 class="scala keyword">this</code><code  class="scala plain">, MathContext.DECIMAL</code><code
 class="scala value">64</code><code  class="scala plain">, </code><code  class="scala value">2</code><code
 class="scala plain">)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">account </code><code
 class="scala keyword">extends</code> <code  class="scala plain">LongField(</code><code
 class="scala keyword">this</code><code  class="scala plain">)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see, we’ve set
        <tt>Expense</tt> to extend the
        <tt>LongKeyedMapper</tt> and <tt>IdPK</tt>
        traits and we’ve added the fields required by our class. We would like
        to provide a primary key for our entity; while not strictly necessary,
        having a synthetic primary key often helps with CRUD operations. The
        <tt>LongKeyedMapper</tt> trait accomplishes two objectives:
        it tells Lift that we want a primary key defined and that the key should
        be a long. This is basically a shortcut for using the
        <tt>KeyedMapper[Long,Expense]</tt><a  href="#index-KeyedMapper"  name="entry-KeyedMapper-0"
 class="IndexReference">↓</a> trait. When
        you use the <tt>KeyedMapper</tt> trait you need to provide
        an implementation for the <tt>primaryKeyField</tt> def,
        which must match the type of the <tt>KeyedMapper</tt> trait
        and be a subtype of <tt>IndexedField</tt><a  href="#index-IndexedField"
 name="entry-IndexedField-0"  class="IndexReference">↓</a>. The
        <tt>IdPK</tt> trait handles the implementation, but note
        that <tt>IdPK</tt> currently only supports
        <tt>Long</tt> keys. Mapper supports both indexed
        <tt>Longs</tt> and <tt>Strings</tt>, so if you
        want <tt>Strings</tt> you’ll need to explicitly use
        <tt>KeyedMapper[String,...]</tt> and provide the field
        definition yourself. It’s possible to use some other type for your
        primary key, but you’ll need to roll your own (Розділ <a  href="#sub:Defining-Custom-Field-types-mapper"
 class="Reference">8.2.7↓</a>). Technically <tt>Int</tt>
        indexes are supported as well, but there is no corresponding trait for
        an <tt>Int</tt> foreign key. That means that if you use an
        <tt>Int</tt> for the primary key, you may not be able to add
        a relationship to another object (Розділ <a  href="#sub:Object-Relationships"
 class="Reference">8.1.4↓</a>), unless you write your own. Record is a
        little more flexible in primary key selection because it uses, in
        effect, a marker trait (<tt>KeyField</tt>) to indicate that
        a particular field is a key field. One thing to note is that in the
        Mapper framework, the table name<a  href="#index-table-name"  name="entry-table-name-0"
 class="IndexReference">↓</a> for your
        entity defaults to the name of the class (Expense, in our case). If you
        want to change this, then you just need to override the
        <tt>dbTableName</tt><a  href="#index-dbTableName"  name="entry-dbTableName-0"
 class="IndexReference">↓</a> def in your
        MetaMapper object. </div>
      <div  class="Indented"> Looking at these examples, you’ve probably noticed
        that the fields are defined as objects rather than instance members
        (vars). The basic reason for this is that the MetaMapper needs access to
        fields for its validation and form functionality; it is more difficult
        to cleanly define these properties in the MetaMapper if it had to access
        member vars on each instance since a MetaMapper instance is itself an
        object. Also note that <tt>MappedDecimal</tt> is a custom
        field type<span  class="FootOuter"><span  class="SupFootMarker"> [C] </span><span
 class="HoverFoot"><span  class="SupFootMarker">  [C] </span>The
            authors are working on adding this to the core library soon after
            Lift 1.0</span></span>, which we’ll cover in Розділ <a  href="#sub:Defining-Custom-Field-types-mapper"
 class="Reference">8.2.7↓</a>. </div>
      <div  class="Indented"> In order to tie all of this together, we need to
        define a matching <tt>LongKeyedMetaMapper</tt><a  href="#index-KeyedMetaMapper"
 name="entry-KeyedMetaMapper-0"  class="IndexReference">↓</a> object
        as the singleton for our entity, as shown in Listing <a  href="#lst:EntryMeta-object"
 class="Reference">8.1.3↓</a>. The Meta object (whether MetaMapper or
        MetaRecord) is where you define most behavior that is common across all
        of your instances. In our examples, we’ve decided to name the meta
        object and instance class the same. We don’t feel that this is unclear
        because the two together are what really define the ORM behavior for a
        “type.” </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> EntryMeta object<a  name="lst:EntryMeta-object"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_2832">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">with</code> <code
 class="scala plain">LongKeyedMetaMapper[Expense] {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">fieldOrder </code><code  class="scala keyword">=</code> <code
 class="scala plain">List(dateOf, description, amount)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In this instance, we’re simply defining the order
        of fields as they’ll be displayed in XHTML<a  href="#index-XHTML"  name="entry-XHTML-1"
 class="IndexReference">↓</a> and forms<a  href="#index-form"  name="entry-form-0"
 class="IndexReference">↓</a> by overriding the
        <tt>fieldOrder</tt> method. The default behavior is an empty
        list, which means no fields are involved in display or form generation.
        Generally, you will want to override <tt>fieldOrder</tt>
        because this is not very useful. If you don’t want a particular field to
        show up in forms or XHTML output, simply omit it from the fieldOrder<a  href="#index-fieldOrder"
 name="entry-fieldOrder-0"  class="IndexReference">↓</a> list. </div>
      <div  class="Indented"> Because fields aren’t actually instance members,
        operations on them are slightly different than with a regular var. The
        biggest difference is how we set fields: we use the apply method. In
        addition, field access can be chained so that you can set multiple field
        values in one statement, as shown in Listing <a  href="#lst:Setting-field-values"
 class="Reference">8.1.3↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Setting Field Values<a  name="lst:Setting-field-values"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_151498">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">myEntry.dateOf(</code><code
 class="scala keyword">new</code> <code  class="scala plain">Date).description(</code><code
 class="scala string">"A sample entry"</code><code  class="scala plain">)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">myEntry.amount(BigDecimal(</code><code
 class="scala string">"127.20"</code><code  class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The underlying value of a given field can be
        retrieved with the <tt>is</tt> method (the
        <tt>value</tt> method in Record) as shown in Listing <a  href="#lst:Accessing-field-values"
 class="Reference">8.1.3↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Accessing Field Values in Record<a  name="lst:Accessing-field-values"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_352103">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// mapper</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">tenthOfAmount </code><code  class="scala keyword">=</code> <code
 class="scala plain">myEntry.amount.is / </code><code  class="scala value">10</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">formatted </code><code  class="scala keyword">=</code> <code
 class="scala plain">String.format(</code><code  class="scala string">"%s : %s"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                              </code><code
 class="scala plain">myEntry.description.is,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">                              </code><code
 class="scala plain">myEntry.amount.is.toString)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala comments">// record</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">if</code> <code
 class="scala plain">(myEntry.description.value </code><code  class="scala keyword">==</code> <code
 class="scala string">"Doughnuts"</code><code  class="scala plain">) {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">println(</code><code  class="scala string">"Diet ruined!"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.4"  class="toc">8.1.4</a> 
        Object Relationships<a  name="sub:Object-Relationships"  class="Label">
        </a> </h3>
      <div  class="Unindented"> Often it’s appropriate to have relationships
        between different entities. The archetypical example of this is the
        parent-child relationship. In SQL, a relationship can be defined with a
        foreign key that associates one table to another based on the primary
        key of the associated table. As we showed in Listing <a  href="#lst:Entry-class-mapper"
 class="Reference">8.1.3↑</a>, there is a corresponding
        <tt>MappedForeignKey</tt> trait, with concrete
        implementations for Long and String foreign keys. Once we have this
        defined, accessing the object via the relationship is achieved by using
        the <tt>obj</tt> method on the foreign key field. Note that
        the <tt>obj</tt> method returns a <tt>Box</tt>,
        so you need to do some further processing with it before you can use it.
        With the foreign key functionality you can easily do one-to-many and
        many-to-one<a  href="#index-many-to-one"  name="entry-many-to-one-0"  class="IndexReference">↓</a>
        relationships (depending on where you put the foreign key). One-to-many<a
 href="#index-one-to-many"  name="entry-one-to-many-0"  class="IndexReference">↓</a>
        relationships can be achieved using helper methods on the “one” side
        that delegate to queries. We’ll cover queries in a moment, but Listing <a
 href="#lst:Accessing-Foreign-Objects"  class="Reference">8.1.4↓</a> shows examples of two sides of the same
        relationship. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Accessing Foreign Objects<a  name="lst:Accessing-Foreign-Objects"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_342619">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LongKeyedMapper[Expense] </code><code  class="scala keyword">with</code> <code
 class="scala plain">IdPK {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">account </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedLongForeignKey(</code><code
 class="scala keyword">this</code><code  class="scala plain">, Account)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">accountName </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Text(</code><code  class="scala string">"My account is "</code> <code
 class="scala plain">+ (account.obj.map(</code><code  class="scala keyword">_</code><code
 class="scala plain">.name.is) openOr </code><code  class="scala string">"Unknown"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">Account ... {</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">entries </code><code
 class="scala keyword">=</code> <code  class="scala plain">Expense.findAll(By(Expense.account, </code><code
 class="scala keyword">this</code><code  class="scala plain">.id))</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> If you want to do many-to-many<a  href="#index-many-to-many"
 name="entry-many-to-many-0"  class="IndexReference">↓</a> mappings
        you’ll need to provide your own “join” class with foreign keys to both
        of your mapped entities. An example would be if we wanted to have tags
        (categories) for our ledger entries and wanted to be able to have a
        given entry have multiple tags (e.g., you purchase a book for your
        mother’s birthday, so it has the tags Gift, Mom, and Books). First we
        define the <tt>Tag</tt> entity, as shown in Listing<a  href="#lst:Tag-Entity"
 class="Reference">8.1.4↓</a> . </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Tag Entity<a  name="lst:Tag-Entity"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_275675">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Tag </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LongKeyedMapper[Tag] </code><code  class="scala keyword">with</code> <code
 class="scala plain">IdPK {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">getSingleton </code><code
 class="scala keyword">=</code> <code  class="scala plain">Tag</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">name </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedString(</code><code
 class="scala keyword">this</code><code  class="scala plain">,</code><code  class="scala value">100</code><code
 class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">Tag </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Tag </code><code  class="scala keyword">with</code> <code  class="scala plain">LongKeyedMetaMapper[Tag] {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">fieldOrder </code><code  class="scala keyword">=</code> <code
 class="scala plain">List(name)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Next, we define our join entity, as shown in
        Listing <a  href="#lst:Join-Entity"  class="Reference">8.1.4↓</a>. It’s a
        <tt>LongKeyedMapper</tt> just like the rest of the entities,
        but it only contains foreign key fields to the other entities. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Join Entity<a  name="lst:Join-Entity"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_339322">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">ExpenseTag </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LongKeyedMapper[ExpenseTag] </code><code  class="scala keyword">with</code> <code
 class="scala plain">IdPK {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">getSingleton </code><code
 class="scala keyword">=</code> <code  class="scala plain">ExpenseTag</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">tag </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedLongForeignKey(</code><code
 class="scala keyword">this</code><code  class="scala plain">,Tag)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">expense </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedLongForeignKey(</code><code
 class="scala keyword">this</code><code  class="scala plain">,Expense)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">ExpenseTag </code><code  class="scala keyword">extends</code> <code
 class="scala plain">ExpenseTag </code><code  class="scala keyword">with</code> <code
 class="scala plain">LongKeyedMetaMapper[ExpenseTag] {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">join (tag </code><code
 class="scala keyword">:</code> <code  class="scala plain">Tag, tx </code><code
 class="scala keyword">:</code> <code  class="scala plain">Expense) </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">this</code><code  class="scala plain">.create.tag(tag).expense(tx).save</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> To use the join entity, you’ll need to create a
        new instance and set the appropriate foreign keys to point to the
        associated instances. As you can see, we’ve defined a convenience method
        on our <tt>Expense</tt> meta object to do just that. To make
        the many-to-many<a  href="#index-many-to-many"  name="entry-many-to-many-1"
 class="IndexReference">↓</a> accessible
        as a field on our entities, we can use the HasManyThrough trait, as
        shown in Listing <a  href="#lst:HasManyThrough-for-Many-to-Many"  class="Reference">8.1.4↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> HasManyThrough for Many-to-Many Relationships<a
 name="lst:HasManyThrough-for-Many-to-Many"  class="Label"> </a>
          </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_829592">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Expense ... {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">tags </code><code
 class="scala keyword">extends</code> <code  class="scala plain">HasManyThrough(</code><code
 class="scala keyword">this</code><code  class="scala plain">, Tag, </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">ExpenseTag, ExpenseTag.tag, ExpenseTag.expense)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> A similar field could be set up on the
        <tt>Tag</tt> entity to point to entries. It’s important to
        note a few items: </div>
      <ul>
        <li> The only way to add new entries is to directly construct the
          ExpenseTag instances and save them (either directly or via a helper
          method). You can’t make any modifications via the HasManyThrough trait
        </li>
        <li> Although the field is defined as a query, the field is actually
          lazy and only runs once. That means if you query it and then add some
          new ExpenseTag instances, they won’t show up in the field contents </li>
      </ul>
      <div  class="Unindented"> If you want a way to retrieve the joined results
        such that it pulls fresh from the database each time, you can instead
        define a helper join method as shown in Розділ<a  href="#sub:helper-joins"
 class="Reference">8.1.11 on page 1↓</a>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.5"  class="toc">8.1.5</a> 
        Indexing </h3>
      <div  class="Unindented"> It’s often helpful to add indexes to a database
        to improve performance. Mapper makes it easy to do most simple indexing
        simply by overriding the <tt>dbIndexed_?</tt> <a  href="#index-dbIndexed_?"
 name="entry-dbIndexed_?-0"  class="IndexReference">↓</a> def on the
        field. Listing <a  href="#lst:Indexing-a-field"  class="Reference">8.1.5↓</a> shows how we would add an index to our
        <tt>Expense.account</tt> field. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Indexing a Field<a  name="lst:Indexing-a-field"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_598223">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Expense ... {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">account </code><code
 class="scala keyword">extends</code> <code  class="scala plain">... {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">dbIndexed</code><code  class="scala keyword">_</code><code
 class="scala plain">? </code><code  class="scala keyword">=</code> <code  class="scala keyword">true</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Mapper provides for more complex indexing via the
        <tt>MetaMapper.dbIndexes</tt> def combined with the
        <tt>Index</tt>, <tt>IndexField</tt> and
        <tt>BoundedIndexField</tt> case classes. Listing <a  href="#lst:More-complex-indices"
 class="Reference">8.1.5↓</a> shows some examples of how we might
        create more complex indices. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> More Complex Indices<a  name="lst:More-complex-indices"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_149719">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">... {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// equivalent to the previous listing</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala plain">dbIndexes </code><code
 class="scala keyword">=</code> <code  class="scala plain">Index(IndexField(account)) </code><code
 class="scala keyword">::</code> <code  class="scala plain">Nil</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// equivalent to "create index ... on transaction_t (account, description(10))"</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala plain">dbIndexes </code><code
 class="scala keyword">=</code> <code  class="scala plain">Index(IndexField(account), </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">                             </code><code
 class="scala plain">BoundedIndexField(description,</code><code  class="scala value">10</code><code
 class="scala plain">))</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.6"  class="toc">8.1.6</a> 
        Schema Mapping<a  name="sub:Schema-Mapping"  class="Label"> </a> </h3>
      <div  class="Unindented"> The Mapper framework makes it easy not only to
        define domain objects, but also to create the database schema to go
        along with those objects. The <tt>Schemifier</tt><a  href="#index-Schemifier"
 name="entry-Schemifier-0"  class="IndexReference">↓</a> object is
        what does all of the work for you: you simply pass in the
        <tt>MetaMapper</tt> objects that you want the schema created
        for and it does the rest. Listing <a  href="#lst:Using-Schemifier"  class="Reference">8.1.6↓</a> shows how we could use
        <tt>Schemifier</tt> to set up the database for our example
        objects. The first argument controls whether an actual write will be
        performed on the database. If false, <tt>Schemifier</tt>
        will log all of the DDL statements that it would like to apply, but no
        changes will be made to the database. The second argument is a logging
        function (logging is covered in Appendix <a  href="#cha:Logging-in-Lift"
 class="Reference">E↓</a>). The remaining arguments are the
        <tt>MetaMapper</tt> objects that you would like to have
        schemified. You need to be careful to remember to include all of the
        objects, otherwise the tables won’t be created. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using Schemifier<a  name="lst:Using-Schemifier"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_327337">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">Schemifier.schemify(</code><code
 class="scala keyword">true</code><code  class="scala plain">, Log.infoF </code><code
 class="scala keyword">_</code><code  class="scala plain">, User, Expense, Account, Tag, ExpenseTag)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As we mentioned in Розділ <a  href="#sub:Constructing-a-Mapper-enabled-class"
 class="Reference">8.1.3↑</a>, you can override the default table name
        for a given Mapper class via the <tt>dbTableName</tt> def in
        the corresponding MetaMapper. The default table name is the name of the
        Mapper class, except when the class name is also an SQL reserved word;
        in this case, a “_t” is appended to the table name. You can also
        override individual column names on a per-field basis by overriding the
        <tt>dbColumnName</tt><a  href="#index-dbColumnName"  name="entry-dbColumnName-0"
 class="IndexReference">↓</a> def in the
        field itself. Like tables, the default column name for a field will be
        the same as the field name as long as it’s not an SQL reserved word; in
        this case a “_c” is appended to the column name. Listing <a  href="#lst:Custom-column-name"
 class="Reference">8.1.6↓</a> shows how we could make our
        <tt>ExpenseTag.expense</tt> field map to “expense_id”. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Setting a Custom Column Name<a  name="lst:Custom-column-name"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_828905">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">ExpenseTag ... {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">expense </code><code
 class="scala keyword">extends</code> <code  class="scala plain">... {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">dbColumnName </code><code  class="scala keyword">=</code> <code
 class="scala string">"expense_id"</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.7"  class="toc">8.1.7</a> 
        Persistence Operations on an Entity<a  name="sub:Persistence-Operations-on-entity"
 class="Label"> </a> </h3>
      <div  class="Unindented"> Now that we’ve defined our entity we probably
        want to use it in the real world to load and store data. There are
        several operations on <tt>MetaMapper</tt> that we can use :
      </div>
      <div  class="Description"> <span  class="Description-entry">create</span> 
        Creates a new instance of the entity </div>
      <div  class="Description"> <span  class="Description-entry">save</span> 
        Saves an instance to the database. </div>
      <div  class="Description"> <span  class="Description-entry">delete</span> 
        Deletes the given entity instance </div>
      <div  class="Description"> <span  class="Description-entry">count</span> 
        Returns the number of instances of the given entity. An optional query
        criteria list can be used to narrow the entities being counted </div>
      <div  class="Description"> <span  class="Description-entry">countByInsecureSQL</span> 
        Similar to count, except a raw SQL string can be used to perform the
        count. The count value is expected to be in the first column and row of
        the returned result set. An example would be </div>
      <ul>
        <li  class="nested">
          <pre  class="LyX-Code">Expense.countByInsecureSQL(“select count(amount) “ +
  “from Expense where amount > 20”, ...)
</pre>
          <div  class="Unindented"> We’ll cover the
            <tt>IHaveValidatedThisSQL</tt> parameter in a moment. </div>
        </li>
      </ul>
      <div  class="Unindented"> There are also quite a few methods available for
        retrieving instances from the database. Each of these methods comes in
        two varieties: one that uses the default database connection, and one
        that allows you to specify the connection<a  href="#index-Mapper-multiple-databases"
 name="entry-Mapper-multiple-databases-0"  class="IndexReference">↓</a>
        to use (Розділ <a  href="#lst:Multi-database-Connection-Manager"  class="Reference">8.3.1 on page 1↓</a>). The latter typically has
        “DB” appended to the method name. The query methods on
        <tt>MetaMapper</tt> are: </div>
      <div  class="Description"> <span  class="Description-entry">findAll</span> 
        Retrieves a list of instances from the database. The method is
        overloaded to take an optional set of query criteria parameters; these
        will be covered in detail in their own section, <a  href="#sub:Querying-for-Entities"
 class="Reference">8.1.8↓</a>. </div>
      <div  class="Description"> <span  class="Description-entry">findAllByInsecureSQL</span> 
        Retrieves a list of instances based on a raw SQL query. The query needs
        to return columns for all mapped fields. Usually you can use the
        <tt>BySQL</tt> QueryParameter to cover most of the same
        functionality. </div>
      <div  class="Description"> <span  class="Description-entry">findAllByPreparedStatement</span> 
        Similar to <tt>findAllByInsecureSQL</tt> except that
        prepared statements are used, which usually means that the driver will
        handle properly escaping arguments in the query string. </div>
      <div  class="Description"> <span  class="Description-entry">findAllFields</span> 
        This allows you to do a normal query returning only certain fields from
        your Mapper instance. For example, if you only wanted the amount from
        the transaction table you would use this method. Note that any fields
        that aren’t specified in the query will return their default value.
        Generally, this method is only useful for read access to data because
        saving any retrieved instances could overwrite real data. </div>
      <div  class="Description"> <span  class="Description-entry">findMap*</span> 
        These methods provide the same functionality as the non-Map methods, but
        take an extra function argument that transforms an entity into a
        <tt>Box[T]</tt>, where <tt>T</tt> is an
        arbitrary type. An example would be getting a list of descriptions of
        our transactions: </div>
      <ul>
        <li  class="nested">
          <pre  class="LyX-Code">Expense.findMap(entry => Full(entry.description.is))
</pre> </li>
      </ul>
      <div  class="Unindented"> The <tt>KeyedMapperClass</tt> adds
        the <tt>find</tt> method, which can be used to locate a
        single entity based on its primary key. In general these operations will
        be supported in both Record and Mapper. However, because Record isn’t
        coupled tightly to a JDBC backend some of the find methods may not be
        supported directly and there may be additional methods not available in
        Mapper for persistence. For this reason, this section will deal
        specifically with Mapper’s persistence operations. </div>
      <h4  class="Subsubsection-"> <a  name="toc-Subsubsection--1"  class="toc"></a>Creating
        an Instance </h4>
      <div  class="Unindented"> Once we have a <tt>MetaMapper</tt>
        object defined we can use it to create objects using the
        <tt>create<a  href="#index-create"  name="entry-create-0"  class="IndexReference">↓</a></tt>
        method. You generally don’t want to use the “new” operator because the
        framework has to set up internal data for the instance such as field
        owner, etc. This is important to remember, since nothing will prevent
        you from creating an instance manually: you may just get errors when you
        go to use the instance. The <tt>join</tt> method in Listing
        <a  href="#lst:Join-Entity"  class="Reference">8.1.4↑</a> shows an example of create usage. </div>
      <h4  class="Subsubsection-"> <a  name="toc-Subsubsection--2"  class="toc"></a>Saving
        an Instance </h4>
      <div  class="Unindented"> Saving an instance is as easy as calling the
        <tt>save</tt> method on the instance you want to save.
        Optionally, you can call the <tt>save</tt> method on the
        Meta object, passing in the instance you want to save. The
        <tt>save</tt> method uses the the
        <tt>saved_?</tt> and <tt>clean_?</tt> flags to
        determine whether an insert or update is required to persist the current
        state to the database, and returns a boolean to indicate whether the
        save was successful or not. The <tt>join</tt> method in
        Listing <a  href="#lst:Join-Entity"  class="Reference">8.1.4↑</a> shows an example of
        <tt>save</tt> usage. </div>
      <h4  class="Subsubsection-"> <a  name="toc-Subsubsection--3"  class="toc"></a>Deleting
        an Instance<a  name="sub:Deleting-an-Instance"  class="Label"> </a> </h4>
      <div  class="Unindented"> There are several ways to delete instances. The
        simplest way is to call the <tt>delete_!</tt> method on the
        instance you’d like to remove. An alternative is to call the
        <tt>delete_!</tt> method on the Meta object, passing in the
        instance to delete. In either case, the <tt>delete_!</tt>
        method returns a boolean indicating whether the delete was successful or
        not. Listing <a  href="#lst:Example-deletion"  class="Reference">3 on page 1↓</a> shows an example of deleting
        instances. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Example Deletion<a  name="lst:Example-deletion"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_214707">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">if</code> <code
 class="scala plain">(! myExpense.delete</code><code  class="scala keyword">_</code><code
 class="scala plain">!) S.error(</code><code  class="scala string">"Couldn’t delete the expense!"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala comments">//or</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">if</code> <code
 class="scala plain">(! (Expense delete</code><code  class="scala keyword">_</code><code
 class="scala plain">! myExpense)) S.error(...)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Another approach to deleting entities is to use
        the <tt>bulkDelete_!!</tt> method on
        <tt>MetaMapper</tt>. This method allows you to specify query
        parameters to control which entities are deleted. We will cover query
        parameters in Розділ <a  href="#sub:Querying-for-Entities"  class="Reference">8.1.8↓</a> (an example is in Listing <a
 href="#lst:Bulk-Deletion"  class="Reference">8.1.9 on page 1↓</a>). </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.8"  class="toc">8.1.8</a> 
        Querying for Entities<a  name="sub:Querying-for-Entities"  class="Label">
        </a> </h3>
      <div  class="Unindented"> There are a variety of methods on
        <tt>MetaMapper</tt> for querying for instances of a given
        entity. The simplest method is <tt>findAll</tt><a  href="#index-findAll"
 name="entry-findAll-0"  class="IndexReference">↓</a> called with no
        parameters. The “bare” <tt>findAll</tt> returns a
        <tt>List</tt> of all of the instances of a given entity
        loaded from the database. Note that each <tt>findAll...</tt>
        method has a corresponding method that takes a database connection for
        sharding or multiple database usage (see sharding in Розділ <a  href="#sub:Multiple-Databases"
 class="Reference">8.3.1↓</a>). Of course, for all but the smallest
        datasets, pulling the entire model to get one entity from the database
        is inefficient and slow. Instead, the <tt>MetaMapper</tt>
        provides “flag” objects to control the query. </div>
      <div  class="Indented"> The ability to use fine-grained queries to select
        data is a fundamental feature of relational databases, and Mapper
        provides first-class support for constructing queries in a manner that
        is not only easy to use, but type-safe. This means that you can catch
        query errors at compile time instead of runtime. The basis for this
        functionality is the <tt>QueryParam</tt> trait, which has
        several concrete implementations that are used to construct the actual
        query. The <tt>QueryParam</tt> implementations can be broken
        up into two main groups: </div>
      <ol>
        <li> Comparison - These are typically items that would go in the where
          clause of an SQL query. They are used to refine the set of instances
          that will be returned </li>
        <li> Control - These are items that control things like sort order and
          pagination of the results </li>
      </ol>
      <div  class="Unindented"> Although Mapper provides a large amount of the
        functionality in SQL, some features are not covered directly or at all.
        In some cases we can define helper methods to make querying easier,
        particularly for joins (Розділ <a  href="#sub:helper-joins"  class="Reference">8.1.11↓</a>). </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.9"  class="toc">8.1.9</a> 
        Comparison QueryParams </h3>
      <div  class="Unindented"> The simplest <tt>QueryParam</tt> to
        refine your query is the <tt>By</tt><a  href="#index-By"  name="entry-By-0"
 class="IndexReference">↓</a> object and its
        related objects. <tt>By</tt> is used for a direct value
        comparison of a given field: essentially an “=” in SQL. For instance,
        Listing <a  href="#lst:Retrieving-by-account"  class="Reference">8.1.9↓</a> shows how we can get all of the expenses
        for a given account. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Retrieving by Account ID<a  name="lst:Retrieving-by-account"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_384817">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">myEntries </code><code  class="scala keyword">=</code> <code
 class="scala plain">Expense.findAll(By(Expense.account, myAccount.id))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that our By criterion is comparing the
        <tt>Expense.account</tt> field to the primary key
        (<tt>id</tt> field) of our account instead of to the account
        instance itself. This is because the
        <tt>Expense.account</tt> field is a
        <tt>MappedForeignKey</tt> field, which uses the type of the
        key instead of the type of the entity as its underlying value. In this
        instance, that means that any queries using
        <tt>Expense.account</tt> need to use a
        <tt>Long</tt> to match the underlying type. Besides
        <tt>By</tt>, the other basic clauses are: </div>
      <ul>
        <li> <tt>NotBy</tt><a  href="#index-NotBy"  name="entry-NotBy-0"  class="IndexReference">↓</a> - Selects
          entities whose queried field is not equal to the given value </li>
        <li> <tt>By_></tt><a  href="#index-By_%3E"  name="entry-By_>-0"  class="IndexReference">↓</a>- Selects
          entities whose queried field is larger than the given value </li>
        <li> <tt>By_<</tt><a  href="#index-By_%3C"  name="entry-By_<-0"  class="IndexReference">↓</a>- Selects
          entities whose queried field is less than the given value </li>
        <li> <tt>ByList</tt><a  href="#index-ByList"  name="entry-ByList-0"  class="IndexReference">↓</a> - Selects
          entities whose queried field is equal to one of the values in the
          given List. This corresponds to the “field IN (x,y,z)” syntax in SQL.
        </li>
        <li> <tt>NullRef</tt><a  href="#index-NullRef"  name="entry-NullRef-0"  class="IndexReference">↓</a> - Selects
          entities whose queried field is NULL </li>
        <li> <tt>NotNullRef</tt><a  href="#index-NotNullRef"  name="entry-NotNullRef-0"
 class="IndexReference">↓</a> - Select
          entities whose queried field is not NULL </li>
        <li> <tt>Like</tt><a  href="#index-Like"  name="entry-Like-0"  class="IndexReference">↓</a> - Select entities
          whose queried field is like the given string. As in SQL, the percent
          sign is used as a wildcard </li>
      </ul>
      <div  class="Unindented"> In addition to the basic clauses there are some
        slightly more complex ways to control the query. The first of these is
        <tt>ByRef</tt><a  href="#index-ByRef"  name="entry-ByRef-0"  class="IndexReference">↓</a>, which selects
        entities whose queried field is equal to the value of another query
        field <i>on the same entity</i>. A contrived example would be if we
        define a tree structure in our table and root nodes are marked as having
        themselves as parents: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> An Example of ByRef<a  name="lst:An-example-of-byref"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_208639">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// select all root nodes from the forest</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">TreeNode.findAll(ByRef(TreeNode.parent,TreeNode.id))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The related <tt>NotByRef</tt> tests
        for inequality between two query fields. </div>
      <div  class="Indented"> Getting slightly more complex, we come to the
        <tt>In</tt><a  href="#index-In"  name="entry-In-0"  class="IndexReference">↓</a>
        <tt>QueryParameter</tt>, which is used just like an “IN”
        clause with a subselect in an SQL statement. For example, let’s say we
        wanted to get all of the entries that belong to tags that start with the
        letter “c”. Listing <a  href="#lst:Using-In"  class="Reference">8.1.9↓</a> shows the full breakdown. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using In<a  name="lst:Using-In"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_766489">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">cExpenses </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">ExpenseTag.findAll(</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">In(ExpenseTag.tag,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">       </code><code
 class="scala plain">Tag.id,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">       </code><code
 class="scala plain">Like(Tag.name, </code><code  class="scala string">"c%"</code><code
 class="scala plain">))).map(</code><code  class="scala keyword">_</code><code  class="scala plain">.expense.obj.open</code><code
 class="scala keyword">_</code><code  class="scala plain">!).removeDuplicates</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that we use the
        <tt>List.removeDuplicates</tt> method to make sure that the
        List contains unique entities. This requires overriding the
        <tt>equals</tt> and <tt>hashCode</tt> methods on
        the Expense class, which we show in Listing <a  href="#lst:Overriding-equalshash-expense"
 class="Reference">8.1.9↓</a>. In our example we’re using the primary
        key (<tt>id</tt> field) to define object “identity”. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Overriding <tt>equals</tt> and
            <tt>hashcode</tt> on the Expense entity<a  name="lst:Overriding-equalshash-expense"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_682640">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Expense ... {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">equals (other </code><code  class="scala keyword">:</code> <code
 class="scala plain">Any) </code><code  class="scala keyword">=</code> <code  class="scala plain">other </code><code
 class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">e </code><code  class="scala keyword">:</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">if</code> <code
 class="scala plain">e.id.is </code><code  class="scala keyword">==</code> <code
 class="scala keyword">this</code><code  class="scala plain">.id.is </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code><code  class="scala keyword">true</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala keyword">false</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">hashCode </code><code  class="scala keyword">=</code> <code
 class="scala keyword">this</code><code  class="scala plain">.id.is.hashCode</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> We use the <tt>ByRef</tt> params to do
        the join between the many-to-many entity on the query. Related to
        <tt>In</tt> is <tt>InRaw</tt><a  href="#index-InRaw"  name="entry-InRaw-0"
 class="IndexReference">↓</a>, which allows you
        to specify your own SQL subquery for the “IN” portion of the where
        clause. Listing <a  href="#lst:Using-InRaw"  class="Reference">8.1.9↓</a> shows an example of how we could use
        <tt>InRaw</tt> to find <tt>Tags</tt> for expense
        entries made in the last 30 days. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using InRaw<a  name="lst:Using-InRaw"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_73874">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">recentTags </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">joins </code><code
 class="scala keyword">=</code> <code  class="scala plain">ExpenseTag.findAll(</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">InRaw(ExpenseTag.expense,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">          </code><code
 class="scala string">"select id from Expense where dateOf > (CURRENT_DATE - interval ’30 days’)"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">IHaveValidatedThisSQL(</code><code  class="scala string">"dchenbecker"</code><code
 class="scala plain">, </code><code  class="scala string">"2008-12-03"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">joins.map(</code><code  class="scala keyword">_</code><code
 class="scala plain">.expense.obj.open</code><code  class="scala keyword">_</code><code
 class="scala plain">!).removeDuplicates</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Here things are starting to get a little hairy.
        The <tt>InRaw</tt> only allows us to specify the subquery
        for the IN clause, so we have to do some postprocessing to get unique
        results. If you want to do this in the query itself you’ll have to use
        the <tt>findAllByInsecureSql</tt> or
        <tt>findAllByPreparedStatement</tt> methods, which are
        covered later in this section on page number <a  href="#sub:SQL-based-queries"
 class="Reference">1↓</a>. The final parameter for
        <tt>InRaw</tt>, <tt>IHaveValidatedThisSQL</tt>
        acts as a code audit mechanism that says that someone has checked the
        SQL to make sure it’s safe to use. The query fragment is added to the
        master query as-is: no escaping or other filtering is performed on the
        string. That means that if you take user input. then you need to be very
        careful about it or you run the risk of an SQL injection attack on your
        site. </div>
      <div  class="Indented"> The next <tt>QueryParam</tt> we’ll
        cover is <tt>BySql</tt>, which lets you use a complete SQL
        fragment that gets put into the where clause. An example of this would
        be if we want to find all expense entries within the last 30 days, as
        shown in Listing <a  href="#lst:Using-BySql"  class="Reference">8.1.9↓</a>. Again, the
        <tt>IHaveValidatedThisSQL</tt><a  href="#index-IHaveValidatedThisSQL"  name="entry-IHaveValidatedThisSQL-0"
 class="IndexReference">↓</a>
        case class is required as a code audit mechanism to make sure someone
        has verified that the SQL used is safe. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using BySql<a  name="lst:Using-BySql"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_24209">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">recentEntries </code><code  class="scala keyword">=</code> <code
 class="scala plain">Expense.findAll(</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">BySql(</code><code  class="scala string">"dateOf > (CURRENT_DATE - interval ’30 days’)"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">IHaveValidatedThisSQL(</code><code  class="scala string">"dchenbecker"</code><code
 class="scala plain">,</code><code  class="scala string">"2008-12-03"</code><code
 class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The tradeoff with using <tt>BySql</tt>
        is that you need to be careful with what you allow into the query
        string. <tt>BySql</tt> supports parameterized queries as
        shown in Listing <a  href="#lst:Parameterized-BySql"  class="Reference">8.1.9↓</a>, so use those if you need to have
        dynamic queries. Whatever you do, don’t use string concatenation unless
        you really know what you’re doing. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Parameterized BySql<a  name="lst:Parameterized-BySql"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_354263">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">amountRange </code><code  class="scala keyword">=</code> <code
 class="scala plain">Expense.findAll(</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">BySql(</code><code  class="scala string">"amount between ? and ?"</code><code
 class="scala plain">, lowVal, highVal))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As we mentioned in Розділ <a  href="#sub:Deleting-an-Instance"
 class="Reference">3 on page 1↑</a>, we can use the query parameters
        to do bulk deletes in addition to querying for instances. Simply use the
        <tt>QueryParam</tt> classes to constrain what you want to
        delete. Obviously, the control params that we’ll cover next make no
        sense in this context, but the compiler won’t complain. Listing <a  href="#lst:Bulk-Deletion"
 class="Reference">8.1.9↓</a> shows an example of deleting all entries
        older than a certain date. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Bulk Deletion<a  name="lst:Bulk-Deletion"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_98944">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">deleteBefore (date </code><code  class="scala keyword">:</code> <code
 class="scala plain">Date) </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Expense.bulkDelete</code><code  class="scala keyword">_</code><code
 class="scala plain">!!(By</code><code  class="scala keyword">_</code><code  class="scala plain"><(Expense.dateOf, date))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.10"  class="toc">8.1.10</a> 
        Control QueryParams<a  name="sub:Control-QueryParams"  class="Label"> </a>
      </h3>
      <div  class="Unindented"> Now that we’ve covered the selection and
        comparison <tt>QueryParams</tt>, we can start to look at the
        control params. The first one that we’ll look at is
        <tt>OrderBy</tt>. This operates exactly like the order by
        clause in SQL, and allows you to sort on a given field in either
        ascending or descending order. Listing <a  href="#lst:OrderBy-Clause"  class="Reference">8.1.10↓</a> shows an example of ordering our
        <tt>Expense</tt> entries by amount. The
        <tt>Ascending</tt> and <tt>Descending</tt> case
        objects are in the net.liftweb.mapper package. The
        <tt>OrderBySql</tt> case class operates similarly, except
        that you provide your own SQL fragment for the ordering, as shown in the
        example. Again, you need to validate this SQL. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> OrderBy Clause<a  name="lst:OrderBy-Clause"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_949389">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">cheapestFirst </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Expense.findAll(OrderBy(Expense.amount,Ascending))</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala comments">// or</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">cheapestFirst </code><code  class="scala keyword">=</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">Expense.findAll(OrderBySql(</code><code  class="scala string">"amount asc"</code><code
 class="scala plain">),</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">IHaveValidatedThisSQL(</code><code  class="scala string">"dchenbecker"</code><code
 class="scala plain">, </code><code  class="scala string">"2008-12-03"</code><code
 class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Pagination of results is another feature that
        people often want to use, and Mapper provides a simple means for
        controlling it with two more <tt>QueryParam</tt> classes:
        <tt>StartAt</tt> and <tt>MaxRows</tt>, as shown
        in Listing <a  href="#lst:Pagination-of-Results"  class="Reference">8.1.10↓</a>. In this example, we take the offset
        from a parameter passed to our snippet, with a default of zero. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Pagination of Results<a  name="lst:Pagination-of-Results"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_467554">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">offset </code><code  class="scala keyword">=</code> <code  class="scala plain">S.param(</code><code
 class="scala string">"offset"</code><code  class="scala plain">).map(</code><code
 class="scala keyword">_</code><code  class="scala plain">.toLong) openOr </code><code
 class="scala value">0</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">Expense.findAll(StartAt(offset), MaxRows(</code><code
 class="scala value">20</code><code  class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> An important feature of the methods that take
        <tt>QueryParams</tt> is that they can take multiple params,
        as shown in this example. A more complex example is shown in Listing <a
 href="#lst:Multiple-QueryParams"  class="Reference">8.1.10↓</a>. In this example, we’re querying with a
        <tt>Like</tt> clause, sorting on the date of the entries,
        and paginating the results, all in one statement! </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Multiple QueryParams<a  name="lst:Multiple-QueryParams"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_89531">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">Expense.findAll(Like(Expense.description, </code><code
 class="scala string">"Gift for%"</code><code  class="scala plain">),</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">                </code><code
 class="scala plain">OrderBy(Expense.dateOf,Descending),</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">                </code><code
 class="scala plain">StartAt(offset),</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                </code><code
 class="scala plain">MaxRows(pageSize))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Another useful <tt>QueryParam</tt> is
        the <tt>Distinct</tt> case class, which acts exactly the
        same way as the DISTINCT keyword in SQL. One caveat is that Mapper
        doesn’t support explicit joins, so this restricts the situations in
        which you can use <tt>Distinct</tt>. The final “control”
        <tt>QueryParam</tt> that we’ll cover is
        <tt>PreCache</tt><a  href="#index-PreCache"  name="entry-PreCache-0"  class="IndexReference">↓</a>. It’s used when
        you have a mapped foreign key field on an entity. Normally, when Mapper
        loads your main entity it leaves the foreign key field in a lazy state,
        so that the query to get the foreign object isn’t executed until you
        access the field. This can obviously be inefficient when you have many
        entities loaded that you need to access, so the
        <tt>PreCache</tt> parameter forces Mapper to preload the
        foreign objects as part of the query. Listing <a  href="#lst:Using-PreCache"
 class="Reference">8.1.10↓</a> shows how we can use
        <tt>PreCache</tt> to fetch an <tt>Expense</tt>
        entry as well as the account for the entry. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using PreCache<a  name="lst:Using-PreCache"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_234021">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">loadExpensePlusAccount (id </code><code  class="scala keyword">:</code> <code
 class="scala plain">Long) </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Expense.findAll(By(Expense.id, id),</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">                    </code><code
 class="scala plain">PreCache(Expense.account))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.1.11"  class="toc">8.1.11</a> 
        Making Joins a Little Friendlier<a  name="sub:helper-joins"  class="Label">
        </a> </h3>
      <div  class="Unindented"> If you prefer to keep your queries type-safe,
        but you want a little more convenience in your joins between entities,
        you can define helper methods on your entities. One example is finding
        all of the tags for a given <tt>Expense</tt>, as shown in
        Listing <a  href="#lst:Join-Convenience-Method"  class="Reference">1↓</a>. Using this method in our example has an
        advantage over using <tt>HasManyThrough</tt>:
        <tt>hasManyThrough</tt> is a lazy value that will only
        retrieve data from the database once per request. Using a
        <tt>findAll</tt> will retrieve data from the database every
        time. This may be important if you add data to the database during a
        request, or if you expect things to change between queries. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Join Convenience Method<a  name="lst:Join-Convenience-Method"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_203107">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">tags </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">ExpenseTag.findAll(By(ExpenseTag.expense, </code><code  class="scala keyword">this</code><code
 class="scala plain">.id)).map(</code><code  class="scala keyword">_</code><code
 class="scala plain">.tag.obj.open</code><code  class="scala keyword">_</code><code
 class="scala plain">!)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-8.2"  class="toc">8.2</a> 
        Utility Functionality </h2>
      <div  class="Unindented"> In addition to the first-class persistence
        support in Mapper and Record, the frameworks provide additional
        functionality to make writing data-driven applications much simpler.
        This includes things such as automatic XHTML representation of objects
        and support for generating everything from simple forms for an
        individual entity to a full-fledged CRUD<span  class="FootOuter"><span  class="SupFootMarker"> 
            [D] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [D] </span>An acronym (Create, Read, Update and Delete)
            representing the standard operations that are performed on database
            records. Taken from <a  href="http://provost.uiowa.edu/maui/Glossary.html"
 class="FlexURL">http://provost.uiowa.edu/maui/Glossary.html</a>.</span></span>
        implementation for your entities. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.2.1"  class="toc">8.2.1</a> 
        Display Generation </h3>
      <div  class="Unindented"> If you want to display a Mapper instance as
        XHTML, simply call the <tt>asHtml</tt> method
        (<tt>toXHtml</tt> in Record) on your instance. The default
        implementation turns each field’s value into a <tt>Text</tt>
        node via the <tt>toString</tt> method and concatenates the
        results separated by newlines. If you want to change this behavior,
        override the <tt>asHtml</tt> on your field definitions. For
        example, if we wanted to control formatting on our
        <tt>dateOf</tt> field, we could modify the field as shown in
        Listing <a  href="#lst:Custom-field-display"  class="Reference">8.2.1↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Custom Field Display<a  name="lst:Custom-field-display"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_857897">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.text.DateFormat</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">dateOf </code><code  class="scala keyword">extends</code> <code
 class="scala plain">MappedDateTime(</code><code  class="scala keyword">this</code><code
 class="scala plain">) {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">final</code> <code  class="scala keyword">val</code> <code
 class="scala plain">dateFormat </code><code  class="scala keyword">=</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">DateFormat.getDateInstance(DateFormat.SHORT)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">asHtml </code><code  class="scala keyword">=</code> <code  class="scala plain">Text(dateFormat.format(is))</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that in Record, <tt>dateOf</tt>
        contains a <tt>java.util.Calendar</tt> instance and not a<br />
        <tt>java.util.Date</tt>, so we would need to use the
        <tt>getTime</tt> method on the value. Two similar methods,
        <tt>asJSON</tt> and <tt>asJs</tt>, will return
        the JSON and JavaScript object representation of the instance,
        respectively. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.2.2"  class="toc">8.2.2</a> 
        Form Generation<a  name="sub:Form-generation"  class="Label"> </a><a  href="#index-Forms"
 name="entry-Forms-0"  class="IndexReference">↓</a> </h3>
      <div  class="Unindented"> One of the biggest pieces of functionality in
        the Mapper framework is the ability to generate entry forms for a given
        record. The <tt>toForm<a  href="#index-toForm"  name="entry-toForm-0"  class="IndexReference">↓</a></tt> method
        on Mapper is overloaded so that you can control how your form is
        created. All three <tt>toForm</tt> methods on Mapper take a
        <tt>Box[String]</tt> as their first parameter to control the
        submit button; if the Box is Empty, no submit button is generated,
        otherwise, the String contents of the Box are used as the button label.
        If you opt to skip the submit button you’ll need to provide it yourself
        via binding or some other mechanism, or you can rely on implicit form
        submission (when the user hits enter in a text field, for instance). The
        first <tt>toForm</tt> method simply takes a function to
        process the submitted form and returns the XHTML as shown in Listing <a
 href="#lst:Default-toForm-method"  class="Reference">8.2.2↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Default toForm Method<a  name="lst:Default-toForm-method"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_900875">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">myEntry.toForm(Full(</code><code
 class="scala string">"Save"</code><code  class="scala plain">), { </code><code
 class="scala keyword">_</code><code  class="scala plain">.save })</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see, this makes it very easy to
        generate a form for editing an entity. The second
        <tt>toForm</tt> method allows you to provide a URL which the
        Mapper will redirect to if validation succeeds on form submission (this
        is not provided in Record). This can be used for something like a login
        form, as shown in Listing <a  href="#lst:Custom-form-redirect"  class="Reference">8.2.2↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Custom Submit Button<a  name="lst:Custom-form-redirect"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_807573">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">myEntry.toForm (Full(</code><code
 class="scala string">"Login"</code><code  class="scala plain">), </code><code  class="scala string">"/member/profile"</code><code
 class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The third form of the toForm method is similar to
        the first form, with the addition of “redo” snippet parameter. This
        allows you to keep the current state of the snippet when validation
        fails so that the user doesn’t have to re-enter all of the data in the
        form. </div>
      <div  class="Indented"> The Record framework allows for a little more
        flexibility in controlling form output. The MetaRecord object allows you
        to change the default template<a  href="#index-Override-form-template"  name="entry-Override-form-template-0"
 class="IndexReference">↓</a>
        that the form uses by setting the formTemplate<a  href="#index-formTemplate"
 name="entry-formTemplate-0"  class="IndexReference">↓</a> var. The
        template may contain any XHTML you want, but the
        <tt>toForm</tt> method will provide special handling for the
        following tags: </div>
      <div  class="Description"> <span  class="Description-entry"><lift:field_label name=“...” ></lift:field_label name=“...” ></span> 
        The label for the field with the given name will be rendered here. </div>
      <div  class="Description"> <span  class="Description-entry"><lift:field name=“...” ></lift:field name=“...” ></span> 
        The field itself (specified by the given name) will be rendered here.
        Typically this will be an input field, although it can be anything
        type-appropriate. For example, a BooleanField would render a checkbox. </div>
      <div  class="Description"> <span  class="Description-entry"><lift:field_msg name=“...” ></lift:field_msg name=“...” ></span> 
        Any messages, such as from validation, for the field with the given name
        will be rendered here. </div>
      <div  class="Unindented"> As an example, if we wanted to use tables to lay
        out the form for our ledger entry, the row for the description field
        might look like that in Listing <a  href="#lst:Custom-form-template"  class="Reference">8.2.2↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Custom Form Template<a  name="lst:Custom-form-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_760383">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml comments"><!-- Example description field row for Record’s toForm method --></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">tr</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">th</code><code  class="xml plain">><</code><code
 class="xml keyword">lift:field_label</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"description"</code> <code
 class="xml plain">/><!--</code--><code  class="xml keyword">th</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">td</code><code  class="xml plain">><</code><code
 class="xml keyword">lift:field</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"description"</code> <code
 class="xml plain">/> </code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:field_msg</code> <code
 class="xml color1">name</code><code  class="xml plain">=</code><code  class="xml string">"description"</code> <code
 class="xml plain">/><!--</code--><code  class="xml keyword">td</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                        <div  class="line number6 index5 alt1"><code  class="xml plain"><!--</code--><code
 class="xml keyword">tr</code><code  class="xml plain">></code></code></div><code
 class="xml plain">
                      </code></code></code></div><code  class="xml plain"><code
 class="xml plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Technically, the <tt>field_msg</tt>
        binding looks up Lift messages (Глава <a  href="#cha:Message-Handling"  class="Reference">B↓</a>) based on the field’s
        <tt>uniqueId</tt>, so you can set your own messages outside
        of validation using the S.{error, notice, warning} methods as shown in
        Listing <a  href="#lst:Setting-messages-via-S"  class="Reference">8.2.2↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Setting Messages via S<a  name="lst:Setting-messages-via-S"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_801039">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">S.warning(myEntry.amount.uniqueFieldId, </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">          </code><code
 class="scala string">"You have entered a negative amount!"</code><code  class="scala plain">)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">S.warning(</code><code
 class="scala string">"amount_id"</code><code  class="scala plain">, </code><code
 class="scala string">"This is brittle"</code><code  class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> For most purposes, though, using the validation
        mechanism discussed in the next section is the appropriate way to handle
        error checking and reporting. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.2.3"  class="toc">8.2.3</a> 
        Validation<a  name="sub:Mapper-Validation"  class="Label"> </a><a  href="#index-Validation"
 name="entry-Validation-0"  class="IndexReference">↓</a> </h3>
      <div  class="Unindented"> Validation is the process of checking a field
        during form processing to make sure that the submitted value meets
        requirements. This can be something as simple as ensuring that a value
        was submitted, or as complex as comparing multiple field values
        together. Validation is achieved via a <tt>List</tt> of
        functions on a field that take the field value as input and return a
        <tt>List[FieldError]</tt> (<tt>Box[Node]</tt> in
        Record). To indicate that validation succeeded, simply return an empty
        List, otherwise the list of <tt>FieldErrors</tt> you return
        are used as the failure messages to be presented to the user. A
        <tt>FieldError</tt> is simply a case class that associates
        an error message with a particular field. As an example, let’s say we
        don’t want someone to be able to add an <tt>Expense</tt>
        entry for a date in the future. First, we need to define a function for
        our <tt>dateOf</tt> field that takes a
        <tt>Date</tt> as an input (For Record,
        <tt>java.util.Calendar</tt><a  href="#index-Calendar"  name="entry-Calendar-0"
 class="IndexReference">↓</a>, not
        <tt>Date</tt>, is the actual value type of
        <tt>DateTimeField</tt>) and returns the proper
        <tt>List</tt>. We show a simple function in Listing <a  href="#lst:Date-validation"
 class="Reference">8.2.3↓</a>. In the method, we simply check to see
        if the millisecond count is greater than “now” and return an error
        message if so. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Date Validation<a  name="lst:Date-validation"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_696985">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.util.Date</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LongKeyedMapper[Expense] </code><code  class="scala keyword">with</code> <code
 class="scala plain">IdPK {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">dateOf </code><code
 class="scala keyword">extends</code> <code  class="scala plain">MappedDateTime(</code><code
 class="scala keyword">this</code><code  class="scala plain">) {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">noFutureDates (time </code><code
 class="scala keyword">:</code> <code  class="scala plain">Date) </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">if</code> <code  class="scala plain">(time.getTime > System.currentTimeMillis) {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">List(FieldError(</code><code  class="scala keyword">this</code><code
 class="scala plain">, </code><code  class="scala string">"You cannot make future expense entries"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">List[FieldError]()</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The first argument for the FieldError is the field
        itself, so you could use the alternate definition shown in Listing <a  href="#lst:Alternate-Date-Validation"
 class="Reference">8.2.3↓</a> if you would prefer to define your
        validation functions elsewhere (if they’re common to more than one
        entity, for example). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Alternate Date Validation<a  name="lst:Alternate-Date-Validation"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_692391">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.util.Date</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.http.FieldIdentifier</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">ValidationMethods {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">noFutureDates (field </code><code
 class="scala keyword">:</code> <code  class="scala plain">FieldIdentifier)(time </code><code
 class="scala keyword">:</code> <code  class="scala plain">Date) </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">(time.getTime > System.currentTimeMillis) {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">List(FieldError(field, </code><code  class="scala string">"You cannot make future expense entries"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">List[FieldError]()</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The next step is to tie the validation into the
        field itself. We do this by slightly modifying our field definition for
        <tt>date</tt> to set our list of validators as shown in
        Listing <a  href="#lst:Setting-validators"  class="Reference">8.2.3↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Setting Validators<a  name="lst:Setting-validators"
 class="Label"> </a> </div>
          object dateOf extends MappedDateTime(this) {
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_853859">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">noFutureDates (time </code><code
 class="scala keyword">:</code> <code  class="scala plain">Date) </code><code  class="scala keyword">=</code> <code
 class="scala plain">{ ... }</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">validations </code><code  class="scala keyword">=</code> <code
 class="scala plain">noFutureDates </code><code  class="scala keyword">_</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala comments">// Using the alternate definition:</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">dateOf </code><code  class="scala keyword">extends</code> <code
 class="scala plain">MappedDateTime(</code><code  class="scala keyword">this</code><code
 class="scala plain">) {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">validations </code><code  class="scala keyword">=</code> <code
 class="scala plain">ValidationMethods.noFutureDates(dateOf) </code><code  class="scala keyword">_</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that we need to add the underscore for each
        validation function to be partially applied on the submitted value. When
        our form is submitted, all of the validators for each field are run, and
        if all of them return Empty then validation succeeds. If any validators
        return a Full Box, then the contents of the Box are displayed as error
        messages to the user. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.2.4"  class="toc">8.2.4</a> 
        CRUD Support </h3>
      <div  class="Unindented"> Adding CRUD support to your Mapper classes is
        very simple. We just mix in the <tt><br />
        net.liftweb.mapper.CRUDify</tt> trait to our meta object and it
        provides a full set of add, edit, list, delete and view pages
        automatically. Listing <a  href="#lst:Mixing-in-CRUDify"  class="Reference">8.2.4↓</a> shows our <tt>Expense</tt>
        meta object with <tt>CRUDify</tt> mixed in. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Mixing in CRUDify<a  name="lst:Mixing-in-CRUDify"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_129757">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Expense LongKeyedMetaMapper[Expense] </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">with</code> <code  class="scala plain">CRUDify[Long,Expense] {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">... normal </code><code  class="scala keyword">def</code> <code
 class="scala plain">here ...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// disable delete functionality</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">deleteMenuLoc </code><code  class="scala keyword">=</code> <code
 class="scala plain">Empty</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The CRUDify behavior is very flexible, and you can
        control the templates for pages or whether pages are shown at all (as we
        do in our example) by overriding defs that are provided on the CRUDify
        trait. In our example Listing <a  href="#lst:Mixing-in-CRUDify"  class="Reference">8.2.4↑</a>, we disable the delete menu by
        overriding the<br />
        <tt>deleteMenuLoc</tt> method to return
        <tt>Empty</tt>. As an added bonus, CRUDify automatically
        creates a set of menus for SiteMap (Глава <a  href="#cha:SiteMap"  class="Reference">7↑</a>) that we can use by appending them onto the
        rest of our menus as shown in Listing <a  href="#lst:Using-CRUDify-Menus"
 class="Reference">8.2.4↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using CRUDify Menus<a  name="lst:Using-CRUDify-Menus"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_545982">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">menus </code><code
 class="scala keyword">=</code> <code  class="scala plain">... Menu(Loc(...)) </code><code
 class="scala keyword">::</code> <code  class="scala plain">Expense.menus</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.setSiteMap(SiteMap(menus </code><code  class="scala keyword">:</code> <code
 class="scala keyword">_</code><code  class="scala plain">*))</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.2.5"  class="toc">8.2.5</a> 
        Lifecycle Callbacks </h3>
      <div  class="Unindented"> Mapper and Record provide for a set of callbacks
        that allow you to perform actions at various points during the lifecycle
        of a given instance. If you want to define your own handling for one of
        the lifecycle events, all you need to do is override and define the
        callback because <tt>MetaMapper</tt> already extends the
        <tt>LifecycleCallbacks</tt> trait. Note that there is a
        separate <tt>LifecycleCallbacks</tt> trait in each of the
        record and mapper packages, so make sure that you import the correct
        one. For example, if we want to notify a Comet actor whenever a new
        <tt>Expense</tt> entry is saved, we can change our
        <tt>Expense</tt> class as shown in Listing <a  href="#lst:Lifecycle-Callbacks"
 class="Reference">8.2.5↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Lifecycle Callbacks<a  name="lst:Lifecycle-Callbacks"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_960098">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LongKeyedMapper[Expense] </code><code  class="scala keyword">with</code> <code
 class="scala plain">LifecycleCallbacks {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">afterSave { myCometActor ! </code><code  class="scala keyword">this</code> <code
 class="scala plain">}</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The lifecycle hooks are executed at the main
        operations in an instance lifecycle: </div>
      <div  class="Description"> <span  class="Description-entry">Create</span> 
        When a fresh instance is first saved (corresponding to a table insert).
      </div>
      <div  class="Description"> <span  class="Description-entry">Delete</span> 
        When an instance is deleted. </div>
      <div  class="Description"> <span  class="Description-entry">Save</span> 
        When a new or existing instance is inserted or updated.
        <tt>beforeSave</tt> is always called before
        <tt>beforeCreate</tt> or <tt>beforeUpdate</tt>.
        Similarly, <tt>afterSave</tt> is always called after
        <tt>afterCreate</tt> or <tt>afterUpdate</tt>. </div>
      <div  class="Description"> <span  class="Description-entry">Update</span> 
        When an instance that already exists in the database is updated
        (corresponding to a table update). </div>
      <div  class="Description"> <span  class="Description-entry">Validation</span> 
        When form validation occurs. </div>
      <div  class="Unindented"> For each of these points you can execute your
        code before or after the operation is run. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.2.6"  class="toc">8.2.6</a> 
        Base Field Types </h3>
      <div  class="Unindented"> The Record and Mapper frameworks define several
        basic field types. The following table shows the corresponding types
        between Mapper and Record, as well as a brief description of each type.
      </div>
      <div  class="Indented">
        <table>
          <tbody>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedBinary </td>
              <td  valign="top"  align="center"> BinaryField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a byte array. You must provide your own overrides for toForm and
                asXHtml/asHtml for input and display </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedBirthYear </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Holds an
                Int that represents a birth year. The constructor takes a minAge
                parameter that is used for validation </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedBoolean </td>
              <td  valign="top"  align="center"> BooleanField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a Boolean value. The default form representation is a checkbox </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedCountry </td>
              <td  valign="top"  align="center"> CountryField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a choice from an enumeration of country phone codes as provided
                by the net.liftweb.mapper.Countries.I18NCountry class. The
                default form representation is a select </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedDateTime </td>
              <td  valign="top"  align="center"> DateTimeField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a timestamp (java.util.Calender for Record, java.util.Date for
                Mapper). The default form representation is a text input </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedDouble </td>
              <td  valign="top"  align="center"> DoubleField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a Double value </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedEmail </td>
              <td  valign="top"  align="center"> EmailField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                an email address with a maximum length </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedEnum </td>
              <td  valign="top"  align="center"> EnumField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a choice from a given scala.Enumeration. The default form
                representation is a select </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedEnumList </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a choice of multiple Enumerations. The default form
                representation is a set of checkboxes, one for each enum value </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedFakeClob </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Fakes a
                CLOB value (really stores String bytes to a BINARY column) </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedGender </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a Gender enumeration. Display values are localized via the
                I18NGenders object. Internationalization is covered in appendix
                <a  href="#cha:Internationalization"  class="Reference">D↓</a> </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedInt </td>
              <td  valign="top"  align="center"> IntField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                an Int value </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedIntIndex </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                an indexed Int field (typically a primary key). In Record this
                is achieved with the KeyField trait </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedLocale </td>
              <td  valign="top"  align="center"> LocaleField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a locale as selected from the
                java.util.Locale.getAvailableLocales method. The default form
                representation is a select </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedLong </td>
              <td  valign="top"  align="center"> LongField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a Long value </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedLongForeignKey </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a mapping to another entity via the other entities Long primary
                key. This functionality in Record is not yet supported </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedLongIndex </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                an indexed Long field (typically a primary key). In Record this
                is achieved with the KeyField trait </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedPassword </td>
              <td  valign="top"  align="center"> PasswordField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a password string. The default form representation is a password
                input (obscured text) </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedPoliteString </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Just like
                MappedString, but the default value is an empty string and the
                input is automatically truncated to fit the database column size
              </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedPostalCode </td>
              <td  valign="top"  align="center"> PostalCodeField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a validated postal code string. The field takes a reference to a
                MappedCountry (CountryField in Record) at definition and
                validates the input string against the selected country’s postal
                code format </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedString </td>
              <td  valign="top"  align="center"> StringField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a string value with a maximum length and optional default value
              </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedStringForeignKey </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a mapping to another entity via the other entities String
                primary key. This functionality in Record is not yet supported </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedStringIndex </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                an indexed String field (typically a primary key). In Record
                this is achieved with the KeyField trait </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedText </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a String field that stores to a CLOB column in the database.
                This can be used for large volumes of text. </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedTextarea </td>
              <td  valign="top"  align="center"> TextAreaField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a String field that will use an HTML textarea element for its
                form display. When you define the field you can override the
                textareaCols and textareaRows defs to control the dimensions of
                the textarea. </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedTimeZone </td>
              <td  valign="top"  align="center"> TimeZoneField </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a time zone selected from java.util.TimeZone.getAvailableIDs.
                The default form representation is a select </td>
            </tr>
            <tr>
              <td  valign="top"  align="center"  style="width: 1.5in;">
                MappedUniqueId </td>
              <td  valign="top"  align="center"> N/A </td>
              <td  valign="top"  align="left"  style="width: 3.5in;"> Represents
                a unique string of a specified length that is randomly
                generated. The implementation doesn’t allow the user to write
                new values to the field. This can be thought of as a GUID </td>
            </tr>
          </tbody>
        </table>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.2.7"  class="toc">8.2.7</a> 
        Defining Custom Field Types in Mapper<a  name="sub:Defining-Custom-Field-types-mapper"
 class="Label"> </a> </h3>
      <div  class="Unindented"> The basic <tt>MappedField</tt> types
        cover a wide range of needs, but sometimes you may find yourself wanting
        to use a specific type. In our example, we would like a decimal value
        for our expense amount and account balance. Using a double would be
        inappropriate due to imprecision and rounding errors<span  class="FootOuter"><span
 class="SupFootMarker">  [E] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [E] </span><a  href="http://stephan.reposita.org/archives/2008/01/11/once-and-for-all-do-not-use-double-for-money/"
 class="FlexURL">http://stephan.reposita.org/archives/2008/01/11/once-and-for-all-do-not-use-double-for-money/</a></span></span>,
        so instead we base it on <tt>scala.BigDecimal</tt>. We’re
        going to provide an abridged version of the code that will end up in the
        Lift library. Feel free to examine the source to see the constructors
        and methods that we’ve omitted<span  class="FootOuter"><span  class="SupFootMarker"> 
            [F] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [F] </span>The code is checked into the master branch of the
            liftweb Git repository.</span></span>. Our first task is to specify
        the class signature and constructors, as shown in Listing <a  href="#lst:MappedDecimal-constructors"
 class="Reference">8.2.7↓</a>. Note that the
        <tt>BigDecimal</tt> we’re using here is
        <tt>scala.BigDecimal</tt>, not
        <tt>java.math.BigDecimal</tt>. We’ll cover how we make this
        work with JDBC (which doesn’t support scala.BigDecimal) in a moment. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> MappedDecimal Constructors<a  name="lst:MappedDecimal-constructors"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_721953">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.java.math.{MathContext, RoundingMode}</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">MappedDecimal[T <</code><code  class="scala keyword">:</code> <code
 class="scala plain">Mapper[T]] (</code><code  class="scala keyword">val</code> <code
 class="scala plain">fieldOwner </code><code  class="scala keyword">:</code> <code
 class="scala plain">T,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                                     </code><code
 class="scala keyword">val</code> <code  class="scala plain">context </code><code
 class="scala keyword">:</code> <code  class="scala plain">MathContext,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">                                     </code><code
 class="scala keyword">val</code> <code  class="scala plain">scale </code><code
 class="scala keyword">:</code> <code  class="scala plain">Int) </code><code  class="scala keyword">extends</code> <code
 class="scala plain">MappedField[BigDecimal,T] {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// ... constructor taking initial value ...</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala keyword">this</code><code
 class="scala plain">(fieldOwner </code><code  class="scala keyword">:</code> <code
 class="scala plain">T, value </code><code  class="scala keyword">:</code> <code
 class="scala plain">BigDecimal, context</code><code  class="scala keyword">:</code> <code
 class="scala plain">MathContext) </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">this</code><code  class="scala plain">(fieldOwner, context, value.scale)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">setAll(value) </code><code  class="scala comments">// we’ll cover this later in this section</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala keyword">this</code><code
 class="scala plain">(fieldOwner </code><code  class="scala keyword">:</code> <code
 class="scala plain">T, value </code><code  class="scala keyword">:</code> <code
 class="scala plain">BigDecimal) </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">this</code><code  class="scala plain">(fieldOwner, MathContext.UNLIMITED, value.scale)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">setAll(value)</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The first part of the class definition is the type
        signature; basically the type <tt>[T <:
        MappedField[T]]</tt> indicates that whatever type “owns” this
        field must be a Mapper subclass (<: specifies an upper type bound<span  class="FootOuter"><span
 class="SupFootMarker"> [G] </span><span  class="HoverFoot"><span  class="SupFootMarker"> [G] </span>For more on type bounds, see <a
 href="http://www.scala-lang.org/node/136"  class="URL">http://www.scala-lang.org/node/136</a>.</span></span>).
        With our primary constructor we specify the owner mapper as well as the
        <tt>MathContext</tt> (this controls rounding and precision,
        or the total number of digits) and scale of the decimal value. The scale
        in <tt>BigDecimal</tt> essentially represents the number of
        digits to the right of the decimal point. In addition, we specify
        ancillary constructors to take an initial value with or without and
        explicit <tt>MathContext</tt>. </div>
      <div  class="Indented"> Now that we have the constructors in place, there
        are several abstract methods on <tt>MappedField</tt> that we
        need to define. The first of these is a method to provide a default
        value. The default value is used for uninitialized fields or if
        validation fails. We also need to specify the class for our value type
        by implementing the <tt>dbFieldClass</tt> method. Listing <a  href="#lst:Setting-a-default-value"
 class="Reference">8.2.7↓</a> shows both of these methods. In our
        case, we default to a zero value, with the scale set as specified in the
        contructor. Note that <tt>BigDecimal</tt> instances are
        generally immutable, so the <tt>setScale</tt> method returns
        a new instance. We also provide the vars and methods that handle the
        before and after values of the field. These values are used to handle
        persistence state. If you change the value of the field, then the
        original value is held until the instance is saved to the database. The
        <tt>st</tt> method is used internally to set the value of
        the field when instances are “rehydrated” from the database. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Setting a Default Value<a  name="lst:Setting-a-default-value"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_825879">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">private</code> <code  class="scala keyword">val</code> <code
 class="scala plain">zero </code><code  class="scala keyword">=</code> <code  class="scala plain">BigDecimal(</code><code
 class="scala string">"0"</code><code  class="scala plain">) </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">defaultValue </code><code
 class="scala keyword">=</code> <code  class="scala plain">zero.setScale(scale)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">dbFieldClass </code><code
 class="scala keyword">=</code> <code  class="scala plain">classOf[BigDecimal]</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// The data and orgData variables are used so that</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// we know when the field has been modified by the user</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">private</code> <code  class="scala keyword">var</code> <code
 class="scala plain">data </code><code  class="scala keyword">:</code> <code  class="scala plain">BigDecimal </code><code
 class="scala keyword">=</code> <code  class="scala plain">defaultValue</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">private</code> <code  class="scala keyword">var</code> <code
 class="scala plain">orgData </code><code  class="scala keyword">:</code> <code
 class="scala plain">BigDecimal </code><code  class="scala keyword">=</code> <code
 class="scala plain">defaultValue</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">private</code> <code  class="scala keyword">def</code> <code
 class="scala plain">st (in </code><code  class="scala keyword">:</code> <code  class="scala plain">BigDecimal) {</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">data </code><code  class="scala keyword">=</code> <code  class="scala plain">in</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">orgData </code><code  class="scala keyword">=</code> <code
 class="scala plain">in</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code> </div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// The i_is_! and i_was_! methods are used internally to</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// keep track of when the field value is changed. In our </code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// instance they delegate directly to the data and orgData </code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// variables</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">protected</code> <code  class="scala keyword">def</code> <code
 class="scala plain">i</code><code  class="scala keyword">_</code><code  class="scala plain">is</code><code
 class="scala keyword">_</code><code  class="scala plain">! </code><code  class="scala keyword">=</code> <code
 class="scala plain">data</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">protected</code> <code  class="scala keyword">def</code> <code
 class="scala plain">i</code><code  class="scala keyword">_</code><code  class="scala plain">was</code><code
 class="scala keyword">_</code><code  class="scala plain">! </code><code  class="scala keyword">=</code> <code
 class="scala plain">orgData</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">doneWithSave() {</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">orgData </code><code  class="scala keyword">=</code> <code
 class="scala plain">data</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The next set of methods we need to provide deal
        with when and how we can access the data. Listing <a  href="#lst:Access-Control"
 class="Reference">8.2.7↓</a> shows the overrides that set the read
        and write permissions to true (default to false for both) as well as the
        <tt>i_obscure_!</tt> and <tt>real_i_set_!</tt>
        methods. The <tt>i_obscure_!</tt> method returns the a value
        that is used when the user doesn’t have read permissions. The
        <tt>real_i_set_!</tt> method is what actually stores the
        internal value and sets the dirty flag when the field is updated. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Access Control<a  name="lst:Access-Control"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_575206">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">readPermission</code><code
 class="scala keyword">_</code><code  class="scala plain">? </code><code  class="scala keyword">=</code> <code
 class="scala keyword">true</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">writePermission</code><code
 class="scala keyword">_</code><code  class="scala plain">? </code><code  class="scala keyword">=</code> <code
 class="scala keyword">true</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">protected</code> <code
 class="scala keyword">def</code> <code  class="scala plain">i</code><code  class="scala keyword">_</code><code
 class="scala plain">obscure</code><code  class="scala keyword">_</code><code  class="scala plain">!(in </code><code
 class="scala keyword">:</code> <code  class="scala plain">BigDecimal) </code><code
 class="scala keyword">=</code> <code  class="scala plain">defaultValue</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">protected</code> <code
 class="scala keyword">def</code> <code  class="scala plain">real</code><code  class="scala keyword">_</code><code
 class="scala plain">i</code><code  class="scala keyword">_</code><code  class="scala plain">set</code><code
 class="scala keyword">_</code><code  class="scala plain">!(value </code><code  class="scala keyword">:</code> <code
 class="scala plain">BigDecimal)</code><code  class="scala keyword">:</code> <code
 class="scala plain">BigDecimal </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">if</code> <code  class="scala plain">(value !</code><code
 class="scala keyword">=</code> <code  class="scala plain">data) {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">data </code><code  class="scala keyword">=</code> <code  class="scala plain">value</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">dirty</code><code  class="scala keyword">_</code><code  class="scala plain">?(</code><code
 class="scala keyword">true</code><code  class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">data</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The next two methods that we need to provide deal
        with actually setting the value of the field. The first is
        <tt>setFromAny</tt>, which takes an <tt>Any</tt>
        parameter and must convert it into a <tt>BigDecimal</tt>.
        The second, <tt>setFromString</tt> is a subset of
        <tt>setFromAny</tt> in that it takes a
        <tt>String</tt> parameter and must return a
        <tt>BigDecimal</tt>. Our implementation of these two methods
        is shown in Listing <a  href="#lst:setFrom...-Methods"  class="Reference">8.2.7↓</a>. We’ve also added a
        <tt>setAll</tt> and <tt>coerce</tt> method so
        that we have a common place to properly set scale and rounding modes on
        the value of the field. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> setFrom... Methods<a  name="lst:setFrom...-Methods"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_998692">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">setFromAny (in </code><code
 class="scala keyword">:</code> <code  class="scala plain">Any) </code><code  class="scala keyword">:</code> <code
 class="scala plain">BigDecimal </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">in </code><code  class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">bd </code><code  class="scala keyword">:</code> <code
 class="scala plain">BigDecimal </code><code  class="scala keyword">=</code><code
 class="scala plain">> setAll(bd)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">n </code><code  class="scala keyword">::</code> <code
 class="scala keyword">_</code> <code  class="scala keyword">=</code><code  class="scala plain">> setFromString(n.toString)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Some(n) </code><code
 class="scala keyword">=</code><code  class="scala plain">> setFromString(n.toString)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(n) </code><code
 class="scala keyword">=</code><code  class="scala plain">> setFromString(n.toString)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">None | Empty | Failure(</code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">_</code><code
 class="scala plain">, </code><code  class="scala keyword">_</code><code  class="scala plain">) | </code><code
 class="scala keyword">null</code> <code  class="scala keyword">=</code><code  class="scala plain">> setFromString(</code><code
 class="scala string">"0"</code><code  class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">n </code><code  class="scala keyword">=</code><code
 class="scala plain">> setFromString(n.toString)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">setFromString (in </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">:</code> <code  class="scala plain">BigDecimal </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">this</code><code  class="scala plain">.setAll(BigDecimal(in))</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">protected</code> <code  class="scala keyword">def</code> <code
 class="scala plain">setAll (in </code><code  class="scala keyword">:</code> <code
 class="scala plain">BigDecimal) </code><code  class="scala keyword">=</code> <code
 class="scala plain">set(coerce(in))</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Make a separate method for properly adjusting scale and rounding.</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// We’ll use this method later in the class as well.</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">protected</code> <code  class="scala plain">coerce (in </code><code
 class="scala keyword">:</code> <code  class="scala plain">BigDecimal) </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">new</code> <code  class="scala plain">BigDecimal(in.bigDecimal.setScale(scale, context.getRoundingMode))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Our implementations are relatively
        straightforward. The only special handling we need for
        <tt>setFromAny</tt> is to properly deal with
        <tt>Lists</tt>, <tt>Boxes</tt>,
        <tt>Options</tt> and the <tt>null</tt> value.
        The <tt>BigDecimal</tt> constructor takes Strings, so the
        <tt>setFromString</tt> method is easy. The only addition we
        make over the <tt>BigDecimal</tt> constructor is to properly
        set the scale and rounding on the returned value. </div>
      <div  class="Indented"> Our final step is to define the database-specific
        methods for our field, as shown in Listing <a  href="#lst:Database-Specific-Methods"
 class="Reference">8.2.7↓</a>. The first method we implement is
        <tt>targetSQLType</tt>. This method tells Mapper what the
        corresponding SQL type is for our database column. The
        <tt>jdbcFriendly</tt> method returns a value that can be
        used in a JDBC statement. Here’s where we need to use the
        <tt>bigDecimal</tt> val on our
        <tt>scala.BigDecimal</tt> to obtain the real
        <tt>java.math.BigDecimal</tt> instance. Similarly, the
        <tt>real_convertToJDBCFriendly</tt> method needs to return a
        java <tt>BigDecimal</tt> for a given
        <tt>scala.BigDecimal</tt> input. The
        <tt>buildSet...</tt> methods return functions that can be
        used to set the value of our field based on different input types. These
        are essentially conversion functions that are used by Lift to convert
        data retrieved in a <tt>ResultSet</tt> into actual field
        values. Finally, the <tt>fieldCreatorString</tt> specifices
        what we would need in a CREATE TABLE statement to define this column. In
        this instance, we need to take into account the precision and scale. We
        use default precision if we’re set to unlimited, but it’s important to
        understand that actual precision for the default DECIMAL type varies
        between RDBMS vendors. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Database-Specific Methods<a  name="lst:Database-Specific-Methods"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_498266">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                      <div  class="line number52 index51 alt1">52</div>
                      <div  class="line number53 index52 alt2">53</div>
                      <div  class="line number54 index53 alt1">54</div>
                      <div  class="line number55 index54 alt2">55</div>
                      <div  class="line number56 index55 alt1">56</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">targetSQLType </code><code  class="scala keyword">=</code> <code
 class="scala plain">Types.DECIMAL</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">jdbcFriendly(field </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">=</code> <code
 class="scala plain">i</code><code  class="scala keyword">_</code><code  class="scala plain">is</code><code
 class="scala keyword">_</code><code  class="scala plain">!.bigDecimal</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">real</code><code  class="scala keyword">_</code><code  class="scala plain">convertToJDBCFriendly(value</code><code
 class="scala keyword">:</code> <code  class="scala plain">BigDecimal)</code><code
 class="scala keyword">:</code> <code  class="scala plain">Object </code><code  class="scala keyword">=</code> <code
 class="scala plain">value.bigDecimal</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala comments">// The following methods are used internally by Lift to</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala comments">// process values retrieved from the database. </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala comments">// We don’t convert from Boolean values to a BigDecimal, so this returns null</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">buildSetBooleanValue(accessor </code><code  class="scala keyword">:</code> <code
 class="scala plain">Method, columnName </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">(T, Boolean, Boolean) </code><code  class="scala keyword">=</code><code
 class="scala plain">> Unit </code><code  class="scala keyword">=</code> <code  class="scala keyword">null</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala comments">// Convert from a Date to a BigDecimal. Our assumption here is that we can take</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala comments">// The milliseconds value of the Date.</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">buildSetDateValue(accessor </code><code  class="scala keyword">:</code> <code
 class="scala plain">Method, columnName </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">(T, Date) </code><code  class="scala keyword">=</code><code
 class="scala plain">> Unit </code><code  class="scala keyword">=</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">(inst, v) </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">doField(inst, accessor,{</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">f</code><code  class="scala keyword">:</code> <code
 class="scala plain">MappedDecimal[T] </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">f.st(</code><code  class="scala keyword">if</code> <code  class="scala plain">(v </code><code
 class="scala keyword">==</code> <code  class="scala keyword">null</code><code  class="scala plain">) defaultValue </code><code
 class="scala keyword">else</code> <code  class="scala plain">coerce(BigDecimal(v.getTime)))</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">})</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala comments">// Convert from a String to a BigDecimal. Since the BigDecimal object can</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala comments">// directly convert a String, we just pass the String directly.</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">buildSetStringValue(accessor</code><code  class="scala keyword">:</code> <code
 class="scala plain">Method, columnName</code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">(T, String) </code><code  class="scala keyword">=</code><code
 class="scala plain">> Unit </code><code  class="scala keyword">=</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">(inst, v) </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">doField(inst, accessor,{</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">f</code><code  class="scala keyword">:</code> <code
 class="scala plain">MappedDecimal[T] </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">f.st(coerce(BigDecimal(v)))</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">})</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala comments">// Convert from a Long to a BigDecimal. This is slightly more complex than </code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala comments">// for a String, since we need to check for null values.</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">buildSetLongValue(accessor</code><code  class="scala keyword">:</code> <code
 class="scala plain">Method, columnName </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">(T, Long, Boolean) </code><code  class="scala keyword">=</code><code
 class="scala plain">> Unit </code><code  class="scala keyword">=</code></div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">(inst, v, isNull) </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">doField(inst, accessor, {</code></div>
                        <div  class="line number38 index37 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">f</code><code  class="scala keyword">:</code> <code
 class="scala plain">MappedDecimal[T] </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number39 index38 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">f.st(</code><code  class="scala keyword">if</code> <code  class="scala plain">(isNull) defaultValue </code><code
 class="scala keyword">else</code> <code  class="scala plain">coerce(BigDecimal(v)))</code></div>
                        <div  class="line number40 index39 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">})</code></div>
                        <div  class="line number41 index40 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number42 index41 alt1"><code  class="scala comments">// Convert from an AnyRef (Object). We simply use the String value </code></div>
                        <div  class="line number43 index42 alt2"><code  class="scala comments">// of the input here.</code></div>
                        <div  class="line number44 index43 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">buildSetActualValue(accessor</code><code  class="scala keyword">:</code> <code
 class="scala plain">Method, data</code><code  class="scala keyword">:</code> <code
 class="scala plain">AnyRef, columnName</code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code></div>
                        <div  class="line number45 index44 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">(T, AnyRef) </code><code  class="scala keyword">=</code><code
 class="scala plain">> Unit </code><code  class="scala keyword">=</code></div>
                        <div  class="line number46 index45 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">(inst, v) </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number47 index46 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">doField(inst, accessor, {</code></div>
                        <div  class="line number48 index47 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">f</code><code  class="scala keyword">:</code> <code
 class="scala plain">MappedDecimal[T] </code><code  class="scala keyword">=</code><code
 class="scala plain">> f.st(coerce(BigDecimal(v.toString)))</code></div>
                        <div  class="line number49 index48 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">})</code></div>
                        <div  class="line number50 index49 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number51 index50 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">fieldCreatorString(dbType</code><code  class="scala keyword">:</code> <code
 class="scala plain">DriverType, colName</code><code  class="scala keyword">:</code> <code
 class="scala plain">String)</code><code  class="scala keyword">:</code> <code  class="scala plain">String </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number52 index51 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">suffix </code><code
 class="scala keyword">=</code> <code  class="scala keyword">if</code> <code  class="scala plain">(context.getPrecision </code><code
 class="scala keyword">==</code> <code  class="scala value">0</code><code  class="scala plain">) </code><code
 class="scala string">""</code> <code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number53 index52 alt2"><code  class="scala spaces">    </code><code
 class="scala string">"("</code> <code  class="scala plain">+ context.getPrecision + </code><code
 class="scala string">","</code> <code  class="scala plain">+ scale + </code><code
 class="scala string">")"</code></div>
                        <div  class="line number54 index53 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number55 index54 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">colName + </code><code  class="scala string">" DECIMAL"</code> <code
 class="scala plain">+ suffix</code></div>
                        <div  class="line number56 index55 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.2.8"  class="toc">8.2.8</a> 
        ProtoUser and MegaProtoUser<a  name="sub:ProtoUser-and-MegaProtoUser"  class="Label">
        </a> </h3>
      <div  class="Unindented"> In addition to all of the database-related
        features, Mapper contains an extra goody to help you quickly set up
        small sites. <tt>ProtoUser</tt> and
        <tt>MegaProtoUser</tt> are two built-in traits that define a
        simple user account. The <tt>ProtoUser</tt> trait defines
        some basic fields for a user: <tt>email</tt>,
        <tt>firstName</tt>, <tt>lastName</tt>,
        <tt>password</tt> and <tt>superUser</tt> (a
        boolean to provide basic permissions). There are also a number of defs
        used to format the fields for display or to provide form labels. Listing
        <a  href="#lst:A-simple-ProtoUser"  class="Reference">8.2.8↓</a> shows an example of a ProtoUser-based
        Mapper class that overrides some of the formatting defs. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Simple ProtoUser<a  name="lst:A-simple-ProtoUser"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_911538">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">User </code><code  class="scala keyword">extends</code> <code
 class="scala plain">ProtoUser[User] {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">shortName </code><code  class="scala keyword">=</code> <code
 class="scala plain">firstName.is</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala plain">lastNameDisplayName </code><code
 class="scala keyword">=</code> <code  class="scala string">"surname"</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The <tt>MegaProtoUser</tt> trait, as
        its name implies, extends the <tt>ProtoUser</tt> trait with
        a whole suite of functionality. The main thrust of
        <tt>MegaProtoUser</tt> (and its associated meta object,<br />
        <tt>MetaMegaProtoUser</tt>) is to automatically handle all
        of the scaffolding for a complete user management system, with: </div>
      <ul>
        <li> A user registration page with configurable validation via email </li>
        <li> A login page that automatically handles authentication </li>
        <li> A lost password page that does reset via email </li>
        <li> A change password page </li>
        <li> A user edit page </li>
        <li> A simple method to generate SiteMap menus for all of these pages </li>
      </ul>
      <div  class="Unindented"> Of course, you can customize any of these by
        overriding the associated methods on the MetaMegaProtoUser object.
        Listing <a  href="#lst:PocketChange-User-entity"  class="Reference">2.1 on page 1↑</a> shows an example of sprucing up
        the signup and login pages by overriding the
        <tt>loginXHtml</tt> and <tt>signupXHtml</tt>
        methods. Listing <a  href="#lst:Hooking-MetaMegaProtoUser-into-Boot"  class="Reference">8.2.8↓</a> shows how easy it is to then hook the
        MetaMegaProtoUser menus into SiteMap. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Hooking MetaMegaProtoUser into Boot<a  name="lst:Hooking-MetaMegaProtoUser-into-Boot"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_14704">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// in Boot.scala</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">LiftRules.setSiteMap(SiteMap((... </code><code
 class="scala keyword">::</code> <code  class="scala plain">User.sitemap) </code><code
 class="scala keyword">:_</code><code  class="scala plain">*))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-8.3"  class="toc">8.3</a> 
        Advanced Features </h2>
      <div  class="Unindented"> In this section we’ll cover some of the advanced
        features of Mapper </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.3.1"  class="toc">8.3.1</a> 
        Using Multiple Databases <a  name="sub:Multiple-Databases"  class="Label">
        </a><a  href="#index-Mapper-multiple-databases"  name="entry-Mapper-multiple-databases-1"
 class="IndexReference">↓</a>
      </h3>
      <div  class="Unindented"> It’s common for an application to need to access
        data in more than one database. Lift supports this feature through the
        use of overrides on your MetaMapper classes. First, we need to define
        the identifiers for the various databases using the
        <tt>ConnectionIdentifier</tt> trait and overriding the
        <tt>jndiName</tt> def. Lift comes with one pre-made:
        <tt>DefaultConnectionIdentifier</tt>. It’s jndiName is set
        to “lift”, so it’s recommended that you use something else. Let’s say we
        have two databases: sales and employees. Listing <a  href="#lst:Defining-Connection-Identifiers"
 class="Reference">8.3.1↓</a> shows how we would define the
        <tt>ConnectionIdentifier</tt> objects for these. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Defining Connection Identifiers<a  name="lst:Defining-Connection-Identifiers"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_187465">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">SalesDB </code><code  class="scala keyword">extends</code> <code
 class="scala plain">ConnectionIdentifier {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">jndiName </code><code
 class="scala keyword">=</code> <code  class="scala string">"sales"</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">EmployeeDB </code><code  class="scala keyword">extends</code> <code
 class="scala plain">ConnectionIdentifier {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">jndiName </code><code
 class="scala keyword">=</code> <code  class="scala string">"employees"</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Simple enough. Now, we need to create connection
        managers for each one, or we can combine the functionality into a single
        manager. To keep things clean we’ll use a single manager, as shown in
        Listing <a  href="#lst:Multi-database-Connection-Manager"  class="Reference">8.3.1↓</a>. Scala’s match operator allows us to
        easily return the correct connection. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Multi-database Connection Manager<a  name="lst:Multi-database-Connection-Manager"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_803699">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">DBVendor </code><code  class="scala keyword">extends</code> <code
 class="scala plain">ConnectionManager {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Class.forName(</code><code  class="scala string">"org.postgresql.Driver"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code> </div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">newConnection(name </code><code
 class="scala keyword">:</code> <code  class="scala plain">ConnectionIdentifier) </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">try</code> <code  class="scala plain">{</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">name </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">SalesDB </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">Full(DriverManager.getConnection(</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"jdbc:<a  href="postgresql://localhost/sales">postgresql://localhost/sales</a>"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"root"</code><code  class="scala plain">, </code><code  class="scala string">"secret"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">EmployeeDB </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">Full(DriverManager.getConnection(</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"jdbc:<a  href="postgresql://server/employees">postgresql://server/employees</a>"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"root"</code><code  class="scala plain">, </code><code  class="scala string">"hidden"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">catch</code> <code  class="scala plain">{</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">e </code><code  class="scala keyword">:</code> <code
 class="scala plain">Exception </code><code  class="scala keyword">=</code><code
 class="scala plain">> e.printStackTrace; Empty</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">releaseConnection (conn </code><code
 class="scala keyword">:</code> <code  class="scala plain">Connection) { conn.close }</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now that we’ve defined our connection identifiers,
        we need to be able to use them in our <tt>Mapper</tt>
        instances. There are several ways to do this. The first (simplest) way
        is to override the <tt>dbDefaultConnectionIdentifier</tt>
        method on your <tt>MetaMapper</tt> object, as shown in
        Listing <a  href="#lst:Defining-the-Default-connid"  class="Reference">8.3.1↓</a>. In this example we’re setting the
        <tt>MetaMapper</tt> to always use the
        <tt>EmployeeDB</tt> connection for all persistence
        operations. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Defining the Default Connection Identifier<a  name="lst:Defining-the-Default-connid"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_684659">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">EmployeeMeta </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Employee </code><code  class="scala keyword">with</code> <code
 class="scala plain">LongKeyedMetaMapper[Employee] {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">dbDefaultConnectionIdentifier </code><code  class="scala keyword">=</code> <code
 class="scala plain">EmployeeDB</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The second way to utilize more than one DB is to
        use the “DB” version of the persistence methods, as we mentioned in
        Розділ <a  href="#sub:Persistence-Operations-on-entity"  class="Reference">8.1.7↑</a>. Listing <a
 href="#lst:Using-a-Connection-id-direct"  class="Reference">8.3.1↓</a> shows how we can perform a
        <tt>findAll</tt> with a specific connection. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using a Connection Identifier Directly<a  name="lst:Using-a-Connection-id-direct"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_399416">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">employees </code><code  class="scala keyword">=</code> <code
 class="scala plain">EmployeeMeta.findAllDb(EmployeeDB)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.3.2"  class="toc">8.3.2</a> 
        Database Sharding </h3>
      <div  class="Unindented"> A special case of using multiple databases is <i>sharding</i><span
 class="FootOuter"><span  class="SupFootMarker"> [H] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [H] </span>For more information on
            sharding, see this article: <a  href="http://highscalability.com/unorthodox-approach-database-design-coming-shard"
 class="FlexURL">http://highscalability.com/unorthodox-approach-database-design-coming-shard</a></span></span>.
        Sharding is a means to scale your database capacity by associating
        entities with one database instance out of a federation of servers based
        on some property of the entity. For instance, we could distribute user
        entites across 3 database servers by using the first character of the
        last name: A-H goes to server 1, I-P goes to server 2, and Q-Z goes to
        server 3. As simple as this sounds, there are some important factors to
        remember: </div>
      <ul>
        <li> Sharding increases the complexity of your code. </li>
        <li> To get the most benefit out of sharding, you need to carefully
          choose and tune your “selector.” If you’re not careful, you can get an
          uneven distribution where some servers handle significantly more load
          than others, defeating the purpose of sharding. The example we’ve
          given here of using the last name is, in practice, a very poor choice.
          We recommend reading <a  href="http://startuplessonslearned.blogspot.com/2009/01/sharding-for-startups.html"
 class="URL">http://startuplessonslearned.blogspot.com/2009/01/sharding-for-startups.html</a>
          for a good overview of the pros and cons of various selector
          strategies. </li>
        <li> When you use sharding, you can’t just use normal joins anymore
          because the data isn’t all within one instance. This means more work
          on your part to properly retrieve and associate data </li>
      </ul>
      <div  class="Unindented"> Mapper provides a handy feature for sharding
        that allows you to choose which database connection you want to use for
        a specific entity. There are two methods we can use to control the
        behavior: <tt>dbSelectDBConnectionForFind</tt> and
        <tt>dbCalculateConnectionIdentifier</tt>. dbSelect... is
        used to find an instance by primary key, and takes a partial function
        (typically a match clause) to determine which connection to use.
        dbCalculate... is used when a new instance is created to decide where to
        store the new instance. As an example, say we’ve defined two database
        connections, SalesA and SalesB. We want to place new instances in SalesA
        if the amount is > $100 and SalesB otherwise. Listing <a  href="#lst:Sharding-in-Action"
 class="Reference">8.3.2↓</a> shows our method in action. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Sharding in Action<a  name="lst:Sharding-in-Action"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_623916">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LongKeyedMapper[Expense] {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">... fields, etc ...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">dbCalculateConnectionIdentifier </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">n </code><code  class="scala keyword">if</code> <code
 class="scala plain">n.amount.is > </code><code  class="scala value">100</code> <code
 class="scala keyword">=</code><code  class="scala plain">> SalesA</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> SalesB</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-8.3.3"  class="toc">8.3.3</a> 
        SQL-based Queries<a  name="sub:SQL-based-queries"  class="Label"> </a>
      </h3>
      <div  class="Unindented"> If, despite all that Mapper covers, you find
        yourself still wanting more control over the query, there are two more
        options available to you:
        <tt>findAllByPreparedStatement</tt> and
        <tt>findAllByInsecureSql</tt>. The
        <tt>findAllByPreparedStatement</tt> method allows you to, in
        essence, construct your query completely by hand. The added benefit of
        using a <tt>PreparedStatement</tt><span  class="FootOuter"><span  class="SupFootMarker"> [I] </span><span
 class="HoverFoot"><span  class="SupFootMarker"> 
              [I] </span><a  href="http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html"
 class="FlexURL">http://java.sun.com/javase/6/docs/api/java/sql/PreparedStatement.html</a></span></span>
        means that you can easily include user-defined data in your queries. The
        <tt>findAllByPreparedStatement</tt> method takes a single
        function parameter. This function takes a
        <tt>SuperConnection</tt><span  class="FootOuter"><span  class="SupFootMarker"> 
            [J] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [J] </span>Essentially a thin wrapper on java.sql.Connection, <a  href="http://scala-tools.org/mvnsites/liftweb/lift-webkit/scaladocs/net/liftweb/mapper/SuperConnection.html"
 class="FlexURL">http://scala-tools.org/mvnsites/liftweb/lift-webkit/scaladocs/net/liftweb/mapper/SuperConnection.html</a></span></span>
        and returns a<br />
        <tt>PreparedStatement</tt> instance. Listing <a  href="#lst:Using-findAllByPreparedStatement"
 class="Reference">8.3.3↓</a> shows our previous example in which we
        looked up all <tt>Tag</tt>s for recent
        <tt>Expense</tt> entries, but here using
        <tt>findAllByPreparedStatement</tt> instead. The query that
        you provide must at least return the fields that are mapped by your
        entity, but you can return other columns as well (they’ll just be
        ignored), so you may choose to do a “select *” if you prefer. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using findAllByPreparedStatement<a  name="lst:Using-findAllByPreparedStatement"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_51543">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">recentTags </code><code  class="scala keyword">=</code> <code
 class="scala plain">Tag.findAllByPreparedStatement({ superconn </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">superconn.connection.prepareStatement(</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala string">"select distinct Expense.id, Tag.name"</code> <code  class="scala plain">+</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala string">"from Tag"</code> <code  class="scala plain">+</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala string">"join ExpenseTag et on Tag.id = et.tag "</code> <code  class="scala plain">+</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala string">"join Expense ex on ex.id = et.expense "</code> <code  class="scala plain">+</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala string">"where ex.dateOf > (CURRENT_DATE - interval ’30 days’)"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">})</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The <tt>findAllByInsecureSql</tt>
        method goes even further, executing the string you submit directly as a
        statement without any checks. The same general rules apply as for<br />
        <tt>findAllByPreparedStatement</tt>, although you need to
        add the <tt>IHaveValidatedThisSQL</tt> parameter as a code
        audit check. In either case, the ability to use full SQL queries can
        allow you to do some very powerful things, but it comes at the cost of
        losing type safety and possibly making your app non-portable. </div>
      <div  class="Indented"> As a last resort, Mapper provides support for
        non-entity SQL queries through a few methods on the DB object. The first
        method we’ll look at is <tt>DB.runQuery</tt>. This method
        allows you to provide a full SQL query string, and is overloaded to take
        a parameterized query. It returns a
        <tt>Pair[List[String],List[List[String]]</tt>, with the
        first <tt>List[String]</tt> containing all of the column
        names and the second <tt>List</tt> corresponding to each row
        in the result set. For example, let’s say we wanted to compute the sums
        of each tag for a given account. Listing <a  href="#lst:Using-DB.runQuery"
 class="Reference">8.3.3↓</a> shows how we could accomplish this using
        a parameterized query against the database. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using DB.runQuery<a  name="lst:Using-DB.runQuery"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_238278">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">DB.runQuery(</code><code
 class="scala string">"select Tag.name, sum(amount) from Expense ex "</code> <code
 class="scala plain">+</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"join ExpenseTag et on et.expense = ex.id "</code> <code  class="scala plain">+</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"join Tag on et.tag = Tag.id "</code> <code  class="scala plain">+</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"join Account on Account.id = ex.account "</code> <code  class="scala plain">+</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"where Account.id = ? group by Tag.name order by Tag.name"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">myAccount.id)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala comments">// might return:</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">(List(</code><code
 class="scala string">"tag"</code><code  class="scala plain">, </code><code  class="scala string">"sum"</code><code
 class="scala plain">]),</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces"> </code><code
 class="scala plain">List(List(</code><code  class="scala string">"food"</code><code
 class="scala plain">,</code><code  class="scala string">"42.00"</code><code  class="scala plain">),</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">List(</code><code  class="scala string">"home"</code><code
 class="scala plain">,</code><code  class="scala string">"75.49"</code><code  class="scala plain">),</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">List(</code><code  class="scala string">"work"</code><code
 class="scala plain">,</code><code  class="scala string">"2.00"</code><code  class="scala plain">)))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> If you need full control over the query and full
        access to the result set, DB provides some low-level utility methods.
        The most basic is <tt>DB.use</tt>, which takes a connection
        identifier as well as a function that takes a
        <tt>SuperConnection</tt> (a thin wrapper on JDBC’s
        connection). This forms a loan pattern<span  class="FootOuter"><span  class="SupFootMarker"> 
            [K] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [K] </span><a  href="http://scala.sygneca.com/patterns/loan"  class="URL">http://scala.sygneca.com/patterns/loan</a></span></span>
        that lets Mapper deal with all of the connection open and release
        details. The <tt>DB.exec</tt> method takes a provided
        connection and executes an arbitrary SQL statement on it, then applies a
        provided function to the result set. Similarly, the
        <tt>DB.prepareStatement</tt> method allows you to create a
        prepared statement and then apply a function to it. You can combine
        these methods to run any arbitrary SQL, as shown in Listing <a  href="#lst:Using-DB.use"
 class="Reference">8.3.3↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using DB.use<a  name="lst:Using-DB.use"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_950004">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// recompute an account balance from all of the transactions</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">DB.use(DefaultConnectionIdentifier) { conn </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">balance </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// Should use a prepared statement here. This is for example only</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">DB.exec(conn, </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala string">"select sum(ex.amount) from Expense ex where ex.account = "</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">+ myAccount.id) {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">rs </code><code  class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">       </code><code
 class="scala keyword">if</code> <code  class="scala plain">(!rs.next) BigDecimal(</code><code
 class="scala value">0</code><code  class="scala plain">) </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">       </code><code
 class="scala keyword">else</code> <code  class="scala plain">(</code><code  class="scala keyword">new</code> <code
 class="scala plain">BigDecimal(rs.getBigDecimal(</code><code  class="scala value">1</code><code
 class="scala plain">)))</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">DB.prepareStatement(</code><code  class="scala string">"update Account set balance = ? where Account.id = "</code><code
 class="scala plain">, </code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">                      </code><code
 class="scala plain">conn) { stmt </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">stmt.setBigDecimal(</code><code  class="scala value">1</code><code
 class="scala plain">, balance.bigDecimal)</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">stmt.setLong(</code><code  class="scala value">2</code><code
 class="scala plain">, resetAccount.id)</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">stmt.executeUpdate()</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-8.4"  class="toc">8.4</a> 
        Logging </h2>
      <div  class="Unindented"> Logging with Mapper is covered in detail in
        Розділ <a  href="#sec:Logging-Mapper-Queries"  class="Reference">E.4 on page 1↓</a>. </div>
      <h2  class="Section"> <a  name="toc-Section-8.5"  class="toc">8.5</a> 
        Summary </h2>
      <div  class="Unindented"> In this chapter, we discussed the two major ORMs
        included in Lift: Mapper and Record. We’ve shown how you can define
        entities using the Mapper field types and how to coordinate between the
        entity and its Meta-object. We’ve shown how you can customize the
        display and schema of your behavior with custom form control, CRUD
        support, and indexing. And we’ve show you how to query for entities
        using Mapper’s type-safe query support. Finally, we showed you how you
        can do in-depth customization of Mapper behavior by writing your own
        field types, using multiple databases, and using raw SQL queries. </div>
      <h1  class="Part"> <a  name="toc-Part-II"  class="toc">Part II.</a> 
        Advanced Topics </h1>
      <div  class="Unindented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-9"  class="toc">9</a> 
        Advanced Lift Architecture<a  name="cha:Advanced-Lift-Guts"  class="Label">
        </a> </h1>
      <div  class="Unindented">
        <div  style="width: 100%;"  class="Framed"> This chapter is still under
          active development. The contents will change. </div>
      </div>
      <div  class="Indented"> Congratulations! You’ve either made it through the
        introduction to Lift, or maybe you’ve just skipped Basics and jumped
        right to here to Advanced; either way, the next group of chapters will
        be exciting. </div>
      <div  class="Indented"> In this chapter we’re going to dive into some of
        the advanced guts of Lift so that you have a thorough understanding of
        what’s going on before we explore further. </div>
      <h2  class="Section"> <a  name="toc-Section-9.1"  class="toc">9.1</a> 
        Architectural Overview </h2>
      <div  class="Unindented"> Before we jump into the specific details of the
        architecture, let’s refresh our memories. Малюнок <a  href="#fig:Architecture-diagram"
 class="Reference">9.1↓</a> highlights the main Lift components and
        where they live in the ecosystem. Scala compiles down to Java bytecode,
        so we sit on top of the JVM. Lift Applications are typically run in a
        J(2)EE web container, such as Jetty or Tomcat. As we explained in
        section <a  href="#sec:Entry-into-Lift"  class="Reference">3.1↑</a>, Lift is set up to act as a Filter<span
 class="FootOuter"><span  class="SupFootMarker"> [L] </span><span  class="HoverFoot"><span
 class="SupFootMarker"> 
              [L] </span><a  href="http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/Filter.html"
 class="URL">http://java.sun.com/j2ee/1.4/docs/api/javax/servlet/Filter.html</a></span></span>
        that acts as the entry point. Usage of the rest of the framework varies
        from application to application, depending on how simple or complex you
        make it. </div>
      <div  class="Indented">
        <div  class="center">
          <div  class="float"> <a  name="fig:Architecture-diagram"  class="Label">
            </a>
            <div  class="figure">
              <div  class="caption"> Малюнок 9.1 Architecture </div>
              <div  class="center"> <img  style="max-width: 612px; max-height: 792px;"
 alt="figure images/LiftArchDiagram.png"  src="./ExploringLift_files/LiftArchDiagram.png"
 class="embedded" /> </div>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The major components outlined in the diagram are:
      </div>
      <div  class="Description"> <span  class="Description-entry">LiftCore</span> 
        The engine of the framework responsible for request/response lifecycle,
        rendering pipeline, invoking user’s functions etc. We don’t directly
        cover the core in this book since essentially all of the functionality
        that we do cover sits on top of the core </div>
      <div  class="Description"> <span  class="Description-entry">SiteMap</span> 
        Contains the web pages for a Lift application (chapter<a  href="#cha:SiteMap"
 class="Reference">7↑</a>) </div>
      <div  class="Description"> <span  class="Description-entry">LiftRules</span> 
        Allows you to configure Lift. We cover this in various sections
        throughout the book </div>
      <div  class="Description"> <span  class="Description-entry">LiftSession</span> 
        The session state representation (section <a  href="#sec:Session-Management"
 class="Reference">9.5↓</a>) </div>
      <div  class="Description"> <span  class="Description-entry">S</span> The
        stateful object impersonating the state context for a given
        request/response lifecycle (section <a  href="#sub:Advanced-S-Object"  class="Reference">9.7↓</a>) </div>
      <div  class="Description"> <span  class="Description-entry">SHtml</span> 
        Contains helper functions for XHtml artifacts (chapters <a  href="#cha:Forms-in-Lift"
 class="Reference">6↑</a> and <a  href="#cha:AJAX-and-COMET"  class="Reference">11↓</a>) </div>
      <div  class="Description"> <span  class="Description-entry">Views</span> 
        LiftView objects impersonating a view as a XML content. Thus pages can
        be composed from other sources not only from html files. (section <a  href="#sec:Views"
 class="Reference">4.4↑</a>) </div>
      <div  class="Description"> <span  class="Description-entry">LiftResponse</span> 
        Represents the abstraction of a response that will be propagated to the
        client. (section <a  href="#sec:LiftResponse-in-Detail"  class="Reference">9.4↓</a>) </div>
      <div  class="Description"> <span  class="Description-entry">Comet</span> 
        Represents the Comet Actors layer which allows the sending of
        asynchronous content to the browser (section <a  href="#sec:COMET"  class="Reference">11.5↓</a>) </div>
      <div  class="Description"> <span  class="Description-entry">ORM</span> -
        Either Mapper or Record - The lightweight ORM library provided by Lift.
        The Mapper framework is the proposed ORM framework for Lift 1.0 and the
        Record framework will be out for next releases. (chapter <a  href="#cha:mapper_and_record"
 class="Reference">8↑</a>) </div>
      <div  class="Description"> <span  class="Description-entry">HTTP Auth</span> 
        - You can use either Basic or Digest HTTP authentication in your Lift
        application. This provides you more control as opposed to
        web-container’s HTTP authentication model. (section <a  href="#sub:HTTP-Authentication"
 class="Reference">9.9↓</a>) </div>
      <div  class="Description"> <span  class="Description-entry">JS API</span> 
        The JavaScript abstraction layer. These are Scala classes/objects that
        abstract JavaScript artifacts. Such objects can be combined to build
        JavaScript code (chapter <a  href="#cha:Lift-and-Javascript"  class="Reference">10↓</a>) </div>
      <div  class="Description"> <span  class="Description-entry">Utils</span> 
        Contains a number of helper functions that Lift uses internally and are
        available to your application </div>
      <h2  class="Section"> <a  name="toc-Section-9.2"  class="toc">9.2</a> The
        Request/Response Lifecycle<a  name="sec:Request/Response-Lifecycle"  class="Label">
        </a> </h2>
      <div  class="Unindented"> We briefly discussed the Request/Response
        Liftcycle in section <a  href="#sec:The-Rendering-Process"  class="Reference">3.5↑</a>, and now we’re going to cover it in depth.
        This will serve not only to familiarize you with the full processing
        power of Lift, but also to introduce some of the other advanced topics
        we’ll be discussing in this and later chapters. </div>
      <div  class="Indented"> One important thing we’d like to mention is that
        most of the configurable properties are in
        <tt>LiftRules</tt>, and are of type
        <tt>RulesSeq</tt>. With a <tt>RulesSeq</tt> you
        essentially have a list of functions or values that are applied in
        order. <tt>RulesSeq</tt> defines a prepend and append method
        that allows you to add new configuration items at the beginning or end
        of the configuration, respectively. This allows you to prioritize things
        like partial functions and compose various methods together to control
        Lift’s behavior. You can think of a RulesSeq as a Seq on steroids,
        tweaked for Lift’s usage. </div>
      <div  class="Indented"> The following list outlines, in order, the process
        of transforming a Request into a Response. We provide references to the
        sections of the book where we discuss each step in case you want to
        branch off. </div>
      <ol>
        <li> Execute early functions: this is a mechanism that allows a user
          function to be called on the HttpServletRequest before it enters the
          normal processing chain. This can be used for, for example, to set the
          XHTML output to UTF-8. This is controlled through
          <tt>LiftRules.early</tt> </li>
        <li> Perform URL Rewriting, which we already covered in detail in
          section <a  href="#sec:URL-Rewriting"  class="Reference">3.7↑</a>. Controlled via
          <tt>LiftRules.rewrite</tt>, this is useful for creating
          user-friendly URLs, among other things. The result of the
          transformation will be checked for possible rewrites until there are
          no more matches or it is explicitly stopped by setting the
          <tt>stopRewriting</tt> val in ReqwriteResponse to
          <tt>true</tt>. It is relevant to know that you can have
          rewriter functions per-session hence you can have different rewriter
          in different contexts. These session rewriters are prended to the
          LiftRules rewriters before their application. </li>
        <li> Call <tt>LiftRules.onBeginServicing</tt> hooks. This is
          a mechanism that allows you to add your own hook functions that will
          be called when Lift is starting to process the request. You could set
          up logging here, for instance. </li>
        <li> Check for user-defined stateless dispatch in
          <tt>LiftRules.statelessDispatchTable</tt>. If the partial
          functions defined in this table match the request then they are used
          to create a <tt>LiftResponse</tt> that is sent to the
          user, bypassing any further processing. These are very useful for
          building things like REST APIs. The term stateless refers to the fact
          that at the time the dispatch function is called, the stateful object,
          called <tt>S</tt>, is not available and the
          <tt>LiftSession</tt> is not created yet. Custom dispatch
          is covered in section <a  href="#sec:Custom-dispatch-func"  class="Reference">3.8↑</a> </li>
        <li> Create a <tt>LiftSession</tt>. The
          <tt>LiftSession</tt> holds various bits of state for the
          request, and is covered in more detail in section <a  href="#sec:Session-Management"
 class="Reference">9.5↓</a>. </li>
        <li> Call <tt>LiftSession.onSetupSession</tt>. This is a
          mechanism for adding hook functions that will be called when the
          LiftSession is created. We’ll get into more details when we discuss
          Lift’s session management in section <a  href="#sec:Session-Management"
 class="Reference">9.5↓</a>. </li>
        <li> Initialize the <tt>S</tt> object (section <a  href="#sub:S-object"
 class="Reference">3.4.1↑</a>). The <tt>S</tt> object
          represents the current state of the Request and Response. </li>
        <li> Call any <tt>LoanWrapper</tt> instances that you’ve
          added through <tt>S.addAround</tt>. A
          <tt>LoanWrapper</tt> is a way to insert your own
          processing into the render pipeline, similar to how Filter works in
          the Servlet API. This means that when your
          <tt>LoanWrapper</tt> implementation is called, Lift passes
          you a function allowing you to chain the processing of the request.
          With this functionality you can execute your own pre- and
          post-condition code. A simple example of this would be if you need to
          make sure that something is configured at the start of processing and
          cleanly shut down when processing terminates. LoanWrappers are covered
          in section <a  href="#sub:Wrapping-Lift%27s-processing"  class="Reference">9.6.1↓</a> </li>
        <li> Process the stateful request
          <ol>
            <li> Check the stateful dispatch functions defined in
              <tt>LiftRules.dispatch</tt>. This is similar to the
              stateless dispatch in step #4 except that these functions are
              executed in the context of a LiftSession and an
              <tt>S</tt> object (section <a  href="#sub:S-object"  class="Reference">3.4.1↑</a>). The first matching partial
              function is used to generate a <tt>LiftResponse</tt>
              that is returned to the client. If none of the dispatch functions
              match then processing continues. Dispatch functions are covered in
              section <a  href="#sec:Custom-dispatch-func"  class="Reference">3.8↑</a>. This flow is wrapped by
              LiftSession.onBeginServicing/onEndServicing calls </li>
            <li> If this is a <b>Comet</b> request, then process it and return
              the response. Comet is a method for performing asynchronous
              updates of the user’s page without a reload. We cover Comet
              techniques in chapter <a  href="#cha:AJAX-and-COMET"  class="Reference">11↓</a> </li>
            <li> If this is an <b>Ajax</b> request, execute the user’s callback
              function; the specific function is mapped via a request parameter
              (essentially a token). The result of the callback is returned as
              the response to the user. The response can be a JavaScript
              snippet, an XML construct or virtually any
              <tt>LiftResponse</tt>. For an overview of
              <tt>LiftResponse</tt> please see section <a  href="#sec:LiftResponse-in-Detail"
 class="Reference">9.4↓</a>. This flow is wrapped by
              LiftSession.onBeginServicing/onEndServicing calls. </li>
            <li> If this is a regular HTTP request, then:
              <ol>
                <li> Call <tt>LiftSession.onBeginServicing</tt>
                  hooks. Mostly “onBegin”/”onEnd” functions are used for
                  logging. Note that the <tt>LiftRules</tt> object
                  also has <tt>onBeginServicing</tt> and
                  <tt>onEndServicing</tt> functions but these are
                  “wrapping” more Lift processing and not just statefull
                  processing. </li>
                <li> Check the user-defined dispatch functions that are set
                  per-session (see
                  <tt>S.addHighLevelSessionDispatcher</tt>). This is
                  similar to <tt>LiftRules.dispatch</tt> except that
                  you can have different functions set up for a different
                  session depending on your application logic. If there is a
                  function applicable, execute it and return its response. If
                  there is no per-session dispatch function, process the request
                  by executing the Scala function that user set up for specific
                  events (such as when clicking a link, or pressing the submit
                  button, or a function that will be executed when a form field
                  is set etc.). Please see SHtml obejct <a  href="#sub:SHtml"  class="Reference">3.4.2↑</a>. </li>
                <li> Check the SiteMap and Loc functions. We cover SiteMap
                  extensively in chapter <a  href="#cha:SiteMap"  class="Reference">7↑</a>. </li>
                <li> Lookup the template based on the request path. Lift will
                  locate the templates using various approaches:
                  <ol>
                    <li> Check the partial functions defined in
                      <tt>LiftRules.viewDispatch</tt>. If there is a
                      function defined for this path invoke it and return an
                      Either[<span  class="formula">() ⇒ <i>Can</i>[<i>NodeSeq</i>]</span>,LiftView].
                      This allows you to either return the function for handling
                      the view directly, or delegate to a
                      <tt>LiftView</tt> subclass.
                      <tt>LiftView</tt> is covered in section <a  href="#sec:Views"
 class="Reference">4.4↑</a> </li>
                    <li> If no viewDispatch functions match, then look for the
                      template using the ServletContext’s
                      <tt>getResourceAsStream</tt>. </li>
                    <li> If Lift still can’t find any templates, it will attempt
                      to locate a View class whose name matches the first
                      component of the request path under the
                      <tt>view</tt> folder of any packages defined
                      by <tt>LiftRules.addToPackages</tt> method. If
                      an <tt>InsecureLiftView</tt> class is found,
                      it will attempt to invoke a function on the class
                      corresponding to the second component of the request path.
                      If a <tt>LiftView</tt> class is found, it will
                      invoke the <tt>dispatch</tt> method on the
                      second component of the request path. </li>
                  </ol>
                </li>
                <li> Process the templates by executing snippets, combining
                  templates etc.
                  <ol>
                    <li> Merge  elements, as described in section e<a  href="#sec:Head-Merge"
 class="Reference">↓</a> </li>
                    <li> Update the internal functions map. Basically this
                      associates the user’s Scala functions with tokens that are
                      passed around in subsequent requests using HTTP query
                      parameters. We cover this mechanism in detail in section <a
 href="#sub:Lift-Function-Mapping"  class="Reference">9.3↓</a> </li>
                    <li> Clean up notices (see S.error, S.warning, S.notice)
                      since they were already rendered they are no longer
                      needed. Notices are covered in section <a  href="#cha:Message-Handling"
 class="Reference">B↓</a>. </li>
                    <li> Call <tt>LiftRules.convertResponse</tt>.
                      Basically this glues together different pieces if
                      information such as the actual markup, the response
                      headers, cookies, etc into a LiftResponse instance. </li>
                    <li> Check to see if Lift needs to send HTTP redirect. For
                      an overview please see <a  href="#sec:HTTP-redirects"  class="Reference">3.9↑</a> </li>
                  </ol>
                </li>
                <li> Call <tt>LiftSession.onEndServicing</tt> hooks,
                  the counterparts to
                  <tt>LiftSession.onBeginServicing</tt> </li>
              </ol>
            </li>
            <li> Call <tt>LiftRules.performTransform</tt>. This is
              actually configured via the
              <tt>LiftRules.responseTransformers</tt>
              <tt>RulesSeq</tt>. This is a list of functions on <span  class="formula"><i>LiftResponse</i>  ⇒ <i>LiftResponse</i></span>
              that allows the user to modify the response before it’s sent to
              the client </li>
          </ol>
        </li>
        <li> Call <tt>LiftRules.onEndServicing</tt> hooks. These are
          the stateless end-servicing hooks, called after the S object context
          is destroyed. </li>
        <li> Call any functions defined in
          <tt>LiftRules.beforeSend</tt>. This is the last place
          where you can modify the response before it’s sent to the user </li>
        <li> Convert the <tt>LiftResponse</tt> to a raw byte stream
          and send it to client as an HTTP response. </li>
        <li> Call any functions defined in
          <tt>LiftRules.afterSend</tt>. Typically these would be
          used for cleanup. </li>
      </ol>
      <div  class="Unindented"> We realize that this is a lot of information to
        digest in one pass, so as we continue to cover the specific details of
        the rendering pipeline you may want to keep a bookmark here so that you
        can come back and process the new information in the greater context of
        how Lift is working. </div>
      <div  class="Indented"> Tyler Weir has created a set of diagrams on the
        following two pages that outline Lift’s processing at the global level
        and also for HTTP requests in particular. For the visually-oriented
        these may explain things a bit better.
        <p><br />
        </p>
      </div>
      <div  class="Indented">
        <div  class="float"> <a  name="Figure-9.2"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 7in; max-width: 1186px; height: auto; max-height: 1226px;"
 alt="figure images/lift_request_processing_global.png"  src="./ExploringLift_files/lift_request_processing_global.png"
 class="embedded" /> </div>
            <div  class="caption"> Малюнок 9.2 Lift Global Request Processing </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The “Process HTTP request” step is expanded on the
        following page. </div>
      <div  class="Indented">
        <p><br />
        </p>
      </div>
      <div  class="Indented">
        <div  class="float"> <a  name="Figure-9.3"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: auto; max-width: 1103px; height: 9in; max-height: 1482px;"
 alt="figure images/lift_request_processing_http.png"  src="./ExploringLift_files/lift_request_processing_http.png"
 class="embedded" /> </div>
            <div  class="caption"> Малюнок 9.3 Lift HTTP Request Processing </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <p><br />
        </p>
      </div>
      <h2  class="Section"> <a  name="toc-Section-9.3"  class="toc">9.3</a> 
        Lift Function Mapping<a  name="sub:Lift-Function-Mapping"  class="Label">
        </a> </h2>
      <div  class="Unindented"> As we mentioned in section <a  href="#sec:Form-Fundamentals"
 class="Reference">6.1↑</a>, lift utilizes scala closures and
        functions for almost all processing of client data. Because of this,
        Lift’s ability to associate functions with specific form elements, AJAX
        calls, etc, is critical to its operation. This association of functions,
        commonly known as “mapping” is handled through a combination of request
        parameters, Scala closures and Session data. We feel that understanding
        how mapping works is important if you want to work on advanced topics. </div>
      <div  class="Indented"> At its most basic, mapping of functions is just
        that; a map of the user’s currently defined functions. To simplify
        things, Lift actually uses one of four subclasses of AFuncHolder<span  class="FootOuter"><span
 class="SupFootMarker"> [M] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [M] </span>net.liftweb.http.S.AFuncHolder</span></span>: </div>
      <div  class="Description"> <span  class="Description-entry">BinFuncHolder</span> 
        used for binding functions for file uploading. It will hold a <span  class="formula"><i>FileParamHolder</i> 
          ⇒ <i>Any</i></span> function, which is used to process the file data
        after upload (section <a  href="#sec:File-Uploads"  class="Reference">6.4↑</a>) </div>
      <div  class="Description"> <span  class="Description-entry">SFuncHolder</span> 
        used for binding <span  class="formula"><i>String</i> ⇒ <i>Any</i></span>
        functions. This function corresponds to a single HTTP query parameter,
        except that the parameter name is <i>unique to this request</i> (we’ll
        cover naming shortly) </div>
      <div  class="Description"> <span  class="Description-entry">LFuncHolder</span> 
        used for binding <span  class="formula"><i>List</i>[<i>String</i>] ⇒ <i>Any</i></span>
        functions. This is essentially the same as SFuncHolder but for multiple
        values </div>
      <div  class="Description"> <span  class="Description-entry">NFuncHolder</span> 
        used for binding <span  class="formula">() ⇒ <i>Any</i></span>
        functions. Typically these are used for event callabcks (such as form
        submission) </div>
      <div  class="Unindented"> Wherever Lift takes a function callback it is
        converted to one of these types behind the scenes. Also on the backend,
        each function is assigned a token ID (generated by
        <tt>Helpers.nextFuncName</tt>), which is then added to the
        session, typically via <tt>S.addFunctionMap</tt> or
        <tt>S.mapFunc</tt>. The token is generally used as the form
        element name so that the tokens for a given form are passed back to Lift
        when the form is submitted; in AJAX, the token is used as an HTTP query
        parameter of the AJAX callback from the client JavaScript code. In
        either case, Lift processes the query parameters within
        LiftSession.runParams and executes each associated function in the
        function mapping. </div>
      <div  class="Indented"> As a concrete example, let’s look at a simple
        binding in a form. Listing <a  href="#lst:Function-binding-snippet"  class="Reference">9.3↓</a> shows a small example snippet that will
        request a person’s name and print it out when the person clicks the
        submit button. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Function binding snippet<a  name="lst:Function-binding-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_510520">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">greet (xhtml </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">name </code><code  class="scala keyword">=</code> <code
 class="scala string">""</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">process() </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">println(name)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"form"</code><code
 class="scala plain">, xhtml, </code><code  class="scala string">"name"</code> <code
 class="scala plain">-> SHtml.text(name, name </code><code  class="scala keyword">=</code> <code
 class="scala keyword">_</code><code  class="scala plain">),</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">                      </code><code
 class="scala string">"greet"</code> <code  class="scala plain">-> SHtml.submit(</code><code
 class="scala string">"Greet"</code><code  class="scala plain">, process))</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Listing <a  href="#lst:Function-binding-template"
 class="Reference">9.3↓</a> shows the corresponding template using our
        sample snippet. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Function binding template<a  name="lst:Function-binding-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_816255">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">surround </code><code
 class="scala keyword">with</code><code  class="scala keyword">=</code><code  class="scala string">"default"</code> <code
 class="scala plain">at</code><code  class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">></code></lift<></code></div><code  class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><lift<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">Test.greet form</code><code  class="scala keyword">=</code><code
 class="scala string">"GET"</code><code  class="scala plain">></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><form<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">name /> <form<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">greet /></code></form<></code></form<></code></div><code  class="scala plain"><code
 class="scala plain">
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><code  class="scala keyword">:</code><code  class="scala plain">Test.greet></code></code></div><code
 class="scala plain">
                        <div  class="line number5 index4 alt2"><code  class="scala plain"><code
 class="scala keyword">:</code><code  class="scala plain">surround></code></code></div><code
 class="scala plain">
                      </code></code></code></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Finally, listing <a  href="#lst:Function-binding-result"
 class="Reference">9.3↓</a> shows an example of the resulting HTML
        that’s generated when a user views the template. As you can see, each of
        the elements with callbacks has a corresponding form element with a
        token ID for the name value. Since we’ve used the GET CGI method here
        (we usually recommend using POST in the real world), when we submit the
        form our URL would look like
        <tt>/greet.html?F541542594358JE2=...&F541542594359PM4=Greet</tt>.
        For SFuncHolder mappings the value of the request parameter is passed
        directly. For NFuncHolders the presence of the token in the query
        parameter list is enough to fire the function. For BinFuncHolder and
        LFuncHolder mappings some additional processing is performed to coerce
        the submitted values into proper values for the functions to handle. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Function binding result<a  name="lst:Function-binding-result"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_193985">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><form
 method<=""  code=""><code  class="scala keyword">=</code><code  class="scala string">"get"</code> <code
 class="scala plain">action</code><code  class="scala keyword">=</code><code  class="scala string">"/greet.html"</code><code
 class="scala plain">></code></form></code></div><code  class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><input  name<=""  code="" /><code  class="scala keyword">=</code><code
 class="scala string">"F541542594358JE2"</code> <code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"text"</code> <code  class="scala plain">value</code><code
 class="scala keyword">=</code><code  class="scala string">""</code><code  class="scala plain">/></code></code></div><code
 class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><input  name<=""  code="" /><code  class="scala keyword">=</code><code
 class="scala string">"F541542594359PM4"</code> <code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"submit"</code> <code
 class="scala plain">value</code><code  class="scala keyword">=</code><code  class="scala string">"Greet"</code><code
 class="scala plain">/></code></code></div><code  class="scala plain">
                        <div  class="line number4 index3 alt1"><code  class="scala plain"> </code></div>
                      </code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Normally you do not have to directly deal with the
        function holder classes, since the generator functions in SHtml handle
        that internally. However, if you’re in a situation when you need to bind
        functions by yourself (such as building your own widget where SHtml
        doesn’t provided needed elements), you can use the previously mentioned
        <tt>S.addFunctionMap</tt> or <tt>S.mapFunc</tt>
        to do the “registration” for you. </div>
      <h2  class="Section"> <a  name="toc-Section-9.4"  class="toc">9.4</a> 
        LiftResponse in Detail<a  name="sec:LiftResponse-in-Detail"  class="Label">
        </a> </h2>
      <div  class="Unindented"> In some cases, particularly when using dispatch
        functions (section <a  href="#sec:Custom-dispatch-func"  class="Reference">3.8↑</a>), you may want explicit control over what
        Lift returns to the user. The LiftResponse trait is the base of a
        complete hierarchy of response classes that cover a wide variety of
        functionality, from simply returning an HTTP status code to returning a
        byte stream or your own XML fragments. In this section we’ll cover some
        of the more common classes. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.4.1"  class="toc">9.4.1</a> 
        InMemoryResponse </h3>
      <div  class="Unindented"> The <tt>InMemoryResponse</tt> allows
        you to return an array of bytes directly to the user along with a set of
        HTTP headers, cookies and a response code. An example of using
        <tt>InMemoryResponse</tt> was given in section <a  href="#sec:Custom-dispatch-func"
 class="Reference">3.8↑</a>, showing how we can directly generate a
        chart PNG in memory and send it to the user. This is generally useful as
        long as the data you need to generate and send is relatively small; when
        you start getting into larger buffers you can run into memory
        constraints as well as garbage collection pressure if you’re serving a
        large number of requests. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.4.2"  class="toc">9.4.2</a> 
        StreamingResponse </h3>
      <div  class="Unindented"> The <tt>StreamingResponse</tt> class
        is similar to the <tt>InMemoryResponse</tt>, except that
        instead of reading from a buffer, it reads from an input object. The
        input object is not required to be a subclass of
        <tt>java.io.InputStream</tt>, but rather is only required to
        implement the method “def read(buf: Array[Byte]): Int”<span  class="FootOuter"><span
 class="SupFootMarker">  [N] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [N] </span>This is done with Scala’s structural typing, which we
            don’t cover in this book. For more info, see <a  href="http://scala.sygneca.com/patterns/duck-typing-done-right"
 class="URL">http://scala.sygneca.com/patterns/duck-typing-done-right</a>,
            or the Scala Language Spec, section 3.2.7</span></span>. This allows
        you to essentially send back anything that can provide an input stream.
        Additionally, you can provide a <span  class="formula">() ⇒ <i>Unit</i></span>
        function (cleanup, if you will) that is called when the input stream is
        exhausted. As an example, let’s look at how we could stream a file from
        our WAR back to the client. Listing <a  href="#lst:streaming-download"  class="Reference">9.4.2↓</a> shows how we can retrieve the input
        stream from our classloader and then send it directly to the user. Note
        that you <i>must</i> know the size of the file you’re streaming before
        sending it. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Streaming download method<a  name="lst:streaming-download"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_498746">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">sendFile () </code><code  class="scala keyword">:</code> <code
 class="scala plain">Box[LiftResponse] </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Locate the file and process it</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">LiftRules.getResource(</code><code  class="scala string">"/some-file.txt"</code><code
 class="scala plain">).map { url </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">input </code><code
 class="scala keyword">=</code> <code  class="scala plain">url.openStream()</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">filesize </code><code
 class="scala keyword">=</code> <code  class="scala plain">... </code><code  class="scala comments">// must compute or predetermine this.</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">StreamingResponse(inPipe,</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">                      </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> { input.close },</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">                      </code><code
 class="scala plain">filesize,</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">                      </code><code
 class="scala plain">(Content-Type -> </code><code  class="scala string">"text/plain"</code><code
 class="scala plain">) </code><code  class="scala keyword">::</code> <code  class="scala plain">Nil,</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">                      </code><code
 class="scala plain">Nil,</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">                      </code><code
 class="scala value">200</code><code  class="scala plain">)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that we use the cleanup function to close the
        input stream once we’re done so that we make sure to release resources.
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.4.3"  class="toc">9.4.3</a> 
        Hierarchy </h3>
      <div  class="Unindented"> The Lift framework makes a lot of things really
        easy and it provides extremly useful abstractions as you may have
        already discovered. Responses to clients are also abstacted by
        <tt>LiftResponse</tt> trait. There are numerous response
        types and here is the simplified view of the class hierarchy: </div>
      <ul>
        <li> LiftResponse
          <ul>
            <li> BasicResponse
              <ul>
                <li> InMemoryResponse </li>
                <li> StreamingResponse </li>
              </ul>
            </li>
            <li> JSonResponse </li>
            <li> RedirectResponse
              <ul>
                <li> RedirectWithState </li>
              </ul>
            </li>
            <li> ToResponse
              <ul>
                <li> XhtmlRespomse </li>
                <li> XmlResponse </li>
                <li> XmlMimeResponse </li>
                <li> AtomResponse </li>
                <li> OpenSearchResponse </li>
                <li> AtomCreatedResponse </li>
                <li> AtomCategoryResponse </li>
                <li> AtomServiceResponse </li>
                <li> CreatedResponse </li>
              </ul>
            </li>
            <li> OkResponse </li>
            <li> PermRedirectResponse </li>
            <li> BadResponse </li>
            <li> UnauthorizedResponse </li>
            <li> UnauthorizedDigestResponse </li>
            <li> NotFoundResponse </li>
            <li> MethodNotAllowedResponse </li>
            <li> GoneResponse </li>
          </ul>
        </li>
      </ul>
      <div  class="Unindented"> We won’t get into details right now on what
        exactly each and every class/object does, although their purpose is
        given away by their names. It is important to know that whenever you
        need to return a <tt>LiftResponse</tt> reference from one of
        your functions, for example <tt>LiftRules.dispatch</tt> you
        can you can use one of these classes. Lift doesn’t really provide the
        HttpServletResponse object, instead all responses are impersonated by a
        <tt>LiftResponse</tt> instance and it content (the actual
        payload, http headers, content-type, cookies etc.) is written internally
        by Lift to the container’s output stream. </div>
      <div  class="Indented"> Still let’s take a look at a few examples </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.4.4"  class="toc">9.4.4</a> 
        RedirectWithState </h3>
      <div  class="Unindented">
        <div  class="listing">
          <div  class="caption"> RedirectWithState example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_218738">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Assume you boot function</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">MessageState.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">boot </code><code  class="scala keyword">=</code> <code  class="scala plain">{ </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">LiftRules.dispatch.prepend {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(</code><code  class="scala string">"redirect1"</code> <code
 class="scala keyword">::</code> <code  class="scala keyword">_</code><code  class="scala plain">, </code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">_</code><code
 class="scala plain">) </code><code  class="scala keyword">=</code><code  class="scala plain">> () </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Full(RedirectWithState(</code><code  class="scala string">"/page1"</code><code
 class="scala plain">, </code><code  class="scala string">"My error"</code> <code
 class="scala plain">-> Error))</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(</code><code  class="scala string">"redirect2"</code> <code
 class="scala keyword">::</code> <code  class="scala keyword">_</code><code  class="scala plain">, </code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">_</code><code
 class="scala plain">) </code><code  class="scala keyword">=</code><code  class="scala plain">> () </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Full(RedirectWithState(</code><code  class="scala string">"/page2"</code><code
 class="scala plain">, </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">                           </code><code
 class="scala plain">RedirectState(() </code><code  class="scala keyword">=</code><code
 class="scala plain">> println(</code><code  class="scala string">"Called on redirect!"</code><code
 class="scala plain">), </code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">                                         </code><code
 class="scala string">"My error"</code> <code  class="scala plain">-> Error)))     </code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> First of all we added a DispatchPF function that
        pattern matches for paths starting with <tt>redirect1</tt>
        and <tt>redirect2</tt>. Let’s see what happens in each case.
      </div>
      <ul>
        <li> <tt>redirect1</tt> - We are returning a
          RedirectWithState response. It will do HTTP redirect towards /page1
          and the state is impersonated by the tuple “MyError” -> Error.
          Because MessageState object holds an implicit conversion function from
          Tuple2 to MessageState it suffices to just provide the tuple here.
          Essentially we are saying here that when the browser sends the
          redirect request to server we already have an Error notice set up and
          the <lift:msgs> tag from your /page1 will show this “My error”
          error message. </lift:msgs></li>
        <li> <tt>redirect2</tt> - Similarly it does an HTTP redirect
          to browser towards your /page2. But we are passing now a RedirectState
          object. This object holds a () => Unit function that will be
          executed when browser send the redirect request and the Notices
          impersonated by a repeated parameter (String, NoticeType.Value)*. In
          fact the mapping between the actual message and its type: Notice,
          Warning or Error. </li>
      </ul>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.4.5"  class="toc">9.4.5</a> 
        XmlResponse </h3>
      <div  class="Unindented">
        <div  class="listing">
          <div  class="caption"> XmlResponse example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_924600">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Assume you boot function</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">boot </code><code  class="scala keyword">=</code> <code  class="scala plain">{ </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">LiftRules.dispatch.prepend {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(</code><code  class="scala string">"rest"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil, </code><code  class="scala keyword">_</code><code
 class="scala plain">, </code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">> () </code><code  class="scala keyword">=</code><code
 class="scala plain">> Full(XmlResponse(</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala plain"><persons></persons></code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">            </code><code
 class="scala plain"><name>John</name></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">            </code><code
 class="scala plain"><name>Jane</name></code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">        </code><code
 class="scala plain"></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">))</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> When you are receiving a request with the path
        /rest the code is returning an XML response. The content-type and
        everything else is taken care of by XmlResponse. You can build much more
        complex REST API’s an return XML response which is probably mot commonly
        used. </div>
      <h2  class="Section"> <a  name="toc-Section-9.5"  class="toc">9.5</a> 
        Session Management <a  name="sec:Session-Management"  class="Label"> </a>
      </h2>
      <div  class="Unindented"> Lift is a stateful framework and naturally this
        state needs to be managed. You may already be familiar with HttpSession
        and and how a J(2)EE web container identifies an HttpSession; either by
        a JSESSIONID cookie or by a JSESSIONID URI sequence (in case of URL
        rewriting). Similarly, Lift uses a LiftSession reference which is not
        actually “persisted” in HttpSession. As a matter of fact Lift does not
        really use the HttpSession provided by the web container to maintain
        conversational state, but rather uses a bridge between the
        <tt>HttpSession</tt> and the
        <tt>LiftSession</tt>. This bridge is impersonated by
        <tt>SessionToServletBridge</tt> class which implements <i>javax.servlet.http.HttpSessionBindingListener</i>
        and <i>javax.servlet.http.HttpSessionActivationListener</i> and works
        like this: </div>
      <ol>
        <li> When receiving an HTTP Request and there was no stateless dispatch
          function to execute, Lift does the stateful processing. But before
          doing that it checks to see if there is a
          <tt>LiftSession</tt> associated with this HTTP session ID.
          This mapping is kept on a SessionMaster Scala actor. </li>
        <li> If there is no associated LiftSession in the SessionMaster actor,
          create it and add a SessionToServletBridge attribute on HttpSession.
          This will make Lift aware of the session when the container terminates
          the HttpSession or when the HTTP session is about to be passivated or
          activated. </li>
        <li> When the container terminates the HTTP session,
          SessionToServletBridge sends a message to the SessionMaster Actor to
          terminate the LiftSession, which includes the following steps:
          <ol>
            <li> Call any defined LiftSession.onAboutToShutdownSession hooks </li>
            <li> Send a ShutDown message to all Comet Actors pertaining to this
              session </li>
            <li> Clean up any internal LiftSession state </li>
            <li> Call LiftSession.onShutdownSession hooks </li>
          </ol>
        </li>
      </ol>
      <div  class="Unindented"> The SessionMaster Actor is also protected by
        another watcher Actor. This watcher Actor receives the Exit messages of
        the watched Actors. When it receives an Exit message it will call the
        users’ failure functions and restart the watched actor (Please see
        ActorWatcher.failureFuncs). </div>
      <div  class="Indented"> Even while Lift is handling session management you
        still have the ability to manually add attributes to the HttpSession
        object. We do not recommend this unless you really must. A simpler way
        to keep your own session variables, is to use
        <tt>SessionVar</tt>s. For more details about SessionVar
        please see the fundamental chapter <a  href="#sec:Session-and-Request"  class="Reference">3.11↑</a> </div>
      <div  class="Indented"> The next question would probably be “So we have
        internal session management, how do we cope with that in a clustered
        environment? ... how are sessions replicated?” the answer is, they
        aren’t. There is no intention to use the web container’s session
        replication as these technologies appears to be inferior to other
        solutions on the market. Relying on Java serialization brings a lot of
        performance concerns and alternative technologies have been investigated
        and they are still under investigation. Until there is a standard
        session replication technology you can still cluster you application
        using “sticky session”. This meas that all requests pertaining to a HTTP
        session must be processed by the same cluster node. This can be done by
        software or hardware load balancers, as they would dispatch the requests
        based on JSESSIONID cookie. Another approach is that the dispatching is
        done based on some URI or query parameters. For example, a query
        parameter like serverid=1 is configured in the load balancer to always
        be dispatched to the node 1 of the cluster, and so on. There are some
        downsides for the sticky session approach. For instance you are logged
        in the application and do your stuff. Suddenly the node designated to
        your session crashes. At this moment you lost your session. The next
        subsequent request would be automatically dispatched by the load
        balancer to another cluster node and depending how your application is
        built this may mean that you need to log in again or if part of the
        state was persisted in DB you may resume your work from some point
        avoiding re-login ... but this is application specific behavior that is
        beyond the scope of this discussion. The advantages of sticky sessions
        are related with application performance since in this model the state
        does not need to be replicated in all cluster nodes which for
        significant state information can be quite time/resources consuming. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.5.1"  class="toc">9.5.1</a> 
        Lift garbage collection </h3>
      <div  class="Unindented"> As you have seen, Lift tailors Scala functions
        with client side artifacts (XHTML input elements, Ajax requests etc.).
        Naturally these functions are kept into the session state. Also for
        every rendered page, a page ID is generated and functions bound for
        these pages as asociated with this page ID. In order to prevent
        accumulation of such mappings, Lift has a mechanism of purging unused
        functions. Basically the idea is </div>
      <ol>
        <li> On client side, a script periodically sends to the server an Ajax
          request impersonating a lift GC request. </li>
        <li> On service side Lift updates the timestamps of the functions
          associated with this page ID. The functions older then
          <tt>LiftRules.unusedFunctionsLifeTime</tt> (default value
          is 10 minutes) become eligible for garbage collection as they are
          de-referenced from the current session. The frequency of such Ajax
          requests is given by
          <tt>LiftRules.liftGCPollingInterval</tt>. By default it is
          set to 75 seconds. </li>
        <li> Each Ajax request contains includes the page ID as new function may
          be bound as a result of processing the Ajax request, dependin on the
          application code. Such function that are dynamically bound are
          automatically associated with the same page ID. </li>
      </ol>
      <div  class="Unindented"> You can of course turn off this garbage
        collection mechanism by setting <tt>LiftRules.enableLiftGC =
        false</tt> typically in your Boot. You can also fine tune the
        garbage collection mechanims to fit your application needs, by changing
        the default LiftRules variables. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> LiftRules gabage collection variables </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_437071">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">/**    </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* By default lift uses a garbage-collection mechanism of removing </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* unused bound functions from LiftSesssion</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* Setting this to false will disable this mechanims and there will </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* be no Ajax polling request attempted.    </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">enableLiftGC </code><code  class="scala keyword">=</code> <code
 class="scala keyword">true</code><code  class="scala plain">;</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala comments">/**    </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* If Lift garbage collection is enabled, functions that are not seen </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* in the page for this period of time (given in milliseonds) will be</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* discarded, hence eligible for garbage collection. The default value</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* is 10 minutes.    </code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code>  </div>
                        <div  class="line number15 index14 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">unusedFunctionsLifeTime</code><code  class="scala keyword">:</code> <code
 class="scala plain">Long </code><code  class="scala keyword">=</code> <code  class="scala value">10</code> <code
 class="scala plain">minutes</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala comments">/**    </code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* The polling interval for background Ajax requests to prevent</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* functions of being garbage collected.   </code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* Default value is set to 75 seconds.</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code>  </div>
                        <div  class="line number22 index21 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">liftGCPollingInterval</code><code  class="scala keyword">:</code> <code
 class="scala plain">Long </code><code  class="scala keyword">=</code> <code  class="scala value">75</code> <code
 class="scala plain">seconds</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala comments">/**   </code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* The polling interval for background Ajax requests to prevent functions</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* of being garbage collected.  </code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* This will be applied if the Ajax request will fail. Default value is</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* set to 15 seconds.  </code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">liftGCFailureRetryTimeout</code><code  class="scala keyword">:</code> <code
 class="scala plain">Long </code><code  class="scala keyword">=</code> <code  class="scala value">15</code> <code
 class="scala plain">seconds </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-9.6"  class="toc">9.6</a> 
        Miscellaneous Lift Features </h2>
      <div  class="Unindented"> In this section we will discuss various features
        that can prove helpful in building rich Lift applications. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.6.1"  class="toc">9.6.1</a> 
        Wrapping Lift’s processing logic<a  name="sub:Wrapping-Lift's-processing"
 class="Label"> </a> </h3>
      <div  class="Unindented"> Lift provides the ability to allow user
        functions to be part of processing lifecycle. In these cases Lift allows
        you to provide your own functions and the actual Lift’s processing
        function is passed to your function. Hence your own function is
        responsible of calling the actual Lift’s processing logic. </div>
      <div  class="Indented"> But let’s see how exactly you can do this.
        <div  class="listing">
          <div  class="caption"> LoanWrapper example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_401006">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {   </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot {    </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...   </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">S.addAround(</code><code  class="scala keyword">new</code> <code
 class="scala plain">LoanWrapper { </code><code  class="scala comments">// Y   </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">def</code> <code  class="scala plain">apply[T](f</code><code
 class="scala keyword">:</code> <code  class="scala keyword">=</code><code  class="scala plain">> T)</code><code
 class="scala keyword">:</code> <code  class="scala plain">T </code><code  class="scala keyword">=</code> <code
 class="scala plain">{   </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(</code><code  class="scala string">"Y -> hello to the request!"</code><code
 class="scala plain">)  </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">val</code> <code  class="scala plain">result </code><code
 class="scala keyword">=</code> <code  class="scala plain">f </code><code  class="scala comments">// Let Lift do normal request processing.   </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(</code><code  class="scala string">"Y -> goodbye!"</code><code
 class="scala plain">)  </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">result   </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}   </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">})   </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">S.addAround(</code><code  class="scala keyword">new</code> <code
 class="scala plain">LoanWrapper { </code><code  class="scala comments">// X   </code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">def</code> <code  class="scala plain">apply[T](f</code><code
 class="scala keyword">:</code> <code  class="scala keyword">=</code><code  class="scala plain">> T)</code><code
 class="scala keyword">:</code> <code  class="scala plain">T </code><code  class="scala keyword">=</code> <code
 class="scala plain">{   </code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(</code><code  class="scala string">"X -> hello to the request!"</code><code
 class="scala plain">)   </code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">val</code> <code  class="scala plain">result </code><code
 class="scala keyword">=</code> <code  class="scala plain">f </code><code  class="scala comments">// Let Lift do normal request processing.   </code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(</code><code  class="scala string">"X -> goodbye!"</code><code
 class="scala plain">)   </code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">result</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}   </code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">})   </code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">}  </code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The code looks pretty straight-forward in the
        sense that we add two <tt>LoanWrapper</tt> instances to the
        <tt>S</tt> object. (Note that we’re using the
        <tt>S</tt> object not <tt>LiftRules</tt> meaning
        that <tt>LoanWrapper</tt>s are applicable only for stateful
        processing. See <a  href="#sec:Request/Response-Lifecycle"  class="Reference">9.2↑</a> for when exactly
        <tt>LoanWrapper</tt>s are invoked.) </div>
      <div  class="Indented"> So let’s see what happens when the above code
        processess a request from a client. You can think of the invocation
        sequence as <tt>X(Y(f))</tt> where f is the Lift function
        that impersonates the core processing. Therefore you’ll see the
        following output in the console: </div>
      <div  class="Indented">
        <div  class="listing">
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_167848">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">X -> hello to the request!</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">Y -> hello to the request!</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain"><lift’s
 logic=""  ...=""  whatever=""  is=""  printed=""  here=""></lift’s></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">Y -> goodbye!</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">X -> goodbye!</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> This feature allows you use a resource before Lift
        does and release them after Lift has finished processing the stateful
        request and before the LiftResponse object is constructed. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.6.2"  class="toc">9.6.2</a> 
        Passing Template Parameters to Snippets<a  href="#index-Parameters"  name="entry-Parameters-0"
 class="IndexReference">↓</a><a  href="#index-Snippet-parameters"  name="entry-Snippet-parameters-0"
 class="IndexReference">↓</a> </h3>
      <div  class="Unindented"> In addition to the standard attributes for
        snippets, outlined in Розділ <a  href="#sub:snippet-tag"  class="Reference">5.1↑</a>, you can set your own attributes on the
        snippet element. Attributes used in this manner are called “parameters”.
        Listing <a  href="#lst:Snippet-parameter-template"  class="Reference">9.6.2↓</a> shows us setting a
        <tt>default</tt> parameter on our
        <tt>Ledger.balance</tt> snippet. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Snippet-parameter-template"  class="Label">
            </a>Defining a Snippet Parameter </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_385969">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift<
 code=""><code  class="scala keyword">:</code><code  class="scala plain">Ledger.balance default</code><code
 class="scala keyword">=</code><code  class="scala string">"10"</code><code  class="scala plain">></code></lift<></code></div><code
 class="scala plain">
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><ledger<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">balance/> as of <ledger<  code=""><code  class="scala keyword">:</code><code
 class="scala plain">time /></code></ledger<></code></ledger<></code></div><code
 class="scala plain"><code  class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala plain"><code
 class="scala keyword">:</code><code  class="scala plain">Ledger.balance></code></code></div><code
 class="scala plain">
                      </code></code></code></code></div><code  class="scala plain"><code
 class="scala plain">
                    </code></code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The <tt>S.attr</tt> function allows us
        to access all parameters defined on the snippet element itself, as shown
        in Listing <a  href="#lst:Snippet-parameter-code"  class="Reference">9.6.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Snippet-parameter-code"  class="Label">
            </a>Accessing a Snippet Parameter </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_829442">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Ledger {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">balance (content </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq ) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">dflt </code><code  class="scala keyword">=</code> <code
 class="scala plain">S.attr(</code><code  class="scala string">"default"</code><code
 class="scala plain">) openOr </code><code  class="scala string">"0"</code><code
 class="scala plain">;</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">bind (</code><code  class="scala string">"ledger"</code><code
 class="scala plain">, content,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">          </code><code
 class="scala string">"balance"</code> <code  class="scala plain">-> Text(currentLegdger.formattedBalance),</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">          </code><code
 class="scala string">"time"</code> <code  class="scala plain">-> Text((</code><code
 class="scala keyword">new</code> <code  class="scala plain">java.util.Date).toString))</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.6.3"  class="toc">9.6.3</a> 
        Computing Attributes with Snippets<a  href="#index-Attributes-computing-via-snippet"
 name="entry-Attributes-computing-via-snippet-0"  class="IndexReference">↓</a>
      </h3>
      <div  class="Unindented"> You can use snippets to compute tag attributes,
        as shown in Listing <a  href="#lst:Using-a-Snippet-compute-attr"  class="Reference">9.6.3↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Using-a-Snippet-compute-attr"  class="Label">
            </a>Using a Snippet to Compute an Attribute </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_859896">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// In your page you can have</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain"><div
 lift<=""  code=""><code  class="scala keyword">:</code><code  class="scala plain">snippet</code><code
 class="scala keyword">=</code><code  class="scala string">"MyDivThing:calcDir"</code><code
 class="scala plain">> ... </code></div></code></div><code  class="scala plain">
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala comments">// Your snippet</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">MyDivThing {   </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">calcDir </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">UnprefixedAttribute(</code><code
 class="scala string">"dir"</code><code  class="scala plain">, </code><code  class="scala string">"rtl"</code><code
 class="scala plain">, Null)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">} </code></div>
                      </code></div><code  class="scala plain">
                    </code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.6.4"  class="toc">9.6.4</a> 
        Processing Element Attributes<a  href="#index-Attributes-retrieving-from-elements"
 name="entry-Attributes-retrieving-from-elements-0"  class="IndexReference">↓</a>
      </h3>
      <div  class="Unindented"> Now we have seen how we can pass xml parameters
        to snippets but what if we want to pass parameters on the nodes that
        will be bound? For instance, we may want to pass the am/pm information
        on the time element such as: </div>
      <pre  class="LyX-Code"><tt><ledger:time  ampm="”true”/"> </ledger:time></tt>
</pre>
      <div  class="Unindented"> to control the time display format. Listing <a  href="#lst:Element-attribute-retrieval"
 class="Reference">9.6.4↓</a> shows how we can use the
        <tt>BindHelpers</tt> object to retrieve the current
        element’s attributes. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Retrieving Element Attributes with BindHelpers<a
 name="lst:Element-attribute-retrieval"  class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_113380">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Ledger {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">balance (content </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq ) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">dflt </code><code  class="scala keyword">=</code> <code
 class="scala plain">S.attr(</code><code  class="scala string">"default"</code><code
 class="scala plain">) openOr </code><code  class="scala string">"0"</code><code
 class="scala plain">;</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">bind (</code><code  class="scala string">"ledger"</code><code
 class="scala plain">, content,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">          </code><code
 class="scala string">"balance"</code> <code  class="scala plain">-> Text(currentLegdger.formattedBalance),</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">          </code><code
 class="scala string">"time"</code> <code  class="scala plain">-> {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">node</code><code  class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code><code  class="scala plain">> println(BindHelpers.attr(</code><code
 class="scala string">"ampm"</code><code  class="scala plain">)); </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">Text((</code><code  class="scala keyword">new</code> <code
 class="scala plain">java.util.Date).toString))</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">})</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> You can use the <tt>BindHelpers</tt>
        object for obtaining information about node attributes. This context is
        maintained internally using <tt>ThreadLocal</tt>s and
        closures. Note that the context is cleared after the bind method is
        executed. In our example above for “time” node we are actually binding a
        function that takes the child nodes of the
        <tt><ledger:time></ledger:time></tt> node. When our function is
        called by Lift we can access the BindHelpers, such ass the attributes of
        the current node. The sequence <tt><string> ->
        <right-hand-side-expression></right-hand-side-expression></string></tt> is turned into a BindParam
        object using implicit conversions. It is important to note that
        BindParam.calcValue function is called in the correct context so that
        BindHelpers can be safely used. </div>
      <h2  class="Section"> <a  name="toc-Section-9.7"  class="toc">9.7</a> 
        Advanced S Object Features<a  name="sub:Advanced-S-Object"  class="Label">
        </a> </h2>
      <div  class="Unindented"> The <tt>S</tt>, or Stateful, object
        is a very important part of Lift. The S context is created when a client
        request is recieved that needs to be handled as a stateful reuest.
        Please see <a  href="#sec:Request/Response-Lifecycle"  class="Reference">9.2↑</a> for more details on the state creation and
        handling. The actual state information is kept inside the S object using
        ThreadLocal<span  class="FootOuter"><span  class="SupFootMarker"> [O] </span><span
 class="HoverFoot"><span  class="SupFootMarker"> [O] </span>java.lang.ThreadLocal</span></span>
        variables since <tt>S</tt> is a singleton. This means that
        if you have any code that is executed in the stateful context you can
        safely use any <tt>S</tt> object goodies, which include: </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.7.1"  class="toc">9.7.1</a> 
        Managing cookies </h3>
      <div  class="Unindented"> You can retrieve cookies from the request or set
        cookies to be sent in the response. Cookies are covered in section <a  href="#sec:Cookies"
 class="Reference">3.10↑</a>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.7.2"  class="toc">9.7.2</a> 
        Localization and Internationalization </h3>
      <div  class="Unindented"> Localization (also called L10N) and
        Internationalization (also called I18N) are very important aspects of
        many web applications that deal with different languages. These topics
        are covered in chapter <a  href="#cha:Internationalization"  class="Reference">D↓</a>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.7.3"  class="toc">9.7.3</a> 
        Managing the Timezone </h3>
      <div  class="Unindented"> The<tt> S.timeZone</tt> function
        returns the current timezone as computed by the<br />
        <tt>LiftRules.timeZoneCalculator</tt> function. By default,
        the <tt>LiftRules</tt> method simply executes
        TimeZone.getDefault, but you can provide your own <span  class="formula"><i>Box</i>[<i>HttpServletRequest</i>]
           ⇒ <i>TimeZone</i></span> partial function to define your own
        behavior. Examples would include allowing users to choose their own
        timezone, or to use geographic lookup of the user’s IP address. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.7.4"  class="toc">9.7.4</a> 
        Per-session DispatchPF functions </h3>
      <div  class="Unindented"> You can set DispatchPF functions that operate in
        the context of a current session. Essentially you can bind DispatchPF
        functions with a given name. Relevant functions are: </div>
      <ul>
        <li> <tt>S.highLevelSessionDispatcher</tt> - returns a
          <tt>List[LiftRules.DispatchPF]</tt> </li>
        <li> <tt>S.highLevelSessionDispatchList</tt> - returns a
          <tt>List[DispatchHolder] </tt></li>
        <li> <tt>S.addHighLevelSessionDispatcher </tt>- maps a name
          with a given <tt>DispatchPF</tt> </li>
        <li> <tt>S.removeHighLevelSessionDispatcher</tt> - removes
          the <tt>DispatchPF</tt> given its name </li>
        <li> <tt>S.clearHighLevelSessionDispatcher</tt> - removes
          all <tt>DispatchPF</tt> associations </li>
      </ul>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.7.5"  class="toc">9.7.5</a> 
        Session re-writers </h3>
      <div  class="Unindented"> Session re-writers are per session functions
        that allow you to modify a HTTP request (URI, query parameters etc.)
        before the request is actually processed. This is similar with
        LiftRules.rewrite variable but you can apply rewriters per a given
        session. Hence you can have different rewrites in diferent contexts. The
        relevant functions are: </div>
      <ul>
        <li> <tt>S.sessionRewriter</tt> - returns a<tt>
          List[RewriteHolder]</tt> </li>
        <li> <tt>S.addSessionRewriter</tt> - maps a
          <tt>LiftRules.RewritePF </tt>with a given name </li>
        <li> <tt>S.removeSessionRewriter</tt> - removes a rewriter
          by a name </li>
        <li> <tt>S.clearSessionRewriter</tt> - remove all session
          rewriters. </li>
      </ul>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.7.6"  class="toc">9.7.6</a> 
        Access to HTTP headers </h3>
      <div  class="Unindented"> Accessing HTTP header parameters from the
        request and adding HTTP header parameters to the HTTP response represent
        very common operations. You can easily perform these operations using
        the following functions: </div>
      <ul>
        <li> <tt>S.getHeaders</tt> - returns a
          <tt>List[(String, String)] </tt>containing all HTTP
          headers grouped by name and value pair </li>
        <li> <tt>S.setHeader</tt> - sets a HTTP header parameter by
          specifying the name and value pair </li>
      </ul>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.7.7"  class="toc">9.7.7</a> 
        Manage the document type </h3>
      <div  class="Unindented"> You can also read and write the XML document
        type set for the current response. You can use the following functions:
      </div>
      <ul>
        <li> <tt>S.getDocType</tt> - returns the doc type that was
          set forthe current response </li>
        <li> <tt>S.setDocType</tt> - sets a document type for the
          curent response object. </li>
      </ul>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.7.8"  class="toc">9.7.8</a> 
        Other functions </h3>
      <ul>
        <li> Access to the raw HttpServletRequest and HttpSession if you really
          need it. </li>
        <li> Managing the function map. The function map generates an
          association between a String and a function. This string represents a
          query parameter that when Lift receives upon a HTTP request, it will
          execute your function. Normally these names are auto-generated by Lift
          but you can also provide you own name. Please see <a  href="#sub:Lift-Function-Mapping"
 class="Reference">9.3↑</a> for more details. </li>
        <li> Managing wrappers - see <a  href="#sub:Wrapping-Lift%27s-processing"
 class="Reference">9.6.1↑</a> </li>
        <li> Managing notices - see <a  href="#sub:Notices/Warnings/Errors-messages"
 class="Reference">3.6↑</a> </li>
        <li> Managing HTTP redirects - see S.redirectTo functions and <a  href="#sec:LiftResponse-in-Detail"
 class="Reference">9.4↑</a> </li>
        <li> Using XML attibutes of a snippet - see <a  href="#sub:Additional-Snippet-Features"
 class="Reference">↓</a> </li>
      </ul>
      <h2  class="Section"> <a  name="toc-Section-9.8"  class="toc">9.8</a> 
        ResourceServer<a  name="sub:ResourceServer"  class="Label"> </a> </h2>
      <div  class="Unindented"> ResourceServer is a Lift component that manages
        the serving of resources like JS, CSS etc. Well the web container can do
        that right? ... still container does not serve these resources if they
        are inside jar files. The default URI path for serving such resources is
        given by<tt> LiftRules.resourceServerPath</tt> variable
        which by default it is set to “classpath”. The folder location where the
        resource is looked up inside jar files is given by
        <tt>ResourceServer.baseResourceLocation</tt> variable which
        by default it is set to “toserve”. Let’s assume the following folder
        structure inside you Lift project: </div>
      <div  class="Indented">
        <tt>lift-proj/src/main/resources/toserve/css/mystyle.css</tt>
      </div>
      <div  class="Indented"> Maven will create the toserver folder in the
        jar/war file generated. Then in your web page you add something like: </div>
      <div  class="Indented"> <tt><link  rel="stylesheet"  href="/classpath/css/mystyle.css"
 type="text/css" /></tt> </div>
      <div  class="Indented"> Because the first URI part matches with
        <tt>LiftRules.resourceServerPath</tt> Lift will tell
        ResouceServer to load this resource from ’toserve’ folder. But it will
        fail. There is one thing left to do. We need to tell ResouceServer to
        allow the loading of mystyle.css resource. We can do this from Boot by
        calling: </div>
      <div  class="Indented"> <tt>ResourceServer.allow { </tt> </div>
      <div  class="Indented"> <tt>case "css" :: _ => true </tt> </div>
      <div  class="Indented"> <tt>}</tt> </div>
      <div  class="Indented"> We basically told Lift here to allow any resource
        found in css folder under toserve. Note that toserver comes from
        <tt>ResourceServer.baseResourceLocation</tt> which can be
        changed. </div>
      <h2  class="Section"> <a  name="toc-Section-9.9"  class="toc">9.9</a> 
        HTTP Authentication<a  name="sub:HTTP-Authentication"  class="Label"> </a><a
 href="#index-HTTP-authentication"  name="entry-HTTP-authentication-0"  class="IndexReference">↓</a><a
 href="#index-Authentication"  name="entry-Authentication-0"  class="IndexReference">↓</a> </h2>
      <div  class="Unindented"> HTTP authentication is described by RFC 2617 <span
 class="FootOuter"><span  class="SupFootMarker"> [P] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [P] </span><a  href="http://www.isi.edu/in-notes/rfc2617.txt"
 class="FlexURL">http://www.isi.edu/in-notes/rfc2617.txt</a></span></span>.
        It describes the means of protecting server resources and allowing
        access only to authorized entities. As you may know, any J(2)EE web
        container provides HTTP authentication support using JAAS<span  class="FootOuter"><span
 class="SupFootMarker"> [Q] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Q] </span>Java Authentication and Authorization Service. More
            information can be found at <a  href="http://java.sun.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html"
 class="FlexURL">http://java.sun.com/javase/6/docs/technotes/guides/security/jaas/JAASRefGuide.html</a></span></span><a
 href="#index-Authentication-JAAS"  name="entry-Authentication-JAAS-0"  class="IndexReference">↓</a>.
        However, this approach has limitations. For example, if you provide your
        own <tt>LoginModule</tt> or
        <tt>CallbackHandler</tt> implementation this will not be
        loaded by the web application classloader but instead by the container
        classloader (at least in tomcat). This can lead to dependency loading
        issues since the web application classloader sits below the container’s
        classloader in the delegation chain. Lift, however, provides supports
        for both basic and digest authentications via a simplified,
        scala-oriented API that you can use directly. This API provides not only
        direct support for the HTTP authentication mechanisms, but also a path
        and role based authorization mechanism. The following sections show how
        we use basic authentication to protect our REST API (Глава <a  href="#cha:Web-Services"
 class="Reference">15 on page 1↓</a>). </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.9.1"  class="toc">9.9.1</a> 
        Determining which Resources to Protect </h3>
      <div  class="Unindented"> The first thing we need to do is tell Lift which
        resources are protected by authentication. This is done by configuring
        <tt>LiftRules.httpAuthProtectedResources<a  href="#index-httpAuthProtectedResources"
 name="entry-httpAuthProtectedResources-0"  class="IndexReference">↓</a></tt>
        with one or more <tt>PartialFunction[Req,Box[Role]]</tt><span  class="FootOuter"><span
 class="SupFootMarker"> [R] </span><span  class="HoverFoot"><span  class="SupFootMarker">  [R] </span><tt>net.liftweb.http.auth.Role</tt></span></span>
        to match on the request. Listing <a  href="#lst:HTTP-auth-define-resources"
 class="Reference">9.9.1↓</a> shows the PartialFunction defined in our
        <tt>DispatchRestAPI</tt> object (Розділ <a  href="#sub:REST-Custom-Dispatch"
 class="Reference">15.4.1 on page 1↓</a>) used to protect our REST API
        from unauthorized access. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Defining Protected Resources<a  name="lst:HTTP-auth-define-resources"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_348210">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// We explicitly protect GET and PUT requests in our REST API</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.auth.AuthRole</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">protection </code><code  class="scala keyword">:</code> <code
 class="scala plain">LiftRules.HttpAuthProtectedResourcePF </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"account"</code><code
 class="scala plain">, accountId), </code><code  class="scala keyword">_</code><code
 class="scala plain">, PutRequest) </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">     </code><code
 class="scala plain">Full(AuthRole(</code><code  class="scala string">"editAcct:"</code> <code
 class="scala plain">+ accountId))</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"account"</code><code
 class="scala plain">, accountId), </code><code  class="scala keyword">_</code><code
 class="scala plain">, GetRequest) </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">     </code><code
 class="scala plain">Full(AuthRole(</code><code  class="scala string">"viewAcct:"</code> <code
 class="scala plain">+ accountId))</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// If the account is public, don’t enforce auth</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"expense"</code><code
 class="scala plain">, Expense(e, </code><code  class="scala keyword">true</code><code
 class="scala plain">)), </code><code  class="scala keyword">_</code><code  class="scala plain">, GetRequest) </code><code
 class="scala keyword">=</code><code  class="scala plain">> Empty</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"expense"</code><code
 class="scala plain">, Expense(e, </code><code  class="scala keyword">_</code><code
 class="scala plain">)), </code><code  class="scala keyword">_</code><code  class="scala plain">, GetRequest) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Full(AuthRole(</code><code  class="scala string">"viewAcct:"</code> <code
 class="scala plain">+ e.account.obj.open</code><code  class="scala keyword">_</code><code
 class="scala plain">!.id))</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The <tt>PartialFunction</tt> matches
        on the <tt>Req</tt> and can either return an
        <tt>Empty</tt>, indicating that the given request does not
        require authentication, or a <tt>Full[Role]</tt>, that
        indicates which R<tt>ole</tt> a user requires to be
        authorized to access the given resource. One important thing to remember
        is that HTTP authentication and SiteMap access control (Розділ <a  href="#sec:SiteMap-Access-Control"
 class="Reference">7.3 on page 1↑</a>) are synergistic, so make sure
        that you configure both properly. We will discuss
        <tt>Role</tt>s further in Розділ <a  href="#sub:Role-Hierarchies"  class="Reference">9.9.3↓</a>, but for now you can simply consider
        them as <tt>String</tt> attributes associated with the
        current session. Once we’ve defined which resources are to be protected,
        we need to hook our <tt>PartialFunction</tt> into
        <tt>LiftRules</tt> in the <tt>Boot.boot</tt>
        method, shown in Listing <a  href="#lst:Hooking-Resource-Protection"  class="Reference">9.9.1↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Hooking Resource Protection<a  name="lst:Hooking-Resource-Protection"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_177557">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Hook in our REST API auth</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">LiftRules.httpAuthProtectedResource.append(DispatchRestAPI.protection)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.9.2"  class="toc">9.9.2</a> 
        Providing the Authentication Hook </h3>
      <div  class="Unindented"> After we’ve defined what resources we want to
        protect, we need to configure the
        <tt>LiftRules.authentication</tt> function to perform the
        actual authentication. Lift supports both HTTP Basic and Digest
        authentication schemes, which we’ll cover in the next two sections. </div>
      <div  class="Indented">
        <div  class="defskip"> </div>
      </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note that in these
            examples we use stateful dispath (Розділ <a  href="#sec:Custom-dispatch-func"
 class="Reference">3.8 on page 1↑</a>) since the
            <tt>User.logUserIn</tt> method utilizes a backing
            <tt>SessionVar</tt>. If you use stateless dispatch you
            will need to provide your own <tt>RequestVar</tt>s to
            store the current user and roles. </div>
        </div>
      </div>
      <h4  class="Subsubsection"> <a  name="toc-Subsubsection-9.9.2.1"  class="toc">9.9.2.1</a> 
        HTTP Basic Authentication </h4>
      <div  class="Unindented"> HTTP Basic authentication is provided by the
        <tt>net.liftweb.http.auth.HttpBasicAuthentication</tt>
        implementation class, constructed using the authentication realm name as
        well as a <tt>PartialFunction[(String, String, Req),
        Boolean]</tt> that actually does the authentication. The tuple
        passed to the <tt>PartialFunction</tt> consists of the
        attempted username password, and the request object
        (<tt>Req</tt>). It’s your responsibility to return
        <tt>true</tt> or <tt>false</tt> to indicate
        whether the provided credentials succeed. Listing <a  href="#lst:Performing-Basic-Authentication"
 class="Reference">9.9.2.1↓</a> shows the code in
        <tt>Boot.boot</tt> that PocketChange uses to perform
        authentication based on the user’s email address and password. Note that
        when authentication succeeds for a given user not only do we return
        true, but we set the user as logged in (via
        <tt>User.logUserIn</tt>) and we compile a set of all of the
        <tt>Role</tt>s that the user so that Lift knows which
        protected resources the user may access. The<tt>
        net.liftweb.http.auth.userRoles</tt>
        <tt>RequestVar</tt> is a built-in construct in Lift that the
        authentication backend uses for bookkeeping. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Performing Basic Authentication<a  name="lst:Performing-Basic-Authentication"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_345188">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.auth.{AuthRole,HttpBasicAuthentication,userRoles}</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">LiftRules.authentication </code><code
 class="scala keyword">=</code> <code  class="scala plain">HttpBasicAuthentication(</code><code
 class="scala string">"PocketChange"</code><code  class="scala plain">) {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(userEmail, userPass, </code><code
 class="scala keyword">_</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">> {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">logger.debug(</code><code  class="scala string">"Authenticating: "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">User.find(By(User.email, userEmail)).map { user </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">if</code> <code  class="scala plain">(user.password.match</code><code
 class="scala keyword">_</code><code  class="scala plain">?(userPass)) {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">logger.debug(</code><code  class="scala string">"Auth succeeded for "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">User.logUserIn(user)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">        </code><code
 class="scala comments">// Compute all of the user roles</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">userRoles(user.editable.map(acct </code><code  class="scala keyword">=</code><code
 class="scala plain">> AuthRole(</code><code  class="scala string">"editAcct:"</code> <code
 class="scala plain">+ acct.id)) ++</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">                  </code><code
 class="scala plain">user.allAccounts.map(acct </code><code  class="scala keyword">=</code><code
 class="scala plain">> AuthRole(</code><code  class="scala string">"viewAcct:"</code> <code
 class="scala plain">+ acct.id)))</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">true</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">logger.warn(</code><code  class="scala string">"Auth failed for "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">false</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} openOr </code><code  class="scala keyword">false</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h4  class="Subsubsection"> <a  name="toc-Subsubsection-9.9.2.2"  class="toc">9.9.2.2</a> 
        HTTP Digest Authentication </h4>
      <div  class="Unindented"> HTTP Digest authentication is provided by the
        <tt>net.liftweb.http.auth.HttpDigestAuthentication</tt>
        implementation class. Like Basic authentication, the
        <tt>HttpDigestAuthentication</tt> instance is constructed
        with a realm name and a <tt>PartialFunction</tt>, but in
        this case the <tt>PartialFunction</tt> uses a tuple of
        <tt>(String,Req,(String)<span  class="formula"> ⇒ </span>Boolean)</tt>.
        The first parameter is still the username, and the second parameter is
        the request instance, but the third parameter is a function that will
        compute and compare the digest for authentication based on a <i>plaintext</i>
        password. This means that if we want to use Digest authentication, we
        need to be able to retrieve a plaintext password for the user from the
        database somehow. Listing <a  href="#lst:HTTP-Digest-Authentication"  class="Reference">9.9.2.2↓</a> shows how we could do this in
        PocketChange if we modified the <tt>User.password</tt> field
        to simply be a <tt>MappedString</tt>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Performing Digest Authentication<a  name="lst:HTTP-Digest-Authentication"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_722254">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.auth.{AuthRole,HttpBasicAuthentication,userRoles}</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">LiftRules.authentication </code><code
 class="scala keyword">=</code> <code  class="scala plain">HttpBasicAuthentication(</code><code
 class="scala string">"PocketChange"</code><code  class="scala plain">) {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(userEmail, </code><code
 class="scala keyword">_</code><code  class="scala plain">, authenticates) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">logger.debug(</code><code  class="scala string">"Authenticating: "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">User.find(By(User.email, userEmail)).map { user </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">if</code> <code  class="scala plain">(authenticates(user.password.is)) {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">logger.debug(</code><code  class="scala string">"Auth succeeded for "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">User.logUserIn(user)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">        </code><code
 class="scala comments">// Compute all of the user roles</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">userRoles(user.editable.map(acct </code><code  class="scala keyword">=</code><code
 class="scala plain">> AuthRole(</code><code  class="scala string">"editAcct:"</code> <code
 class="scala plain">+ acct.id)) ++</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">                  </code><code
 class="scala plain">user.allAccounts.map(acct </code><code  class="scala keyword">=</code><code
 class="scala plain">> AuthRole(</code><code  class="scala string">"viewAcct:"</code> <code
 class="scala plain">+ acct.id)))</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">true</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">logger.warn(</code><code  class="scala string">"Auth failed for "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">false</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} openOr </code><code  class="scala keyword">false</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Another important factor with Digest
        authentication is that it uses nonces<span  class="FootOuter"><span  class="SupFootMarker"> 
            [S] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [S] </span><a  href="http://en.wikipedia.org/wiki/Cryptographic_nonce"
 class="FlexURL">http://en.wikipedia.org/wiki/Cryptographic_nonce</a></span></span>
        for authenticating the client, and the nonces have a limited lifetime.
        The default nonce lifetime is 30 seconds, but you can configure this by
        overriding the
        <tt>HttpDigestAuthentication.nonceValidityPeriod</tt>
        method. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-9.9.3"  class="toc">9.9.3</a> 
        Role Hierarchies<a  name="sub:Role-Hierarchies"  class="Label"> </a> </h3>
      <div  class="Unindented"> So far we’ve discussed
        <tt>Role</tt>s as essentially flat constructs. A
        <tt>Role</tt>, however, is an n-ary tree structure, meaning
        that when we assign a <tt>Role</tt> to a protected resource
        we can actually provide a hierarchy. Малюнок <a  href="#fig:Roles-hierarchy-example"
 class="Reference">9.4↓</a> shows an example of one such hierarchy. In
        this example, the Admin is the “superuser” role for admins, and can do
        what any sub-role can do and more. The Site-Admin can monitor the
        application, the User-Admin can manage users, and then we specify a set
        of location-specific roles: the Romania-Admin that can manage users from
        Romania, US-Admin that can manage users from US and UK-Admin that can
        only manage users from UK. With this hierarchy a User-Admin can manage
        users from anywhere but a Site-Admin can not manage any users. A
        Romania-Admin can’t monitor the site, nor it can manage the US or UK
        users. </div>
      <div  class="Indented">
        <div  class="float"> <a  name="fig:Roles-hierarchy-example"  class="Label">
          </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 4in; max-width: 1692px; height: auto; max-height: 654px;"
 alt="figure images/roles.png"  src="./ExploringLift_files/roles.png"  class="embedded" /> </div>
            <div  class="caption"> Малюнок 9.4 Roles hierarchy example </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Given this Role hierarchy, Listing <a  href="#lst:Using-Role-Hierarchies"
 class="Reference">9.9.3↓</a> shows how we can implement this in our
        code by creating our Role hierarchy and then using the
        Role.getRoleByName method to locate the proper Role when we perform
        authentication. In this example we’re restricting access to the
        <tt>/users/ro</tt> path to only users with the
        “Romania-Admin” role. However, our fictional “John” user is assigned the
        “User-Admin” role, so he will be able to access that path. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using Role Hierarchies<a  name="lst:Using-Role-Hierarchies"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_159018">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">auth.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">roles </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">AuthRole(</code><code  class="scala string">"Admin"</code><code
 class="scala plain">, </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">AuthRole(</code><code  class="scala string">"Site-Admin"</code><code
 class="scala plain">),</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">AuthRole(</code><code  class="scala string">"User-Admin"</code><code
 class="scala plain">, </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">AuthRole(</code><code  class="scala string">"Romania-Admin"</code><code
 class="scala plain">),</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">AuthRole(</code><code  class="scala string">"US-Admin"</code><code
 class="scala plain">),</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">AuthRole(</code><code  class="scala string">"UK-Admin"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">)</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.protectedResource.append {    </code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">(ParsePath(</code><code
 class="scala string">"users"</code> <code  class="scala keyword">::</code> <code
 class="scala string">"ro"</code> <code  class="scala keyword">::</code> <code  class="scala keyword">_</code><code
 class="scala plain">, </code><code  class="scala keyword">_</code><code  class="scala plain">, </code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">_</code><code
 class="scala plain">)) </code><code  class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">roles.getRoleByName(</code><code  class="scala string">"Romania-Admin"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">   </code> </div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.authentication </code><code  class="scala keyword">=</code> <code
 class="scala plain">HttpBasicAuthentication(</code><code  class="scala string">"lift"</code><code
 class="scala plain">) {  </code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">(</code><code  class="scala string">"John"</code><code
 class="scala plain">, </code><code  class="scala string">"12test34"</code><code
 class="scala plain">, req) </code><code  class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">println(</code><code  class="scala string">"John is authenticated !"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">userRoles(AuthRole(</code><code  class="scala string">"User-Admin"</code><code
 class="scala plain">)) </code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">true</code>   </div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}  </code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">   </code><code
 class="scala plain">...</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-10"  class="toc">10</a> Lift
        and JavaScript<a  name="cha:Lift-and-Javascript"  class="Label"> </a> </h1>
      <div  class="Unindented"> In this chapter we’ll be discussing some of the
        techniques that Lift provides for simplifying and abstracting access to
        JavaScript on the client side. Using these facilities follows Lift’s
        model of separating code from presentation by allowing you to
        essentially write JavaScript code in Scala. Lift also provides a layer
        that allows you to use advanced JavaScript functionality via either the
        JQuery<span  class="FootOuter"><span  class="SupFootMarker"> [T] </span><span
 class="HoverFoot"><span  class="SupFootMarker">  [T] </span><a  href="http://jquery.com/"
 class="URL">http://jquery.com/</a></span></span> or YUI<span  class="FootOuter"><span
 class="SupFootMarker"> [U] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [U] </span><a  href="http://developer.yahoo.com/yui/"  class="URL">http://developer.yahoo.com/yui/</a></span></span>
        user interface libraries. </div>
      <h2  class="Section"> <a  name="toc-Section-10.1"  class="toc">10.1</a> 
        JavaScript high level abstractions </h2>
      <div  class="Unindented"> You may have noticed that Lift already comes
        with rich client side functionality in the form of AJAX and COMET
        support (chapter <a  href="#cha:AJAX-and-COMET"  class="Reference">11↓</a>). Whenever you use this support, Lift
        automatically generates the proper <tt><script></tt>
        elements in the returned page so that the libraries are included. Lift
        goes one step further, however, by providing a class hierarchy
        representing JavaScript expressions. For example, with an AJAX form
        element in Lift the callback method must return JavaScript code to
        update the client side. Instead of just returning a raw JavaScript
        string to be interpreted by the client, you return an instance of the
        <tt>JsCmd</tt><span  class="FootOuter"><span  class="SupFootMarker"> 
            [V] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [V] </span>net.liftweb.http.js.JsCmd</span></span> trait (either
        directly or via implicit conversion) that is transformed into the proper
        JavaScript for the client. </div>
      <div  class="Indented"> <tt>JsCmd</tt> represents a JavaScript
        command that can be executed on the client. There is an additional
        “base” trait called <tt>JsExp</tt> that represents a
        JavaScript expression.The differences between them are not usually
        important to the developer, since a <tt>JsExp</tt> instance
        is implicitly converted to a <tt>JsCmd</tt>. Also note that
        while Lift’s JavaScript classes attempt to keep things type-safe there
        are some limitations; in particular, Lift can’t check semantic things
        like whether the variable you’re trying to access from a given
        <tt>JsCmd</tt> actually exists. Besides the obvious use in
        techniques like AJAX and COMET, Lift also makes it simple to attach
        JavaScript to regular Scala XML objects, such as form fields. </div>
      <div  class="Indented"> As a simple example, let’s look at how we might
        add a simple alert to a form if it doesn’t validate. In this example,
        we’ll assume we have a <tt>name</tt> form field that
        shouldn’t be blank. Listing <a  href="#lst:Simple-Form-Validation"  class="Reference">10.1↓</a> shows a possible binding from our form
        snippet. Let’s break this down a bit: the first thing is that in order
        to reference form elements (or any elements for that matter) from
        JavaScript, they need to have an <tt>id</tt> attribute. We
        add the id attribute<a  href="#index-XML-attributes"  name="entry-XML-attributes-0"
 class="IndexReference">↓</a> to our
        text field by passing a <tt>Pair[String,String]</tt>. Next,
        we need to define our actual validation. We do this by adding some
        javascript to the <tt>onclick</tt> attribute of our submit
        button. The onclick attribute evaluates whatever javascript is assigned
        when the button is clicked; if the javascript evaluates to true then
        submission continues. If it evaluates to false then submission is
        aborted. In our case, we use the JsIf case class to check to see if the
        value of our myName field is equal to an empty string. In this case the
        JE object holds an implicit conversion from a Scala string to a Str
        (JavaScript string) instance. The second argument to JsIf is the body to
        be executed if the condition is true. In our case we want to pop up an
        alert to the user and stop form submission. The JsCmd trait (which Alert
        mixes in) provides a “&” operator which allows you to chain multiple
        commands together. Here we follow the Alert with a JsReturn, which
        returns the specified value; again, there’s an implicit conversion from
        Boolean to JsExp, so we can simply provide the “false” value. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Simple Form Validation<a  name="lst:Simple-Form-Validation"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_182197">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">JsCmds.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">JE.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">myName </code><code  class="scala keyword">=</code> <code  class="scala string">""</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">bind(...</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala string">"name"</code> <code  class="scala plain">-> text(myName, myName </code><code
 class="scala keyword">=</code> <code  class="scala keyword">_</code><code  class="scala plain">, </code><code
 class="scala string">"id"</code> <code  class="scala plain">-> </code><code  class="scala string">"myName"</code><code
 class="scala plain">),</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala string">"submit"</code> <code  class="scala plain">-> submit(</code><code
 class="scala string">"Save"</code><code  class="scala plain">, ..., </code><code
 class="scala string">"onclick"</code> <code  class="scala plain">-> </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">JsIf(JsEq(ValById(</code><code  class="scala string">"myName"</code><code
 class="scala plain">), </code><code  class="scala string">""</code><code  class="scala plain">), </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Alert(</code><code  class="scala string">"You must provide a name"</code><code
 class="scala plain">) & JsReturn(</code><code  class="scala keyword">false</code><code
 class="scala plain">))</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-10.1.1"  class="toc">10.1.1</a> 
        JsCmd and JsExp overview </h3>
      <div  class="Unindented"> If you peruse the Lift API docs you’ll find a
        large number of traits and classes under the JsCmds and JE objects;
        these provide the vast majority of the functionality you would need to
        write simple JavaScript code directly in Lift. Having said that,
        however, it’s important to realize that the Lift classes are intended to
        be used for small code fragments. If you need to write large portions of
        JavaScript code for your pages, we recommend writing that code in <i>pure</i>
        JavaScript in an external file and then including that file in your
        pages. In particular, if you write your code as JavaScript functions,
        you can use the <tt>JE.Call</tt> class to execute those
        functions from your Lift code. Table <a  href="#tab:Top-Level-JsCmds"  class="Reference">10.1↓</a> gives a brief overview of the available
        JsCmds, while table <a  href="#tab:Top-Level-JE-abstractions"  class="Reference">10.2↓</a> shows the JE expression abstractions. </div>
      <div  class="Indented">
        <div  class="float"> <a  name="tab:Top-Level-JsCmds"  class="Label"> </a>
          <div  class="table">
            <div  class="center">
              <table>
                <tbody>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">After</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Executes the given JsCmd fragment after a
                        given amount of time</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">Alert</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Corresponds directly to the JavaScript
                        alert function</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">CmdPair</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Executes two JsCmd fragments in order</span>
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">FocusOnLoad</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Forces focus on the given XML element
                        when the document loads</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">Function</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Defines a JavaScript function with name,
                        parameter list, and JsCmd body</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">JsBreak, JsContinue, JsReturn</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Corresponds directly to the JavaScript
                        “break”, “continue”, and “return” keywords</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">JsFor, JsForIn, JsDoWhile, JsWhile</span>
                    </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">These define loop constructs in
                        JavaScript with conditions and execution bodies</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">JsHideId, JsShowId</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Hides or shows the HTML element with the
                        given Id. This is actually handled via the
                        LiftArtifacts’ hide and show methods</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">JsIf</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Corresponds to the JavaScript “if”
                        statement, with a condition, body to execute if the
                        condition is true, and optional “else” body statement</span>
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">JsTry</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Defines a try/catch block tha can
                        optionally alert if an exception is caught</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">JsWith</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Defines a with statement to reduce object
                        references</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">OnLoad</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Defines a JavaScript statement that is
                        executed on page load</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">Noop</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Defines an empty JavaScript statement</span>
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">RedirectTo</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Uses window.location to redirect to a new
                        page</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">ReplaceOptions</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Replaces options on a form Select with a
                        new list of options.</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">Run</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Executes the given string as raw
                        javascript</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">Script</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Defines a <script> element with
                        proper CDATA escaping, etc to conform to XHTML
                        JavaScript support</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">SetElemById</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Assigns a statement to a given element by
                        id. Optional parameters allow you to specify properties
                        on the element</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">SetExp</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Defines an assignment to an arbitrary
                        JavaScript expression from another JavaScript expression</span>
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">SetHtml</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Sets the contents of a given HTML node by
                        Id to a given NodeSeq. This is especially useful in Ajax
                        calls that update parts of the page</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.25in;"> <span
 class="small">SetValById</span> </td>
                    <td  valign="bottom"  align="left"  style="width: 4.5in;"> <span
 class="small">Defines an assignment to a given
                        element’s “value” property</span> </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div  class="caption"> Table 10.1 Basic JsCmds </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="float"> <a  name="tab:Top-Level-JE-abstractions"  class="Label">
          </a>
          <div  class="table">
            <div  class="center">
              <table>
                <tbody>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">AnonFunc</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Defines an anonymous JavaScript function</span>
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">Call</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Calls a JavaScript function by name, with
                        parameters</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">ElemById</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Obtains a DOM element by its Id, with
                        optional property access</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">FormToJson</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Converts a given form (by Id) into a JSON
                        representation</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">Id, Style, Value</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents the “id”, “style” and “value”
                        element attributes</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">JsArray</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Constructs a JavaScript array from a
                        given set of JavaScript expressions</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">JsEq, JsNotEq, JsGt, JsGtEq, JsLt, JsLtEq</span>
                    </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Comparison tests between two JavaScript
                        expressions. JsExp instances also have a “===” operator
                        which is equivalent to JsEq</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">JsTrue, JsFalse, JsNull</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents the “true”, “false”, and
                        “null” values</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">JsFunc</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Similar to Call; executes a JavaScript
                        function</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">JsObj</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents a JavaScript object with a Map
                        for properties</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">JsRaw</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents a raw JavaScript fragment. You
                        can use this if Lift doesn’t provide functionality via
                        abstractions</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">JsVal</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents an abritrary JavaScript value</span>
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">JsVar</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents a JavaScript variable, with
                        optional property access</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">Num</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents a JavaScript number. JE
                        contains implicit conversions from Scala numeric types
                        to Num</span> </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">Str</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents a Javascript String. JE
                        contains implicit conversions from a Scala String to Str</span>
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">Stringify</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Calls JSON.stringify to convert a
                        JavaScript object into a JSON string representation</span>
                    </td>
                  </tr>
                  <tr>
                    <td  valign="top"  align="left"  style="width: 1.5in;"> <span
 class="small">ValById</span> </td>
                    <td  valign="top"  align="left"  style="width: 4in;"> <span
 class="small">Represents the “value” property of a
                        given element by Id</span> </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div  class="caption"> Table 10.2 Basic JE abstractions </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-10.1.2"  class="toc">10.1.2</a> 
        JavaScript Abstraction Examples </h3>
      <div  class="Unindented"> As you can see, Lift provides a large coverage
        of JavaScript functionality through its abstraction layer. Even if
        you’ve done a lot of JavaScript, however, the abstractions don’t always
        map one-to-one and it can take some effort to wrap your head around it.
        We’re going to provide a few examples to help you understand how it
        works. We’ll start off with a simple example of an Ajax callback (Ajax
        is covered in chapter <a  href="#cha:AJAX-and-COMET"  class="Reference">11↓</a>). Listing <a
 href="#lst:Using-SetHtml"  class="Reference">10.1.2↓</a> shows how we can update an HTML element
        with new content via the Ajax call. In this case, we’re changing a chart
        image based on some passed parameters. Our HTML needs to contain an
        element with an id of “tx_graph”; this element will have its children <i>replaced</i>
        with whatever NodeSeq we pass as the second argument. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using SetHtml<a  name="lst:Using-SetHtml"  class="Label">
            </a> </div>
          def updateGraph() = {
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_928400">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">dateClause </code><code
 class="scala keyword">:</code> <code  class="scala plain">String </code><code  class="scala keyword">=</code> <code
 class="scala plain">...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">url </code><code  class="scala keyword">=</code> <code
 class="scala string">"/graph/"</code> <code  class="scala plain">+ acctName + </code><code
 class="scala string">"/"</code> <code  class="scala plain">+ graphType + dateClause</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">JsCmds.SetHtml(</code><code  class="scala string">"tx_graph"</code><code
 class="scala plain">, <img src</code><code  class="scala keyword">=</code><code
 class="scala plain">{url} />)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As a more complex example, we could add some
        JavaScript behavior combining Ajax with some client-side state, as shown
        in listing <a  href="#lst:Client-side-comparisons"  class="Reference">10.1.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Client-side comparisons<a  name="lst:Client-side-comparisons"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_930881">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">js.JE.</code><code  class="scala keyword">_</code> <code  class="scala comments">// for implicit conversions</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">moreComplexCallback (value </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">JsIf(ValById(</code><code  class="scala string">"username"</code><code
 class="scala plain">) </code><code  class="scala keyword">===</code> <code  class="scala plain">value.toLowerCase, {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">JsFunc(</code><code  class="scala string">"logAccess"</code><code
 class="scala plain">, </code><code  class="scala string">"Self-share attempted"</code><code
 class="scala plain">).cmd & Alert(</code><code  class="scala string">"You can’t share with yourself!"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">})</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-10.2"  class="toc">10.2</a> 
        JQuery and other JavaScript frameworks </h2>
      <div  class="Unindented"> We’ve mentioned earlier that Lift uses the
        JQuery JavaScript framework by default. Lift wouldn’t be Lift, however,
        if it didn’t provide a mechanism for using other frameworks. The way
        that lift determines which JavaScript framework to use is via the
        <tt>JSArtifacts</tt><span  class="FootOuter"><span  class="SupFootMarker"> 
            [W] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [W] </span>net.liftweb.http.js.JSArtifacts</span></span> trait
        along with the LiftRules.jsArtifacts var. Lift comes with two default
        implementations of JSArtifacts: <tt>JQueryArtifacts<span  class="FootOuter"><span
 class="SupFootMarker"> [X] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [X] </span>net.liftweb.http.js.jquery.JQueryArtifacts</span></span></tt>
        and <tt>YUIArtifacts</tt><span  class="FootOuter"><span  class="SupFootMarker"> 
            [Y] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Y] </span>net.liftweb.http.js.yui.YUIArtifacts</span></span>. If
        you want to use a different framework, you must provide a concrete
        implementation of the JSArtifacts trait specific to that framework. The
        JQuery support in Lift extends beyond just the JSArtifacts, support;
        there are also a number of JSExp and JsCmd traits and classes in the
        <tt>net.liftweb.http.js.jquery</tt> package that provide
        JQuery specific implementations for standard expressions and commands. </div>
      <div  class="Indented"> Changing one implementation or another can be done
        from LiftRules.jsArtifacts variable, which by default points to
        JQueryArtifacts. Typically this is done in Boot, as shown in listing <a
 href="#lst:Configuring-Lift-YUI"  class="Reference">10.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Configuring Lift YUI<a  name="lst:Configuring-Lift-YUI"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_980086">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.js.yui.YUIArtifacts      </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">      </code> </div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {      </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">boot </code><code  class="scala keyword">=</code> <code
 class="scala plain">{      </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...      </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.jsArtifacts </code><code  class="scala keyword">=</code> <code
 class="scala plain">YUIArtifacts      </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">...     </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}  </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In addition to changing LiftRules, you also need
        to take into account that other frameworks have their own scripts and
        dependencies that you’ll need to include in your pages. For YUI you
        would need to include the following scripts (at minimum): </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Lift YUI scripts<a  name="lst:Lift-YUI-scripts"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_954647">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><script src</code><code
 class="scala keyword">=</code><code  class="scala string">"/classpath/yui/yahoo.js"</code> <code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"text/javascript"</code><code
 class="scala plain">/></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain"><script src</code><code
 class="scala keyword">=</code><code  class="scala string">"/classpath/yui/event.js"</code> <code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"text/javascript"</code><code
 class="scala plain">/>   </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain"><script src</code><code
 class="scala keyword">=</code><code  class="scala string">"/classpath/yui/dom.js"</code> <code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"text/javascript"</code><code
 class="scala plain">/>   </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain"><script src</code><code
 class="scala keyword">=</code><code  class="scala string">"/classpath/yui/connection.js"</code> <code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"text/javascript"</code><code
 class="scala plain">/>   </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain"><script src</code><code
 class="scala keyword">=</code><code  class="scala string">"/classpath/yui/json.js"</code> <code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"text/javascript"</code><code
 class="scala plain">/>   </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain"><script src</code><code
 class="scala keyword">=</code><code  class="scala string">"/classpath/liftYUI.js"</code> <code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"text/javascript"</code><code
 class="scala plain">/></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Of course, to keep things simple you could either
        place all of these items in a template that you could embed, or you
        could combine the files into a single JavaScript source file. </div>
      <div  class="Indented"> We have some simple recommendations on using
        different JavaScript frameworks from within Lift: </div>
      <ol>
        <li> If you don’t necessarily need YUI widgets or if you can find
          similar functionality in JQuery plugins, we recommend using the JQuery
          framework. Lift provides much better support out-of-the-box for JQuery
        </li>
        <li> Do not mix JQuery and YUI unless you really know what you are
          doing. Getting both of them together leads to a number of collisions.
        </li>
      </ol>
      <h2  class="Section"> <a  name="toc-Section-10.3"  class="toc">10.3</a> 
        XML and JavaScript </h2>
      <div  class="Unindented"> What we’ve covered so far is pretty much
        standard JavaScript behind some Lift facades. There are situations,
        however, when you want to do things that are complicated or outside the
        scope of typical JavaScript functionality. One example of this is when
        you need to build dynamic DOM elements from JavaScript code, say to
        build an HTML list. Lift has a very nice way of dealing with such
        situation; with a few lines of code you can achieve quite a lot. The
        main functionality for this is provided via the Jx* classes<span  class="FootOuter"><span
 class="SupFootMarker">  [Z] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Z] </span>net.liftweb.http.js.Jx, etc</span></span>, which you
        can use to transform a scala.xml.NodeSeq into javascript code that
        generates the corresponding nodes on the client side. Listing <a  href="#lst:Jx-trivial-example"
 class="Reference">10.3↓</a> shows a simple example of emitting a div
        on a page via JavaScript. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Jx trivial example<a  name="lst:Jx-trivial-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_349861">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.js.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala keyword">import</code> <code  class="scala plain">JE.</code><code
 class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala keyword">val</code> <code  class="scala plain">div </code><code  class="scala keyword">=</code> <code
 class="scala plain">Jx(<div>Hi there</div>)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> This code generates the following JavaScript code:
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Jx Emitted Code<a  name="lst:Jx-Emitted-Code"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_121535">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">function(it) {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">df </code><code  class="scala keyword">=</code> <code
 class="scala plain">document.createDocumentFragment();</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">vINIJ</code><code  class="scala value">1</code><code
 class="scala plain">YTZG</code><code  class="scala value">5</code> <code  class="scala keyword">=</code> <code
 class="scala plain">document.createElement(’div’);</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">df.appendChild(vINIJ</code><code  class="scala value">1</code><code
 class="scala plain">YTZG</code><code  class="scala value">5</code><code  class="scala plain">);</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">vINIJ</code><code  class="scala value">1</code><code  class="scala plain">YTZG</code><code
 class="scala value">5</code><code  class="scala plain">.appendChild(document.createTextNode(’Hi there’));</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">return</code> <code  class="scala plain">df;</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see, Lift took our XML code and
        transformed it into a JavaScript function that dynamically creates a
        document fragment containing the given NodeSeq. The
        <tt>it</tt> parameter can be any JavaScript object; we’ll
        cover how you use it in a moment. The name of the <i>var</i> is
        automatically and randomly generated to ensure uniqueness. </div>
      <div  class="Indented"> Of course, if that was all Lift was doing that’s
        not much help. At this point we’ve only generated a function that
        generates XML. Let’s take a look on a more complex example that shows
        the real power of the Jx classes. Assume we have a JSON structure that
        contains an array of objects containing firstName and lastName
        properties. This JSON structure could look something like: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Sample JSON Structure<a  name="lst:Sample-JSON-Structure"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_119815">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">list </code><code  class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">persons</code><code  class="scala keyword">:</code> <code  class="scala plain">[</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">{name</code><code  class="scala keyword">:</code> <code  class="scala string">"Thor"</code><code
 class="scala plain">, race</code><code  class="scala keyword">:</code> <code  class="scala string">"Asgard"</code><code
 class="scala plain">}, </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">{name</code><code  class="scala keyword">:</code> <code  class="scala string">"Todd"</code><code
 class="scala plain">, race</code><code  class="scala keyword">:</code> <code  class="scala string">"Wraith"</code><code
 class="scala plain">}, </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">{name</code><code  class="scala keyword">:</code> <code  class="scala string">"Rodney"</code><code
 class="scala plain">, race</code><code  class="scala keyword">:</code> <code  class="scala string">"Human"</code><code
 class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">]</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala comments">// Guess what I’ve been watching lately ?</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now we can use a combination of Jx classes to
        render this content as an HTML dynamic list: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Rendering a JSON List Via Jx<a  name="lst:Rendering-a-JSON-list"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_244004">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">renderPerson </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Jx(<li </code><code  class="scala keyword">class</code><code
 class="scala keyword">=</code><code  class="scala string">"item_header"</code><code
 class="scala plain">> {JsVar(</code><code  class="scala string">"it"</code><code
 class="scala plain">, </code><code  class="scala string">"name"</code><code  class="scala plain">)} </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">       </code><code
 class="scala plain">is {JsVar(</code><code  class="scala string">"it"</code><code
 class="scala plain">, </code><code  class="scala string">"race"</code><code  class="scala plain">)}</li>)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">Jx(<ul>{JxMap(JsVar(</code><code
 class="scala string">"it.persons"</code><code  class="scala plain">), renderPerson)}</ul>)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Well what this code does is this: </div>
      <ol>
        <li> Construct an <ul> list that contains a bunch of elements </li>
        <li> JxMap takes a JavaScript object, in this case
          <tt>it.persons</tt> (remember <tt>it</tt> is
          the parameter of the generated function), and iterate for each element
          of the array and apply the renderPerson function. Of course each
          element of the array will be a JSON object containing name and race
          properties. </li>
        <li> The <tt>renderPerson</tt> function generates a
          JavaScript function as we’ve already shown, and renders the JavaScript
          code that generates the <li> elements containing the name value
          followed by “is” followed by the race value. </li>
        <li> If we send this generated JavaScript function to client and calling
          it by pass the <i>list</i> variable above It will create the
          following document fragment: </li>
      </ol>
      <div  class="Unindented">
        <div  class="listing">
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_412384">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><ul></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala plain"><li </code><code  class="scala keyword">class</code><code  class="scala keyword">=</code><code
 class="scala string">"item_header"</code><code  class="scala plain">>Thor is Asgard</li></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code><code
 class="scala plain"><li </code><code  class="scala keyword">class</code><code  class="scala keyword">=</code><code
 class="scala string">"item_header"</code><code  class="scala plain">>Todd is Wraith</li></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala plain"><li </code><code  class="scala keyword">class</code><code  class="scala keyword">=</code><code
 class="scala string">"item_header"</code><code  class="scala plain">>Rodney is Human</li></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain"></ul></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> With a couple of lines of code we’ve managed to
        generate the JavaScript code that creates document fragments
        dynamically. Here is the list of JX classes that you may find
        interesting: </div>
      <div  class="Indented">
        <div  class="center">
          <table>
            <tbody>
              <tr>
                <td  valign="top"  align="left"> Class </td>
                <td  valign="top"  align="left"  style="width: 4in;">
                  Description </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> JxBase </td>
                <td  valign="top"  align="left"  style="width: 4in;"> The parent
                  trait for all other Jx classes </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> JxMap </td>
                <td  valign="top"  align="left"  style="width: 4in;"> Iterates
                  over a JavaScript array and applies a function on each element
                </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> JxMatch </td>
                <td  valign="top"  align="left"  style="width: 4in;"> Match a
                  JsExp against a sequence of JsCase </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> JxCase </td>
                <td  valign="top"  align="left"  style="width: 4in;"> Contains a
                  JsExp for matching purposes and the NodeSeq to be applied in
                  case the matching succeeds </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> JxIf </td>
                <td  valign="top"  align="left"  style="width: 4in;"> Contains a
                  JsExp and a NodeSeq to be applied only if JsExp is evaluated
                  to true </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> JxIfElse </td>
                <td  valign="top"  align="left"  style="width: 4in;"> Similar
                  with JxIf but it contains the else branch </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"> Jx </td>
                <td  valign="top"  align="left"  style="width: 4in;"> The basic
                  application of the transformation from a NodeSeq to the
                  JavaScript code </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-10.4"  class="toc">10.4</a> 
        JSON </h2>
      <div  class="Unindented"> JSON<span  class="FootOuter"><span  class="SupFootMarker"> 
            [A] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [A] </span>Java Script Object Notation - <a  href="http://www.json.org/"
 class="URL">http://www.json.org</a></span></span> is a way of
        structuring information in JavaScript code. One of its most common uses
        is to represent structured information on the wire. One example would be
        a JavaScript AJAX API where the server response is in fact a JSON
        construct. Let’s look at an example first in listing <a  href="#lst:Ajax-JSON-response"
 class="Reference">10.4↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Ajax JSON response<a  name="lst:Ajax-JSON-response"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_351246">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">SimpleSnippet {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">ajaxFunc() </code><code
 class="scala keyword">:</code> <code  class="scala plain">JsCmd </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">JsCrVar(</code><code  class="scala string">"myObject"</code><code
 class="scala plain">, JsObj((</code><code  class="scala string">"persons"</code><code
 class="scala plain">, JsArray(</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">JsObj((</code><code  class="scala string">"name"</code><code
 class="scala plain">, </code><code  class="scala string">"Thor"</code><code  class="scala plain">), (</code><code
 class="scala string">"race"</code><code  class="scala plain">, </code><code  class="scala string">"Asgard"</code><code
 class="scala plain">)),</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">JsObj((</code><code  class="scala string">"name"</code><code
 class="scala plain">, </code><code  class="scala string">"Todd"</code><code  class="scala plain">), (</code><code
 class="scala string">"race"</code><code  class="scala plain">, </code><code  class="scala string">"Wraith"</code><code
 class="scala plain">)),</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">JsObj((</code><code  class="scala string">"name"</code><code
 class="scala plain">, </code><code  class="scala string">"Rodney"</code><code  class="scala plain">), (</code><code
 class="scala string">"race"</code><code  class="scala plain">, </code><code  class="scala string">"Human"</code><code
 class="scala plain">))</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">)))) & JsRaw(</code><code  class="scala string">"alert(myObject.persons[0].name)"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">renderAjaxButton(xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">Group)</code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"ex"</code><code  class="scala plain">, xhtml,         </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"button"</code> <code  class="scala plain">-> SHtml.ajaxButton(Text(</code><code
 class="scala string">"Press me"</code><code  class="scala plain">), ajaxFunc </code><code
 class="scala keyword">_</code><code  class="scala plain">))</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Your template would look like listing <a  href="#lst:AJAX-Template"
 class="Reference">10.4↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> AJAX Template<a  name="lst:AJAX-Template"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_7893">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain"><lift</code><code
 class="scala keyword">:</code><code  class="scala plain">SimpleSnippet.renderAjaxButton></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><ex</code><code  class="scala keyword">:</code><code  class="scala plain">button/></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain"></lift</code><code
 class="scala keyword">:</code><code  class="scala plain">SimpleSnippet.renderAjaxButton></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">...</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> First off, we have a simple snippet function
        called <tt>renderAjaxButton</tt>. Here we’re binding the
        ex:button tag and render a XHTML button tag that when pressed will send
        an Ajax request to server. When this request is received, the
        <tt>ajaxFunc</tt> is executed and the JsCmd response is
        turned into a JavaScript content type response. In
        <tt>ajaxFunc</tt> we construct a JSON object (the same one
        we used previously for the persons object). We assign the JSON structure
        to the JavaScript variable <tt>myObject</tt> and them call
        alert on the first element on the persons object. The rendered
        JavaScript code that will be send down the wire will be: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Generated JavaScript<a  name="lst:Generated-JavaScript"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_331598">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">myObject </code><code  class="scala keyword">=</code> <code
 class="scala plain">{’persons’</code><code  class="scala keyword">:</code> <code
 class="scala plain">[{’name’</code><code  class="scala keyword">:</code> <code
 class="scala plain">’Thor’, ’race’</code><code  class="scala keyword">:</code> <code
 class="scala plain">’Asgard’}, </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">                            </code><code
 class="scala plain">{’name’</code><code  class="scala keyword">:</code> <code  class="scala plain">’Todd’, ’race’</code><code
 class="scala keyword">:</code> <code  class="scala plain">’Wraith’} , </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">                            </code><code
 class="scala plain">{’name’</code><code  class="scala keyword">:</code> <code  class="scala plain">’Rodney’, ’race’</code><code
 class="scala keyword">:</code> <code  class="scala plain">’Human’}]}; </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">alert(myObject.persons[</code><code
 class="scala value">0</code><code  class="scala plain">].name);</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> So in your page when you press the button you’ll
        get an alert dialog saying “Thor”. Here we used the JsRaw class which
        basically renders the exact thing you passed to it: raw JavaScript code.
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-10.4.1"  class="toc">10.4.1</a> 
        JSON forms<a  name="sub:JSON-forms"  class="Label"> </a> </h3>
      <div  class="Unindented"> Now that we’ve covered sending JSON from the
        server to the client, let’s look at going in the opposite direction.
        Lift provides a mechanism for sending form data to the server
        encapsulated in a JSON object. In and of itself sending the data in JSON
        format is relatively simple; where Lift really adds value is via the
        JsonHandler<span  class="FootOuter"><span  class="SupFootMarker">  [B] </span><span
 class="HoverFoot"><span  class="SupFootMarker">  [B] </span>net.liftweb.http.JsonHandler</span></span>
        class. This class provides a framework for simplifying processing of
        submitted JSON data. To start, let’s look at some example template code
        for a JSON form: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Simple JSON form<a  name="lst:A-Simple-JSON-form"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_547244">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift</code><code
 class="scala keyword">:</code><code  class="scala plain">surround </code><code
 class="scala keyword">with</code><code  class="scala keyword">=</code><code  class="scala string">"default"</code> <code
 class="scala plain">at</code><code  class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">>      </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><lift</code><code  class="scala keyword">:</code><code  class="scala plain">JSONForm.head />      </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><lift</code><code  class="scala keyword">:</code><code  class="scala plain">JSONForm.show></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><input </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"text"</code> <code  class="scala plain">name</code><code
 class="scala keyword">=</code><code  class="scala string">"name"</code> <code  class="scala plain">/></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">      </code><code
 class="scala plain"><br /></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><input </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"text"</code> <code  class="scala plain">name</code><code
 class="scala keyword">=</code><code  class="scala string">"value"</code> <code
 class="scala plain">/> </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain"><br />  </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><input </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"radio"</code> <code
 class="scala plain">name</code><code  class="scala keyword">=</code><code  class="scala string">"vehicle"</code> <code
 class="scala plain">value</code><code  class="scala keyword">=</code><code  class="scala string">"Bike"</code> <code
 class="scala plain">/> </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala plain"><input </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"radio"</code> <code
 class="scala plain">name</code><code  class="scala keyword">=</code><code  class="scala string">"vehicle"</code> <code
 class="scala plain">value</code><code  class="scala keyword">=</code><code  class="scala string">"Car"</code> <code
 class="scala plain">/> </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><input </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"radio"</code> <code
 class="scala plain">name</code><code  class="scala keyword">=</code><code  class="scala string">"vehicle"</code> <code
 class="scala plain">value</code><code  class="scala keyword">=</code><code  class="scala string">"Airplane"</code> <code
 class="scala plain">/> </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala plain"><br /> </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><select name</code><code  class="scala keyword">=</code><code
 class="scala string">"cars"</code><code  class="scala plain">></code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala plain"><option value</code><code  class="scala keyword">=</code><code
 class="scala string">"volvo"</code><code  class="scala plain">>Volvo</option> </code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">        </code><code
 class="scala plain"><option value</code><code  class="scala keyword">=</code><code
 class="scala string">"saab"</code><code  class="scala plain">>Saab</option> </code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">        </code><code
 class="scala plain"><option value</code><code  class="scala keyword">=</code><code
 class="scala string">"opel"</code><code  class="scala plain">>Opel</option>  </code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">        </code><code
 class="scala plain"><option value</code><code  class="scala keyword">=</code><code
 class="scala string">"audi"</code><code  class="scala plain">>Audi</option>  </code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">      </code><code
 class="scala plain"></select></code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><button </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"submit"</code><code
 class="scala plain">>Submit</button></code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"></lift</code><code  class="scala keyword">:</code><code  class="scala plain">JSONForm.show></code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><div id</code><code  class="scala keyword">=</code><code  class="scala string">"json_result"</code><code
 class="scala plain">></div> </code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala plain"></lift</code><code
 class="scala keyword">:</code><code  class="scala plain">surround></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> A you can see, the XHTML template is relatively
        straightforward. The Snippet code is where things really get
        interesting: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> JSON Form Snippet Code </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_850257">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">JSONForm {      </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">head </code><code  class="scala keyword">=</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><head></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><script </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"text/javascript"</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">src</code><code  class="scala keyword">=</code><code  class="scala plain">{</code><code
 class="scala string">"/"</code> <code  class="scala plain">+ LiftRules.resourceServerPath + </code><code
 class="scala string">"/jlift.js"</code><code  class="scala plain">} /></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">{Script(json.jsCmd)}</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"></head> </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">   </code> </div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">show(html</code><code
 class="scala keyword">:</code> <code  class="scala plain">Group)</code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">SHtml.jsonForm(json, html) </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">} </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">import</code> <code  class="scala plain">JsCmds.</code><code
 class="scala keyword">_</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">object</code> <code  class="scala plain">json </code><code
 class="scala keyword">extends</code> <code  class="scala plain">JsonHandler {</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">def</code> <code  class="scala plain">apply(in</code><code
 class="scala keyword">:</code> <code  class="scala plain">Any)</code><code  class="scala keyword">:</code> <code
 class="scala plain">JsCmd </code><code  class="scala keyword">=</code> <code  class="scala plain">SetHtml(</code><code
 class="scala string">"json_result"</code><code  class="scala plain">, in </code><code
 class="scala keyword">match</code> <code  class="scala plain">{ </code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">            </code><code
 class="scala keyword">case</code> <code  class="scala plain">JsonCmd(</code><code
 class="scala string">"processForm"</code><code  class="scala plain">, </code><code
 class="scala keyword">_</code><code  class="scala plain">, p</code><code  class="scala keyword">:</code> <code
 class="scala plain">Map[String, </code><code  class="scala keyword">_</code><code
 class="scala plain">], </code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">                </code><code
 class="scala comments">// process the form or whatever </code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">                </code><code
 class="scala plain">println(</code><code  class="scala string">"Cars = "</code> <code
 class="scala plain">+ urlDecode(p(</code><code  class="scala string">"cars"</code><code
 class="scala plain">))) </code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">                </code><code
 class="scala plain">println(</code><code  class="scala string">"Name = "</code> <code
 class="scala plain">+ urlDecode(p(</code><code  class="scala string">"name"</code><code
 class="scala plain">))) </code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">                </code><code
 class="scala plain"><b>{p}</b> </code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">}</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">            </code><code
 class="scala keyword">case</code> <code  class="scala plain">x </code><code  class="scala keyword">=</code><code
 class="scala plain">> <b>Problem... didn’t handle JSON message {x}</b></code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">})</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala plain">}  </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The first thing we define is the
        <tt>head</tt> function. Its purpose is simply to generate
        the JavaScript functions that set up the form handling on the client
        side. That means that when the submit button is clicked, the contents of
        the form are turned into JSON and submitted via an Ajax call to the
        server. The <tt>show</tt> function defines the connection
        between the concrete JsonHandler instance that will process the form and
        the template HTML that contains the form. We perform this binding with
        the <tt>SHtml.jsonForm</tt> method. This wraps the HTML with
        a <tt><form></tt> tag and sets the
        <tt>onsubmit</tt> event to do JSON bundling. </div>
      <div  class="Indented"> The key part of the equation is our JsonHandler
        object. The apply method is what will be called when the JSON object is
        submitted to the server. If the JSON is properly parsed then you’ll get
        a JsonCmd instance which you can use Scala’s matching to pick apart. The
        apply function needs to return a JsCmd (JavaScript code), which in this
        case sets the HTML content of the <tt>json_result</tt> div
        element. When the form is stringified into its JSON representation Lift
        uses a command property indicating the action that needs to be done on
        server and the actual JSON data. In the case of JSON forms the command
        is always “processForm” as this is important for pattern matching as
        seen above. The actual form content is a Map object that can be easily
        use to obtain the values for each form field. </div>
      <h2  class="Section"> <a  name="toc-Section-10.5"  class="toc">10.5</a> 
        JqSHtml object </h2>
      <div  class="Unindented"> SHtml generated code is independent on the
        JavaScript framework used. However
        <tt>net.liftweb.http.jquery.JsSHtml</tt> object contains
        artifacts that are bound with JQuery framework. For instance it contains
        the autocomplete function that renders an input type text element but
        when start typing it will suggest words starting with what you typed
        already. Please see <a  href="http://www.pengoworks.com/workshop/jquery/autocomplete.htm"
 class="URL">http://www.pengoworks.com/workshop/jquery/autocomplete.htm</a>
        for examples. </div>
      <h2  class="Section"> <a  name="toc-Section-10.6"  class="toc">10.6</a> A
        recap </h2>
      <div  class="Unindented"> We’ve seen so far how we can abstract JavaScript
        code at Scala level using Lift’s JS abstraction. You can model endless
        cases by using these abstractions. But let’s take a look on another
        example a bit more complex. It is about a fast search where you have a
        text box and when you hit enter it will return the list of items that
        contain that sequence. The list of items will be rendered in a DIV real
        estate. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Example template </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_162452">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain"><lift</code><code
 class="scala keyword">:</code><code  class="scala plain">surround </code><code
 class="scala keyword">with</code><code  class="scala keyword">=</code><code  class="scala string">"default"</code> <code
 class="scala plain">at</code><code  class="scala keyword">=</code><code  class="scala string">"content"</code><code
 class="scala plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><lift</code><code  class="scala keyword">:</code><code  class="scala plain">Hello.ajaxian>            </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><text</code><code  class="scala keyword">:</code><code  class="scala plain">show/>    </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"></lift</code><code  class="scala keyword">:</code><code  class="scala plain">Hello.ajaxian>      </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><div id</code><code  class="scala keyword">=</code><code  class="scala string">"items_list"</code> <code
 class="scala plain">style</code><code  class="scala keyword">=</code><code  class="scala string">"width: 300px; height: 100px; overflow: auto; border: 1px solid black;"</code><code
 class="scala plain">>   </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"></div>    </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain"></lift</code><code
 class="scala keyword">:</code><code  class="scala plain">surround></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> So we just have a really simple snippet and the
        div placeholder. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Example snippet </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_118506">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">JE.</code><code  class="scala keyword">_</code>  </div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.js.jquery.JqJE.</code><code  class="scala keyword">_</code>     </div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.SHtml.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.Helpers.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">JsCmds.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">names </code><code  class="scala keyword">=</code> <code  class="scala string">"marius"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"tyler"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"derek"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"dave"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"jorge"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"viktor"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil  </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">ajaxian(html</code><code  class="scala keyword">:</code> <code
 class="scala plain">Group) </code><code  class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"text"</code><code
 class="scala plain">, html,</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"show"</code>  <code  class="scala plain">-> ajaxText(</code><code
 class="scala string">"Type something"</code><code  class="scala plain">, {value </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">               </code><code
 class="scala keyword">val</code> <code  class="scala plain">matches </code><code
 class="scala keyword">=</code> <code  class="scala plain">names.filter(e </code><code
 class="scala keyword">=</code><code  class="scala plain">> e.indexOf(value) > -</code><code
 class="scala value">1</code><code  class="scala plain">)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">               </code><code
 class="scala plain">SetHtml(</code><code  class="scala string">"items_list"</code><code
 class="scala plain">, NodeSeq.Empty) & </code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">               </code><code
 class="scala plain">JsCrVar(</code><code  class="scala string">"items"</code><code
 class="scala plain">, JsArray(matches.map(Str(</code><code  class="scala keyword">_</code><code
 class="scala plain">))</code><code  class="scala keyword">:_</code><code  class="scala plain">*)) &</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">               </code><code
 class="scala plain">JsCrVar(</code><code  class="scala string">"func"</code><code
 class="scala plain">, Jx(<ul>{</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">                                    </code><code
 class="scala plain">JxMap(JsVar(</code><code  class="scala string">"it"</code><code
 class="scala plain">), Jx(<li><a href</code><code  class="scala keyword">=</code><code
 class="scala string">""</code><code  class="scala plain">>{JsVar(</code><code  class="scala string">"it"</code><code
 class="scala plain">)}</a></li>)) } </ul>).toJs) &</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">               </code><code
 class="scala plain">(ElemById(</code><code  class="scala string">"items_list"</code><code
 class="scala plain">) ~> JsFunc(</code><code  class="scala string">"appendChild"</code><code
 class="scala plain">, Call(</code><code  class="scala string">"func"</code><code
 class="scala plain">, JsVar(</code><code  class="scala string">"items"</code><code
 class="scala plain">))))</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">             </code><code
 class="scala plain">}})</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">)</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala plain">} </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The part with the snippet is probably already
        familiar to you. We are calling the ajaxText function which renders an
        input text element. When you hit enter an Ajax request will be sent and
        the anonymous function that we bound here will be executed. Here is what
        happens: </div>
      <ol>
        <li> First filter out the names that contain the provided value in the
          input text. So all element that contain that sequence. </li>
        <li> Then return a JsExp that we are building:
          <ol>
            <li> SetHtml is clearing out the div element that we’re using as a
              real estate for our search results list </li>
            <li> Then we re declaring a JavaScript variable which is an array
              containing the resulting items that matched the search criteria. </li>
            <li> Then we are declaring thr <tt>func</tt> variable
              which obviously is a function. We’ve seen above how to use the Jx
              artifacts. Now we are building a html list
              (<tt><ul></tt>) that for each element from the
              <tt>it</tt> variable will build the
              <tt><li></tt> sequences. The it variable is
              actually the paramter that this function takes which is the items
              array that we declared above. </li>
            <li> After that we are obtaining the HTML node denominated by
              “items_list” id and call appendChild function of the Node object.
              The ~> function is use to call functions of objects. Of course
              to the appendChild function we need to provide a parameter. This
              parameter is the document fragment returned by
              <tt>func</tt> function. When we are caling the
              <tt>func</tt> function we are passing items variable
              decalred above. </li>
          </ol>
        </li>
      </ol>
      <div  class="Unindented"> As you noticed already we composed a small
        JavaScript code by chainin multiple JS expressions/commands using the
        & function. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-11"  class="toc">11</a> AJAX
        and Comet in Lift<a  name="cha:AJAX-and-COMET"  class="Label"> </a> </h1>
      <div  class="Unindented"> In this chapter we’re going to discuss AJAX and
        Comet, two approaches to improving the user experience through dynamic
        web pages. While a full treatment of the techniques and technologies
        behind these approaches is beyond the scope of this book<span  class="FootOuter"><span
 class="SupFootMarker">  [C] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [C] </span>There are a number of good resources on the web that
            you can find by searching for “AJAX”.</span></span>, we’re going to
        cover the basics of how AJAX and Comet work. In particular, we’re going
        to look at how Lift handles them behind the scenes to simplify your
        work. </div>
      <h2  class="Section"> <a  name="toc-Section-11.1"  class="toc">11.1</a> 
        What are AJAX and Comet, really? </h2>
      <div  class="Unindented"> AJAX and Comet are variations on the traditional
        model of the web application request/response lifecycle. In the
        traditional model, the user starts by making a request for a page. The
        server receives this request, performs processing, then sends a response
        back to the user. The response is then rendered by the user’s browser.
        At this point there are no further interactions between the user and the
        server until the user clicks on a link or performs some other action
        that starts a completely new request/response lifecycle. AJAX and Comet
        extend this model to allow for asynchronous updates from either the user
        to the server (AJAX), or from the server back to the user (Comet). </div>
      <div  class="Indented"> If we take the example of adding a comment to a
        blog post, the traditional model has the user fill in a form, hit the
        submit button, and send the request to the server. The server processes
        and adds the comment and then sends the updated blog post back to the
        user with the newly added comment. At the same time, if other people are
        viewing the blog post, they won’t see the new comment until they reload
        the page. </div>
      <div  class="Indented"> The AJAX model of this session changes such that
        the display of the new comment is not tied to the response from the
        server. When the user hits submit, the request to add the comment is
        sent to the server <i>in the background</i>. While it’s being processed
        by the server, a JavaScript fragment (the “J” in AJAX) updates the
        user’s page via DOM<span  class="FootOuter"><span  class="SupFootMarker"> 
            [D] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [D] </span>Document Object Model. More information can be found at
            <a  href="http://www.w3.org/DOM/"  class="URL">http://www.w3.org/DOM/</a></span></span>
        and adds the comment without the need for a full page reload. </div>
      <div  class="Indented"> Comet changes the traditional model by using a
        long-polling HTTP request in the background that allows the server to
        push data to the browser without requiring additional requests.
        Essentially this is like AJAX, except in the opposite direction. </div>
      <div  class="Indented"> While the AJAX model increases the richness of the
        User Experience for a single client at a time, Comet can do the same for
        multiple users. Going back to our example of a blog post, Comet would
        enable the server to notify anyone viewing the current blog post to
        automatically have their pages updated when the new comment is added. </div>
      <div  class="Indented"> Малюнокs <a  href="#subfig:Traditional-Application-Model"
 class="Reference">a↓</a>, <a  href="#subfig:AJAX-Application-Model"  class="Reference">b↓</a>, and <a
 href="#subfig:COMET-Application-Model"  class="Reference">c↓</a> show graphical representations of how the
        models differ in terms of timeline and server interaction. </div>
      <div  class="Indented">
        <div  class="float"> <a  name="fig:model-comparisons"  class="Label"> </a>
          <div  class="multifigure">
            <div  class="center"> <span  class="float"> <a  name="subfig:Traditional-Application-Model"
 class="Label"> </a>
                <div  class="figure">
                  <div  class="caption"> (a) Traditional Application Model </div>
                  <img  style="width: 3in; max-width: 288px; height: auto; max-height: 216px;"
 alt="figure images/Traditional_Model.png"  src="./ExploringLift_files/Traditional_Model.png"
 class="embedded" /> </div>
              </span> <span  class="float"> <a  name="subfig:AJAX-Application-Model"
 class="Label"> </a>
                <div  class="figure">
                  <div  class="caption"> (b) AJAX Application Model </div>
                  <img  style="width: 3in; max-width: 288px; height: auto; max-height: 216px;"
 alt="figure images/Ajax_Model.png"  src="./ExploringLift_files/Ajax_Model.png"
 class="embedded" /> </div>
              </span> </div>
            <span  class="float"> <a  name="subfig:COMET-Application-Model"  class="Label">
              </a>
              <div  class="figure">
                <div  class="caption"> (c) Comet Application Model </div>
                <img  style="width: 3in; max-width: 288px; height: auto; max-height: 216px;"
 alt="figure images/COMET_Model.png"  src="./ExploringLift_files/COMET_Model.png"
 class="embedded" /> </div>
            </span>
            <div  class="caption"> Малюнок 11.1 Application Model Comparisons </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-11.2"  class="toc">11.2</a> 
        Using AJAX in Lift </h2>
      <div  class="Unindented"> In previous chapters we’ve shown how to
        synchronously process forms (chapter <a  href="#cha:Forms-in-Lift"  class="Reference">6↑</a>) and use JavaScript to perform client-side
        behavior (chapter<a  href="#cha:Lift-and-Javascript"  class="Reference">10↑</a>). AJAX blends these Lift techniques to give
        you powerful support for asynchronous client-server interaction. As with
        standard form and link elements, Lift uses methods on the
        <tt>SHtml</tt> object to generate AJAX components in a
        concise manner. We’ll cover each of the AJAX-specific
        <tt>SHtml</tt> methods in a later section, but for now we
        want to cover the high-level aspects of using AJAX in Lift. </div>
      <div  class="Indented"> The first thing we want to point out is that AJAX
        generators take callback methods just like regular element generators.
        The major difference is that while standard <tt>SHtml</tt>
        generator callbacks return <tt>scala.Any</tt>, AJAX
        callbacks must return a <tt>net.liftweb.http.js.JsCmd</tt>.
        The reason is that the return from the callback is itself a client-side
        callback that can be used to update the client content. An example is
        shown in Listing <a  href="#lst:A-simple-AJAX-example"  class="Reference">11.2↓</a>. In this example we generate a button,
        that when clicked, will log a message and then set the contents of the
        div named <tt>my-div</tt> to a <tt>Text</tt>
        element. As you can see, adding client-side content changes is trivial.
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A simple AJAX example<a  name="lst:A-simple-AJAX-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_595304">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.http.SHtml.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala comments">// The next two imports are used to get some implicit conversions</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala comments">// in scope.</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.http.JE.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.http.JsCmds.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala comments">// Use logging facilities</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.util.Log</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala comments">// define a snippet method</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">myFunc(html</code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"hello"</code><code
 class="scala plain">, html, </code><code  class="scala string">"button"</code> <code
 class="scala plain">-> ajaxButton(Text(</code><code  class="scala string">"Press me"</code><code
 class="scala plain">), {() </code><code  class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">Log.info(</code><code  class="scala string">"Got an AJAX call"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">SetHtml(</code><code  class="scala string">"my-div"</code><code
 class="scala plain">, Text(</code><code  class="scala string">"That’s it"</code><code
 class="scala plain">)) </code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">})</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The second important aspect of Lift’s AJAX support
        is that behind the scenes Lift provides a robust mechanism for AJAX
        submission. For example, Lift provides its own JavaScript that handles
        retrying when the submission times out. You can control the timeout
        duration and retry count through <tt>LiftRule</tt>’s
        <tt>ajaxPostTimeout</tt> (in milliseconds) and
        <tt>ajaxRetryCount</tt> variables, respectively. </div>
      <div  class="Indented"> The third aspect of Lift’s AJAX support is that
        it’s so easy to enable. Lift automatically takes care of adding the
        proper JavaScript libraries to your templates when they’re rendered, and
        sets up the proper callback dispatch for you. By default, dispatch is
        done relative to the <tt>/ajax_request</tt> path in your web
        context, but Lift allows you change this via the
        <tt>LiftRules.ajaxPath</tt> variable. </div>
      <div  class="Indented"> The final aspect is the flexibility the library
        provides. Besides standard form elements and links that can be
        AJAXified, Lift also provides the <tt>SHtml.ajaxCall</tt>
        method which constructs a <tt>JsExp</tt> that you can use
        directly on <i>any</i> element. In addition, it allows you to construct
        a <tt>String</tt> argument to your callback function via
        JavaScript so that you have full access to client-side data. </div>
      <h2  class="Section"> <a  name="toc-Section-11.3"  class="toc">11.3</a> A
        more complex AJAX example<a  name="sub:A-more-complex-ajax-example"  class="Label">
        </a> </h2>
      <div  class="Unindented"> Let’s take a look on a comparison example. We’ve
        seen how to use <tt>SHtml.ajaxButton</tt>, so let’s see in
        Listing <a  href="#lst:Ajax-comparison-example"  class="Reference">11.3↓</a> how can we achieve the same effect using
        <tt>SHtml.ajaxCall</tt> and
        <tt>SHtml.ajaxInvoke</tt>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> AJAX comparison example<a  name="lst:Ajax-comparison-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_131810">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">SimpleSnippet {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">import</code> <code  class="scala keyword">_</code><code
 class="scala plain">root</code><code  class="scala keyword">_</code><code  class="scala plain">.net.liftweb.http.js.{JE,JsCmd,JsCmds}</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">import</code> <code  class="scala plain">JsCmds.</code><code
 class="scala keyword">_</code> <code  class="scala comments">// For implicits</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">import</code> <code  class="scala plain">JE.{JsRaw,Str}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">ajaxFunc</code><code
 class="scala value">1</code><code  class="scala plain">() </code><code  class="scala keyword">:</code> <code
 class="scala plain">JsCmd </code><code  class="scala keyword">=</code> <code  class="scala plain">JsRaw(</code><code
 class="scala string">"alert(’Button1 clicked’)"</code><code  class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">ajaxFunc</code><code
 class="scala value">2</code><code  class="scala plain">(str</code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code> <code
 class="scala plain">JsCmd </code><code  class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">println(</code><code  class="scala string">"Received "</code> <code
 class="scala plain">+ str)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">JsRaw(</code><code  class="scala string">"alert(’Button2 clicked’)"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">ajaxFunc</code><code
 class="scala value">3</code><code  class="scala plain">() </code><code  class="scala keyword">:</code> <code
 class="scala plain">JsCmd </code><code  class="scala keyword">=</code> <code  class="scala plain">JsRaw(</code><code
 class="scala string">"alert(’Button3 clicked’)"</code><code  class="scala plain">)</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">renderAJAXButtons(xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">Group)</code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"ex"</code><code  class="scala plain">, xhtml,         </code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">            </code><code
 class="scala string">"button1"</code> <code  class="scala plain">-> SHtml.ajaxButton(</code><code
 class="scala string">"Press me"</code><code  class="scala plain">, ajaxFunc</code><code
 class="scala value">1</code> <code  class="scala keyword">_</code><code  class="scala plain">),</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"button2"</code> <code  class="scala plain">-> </code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">              </code><code
 class="scala comments">// ajaxCall and ajaxInvoke actually returns a pair (String, JsExp). </code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">              </code><code
 class="scala comments">// The String is used for garbage collection, so we only need</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">              </code><code
 class="scala comments">// to use the JsExp element (_2).</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">              </code><code
 class="scala plain"><button onclick</code><code  class="scala keyword">=</code><code
 class="scala plain">{SHtml.ajaxCall(Str(</code><code  class="scala string">"Button-2"</code><code
 class="scala plain">), ajaxFunc</code><code  class="scala value">2</code> <code
 class="scala keyword">_</code><code  class="scala plain">).</code><code  class="scala keyword">_</code><code
 class="scala value">2</code><code  class="scala plain">}></code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">                </code><code
 class="scala plain">Press me </code><code  class="scala value">2</code><code  class="scala plain"></button>,</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">            </code><code
 class="scala string">"button3"</code> <code  class="scala plain">-> </code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">              </code><code
 class="scala plain"><button onclick</code><code  class="scala keyword">=</code><code
 class="scala plain">{SHtml.ajaxInvoke(ajaxFunc</code><code  class="scala value">3</code> <code
 class="scala keyword">_</code><code  class="scala plain">).</code><code  class="scala keyword">_</code><code
 class="scala value">2</code><code  class="scala plain">}></code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">                </code><code
 class="scala plain">Press me </code><code  class="scala value">3</code><code  class="scala plain"></button>)</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">}</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Basically, in Listing <a  href="#lst:Ajax-comparison-example"
 class="Reference">11.3↑</a>, we created three AJAX buttons using
        three different SHtml functions. The difference between
        <tt>ajaxCall</tt> and <tt>ajaxInvoke</tt> is
        that for <tt>ajaxCall</tt> you can specify a
        <tt>JsExp</tt> parameter that will be executed on the client
        side. The result of this <tt>JsExp</tt> will be sent to the
        server. In our case this parameter is simply a static String,
        <tt>Str(“Button-2”)</tt>, but you can provide any
        <tt>JsExp</tt> code here to calculate a client-side value to
        be passed to your callback. For an overview of the rest of the
        <tt>SHtml</tt> generator functions please see Глава <a  href="#cha:Forms-in-Lift"
 class="Reference">6↑</a>. </div>
      <h2  class="Section"> <a  name="toc-Section-11.4"  class="toc">11.4</a> 
        AJAX Generators in Detail<a  name="sub:AJAX-Generators-in-detail"  class="Label">
        </a> </h2>
      <div  class="Unindented"> The following table provides a brief synopsis of
        the AJAX generator methods on the<br />
        <tt>net.liftweb.http.SHtml</tt> object: </div>
      <div  class="Indented">
        <table>
          <tbody>
            <tr>
              <td  valign="top"  align="left"> Function name </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Description
              </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> ajaxButton </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders a
                button that will submit an AJAX request to server </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> a </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders an
                anchor tag that when clicked will submit an AJAX request </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> makeAJAXCall </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders the
                JavaScript code that will submit an AJAX request </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> span </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders a
                span element that when clicked will execute a
                <tt>JsCmd</tt> </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> ajaxCall </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders the
                JavaScript code that will submit an AJAX request but it will
                also send the value returned by the <tt>JsExp</tt>
                provided. </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> ajaxInvole </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Similar to
                <tt>ajaxCall</tt> but there is no value to be
                computed and sent to the server </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> toggleKids </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Provides the
                toggle effect on an element. When clicked it will also send an
                AJAX call </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> ajaxText </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders an
                input text element that will send an AJAX request on blur. </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> jsonText </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders an
                input type text element the will send a JSON request on blur. </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> ajaxCheckbox </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders a
                checkbox element that when clicked will send an AJAX call </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> ajaxSelect </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders a
                select element then sends an AJAX call when the value changes </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> ajaxForm </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Wraps a
                <tt>NodeSeq</tt> that represents the form’s content
                and makes an AJAX call when the form is submitted. </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> jsonForm </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Similar to
                <tt>ajaxForm</tt>, but on the client side, the form
                is JSONified and the JSON content sent to the server and
                processed by <tt>JsonHandler</tt> </td>
            </tr>
            <tr>
              <td  valign="top"  align="left"> swappable </td>
              <td  valign="top"  align="left"  style="width: 4in;"> Renders a
                span that contains one visible element and the other hidden.
                When the visible element is clicked it will be hidden and the
                other one will be shown </td>
            </tr>
          </tbody>
        </table>
      </div>
      <h2  class="Section"> <a  name="toc-Section-11.5"  class="toc">11.5</a> 
        Comet and Lift<a  name="sec:COMET"  class="Label"> </a> </h2>
      <div  class="Unindented"> Малюнок <a  href="#subfig:COMET-Application-Model"
 class="Reference">c↑</a> diagrams the interaction between client and
        server in the Comet. model. There are several resources on the web that
        explain the history and specific techniques related to Comet<span  class="FootOuter"><span
 class="SupFootMarker"> [E] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [E] </span><a  href="http://en.wikipedia.org/wiki/Comet_%28programming%29"
 class="URL">http://en.wikipedia.org/wiki/Comet_(programming)</a>
            is a good start.</span></span>, so we won’t get too detailed here.
        In essence Comet is not a technology but a technique which allows a web
        application to push messages from server to client. There are a couple
        of approaches used to make this work, but the approach that Lift uses is
        long polling, so that’s what we’ll be covering here. As an example,
        consider a web chat application where you can chat real-time with
        friends. Let’s take a quick look at how receiving a message using Comet
        works in Lift: </div>
      <ol>
        <li> The client sends an AJAX request to the server asking for any new
          messages. </li>
        <li> The server does not respond immediately but waits until there is a
          message that needs to be sent for that client. </li>
        <li> When a message is available, the server responds to the initial
          request from the client with the new message(s). </li>
        <li> The client receives the response, processes it, and issues another
          AJAX request, and the process continues. </li>
      </ol>
      <div  class="Unindented"> Of course, things are more complicated then
        that. For instance, it may take a while until the response is actually
        returned to the client. During this delay, the connection could be
        dropped for any number of reasons. The client should be smart enough to
        re-establish the connection automatically. But there is another problem
        - scalability. If we have these long-running connections, the server
        would typically put the processing threads into a waiting state until
        messages are available to send back to the client. Having many waiting
        threads is a scalability killer because numerous threads from the web
        container’s thread pool will lie in the wait state doing nothing until,
        before you know it, your entire thread pool is empty. The immediate
        consequence is that your server can not do any other request processing.
        Because of this, a thread-per-connection approach combined with
        long-running connections is totally unacceptable. </div>
      <div  class="Indented"> The key to scalability is NON-BLOCKING IO. Most
        operating systems support non-blocking I/O, which actually means that
        when you utilize an I/O resource for reading or writing (say the streams
        from a socket) there is no blocking operation. So if you read from a
        stream your read function would immediately return regardless of whether
        there is data available or not. In Java, non-blocking I/O is provided by
        the Java New I/O (NIO) library using Selectors and perhaps the Reactor
        pattern<span  class="FootOuter"><span  class="SupFootMarker"> [F] </span><span
 class="HoverFoot"><span  class="SupFootMarker">  [F] </span>A nice
            overview of NIO is at <a  href="http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf"
 class="URL">http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf</a></span></span>.
        This has a major impact on scalability because the threads are only held
        as long as there is work to do. Once they’re finished with the available
        data, they are returned to the thread pool so that they may be reused
        for processing other requests. In this model the threads are allocated
        to connections only when data is available for processing, which
        inherently leads to better resource utilization. </div>
      <div  class="Indented">
        <div  class="defskip"> </div>
      </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note: This is somewhat
            off-topic, but if you’re looking to do a lot of work with NIO and
            networking, we recommend looking at the Apache MINA project at <a  href="http://mina.apache.org/"
 class="URL">http://mina.apache.org/</a>. MINA provides some nice
            abstractions for NIO that allows you use a stateful approach to
            developing NIO applications without having to deal with a lot of the
            underlying details of using NIO. </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="defskip"> </div>
      </div>
      <div  class="Indented"> Having nonblocking I/O enabled by the web
        container also has a major impact on application scalability with regard
        to long-lived connections from client to server. In addition, the Lift
        framework has support for Jetty Continuations, which work like this: </div>
      <ol>
        <li> You application receives a request and wants to wait to respond, as
          there is no message yet. </li>
        <li> You call suspend on the Jetty Continuation object. Here, Jetty will
          throw a special exception that will be caught in the container. The
          current thread is immediately returned to the thread pool, so it can
          process other requests. </li>
        <li> Assume that, after a while, you have a message for that particular
          client. You call resume on the same Continuation object. This time,
          Jetty will actually replay the initial HTTP request, and your servlet
          behaves like that request was just received from the client and, of
          course, returns the appropriate response. </li>
      </ol>
      <div  class="Unindented"> More details on Jetty’s Continuations are
        available on the Jetty web site at <a  href="http://docs.codehaus.org/display/JETTY/Continuations"
 class="FlexURL">http://docs.codehaus.org/display/JETTY/Continuations</a>.
      </div>
      <div  class="Indented"> If you run your Lift application in a Jetty
        container, Lift will automatically detect that and utilize the
        Continuation mechanism. Currently, on other containers, Comet in Lift
        will still work but won’t scale as well because Continuations aren’t
        supported. However, the Servlet 3.0 spec contains a more generic
        facility, called Suspended Requests, that will make this feature usable
        across a variety of containers. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-11.5.1"  class="toc">11.5.1</a> 
        Actors in Scala </h3>
      <div  class="Unindented"> It is important to understand that Comet support
        in Lift is primarily driven via Scala Actors. We won’t go into too much
        detail regarding Scala Actors, as you can find very detailed information
        in the paper by Philipp Haller, <i>Actors that Unify Threads And Events</i><span
 class="FootOuter"><span  class="SupFootMarker"> [G] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [G] </span><a  href="http://lamp.epfl.ch/%7Ephaller/doc/haller07coord.pdf"
 class="FlexURL">http://lamp.epfl.ch/~phaller/doc/haller07coord.pdf</a></span></span>.
      </div>
      <div  class="Indented"> Scala Actors are based on the concepts of the
        Erlang<span  class="FootOuter"><span  class="SupFootMarker"> [H] </span><span
 class="HoverFoot"><span  class="SupFootMarker">  [H] </span><a  href="http://erlang.org/"
 class="URL">http://erlang.org/</a></span></span> Actors model
        where an Actor is an asynchronous component that receives messages and
        sends or replies to messages. In Erlang, processes communicate via a
        very simple and effective messaging system built into the VM. </div>
      <div  class="Indented"> In Scala, however, Actors are supported at the
        library level and not at the language level. While less integrated, this
        does provide greater flexibility as the Actors library evolution does
        not impact the language itself. Since Scala typically sits on top of the
        JVM, Scala Actors are not bound to processes but rather to JVM threads.
        The key to understanding the scalability of Scala Actors is that there
        is no one-to-one relationship between Actors and Threads. For instance,
        when an Actor is waiting for a message we don’t end up having a thread
        waiting for a lock. Instead, the Actor body is impersonated by a closure
        that captures the rest of the computation. This closure is ’cached’
        internally until a message is designated for this Actor to consume. In
        particular, Scala’s Actor library leverages the
        <tt>match</tt> construct to allow very fine-grained
        selection of messages for processing. Another interesting note is that
        the Actor body (<tt>react</tt> function) never returns
        normally; in fact, the return type of the react function is
        <tt>Nothing</tt>. </div>
      <div  class="Indented"> Let’s take a look on a simple Actor-based example
        in Listing <a  href="#lst:PingPong-example"  class="Reference">11.5.1↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> PingPong example<a  name="lst:PingPong-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_615509">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">scala.actors.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">scala.actors.Actor.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">PingPong </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Application {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">count </code><code
 class="scala keyword">=</code> <code  class="scala value">0</code><code  class="scala plain">;</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">pong </code><code  class="scala keyword">=</code> <code
 class="scala plain">actor {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">loop {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">react {</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">Ping </code><code
 class="scala keyword">=</code><code  class="scala plain">> println(</code><code
 class="scala string">"Actor Pong Received Ping"</code><code  class="scala plain">)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">sender ! Pong</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">Stop </code><code
 class="scala keyword">=</code><code  class="scala plain">> println(</code><code
 class="scala string">"Stopping Pong"</code><code  class="scala plain">)         </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">exit()</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">       </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">ping </code><code  class="scala keyword">=</code> <code
 class="scala plain">actor {</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">pong ! Ping</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">loop {</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">react {</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">Pong </code><code
 class="scala keyword">=</code><code  class="scala plain">> println(</code><code
 class="scala string">"Actor Ping Received Pong"</code><code  class="scala plain">)</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">           </code><code
 class="scala plain">count </code><code  class="scala keyword">=</code> <code  class="scala plain">count + </code><code
 class="scala value">1</code><code  class="scala plain">;</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">if</code> <code  class="scala plain">(count < </code><code
 class="scala value">3</code><code  class="scala plain">) {</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">sender ! Ping</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">sender ! Stop</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">println(</code><code  class="scala string">"Stopping Ping"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">exit()</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">}</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala keyword">case</code> <code
 class="scala keyword">object</code> <code  class="scala plain">Ping </code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala keyword">case</code> <code
 class="scala keyword">object</code> <code  class="scala plain">Pong </code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala keyword">case</code> <code
 class="scala keyword">object</code> <code  class="scala plain">Stop</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> This is a trivial example in which we have two
        Actors exchanging <tt>Ping</tt>, <tt>Pong</tt>
        and <tt>Stop</tt> messages (note that the messages are case
        objects for pattern matching purposes). Also note that we did not
        explicitly used threads anywhere. We also did not use any thread
        blocking technique such as synchronized blocks. The reason is that we
        don’t have to. Actors’ message-passing mechanism is generally
        thread-safe (although deadlock is still possible due to dependent Actors<span
 class="FootOuter"><span  class="SupFootMarker"> [I] </span><span  class="HoverFoot"><span
 class="SupFootMarker"> [I] </span><a  href="http://ruben.savanne.be/articles/concurrency-in-erlang-scala"
 class="URL">http://ruben.savanne.be/articles/concurrency-in-erlang-scala</a></span></span>).
        Note that threads are used internally and in this specific example the
        execution may even occur on the same thread. The reason is that
        internally the Actors library uses a thread pool, and when an Actor
        receives a message the execution occurs in a thread from the thread
        pool. This is also a key to Actors’ scalability, because they allow
        threads to be used very efficiently and returned to the pool as soon as
        the Actor consumes the message. </div>
      <div  class="Indented"> Getting deeper into the details of actions is
        beyond the scope of this book, but we recommend that you read other
        materials in order to fully understand Scala actors. In particular,
        Philipp Haller has a nice page summarizing papers and tutorials on
        actors at <a  href="http://lamp.epfl.ch/%7Ephaller/actors.html"  class="FlexURL">http://lamp.epfl.ch/~phaller/actors.html</a>.
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-11.5.2"  class="toc">11.5.2</a> 
        Building a Comet Application in Lift </h3>
      <div  class="Unindented"> As we have seen, Comet support in Lift is
        provided by Scala Actors. Lift greatly simplifies the use of Actors by
        providing a <tt>CometActor</tt> trait that does almost all
        the work. You simply extend <tt>CometActor</tt> with your
        own class and fill in some implementation methods. </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note that your
            CometActor classes needs to exist in a <tt>comet</tt>
            subpackage as configured by
            <tt>LiftRules.addToPackages</tt>. For example, if you
            call <tt>LiftRules.addToPackages(“com.myapp”)</tt> in
            your boot method, your comet actors must exist in the
            <tt>com.myapp.comet</tt> package. </div>
        </div>
      </div>
      <div  class="Indented"> Let’s take a look at a simple example. Let’s say
        that we want to build a Clock snippet where the server will update the
        client page with the current server time every 10 seconds. First, we
        need a template, as shown in Listing <a  href="#lst:Comet-Clock-markup"
 class="Reference">11.5.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Comet Clock markup example<a  name="lst:Comet-Clock-markup"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_389016">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:comet</code> <code  class="xml color1">type</code><code
 class="xml plain">=</code><code  class="xml string">"Clock"</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"Other"</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">        </code><code
 class="xml plain">Current Time: <</code><code  class="xml keyword">clk:time</code><code
 class="xml plain">>Missing Clock</</code><code  class="xml keyword">clk:time</code><code
 class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">lift:comet</code><code  class="xml plain">>  </code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml plain"></</code><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In our template, we use the
        <tt><lift:comet></tt> tag to bind the
        <tt>CometActor</tt> to the portion of the template where it
        will render content, and the body of the
        <tt><lift:comet></tt> tag is quite similar to the body
        of a snippet. The <tt><clk:time></tt> tag will be
        bound by the <tt>Clock</tt> actor. The
        <tt>type</tt> attribute tells Lift which
        <tt>CometActor</tt> to call, and the
        <tt>name</tt> attribute is the name of this
        <tt>CometActor</tt>. The <tt>name</tt> attribute
        is a discriminator that allows you to have more then one
        <tt>CometActor</tt> of the same type on a given page. Next,
        we need to define our actor as shown in Listing <a  href="#lst:Clock-Comet-Actor"
 class="Reference">11.5.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Clock Comet Actor example<a  name="lst:Clock-Comet-Actor"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_975795">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.myapp.comet</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Clock </code><code  class="scala keyword">extends</code> <code
 class="scala plain">CometActor {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">defaultPrefix </code><code  class="scala keyword">=</code> <code
 class="scala plain">Full(</code><code  class="scala string">"clk"</code><code  class="scala plain">)   </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">render </code><code
 class="scala keyword">=</code> <code  class="scala plain">bind(</code><code  class="scala string">"time"</code> <code
 class="scala plain">-> timeSpan)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code> </div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">timeSpan </code><code
 class="scala keyword">=</code> <code  class="scala plain">(<span id</code><code
 class="scala keyword">=</code><code  class="scala string">"time"</code><code  class="scala plain">>{timeNow}</span>)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// schedule a ping every 10 seconds so we redraw</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">ActorPing.schedule(</code><code  class="scala keyword">this</code><code
 class="scala plain">, Tick, </code><code  class="scala value">10000</code><code
 class="scala plain">L) </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">lowPriority </code><code  class="scala keyword">:</code> <code
 class="scala plain">PartialFunction[Any, Unit] </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">Tick </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">println(</code><code  class="scala string">"Got tick "</code> <code
 class="scala plain">+ </code><code  class="scala keyword">new</code> <code  class="scala plain">Date());</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">partialUpdate(SetHtml(</code><code  class="scala string">"time"</code><code
 class="scala plain">, Text(timeNow.toString))) </code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">      </code><code
 class="scala comments">// schedule an update in 10 seconds</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">ActorPing.schedule(</code><code  class="scala keyword">this</code><code
 class="scala plain">, Tick, </code><code  class="scala value">10000</code><code
 class="scala plain">L) </code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala keyword">case</code> <code
 class="scala keyword">object</code> <code  class="scala plain">Tick</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> First, our actor defines the default prefix, which
        should be used for all nodes that will be bound inside
        <tt><lift:comet></tt> tag. In our case, we’re using
        the <tt>clk</tt> prefix. </div>
      <div  class="Indented"> Next, we have the <tt>render</tt>
        function where we do the binding between the
        <tt><clk:time></tt> node and the result of the
        <tt>timespan</tt> function. Basically, the
        <tt><clk:time></tt> node will be replaced by the
        <tt>span</tt> element returned by the
        <tt>timespan</tt> function. It is important to note that
        Comet content rendered by the <tt><lift:comet></tt>
        tag is a <tt><span></tt> tag by default. This default
        can be changed by overriding the <tt>parentTag</tt> function
        in your comet actor. </div>
      <div  class="Indented"> <tt>timeNow</tt> is a function from
        the <tt>net.liftweb.util.TimeHelpers</tt> trait that returns
        the current system time. We use the
        <tt>net.liftweb.util.ActorPing.schedule</tt> method to send
        a <tt>Tick</tt> message back to our actor after 10 seconds.
        This method is part of the the <tt>Clock</tt> class default
        constructor, and therefore will be called when the
        <tt>Clock</tt> class is instantiated. </div>
      <div  class="Indented"> Finally, we have the
        <tt>lowPriority</tt> function that returns a
        <tt>PartialFunction</tt>. To process messages in your
        CometActor, you can override the following functions:
        <tt>highPriority</tt>,<br />
        <tt>mediumPriority</tt>, and
        <tt>lowPriority</tt>. This multiplicity of functions is just
        a way of prioritizing application messages. The only thing that we do
        here is to pattern match the messages. In this simple example, we have
        only the <tt>Tick</tt> object. When a
        <tt>Tick</tt> is sent by the <tt>ActorPing</tt>,
        our code gets executed and the following actions occur: </div>
      <ol>
        <li> We print the current time to the console (just for fun) </li>
        <li> We call <tt>partialUpdate</tt> function. With a partial
          update we can update specific fragments on the client side and not
          actually re-render the entire content that the CometActor may produce.
          This optimization allows us to send something very specific to be
          updated on the client side. If we call
          <tt>reRender(true)</tt> instead, the entire real estate on
          the client side will be re-rendered. Getting back to our
          <tt>partialUpdate</tt> call, we are basically sending a
          <tt>JsCmd</tt> that we use to set the XHTML content for
          the element that has the id “time”. This is the
          <tt>span</tt> element returned by the
          <tt>timeSpan</tt> function. Since
          <tt>partialUpdate</tt> takes a <tt>JsCmd</tt>,
          you can use it to do just about anything on the client side accessible
          from JavaScript. </li>
        <li> We tell <tt>ActorPing</tt> to send another Tick message
          after 10 seconds. </li>
      </ol>
      <div  class="Unindented"> As you have seen, with just a few lines of code,
        we were able to create a Clock application in which the server updates
        the client every 10 seconds. Of course, this is just a trivial example,
        but now, you should have a clear picture of how CometActor works, so you
        can build more complex cases for your Lift application. </div>
      <div  class="Indented">
        <div  class="defskip"> </div>
      </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note: As described
            earlier It is also possible to use notices (notice/warning/error)
            from your comet actor. The CometActor trait already has notice,
            warning and error methods on it that will properly handle sending
            these messages to the client. Do not use the notice/warning/error
            methods on S, since they assume a stateful response and will not
            work from within a Comet callback. </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-11.6"  class="toc">11.6</a> 
        Coordinating Between Multiple Comet Clients </h2>
      <div  class="Unindented"> So far, our example has only shown a
        self-contained <tt>CometActor</tt> for the clock. But what
        if we want to have interaction between different clients? Scala’s actors
        are still the answer, but with a twist—we can use a singleton actor
        object that coordinates with the CometActor objects so that it can send
        messages to all of them. First, we define our singleton actor, as shown
        in Listing <a  href="#lst:Singleton-Actor"  class="Reference">11.6↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Singleton Actor<a  name="lst:Singleton-Actor"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_497983">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">case</code> <code
 class="scala keyword">class</code> <code  class="scala plain">SubscribeClock(clock </code><code
 class="scala keyword">:</code> <code  class="scala plain">Clock)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">case</code> <code
 class="scala keyword">class</code> <code  class="scala plain">UnsubClock(clock </code><code
 class="scala keyword">:</code> <code  class="scala plain">Clock)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">ClockMaster </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Actor {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">private</code> <code  class="scala keyword">var</code> <code
 class="scala plain">clocks </code><code  class="scala keyword">:</code> <code  class="scala plain">List[Clock] </code><code
 class="scala keyword">=</code> <code  class="scala plain">Nil</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">act </code><code  class="scala keyword">=</code> <code
 class="scala plain">loop {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">react {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">       </code><code
 class="scala keyword">case</code> <code  class="scala plain">SubscribeClock(clk) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">clocks </code><code  class="scala keyword">::=</code> <code
 class="scala plain">clk</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">UnsubClock(clk) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">clocks -</code><code  class="scala keyword">=</code> <code
 class="scala plain">clk</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Tick </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">clocks.foreach(</code><code  class="scala keyword">_</code> <code
 class="scala plain">! Tick)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> We’ve defined two case classes representing
        messages for subscribing and unsubscribing to the
        <tt>ClockMaster</tt> actor. The
        <tt>ClockMaster</tt> itself is a simple Actor (not a
        <tt>CometActor</tt>) that defines a simple message loop. It
        can either subscribe a new clock, unsubscribe to an existing clock, or
        distribute a Tick to all subscribed clocks. The other half of this
        equation slightly modifies our Clock class (as shown in Listing <a  href="#lst:Modified-Clock-Class"
 class="Reference">11.6↓</a>) so that it subscribes and unsubscribes
        to the ClockMaster at initialization and shutdown, respectively. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Modified Clock Class<a  name="lst:Modified-Clock-Class"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_678026">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">localSetup {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">ClockMaster ! SubscribeClock(</code><code  class="scala keyword">this</code><code
 class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">super</code><code  class="scala plain">.localSetup()</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">localShutdown {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">ClockMaster ! UnsubClock(</code><code  class="scala keyword">this</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">super</code><code  class="scala plain">.localShutdown()</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now, we can add an AJAX button (to an
        administration page, of course) that would allow the administrator to
        update everyone’s clocks at once. Listing <a  href="#lst:The-Admin-Tick"
 class="Reference">11.6↓</a> shows how we would bind in the button. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The Admin Tick<a  name="lst:The-Admin-Tick"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_914993">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">bind(</code><code
 class="scala string">"admin"</code><code  class="scala plain">, xhtml, </code><code
 class="scala string">"tick"</code> <code  class="scala plain">-></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">     </code><code
 class="scala plain">SHtml.ajaxButton(</code><code  class="scala string">"Tock!"</code><code
 class="scala plain">, {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> ClockMaster ! Tick</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">     </code><code
 class="scala plain">}))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Here’s what’s happening behind the scenes in our
        modified Clock application. Lift first identifies a Comet request by
        matching against the path given by the
        <tt>LiftRules.cometPath</tt> variable. Essentially the flow
        is as follows: </div>
      <ol>
        <li> Lift gets a Comet request. </li>
        <li> Lift checks the <tt>CometActor</tt>s to see if there
          are any messages. If there are no messages to be sent to this client,
          and the application is running in a Jetty container, the Jetty
          continuation is suspended, but no response is actually sent to client.
        </li>
        <li> Later, when your Comet actor is asked to render or partially
          update, the response is calculated, and the Jetty continuation is
          resumed. </li>
        <li> When Lift gets the resumed request from the container it returns
          the response calculated by the <tt>CometActor</tt> to the
          client. </li>
      </ol>
      <div  class="Unindented"> Note that <tt>CometActor</tt>s work
        even if you are not using Jetty container; the only issue is that you
        won’t benefit from the improved scalability of the suspend/resume
        mechanism offered by the Jetty container. </div>
      <h2  class="Section"> <a  name="toc-Section-11.7"  class="toc">11.7</a> 
        Summary </h2>
      <div  class="Unindented"> In this chapter, we explored how easily you can
        create AJAX and Comet interfaces in Lift. We discussed the underlying
        techniques used for AJAX and Comet, as well as how Lift provides support
        functions and classes to simplify writing apps that utilize these
        techniques. We showed examples of how to use the
        <tt>SHtml</tt> object to create AJAX-enabled form elements
        and how to customize things like the AJAX request path in Lift. We
        reviewed Scala actors and how the <tt>CometActor</tt> trait
        is used to make a Comet event handler. We also discussed how Lift works
        to alleviate scalability issues with Comet on supported containers.
        Finally, we wrote a simple Clock application and showed how you can mix
        AJAX and Comet in the same application. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-12"  class="toc">12</a> JPA
        Integration<a  name="cha:JPA-Integration"  class="Label"> </a> </h1>
      <div  class="Unindented">
        <div  style="width: 100%;"  class="Framed"> This chapter is still under
          active development. The contents will change. </div>
      </div>
      <div  class="Indented"> The Java Persistence API<span  class="FootOuter"><span
 class="SupFootMarker">  [J] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [J] </span><a  href="http://java.sun.com/javaee/overview/faq/persistence.jsp"
 class="FlexURL">http://java.sun.com/javaee/overview/faq/persistence.jsp</a></span></span>,
        or JPA<a  href="#index-JPA"  name="entry-JPA-0"  class="IndexReference">↓</a> for short, is the
        evolution of a number of frameworks in Java to provide a simple database
        access layer for plain java objects (and, transitively, Scala objects).
        JPA was developed as part of the Enterprise Java Beans 3 (EJB3)
        specification, with the goal of simplifying the persistence model. Prior
        versions had used the Container Managed Persistence (CMP<a  href="#index-CMP"
 name="entry-CMP-0"  class="IndexReference">↓</a>) framework, which
        required many boilerplate artifacts in the form of interfaces and XML
        descriptors. As part of the overarching theme of EJB3 to simplify and
        use convention over configuration, JPA uses sensible defaults and
        annotations<a  href="#index-annotations"  name="entry-annotations-0"  class="IndexReference">↓</a> heavily,
        while allowing for targetted overrides of behavior via XML descriptors.
        JPA also does away with many of the interfaces used in CMP and provides
        a single <tt>javax.persistence.EntityManager</tt><a  href="#index-EntityManager"
 name="entry-EntityManager-0"  class="IndexReference">↓</a> class for
        all persistence operations. An additional benefit is that JPA was
        designed so that it could be used both inside and outside of the
        Enterprise container, and several projects (Hibernate<a  href="#index-Hibernate"
 name="entry-Hibernate-0"  class="IndexReference">↓</a>, TopLink<a  href="#index-TopLink"
 name="entry-TopLink-0"  class="IndexReference">↓</a>, JPOX<a  href="#index-JPOX"
 name="entry-JPOX-0"  class="IndexReference">↓</a>, etc) provide
        standalone implementations of <tt>EntityManager</tt>. </div>
      <div  class="Indented"> As we’ve seen in chapter <a  href="#cha:mapper_and_record"
 class="Reference">8↑</a>, Lift already comes with a very capable
        database abstraction layer, so why would we want to use something else?
        There are a number of reasons: </div>
      <ol>
        <li> JPA is easily accessible from both Java and Scala. If you are using
          Lift to complement part of a project that also contains Java
          components, JPA allows you to use a common database layer between both
          and avoid duplication of effort. It also means that if you have an
          existing project based on JPA, you can easily integrate it into Lift </li>
        <li> JPA gives you more flexibility with complex and/or large schemas.
          While Lift’s Mapper provides most of the functionality you would need,
          JPA provides additional lifecycle methods and mapping controls when
          you have complex needs. Additionally, JPA has better support for joins
          and relationships between entities. </li>
        <li> JPA can provide additional performance improvements via
          second-level object caching. It’s possible to roll your own in Lift,
          but JPA allows you to cache frequently-accessed objects in memory so
          that you avoid hitting the database entirely </li>
      </ol>
      <h2  class="Section"> <a  name="toc-Section-12.1"  class="toc">12.1</a> 
        Introducing JPA </h2>
      <div  class="Unindented"> In order to provide a concrete example to build
        on while learning how to integrate JPA, we’ll be building a small Lift
        app to manage a library of books. The completed example is available
        under the Lift Git<a  href="#index-Git"  name="entry-Git-0"  class="IndexReference">↓</a> repository in the
        sites directory, and is called “JPADemo”. Basic coverage of the JPA
        operations is in section <a  href="#sec:JPA-Examples"  class="Reference">12.5 on page 1↓</a>; if you want more detail on
        JPA, particularly with advanced topics like locking and hinting, there
        are several very good tutorials to be found online<span  class="FootOuter"><span
 class="SupFootMarker"> [K] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [K] </span><a  href="http://java.sun.com/developer/technicalArticles/J2EE/jpa/"
 class="FlexURL">http://java.sun.com/developer/technicalArticles/J2EE/jpa/</a>,
            <a  href="http://www.jpox.org/docs/1_2/tutorials/jpa_tutorial.html"
 class="FlexURL">http://www.jpox.org/docs/1_2/tutorials/jpa_tutorial.html</a></span></span>.
        Our first step is to set up a master project<a  href="#index-master-project"
 name="entry-master-project-0"  class="IndexReference">↓</a> for
        Maven. This project will have two modules under it, one for the JPA
        library and one for the Lift application. In a working directory of your
        choosing, issue the following command: </div>
      <pre  class="LyX-Code">mvn archetype:generate \
  -DarchetypeRepository=http://scala-tools.org/repo-snapshots \
  -DarchetypeGroupId=net.liftweb \
  -DarchetypeArtifactId=lift-archetype-jpa-basic \
  -DarchetypeVersion=1.1-SNAPSHOT \
  -DgroupId=com.foo.jpaweb \
  -DartifactId=JPADemo \
  -Dversion=1.0-SNAPSHOT
</pre>
      <div  class="Unindented"> This will use the JPA archetype to create a new
        project for you with modules for the persistence and web portions of the
        project. </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note: The reason we have
            split the module out into two projects is that it aids deployment on
            Jave EE servers to have the Persistence module be an independent JAR
            file. If you don’t need that, you can simply merge the contents of
            the two modules into a single project and it will work standalone.
            Note that you’ll need to merge the pom.xml file’s dependencies and
            plugin configurations from all three POMs. Lift comes with an
            archetype that handles this already, albeit without the demo code we
            show here. Simply use the lift-archetype-jpa-blank-single archetype
            and you’ll get a blank project (with minimal files for JPA and Lift)
            that you can use for your app. There’s also a blank archetype that
            uses two modules if you want that, called lift-archetype-jpa-blank.
          </div>
        </div>
      </div>
      <div  class="Indented"> You will get a prompt asking you to confirm the
        settings we’ve chosen; just hit <tt><enter></tt>. As
        of this writing we have to use the snapshot version of the archetype
        because it didn’t make the Lift 1.0 deadline, but otherwise it’s a
        stable archetype. You will also see some Velocity warnings about invalid
        references; these can be safely ignored and will hopefully be fixed by
        1.1. After the archetype is generated, you should have the following
        tree structure: </div>
      <pre  class="LyX-Code">JPADemo
|-- README
|-- pom.xml
|-- spa
|   |-- pom.xml
|   ‘-- src ...
‘-- web
    |-- pom.xml
    ‘-- src ...
</pre>
      <div  class="Unindented"> If you look at the source directories, you’ll
        see that our code is already in place! If you’re making your own
        application you can either use the previously mentioned blank archetypes
        to start from scratch, or use the basic archetype and modify the POMs,
        Scala code and templates to match your needs. For now, let’s go over the
        contents of the project. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.1.1"  class="toc">12.1.1</a> 
        Using Entity Classes<a  href="#index-entity-class"  name="entry-entity-class-0"
 class="IndexReference">↓</a> in Scala </h3>
      <div  class="Unindented"> The main components of a JPA library are the
        entity classes that comprise your data model. For our example
        application we need two primary entities: Author and Book. Let’s take a
        look at the Author class first, shown in listing <a  href="#lst:Author.scala"
 class="Reference">G.1.1 on page 1↓</a>. The listing shows our import
        of the entire javax.persistence package as well as several annotations
        on a basic class. For those of you coming from the Java world in JPA,
        the annotations should look very familiar. The major difference between
        Java and Scala annotations is that each parameter in a Scala annotation
        is considered a val, which explains the presence of the val keyword in
        lines 12, 15 and 17-18. In line 17 you may also note that we must
        specify the target entity class; although Scala uses generics, the
        generic types aren’t visible from Java, so the Java JPA libraries can’t
        deduce the correct type. You may also notice that on line 18 we need to
        use the Java collections classes for Set, List, etc. With a little bit
        of implicit conversion magic (to be shown later), this has very little
        impact on our code. On final item item to note is that the Scala
        compiler currently does not support nested annotations <span  class="FootOuter"><span
 class="SupFootMarker"> [L] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [L] </span><a  href="https://lampsvn.epfl.ch/trac/scala/ticket/294"
 class="FlexURL">https://lampsvn.epfl.ch/trac/scala/ticket/294</a></span></span>,
        so where we would normally use them (join tables, named queries, etc),
        we will have to use the orm.xml descriptor, which we cover next. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.1.2"  class="toc">12.1.2</a> <a
 name="sub:Using-the-orm.xml"  class="Label"> </a>Using the orm.xml<a  href="#index-orm.xml"
 name="entry-orm.xml-0"  class="IndexReference">↓</a> descriptor </h3>
      <div  class="Unindented"> As we stated in the last section, there are some
        instances where the Scala compiler doesn’t fully cover the JPA
        annotations (nested annotations in particular). Some would also argue
        that queries and other ancillary data (table names, column names, etc)
        should be separate from code. Because of that, JPA allows you to specify
        an external mapping descriptor to define and/or override the mappings
        for your entity classes<a  href="#index-entity-classes"  name="entry-entity-classes-0"
 class="IndexReference">↓</a>. The
        basic orm.xml file starts with the DTD type declaration, as shown in
        listing <a  href="#lst:orm.xml"  class="Reference">G.1.2 on page 1↓</a>. Following the preamble, we
        can define a package that will apply to all subsequent entries so that
        we don’t need to use the fully-qualified name for each class. In our
        example, we would like to define some named queries for each class.
        Putting them in the orm.xml allows us to modify them without requiring a
        recompile. The complete XML Schema Definition can be found at <a  href="http://java.sun.com/xml/ns/persistence/orm_1_0.xsd"
 class="FlexURL">http://java.sun.com/xml/ns/persistence/orm_1_0.xsd</a>.
      </div>
      <div  class="Indented"> In this case we have used the orm.xml file to
        augment our entity classes. If, however, we would like to override the
        configuration, we may use that as well on a case-by-case basis. Suppose
        we wished to change the column name for the Author’s
        <tt>name</tt> property. We can add (per the XSD) a section
        to the Author entity element as shown in listing <a  href="#lst:JPA-Author-override"
 class="Reference">12.1.2↓</a>. The
        <tt>attribute-override</tt> element lets us change anything
        that we would normally specify on the <tt>@Column</tt>
        annotation. This gives us an extremely powerful method for controlling
        our schema mapping outside of the source code. We can also add named
        queries<a  href="#index-named-queries"  name="entry-named-queries-0"  class="IndexReference">↓</a> in the
        orm.xml so that we have a central location for defining or altering the
        queries. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:JPA-Author-override"  class="Label">
            </a>Author override </div>
          <entity class="Author">
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_240363">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">named-query</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"findAllAuthors"</code><code
 class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">query</code><code  class="xml plain">></code><code
 class="xml color2"><![CDATA[from Author a order by a.name]]></code><code  class="xml plain"></</code><code
 class="xml keyword">query</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">named-query</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">attribute-override</code> <code
 class="xml color1">name</code><code  class="xml plain">=</code><code  class="xml string">"name"</code><code
 class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">column</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"author_name"</code> <code
 class="xml color1">length</code><code  class="xml plain">=</code><code  class="xml string">"30"</code> <code
 class="xml plain">/></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">attribute-override</code><code
 class="xml plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml plain"></</code><code
 class="xml keyword">entity</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.1.3"  class="toc">12.1.3</a> 
        Working with Attached and Detached Objects<a  name="sub:Working-with-Attached"
 class="Label"> </a> </h3>
      <div  class="Unindented"> JPA operates with entities in one of two modes:
        attached and detached. An attached object is one that is under the
        direct control of a live JPA session. That means that the JPA provider
        monitors the state of the object and writes it to the database at the
        appropriate time. Objects can be attached either explicitly via the
        <tt>persist</tt> and <tt>merge</tt> methods
        (section <a  href="#sub:Persisting,-merging-and-removing"  class="Reference">12.5.1↓</a>), or implicitly via query results, the
        <tt>getReference</tt> method or the
        <tt>find</tt> method. </div>
      <div  class="Indented"> As soon as the session ends, any formerly attached
        objects are now considered detached. You can still operate on them as
        normal objects but any changes are not directly applied to the database.
        If you have a detached object, you can re-attach it to your current
        session with the <tt>merge</tt> method; any changes since
        the object was detached, as well as any subsequent changes to the
        attached object, will be applied to the database at the appropriate
        time. The concept of object attachment is particularly useful in Lift
        because it allows us to generate or query for an object in one request
        cycle and then make modifications and merge in a different cycle. </div>
      <div  class="Indented"> As an example, our library application provides a
        summary listing of authors on one page
        (<tt>src/main/webapp/authors/list.html</tt>) and allows
        editing of those entities on another
        (<tt>src/main/webapp/authors/add.html</tt>). We can use the
        <tt>SHtml.link</tt> generator on our list page, combined
        with a <tt>RequestVar</tt>, to pass the instance (detached
        once we return from the list snippet) to our edit snippet. Listing <a  href="#lst:Passing-Detached-Instances"
 class="Reference">12.1.3↓</a> shows excerpts from our library
        application snippets demonstrating how we hand off the instance and do a
        merge within our edit snippets submission processing function
        (<tt>doAdd</tt>). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Passing Detached Instances Around an
            Application<a  name="lst:Passing-Detached-Instances"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_878437">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// in src/main/scala/net/liftweb/jpademo/snippets/Author.scala</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">...</code><code
 class="scala keyword">package</code> <code  class="scala plain">and imports ... </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">AuthorOps {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">list (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">authors </code><code
 class="scala keyword">=</code> <code  class="scala plain">...</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">authors.flatMap(author </code><code  class="scala keyword">=</code><code
 class="scala plain">> bind(</code><code  class="scala string">"author"</code><code
 class="scala plain">, xhtml, ...</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala comments">// use the link closure to capture the current</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala comments">// instance for edit insertion</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala string">"edit"</code> <code  class="scala plain">-> SHtml.link(</code><code
 class="scala string">"add.html"</code><code  class="scala plain">,</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">           </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> authorVar(author), Text(?(</code><code
 class="scala string">"Edit"</code><code  class="scala plain">)))))</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Set up a requestVar to track the author object for edits and adds</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">object</code> <code  class="scala plain">authorVar </code><code
 class="scala keyword">extends</code> <code  class="scala plain">RequestVar(</code><code
 class="scala keyword">new</code> <code  class="scala plain">Author())</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// helper def</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">author </code><code
 class="scala keyword">=</code> <code  class="scala plain">authorVar.is</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">add (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">doAdd () </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">...</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">      </code><code
 class="scala comments">// merge and save the detached instance</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Model.mergeAndFlush(author)</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">...</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// Hold a val here so that the closure grabs it instead of the def</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">current </code><code
 class="scala keyword">=</code> <code  class="scala plain">author</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// Use a hidden element to reinsert the instance on form submission</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"author"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">      </code><code
 class="scala string">"id"</code> <code  class="scala plain">-> SHtml.hidden(() </code><code
 class="scala keyword">=</code><code  class="scala plain">> authorVar(current)), ...,</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">      </code><code
 class="scala string">"submit"</code> <code  class="scala plain">-> SHtml.submit(?(</code><code
 class="scala string">"Save"</code><code  class="scala plain">), doAdd))</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-12.2"  class="toc">12.2</a> <a
 name="sec:Obtaining-an-EM"  class="Label"> </a>Obtaining a
        Per-Session EntityManager </h2>
      <div  class="Unindented"> Ideally, we would like our JPA access to be as
        seamless as possible, particularly when it comes to object lifecycle. In
        JPA, objects can be attached to a current persistence session, or they
        can be detached from a JPA session. This gives us a lot of flexibility
        (which we’ll use later) in dealing with the objects themselves, but it
        also means that we need to be careful when we’re accessing object
        properties. JPA can use lazy retrieval for instance properties; in
        particular, this is the default behavior for collection-based
        properties. What this means is that if we’re working on a detached
        object and we attempt to access a collection contained in the instance,
        we’re going to get an exception that the session that the object was
        loaded in is no longer live. What we’d really like to do is have some
        hooks into Lift’s request cycle that allows us to set up a session when
        the request starts and properly close it down when the request ends. We
        still have to be careful with objects that have been passed into our
        request (from form callbacks, for instance), but in general this will
        guarantee us that once we’ve loaded an object in our snippet code we
        have full access to all properties at any point within our snippets. </div>
      <div  class="Indented"> Fortunately for us, Lift provides just such a
        mechanism. In fact, Lift supports several related mechanisms for
        lifecycle management<span  class="FootOuter"><span  class="SupFootMarker"> 
            [M] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [M] </span>Notably, <tt>S.addAround</tt> with the
            <tt>LoanWrapper</tt></span></span>, but for now we’re
        going to focus on just one: the <tt>RequestVar</tt><a  href="#index-RequestVar"
 name="entry-RequestVar-1"  class="IndexReference">↓</a>. A
        <tt>RequestVar</tt> represents a variable associated with
        the lifetime of the request. This is in contrast to
        <tt>SessionVar</tt>, which defines a variable for the
        lifetime of the user’s session. <tt>RequestVar</tt> gives us
        several niceties over handling request parameters ourselves, including
        type safety and a default value. We go into more detail on
        <tt>RequestVars</tt> and <tt>SessionVars</tt> in
        section <a  href="#sec:Session-and-Request"  class="Reference">3.11 on page 1↑</a>. In addition to the Lift
        facilities, we also use the ScalaJPA project<span  class="FootOuter"><span
 class="SupFootMarker"> [N] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [N] </span><a  href="http://scala-tools.org/mvnsites-snapshots/scalajpa/"
 class="FlexURL">http://scala-tools.org/mvnsites-snapshots/scalajpa/</a>,
            source code available at <a  href="http://github.com/dchenbecker/scalajpa/tree"
 class="URL">http://github.com/dchenbecker/scalajpa/tree</a></span></span>
        to handle some of the boilerplate of utilizing JPA. ScalaJPA provides
        some nice traits that “Scalafy” the JPA
        <tt>EntityManager</tt> and <tt>Query</tt>
        interfaces, as well as accessors that make retrieving an EM simple. To
        use ScalaJPA we simply add the following dependency to our POM. </div>
      <pre  class="LyX-Code"><dependency>
  <groupId>org.scala-tools</groupId>
  <artifactId>scalajpa</artifactId>
  <version>1.0-SNAPSHOT</version>
</dependency>
</pre>
      <div  class="Unindented"> Note that at the time of writing the library is
        at 1.0-SNAPSHOT, but should be promoted to 1.0 soon. </div>
      <div  class="Indented"> We leverage ScalaJPA’s
        <tt>LocalEMF</tt> and <tt>RequestVarEM</tt>
        traits to provide a simple <tt>RequestVar</tt> interface to
        obtain the EM via local lookup (i.e. via the
        <tt>javax.persistence.Persistence</tt> class), as shown in
        listing <a  href="#lst:Setting-up-EM"  class="Reference">12.2 on page 1↓</a>. It’s trivial to use JNDI
        instead by substituting the <tt>JndiEMF</tt> trait for the
        <tt>LocalEMF</tt> trait, but the details of setting up the
        JNDI persistence module are beyond the scope of this book. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Setting-up-EM"  class="Label"> </a>Setting
            up an EntityManager via RequestVar </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_217216">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.org.scala</code><code  class="scala keyword">_</code><code
 class="scala plain">libs.jpa.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">Model </code><code  class="scala keyword">extends</code> <code
 class="scala plain">LocalEMF(</code><code  class="scala string">"jpaweb"</code><code
 class="scala plain">) </code><code  class="scala keyword">with</code> <code  class="scala plain">RequestVarEM</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Once we have this object set up, we can access all
        of the <tt>ScalaEntityManager</tt> methods directly on
        <tt>Model</tt>. </div>
      <h2  class="Section"> <a  name="toc-Section-12.3"  class="toc">12.3</a> 
        Handling Transactions<a  href="#index-Transactions"  name="entry-Transactions-0"
 class="IndexReference">↓</a> </h2>
      <div  class="Unindented"> We’re not going to go into too much detail here;
        there are better documents available<span  class="FootOuter"><span  class="SupFootMarker"> 
            [O] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [O] </span><a  href="http://java.sun.com/developer/EJTechTips/2005/tt0125.html"
 class="FlexURL">http://java.sun.com/developer/EJTechTips/2005/tt0125.html</a></span></span>
        if you want to go into depth on how the Java Transaction API (JTA) or
        general transactions work. Essentially, a transaction is a set of
        operations that are performed atomically; that is, they either all
        complete successfully or none of them do. The classic example is
        transferring funds between two bank accounts: you subtract the amount
        from one account and add it to the other. If the addition fails and
        you’re not operating in the context of a transaction, the client has
        lost money! </div>
      <div  class="Indented"> In JPA, transactions are required. If you don’t
        perform your operations within the scope of a transaction you will
        either get an exception (if you’re using JTA), or you will spend many
        hours trying to figure out why nothing is being saved to the database.
        There are two ways of handling transactions under JPA: resource local
        and JTA. Resource local transactions are what you use if you are
        managing the EM factory yourself (corresponding to the
        <tt>LocalEMF</tt> trait). Similarly, JTA is what you use
        when you obtain your EM via JNDI. Technically it’s also possible to use
        JTA with a locally managed EM, but that configuration is beyond the
        scope of this book. </div>
      <div  class="Indented"> Generally, we would recommend using JTA where it’s
        free (i.e., when deploying to a Java EE container) and using
        resource-local when you’re using a servlet container such as Jetty or
        Tomcat. If you will be accessing multiple databases or involving
        resources like EJBs, it is much safer to use JTA so that you can utilize
        distributed transactions. Choosing between the two is as simple as
        setting a property in your persistence.xml file (and changing the code
        to open and close the EM). Listing <a  href="#lst:Setting-the-transaction-type"
 class="Reference">12.3↓</a> shows examples of setting the
        <tt>transaction-type</tt> attribute to
        <tt>RESOURCE_LOCAL</tt> and to JTA. If you want to use JTA,
        you can also omit the <tt>transaction-type</tt> attribute
        since JTA is the default. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Setting-the-transaction-type"  class="Label">
            </a>Setting the transaction type </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_517469">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">persistence-unit</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"jpaweb"</code> <code  class="xml color1">transaction-type</code><code
 class="xml plain">=</code><code  class="xml string">"RESOURCE_LOCAL"</code><code
 class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">non-jta-datasource</code><code
 class="xml plain">>myDS</</code><code  class="xml keyword">non-jta-datasource</code><code
 class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">persistence-unit</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"jpaweb"</code> <code  class="xml color1">transaction-type</code><code
 class="xml plain">=</code><code  class="xml string">"JTA"</code><code  class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">jta-datasource</code><code
 class="xml plain">>myDS</</code><code  class="xml keyword">jta-datasource</code><code
 class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> You must make sure that your EM setup code matches
        what you have in your <tt>persistence.xml</tt>.
        Additionally, the database connection must match; with JTA, you <i>must</i>
        use a <tt>jta-data-source</tt> (obtained via JNDI) for your
        database connection. For resource-local, you can either use a
        <tt>non-jta-datasource</tt> element or you can set the
        provider properties, as shown in listing <a  href="#lst:Setting-resource-local-properties"
 class="Reference">12.3 on page 1↓</a>. In this particular example
        we’re setting the properties for Hibernate, but similar properties exist
        for TopLink<span  class="FootOuter"><span  class="SupFootMarker"> [P] </span><span
 class="HoverFoot"><span  class="SupFootMarker"> [P] </span><a  href="http://www.oracle.com/technology/products/ias/toplink/JPA/essentials/toplink-jpa-extensions.html"
 class="FlexURL">http://www.oracle.com/technology/products/ias/toplink/JPA/essentials/toplink-jpa-extensions.html</a></span></span>,
        JPOX<span  class="FootOuter"><span  class="SupFootMarker"> [Q] </span><span
 class="HoverFoot"><span  class="SupFootMarker"> [Q] </span><a  href="http://www.jpox.org/docs/1_2/persistence_unit.html"
 class="FlexURL">http://www.jpox.org/docs/1_2/persistence_unit.html</a></span></span>,
        and others. </div>
      <div  class="Indented"> If you’ll be deploying into a JEE container, such
        as JBoss or GlassFish, then you get JTA support almost for free since
        JTA is part of the JEE spec. If you want to deploy your application on a
        lightweight container like Jetty or Tomcat, we would recommend that you
        look into using an external JTA coordinator such as JOTM, Atomikos, or
        JBoss Transaction Manager, since embedding a JTA provider in your
        container is a nontrivial task. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Setting-resource-local-properties"
 class="Label"> </a>Setting resource-local properties for
            Hibernate </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_792425">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">persistence</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">   </code><code
 class="xml plain"><</code><code  class="xml keyword">persistence-unit</code> <code
 class="xml color1">name</code><code  class="xml plain">=</code><code  class="xml string">"jpaweb"</code> <code
 class="xml color1">transaction-type</code><code  class="xml plain">=</code><code
 class="xml string">"RESOURCE_LOCAL"</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">properties</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">         </code><code
 class="xml plain"><</code><code  class="xml keyword">property</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"hibernate.dialect"</code> <code
 class="xml color1">value</code><code  class="xml plain">=</code><code  class="xml string">"org.hibernate.dialect.PostgreSQLDialect"</code><code
 class="xml plain">/></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">         </code><code
 class="xml plain"><</code><code  class="xml keyword">property</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"hibernate.connection.driver_class"</code> <code
 class="xml color1">value</code><code  class="xml plain">=</code><code  class="xml string">"org.postgresql.Driver"</code><code
 class="xml plain">/></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">         </code><code
 class="xml plain"><</code><code  class="xml keyword">property</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"hibernate.connection.username"</code> <code
 class="xml color1">value</code><code  class="xml plain">=</code><code  class="xml string">"somUser"</code><code
 class="xml plain">/></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">         </code><code
 class="xml plain"><</code><code  class="xml keyword">property</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"hibernate.connection.password"</code> <code
 class="xml color1">value</code><code  class="xml plain">=</code><code  class="xml string">"somePass"</code><code
 class="xml plain">/></code></div>
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">         </code><code
 class="xml plain"><</code><code  class="xml keyword">property</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"hibernate.connection.url"</code> <code
 class="xml color1">value</code><code  class="xml plain">=</code><code  class="xml string">"jdbc:postgresql:jpaweb"</code><code
 class="xml plain">/></code></div>
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"></</code><code  class="xml keyword">properties</code><code  class="xml plain">></code></div>
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">   </code><code
 class="xml plain"></</code><code  class="xml keyword">persistence-unit</code><code
 class="xml plain">></code></div>
                        <div  class="line number11 index10 alt2"><code  class="xml plain"></</code><code
 class="xml keyword">persistence</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> One final note in regard to transactions is how
        they’re affected by Exceptions. Per the spec, any exceptions thrown
        during the scope of a transaction, other than<br />
        <tt>javax.persistence.NoResultException</tt> or
        <tt>javax.persistence.NonUniqueResultException</tt>, will
        cause the transaction to be marked for rollback. </div>
      <h2  class="Section"> <a  name="toc-Section-12.4"  class="toc">12.4</a> <a
 name="sec:ScalaEntityManager-and-ScalaQuery"  class="Label"> </a>ScalaEntityManager
        and ScalaQuery </h2>
      <div  class="Unindented"> Now that we’ve gone through setting up our
        <tt>EntityManager</tt>, let’s look at how we actually use
        them in an application. As a convenience, ScalaJPA defines two thin
        wrappers on the existing <tt>EntityManager</tt><span  class="FootOuter"><span
 class="SupFootMarker"> [R] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [R] </span><a  href="http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityManager.html"
 class="FlexURL">http://java.sun.com/javaee/5/docs/api/javax/persistence/EntityManager.html</a></span></span>
        and <tt>Query</tt><span  class="FootOuter"><span  class="SupFootMarker"> 
            [S] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [S] </span><a  href="http://java.sun.com/javaee/5/docs/api/javax/persistence/Query.html"
 class="FlexURL">http://java.sun.com/javaee/5/docs/api/javax/persistence/Query.html</a></span></span>
        interfaces to provide more Scala-friendly methods. This means that we
        get Scala’s collection types (i.e. <tt>List</tt> instead of
        <tt>java.util.List</tt>) and generic signatures so that we
        can avoid explicit casting. The <tt>ScalaEntityManager</tt>
        trait provides a wrapper on the <tt>EntityManager</tt>
        class, and is included as part of the <tt>RequestVarEM</tt>
        trait that we’ve mixed into our <tt>Model</tt> object. The
        API for <tt>ScalaEntityManager</tt> can be found at <a  href="http://scala-tools.org/mvnsites/scalajpa/scaladocs/org/scala_libs/jpa/ScalaEntityManager.html"
 class="FlexURL">http://scala-tools.org/mvnsites/scalajpa/scaladocs/org/scala_libs/jpa/ScalaEntityManager.html</a>.
      </div>
      <div  class="Indented"> Next, we have the <tt>ScalaQuery</tt>
        trait, with API docs at <a  href="http://scala-tools.org/mvnsites/scalajpa/scaladocs/org/scala_libs/jpa/ScalaQuery.html"
 class="FlexURL">http://scala-tools.org/mvnsites/scalajpa/scaladocs/org/scala_libs/jpa/ScalaQuery.html</a>.
        Like <tt>ScalaEntityManager</tt>, this is a thin wrapper on
        the <tt>Query</tt> interface. In particular, methods that
        return entities are typed against the <tt>ScalaQuery</tt>
        itself, so that you don’t need to do any explicit casting in your client
        code. We also have some utility methods to simplify setting a parameter
        list as well as obtaining the result(s) of the query. </div>
      <h2  class="Section"> <a  name="toc-Section-12.5"  class="toc">12.5</a> <a
 name="sec:JPA-Examples"  class="Label"> </a>Operating on Entities </h2>
      <div  class="Unindented"> In this section we’ll demonstrate how to work
        with entities and cover some important tips on using JPA effectively. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.5.1"  class="toc">12.5.1</a> <a
 name="sub:Persisting,-merging-and-removing"  class="Label"> </a>Persisting,
        Merging and Removing Entities </h3>
      <div  class="Unindented"> The first step to working with any persistent
        entities is to actually persist them. If you have a brand new object,
        you can do this with the <tt>persist</tt> method: </div>
      <pre  class="LyX-Code">val myNewAuthor = new Author; myNewAuthor.name = "Wilma"
Model.persist(myNewAuthor)
</pre>
      <div  class="Unindented"> This attaches the
        <tt>myNewAuthor</tt> object to the current persistence
        session. Once the object is attached it should be visible in any
        subsequent queries, although it may not be written to the database just
        yet (see section <a  href="#sub:The-importance-of-flush"  class="Reference">12.5.6↓</a>). Note that the
        <tt>persist</tt> method is only intended for brand new
        objects. If you have a detached object and you try to use
        <tt>persist</tt> you will most likely get an
        <tt>EntityExistsException</tt> as the instance you’re
        merging is technically conflicting with itself. Instead, you want to use
        the <tt>merge</tt> method to re-attach detached objects: </div>
      <pre  class="LyX-Code">val author = Model.merge(myOldAuthor)
</pre>
      <div  class="Unindented"> An important thing to note is that the
        <tt>merge</tt> method doesn’t actually attach the object
        passed to it; instead, it makes an attached <i>copy</i> of the passed
        object and returns the copy. If you mistakenly merge without using the
        returned value: </div>
      <pre  class="LyX-Code">Model.merge(myOldAuthor)
myOldAuthor.name = “Fred”
</pre>
      <div  class="Unindented"> you’ll find that subsequent changes to the
        object won’t be written to the database. One nice aspect of the
        <tt>merge</tt> method is that it intelligently detects
        whether the entity you’re merging is a new object or a detached object.
        That means that you can use <tt>merge</tt> everywhere and
        let it sort out the semantics. For example, in our library application,
        using <tt>merge</tt> allows us to combine the adding and
        editing functionality into a single snippet; if we want to edit an
        existing <tt>Author</tt> we pass it into the method.
        Otherwise, we pass a brand new <tt>Author</tt> instance into
        the method and the merge takes care of either case appropriately. </div>
      <div  class="Indented"> Removing an object is achieved by calling the
        <tt>remove</tt> method: </div>
      <pre  class="LyX-Code">Model.remove(myAuthor)
</pre>
      <div  class="Unindented"> The passed entity is detached from the session
        immediately and will be removed from the database at the appropriate
        time. If the entity has any associations on it (to collections or other
        entities), they will be cascaded as indicated by the entity mapping. An
        example of a cascade is shown in the <tt>Author</tt> listing
        on page <a  href="#lst:Author.scala"  class="Reference">1↓</a>. The books collection has the cascade set to
        REMOVE, which means that if an author is deleted, all of the books by
        that author will be removed as well. The default is to not cascade
        anything, so it’s important that you properly set the cascade on
        collections to avoid constraint violations when you remove entities.
        It’s also useful to point out that you don’t actually need to have an
        entity loaded to remove it. You can use the
        <tt>getReference</tt> method to obtain a proxy that will
        cause the corresponding database entry to be removed: </div>
      <pre  class="LyX-Code">Model.remove(Model.getReference(classOf[Author], someId))
</pre>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.5.2"  class="toc">12.5.2</a> 
        Loading an Entity </h3>
      <div  class="Unindented"> There are actually three ways to load an entity
        object in your client code: using <tt>find</tt>,
        <tt>getReference</tt> or a query. The simplest is to use the
        <tt>find</tt> method: </div>
      <pre  class="LyX-Code">val myBook = Model.find(classOf[Book], someId)
</pre>
      <div  class="Unindented"> The <tt>find</tt> method takes two
        parameters: the class that you’re trying to load and the value of the ID
        field of the entity. In our example, the <tt>Book</tt> class
        uses the <tt>Long</tt> type for its ID, so we would put a
        <tt>Long</tt> value here. It returns either a
        <tt>Full</tt> <tt>Box</tt> (section <a  href="#sec:Box-%28or-Scala%27s"
 class="Reference">C.2 on page 1↓</a>) if the entity is found in the
        database, otherwise it returns <tt>Empty</tt>. With
        <tt>find</tt>, the entity is loaded immediately from the
        database and can be used in both attached and detached states. </div>
      <div  class="Indented"> The next method you can use is the
        <tt>getReference</tt> method: </div>
      <pre  class="LyX-Code">val myBook = Model.getReference(classOf[Book], someId)
</pre>
      <div  class="Unindented"> This is very similar to the
        <tt>find</tt> method with a few key differences. First, the
        object that is returned is a lazy proxy for the entity. That means that
        no database load is required to occur when you execute the method,
        although providers may do at least a check on the existence of the ID.
        Because this is a lazy proxy, you usually don’t want to use the returned
        object in a detached state unless you’ve accessed its fields while the
        session was open. The normal use of <tt>getReference</tt> is
        when you want to set up a relationship between two (or more) entities,
        since you don’t need to query all of the fields just to set a foreign
        key. For example: </div>
      <pre  class="LyX-Code">myBook.author = Model.getReference(classOf[Author], authorId)
</pre>
      <div  class="Unindented"> When <tt>myBook</tt> is flushed to
        the database the EM will correctly set up the relationship. The final
        difference is in how unknown entities are handled. Recall that the
        <tt>find</tt> method returns <tt>Empty</tt> if
        the entity cannot be found; with <tt>getReference</tt>,
        however, we don’t query the database until the reference is used.
        Because of this, the
        <tt>javax.persistence.EntityNotFoundException</tt> is thrown
        when you try to access an undefined entity for the first time (this also
        marks the transaction for rollback). </div>
      <div  class="Indented"> The third method for loading an entity would be to
        use a query (named or otherwise) to fetch the entity. As an example,
        here’s a query equivalent of the <tt>find</tt> method: </div>
      <pre  class="LyX-Code">val myBook = 
  Model.createQuery[Book]("from Book bk where bk.id = :id")
       .setParams("id" -> someId).findOne
</pre>
      <div  class="Unindented"> The advantage here is that we have more control
        over what is selected by using the query language to specify other
        properties. One caveat is that when you use the
        <tt>findOne</tt> method you need to ensure that the query
        will actually result in a unique entity; otherwise, the EM will throw a
        <tt>NonUniqueResultException</tt>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.5.3"  class="toc">12.5.3</a> 
        Loading Many Entities </h3>
      <div  class="Unindented"> Corresponding to the
        <tt>findOne</tt> method is the <tt>findAll</tt>
        method, which returns all entities based on a query. There are two ways
        to use <tt>findAll</tt>; the first is to use the convenience
        <tt>findAll</tt> method defined in the
        <tt>ScalaEntityManager</tt> class: </div>
      <pre  class="LyX-Code">val myBooks = Model.findAll("booksByYear", "year" -> myYear)
</pre>
      <div  class="Unindented"> This requires the use of a named query for the
        first arg, and subsequent args are of the form (“paramName” ->
        value). Named queries<a  href="#index-named-queries"  name="entry-named-queries-1"
 class="IndexReference">↓</a> can be
        defined in your orm.xml<a  href="#index-orm.xml"  name="entry-orm.xml-1"
 class="IndexReference">↓</a>, as shown in
        section <a  href="#sub:Using-the-orm.xml"  class="Reference">12.1.2 on page 1↑</a>. Named queries are highly
        recommended over ad-hoc queries since they allow you to keep the queries
        in one location instead of being scattered all over your code. Named
        queries can also be pre-compiled by the JPA provider, which will catch
        errors at startup (or in your unit tests, hint hint) instead of when the
        query is run inside your code. </div>
      <div  class="Indented"> The second method is to create a
        <tt>ScalaQuery</tt> instance directly and then set
        parameters and execute it. In reality this is exactly what the
        <tt>Model.findAll</tt> method is doing. The advantage here
        is that with the <tt>ScalaQuery</tt> instance you can do
        things like set hinting, paging, and so on. For instance, if you wanted
        to do paging on the books query, you could do </div>
      <pre  class="LyX-Code">val myBooks = Model.createNamedQuery(“booksByYear”)
                   .setParams(“year” -> myYear)
                   .setMaxResults(20)
                   .setFirstResult(pageOffset).findAll
</pre>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.5.4"  class="toc">12.5.4</a> 
        Using Queries Wisely </h3>
      <div  class="Unindented"> In general we recommend that you use named
        queries throughout your code. In our experience, the extra effort
        involved in adding a named query is more than offset by the time it
        saves you if you ever need to modify the query. Additionally, we
        recommend that you use named parameters in your queries. Named
        parameters are just that: parameters that are inserted into your query
        by name, in contrast to positional parameters. As an example, here is
        the same query using named and positional parameters: </div>
      <div  class="List"> <span  class="List-entry">Named parameters</span><span
 class="List-contents"><tt>select user from User where
          (user.name like :searchString or user.email like :searchString) and
          user.widgets > :widgetCount</tt></span> </div>
      <div  class="List"> <span  class="List-entry">Positional parameters</span><span
 class="List-contents"><tt>select user from User where
          (user.name like ? or user.email like ?) and user.widgets >
          ?</tt></span> </div>
      <div  class="Unindented"> This example shows several advantages of named
        parameters over positional parameters: </div>
      <ol>
        <li> You can reuse the same parameter within the same query and you only
          set it once. In the example about we would set the same parameter
          twice using positional params </li>
        <li> The parameters can have meaningful names. </li>
        <li> With positional params you may have to edit your code if you need
          to alter your query to add or remove parameters </li>
      </ol>
      <div  class="Unindented"> In any case, you should generally use the
        parameterized query types as opposed to hand constructing your queries;
        using things like string concatenation opens up your site to SQL
        injection attacks unless you’re very careful. For more information on
        queries there’s an excellent reference for the EJBQL on the Hibernate
        website at <a  href="http://www.hibernate.org/hib_docs/entitymanager/reference/en/html/queryhql.html"
 class="FlexURL">http://www.hibernate.org/hib_docs/entitymanager/reference/en/html/queryhql.html</a>.
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.5.5"  class="toc">12.5.5</a> 
        Converting Collection Properties </h3>
      <div  class="Unindented"> The <tt>ScalaEntityManager</tt> and
        <tt>ScalaQuery</tt> methods are already defined so that they
        return Scala-friendly collections such as
        <tt>scala.collection.jcl.BufferWrapper</tt> or
        <tt>SetWrapper</tt>. We have to use Java Collections<span  class="FootOuter"><span
 class="SupFootMarker"> [T] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [T] </span><a  href="http://java.sun.com/docs/books/tutorial/collections/index.html"
 class="FlexURL">http://java.sun.com/docs/books/tutorial/collections/index.html</a></span></span>
        “under the hood” and then wrap them because JPA doesn’t understand Scala
        collections. For the same reason, collections in your entity classes
        must also use the Java Collections classes. Fortunately, Scala has a
        very nice framework for wrapping Java collections. In particular, the
        <tt>scala.collection.jcl.Conversions</tt> class contains a
        number of implicit conversions<a  href="#index-implicit-conversions"  name="entry-implicit-conversions-0"
 class="IndexReference">↓</a>;
        all you have to do is import them at the top of your source file like
        so: </div>
      <pre  class="LyX-Code">import scala.collection.jcl.Conversions._
</pre>
      <div  class="Unindented"> Once you’ve done that the methods are
        automatically in scope and you can use collections in your entities as
        if they were real Scala collections. For example, we may want to see if
        our Author has written any mysteries: </div>
      <pre  class="LyX-Code">val suspenseful = author.books.exists(_.genre = Genre.Mystery)
</pre>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.5.6"  class="toc">12.5.6</a> <a
 name="sub:The-importance-of-flush"  class="Label"> </a>The
        importance of flush() and Exceptions </h3>
      <div  class="Unindented"> It’s important to understand that in JPA the
        provider isn’t required to write to the database until the session
        closes or is flushed. That means that constraint violations aren’t
        necessarily checked at the time that you persist, merge or remove and
        object. Using the flush method forces the provider to write any pending
        changes to the database and immediately throw any exceptions resulting
        from any violations. As a convenience, we’ve written the
        <tt>mergeAndFlush</tt>,
        <tt>persistAndFlush</tt>, and
        <tt>removeAndFlush</tt> methods to do persist, merge and
        remove with a subsequent flush, as shown in listing <a  href="#lst:Auto-flush-methods"
 class="Reference">12.5.6↓</a>, taken from the Author snippet code.
        You can also see that because we flush at this point, we can catch any
        JPA-related exceptions and deal with them here. If we don’t flush at
        this point, the exception would be thrown when the transaction commits,
        which is often very far (in code) from where you would want to handle
        it. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Auto-flush methods<a  name="lst:Auto-flush-methods"
 class="Label"> </a> </div>
          def doAdd () = {
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_464740">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">if</code> <code  class="scala plain">(author.name.length </code><code
 class="scala keyword">==</code> <code  class="scala value">0</code><code  class="scala plain">) {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">error(</code><code  class="scala string">"emptyAuthor"</code><code
 class="scala plain">, </code><code  class="scala string">"The author’s name cannot be blank"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">try</code> <code  class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Model.mergeAndFlush(author)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">     </code><code
 class="scala plain">redirectTo(</code><code  class="scala string">"list.html"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">catch</code> <code  class="scala plain">{</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">ee </code><code  class="scala keyword">:</code> <code
 class="scala plain">EntityExistsException </code><code  class="scala keyword">=</code><code
 class="scala plain">> error(</code><code  class="scala string">"Author already exists"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">pe </code><code  class="scala keyword">:</code> <code
 class="scala plain">PersistenceException </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">error(</code><code  class="scala string">"Error adding author"</code><code
 class="scala plain">); Log.error(</code><code  class="scala string">"Error adding author"</code><code
 class="scala plain">, pe)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Although the combo methods simplify things, we
        recommend that if you will be doing multiple operations in one session
        cycle that you use a single flush at the end: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Multiple JPA ops<a  name="lst:Multiple-JPA-ops"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_425017">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">container </code><code  class="scala keyword">=</code> <code
 class="scala plain">Model.find(classOf[Container], containerId)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">Model.remove(container.widget)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">container.widget </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">Widget(</code><code
 class="scala string">"Foo!"</code><code  class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala comments">// next line only required if container.widget doesn’t cascade PERSIST</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">Model.persist(container.widget)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">Model.flush()</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-12.5.7"  class="toc">12.5.7</a> 
        Validating Entities </h3>
      <div  class="Unindented"> Since we’ve already covered the Mapper framework
        and all of the extra functionality that it provides beyond being a
        simple ORM, we felt that we should discuss one of the more important
        aspects of data handling as it pertains to JPA: validation of data. </div>
      <div  class="Indented"> JPA itself doesn’t come with a built-in validation
        framework, although the upcoming JPA 2.0 may use the JSR 303 (Bean
        Validation) framework as its default. Currently, Hibernate Validator is
        one of the more popular libraries for validating JPA entities, and can
        be used with any JPA provider. More information is available at the
        project home page: <a  href="http://www.hibernate.org/412.html"  class="URL">http://www.hibernate.org/412.html</a>.
      </div>
      <div  class="Indented"> The validation of entities with Hibernate
        Validator is achieved, like the JPA mappings, with annotations. Listing
        <a  href="#lst:The-Author-class-validations"  class="Reference">12.5.7↓</a> shows a modified Author class with
        validations for the name. In this case we have added a NotNull
        validation as well as a Length check to ensure we are within limits. </div>
      <div  class="Indented">
        <div  class="smallskip"> </div>
      </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note: Unfortunately, due
            to the way that the validator framework extracts entity properties,
            we have to rework our entity to use a getter/setter for any
            properties that we want to validate; even the
            <tt>scala.reflect.BeanProperty</tt> annotation won’t
            work. </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="smallskip"> </div>
      </div>
      <div  class="Indented"> Validation can be performed automatically via the
        <tt>org.hibernate.validator.event.JPAValidateListener</tt>
        EntityListener, or programmatically via the
        <tt>org.hibernate.validator.ClassValidator</tt> utility
        class. In the listing we use <tt>ClassValidator</tt> and
        match on the array returned from <tt>getInvalidValues</tt>
        for processing. Further usage and configuration is beyond the scope of
        this book. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The Author class with Hibernate Validations<a  name="lst:The-Author-class-validations"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_932884">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">Author {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">name </code><code  class="scala keyword">:</code> <code
 class="scala plain">String </code><code  class="scala keyword">=</code> <code  class="scala string">""</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">@</code><code  class="scala plain">Column{</code><code  class="scala keyword">val</code> <code
 class="scala plain">unique </code><code  class="scala keyword">=</code> <code  class="scala keyword">true</code><code
 class="scala plain">, </code><code  class="scala keyword">val</code> <code  class="scala plain">nullable </code><code
 class="scala keyword">=</code> <code  class="scala keyword">false</code><code  class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">@</code><code  class="scala plain">NotNull</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">@</code><code  class="scala plain">Length{</code><code  class="scala keyword">val</code> <code
 class="scala plain">min </code><code  class="scala keyword">=</code> <code  class="scala value">3</code><code
 class="scala plain">, </code><code  class="scala keyword">val</code> <code  class="scala plain">max </code><code
 class="scala keyword">=</code> <code  class="scala value">100</code><code  class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">getName() </code><code
 class="scala keyword">=</code> <code  class="scala plain">name</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">setName(nm </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) { name </code><code
 class="scala keyword">=</code> <code  class="scala plain">nm }</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">} </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala comments">// In the snippet class</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">AuthorOps {</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">authorValidator </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">ClassValidator(classOf[Author])</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">add (xhtml </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">doAdd () </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">authorValidator.getInvalidValues(author) </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">Array() </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">          </code><code
 class="scala keyword">try</code> <code  class="scala plain">{</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">            </code><code
 class="scala plain">Model.mergeAndFlush(author)</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">...</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">} </code><code  class="scala keyword">catch</code> <code  class="scala plain">{</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">            </code><code
 class="scala plain">...</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">}     </code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">errors </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">errors.foreach(err </code><code  class="scala keyword">=</code><code
 class="scala plain">> S.error(err.toString)) </code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">}      </code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-12.6"  class="toc">12.6</a> 
        Supporting User Types </h2>
      <div  class="Unindented"> JPA can handle any Java primitive type, their
        corresponding Object versions (java.lang.Long, java.lang.Integer, etc),
        and any entity classes comprised of these types <span  class="FootOuter"><span
 class="SupFootMarker">  [U] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [U] </span>It can technically handle more; see the JPA spec,
            section 2.1.1 for details</span></span>. Occasionally, though, you
        may have a requirement for a type that doesn’t fit directly with those
        specifications. One example in particular would be Scala’s enumerations<a
 href="#index-enumerations"  name="entry-enumerations-0"  class="IndexReference">↓</a>.
        Unfortunately, the JPA spec currently doesn’t have a means to handle
        this directly, although the various JPA providers such as Toplink and
        Hibernate provide mechanisms for resolving custom user types. JPA does
        provide direct support for <i>Java</i> enumerations, but that doesn’t
        help us here since Scala enumerations aren’t an extension of Java
        enumerations. In this example, we’ll be using Hibernate’s
        <tt>UserType</tt> to support an enumeration for the
        <tt>Genre</tt> of a <tt>Book</tt>. </div>
      <div  class="Indented"> We begin by implementing a few helper classes
        besides the Genre enumeration itself. First, we define an
        <tt>Enumv</tt> trait, shown in listing <a  href="#lst:Enumv-Trait"  class="Reference">G.1.3 on page 1↓</a>. Its main purpose is to
        provide a <tt>valueOf</tt> method that we can use to resolve
        the enumerations database value to the actual enumeration. We also add
        some extra methods so that we can encapsulate a description along with
        the database value. Scala enumerations can use either
        <tt>Ints</tt> or <tt>Strings</tt> for the
        identity of the enumeration value (unique to each val), and in this case
        we’ve chosen <tt>Strings</tt>. By adding a map for the
        description (since Scala enumeration values must extend the
        <tt>Enumeration#Value</tt> class and therefore can’t carry
        the additional string) we allow for the additional info. We could extend
        this concept to make the <tt>Map</tt> carry additional data,
        but for our purposes this is sufficient. </div>
      <div  class="Indented"> In order to actually convert the
        <tt>Enumeration</tt> class into the proper database type
        (<tt>String</tt>, <tt>Int</tt>, etc), we need to
        implement the Hibernate <tt>UserType</tt> interface, shown
        in listing <a  href="#lst:EnumvType"  class="Reference">G.1.4 on page 1↓</a>. We can see on line 18 that we
        will be using a <tt>varchar</tt> column for the enumeration
        value. Since this is based on the Scala
        <tt>Enumeration</tt>’s <tt>Value</tt> method, we
        could technically use either <tt>Integer</tt> or character
        types here. We override the <tt>sqlTypes</tt> and
        <tt>returnedClass</tt> methods to match our preferred type,
        and set the <tt>equals</tt> and
        <tt>hashCode</tt> methods accordingly. Note that in Scala,
        the “==” operator on objects delegates to the
        <tt>equals</tt> method, so we’re not testing reference
        equality here. The actual resolution of database column value to
        <tt>Enumeration</tt> is done in the
        <tt>nullSafeGet</tt> method; if we decided, for instance,
        that the null value should be returned as unknown, we could do this here
        with some minor modifications to the <tt>Enumv</tt> class
        (defining the unknown value, for one).The rest of the methods are set
        appropriately for an immutable object
        (<tt>Enumeration</tt>). The great thing about the
        <tt>EnumvType</tt> class, is that it can easily be used for
        a variety of types due to the “et” constructor argument; as long as we
        mix in the <tt>Enumv</tt> trait to our
        <tt>Enumeration</tt> objects, we get persistence essentially
        for free. If we determined instead that we want to use
        <tt>Integer</tt> enumeration IDs, we need to make minor
        modifications to the <tt>EnumvType</tt> to make sure
        arguments match and we’re set. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Genre-and-GenreType"  class="Label">
            </a>Genre and GenreType </div>
          package com.foo.jpaweb.model
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_881783">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">object</code> <code
 class="scala plain">Genre </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Enumeration </code><code  class="scala keyword">with</code> <code
 class="scala plain">Enumv {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">Mystery </code><code
 class="scala keyword">=</code> <code  class="scala plain">Value(</code><code  class="scala string">"Mystery"</code><code
 class="scala plain">, </code><code  class="scala string">"Mystery"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">Science </code><code
 class="scala keyword">=</code> <code  class="scala plain">Value(</code><code  class="scala string">"Science"</code><code
 class="scala plain">, </code><code  class="scala string">"Science"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">Theater </code><code
 class="scala keyword">=</code> <code  class="scala plain">Value(</code><code  class="scala string">"Theater"</code><code
 class="scala plain">, </code><code  class="scala string">"Drama literature"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// more values here...</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">GenreType </code><code  class="scala keyword">extends</code> <code
 class="scala plain">EnumvType(Genre) {}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Finally, the <tt>Genre</tt> object and
        the associated <tt>GenreType</tt> is shown in listing <a  href="#lst:Genre-and-GenreType"
 class="Reference">12.6↑</a>. You can see that we create a singleton
        <tt>Genre</tt> object with specific member values for each
        enumeration value. The <tt>GenreType</tt> class is trivial
        now that we have the <tt>EnumvType</tt> class defined. To
        use the <tt>Genre</tt> type in our entity classes, we simply
        need to add the proper <tt>var</tt> and annotate it with the
        <tt>@Type</tt> annotation, as shown in listing <a  href="#lst:Using-the-@Type"
 class="Reference">12.6↓</a>. We need to specify the type of the var
        due to the fact that the actual enumeration values are of the type
        <tt>Enumeration.Val</tt>, which doesn’t match our
        <tt>valueOf</tt> method in the <tt>Enumv</tt>
        trait. We also want to make sure we set the enumeration to some
        reasonable default; in our example we have an <i>unknown</i> value to
        cover that case. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Using-the-@Type"  class="Label">
            </a>Using the @Type annotation </div>
          @Type{val ‘type‘ = "com.foo.jpaweb.model.GenreType"}
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_658127">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">genre </code><code  class="scala keyword">:</code> <code  class="scala plain">Genre.Value </code><code
 class="scala keyword">=</code> <code  class="scala plain">Genre.unknown</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-12.7"  class="toc">12.7</a> 
        Running the Application </h2>
      <div  class="Unindented"> Now that we’ve gone over everything, it’s time
        to run the application. Because we’ve split up the app into separate SPA
        and WEB modules, we need to first run </div>
      <pre  class="LyX-Code">mvn install
</pre>
      <div  class="Unindented"> From the SPA module directory to get the
        persistence module added to your maven repository. Once that is done,
        you can go to the WEB module directory and run </div>
      <pre  class="LyX-Code">mvn jetty:run
</pre>
      <div  class="Unindented"> To get it started. </div>
      <h2  class="Section"> <a  name="toc-Section-12.8"  class="toc">12.8</a> 
        Summing Up </h2>
      <div  class="Unindented"> As we’ve shown in this chapter, the Java
        Persistence API provides a robust, flexibile framework for persisting
        data to your database, and does so in a manner that integrates fairly
        well with Lift. We’ve demonstrated how you can easily write entities
        using a combination of annotations and the orm.xml descriptor, how to
        define your own custom user types to handle enumerations, the
        intricacies of working with transactions in various contexts, and
        leveraging the ScalaJPA framework to simplify your persistence setup. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-13"  class="toc">13</a> Third
        Party Integrations </h1>
      <div  class="Unindented"> In this chapter we’ll explore how you can
        integrate Lift with some well-known third party libraries and
        applications </div>
      <h2  class="Section"> <a  name="toc-Section-13.1"  class="toc">13.1</a> 
        OpenID Integration </h2>
      <div  class="Unindented"> The OpenID Foundation<span  class="FootOuter"><span
 class="SupFootMarker">  [V] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [V] </span><a  href="http://openid.net/"  class="FlexURL">http://openid.net/</a></span></span>
        explain OpenID as: </div>
      <div  class="Indented"> “OpenID eliminates the need for multiple usernames
        across different websites, simplifying your online experience. </div>
      <div  class="Indented"> You get to choose the OpenID Provider that best
        meets your needs and most importantly that you trust. At the same time,
        your OpenID can stay with you, no matter which Provider you move to. And
        best of all, the OpenID technology is not proprietary and is completely
        free. For businesses, this means a lower cost of password and account
        management, while drawing new web traffic. OpenID lowers user
        frustration by letting users have control of their login. For geeks,
        OpenID is an open, decentralized, free framework for user-centric
        digital identity. OpenID takes advantage of already existing internet
        technology (URI, HTTP, SSL, Diffie-Hellman) and realizes that people are
        already creating identities for themselves whether it be at their blog,
        photostream, profile page, etc. With OpenID you can easily transform one
        of these existing URIs into an account which can be used at sites which
        support OpenID logins. </div>
      <div  class="Indented"> OpenID is still in the adoption phase and is
        becoming more and more popular, as large organizations like AOL,
        Microsoft, Sun, Novell, etc. begin to accept and provide OpenIDs. Today
        it is estimated that there are over 160-million OpenID enabled URIs with
        nearly ten-thousand sites supporting OpenID logins.” </div>
      <div  class="Indented"> Lift provides openId support using onepID4Java<span
 class="FootOuter"><span  class="SupFootMarker"> [W] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [W] </span>http://code.google.com/p/openid4java/</span></span>.
        It provides two fundamental traits
        <tt>net.liftweb.openId.OpenIdVendor</tt> and
        <tt>net.liftweb.openId.OpenIdConsumer. OpenIdVendor</tt>
        contains variables such as: </div>
      <ul>
        <li> PathRoot - The path sequence for processing OpenID requests. The
          default value is “openid” </li>
        <li> LoginPath - The path sequence for processing login requests. The
          default value is “login”. The login path will be /openid/login </li>
        <li> LogoutPath - The path sequence for processing logout requests. The
          default value is “logout”. The login path will be /openid/logour </li>
        <li> ResponsePath - The path sequence for processing login requests. The
          default value is “response”. The login path will be /openid/response </li>
        <li> PostParamName - The form parameter name containing the OpeID
          identity URL entered by the user </li>
      </ul>
      <div  class="Unindented"> Also the vendor trait contains the loginForm
        function that returns the login form containing an input text field for
        the OpenID identity and the submit button. The form will point to
        /<PathRoot>/<LoginPath> where PathRoot and LoginPath are the
        variables described above. Here is an example: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> OpenID example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_269361">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Your template</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain"><lift</code><code
 class="scala keyword">:</code><code  class="scala plain">OpenID.form></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><openId</code><code  class="scala keyword">:</code><code  class="scala plain">renderForm/></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain"></lift</code><code
 class="scala keyword">:</code><code  class="scala plain">OpenID.form></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala comments">// Your snippet</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">OpenID {</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">renderForm(xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">SimpleOpenIdVendor.loginForm</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// This is needed in order to process the login and logout requests and also to process</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// the response comming from OpenID provider</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">LiftRules.dispatch.append(SimpleOpenIdVendor.dispatchPF)</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> That is pretty much all you need to add into your
        Lift application. The authentication flow is: </div>
      <ol>
        <li> User accesses your lift page that contains the OpenID form </li>
        <li> User enters his/her OpenID identity URL and submits the form. Note
          that you don’t have to use the default login form asyou can construct
          your own as long as the form is submitted to the correct path and
          contains the correct input text parameter name. </li>
        <li> The dispatchPF function that we appended above will process the
          /openid/login request and will send the authentication request to the
          Identity Provider site </li>
        <li> Identity Provider will validate the user and redirect back to your
          Lift application to /openid/response path. </li>
        <li> The response is validated using OpenId4Java library </li>
        <li> <tt>OpenIdConsumer.postLogin</tt> gets called. </li>
      </ol>
      <div  class="Unindented"> The SimpleOpenIDVendor looks like: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> SimpleOpenIDVendor </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_528107">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">trait</code> <code
 class="scala plain">SimpleOpenIdVendor </code><code  class="scala keyword">extends</code> <code
 class="scala plain">OpenIdVendor {   </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">type</code> <code  class="scala plain">UserType </code><code
 class="scala keyword">=</code> <code  class="scala plain">Identifier   </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">type</code> <code  class="scala plain">ConsumerType </code><code
 class="scala keyword">=</code> <code  class="scala plain">OpenIdConsumer[UserType]</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code> </div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">currentUser </code><code
 class="scala keyword">=</code> <code  class="scala plain">OpenIdUser.is</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">postLogin(id</code><code
 class="scala keyword">:</code> <code  class="scala plain">Box[Identifier],res</code><code
 class="scala keyword">:</code> <code  class="scala plain">VerificationResult)</code><code
 class="scala keyword">:</code> <code  class="scala plain">Unit </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">id </code><code  class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(id) </code><code
 class="scala keyword">=</code><code  class="scala plain">> S.notice(</code><code
 class="scala string">"Welcome "</code><code  class="scala plain">+id)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> S.error(</code><code  class="scala string">"Failed to authenticate"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">OpenIdUser(id)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">logUserOut() {</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">OpenIdUser.remove   </code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">displayUser(in</code><code
 class="scala keyword">:</code> <code  class="scala plain">UserType)</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">Text(</code><code  class="scala string">"Welcome "</code><code
 class="scala plain">+in)</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">createAConsumer </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">AnyRef </code><code
 class="scala keyword">with</code> <code  class="scala plain">OpenIDConsumer[UserType]</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">SimpleOpenIdVendor </code><code  class="scala keyword">extends</code> <code
 class="scala plain">SimpleOpenIdVendor </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note the postLogin implementation. Of course if
        you need a more complex post-login processing you can extend
        OpenIdVendor by yourself. </div>
      <div  class="Indented"> During this message exchange between the Identity
        Provider ans your Lift application, Lift utilizes a couple of
        SessionVars: </div>
      <ul>
        <li> OpenIdObject - holds an OpenIdConsumer </li>
        <li> OpenIdUser - holding an org.openid4java.discovery.Identifier </li>
      </ul>
      <h2  class="Section"> <a  name="toc-Section-13.2"  class="toc">13.2</a> 
        AMQP </h2>
      <div  class="Unindented"> AMQP stands for <b>A</b>dvanced <b>M</b>essage
        <b>Q</b>ueuing <b>P</b>rotocol<span  class="FootOuter"><span  class="SupFootMarker"> 
            [X] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [X] </span>http://jira.amqp.org/confluence/display/AMQP/Advanced+Message+Queuing+Protocol</span></span>.
        It is an open Internet protocol for messaging. It is concepted as a
        binary representation of messages. Lift facilitates the work with AMQP
        using the RabbitMQ<span  class="FootOuter"><span  class="SupFootMarker"> 
            [Y] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Y] </span>http://www.rabbitmq.com/</span></span> Java
        implementation. There are two fundamental classes: </div>
      <ul>
        <li> <tt>net.liftweb.amqp.AMQPSender</tt> - used for sending
          AMQP messages </li>
        <li> <tt>net.liftweb.amqp.AMQPDispatcher</tt> - used for
          receiving AMQP messages </li>
      </ul>
      <div  class="Unindented"> Let’s see how we can use Lift to send AMQP
        messages </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> AMQP sending messages example<a  name="lst:AMQP-sending-messages"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_837709">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">import</code> <code  class="scala plain">net.liftweb.amqp.</code><code
 class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">import</code> <code  class="scala plain">com.rabbitmq.client.</code><code
 class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">params </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">ConnectionParameters</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// All of the params, exchanges, and queues are all just example data.</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">params.setUsername(</code><code  class="scala string">"guest"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">params.setPassword(</code><code  class="scala string">"guest"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">params.setVirtualHost(</code><code  class="scala string">"/"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">params.setRequestedHeartbeat(</code><code  class="scala value">0</code><code
 class="scala plain">)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">factory </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">ConnectionFactory(params)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">amqp </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">StringAMQPSender(factory, </code><code
 class="scala string">"localhost"</code><code  class="scala plain">, </code><code
 class="scala value">5672</code><code  class="scala plain">, </code><code  class="scala string">"mult"</code><code
 class="scala plain">, </code><code  class="scala string">"routeroute"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">amqp.start</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">amqp ! AMQPMessage(</code><code  class="scala string">"hi"</code><code
 class="scala plain">) </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see the <tt>AMQSender</tt>
        is leveraging Scala actors to send messages. Scala actors and AMQP
        messaging concepts play very well together. </div>
      <div  class="Indented"> Now let’s see how we can receive and process AMQP
        messages: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> AMQP receiving messages example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_11867">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.amqp.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">com.rabbitmq.client.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala comments">/**</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* Example Dispatcher that listens on an example queue and exchange. Use this</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* as your guiding example for creating your own Dispatcher.</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">*</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">ExampleSerializedAMQPDispatcher[T](factory</code><code  class="scala keyword">:</code> <code
 class="scala plain">ConnectionFactory, host</code><code  class="scala keyword">:</code> <code
 class="scala plain">String, port</code><code  class="scala keyword">:</code> <code
 class="scala plain">Int)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">extends</code> <code  class="scala plain">AMQPDispatcher[T](factory, host, port) {</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">configure(channel</code><code  class="scala keyword">:</code> <code
 class="scala plain">Channel) {</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// Get the ticket.</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">ticket </code><code
 class="scala keyword">=</code> <code  class="scala plain">channel.accessRequest(</code><code
 class="scala string">"/data"</code><code  class="scala plain">)</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// Set up the exchange and queue</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">channel.exchangeDeclare(ticket, </code><code  class="scala string">"mult"</code><code
 class="scala plain">, </code><code  class="scala string">"direct"</code><code  class="scala plain">)</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">channel.queueDeclare(ticket, </code><code  class="scala string">"mult_queue"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">channel.queueBind(ticket, </code><code  class="scala string">"mult_queue"</code><code
 class="scala plain">, </code><code  class="scala string">"mult"</code><code  class="scala plain">, </code><code
 class="scala string">"routeroute"</code><code  class="scala plain">)</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// Use the short version of the basicConsume method for convenience.</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">channel.basicConsume(ticket, </code><code  class="scala string">"mult_queue"</code><code
 class="scala plain">, </code><code  class="scala keyword">false</code><code  class="scala plain">, </code><code
 class="scala keyword">new</code> <code  class="scala plain">SerializedConsumer(channel, </code><code
 class="scala keyword">this</code><code  class="scala plain">))</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala comments">/**</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* Example class that accepts Strings coming in from the</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* ExampleSerializedAMQPDispatcher.</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">ExampleStringAMQPListener {</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">params </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">ConnectionParameters</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">params.setUsername(</code><code  class="scala string">"guest"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">params.setPassword(</code><code  class="scala string">"guest"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">params.setVirtualHost(</code><code  class="scala string">"/"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">params.setRequestedHeartbeat(</code><code  class="scala value">0</code><code
 class="scala plain">)</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">factory </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">ConnectionFactory(params)</code></div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// thor.local is a machine on your network with rabbitmq listening on port 5672</code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">amqp </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">ExampleSerializedAMQPDispatcher[String](factory, </code><code
 class="scala string">"thor.local"</code><code  class="scala plain">, </code><code
 class="scala value">5672</code><code  class="scala plain">)</code></div>
                        <div  class="line number38 index37 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">amqp.start</code></div>
                        <div  class="line number39 index38 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number40 index39 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Example Listener that just prints the String it receives.</code></div>
                        <div  class="line number41 index40 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">class</code> <code  class="scala plain">StringListener </code><code
 class="scala keyword">extends</code> <code  class="scala plain">Actor {</code></div>
                        <div  class="line number42 index41 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">act </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number43 index42 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">react {</code></div>
                        <div  class="line number44 index43 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain">msg</code><code  class="scala keyword">@</code><code
 class="scala plain">AMQPMessage(contents</code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">=</code><code  class="scala plain">> println(</code><code
 class="scala string">"received: "</code> <code  class="scala plain">+ msg); act</code></div>
                        <div  class="line number45 index44 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number46 index45 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number47 index46 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number48 index47 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">stringListener </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">StringListener()</code></div>
                        <div  class="line number49 index48 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">stringListener.start</code></div>
                        <div  class="line number50 index49 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">amqp ! AMQPAddListener(stringListener) </code></div>
                        <div  class="line number51 index50 alt2"><code  class="scala plain">} </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> First of all don’t get scared about this. The
        above classes are already existent so you can just reuse them. However
        the point of showing them here is to understand how to use a AMQP
        consumer, how to configure it to match the client settings from the
        Listing 1.3<a  href="#lst:AMQP-sending-messages"  class="Reference">13.2↑</a>. The key here is to see how the actual
        messages are consumed. Note the StringListener actor is consumming the
        <tt>AMQPMessage</tt> but the actor itself it provided to
        <tt>AMQPDispatcher</tt>. What happens is that when a real
        AMQP message is received by <tt>AMQPDispatcher</tt> it will
        just forward it to the user’sActor for actuall processing.
        SerializedConsumer class is actually doing the transformation of the raw
        data (array of byte-s) into <tt>AMQPMessage</tt> messages. </div>
      <h2  class="Section"> <a  name="toc-Section-13.3"  class="toc">13.3</a> 
        PayPal </h2>
      <div  class="Unindented"> Paypal<span  class="FootOuter"><span  class="SupFootMarker"> 
            [Z] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Z] </span>https://www.paypal.com</span></span> is the notorious
        service that allows you to do online payment transactions. Lift supports
        both </div>
      <div  class="Indented"> PDT(Payment Data Transferr)<span  class="FootOuter"><span
 class="SupFootMarker">  [A] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [A] </span>https://www.paypal.com/en_US/i/IntegrationCenter/scr/scr_ppPDTDiagram_513x282.gif</span></span>as
        well as </div>
      <div  class="Indented"> IPN(Instant Payment Notification)<span  class="FootOuter"><span
 class="SupFootMarker">  [B] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [B] </span>https://www.paypal.com/en_US/i/IntegrationCenter/scr/scr_ppIPNDiagram_555x310.gif</span></span>
        API’ sprovided by PayPal. We won’t be getting into PayPal API details as
        this information can be found on PayPal site. However let’s see how we’d
        use PDT and IPN. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> PDT Example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_995576">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.paypal.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">MyPayPalPDT </code><code  class="scala keyword">extends</code> <code
 class="scala plain">PayPalPDT {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">pdtPath </code><code  class="scala keyword">=</code> <code
 class="scala string">"paypal_complete"</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">paypalAuthToken </code><code
 class="scala keyword">=</code> <code  class="scala plain">Props.get(</code><code
 class="scala string">"paypal.authToken"</code><code  class="scala plain">) openOr </code><code
 class="scala string">"cannot find auth token from props file"</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">pdtResponse</code><code
 class="scala keyword">:</code> <code  class="scala plain">PartialFunction[(PayPalInfo, Req), LiftResponse] </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">(info, req) </code><code
 class="scala keyword">=</code><code  class="scala plain">> println(</code><code
 class="scala string">"— in pdtResponse"</code><code  class="scala plain">); DoRedirectResponse(</code><code
 class="scala string">"/account_admin/index"</code><code  class="scala plain">);</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala comments">// in Boot</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">boot(){</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">LiftRules.statelessDispatchTable.append(MyPayPalPDT)</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> That is pretty much it.
        <tt>pdtResponse</tt> function allows you to determine the
        behavior of you application upon receiving the reponse from PayPal. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> IPN Example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_219628">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.paypal.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">MyPayPalIPN </code><code  class="scala keyword">extends</code> <code
 class="scala plain">PayPalIPN {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">actions </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">(ClearedPayment, info, req) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code><code  class="scala comments">// do your processing here</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">(RefundedPayment, info, req) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code><code  class="scala comments">// do refund processing </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala comments">// in Boot</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">boot(){</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">LiftRules.statelessDispatchTable.append(MyPayPalIPN)</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see everything is pretty
        strightforward. Just pattern match on the
        <tt>PaypalTransactionStatus</tt>. It is worth to note sthat
        IPN is a ’machine-to-machine’ API which happens in the background
        without the end user interraction. </div>
      <h2  class="Section"> <a  name="toc-Section-13.4"  class="toc">13.4</a> 
        Facebook </h2>
      <div  class="Unindented"> Facebook<span  class="FootOuter"><span  class="SupFootMarker"> 
            [C] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [C] </span>http://www.facebook.com</span></span> is the well known
        site that simply allows people to easily interract, build social graphs
        share photos etc. Facebook also exposes HTTP API’s<span  class="FootOuter"><span
 class="SupFootMarker"> [D] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [D] </span>http://wiki.developers.facebook.com/index.php/API</span></span>
        that allows other applications to interract with it. Lift framework
        allows your application to easily interract with Facebook by providing
        an abstraction layer over the Facebook API. Here is an example: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Facebook example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_18015">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.ext</code><code  class="scala keyword">_</code><code
 class="scala plain">api.facebook.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">FacebookRestApi.apiKey </code><code
 class="scala keyword">=</code> <code  class="scala plain"><your API key>;</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">FacebookRestApi.secret </code><code
 class="scala keyword">=</code> <code  class="scala plain"><your secret>;</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala comments">// The api key is ontained from System.getProperty("com.facebook.api_key")</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala comments">// The secreat is obtained from System.setProperty("com.facebook.secret", key) </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala comments">// Invoke stateless calls</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">respNode</code><code  class="scala keyword">:</code> <code
 class="scala plain">Node </code><code  class="scala keyword">=</code> <code  class="scala plain">FacebookClient !? AuthCreateToken</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">authToken </code><code  class="scala keyword">=</code> <code
 class="scala comments">// extract authToken from respNode</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala comments">// Obtain a stateful client based on the authToken</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">faceBookClient </code><code  class="scala keyword">=</code> <code
 class="scala plain">FacebookClient fromAuthToken(authToken)</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">faceBookClient !? GetFriendLists</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Once you have the FacebookClient you can invoke
        numerous API methods described by <tt>FacebookMethod</tt> or
        <tt>SessionlessFacebookMethod</tt>. In the above examplewe
        are creating the FaceBook context by first obtaining an authToken and
        then obtaining a <tt>faceBookClient</tt> reference bound to
        the newly created session. After that we’re just ontaining the friends
        list. </div>
      <h2  class="Section"> <a  name="toc-Section-13.5"  class="toc">13.5</a> 
        XMPP </h2>
      <div  class="Unindented"> XMPP<span  class="FootOuter"><span  class="SupFootMarker"> 
            [E] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [E] </span>http://xmpp.org/</span></span> stands for e<b>X</b>tensible
        <b>M</b>essaging and <b>P</b>resence <b>P</b>rotocol. It is an
        XML-based protocol used for presence and realtime communication such as
        instant messaging (Jabber and GoogleTalk being two of the more famous
        users). It is developed by the Jabber<span  class="FootOuter"><span  class="SupFootMarker"> 
            [F] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [F] </span>http://xmpp.org/about/jabber.shtml</span></span>
        open-source community. Lift provides an XMPP dispatcher implementation
        that your application can use to receive instant messages, manage
        rosters etc. This support relies on the Smack <span  class="FootOuter"><span
 class="SupFootMarker"> [G] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [G] </span>http://www.igniterealtime.org/downloads/index.jsp</span></span>
        XMPP client library and utilizes Scala actors for the interface. Here is
        an example: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> XMPP Example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_697278">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                      <div  class="line number52 index51 alt1">52</div>
                      <div  class="line number53 index52 alt2">53</div>
                      <div  class="line number54 index53 alt1">54</div>
                      <div  class="line number55 index54 alt2">55</div>
                      <div  class="line number56 index55 alt1">56</div>
                      <div  class="line number57 index56 alt2">57</div>
                      <div  class="line number58 index57 alt1">58</div>
                      <div  class="line number59 index58 alt2">59</div>
                      <div  class="line number60 index59 alt1">60</div>
                      <div  class="line number61 index60 alt2">61</div>
                      <div  class="line number62 index61 alt1">62</div>
                      <div  class="line number63 index62 alt2">63</div>
                      <div  class="line number64 index63 alt1">64</div>
                      <div  class="line number65 index64 alt2">65</div>
                      <div  class="line number66 index65 alt1">66</div>
                      <div  class="line number67 index66 alt2">67</div>
                      <div  class="line number68 index67 alt1">68</div>
                      <div  class="line number69 index68 alt2">69</div>
                      <div  class="line number70 index69 alt1">70</div>
                      <div  class="line number71 index70 alt2">71</div>
                      <div  class="line number72 index71 alt1">72</div>
                      <div  class="line number73 index72 alt2">73</div>
                      <div  class="line number74 index73 alt1">74</div>
                      <div  class="line number75 index74 alt2">75</div>
                      <div  class="line number76 index75 alt1">76</div>
                      <div  class="line number77 index76 alt2">77</div>
                      <div  class="line number78 index77 alt1">78</div>
                      <div  class="line number79 index78 alt2">79</div>
                      <div  class="line number80 index79 alt1">80</div>
                      <div  class="line number81 index80 alt2">81</div>
                      <div  class="line number82 index81 alt1">82</div>
                      <div  class="line number83 index82 alt2">83</div>
                      <div  class="line number84 index83 alt1">84</div>
                      <div  class="line number85 index84 alt2">85</div>
                      <div  class="line number86 index85 alt1">86</div>
                      <div  class="line number87 index86 alt2">87</div>
                      <div  class="line number88 index87 alt1">88</div>
                      <div  class="line number89 index88 alt2">89</div>
                      <div  class="line number90 index89 alt1">90</div>
                      <div  class="line number91 index90 alt2">91</div>
                      <div  class="line number92 index91 alt1">92</div>
                      <div  class="line number93 index92 alt2">93</div>
                      <div  class="line number94 index93 alt1">94</div>
                      <div  class="line number95 index94 alt2">95</div>
                      <div  class="line number96 index95 alt1">96</div>
                      <div  class="line number97 index96 alt2">97</div>
                      <div  class="line number98 index97 alt1">98</div>
                      <div  class="line number99 index98 alt2">99</div>
                      <div  class="line number100 index99 alt1">100</div>
                      <div  class="line number101 index100 alt2">101</div>
                      <div  class="line number102 index101 alt1">102</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.xmpp.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala comments">/**</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* An example Chat application that prints to stdout.</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">*</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* @param username is the username to login to at Google Talk: format: something@gmail.com</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* @param password is the password for the user account at Google Talk.</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">ConsoleChatActor(</code><code  class="scala keyword">val</code> <code
 class="scala plain">username</code><code  class="scala keyword">:</code> <code
 class="scala plain">String, </code><code  class="scala keyword">val</code> <code
 class="scala plain">password</code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">extends</code> <code
 class="scala plain">Actor {</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">connf() </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">ConnectionConfiguration(</code><code
 class="scala string">"talk.google.com"</code><code  class="scala plain">, </code><code
 class="scala value">5222</code><code  class="scala plain">, </code><code  class="scala string">"gmail.com"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">login(conn</code><code
 class="scala keyword">:</code> <code  class="scala plain">XMPPConnection) </code><code
 class="scala keyword">=</code> <code  class="scala plain">conn.login(username, password)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">xmpp </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">XMPPDispatcher(connf, login)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">xmpp.start</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">chats</code><code  class="scala keyword">:</code> <code
 class="scala plain">Map[String, List[Message]] </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">HashMap[String, List[Message]]</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">rosterMap</code><code
 class="scala keyword">:</code> <code  class="scala plain">HashMap[String, Presence] </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">HashMap[String, Presence]</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">roster</code><code
 class="scala keyword">:</code> <code  class="scala plain">Roster </code><code  class="scala keyword">=</code> <code
 class="scala keyword">null</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">act </code><code  class="scala keyword">=</code> <code
 class="scala plain">loop</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">loop { </code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">   </code><code
 class="scala plain">react {</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Start </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">xmpp ! AddListener(</code><code  class="scala keyword">this</code><code
 class="scala plain">)</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">xmpp ! SetPresence(</code><code  class="scala keyword">new</code> <code
 class="scala plain">Presence(Presence.Type.available))</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">loop</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">NewChat(c) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">chats +</code><code  class="scala keyword">=</code> <code  class="scala plain">(c.getParticipant -> Nil)</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">loop</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">RecvMsg(chat, msg) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(</code><code  class="scala string">"RecvMsg from: "</code> <code
 class="scala plain">+ msg.getFrom + </code><code  class="scala string">": "</code> <code
 class="scala plain">+ msg.getBody);</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">loop </code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">NewRoster(r) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(</code><code  class="scala string">"getting a new roster: "</code> <code
 class="scala plain">+ r)</code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">this</code><code  class="scala plain">.roster </code><code
 class="scala keyword">=</code> <code  class="scala plain">r</code></div>
                        <div  class="line number38 index37 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">val</code> <code  class="scala plain">e</code><code  class="scala keyword">:</code> <code
 class="scala plain">Array[Object] </code><code  class="scala keyword">=</code> <code
 class="scala plain">r.getEntries.toArray.asInstanceOf[Array[Object]]</code></div>
                        <div  class="line number39 index38 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">for</code> <code  class="scala plain">(entry <- e) {</code></div>
                        <div  class="line number40 index39 alt1"><code  class="scala spaces">          </code><code
 class="scala keyword">val</code> <code  class="scala plain">user</code><code  class="scala keyword">:</code> <code
 class="scala plain">String </code><code  class="scala keyword">=</code> <code  class="scala plain">entry.asInstanceOf[RosterEntry].getUser</code></div>
                        <div  class="line number41 index40 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">rosterMap +</code><code  class="scala keyword">=</code> <code
 class="scala plain">(user -> r.getPresence(user))</code></div>
                        <div  class="line number42 index41 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">}</code></div>
                        <div  class="line number43 index42 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">loop</code></div>
                        <div  class="line number44 index43 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number45 index44 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number46 index45 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">RosterPresenceChanged(p) </code><code
 class="scala keyword">=</code><code  class="scala plain">> { </code></div>
                        <div  class="line number47 index46 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">val</code> <code  class="scala plain">user </code><code  class="scala keyword">=</code> <code
 class="scala plain">StringUtils.parseBareAddress(p.getFrom)</code></div>
                        <div  class="line number48 index47 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(</code><code  class="scala string">"Roster Update: "</code> <code
 class="scala plain">+ user + </code><code  class="scala string">" "</code> <code
 class="scala plain">+ p)</code></div>
                        <div  class="line number49 index48 alt2"><code  class="scala spaces">        </code><code
 class="scala comments">// It’s best practice to ask the roster for the presence. This is because</code></div>
                        <div  class="line number50 index49 alt1"><code  class="scala spaces">        </code><code
 class="scala comments">// multiple presences can exist for one user and the roster knows which one </code></div>
                        <div  class="line number51 index50 alt2"><code  class="scala spaces">        </code><code
 class="scala comments">// has priority. </code></div>
                        <div  class="line number52 index51 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">rosterMap +</code><code  class="scala keyword">=</code> <code
 class="scala plain">(user -> roster.getPresence(user))</code></div>
                        <div  class="line number53 index52 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">loop</code></div>
                        <div  class="line number54 index53 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number55 index54 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">RosterEntriesDeleted(e) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number56 index55 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(e) </code></div>
                        <div  class="line number57 index56 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">loop </code></div>
                        <div  class="line number58 index57 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">} </code></div>
                        <div  class="line number59 index58 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">RosterEntriesUpdated(e) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number60 index59 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(e)</code></div>
                        <div  class="line number61 index60 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">loop</code></div>
                        <div  class="line number62 index61 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number63 index62 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">RosterEntriesAdded(e) </code><code
 class="scala keyword">=</code><code  class="scala plain">> { </code></div>
                        <div  class="line number64 index63 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">println(e)</code></div>
                        <div  class="line number65 index64 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">loop </code></div>
                        <div  class="line number66 index65 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number67 index66 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">a </code><code  class="scala keyword">=</code><code
 class="scala plain">> println(a); loop</code></div>
                        <div  class="line number68 index67 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number69 index68 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number70 index69 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">createChat(to</code><code
 class="scala keyword">:</code> <code  class="scala plain">String) {</code></div>
                        <div  class="line number71 index70 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">xmpp ! CreateChat(to)</code></div>
                        <div  class="line number72 index71 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number73 index72 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">sendMessage(to</code><code
 class="scala keyword">:</code> <code  class="scala plain">String, msg</code><code
 class="scala keyword">:</code> <code  class="scala plain">String) {</code></div>
                        <div  class="line number74 index73 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">xmpp ! SendMsg(to, msg)</code></div>
                        <div  class="line number75 index74 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number76 index75 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number77 index76 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">/**</code></div>
                        <div  class="line number78 index77 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">* @returns an Iterable of all users who aren’t unavailable along with their Presence</code></div>
                        <div  class="line number79 index78 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number80 index79 alt1"><code  class="scala spaces"> </code><code
 class="scala keyword">def</code> <code  class="scala plain">availableUsers</code><code
 class="scala keyword">:</code> <code  class="scala plain">Iterable[(String, Presence)] </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number81 index80 alt2"><code  class="scala spaces">   </code><code
 class="scala plain">rosterMap.filter((e) </code><code  class="scala keyword">=</code><code
 class="scala plain">> e.</code><code  class="scala keyword">_</code><code  class="scala value">2</code><code
 class="scala plain">.getType() !</code><code  class="scala keyword">=</code> <code
 class="scala plain">Presence.Type.unavailable)</code></div>
                        <div  class="line number82 index81 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">}</code></div>
                        <div  class="line number83 index82 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number84 index83 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number85 index84 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">ConsoleChatHelper {</code></div>
                        <div  class="line number86 index85 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">/**</code></div>
                        <div  class="line number87 index86 alt2"><code  class="scala spaces">   </code><code
 class="scala comments">* @param u is the username</code></div>
                        <div  class="line number88 index87 alt1"><code  class="scala spaces">   </code><code
 class="scala comments">* @param p is the password</code></div>
                        <div  class="line number89 index88 alt2"><code  class="scala spaces">   </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number90 index89 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">run(u</code><code  class="scala keyword">:</code> <code
 class="scala plain">String, p</code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number91 index90 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">ex </code><code  class="scala keyword">=</code> <code
 class="scala keyword">new</code> <code  class="scala plain">ConsoleChatActor(u, p)</code></div>
                        <div  class="line number92 index91 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">ex.start </code></div>
                        <div  class="line number93 index92 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">ex ! Start </code></div>
                        <div  class="line number94 index93 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">ex </code></div>
                        <div  class="line number95 index94 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number96 index95 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number97 index96 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number98 index97 alt1"><code  class="scala comments">// To start the dispatcher just call:</code></div>
                        <div  class="line number99 index98 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number100 index99 alt1"><code  class="scala plain">ConsoleChatHelper.run(userName, password);</code></div>
                        <div  class="line number101 index100 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number102 index101 alt1"><code  class="scala plain">...</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The above is an example how you can integrate your
        application with an XMPP server and how messages are pocessed. </div>
      <h2  class="Section"> <a  name="toc-Section-13.6"  class="toc">13.6</a> 
        Lucene/Compass Integration </h2>
      <div  class="Unindented">
        <div  style="width: 100%;"  class="Framed"> This chapter is still under
          active development. The contents will change. </div>
      </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-14"  class="toc">14</a> Lift
        Widgets<a  name="cha:Lift-Widgets"  class="Label"> </a> </h1>
      <div  class="Unindented"> In this chapter we’re going to discuss widgets
        in Lift. A widget is essentially a library of Scala and JavaScript code
        that together provide packaged XHTML fragments for display on the client
        browser. In other web frameworks (JSF, Struts, etc) these are sometimes
        called components. An example of a widget would be small library that
        automatically embeds a Calendar instance (section <a  href="#sub:Calendar-widgets"
 class="Reference">14.1.2↓</a>), or a helper library to sort HTML
        tables (section <a  href="#sub:TableSorter-widget"  class="Reference">14.1.1↓</a>). Typically widgets embody dynamic
        behavior on the client side, which is what makes them so attractive;
        static client-side content is already dead simple to generate in Lift
        with snippets, so the extra sauce of JavaScript binding and Ajax
        callbacks really makes advanced functionality easy. </div>
      <div  class="Indented"> Lift’s widgets are intended to minimize effort on
        your part. Unlike some other frameworks where widgets/components require
        the use of specific traits or special XML binding, Lift (and Scala’s)
        inherent flexibility with XML, JavaScript abstraction, and snippet
        generators make using widgets as simple as dropping in a few lines of
        code to your existing snippets or views. </div>
      <h2  class="Section"> <a  name="toc-Section-14.1"  class="toc">14.1</a> 
        Current Lift Widgets </h2>
      <div  class="Unindented"> To start, we’ll cover the current set of widgets
        included in Lift at the time of writing this book. These widgets are
        contained in the lift-widgets module, which means you’ll need to add the
        dependency to your pom.xml if you want to use them (section <a  href="#sub:Adding-a-Dependency"
 class="Reference">A.5.1↓</a>). While this list will likely grow over
        time, remember that widgets are based on the fundamentals of Scala’s XML
        functionality as well as Lift’s JavaScript support (chapter <a  href="#cha:Lift-and-Javascript"
 class="Reference">10↑</a>), so the same general rules apply to all of
        them. At the end of the chapter we’ll cover writing your own widgets
        (section <a  href="#sec:How-to-build-widgets"  class="Reference">14.2↓</a>). </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-14.1.1"  class="toc">14.1.1</a> 
        TableSorter widget<a  name="sub:TableSorter-widget"  class="Label"> </a>
      </h3>
      <div  class="Unindented">
        <div  class="float"> <a  name="Figure-14.1"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 5in; max-width: 947px; height: auto; max-height: 130px;"
 alt="figure images/tablesorter.png"  src="./ExploringLift_files/tablesorter.png"
 class="embedded" /> </div>
            <div  class="caption"> Малюнок 14.1 TableSorter widget </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The TableSorter widget is based on the TableSorter
        jQuery plugin<span  class="FootOuter"><span  class="SupFootMarker"> [H] </span><span
 class="HoverFoot"><span  class="SupFootMarker">  [H] </span><a  href="http://tablesorter.com/docs/"
 class="URL">http://tablesorter.com/docs/</a></span></span>.
        Basically, the TableSorter widget allows you to take an existing HTML
        table (THEAD and TBODY tags are required) and add sorting to columns in
        the table. By default, the widget handles sorting of numeric, currency,
        and other value types automatically. The full capabilities of the plugin
        are beyond the scope of the widget, however; if you need more features
        you’ll have to set up the JavaScript yourself instead of using the
        widget. </div>
      <div  class="Indented"> The first step in using the widget is to call the
        <tt>TableSorter.init </tt>function in your Boot class to
        make Lift aware of the resources used by this widget. Then, you need to
        set up a table in your page (either statically in the template or via a
        snippet): </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> TableSorter Template </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_704175">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:TableSorterDemo</code><code
 class="xml plain">/></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">table</code> <code  class="xml color1">id</code><code
 class="xml plain">=</code><code  class="xml string">"table-id"</code> <code  class="xml color1">class</code><code
 class="xml plain">=</code><code  class="xml string">"tablesorter"</code><code  class="xml plain">> ... </</code><code
 class="xml keyword">table</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain"></</code><code
 class="xml keyword">lift:surround</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that you need to have an
        <tt>id</tt> attribute on the table and add the
        <tt>tablesorter</tt> class to the table element. Next you
        simply call the TableSorter widget from a snippet: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> TableSorter Snippet </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_243465">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">TableSorterDemo {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq)</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">TableSorter(</code><code
 class="scala string">"table-id"</code><code  class="scala plain">)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The argument to TableSorter is the HTML element
        <tt>id</tt> of the table you want sorted. The TableSorter
        code relies on head merge (section <a  href="#sec:Head-Merge"  class="Reference">↓</a>) to put the appropriate JavaScript and jQuery
        functions into the returned page. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-14.1.2"  class="toc">14.1.2</a> 
        Calendar widgets<a  name="sub:Calendar-widgets"  class="Label"> </a> </h3>
      <div  class="Unindented"> There are three calendar widgets corresponding
        to month, week and day views. These widgets display calendars with a
        similar look and feel to Microsoft Outlook or Google Calendar.They
        provide basic functionality for display, but you can easily customize
        CSS and JavaScript hooks for calendar items to fit your application
        requirements. </div>
      <div  class="Paragraph"> <a  name="toc-Paragraph-1"  class="toc"></a>Calendar
        Month-View </div>
      <div  class="Unindented">
        <div  class="float"> <a  name="Figure-14.2"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 5in; max-width: 730px; height: auto; max-height: 375px;"
 alt="figure images/month-view.png"  src="./ExploringLift_files/month-view.png"
 class="embedded" /> </div>
            <div  class="caption"> Малюнок 14.2 Calendar Month-View </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> This widget allows you to create month view
        calendars in your web page, manage your calendar events etc. The first
        thing you need to do is call the
        <tt>CalendarMonthView.init</tt> function in your Boot class;
        this performs initialization by telling Lift’s
        <tt>ResourceServer</tt> about the paths to JavaScripts and
        stylesheets needed by this widget since these dependencies are embedded
        in the same jar file (we’ll cover this topic more in section <a  href="#sec:How-to-build-widgets"
 class="Reference">14.2↓</a>). </div>
      <div  class="Indented"> The template for our widget example is relatively
        straightforward, as shown in listing <a  href="#lst:Month-view-template"
 class="Reference">1↓</a>. Basically, we provide a binding element
        where the calendar will be rendered. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Month view template<a  name="lst:Month-view-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_668980">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:surround</code> <code  class="xml color1">with</code><code
 class="xml plain">=</code><code  class="xml string">"default"</code> <code  class="xml color1">at</code><code
 class="xml plain">=</code><code  class="xml string">"content"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">h2</code><code  class="xml plain">>Calendar Month View Demo</</code><code
 class="xml keyword">h2</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">lift:CalendarMonthViewDemo</code><code
 class="xml plain">> </code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">           </code><code
 class="xml plain"><</code><code  class="xml keyword">cal:widget</code><code  class="xml plain">/></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">lift:CalendarMonthViewDemo</code><code
 class="xml plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml plain"></</code><code
 class="xml keyword">lift:surround</code><code  class="xml plain">> </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In our snippet code, listing <a  href="#lst:Month-view-snippet"
 class="Reference">1↓</a>, we first perform some setup of the widget.
        The Calendar widget takes a <tt>java.util.Calendar</tt>
        instance telling it which month to display. Additionally, it takes a
        Seq[CalendarItem] of items to be displayed on the calendar. Finally, it
        takes three arguments containing optional JavaScript functions to be
        called when an item, day, or week is clicked, respectively. In our
        example we’re not showing any events or setting up any callbacks. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Month view snippet<a  name="lst:Month-view-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_701197">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">CalendarMonthViewDemo {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(html</code><code
 class="scala keyword">:</code> <code  class="scala plain">Group) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">c </code><code  class="scala keyword">=</code> <code
 class="scala plain">Calendar.getInstance;</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">c.set(MONTH, </code><code  class="scala value">0</code><code
 class="scala plain">)     </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">bind(</code><code  class="scala string">"cal"</code><code  class="scala plain">, html,</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">         </code><code
 class="scala string">"widget"</code> <code  class="scala plain">-> CalendarMonthView(c, Nil, Empty, Empty, Empty)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In addition, CalendarMonthView can also take a
        MonthViewMeta instance as the second argument so that you can control
        the first day of the week and the locale used for formatting dates and
        times. For instance, we could set the calendar to use Monday as the
        first day of the week: </div>
      <div  class="Indented">
        <div  class="listing">
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_588066">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala string">"widget"</code> <code
 class="scala plain">-> CalendarMonthView(c, </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">              </code><code
 class="scala plain">MonthViewMeta(Calendar.MONDAY, Locale.getDefault),</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">              </code><code
 class="scala plain">Nil, Empty, Empty, Empty)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Of course, without anything to display or do this
        isn’t very useful, so let’s look at how you create CalendarItems. </div>
      <div  class="Indented"> Listing <a  href="#lst:CalendarItem-example"  class="Reference">1↓</a> shows how we can create a calendar item for
        a meeting on June 5th at 2:30 pm. We have to set up another Calendar
        instance to hold the time of the meeting, then we use the CalendarItem
        helper object to set up the actual item instance. The first parameter is
        the id of the div that will be created for the item. This can be used
        from other scripts if needed. The second argument is the time of the
        event. The third argument is the CalendarType of the event, in this
        case, a meeting. The optional method on CalendarItem allows you to set
        optional attributes essentially via a sequence of <span  class="formula">(<i>CalendarItem</i>)
           ⇒ <i>CalendarItem</i></span> functions. This technique is used since
        CalendarItems are immutable and modifying them returns new instances. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> CalendarItem example<a  name="lst:CalendarItem-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_887153">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">time </code><code  class="scala keyword">=</code> <code  class="scala plain">Calendar.getInstance</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">time.setTime(DateFormat.pars(</code><code
 class="scala string">"2009-06-05 2:30pm"</code><code  class="scala plain">))</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">meeting </code><code  class="scala keyword">=</code> <code
 class="scala plain">CalendarItem(</code><code  class="scala string">"4"</code><code
 class="scala plain">, time, CalendarType.MEETING) optional (</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">_</code> <code  class="scala plain">end(time),</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">_</code> <code  class="scala plain">subject(</code><code
 class="scala string">"Important Meeting!"</code><code  class="scala plain">))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The widget renders not only the XHTML to display
        the calendar, but it generates the <tt><script></tt>
        and CSS tags using head merge to control display. One common
        customization of the widget would be to override the CSS used; to do
        this, provide your own <tt>style.css</tt> file under the
        WEB-INF/classes/calendars/monthview directory in your project. Because
        Lift uses the classpath to load resources, your style.css file will be
        “found” before the default one bundled in the lift-widgets jar file. You
        can use the default <tt>style.css</tt> as a starting point<span  class="FootOuter"><span
 class="SupFootMarker"> [I]  </span><span  class="HoverFoot"><span  class="SupFootMarker"> [I] </span><a
 href="http://github.com/dpp/liftweb/tree/master/lift-widgets/src/main/resources/toserve/calendars/monthview/style.css"
 class="URL">http://github.com/dpp/liftweb/tree/master/lift-widgets/src/main/resources/toserve/calendars/monthview/style.css</a></span></span>.
      </div>
      <div  class="Indented"> The final thing we’d like to cover for the Month
        view is the JavaScript callbacks. These callbacks are constructed using
        the AnonFunc JavaScript artifact, which essentially constructs an
        anonymous function on the client side. Listing <a  href="#lst:Calendar-callback-example"
 class="Reference">1↓</a> shows an example of using the callbacks to
        redirect to an event view page for the given event when the item is
        clicked. In this example we assume that the id of each calendar item is
        its unique id in the ORM (section <a  href="#sub:Object-Relationships"  class="Reference">8.1.4↑</a>) and that we have a rewrite rule set up
        to handle item viewing (section <a  href="#sec:URL-Rewriting"  class="Reference">3.7↑</a>). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Calendar callback example<a  name="lst:Calendar-callback-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_404085">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">JsCmds.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">itemClick </code><code  class="scala keyword">=</code> <code
 class="scala plain">Full(</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">AnonFunc(</code><code  class="scala string">"elem, param"</code><code
 class="scala plain">, JsRaw(</code><code  class="scala string">"alert(elem);"</code><code
 class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Paragraph"> <a  name="toc-Paragraph-2"  class="toc"></a>Calendar
        Week-View </div>
      <div  class="Unindented">
        <div  class="float"> <a  name="Figure-14.3"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 5in; max-width: 901px; height: auto; max-height: 359px;"
 alt="figure images/week-view.png"  src="./ExploringLift_files/week-view.png"  class="embedded" /> </div>
            <div  class="caption"> Малюнок 14.3 Calendar Week-View </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The CalendarWeekView widget provides a weekly view
        of the calendar. The same general principles apply as for month view.
        Again, you need to initialize the CalendarWeekView by calling the
        <tt>CalendarWeekView.init</tt> function in your Boot class.
      </div>
      <div  class="Indented"> Listing <a  href="#lst:Week-View-example"  class="Reference">2↓</a> shows a snippet returning a week view. As
        you can see, we still use a Calendar instance to set the time, and we
        also provide a WeekViewMeta in this example to set the first day of the
        week and the locale. The <tt>list</tt> argument is a
        Seq[CalendarItem], constructed exactly the same as for a month view.
        Finally, we provide a JavaScript item callback. Note that there aren’t
        day or week callbacks available. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Week view example<a  name="lst:Week-View-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_865099">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">CalendarWeekViewDemo {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(html</code><code
 class="scala keyword">:</code> <code  class="scala plain">Group) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">c </code><code  class="scala keyword">=</code> <code
 class="scala plain">Calendar.getInstance</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">c.set(DAY</code><code  class="scala keyword">_</code><code
 class="scala plain">OF</code><code  class="scala keyword">_</code><code  class="scala plain">MONTH, </code><code
 class="scala value">17</code><code  class="scala plain">)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">c.set(MONTH, </code><code  class="scala value">4</code><code
 class="scala plain">)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"cal"</code><code  class="scala plain">, html,</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">       </code><code
 class="scala string">"widget"</code> <code  class="scala plain">-> CalendarWeekView(c, </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">         </code><code
 class="scala plain">WeekViewMeta(MONDAY, Locale.getDefault()),</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">         </code><code
 class="scala plain">list,</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">         </code><code
 class="scala plain">itemClick))</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces"> </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Paragraph"> <a  name="toc-Paragraph-3"  class="toc"></a>Calendar
        Day-View </div>
      <div  class="Unindented">
        <div  class="float"> <a  name="Figure-14.4"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 5in; max-width: 564px; height: auto; max-height: 364px;"
 alt="figure images/day-view.png"  src="./ExploringLift_files/day-view.png"  class="embedded" /> </div>
            <div  class="caption"> Малюнок 14.4 Calendar Day-View </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The CalendarDayView widget renders a calendar for
        a single day. The usage is essentially the same as for the month and
        week views, as shown in listing <a  href="#lst:Day-view-example"  class="Reference">3↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Day view example<a  name="lst:Day-view-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_810904">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">CalendarDayViewDemo {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(html</code><code
 class="scala keyword">:</code> <code  class="scala plain">Group) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">   </code><code
 class="scala keyword">val</code> <code  class="scala plain">c </code><code  class="scala keyword">=</code> <code
 class="scala plain">Calendar.getInstance</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">   </code><code
 class="scala plain">c.set(DAY</code><code  class="scala keyword">_</code><code
 class="scala plain">OF</code><code  class="scala keyword">_</code><code  class="scala plain">MONTH, </code><code
 class="scala value">17</code><code  class="scala plain">)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">   </code><code
 class="scala plain">c.set(MONTH, </code><code  class="scala value">4</code><code
 class="scala plain">)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">   </code><code
 class="scala plain">bind(</code><code  class="scala string">"cal"</code><code  class="scala plain">, html,</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala string">"widget"</code> <code  class="scala plain">-> CalendarDayView(c, </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">DayViewMeta(Locale.getDefault()),</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">list, itemClick)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">   </code><code
 class="scala plain">)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces"> </code><code
 class="scala plain">} </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The parameters are essentially the same, except
        that the Calendar object represents the day that we want to render and
        we pass a DayViewMeta containing just the Locale for
        internationalization purposes. Again, only an item click callback is
        available. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-14.1.3"  class="toc">14.1.3</a> 
        RSS Feed widget </h3>
      <div  class="Unindented">
        <div  class="float"> <a  name="Figure-14.5"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 4in; max-width: 505px; height: auto; max-height: 284px;"
 alt="figure images/rssfeed.png"  src="./ExploringLift_files/rssfeed.png"  class="embedded" /> </div>
            <div  class="caption"> Малюнок 14.5 RSSFeed widget </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The RSS feed widget, like its name implies, simply
        renders RSS feeds. This widget does not need initialization in Boot
        since it has no dependencies on JavaScript, CSS, etc. In your snippet
        you simply use the RSSFeed helper object with the RSS feed URL: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> RSSFeed example </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_725817">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">RSSFeedDemo {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq)</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">RSSFeed(</code><code  class="scala string">"<a  href="http://www.praytothemachine.com/evil/index.php/feed/">http://www.praytothemachine.com/evil/index.php/feed/</a>"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Although the RSSFeed widget doesn’t provide its
        own CSS, the generated elements do have CSS classes attached to them
        that you can provide styling for: </div>
      <div  class="Description"> <span  class="Description-entry">rsswidget</span> 
        This class is attached to the outer div that contains all of the feed
        elements </div>
      <div  class="Description"> <span  class="Description-entry">rsswidgettitle</span> 
        This class is attached to the <li> that holds the title of the
        feed </div>
      <div  class="Description"> <span  class="Description-entry">rsswidgetitem</span> 
        This class is attached to each <li> element that holds an RSS item
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-14.1.4"  class="toc">14.1.4</a> 
        Gravatar widget </h3>
      <div  class="Unindented"> Gravatars are <b>g</b>lobally <b>r</b>ecognized
        <b>avatars</b><span  class="FootOuter"><span  class="SupFootMarker"> [J]
             </span><span  class="HoverFoot"><span  class="SupFootMarker">  [J] </span><a
 href="http://gravatar.com/"  class="URL">http://gravatar.com</a></span></span>.
        You can add your picture at the Gravatar website and associate it with
        one or more email addresses. Sites that interact with Gravatar can fetch
        your picture and display it, which is what the Gravatar widget does.
        Listing <a  href="#lst:Gravatar-example"  class="Reference">14.1.4↓</a> shows an example snippet that will
        render the Gravatar for the currentUser into a
        <tt><div></tt>, if available. The default size of the
        Gravatar is 42x42 pixels, but you can override this with additional
        parameters on the Gravatar.apply method. Additionally, you can filter
        the Gravatar based on its rating (the default rating is “G” only). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Gravatar example<a  name="lst:Gravatar-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_664280">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">GravatarDemo {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq) </code><code
 class="scala keyword">:</code><code  class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">   </code><code
 class="scala plain">Gravatar(currentUser.email)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-14.1.5"  class="toc">14.1.5</a> 
        TreeView widget </h3>
      <div  class="Unindented"> The TreeView widget transforms an unordered list
        (<tt><ul></tt>) into a tree-like structure using the
        TreeView JQuery plugin <span  class="FootOuter"><span  class="SupFootMarker"> 
            [K] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [K] </span><a  href="http://docs.jquery.com/Plugins/Treeview"  class="URL">http://docs.jquery.com/Plugins/Treeview</a></span></span>.
        Each nested unordered list gets decorated with a +/- sign that allows
        you to collapse or expand the entire sublist, as shown in figure <a  href="#fig:TreeView-widget"
 class="Reference">14.6↓</a>. </div>
      <div  class="Indented">
        <div  class="float"> <a  name="fig:TreeView-widget"  class="Label"> </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 3.5in; max-width: 458px; height: auto; max-height: 311px;"
 alt="figure images/treeview.png"  src="./ExploringLift_files/treeview.png"  class="embedded" /> </div>
            <div  class="caption"> Малюнок 14.6 TreeView widget </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> To use this widget you first need to initialize
        the widget by calling the <tt>TreeView.init</tt> function in
        your Boot class. For basic usage, your snippet looks like listing <a  href="#lst:TreeView-snippet"
 class="Reference">14.1.5↓</a>. The first argument is the id of the
        unordered list that you want transformed into a tree. The second
        argument is a JSON object that is used to configure the tree view. In
        our example, we’re setting the treeview to animate opening and closing
        of nodes with a 90 millisecond delay; for more options see the treeview
        jQuery documentation page. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> TreeView snippet<a  name="lst:TreeView-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_98187">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">TreeViewDemo {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">Group)</code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">TreeView(</code><code  class="scala string">"example"</code><code
 class="scala plain">, JsObj((</code><code  class="scala string">"animated"</code> <code
 class="scala plain">-> </code><code  class="scala value">90</code><code  class="scala plain">)))</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In addition to transforming static lists into
        trees, the TreeView widget also supports asynchronous loading of trees
        and nodes via Ajax calls. In order to do this, you still need to provide
        an empty <tt><ul></tt> element with an id attribute;
        this is essentially modified in place as portions of the tree are
        loaded. Next, you provide two functions that are used to retrieve the
        Tree data: </div>
      <ol>
        <li> A function <span  class="formula">() ⇒ <i>List</i>[<i>Tree</i>]</span>
          to load the initial view of the tree. This is what will be displayed
          to the client when the page loads, so if you want some nodes to be
          available without having to make an Ajax call this is where you define
          it.We will explain the Tree class in a moment. </li>
        <li> A function <span  class="formula">(<i>String</i>) ⇒ <i>List</i>[<i>Tree</i>]</span>
          to load the children of a given node (the String argument is the
          node’s id) </li>
      </ol>
      <div  class="Unindented"> The Tree class defines each node in the tree and
        contains several values that define the appearance and behavior of the
        node: </div>
      <div  class="Description"> <span  class="Description-entry">text</span> 
        The text to be displayed in the list item. </div>
      <div  class="Description"> <span  class="Description-entry">id</span> The
        optional HTML id of the element </div>
      <div  class="Description"> <span  class="Description-entry">classes</span> 
        An optional string defining CSS classes to be assigned to the element </div>
      <div  class="Description"> <span  class="Description-entry">expanded</span> 
        A boolean controlling whether the element will be expanded initially
        (only valid if the haschildren is true or if the children list is
        populated) </div>
      <div  class="Description"> <span  class="Description-entry">hasChildren</span> 
        If this is set to true but the children value is Nil, then the TreeView
        widget will dynamically load the children of this node as described in
        item #2 above </div>
      <div  class="Description"> <span  class="Description-entry">children</span> 
        A List[Tree] defining the children of this element. Setting this value
        will prevent Ajax from being used to retrieve the list of children from
        the server on expansion </div>
      <div  class="Unindented"> The Tree companion object has a number of
        overloaded apply methods that make it easy to set one or more of these
        values without having to set all of them. </div>
      <div  class="Indented"> To provide a concrete example, listing <a  href="#lst:Tree-example"
 class="Reference">14.1.5↓</a> shows implementations of the loadTree
        and loadNode functions corresponding to the two Ajax functions used to
        dynamically construct the tree. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Tree example<a  name="lst:Tree-example"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_278897">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">loadTree () </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Tree(</code><code  class="scala string">"No children"</code><code
 class="scala plain">) </code><code  class="scala keyword">::</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">Tree(</code><code  class="scala string">"One static child"</code><code
 class="scala plain">, Tree(</code><code  class="scala string">"Lone child"</code><code
 class="scala plain">) </code><code  class="scala keyword">::</code> <code  class="scala plain">Nil) </code><code
 class="scala keyword">::</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Tree(</code><code  class="scala string">"Dynamic node"</code><code
 class="scala plain">, </code><code  class="scala string">"myDynamic"</code><code
 class="scala plain">, </code><code  class="scala keyword">true</code><code  class="scala plain">) </code><code
 class="scala keyword">::</code> <code  class="scala plain">Nil</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">loadNode (id </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code> <code
 class="scala plain">List[Tree] </code><code  class="scala keyword">=</code> <code
 class="scala plain">id </code><code  class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala string">"myDynamic"</code> <code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">Tree(</code><code  class="scala string">"Child one"</code><code
 class="scala plain">) </code><code  class="scala keyword">::</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">Tree(</code><code  class="scala string">"Child two"</code><code
 class="scala plain">) </code><code  class="scala keyword">::</code> <code  class="scala plain">Nil</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> Nil</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In this example the initial view will show three
        nodes; the third node (“Dynamic node”) will fetch its children via an
        Ajax call when expanded. The <tt>loadNode</tt> method will
        then handle this call by adding two static leaf nodes to the tree. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-14.1.6"  class="toc">14.1.6</a> 
        Sparklines widget </h3>
      <div  class="Unindented"> The Sparklines widget is based on Will Larson’s
        excellent Sparklines JavaScript library<span  class="FootOuter"><span  class="SupFootMarker"> 
            [L] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [L] </span><a  href="http://www.willarson.com/code/sparklines/sparklines.html"
 class="URL">http://www.willarson.com/code/sparklines/sparklines.html</a></span></span>.
        Sparklines are essentially small, high resolution charts embedded in
        text that provide a wealth of information in a compact representation<span
 class="FootOuter"><span  class="SupFootMarker"> [M] </span><span  class="HoverFoot"><span
 class="SupFootMarker"> [M] </span>The term “Sparkline” was
            introduced by Edward Tufte in his book <i>Beautiful Evidence</i>.
            Dr. Tufte’s work is a must read for anyone who si working with
            visualizing large volumes of data.</span></span>. </div>
      <div  class="Indented">
        <div  class="float"> <a  name="fig:Sparklines-bar-chart"  class="Label">
          </a>
          <div  class="figure">
            <div  class="center"> <img  style="width: 3.5in; max-width: 503px; height: auto; max-height: 202px;"
 alt="figure images/sparklines.png"  src="./ExploringLift_files/sparklines.png"
 class="embedded" /> </div>
            <div  class="caption"> Малюнок 14.7 Sparklines bar chart </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As with our other widgets, you need to initialize
        the widget in your Boot class by calling
        <tt>Sparklines.init</tt>. Listing <a  href="#lst:Sparklines-snippet"  class="Reference">14.1.6↓</a> shows a simple snippet utilizing the
        widget to produce the graph shown in figure <a  href="#fig:Sparklines-bar-chart"
 class="Reference">14.7↑</a>. In your template you need to provide a
        canvas element with an <tt>id</tt> attribute that will be
        used by the widget for its content. In our example we provide a JsArray
        (an abstracted JavaScript array) with our data, as well as a JSON object
        containing options for the chart<span  class="FootOuter"><span  class="SupFootMarker"> 
            [N] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [N] </span>More options can be found on Will Larson’s Sparklines
            web page</span></span>. We’ve set our options to draw percentage
        lines for the bar chart as well as filling in the area between the
        percentage lines. Finally, we call the Sparklines.onLoad method to
        generate the chart drawing code (the chart will be drawn when the page
        is loaded). The Sparklines library currently handles bar and line
        charts, which are chosen via the SparklineStyle enumeration. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Sparklines snippet<a  name="lst:Sparklines-snippet"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_321539">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">SparklinesDemo {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(html</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq)</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">data </code><code  class="scala keyword">=</code> <code
 class="scala plain">JsArray(</code><code  class="scala value">100</code><code  class="scala plain">,</code><code
 class="scala value">500</code><code  class="scala plain">,</code><code  class="scala value">300</code><code
 class="scala plain">,</code><code  class="scala value">200</code><code  class="scala plain">,</code><code
 class="scala value">400</code><code  class="scala plain">,</code><code  class="scala value">500</code><code
 class="scala plain">,</code><code  class="scala value">400</code><code  class="scala plain">,</code><code
 class="scala value">400</code><code  class="scala plain">,</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                       </code><code
 class="scala value">100</code><code  class="scala plain">,</code><code  class="scala value">200</code><code
 class="scala plain">, </code><code  class="scala value">345</code><code  class="scala plain">, </code><code
 class="scala value">412</code><code  class="scala plain">, </code><code  class="scala value">111</code><code
 class="scala plain">, </code><code  class="scala value">234</code><code  class="scala plain">, </code><code
 class="scala value">490</code><code  class="scala plain">);</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">opts </code><code  class="scala keyword">=</code> <code
 class="scala plain">JsObj((</code><code  class="scala string">"percentage_lines"</code> <code
 class="scala plain">-> JsArray(</code><code  class="scala value">0.5</code><code
 class="scala plain">, </code><code  class="scala value">0.75</code><code  class="scala plain">)),</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">                     </code><code
 class="scala plain">(</code><code  class="scala string">"fill_between_percentage_lines"</code> <code
 class="scala plain">-> </code><code  class="scala keyword">true</code><code  class="scala plain">),</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">                     </code><code
 class="scala plain">(</code><code  class="scala string">"extend_markings"</code> <code
 class="scala plain">-> </code><code  class="scala keyword">false</code><code  class="scala plain">));</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">Sparklines.onLoad(</code><code  class="scala string">"bar"</code><code
 class="scala plain">, SparklineStyle.BAR, data, opts);</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-14.2"  class="toc">14.2</a> 
        How to build a widget<a  name="sec:How-to-build-widgets"  class="Label">
        </a> </h2>
      <div  class="Unindented"> As we explained in the introduction, there is no
        magic formula when building a widget since Lift and Scala provide so
        much base functionality without having to resort to restrictions like
        traits or static XML binding. However, there are a few items to note if
        you want to design your own widgets </div>
      <div  class="Indented"> Generally it’s useful to make your widget a
        self-contained JAR file to simplify dependency management and
        deployment. Including things like style sheets and javascript libraries
        in your package is quite straightforward if you’re using Maven, but the
        question then becomes how do you access these resources from a Lift
        application. Fortunately, Lift provides some very simple mechanisms for
        using class loaders to retrieve resources. The basic functionality is
        handled through the <tt>ResourceServer</tt> object<span  class="FootOuter"><span
 class="SupFootMarker"> [O] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [O] </span>net.liftweb.http.ResourceServer</span></span>, which we
        cover in detail in section <a  href="#sub:ResourceServer"  class="Reference">9.8↑</a>. This object controls resource loading,
        and in particular handles where resources can be loaded from. Listing <a
 href="#lst:Adding-ResourceServer-permissions"  class="Reference">14.2↓</a> shows an example init method (similar to
        those that we’ve previously used for the existing widgets) that tells
        the ResourceServer that it can load resources from the path
        “/classpath/mywidget”. You would locate these resources under the
        <tt>mywidget</tt> package in your widget project. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Adding ResourceServer permissions<a  name="lst:Adding-ResourceServer-permissions"
 class="Label"> </a> </div>
          import _root_.net.liftweb.http.ResourceServer
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_320375">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">init() {     </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">ResourceServer.allow{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala string">"iframewidget"</code> <code
 class="scala keyword">::</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala keyword">true</code>    </div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Once you’ve set up the appropriate permissions,
        your widget can generate links or scripts that load from within the
        classpath, as shown in listing <a  href="#lst:Sample-widget-rendering"  class="Reference">14.2↓</a>. In this example we’ve defined a simple
        (and slightly ridiculous) widget that renders a given URL into an IFrame
        element. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Sample widget rendering<a  name="lst:Sample-widget-rendering"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_423298">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">IFrameWidget {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">render(url </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><head></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><link </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"text/css"</code> <code
 class="scala plain">rel</code><code  class="scala keyword">=</code><code  class="scala string">"stylesheet"</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">         </code><code
 class="scala plain">href</code><code  class="scala keyword">=</code><code  class="scala plain">{LiftRules.resourceServerPath + </code><code
 class="scala string">"/iframewidget/style.css"</code><code  class="scala plain">/></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"></head></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><div </code><code  class="scala keyword">class</code><code
 class="scala keyword">=</code><code  class="scala string">"iframeDiv"</code><code
 class="scala plain">></code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><iframe src</code><code  class="scala keyword">=</code><code
 class="scala plain">{url}></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala plain"><p>Your browser doesn’t support IFrames</p></code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"></iframe></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"></div></code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note the path that we used uses the
        <tt>LiftRules.resourceServerPath </tt>variable. It’s
        preferable to use this mechanism instead of hardcoding “/classpath” to
        allow for end-user flexibility. We also use head merge to make sure the
        proper stylesheet is loaded for the page. </div>
      <div  class="Indented"> As you can see, defining your own widget is not
        much different than writing a snippet. The major difference is in making
        resources accessible while bundling and making sure that you avoid
        hardcoding properties that are configurable by the end-users of your
        widget. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Chapter-15"  class="toc">15</a> 
        RESTful Web Services<a  name="cha:Web-Services"  class="Label"> </a> </h1>
      <div  class="Unindented"> Many web applications today offer an API<span  class="FootOuter"><span
 class="SupFootMarker">  [P] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [P] </span>Application Programming Interface</span></span> that
        allows others to extend the functionality of the application. An API is
        a set of exposed functions that is meant to allow third parties to reuse
        elements of the application. There is a number of sites that catalog the
        available APIs, such as ProgrammableWeb (see <a  href="http://www.programmableweb.com/"
 class="FlexURL">http://www.programmableweb.com/</a>). An example of a
        site that has combined the GoogleMaps and Flickr APIs is
        FlickrVision.com<span  class="FootOuter"><span  class="SupFootMarker"> 
            [Q] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Q] </span><a  href="http://flickrvision.com/"  class="URL">http://flickrvision.com/</a></span></span>.
        FlickrVision allows users to visualize where in the world recent photos
        have been taken by combining the geolocation information embedded in the
        photos and the mapping system of GoogleMaps. This is just one example of
        an API mashup, and there are countless other examples. </div>
      <h2  class="Section"> <a  name="toc-Section-15.1"  class="toc">15.1</a> 
        Some Background on REST </h2>
      <div  class="Unindented"> Before we dive into the details of building a
        RESTful API with Lift, let’s start by discussing a little about REST and
        the protocol that it sits atop: HTTP. If you’re already familiar with
        REST and HTTP, feel free to skip to the implementation in Розділ <a  href="#sec:A-Simple-API-pocketchange"
 class="Reference">15.2↓</a>. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-15.1.1"  class="toc">15.1.1</a> 
        A Little Bit about HTTP </h3>
      <div  class="Unindented"> As we build our web service, it will to be
        helpful to know a few things about HTTP<span  class="FootOuter"><span  class="SupFootMarker"> 
            [R] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [R] </span>Hypertext Transfer Protocol</span></span> requests and
        responses. If you’re comfortable with the Request-Response cycle then
        feel free to jump to Розділ <a  href="#sec:What-is-REST?"  class="Reference">15.1.2↓</a> to get down to business. </div>
      <div  class="Indented"> A simplification of how the web works is that
        clients, typically web browsers, send HTTP Requests to servers, which
        respond with HTTP Responses. Let’s take a look at an exchange between a
        client and a server. </div>
      <div  class="Indented"> We’re going to send a GET request to the URI <a  href="http://demo.liftweb.net/"
 class="FlexURL">http://demo.liftweb.net/</a> using the
        <tt>cURL</tt> utility. We’ll enable dumping the HTTP
        protocol header information so that you can see all of the information
        associated with the request and response. The cURL utility sends the
        output shown in Listing <a  href="#lst:cURL-Output"  class="Reference">15.1.1↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> cURL Request<a  name="lst:cURL-Output"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_80172">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">$ curl -v http</code><code
 class="scala keyword">:</code><code  class="scala comments">//demo.liftweb.net/ </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">* About to connect() to demo.liftweb.net port </code><code
 class="scala value">80</code> <code  class="scala plain">(</code><code  class="scala keyword">#</code><code
 class="scala value">0</code><code  class="scala plain">) </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">*   Trying </code><code
 class="scala value">64.27</code><code  class="scala plain">.</code><code  class="scala value">11.183</code><code
 class="scala plain">... connected </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">* Connected to demo.liftweb.net (</code><code
 class="scala value">64.27</code><code  class="scala plain">.</code><code  class="scala value">11.183</code><code
 class="scala plain">) port </code><code  class="scala value">80</code> <code  class="scala plain">(</code><code
 class="scala keyword">#</code><code  class="scala value">0</code><code  class="scala plain">) </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">> GET / HTTP/</code><code
 class="scala value">1.1</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">> User-Agent</code><code
 class="scala keyword">:</code> <code  class="scala plain">curl/</code><code  class="scala value">7.19</code><code
 class="scala plain">.</code><code  class="scala value">0</code> <code  class="scala plain">(i</code><code
 class="scala value">386</code><code  class="scala plain">-apple-darwin</code><code
 class="scala value">9.5</code><code  class="scala plain">.</code><code  class="scala value">0</code><code
 class="scala plain">) libcurl/</code><code  class="scala value">7.19</code><code
 class="scala plain">.</code><code  class="scala value">0</code> <code  class="scala plain">zlib/</code><code
 class="scala value">1.2</code><code  class="scala plain">.</code><code  class="scala value">3</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">> Host</code><code
 class="scala keyword">:</code> <code  class="scala plain">demo.liftweb.net </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">> Accept</code><code
 class="scala keyword">:</code> <code  class="scala plain">*/*</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> And gets the corresponding response, shown in
        Listing <a  href="#lst:cURL-Response"  class="Reference">15.1.1↓</a>, from the server: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> cURL Response<a  name="lst:cURL-Response"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_575747">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">< HTTP/</code><code
 class="scala value">1.1</code> <code  class="scala value">200</code> <code  class="scala plain">OK </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">< Server</code><code
 class="scala keyword">:</code> <code  class="scala plain">nginx/</code><code  class="scala value">0.6</code><code
 class="scala plain">.</code><code  class="scala value">32</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">< Date</code><code
 class="scala keyword">:</code> <code  class="scala plain">Tue, </code><code  class="scala value">24</code> <code
 class="scala plain">Mar </code><code  class="scala value">2009</code> <code  class="scala value">20</code><code
 class="scala keyword">:</code><code  class="scala value">52</code><code  class="scala keyword">:</code><code
 class="scala value">55</code> <code  class="scala plain">GMT </code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">< Content-Type</code><code
 class="scala keyword">:</code> <code  class="scala plain">text/html </code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">< Connection</code><code
 class="scala keyword">:</code> <code  class="scala plain">keep-alive </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">< Expires</code><code
 class="scala keyword">:</code> <code  class="scala plain">Mon, </code><code  class="scala value">26</code> <code
 class="scala plain">Jul </code><code  class="scala value">1997</code> <code  class="scala value">05</code><code
 class="scala keyword">:</code><code  class="scala value">00</code><code  class="scala keyword">:</code><code
 class="scala value">00</code> <code  class="scala plain">GMT </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">< Set-Cookie</code><code
 class="scala keyword">:</code> <code  class="scala plain">JSESSIONID</code><code
 class="scala keyword">=</code><code  class="scala value">5</code><code  class="scala plain">zrn</code><code
 class="scala value">24</code><code  class="scala plain">obipm</code><code  class="scala value">5</code><code
 class="scala plain">;Path</code><code  class="scala keyword">=</code><code  class="scala plain">/ </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">< Content-Length</code><code
 class="scala keyword">:</code> <code  class="scala value">8431</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">< Cache-Control</code><code
 class="scala keyword">:</code> <code  class="scala plain">no-cache; </code><code
 class="scala keyword">private</code><code  class="scala plain">; no-store; </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">must-revalidate; max-stale</code><code  class="scala keyword">=</code><code
 class="scala value">0</code><code  class="scala plain">; post-check</code><code
 class="scala keyword">=</code><code  class="scala value">0</code><code  class="scala plain">; pre-check</code><code
 class="scala keyword">=</code><code  class="scala value">0</code><code  class="scala plain">; max-age</code><code
 class="scala keyword">=</code><code  class="scala value">0</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">< Pragma</code><code
 class="scala keyword">:</code> <code  class="scala plain">no-cache </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">< X-Lift-Version</code><code
 class="scala keyword">:</code> <code  class="scala value">0.11</code><code  class="scala plain">-SNAPSHOT </code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain"><  </code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain"><?xml version</code><code
 class="scala keyword">=</code><code  class="scala string">"1.0"</code> <code  class="scala plain">encoding</code><code
 class="scala keyword">=</code><code  class="scala string">"UTF-8"</code><code  class="scala plain">?> </code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain"><!DOCTYPE html PUBLIC </code><code
 class="scala string">"-//W3C//DTD XHTML 1.0 Transitional//EN"</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces"> </code><code
 class="scala string">"<a  href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>"</code><code
 class="scala plain">></code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala plain"><html xmlns</code><code
 class="scala keyword">:</code><code  class="scala plain">lift</code><code  class="scala keyword">=</code><code
 class="scala string">"<a  href="http://liftweb.net/">http://liftweb.net</a>"</code> <code
 class="scala plain">xmlns</code><code  class="scala keyword">=</code><code  class="scala string">"<a
 href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>"</code><code
 class="scala plain">></code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain"><head>....</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> This seems pretty straightforward: we ask for a
        resource, and the server returns it to us. Take a look at the HTTP
        request. We’d like to point out the method called, in this case a
        <tt>“GET”, </tt>and the<tt> </tt>URI,<tt>
        </tt>which is “http://demo.liftweb.net/”. Method calls and
        addresses are what make the web work. You can think of the web as a
        series of method calls on varying resources, where the URI (Uniform
        Resource Identifier) identifies the resource upon which the method will
        be called. </div>
      <div  class="Indented"> Methods are defined as part of the HTTP standard,
        and we’ll use them in our API. In addition to <tt>GET</tt>,
        the other HTTP methods are <tt>POST</tt>,
        <tt>DELETE</tt>, <tt>PUT</tt>,
        <tt>HEAD</tt>, and<tt> OPTIONS</tt>. You may
        also see methods referred to as actions or verbs. In this chapter, we
        will focus on using <tt>GET</tt> and
        <tt>PUT</tt> for our API. </div>
      <div  class="Indented"> As do Requests, Responses come with a few
        important pieces of information. Of note are the Response Code and the
        Entity Body. In the above example, the Response Code is “<tt>200
        OK</tt>” and the Entity Body is the HTML content of the webpage,
        which is shown as the last two lines starting with
        “<tt><!DOCTYPE</tt>.” We’ve truncated the HTML content
        here to save space. </div>
      <div  class="Indented"> This was a quick overview of HTTP, but if you’d
        like to learn more, take a look at the protocol definition found at<span
 class="FootOuter"><span  class="SupFootMarker"> [S] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [S] </span>http://www.ietf.org/rfc/rfc2616.txt</span></span>.
        We wanted to point out a few of the interesting parts of the cycle
        before we got into building a REST API. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-15.1.2"  class="toc">15.1.2</a> 
        Defining REST<a  name="sec:What-is-REST?"  class="Label"> </a> </h3>
      <div  class="Unindented"> Roy Fielding defined REST in his dissertation<span
 class="FootOuter"><span  class="SupFootMarker"> [T] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [T] </span><a  href="http://www.ics.uci.edu/%7Efielding/pubs/dissertation/rest_arch_style.htm"
 class="FlexURL">http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm</a></span></span>
        and defined the main tenet of the architecture to be a uniform interface
        to resources. “Resources” refers to pieces of information that are named
        and have representations. Examples include an image, a Twitter status,
        or a timely item such as a stock quote or the current temperature. The
        uniform interface is supported by a set of constraints that include the
        following: </div>
      <ul>
        <li> Statelessness of communication: This is built on top of HTTP, which
          is also stateless. </li>
        <li> Client-server–style interaction: Again, just as the Web consists of
          browsers talking to servers, REST discusses machines or applications
          talking to servers in the same way. </li>
        <li> Support for caching: REST uses the caching headers of HTTP to
          support the caching of resources. </li>
      </ul>
      <div  class="Unindented"> These features are shared by both the web and by
        RESTful services. REST adds additional constraints regarding interacting
        with resources: </div>
      <ul>
        <li> Naming: As we mentioned, a resource must be identified, and this is
          done using URLs. </li>
        <li> Descriptive actions: Using the HTTP actions, GET, PUT, and DELETE
          makes it obvious what action is being performed on the resource. </li>
        <li> URL addressability: URLs should allow for the addressing of
          representation of a resource. </li>
      </ul>
      <div  class="Unindented"> Fielding’s goal was to define a method that
        allowed machine-to-machine communication to mimic that of
        browser-to-server communication and to take advantage of HTTP as the
        underlying protocol. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-15.1.3"  class="toc">15.1.3</a> 
        Comparing XML-RPC to REST Architectures </h3>
      <div  class="Unindented"> What, then, is the difference between a RESTful
        architecture and a traditional RPC<span  class="FootOuter"><span  class="SupFootMarker"> 
            [U] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [U] </span>Remote Procedure Call</span></span> architecture? </div>
      <div  class="Indented"> An RPC application follows a more traditional
        software development pattern. It ignores most of the features offered by
        HTTP, such as the HTTP methods. Instead, the scoping and data to be used
        by the call are contained in the body of a POST request. XML-RPC works
        similarly to the web for <i>getting</i> resources, but breaks from the
        HTTP model for everything else by overloading the POST request. You will
        often see the term SOAP when referring to an XML-RPC setup, because SOAP
        permits the developer to define the action and the resource in the body
        of the request and ignore the HTTP methods. </div>
      <div  class="Indented"> RESTful architectures embrace HTTP. We’re using
        the web; we may as well take advantage of it. </div>
      <h2  class="Section"> <a  name="toc-Section-15.2"  class="toc">15.2</a> A
        Simple API for PocketChange<a  name="sec:A-Simple-API-pocketchange"  class="Label">
        </a> </h2>
      <div  class="Unindented"> We’re going to start with a simple example, so
        we’ll only touch on some of the more complex steps of building a web
        service, such as authentication<a  href="#index-HTTP-authentication"  name="entry-HTTP-authentication-1"
 class="IndexReference">↓</a><a  href="#index-Authentication"  name="entry-Authentication-1"
 class="IndexReference">↓</a> and
        authorization. If you would like to see the code involved in performing
        authentication and authorization for our REST API, see Розділ <a  href="#sub:HTTP-Authentication"
 class="Reference">9.9↑</a>. For the purposes of this example, we’re
        going to model two calls to the server: a GET request that responds with
        the details of an expense, and a PUT to add a new expense.The URLs will
        be: </div>
      <ul>
        <li> A GET request sent to URI:
          <pre  class="LyX-Code">http://www.pocketchangeapp.com/api/expense/<expense id>
</pre> </li>
        <li> A PUT request containing a new expense sent to URI:
          <pre  class="LyX-Code">http://www.pocketchangeapp.com/api/account/<account id>
</pre> </li>
      </ul>
      <div  class="Unindented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note that a URL (Uniform
            Resource Locator) is a type of URI in which the URI also serves to
            locate the resource on the web. A URN (Uniform Resource Name) is
            another type of URI that provides a unique name to a resource
            without specifying an actual location, though it may look a lot like
            a URL. For more information on the distinctions among URIs, see <a  href="http://en.wikipedia.org/wiki/Uniform_Resource_Name"
 class="FlexURL">http://en.wikipedia.org/wiki/Uniform_Resource_Name</a>.
          </div>
        </div>
      </div>
      <div  class="Indented"> We would like the REST API to support both XML and
        JSON for this data. Additionally, we would like to support an Atom feed
        on an account so that people can track expenses as they’re added. The
        URL for the Atom feed will be a GET of the form: </div>
      <pre  class="LyX-Code">http://www.pocketchangeapp.com/api/account/<account id>
</pre>
      <div  class="Unindented"> In the next few sections we’ll show how you can
        easily add support for these methods and formats using Lift. </div>
      <h2  class="Section"> <a  name="toc-Section-15.3"  class="toc">15.3</a> 
        Adding REST Helper Methods to our Entities </h2>
      <div  class="Unindented"> In order to simplify our REST handler code, we
        would like to add some helper methods for our
        <tt>Expense</tt> entity to support generation of both XML
        and JSON for our consumers. We’ll add these to a new
        <tt>RestFormatters</tt> object inside the
        <tt>src/main/scala/com/pocketchangeapp/RestFormatters.scala</tt>
        source file. First, we add some common functionality in Listing <a  href="#lst:Common-Expense-REST-helpers"
 class="Reference">15.3↓</a> by adding several helper methods for
        computing REST header values. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Common Expense REST Helpers<a  name="lst:Common-Expense-REST-helpers"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_697710">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">/* The REST timestamp format. Not threadsafe, so we create</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">   </code><code
 class="scala comments">* a new one each time. */</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">timestamp </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">SimpleDateFormat(</code><code
 class="scala string">"yyyy-MM-dd’T’HH:mm:ss’Z’"</code><code  class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// A simple helper to generate the REST ID of an Expense</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">restId (e </code><code
 class="scala keyword">:</code> <code  class="scala plain">Expense) </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala string">"<a  href="http://www.pocketchangeapp.com/api/expense/">http://www.pocketchangeapp.com/api/expense/</a>"</code> <code
 class="scala plain">+ e.id</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// A simple helper to generate the REST timestamp of an Expense</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">restTimestamp (e </code><code
 class="scala keyword">:</code> <code  class="scala plain">Expense) </code><code
 class="scala keyword">:</code> <code  class="scala plain">String </code><code  class="scala keyword">=</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">timestamp.format(e.dateOf.is)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Listing <a  href="#lst:Expense-Entity-JSON"  class="Reference">15.3↓</a> shows a helper method for generating a
        proper JSON representation of a given <tt>Expense</tt> using
        the Lift JSON DSL. Although <tt>Expense</tt> is a
        <tt>Mapper</tt> entity, we don’t use the
        <tt>Expense.asJs<a  href="#index-Mapper-asJs"  name="entry-Mapper-asJs-0"
 class="IndexReference">↓</a></tt>
        method inherited from <tt>Mapper</tt> because we want to
        better control the format. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Expense Entity JSON Formatters<a  name="lst:Expense-Entity-JSON"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_835973">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">/**</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* Generates the JSON REST representation of an Expense</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">toJSON (e </code><code  class="scala keyword">:</code> <code
 class="scala plain">Expense) </code><code  class="scala keyword">:</code> <code
 class="scala plain">JValue </code><code  class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">import</code> <code  class="scala plain">net.liftweb.json.JsonDSL.</code><code
 class="scala keyword">_</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">import</code> <code  class="scala plain">net.liftweb.json.JsonAST.</code><code
 class="scala keyword">_</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">(</code><code  class="scala string">"expense"</code> <code
 class="scala plain">-></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">(</code><code  class="scala string">"id"</code> <code  class="scala plain">-> restId(e)) ~</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">(</code><code  class="scala string">"date"</code> <code  class="scala plain">-> restTimestamp(e)) ~</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">(</code><code  class="scala string">"description"</code> <code
 class="scala plain">-> e.description.is) ~</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">(</code><code  class="scala string">"accountname"</code> <code
 class="scala plain">-> e.accountName) ~</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">(</code><code  class="scala string">"accountid"</code> <code
 class="scala plain">-> e.account.obj.open</code><code  class="scala keyword">_</code><code
 class="scala plain">!.id.is) ~</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">(</code><code  class="scala string">"amount"</code> <code  class="scala plain">-> e.amount.is.toString) ~</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">(</code><code  class="scala string">"tags"</code> <code  class="scala plain">-> e.tags.map(</code><code
 class="scala keyword">_</code><code  class="scala plain">.name.is).mkString(</code><code
 class="scala string">","</code><code  class="scala plain">)))</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Finally, Listing <a  href="#lst:Expense-Entity-REST-XML"
 class="Reference">15.3↓</a> shows the <tt>toXML</tt>
        method, which will generate properly formatted XML for a given
        <tt>Expense</tt>. Like <tt>toJSON</tt>, we don’t
        use the <tt>Expense.toXml</tt><a  href="#index-Mapper-toXml"  name="entry-Mapper-toXml-0"
 class="IndexReference">↓</a> method
        because we want more control over the generated format. Instead, we
        simply convert the result of <tt>toJSON</tt> into XML using
        the <tt>net.liftweb.json.Xml</tt> helper object. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Expense Entity XML REST Formatter<a  name="lst:Expense-Entity-REST-XML"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_695298">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.json.Xml</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala comments">/**</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* Generates the XML REST representation of an Expense</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">toXML (e </code><code  class="scala keyword">:</code> <code
 class="scala plain">Expense) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Node </code><code  class="scala keyword">=</code> <code  class="scala plain">Xml.toXml(toJSON(e)).first</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-15.4"  class="toc">15.4</a> 
        Multiple Approaches to REST Handling </h2>
      <div  class="Unindented"> As Lift has evolved, two main approaches have
        emerged that allow you to perform RESTful operations. In Lift 1.0 and
        up, you can add custom dispatch (Розділ <a  href="#sec:Custom-dispatch-func"
 class="Reference">3.8 on page 1↑</a>) on your API URLs to call custom
        handlers for your REST data. In Lift 2.0, the new
        <tt>net.liftweb.http.rest.RestHelper</tt> was introduced
        that vastly simplifies not only the dispatch for given operations, but
        also assists with conversion of requests and responses to both XML and
        JSON. Because custom dispatch is still very much a first-class feature
        of Lift we will cover both approaches here. </div>
      <div  class="Indented"> Before we get into the details of each method,
        there are two last helpers we’d like to define. Listing <a  href="#lst:Adding-an-Extractor-expense"
 class="Reference">15.4↓</a> shows an <tt>unapply</tt>
        method that we add to our <tt>Expense</tt>
        <tt>MetaMapper</tt> so that we can use
        <tt>Expense</tt> as an extractor in pattern matching. In
        this code we not only attempt to match by using a provided
        <tt>String</tt> as the <tt>Expense</tt>’s
        primary key, but we also compute whether the
        <tt>Expense</tt> is in a public account. This assists us in
        determining authorization for viewing a given
        <tt>Expense</tt>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Adding an Extractor for Expense<a  name="lst:Adding-an-Extractor-expense"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_439252">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.ControlHelpers.tryo</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala comments">/**</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* Define an extractor that can be used to locate an Expense based</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* on its ID. Returns a tuple of the Expense and whether the</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* Expense’s account is public.</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">unapply (id </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Option[(Expense,Boolean)] </code><code  class="scala keyword">=</code> <code
 class="scala plain">tryo {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">find(By(Expense.id, id.toLong)).map { expense </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">     </code><code
 class="scala plain">(expense,</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">expense.account.obj.open</code><code  class="scala keyword">_</code><code
 class="scala plain">!.is</code><code  class="scala keyword">_</code><code  class="scala plain">public.is)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}.toOption</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">} openOr None</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Similarly, Listing <a  href="#lst:Adding-an-Extractor-account"
 class="Reference">15.4↓</a> shows an extractor on the
        <tt>Account</tt> <tt>MetaMapper</tt> that
        matches an <tt>Account</tt> based on its primary key. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Adding an Extractor for Account<a  name="lst:Adding-an-Extractor-account"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_679520">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.Helpers.tryo</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala comments">/**</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">* Define an extractor that can be used to locate an Account based</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* on its ID.</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">unapply (id </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Option[Account] </code><code  class="scala keyword">=</code> <code
 class="scala plain">tryo {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">find(By(Account.id, id.toLong)).toOption</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">} openOr None</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-15.4.1"  class="toc">15.4.1</a> 
        Using Custom Dispatch<a  name="sub:REST-Custom-Dispatch"  class="Label">
        </a> </h3>
      <div  class="Unindented"> Now that we’ve discussed our design, let’s see
        the code that will handle the routing. In the package
        <tt>com.pocketchangeapp.api</tt>, we have an object named
        <tt>DispatchRestAPI, which we’ve</tt> defined in
        <tt>src/main/scala/com/pocketchangeapp/api/RestAPI.scala</tt>.
        In <tt>DispatchRestAPI</tt>, we define a custom dispatch
        function to pattern match on the request and delegate to a handler
        method. The custom dispatch function is shown in Listing <a  href="#lst:REST-Method-Routing"
 class="Reference">15.4.1↓</a>. You can see that we use our extractors
        in the matching for both <tt>Expense</tt>s and
        <tt>Account</tt>s. We’ll cover the processing of PUTs in
        Розділ <a  href="#sec:Processing-Expense-PUTs"  class="Reference">15.5↓</a>, and the Atom processing in Розділ <a
 href="#sec:Servicing-Atom"  class="Reference">15.7↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> REST Method Routing<a  name="lst:REST-Method-Routing"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_585080">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Import our methods for converting things around</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">RestFormatters.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">dispatch</code><code  class="scala keyword">:</code> <code
 class="scala plain">LiftRules.DispatchPF </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Define our getters first</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"expense"</code><code
 class="scala plain">, Expense(expense,</code><code  class="scala keyword">_</code><code
 class="scala plain">)), </code><code  class="scala keyword">_</code><code  class="scala plain">, GetRequest) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">     </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> nodeSeqToResponse(toXML(expense)) </code><code
 class="scala comments">// default to XML</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"expense"</code><code
 class="scala plain">, Expense(expense,</code><code  class="scala keyword">_</code><code
 class="scala plain">), </code><code  class="scala string">"xml"</code><code  class="scala plain">), </code><code
 class="scala keyword">_</code><code  class="scala plain">, GetRequest) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">     </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> nodeSeqToResponse(toXML(expense))</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"expense"</code><code
 class="scala plain">, Expense(expense,</code><code  class="scala keyword">_</code><code
 class="scala plain">), </code><code  class="scala string">"json"</code><code  class="scala plain">), </code><code
 class="scala keyword">_</code><code  class="scala plain">, GetRequest) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">     </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> JsonResponse(toJSON(expense))</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"account"</code><code
 class="scala plain">, Account(account)), </code><code  class="scala keyword">_</code><code
 class="scala plain">, GetRequest) </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">     </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> AtomResponse(toAtom(account))</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Define the PUT handler for both XML and JSON MIME types</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">request </code><code
 class="scala keyword">@</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"account"</code><code
 class="scala plain">, Account(account)), </code><code  class="scala keyword">_</code><code
 class="scala plain">, PutRequest)</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">request.xml</code><code
 class="scala keyword">_</code><code  class="scala plain">? </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> addExpense(fromXML(request.xml,account),</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">                       </code><code
 class="scala plain">account,</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">                       </code><code
 class="scala plain">result </code><code  class="scala keyword">=</code><code  class="scala plain">> CreatedResponse(toXML(result), </code><code
 class="scala string">"text/xml"</code><code  class="scala plain">))</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">request </code><code
 class="scala keyword">@</code> <code  class="scala plain">Req(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"account"</code><code
 class="scala plain">, Account(account)), </code><code  class="scala keyword">_</code><code
 class="scala plain">, PutRequest)</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">request.json</code><code
 class="scala keyword">_</code><code  class="scala plain">? </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> addExpense(fromJSON(request.body,account),</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">                       </code><code
 class="scala plain">account,</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">                       </code><code
 class="scala plain">result </code><code  class="scala keyword">=</code><code  class="scala plain">> JsonResponse(toJSONExp(result), Nil, Nil, </code><code
 class="scala value">201</code><code  class="scala plain">))</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Invalid API request - route to our error handler</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Req(</code><code  class="scala string">"api"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">x </code><code  class="scala keyword">::</code> <code
 class="scala plain">Nil, </code><code  class="scala string">""</code><code  class="scala plain">, </code><code
 class="scala keyword">_</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> BadResponse() </code><code
 class="scala comments">// Everything else fails</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Our <tt>DispatchRestAPI</tt> object
        mixes in the <tt>net.liftweb.http.rest.XMLApiHelper</tt>
        trait, which includes several implicit conversions to simplify writing
        our REST API. Remember that <tt>LiftRules.DispatchPF</tt>
        must return a function <span  class="formula">() ⇒ <i>Box</i>[<i>LiftResponse</i>]</span>
        (Розділ <a  href="#sec:Custom-dispatch-func"  class="Reference">3.8 on page 1↑</a>), so we’re using the implicit
        <tt>putResponseInBox</tt> as well as explicitly calling
        <tt>nodeSeqToResponse</tt> to convert our API return values
        into the proper format. </div>
      <div  class="Indented"> The server will now service
        <tt>GET</tt> requests with the appropriate formatter
        function and will handle <tt>PUT</tt> requests with the
        <tt>addExpense</tt> method (which we’ll define later in this
        chapter). </div>
      <div  class="Indented"> We hook our new dispatch function into LiftRules
        by adding the code shown in Listing <a  href="#lst:Setting-up-REST"  class="Reference">15.4.1↓</a> to our <tt>Boot.boot</tt>
        method. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Setting up REST Dispatch<a  name="lst:Setting-up-REST"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_958451">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">LiftRules.dispatch.prepend(DispatchRestAPI.dispatch)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-15.4.2"  class="toc">15.4.2</a> 
        Using the RestHelper Trait </h3>
      <div  class="Unindented"> New in Lift 2.0 is the
        <tt>net.liftweb.http.rest.RestHelper</tt> trait. This trait
        simplifies the creation of REST APIs that support both XML and JSON. For
        our example, we’ll define the <tt>RestHelperAPI</tt> object
        in our <tt>RestAPI.scala</tt> source file. </div>
      <div  class="Indented"> Before we get into the details of actual
        processing with <tt>RestHelper</tt>, we want to point out
        some useful parts of its API. First, <tt>RestHelper</tt>
        provides a number of built-in extractors for matching not only what HTTP
        verb a given request uses, but also the format of the request (JSON or
        XML). These extractors are: </div>
      <ul>
        <li> <tt>Get</tt>, <tt>JsonGet</tt>,
          <tt>XmlGet</tt> - matches a raw GET, or a GET of the
          specified format </li>
        <li> <tt>Post</tt>, <tt>JsonPost</tt>,
          <tt>XmlPost</tt> - matches a raw POST, or a POST of the
          specified format </li>
        <li> <tt>Put</tt>, <tt>JsonPut</tt>,
          <tt>XmlPut</tt> - matches a raw PUT, or a PUT of the
          specified format </li>
        <li> <tt>Delete</tt> - matches a DELETE request </li>
        <li> <tt>JsonReq</tt> - matches a request with the Accept
          header containing “application/json”, or whose Accept header contains
          “*/*” and whose path suffix is “json” </li>
        <li> <tt>XmlReq</tt> - matches a request with the Accept
          header containing “text/xml”, or whose Accept header contains “*/*”
          and whose path suffix is “xml” </li>
      </ul>
      <div  class="Unindented"> We’ll demonstrate in the following sections how
        to use these extractors. Note that you can add additional rules for the
        <tt>JsonReq</tt> and <tt>XmlReq</tt> extractors
        by overriding the <tt><br />
        RestHelper.suplimentalJsonResponse_?</tt> and
        <tt>suplimentalXmlResponse_?</tt> (yes, those are spelled
        incorrectly) methods to perform additional tests on the request. For
        example, Listing <a  href="#lst:Using-a-Cookie-request-type"  class="Reference">15.4.2↓</a> shows how we can use the existence of a
        given header to determine whether a request is XML or JSON. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using a Cookie to Determine the Request Type<a
 name="lst:Using-a-Cookie-request-type"  class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_20179">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">suplimentalJsonResponse</code><code
 class="scala keyword">_</code><code  class="scala plain">? (in </code><code  class="scala keyword">:</code> <code
 class="scala plain">Req) </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">in.header(</code><code  class="scala string">"This-Is-A-JSON-Request"</code><code
 class="scala plain">).isDefined</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">override</code> <code
 class="scala keyword">def</code> <code  class="scala plain">suplimentalXmlResponse</code><code
 class="scala keyword">_</code><code  class="scala plain">? (in </code><code  class="scala keyword">:</code> <code
 class="scala plain">Req) </code><code  class="scala keyword">=</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">in.header(</code><code  class="scala string">"This-Is-A-XML-Request"</code><code
 class="scala plain">).isDefined</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> One important difference
            between <tt>RestHelper</tt> and our
            <tt>DispatchRestAPI</tt> examples that we want to point
            out is that <tt>RestHelper</tt> determines whether a
            request is XML or JSON based on the Accept header and/or the suffix
            of the path (e.g. <tt>/api/expense/1.xml</tt>), whereas
            our DispatchRestAPI used the last component of the path
            (<tt>/api/expense/1/xml</tt>). Either approach is valid,
            just be aware if you’re copying this example code. </div>
        </div>
      </div>
      <div  class="Indented"> Next, like the <tt>XMLApiHelper</tt>
        trait, <tt>RestHelper</tt> provides a number of implicit
        conversions to <tt>LiftResponse</tt> from a variety of
        inputs. We’re not going to cover these directly here, but we’ll point
        out where we use them in this section. </div>
      <div  class="Indented"> Similar to our
        <tt>DispatchRestAPI</tt> handler, we need to define a set of
        patterns that we can match against. Unlike
        <tt>DispatchRestAPI</tt>, however,
        <tt>RestHelper</tt> defines four
        <tt>PartialFunction</tt> methods where we can add our
        patterns: <tt>serve</tt>, <tt>serveJx</tt>,
        <tt>serveJxa</tt> and <tt>serveType</tt>. These
        functions provide increasing automation (and control) over what gets
        served when the request matches a pattern. We won’t be covering
        <tt>serveType</tt> here, since it’s essentially the
        generalized version that <tt>serve</tt>,
        <tt>serveJx</tt> and <tt>serveJxa</tt> use
        behind the scenes. </div>
      <h4  class="Subsubsection"> <a  name="toc-Subsubsection-15.4.2.1"  class="toc">15.4.2.1</a> 
        The serve Method </h4>
      <div  class="Unindented"> Let’s start with the <tt>serve</tt>
        method. This method essentially corresponds one-to-one with our
        <tt>DispatchRestAPI.dispatch</tt> method. Listing <a  href="#lst:Using-RestHelper.serve"
 class="Reference">15.4.2.1↓</a> shows how we could handle Atom
        requests, as well as requests that don’t specify a format, using
        <tt>RestHelper</tt>. Note our use of the
        <tt>RestHelper</tt> extractors to match the HTTP Verb being
        used. Also note that we’re using an implicit conversion from a Box[T] to
        a Box[LiftResponse] when an implicit function is in scope that can
        convert T into a LiftResponse. In our example,
        <tt>Full(toXML(expense))</tt> is equivalent to
        <tt>boxToResp(Full(toXML(expense)))(nodeToResp)</tt>.
        Finally, the serve method can be invoked multiple times and the
        <tt>PartialFunctions</tt> will be chained together. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using RestHelper.serve<a  name="lst:Using-RestHelper.serve"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_967007">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Service Atom and requests that don’t request a specific format</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">serve {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Default to XML</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Get(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"expense"</code><code
 class="scala plain">, Expense(expense,</code><code  class="scala keyword">_</code><code
 class="scala plain">)), </code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> Full(toXML(expense))</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Get(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"account"</code><code
 class="scala plain">, Account(account)), </code><code  class="scala keyword">_</code><code
 class="scala plain">) </code><code  class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> Full(AtomResponse(toAtom(account)))</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> We use similar calls to hook our PUT handlers,
        shown in Listing <a  href="#lst:Using-serve-to-handle-PUT"  class="Reference">15.4.2.1↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using serve to handle PUTs<a  name="lst:Using-serve-to-handle-PUT"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_929715">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Hook our PUT handlers</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">DispatchRestAPI.addExpense</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">serve {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">XmlPut(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"account"</code><code
 class="scala plain">, Account(account)), (body, request)) </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> Full(addExpense(fromXML(Full(body),account),</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">                          </code><code
 class="scala plain">account,</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">                          </code><code
 class="scala plain">result </code><code  class="scala keyword">=</code><code  class="scala plain">> CreatedResponse(toXML(result), </code><code
 class="scala string">"text/xml"</code><code  class="scala plain">)))</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">JsonPut(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"account"</code><code
 class="scala plain">, Account(account)), (</code><code  class="scala keyword">_</code><code
 class="scala plain">, request))  </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">() </code><code  class="scala keyword">=</code><code  class="scala plain">> Full(addExpense(fromJSON(request.body,account),</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">                          </code><code
 class="scala plain">account,</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">                          </code><code
 class="scala plain">result </code><code  class="scala keyword">=</code><code  class="scala plain">> JsonResponse(toJSON(result), Nil, Nil, </code><code
 class="scala value">201</code><code  class="scala plain">)))</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h4  class="Subsubsection"> <a  name="toc-Subsubsection-15.4.2.2"  class="toc">15.4.2.2</a> 
        The serveJx Method </h4>
      <div  class="Unindented"> Like the serve method,
        <tt>serveJx</tt> performs pattern matching on the request.
        However, <tt>serveJx</tt> allows you to specify a conversion
        function that matches against the requested format<br />
        (<tt>net.liftweb.http.rest.JsonSelect</tt> or
        <tt>net.liftweb.http.rest.XmlSelect</tt>) and perform your
        conversion there. Then, all you need to do is match once against a given
        path and <tt>serveJx</tt> will utilize your conversion
        function to return the proper result. Listing <a  href="#lst:Using-RestHelper.serveJx"
 class="Reference">15.4.2.2↓</a> shows how we can use a new implicit
        conversion to handle our format-specific GETs. The single match in our
        <tt>serveJx</tt> call replaces two lines in our
        <tt>DispatchRestAPI.dispatch</tt> method. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using RestHelper.serveJx<a  name="lst:Using-RestHelper.serveJx"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_806776">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Define an implicit conversion from an Expense to XML or JSON</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.http.rest.{JsonSelect,XmlSelect}</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">implicit</code> <code
 class="scala keyword">def</code> <code  class="scala plain">expenseToRestResponse </code><code
 class="scala keyword">:</code> <code  class="scala plain">JxCvtPF[Expense] </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(JsonSelect, e, </code><code
 class="scala keyword">_</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">> toJSON(e)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(XmlSelect, e, </code><code
 class="scala keyword">_</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">> toXML(e)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">serveJx {</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Get(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"expense"</code><code
 class="scala plain">, Expense(expense,</code><code  class="scala keyword">_</code><code
 class="scala plain">)), </code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">> Full(expense)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In addition to providing your own conversion
        function, <tt>serveJx</tt> can utilize the
        <tt>RestHelper</tt> autoconversion functionality. To use
        this, simply use the <tt>auto</tt> method to wrap whatever
        you want to return. Listing <a  href="#lst:Using-auto-to-convert-returns"
 class="Reference">15.4.2.2↓</a> shows an example of returning a
        contrived data object with <tt>auto</tt>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using auto to Convert Return Values<a  name="lst:Using-auto-to-convert-returns"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_187177">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Just an example of autoconversion</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">serveJx {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Get(List(</code><code
 class="scala string">"api"</code><code  class="scala plain">, </code><code  class="scala string">"greet"</code><code
 class="scala plain">, name),</code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">     </code><code
 class="scala plain">auto(Map(</code><code  class="scala string">"greeting"</code> <code
 class="scala plain">-></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">              </code><code
 class="scala plain">Map(</code><code  class="scala string">"who"</code> <code  class="scala plain">-> name,</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">                  </code><code
 class="scala string">"what"</code> <code  class="scala plain">-> (</code><code
 class="scala string">"Hello at "</code> <code  class="scala plain">+ </code><code
 class="scala keyword">new</code> <code  class="scala plain">java.util.Date))))</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The conversion is actually performed with the
        <tt>net.liftweb.json.Extraction</tt> object<a  href="#index-Extraction"
 name="entry-Extraction-0"  class="IndexReference">↓</a><a  href="#index-JSON-extraction"
 name="entry-JSON-extraction-0"  class="IndexReference">↓</a><a  href="#index-Autoconversion"
 name="entry-Autoconversion-0"  class="IndexReference">↓</a>, so you
        can autoconvert anything that <tt>Extraction</tt> can
        handle. This includes: </div>
      <ul>
        <li> Primitives </li>
        <li> Maps </li>
        <li> Arrays </li>
        <li> Collections </li>
        <li> Options </li>
        <li> Case classes </li>
      </ul>
      <h4  class="Subsubsection"> <a  name="toc-Subsubsection-15.4.2.3"  class="toc">15.4.2.3</a> 
        The serveJxa Method </h4>
      <div  class="Unindented"> The <tt>serveJxa</tt> method is
        basically the same as the <tt>serve</tt> and
        <tt>serveJx</tt> methods, except that anything that is
        returned will be automatically converted to JSON via the<br />
        <tt>net.liftweb.json.Extraction.decompose</tt> method. </div>
      <h2  class="Section"> <a  name="toc-Section-15.5"  class="toc">15.5</a> 
        Processing Expense PUTs<a  name="sec:Processing-Expense-PUTs"  class="Label">
        </a> </h2>
      <div  class="Unindented"> Now that we’re handling the API calls, we’ll
        need to write the code to process and respond to requests. The first
        thing we need to do is deserialize the <tt>Expense</tt> from
        the either an XML or JSON request. </div>
      <div  class="Indented"> In PocketChange our use of
        <tt>BigDecimal</tt> values to represent currency amounts
        means that we can’t simply use the lift-json deserialization support
        (Розділ <a  href="#sec:JSON"  class="Reference">C.10 on page 1↓</a>). While lift-json is very good
        and would make this much simpler, it parses decimal values as doubles
        which can lead to rounding and precision issues when working with
        decimal values. Instead, we will need to write our own conversion
        functions. </div>
      <div  class="Indented"> To simplify error handling, we break this
        processing up into two format-specific methods that convert to a
        <tt>Map</tt> representation of the data, and another method
        that converts the intermediate
        <tt>Map</tt>/<tt>List</tt> into an
        <tt>Expense</tt>. Listing <a  href="#lst:Deserializing-XML-to-Expense"  class="Reference">15.5↓</a> shows the <tt>fromXML</tt>
        method in the <tt>RestFormatters</tt> object. This method
        performs some basic validation to make sure we have the required
        parameters, but otherwise doesn’t validate the values of those
        parameters. Note that we provide the <tt>Account</tt> to
        <tt>fromXML</tt> so that we can resolve tag names in the
        <tt>fromMap</tt> method (which we’ll cover momentarily). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Deserializing XML to an Expense<a  name="lst:Deserializing-XML-to-Expense"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_794406">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">fromXML (rootNode </code><code  class="scala keyword">:</code> <code
 class="scala plain">Box[Elem], account </code><code  class="scala keyword">:</code> <code
 class="scala plain">Account) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Box[Expense] </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">rootNode </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(<expense>{parameters </code><code
 class="scala keyword">@</code> <code  class="scala keyword">_</code><code  class="scala plain">*}</expense>) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">var</code> <code  class="scala plain">data </code><code  class="scala keyword">=</code> <code
 class="scala plain">Map[String,String]()</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">for</code><code  class="scala plain">(parame>er <<- parameters) {</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">parameter </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain"><date>{date}</date> </code><code
 class="scala keyword">=</code><code  class="scala plain">> data +</code><code  class="scala keyword">=</code> <code
 class="scala string">"date"</code> <code  class="scala plain">-> date.text</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain"><description>{description}</description> </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">data +</code><code  class="scala keyword">=</code> <code  class="scala string">"description"</code> <code
 class="scala plain">-> description.text</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain"><amount>{amount}</amount> </code><code
 class="scala keyword">=</code><code  class="scala plain">> data +</code><code  class="scala keyword">=</code> <code
 class="scala string">"amount"</code> <code  class="scala plain">-> amount.text</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala plain"><tags>{ tags }</tags> </code><code
 class="scala keyword">=</code><code  class="scala plain">> data +</code><code  class="scala keyword">=</code> <code
 class="scala string">"tags"</code> <code  class="scala plain">-> tags.text</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala comments">// Ignore (could be whitespace)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">fromMap(data, account)</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">other </code><code
 class="scala keyword">=</code><code  class="scala plain">> Failure(</code><code
 class="scala string">"Missing root expense element"</code><code  class="scala plain">)</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Similarly, Listing <a  href="#lst:Deserializing-JSON-to-Expense"
 class="Reference">15.5↓</a> shows our <tt>fromJSON</tt>
        method. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Deserializing JSON to an Expense<a  name="lst:Deserializing-JSON-to-Expense"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_138955">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">fromJSON (obj </code><code  class="scala keyword">:</code> <code
 class="scala plain">Box[Array[Byte]], account </code><code  class="scala keyword">:</code> <code
 class="scala plain">Account) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Box[Expense] </code><code  class="scala keyword">=</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">obj </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(rawBytes) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">// We use the Scala util JSON parser here because we want to avoid parsing</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// numeric values into doubles. We’ll just leave them as Strings</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">import</code> <code  class="scala plain">scala.util.parsing.json.JSON</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">JSON.perThreadNumberParser </code><code  class="scala keyword">=</code> <code
 class="scala plain">{ in </code><code  class="scala keyword">:</code> <code  class="scala plain">String </code><code
 class="scala keyword">=</code><code  class="scala plain">> in }</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">contents </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">String(rawBytes, </code><code
 class="scala string">"UTF-8"</code><code  class="scala plain">)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">JSON.parseFull(contents) </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Some(data </code><code
 class="scala keyword">:</code> <code  class="scala plain">Map[String,Any]) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">fromMap(data.mapElements(</code><code  class="scala keyword">_</code><code
 class="scala plain">.toString), account)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">other </code><code
 class="scala keyword">=</code><code  class="scala plain">> Failure(</code><code
 class="scala string">"Invalid JSON submitted: \"%s\""</code><code  class="scala plain">.format(contents))</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> Failure(</code><code  class="scala string">"Empty body submitted"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Finally, Listing <a  href="#lst:Converting-the-Intermediate-Expense"
 class="Reference">15.5↓</a> shows our <tt>fromMap</tt>
        method, which takes the data parsed by <tt>fromJSON</tt> and
        <tt>fromXML</tt> and converts it into an actual expense. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Converting the Intermediate Data to an Expense<a
 name="lst:Converting-the-Intermediate-Expense"  class="Label"> </a>
          </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_424547">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">fromMap (data </code><code  class="scala keyword">:</code> <code
 class="scala plain">scala.collection.Map[String,String],</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">             </code><code
 class="scala plain">account </code><code  class="scala keyword">:</code> <code
 class="scala plain">Account) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Box[Expense] </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">expense </code><code
 class="scala keyword">=</code> <code  class="scala plain">Expense.create</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">try</code> <code  class="scala plain">{</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">fieldParsers </code><code
 class="scala keyword">:</code> <code  class="scala plain">List[(String, String </code><code
 class="scala keyword">=</code><code  class="scala plain">> Expense)] </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">(</code><code  class="scala string">"date"</code><code  class="scala plain">, (date </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">=</code><code  class="scala plain">> expense.dateOf(timestamp.parse(date))) </code><code
 class="scala keyword">::</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">(</code><code  class="scala string">"description"</code><code
 class="scala plain">, (desc </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">=</code><code  class="scala plain">> expense.description(desc)) </code><code
 class="scala keyword">::</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">(</code><code  class="scala string">"amount"</code><code  class="scala plain">, (amount </code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">=</code><code  class="scala plain">> expense.amount(BigDecimal(amount))) </code><code
 class="scala keyword">::</code> <code  class="scala plain">Nil</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">missing </code><code
 class="scala keyword">=</code> <code  class="scala plain">fieldParsers.flatMap {</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">field </code><code  class="scala keyword">=</code><code  class="scala plain">> </code><code
 class="scala comments">// We invert the flatMap here to only give us missing values</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">if</code> <code  class="scala plain">(data.get(field.</code><code
 class="scala keyword">_</code><code  class="scala value">1</code><code  class="scala plain">).map(field.</code><code
 class="scala keyword">_</code><code  class="scala value">2</code><code  class="scala plain">).isDefined) None </code><code
 class="scala keyword">else</code> <code  class="scala plain">Some(field.</code><code
 class="scala keyword">_</code><code  class="scala value">1</code><code  class="scala plain">)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces"> </code> </div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">(missing.isEmpty) {</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">expense.account(account)</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">data.get(</code><code  class="scala string">"tags"</code><code
 class="scala plain">).foreach {</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">tags </code><code  class="scala keyword">=</code><code  class="scala plain">> expense.tags(tags.split(</code><code
 class="scala string">","</code><code  class="scala plain">).map(Tag.byName(account.id.is,</code><code
 class="scala keyword">_</code><code  class="scala plain">)).toList)</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Full(expense)</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Failure(missing.mkString(</code><code  class="scala string">"Invalid expense. Missing: "</code><code
 class="scala plain">, </code><code  class="scala string">","</code><code  class="scala plain">, </code><code
 class="scala string">""</code><code  class="scala plain">))</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">} </code><code  class="scala keyword">catch</code> <code  class="scala plain">{</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">pe </code><code  class="scala keyword">:</code> <code
 class="scala plain">java.text.ParseException </code><code  class="scala keyword">=</code><code
 class="scala plain">> Failure(</code><code  class="scala string">"Failed to parse date"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">nfe </code><code  class="scala keyword">:</code> <code
 class="scala plain">java.lang.NumberFormatException </code><code  class="scala keyword">=</code><code
 class="scala plain">></code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">Failure(</code><code  class="scala string">"Failed to parse amount"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now that we’ve converted the PUT data into an
        <tt>Expense</tt>, we need to actually perform our logic and
        persist the submitted <tt>Expense</tt>. Listing <a  href="#lst:Saving-the-submitted-Expense"
 class="Reference">15.5↓</a> shows our <tt>addExpense</tt>
        method, which matches against the parsed <tt>Expense</tt>
        and either runs validation if the parse succeeded, or returns an error
        response to the user if something failed. If validation fails, the user
        is similarly notified. The <tt>success</tt> parameter is a
        function that can be used to generate the appropriate response based on
        the newly created Expense. This allows us to return the new Expense in
        the same format (JSON, XML) in which it was submitted (see the dispatch
        function, Listing <a  href="#lst:REST-Method-Routing"  class="Reference">15.4.1↑</a>). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Saving the submitted Expense<a  name="lst:Saving-the-submitted-Expense"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_589775">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">addExpense(parsedExpense </code><code  class="scala keyword">:</code> <code
 class="scala plain">Box[Expense],</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">               </code><code
 class="scala plain">account </code><code  class="scala keyword">:</code> <code
 class="scala plain">Account,</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">               </code><code
 class="scala plain">success </code><code  class="scala keyword">:</code> <code
 class="scala plain">Expense </code><code  class="scala keyword">=</code><code  class="scala plain">> LiftResponse)</code><code
 class="scala keyword">:</code> <code  class="scala plain">LiftResponse </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">parsedExpense </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(expense) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">(entrySerial,entryBalance) </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Expense.getLastExpenseData(account, expense.dateOf)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">expense.account(account).serialNumber(entrySerial + </code><code
 class="scala value">1</code><code  class="scala plain">).</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">currentBalance(entryBalance + expense.amount)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">expense.validate </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Nil </code><code  class="scala keyword">=</code><code
 class="scala plain">> {</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">Expense.updateEntries(entrySerial + </code><code  class="scala value">1</code><code
 class="scala plain">, expense.amount.is)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">expense.save</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">account.balance(account.balance.is + expense.amount.is).save</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">success(expense)</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">errors </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">val</code> <code  class="scala plain">message </code><code
 class="scala keyword">=</code> <code  class="scala plain">errors.mkString(</code><code
 class="scala string">"Validation failed:"</code><code  class="scala plain">, </code><code
 class="scala string">","</code><code  class="scala plain">,</code><code  class="scala string">""</code><code
 class="scala plain">)</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">logger.error(message)</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">ResponseWithReason(BadResponse(), message)</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Failure(msg, </code><code
 class="scala keyword">_</code><code  class="scala plain">, </code><code  class="scala keyword">_</code><code
 class="scala plain">) </code><code  class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">logger.error(msg)</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">ResponseWithReason(BadResponse(), msg)</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">error </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">logger.error(</code><code  class="scala string">"Parsed expense as : "</code> <code
 class="scala plain">+ error)</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">BadResponse()</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-15.6"  class="toc">15.6</a> 
        The Request and Response Cycles for Our API </h2>
      <div  class="Unindented"> At the beginning of this chapter, we showed you
        a request and response conversation for <tt><br />
        http://demo.liftweb.net/</tt>. Let’s see what that looks like for
        a request to our API. Listing <a  href="#lst:Request-and-Response-GET"  class="Reference">15.6↓</a> shows an XML GET request for a given
        expense. Note that we’re not showing the HTTP Basic authentication
        setup, required by our authentication configuration (Розділ <a  href="#sub:HTTP-Authentication"
 class="Reference">9.9 on page 1↑</a>). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Request and Response for XML GET<a  name="lst:Request-and-Response-GET"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_624026">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">Request</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">http</code><code
 class="scala keyword">:</code><code  class="scala comments">//www.pocketchangeapp.com/api/expense/3 GET</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">Response</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain"><?xml version</code><code
 class="scala keyword">=</code><code  class="scala string">"1.0"</code> <code  class="scala plain">encoding</code><code
 class="scala keyword">=</code><code  class="scala string">"UTF-8"</code><code  class="scala plain">?></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain"><expense></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><id>http</code><code  class="scala keyword">:</code><code  class="scala comments">//www.pocketchangeapp.com/api/expense/3</id></code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><accountname>Test</accountname></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><accountid></code><code  class="scala value">1</code><code
 class="scala plain"></accountid></code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><date></code><code  class="scala value">2010</code><code  class="scala plain">-</code><code
 class="scala value">10</code><code  class="scala plain">-</code><code  class="scala value">06</code><code
 class="scala plain">T</code><code  class="scala value">00</code><code  class="scala keyword">:</code><code
 class="scala value">00</code><code  class="scala keyword">:</code><code  class="scala value">00</code><code
 class="scala plain">Z</date></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><description>Receipt test</description></code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><amount></code><code  class="scala value">12.00</code><code
 class="scala plain"></amount></code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><tags>test,receipt</tags></code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain"></expense></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Listing <a  href="#lst:Request-and-Response-GET-JSON"
 class="Reference">15.6↓</a> shows the same request in JSON format. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Request and Response for JSON GET<a  name="lst:Request-and-Response-GET-JSON"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_304826">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">Request</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">http</code><code
 class="scala keyword">:</code><code  class="scala comments">//www.pocketchangeapp.com/api/expense/3/json GET</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">Response</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">{</code><code
 class="scala string">"id"</code><code  class="scala keyword">:</code><code  class="scala string">"<a
 href="http://www.pocketchangeapp.com/api/expense/3">http://www.pocketchangeapp.com/api/expense/3</a>"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces"> </code><code
 class="scala string">"date"</code><code  class="scala keyword">:</code><code  class="scala string">"2010-10-06T00:00:00Z"</code><code
 class="scala plain">,</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces"> </code><code
 class="scala string">"description"</code><code  class="scala keyword">:</code><code
 class="scala string">"Receipt test"</code><code  class="scala plain">,</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces"> </code><code
 class="scala string">"accountname"</code><code  class="scala keyword">:</code><code
 class="scala string">"Test"</code><code  class="scala plain">,</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces"> </code><code
 class="scala string">"accountid"</code><code  class="scala keyword">:</code><code
 class="scala value">1</code><code  class="scala plain">,</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces"> </code><code
 class="scala string">"amount"</code><code  class="scala keyword">:</code><code
 class="scala string">"12.00"</code><code  class="scala plain">,</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces"> </code><code
 class="scala string">"tags"</code><code  class="scala keyword">:</code><code  class="scala string">"test,receipt"</code><code
 class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Listing <a  href="#lst:Request-and-Response-PUT"  class="Reference">15.6↓</a> shows the output for a PUT conversation:
      </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Request and Response for an XML PUT<a  name="lst:Request-and-Response-PUT"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_163346">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">Request</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">http</code><code
 class="scala keyword">:</code><code  class="scala comments">//www.pocketchangeapp.com/api/account/1 - PUT - addEntry(request) + XML Body</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">Request Body</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain"><expense></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><date></code><code  class="scala value">2010</code><code  class="scala plain">-</code><code
 class="scala value">07</code><code  class="scala plain">-</code><code  class="scala value">05</code><code
 class="scala plain">T</code><code  class="scala value">14</code><code  class="scala keyword">:</code><code
 class="scala value">22</code><code  class="scala keyword">:</code><code  class="scala value">00</code><code
 class="scala plain">Z</date></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><description>Test</description></code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><amount></code><code  class="scala value">12.41</code><code
 class="scala plain"></amount></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><tags>test,api</tags></code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain"></expense></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">Response</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain"><?xml version</code><code
 class="scala keyword">=</code><code  class="scala string">"1.0"</code> <code  class="scala plain">encoding</code><code
 class="scala keyword">=</code><code  class="scala string">"UTF-8"</code><code  class="scala plain">?></code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain"><expense></code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><id>http</code><code  class="scala keyword">:</code>
                          <code  class="scala comments">//www.pocketchangeapp.com/api/expense/10</id></code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><accountname>Test</accountname></code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><accountid></code><code  class="scala value">1</code><code
 class="scala plain"></accountid></code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><date></code><code  class="scala value">2010</code><code  class="scala plain">-</code><code
 class="scala value">07</code><code  class="scala plain">-</code><code  class="scala value">05</code><code
 class="scala plain">T</code><code  class="scala value">14</code><code  class="scala keyword">:</code><code
 class="scala value">22</code><code  class="scala keyword">:</code><code  class="scala value">00</code><code
 class="scala plain">Z</date></code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><description>Test</description></code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><amount></code><code  class="scala value">12.41</code><code
 class="scala plain"></amount></code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><tags>api,test</tags></code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala plain"></expense>   </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-15.7"  class="toc">15.7</a> 
        Extending the API to Return Atom Feeds<a  name="sec:Servicing-Atom"  class="Label">
        </a> </h2>
      <div  class="Unindented"> In addition to being able to fetch specific
        expenses using our API, it would be nice to be able to provide a feed of
        expenses for an account as they’re added. For this example, we’ll add
        support for Atom<span  class="FootOuter"><span  class="SupFootMarker"> 
            [V] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [V] </span><a  href="http://tools.ietf.org/html/rfc4287"  class="FlexURL">http://tools.ietf.org/html/rfc4287</a></span></span>,
        a simple publishing standard for content syndication. The first thing we
        need to do is write a method to generate an Atom feed for a given
        Account. Although Atom is XML-based, it’s sufficiently different enough
        from our REST API XML format that we’ll just write new methods for it.
        Listing <a  href="#lst:The-toAtom-Method"  class="Reference">15.7↓</a> shows the <tt>toAtom</tt>
        methods (one for <tt>Account</tt>, one for
        <tt>Expense</tt>) in our <tt>RestFormatters</tt>
        object that will handle the formatting. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> The toAtom Methods<a  name="lst:The-toAtom-Method"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_200289">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">toAtom (a </code><code  class="scala keyword">:</code> <code
 class="scala plain">Account) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Elem </code><code  class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">entries </code><code
 class="scala keyword">=</code> <code  class="scala plain">Expense.getByAcct(a,Empty,Empty,Empty,MaxRows(</code><code
 class="scala value">10</code><code  class="scala plain">))</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><feed xmlns</code><code  class="scala keyword">=</code><code
 class="scala string">"<a  href="http://www.w3.org/2005/Atom">http://www.w3.org/2005/Atom</a>"</code><code
 class="scala plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><title>{a.name}</title></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><id>urn</code><code  class="scala keyword">:</code><code  class="scala plain">uuid</code><code
 class="scala keyword">:</code><code  class="scala plain">{a.id.is}</id></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><updated>{entries.headOption.map(restTimestamp) getOrElse</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">              </code><code
 class="scala plain">timestamp.format(</code><code  class="scala keyword">new</code> <code
 class="scala plain">java.util.Date)}</updated></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">{ entries.flatMap(toAtom) }</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"></feed></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">toAtom (e </code><code  class="scala keyword">:</code> <code
 class="scala plain">Expense) </code><code  class="scala keyword">:</code> <code
 class="scala plain">Elem </code><code  class="scala keyword">=</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><entry></code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><id>urn</code><code  class="scala keyword">:</code><code  class="scala plain">uuid</code><code
 class="scala keyword">:</code><code  class="scala plain">{restId(e)}</id></code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><title>{e.description.is}</title></code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"><updated>{restTimestamp(e)}</updated></code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala plain"><content </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"xhtml"</code><code  class="scala plain">></code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">      </code><code
 class="scala plain"><div xmlns</code><code  class="scala keyword">=</code><code
 class="scala string">"<a  href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>"</code><code
 class="scala plain">></code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">        </code><code
 class="scala plain"><table></code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">          </code><code
 class="scala plain"><tr><th>Amount</th><th>Tags</th><th>Receipt</th></tr></code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">          </code><code
 class="scala plain"><tr><td>{e.amount.is.toString}</td></code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">              </code><code
 class="scala plain"><td>{e.tags.map(</code><code  class="scala keyword">_</code><code
 class="scala plain">.name.is).mkString(</code><code  class="scala string">", "</code><code
 class="scala plain">)}</td></code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">              </code><code
 class="scala plain"><td>{</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">                 </code><code
 class="scala keyword">if</code> <code  class="scala plain">(e.receipt.is ne </code><code
 class="scala keyword">null</code><code  class="scala plain">) {</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">                   </code><code
 class="scala plain"><img src</code><code  class="scala keyword">=</code><code  class="scala plain">{</code><code
 class="scala string">"/image/"</code> <code  class="scala plain">+ e.id} /></code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">                 </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">Text(</code><code
 class="scala string">"None"</code><code  class="scala plain">)</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">               </code><code
 class="scala plain">}</td></tr></code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">        </code><code
 class="scala plain"></table></code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"></div></code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"></content></code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"></entry></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now that we have the format, we simply hook into
        our dispatch method to match a GET request on a URL like: </div>
      <pre  class="LyX-Code">http://www.pocketchangeapp.com/api/account/<accound ID>
</pre>
      <div  class="Unindented"> Refer to Listing <a  href="#lst:REST-Method-Routing"
 class="Reference">15.4.1↑</a> again to see this match. </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-15.7.1"  class="toc">15.7.1</a> 
        An Example Atom Request </h3>
      <div  class="Unindented"> An example Atom reqeust/response cycle for a
        test account is shown in Listing <a  href="#lst:An-Example-Atom-req-resp"
 class="Reference">15.7.1↓</a>. We’ve cut off the entries here for
        brevity. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> An Example Atom Request and Response<a  name="lst:An-Example-Atom-req-resp"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_217120">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">Request</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">http</code><code
 class="scala keyword">:</code><code  class="scala comments">//www.pocketchangeapp.com/api/account/1</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">Response</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain"><feed xmlns</code><code
 class="scala keyword">=</code><code  class="scala string">"<a  href="http://www.w3.org/2005/Atom">http://www.w3.org/2005/Atom</a>"</code><code
 class="scala plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><title>Test</title></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><id>urn</code><code  class="scala keyword">:</code><code  class="scala plain">uuid</code><code
 class="scala keyword">:</code><code  class="scala value">1</code><code  class="scala plain"></id></code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><updated></code><code  class="scala value">2010</code><code
 class="scala plain">-</code><code  class="scala value">10</code><code  class="scala plain">-</code><code
 class="scala value">06</code><code  class="scala plain">T</code><code  class="scala value">00</code><code
 class="scala keyword">:</code><code  class="scala value">00</code><code  class="scala keyword">:</code><code
 class="scala value">00</code><code  class="scala plain">Z</updated></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><entry></code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><id>urn</code><code  class="scala keyword">:</code><code  class="scala plain">uuid</code><code
 class="scala keyword">:</code><code  class="scala plain">http</code><code  class="scala keyword">:</code><code
 class="scala comments">//www.pocketchangeapp.com/api/expense/3</id></code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala plain"><title>Receipt test</title></code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"><updated></code><code  class="scala value">2010</code><code
 class="scala plain">-</code><code  class="scala value">10</code><code  class="scala plain">-</code><code
 class="scala value">06</code><code  class="scala plain">T</code><code  class="scala value">00</code><code
 class="scala keyword">:</code><code  class="scala value">00</code><code  class="scala keyword">:</code><code
 class="scala value">00</code><code  class="scala plain">Z</updated></code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">      </code><code
 class="scala plain"><content </code><code  class="scala keyword">type</code><code
 class="scala keyword">=</code><code  class="scala string">"xhtml"</code><code  class="scala plain">></code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">        </code><code
 class="scala plain"><div xmlns</code><code  class="scala keyword">=</code><code
 class="scala string">"<a  href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>"</code><code
 class="scala plain">></code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">          </code><code
 class="scala plain"><table></code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">          </code><code
 class="scala plain"><tr><th>Amount</th><th>Tags</th><th>Receipt</th></tr></code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">          </code><code
 class="scala plain"><tr><td></code><code  class="scala value">12.00</code><code
 class="scala plain"></td></code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">              </code><code
 class="scala plain"><td>test, receipt</td></code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">              </code><code
 class="scala plain"><td><img src</code><code  class="scala keyword">=</code><code
 class="scala string">"/image/3"</code> <code  class="scala plain">/></td></tr></code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">          </code><code
 class="scala plain"></table></code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">        </code><code
 class="scala plain"></div></code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">      </code><code
 class="scala plain"></content></code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">    </code><code
 class="scala plain"></entry></code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-15.7.2"  class="toc">15.7.2</a> 
        Add a feed tag for the account page </h3>
      <div  class="Unindented"> As an extra nicety, we want to add an
        appropriate Atom <tt><link/></tt> tag to our Account
        view page so that people can easily subscribe to the feed from their
        browser. We do this by making two modifications to our template and
        snippet code. Listing <a  href="#lst:Adding-a-link-viewAcct"  class="Reference">15.7.2↓</a> shows how we insert a new binding point
        in our <tt>viewAcct.html</tt> template to place the new link
        in the page head section. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Adding a binding to viewAcct.html<a  name="lst:Adding-a-link-viewAcct"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_680206">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain">...</code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">lift:Accounts.detail</code> <code  class="xml color1">eager_eval</code><code
 class="xml plain">=</code><code  class="xml string">"true"</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">head</code><code  class="xml plain">><</code><code
 class="xml keyword">acct:atomLink</code> <code  class="xml plain">/></</code><code
 class="xml keyword">head</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain">...</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Listing <a  href="#lst:Binding-the-Atom-link"  class="Reference">15.7.2↓</a> shows how we generate a new Atom link
        based on the current <tt>Account</tt>’s id that points to
        the proper URL for our API. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Binding the Atom link<a  name="lst:Binding-the-Atom-link"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_904181">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">bind(</code><code
 class="scala string">"acct"</code><code  class="scala plain">, xhtml,</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">     </code><code
 class="scala string">"atomLink"</code> <code  class="scala plain">-> <link href</code><code
 class="scala keyword">=</code><code  class="scala plain">{</code><code  class="scala string">"/api/account/"</code> <code
 class="scala plain">+ acct.id} </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">                      </code><code
 class="scala keyword">type</code><code  class="scala keyword">=</code><code  class="scala string">"application/atom+xml"</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">                      </code><code
 class="scala plain">rel</code><code  class="scala keyword">=</code><code  class="scala string">"alternate"</code> <code
 class="scala plain">title</code><code  class="scala keyword">=</code><code  class="scala plain">{acct.name + </code><code
 class="scala string">" feed"</code><code  class="scala plain">} />,</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">     </code><code
 class="scala string">"name"</code> <code  class="scala plain">-> acct.name.asHtml,</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">     </code><code
 class="scala plain">...</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-15.8"  class="toc">15.8</a> 
        Conclusion </h2>
      <div  class="Unindented"> In this chapter, we outlined a RESTful API for a
        web application and showed how to implement one using Lift. We then
        extended that API to return Atom in addition to XML and JSON. </div>
      <h1  class="Part"> <a  name="toc-Part-III"  class="toc">Part III.</a> 
        Appendices </h1>
      <div  class="Unindented"> </div>
      <h1  class="Chapter"> <a  name="toc-Appendix-A"  class="toc">A</a> A
        Brief Tour of Maven<a  href="#index-Maven"  name="entry-Maven-1"  class="IndexReference">↓</a><a
 name="cha:Maven"  class="Label"> </a> </h1>
      <div  class="Unindented"> In this chapter we’ll discuss the Maven build
        tool and some of the basics of configuration and usage. Maven is what
        Lift uses for build management, so becoming acquainted with Maven is
        important to getting the most out of Lift. If you’re already familiar
        with Maven you can safely skip this chapter. </div>
      <h2  class="Section"> <a  name="toc-Section-A.1"  class="toc">A.1</a> 
        What is Maven? </h2>
      <div  class="Unindented"> Maven is a project management tool, as opposed
        to simply a build tool. The Maven site<span  class="FootOuter"><span  class="SupFootMarker"> 
            [W]  </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [W] </span><a  href="http://maven.apache.org/"  class="URL">http://maven.apache.org/</a></span></span>
        describes the goals of Maven as: </div>
      <ul>
        <li> Make the build process easy </li>
        <li> Provide a uniform build system </li>
        <li> Provide quality project information </li>
        <li> Provide guidelines for best practices </li>
        <li> Allow transparent migration to new features </li>
      </ul>
      <div  class="Unindented"> As a project management tool, Maven goes beyond
        just controlling compilation of your code. By default, Maven comes
        equipped not only to perform development-centric tasks, but it can
        generate documentation from your code and for your project website.
        Everything in Maven is controlled via the pom.xml (Project Object Model)
        file, which contains both information and configuration details on the
        project. We’ll be covering some of the basic aspects of the POM through
        the rest of this chapter<span  class="FootOuter"><span  class="SupFootMarker"> 
            [X] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [X] </span>A complete POM reference is available at <a  href="http://maven.apache.org/pom.html"
 class="URL">http://maven.apache.org/pom.html</a></span></span>. </div>
      <h2  class="Section"> <a  name="toc-Section-A.2"  class="toc">A.2</a> 
        Lifecycles, Phases and Goals </h2>
      <div  class="Unindented"> Maven is designed around the concept of project
        lifecycles. While you can define your own, there are three built-in
        lifecycles: <tt>default, clean</tt> and
        <tt>site.</tt> The <tt>default</tt> lifecycle
        builds and deploys your project. The <tt>clean</tt>
        lifecycle cleans (deletes) compiled objects or anything else that needs
        to be removed or reset to get the project to a pristine pre-build state.
        Finally, the <tt>site</tt> lifecycle generates the project
        documentation. </div>
      <div  class="Indented"> Within each lifecycle there are a number of phases
        that define various points in the development process. The most
        interesting lifecycle (from the perspective of writing code) is
        <tt>default</tt>. The most commonly used phases in the
        default lifecycle are<span  class="FootOuter"><span  class="SupFootMarker"> 
            [Y] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [Y] </span>A full listing of lifecycles and their phases is at <a
 href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html"
 class="URL">http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html</a></span></span>:
      </div>
      <ul>
        <li> <tt>compile</tt> - compiles the main source code of the
          project </li>
        <li> <tt>test</tt> - tests the main code using a suitable
          unit testing framework. These tests should not require that the code
          is packaged or deployed. This phase implicitly calls the testCompile
          goal to compile the test case source code </li>
        <li> <tt>package</tt> - packages the compiled code into its
          distributable format, such as a JAR. The POM controls how a project is
          packaged through the <tt><packaging/></tt> element </li>
        <li> <tt>install</tt> - installs the package into the local
          repository (see section <a  href="#sec:Repositories"  class="Reference">A.3↓</a>), for use as a dependency in other
          projects locally </li>
        <li> <tt>deploy</tt> - used in an integration or release
          environment. Copies the final package to the remote repository for
          sharing with other developers and projects. </li>
      </ul>
      <div  class="Unindented"> Maven is typically run from the command line<span
 class="FootOuter"><span  class="SupFootMarker"> [Z] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [Z] </span>There are IDE plugins for
            Maven for most major IDEs as well</span></span> by executing command
        “<tt>mvn <phase></tt>”, where
        <tt><phase></tt> is one of the phases listed above.
        Since phases are defined in order, all phases up to the one you specify
        will be run. For example, if you want to package your code, simply run
        “<tt>mvn package</tt>” and the <tt>compile</tt>
        and <tt>test</tt> phases will automatically be run. You can
        also execute specific goals for the various plugins that Maven uses.
        Execution of a specific goal is done with the command “<tt>mvn
        <plugin>:<goal></tt>”. For instance, the compile phase
        actually calls the <tt>compiler:compile</tt> goal by
        default. A common usage of executing a goal for Lift is the
        <tt>jetty:run</tt> goal, which compiles all of your code and
        then runs an instance of the Jetty<span  class="FootOuter"><span  class="SupFootMarker"> 
            [A] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [A] </span><a  href="http://www.mortbay.org/jetty/"  class="URL">http://www.mortbay.org/jetty/</a></span></span>
        web server so that you can exercise your app. The jetty plugin is not
        directly bound to any lifecycle or phase, so we have to execute the goal
        directly. </div>
      <div  class="Indented"> One final note is that you can specify multiple
        phases/goals in one command line, and Maven will execute them in order.
        This is useful, for instance, if you want to do a clean build of your
        project. Simply run “<tt>mvn clean jetty:run</tt>” and the
        <tt>clean</tt> lifecycle will run, followed by the
        <tt>jetty:run</tt> goal (and all of the prerequisites for
        jetty:run, such as compile). </div>
      <h2  class="Section"> <a  name="toc-Section-A.3"  class="toc">A.3</a> 
        Repositories<a  name="sec:Repositories"  class="Label"> </a> </h2>
      <div  class="Unindented"> Repositories are one of the key features of
        Maven. A repository is a location that contains plugins and packages for
        your project to use. There are two types of repository: local and
        remote. Your local repository is, as the name suggests, local to your
        machine, and represents a cache of artifacts downloaded from remote
        repositories as well as packages that you’ve installed from your own
        projects. The default locations of your local repo will be: </div>
      <ul>
        <li> Unix: <tt>~/.m2/repository</tt> </li>
        <li> Windows: <tt>C:\Documents and
          Settings\<user>\.m2\repository</tt> </li>
      </ul>
      <div  class="Unindented"> You can override the local repository location
        by setting the M2_REPO environment variable, or by editing the
        <home>/.m2/settings.xml file<span  class="FootOuter"><span  class="SupFootMarker"> 
            [B] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [B] </span>Details on customizing your Maven installation are
            available at <a  href="http://maven.apache.org/settings.html"  class="URL">http://maven.apache.org/settings.html</a></span></span>.
      </div>
      <div  class="Indented"> Remote repositories are repositories that are
        reachable via protocols like http and ftp and are generally where you
        will find the dependencies needed for your projects. Repositories are
        defined in the POM; listing <a  href="#sec:Repositories"  class="Reference">A.3↑</a> shows the definition of the
        scala-tools.org release repository where Lift is found<span  class="FootOuter"><span
 class="SupFootMarker"> [C] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [C] </span>scala-tools.org also has a snapshots repository where
            nightly builds of the scala-tools projects are kept</span></span>.
        Maven has an internal default set of repositories so usually you don’t
        need to define too many extra repos. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Defining a repository<a  name="lst:Defining-a-repository"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_458851">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">repositories</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">repository</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">id</code><code  class="xml plain">>scala-tools.org</</code><code
 class="xml keyword">id</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">name</code><code  class="xml plain">>Scala Tools Maven2 Repository</</code><code
 class="xml keyword">name</code><code  class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">url</code><code  class="xml plain">><a
 href="http://scala-tools.org/repo-releases">http://scala-tools.org/repo-releases</a></</code><code
 class="xml keyword">url</code><code  class="xml plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">repository</code><code  class="xml plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml plain"></</code><code
 class="xml keyword">repositories</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As a final note, sometimes you may not have net
        access or the remote repos will be offline for some reason. In this
        case, make sure to specify the “-o” (offline) flag so that Maven skips
        checking the remote repos. </div>
      <h2  class="Section"> <a  name="toc-Section-A.4"  class="toc">A.4</a> 
        Plugins </h2>
      <div  class="Unindented"> Plugins add functionality to the Maven build
        system. Lift is written in Scala, so the first plugin that we need to
        add is the Maven Scala Plugin; this adds the ability to compile Scala
        code in your project. Listing <a  href="#lst:Configuring-the-Maven-scala"
 class="Reference">A.4↓</a> shows how we configure the plugin in the
        pom.xml file for a Lift application. You can see the Scala plugin adds a
        <tt>compile</tt> and <tt>testCompile</tt> goal
        for the build phase, which makes Maven execute this plugin when those
        goals are called (explicitly or implicitly). In addition, the
        configuration element allows you to set properties of the plugin
        executions; in this case, we’re explicitly specifying the version of
        Scala that should be used for compilation. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Configuring the Maven Scala Plugin<a  name="lst:Configuring-the-Maven-scala"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_260993">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">plugin</code><code  class="xml plain">>         </code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">groupId</code><code  class="xml plain">>org.scala-tools</</code><code
 class="xml keyword">groupId</code><code  class="xml plain">>         </code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">artifactId</code><code  class="xml plain">>maven-scala-plugin</</code><code
 class="xml keyword">artifactId</code><code  class="xml plain">>         </code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">executions</code><code  class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">execution</code><code  class="xml plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">goals</code><code  class="xml plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">        </code><code
 class="xml plain"><</code><code  class="xml keyword">goal</code><code  class="xml plain">>compile</</code><code
 class="xml keyword">goal</code><code  class="xml plain">>               </code></div>
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">        </code><code
 class="xml plain"><</code><code  class="xml keyword">goal</code><code  class="xml plain">>testCompile</</code><code
 class="xml keyword">goal</code><code  class="xml plain">>             </code></div>
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"></</code><code  class="xml keyword">goals</code><code  class="xml plain">>           </code></div>
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">execution</code><code  class="xml plain">>         </code></div>
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">executions</code><code  class="xml plain">>         </code></div>
                        <div  class="line number12 index11 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">configuration</code><code
 class="xml plain">>           </code></div>
                        <div  class="line number13 index12 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">scalaVersion</code><code  class="xml plain">>${scala.version}</</code><code
 class="xml keyword">scalaVersion</code><code  class="xml plain">>         </code></div>
                        <div  class="line number14 index13 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">configuration</code><code
 class="xml plain">>       </code></div>
                        <div  class="line number15 index14 alt2"><code  class="xml plain"></</code><code
 class="xml keyword">plugin</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-A.5"  class="toc">A.5</a> 
        Dependencies </h2>
      <div  class="Unindented"> Dependency management is one of the more useful
        features of Maven. Listing <a  href="#lst:Adding-a-Dependency"  class="Reference">A.5↓</a> shows a declaration of the Jetty
        dependency for the default Lift application. The details of the
        specification are straightforward: </div>
      <ul>
        <li> The groupId and artifactId specify the artifact. A given group may
          have many artifacts under it; for instance, Lift uses net.liftweb for
          its groupId and the core artifacts are lift-core and life-util </li>
        <li> The version is specified either directly or with a range, as we’ve
          used in this example. A range is defined as
          <left>min,max<right> where left and right indicate an
          inclusive or exclusive range: [ and ] are inclusive, ( and ) are
          exclusive. Omitting a version in a range leaves that portion of the
          range unbounded. Here we configure the pom so that Jetty 6.1.6 or
          higher is used </li>
        <li> The scope of the dependency is optional<span  class="FootOuter"><span
 class="SupFootMarker"> [D] </span><span  class="HoverFoot"><span  class="SupFootMarker"> [D] </span>Scope is discussed in detail
              at <a  href="http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html"
 class="URL">http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html</a></span></span>,
          and controls exactly where the dependency is used. In this case we
          specify a test scope which means that the package will only be
          available to test phases </li>
      </ul>
      <div  class="Unindented">
        <div  class="listing">
          <div  class="caption"> Adding a Dependency<a  name="lst:Adding-a-Dependency"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_709735">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">dependency</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">groupId</code><code  class="xml plain">>org.mortbay.jetty</</code><code
 class="xml keyword">groupId</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">artifactId</code><code  class="xml plain">>jetty</</code><code
 class="xml keyword">artifactId</code><code  class="xml plain">></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">version</code><code  class="xml plain">>[6.1.6,)</</code><code
 class="xml keyword">version</code><code  class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">scope</code><code  class="xml plain">>test</</code><code
 class="xml keyword">scope</code><code  class="xml plain">></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml plain"></</code><code
 class="xml keyword">dependency</code><code  class="xml plain">> </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-A.5.1"  class="toc">A.5.1</a> 
        Adding a Dependency<a  name="sub:Adding-a-Dependency"  class="Label"> </a>
      </h3>
      <div  class="Unindented"> As an example, let’s say that you’d like to add
        a new library and you want Maven to make sure you’ve got the most
        up-to-date version. We’re going to add Configgy<span  class="FootOuter"><span
 class="SupFootMarker">  [E] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [E] </span>Configgy’s home is <a  href="http://www.lag.net/configgy/"
 class="URL">http://www.lag.net/configgy/</a></span></span> as a
        dependency. Configgy is “a library for handling config files and logging
        for a scala daemon. The idea is that it should be simple and
        straightforward, allowing you to plug it in and get started quickly,
        writing small useful daemons without entering the shadowy world of java
        frameworks.” </div>
      <div  class="Indented"> First we need to tell Maven where we can get
        Configgy, so in the <tt><repositories></tt> section
        add the following: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Adding the Configgy repo<a  name="lst:Adding-the-Configgy-repo"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_540770">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">repository</code><code  class="xml plain">> </code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">id</code><code  class="xml plain">><a
 href="http://www.lag.net/repo/">http://www.lag.net/repo/</a></</code><code  class="xml keyword">id</code><code
 class="xml plain">> </code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">name</code><code  class="xml plain">><a
 href="http://www.lag.net/repo/">http://www.lag.net/repo/</a></</code><code  class="xml keyword">name</code><code
 class="xml plain">> </code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">url</code><code  class="xml plain">><a
 href="http://www.lag.net/repo/">http://www.lag.net/repo/</a></</code><code  class="xml keyword">url</code><code
 class="xml plain">> </code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml plain"></</code><code
 class="xml keyword">repository</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Then in the
        <tt><dependencies></tt> section add: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Adding the Configgy dependency<a  name="lst:Adding-the-Configgy-dep"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_30007">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">dependency</code><code  class="xml plain">> </code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">groupid</code><code  class="xml plain">>net.lag</</code><code
 class="xml keyword">groupid</code><code  class="xml plain">> </code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">artifactid</code><code  class="xml plain">>configgy</</code><code
 class="xml keyword">artifactid</code><code  class="xml plain">> </code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">version</code><code  class="xml plain">>[1.2,)</</code><code
 class="xml keyword">version</code><code  class="xml plain">> </code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml plain"></</code><code
 class="xml keyword">dependency</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> That’s it, you’re done. The next time you run
        Maven for your project, it will pull down the Configgy jars into your
        local repository. Maven will periodically check for new versions of
        dependencies when you build, but you can always force a check with the
        “-U” (update) flag. </div>
      <h2  class="Section"> <a  name="toc-Section-A.6"  class="toc">A.6</a> 
        Further Resources </h2>
      <div  class="Unindented"> Obviously we’ve only scratched the surface on
        what you can with Maven and how to configure it. We’ve found the
        following set of references useful in learning and using Maven: </div>
      <ul>
        <li> <a  href="http://maven.apache.org/"  class="URL">http://maven.apache.org</a>
          - The Maven home page </li>
        <li> <a  href="http://maven.apache.org/what-is-maven.html"  class="URL">http://maven.apache.org/what-is-maven.html</a>
          - A brief description of Maven’s goals </li>
        <li> <a  href="http://maven.apache.org/guides/introduction/introduction-to-the-pom.html"
 class="URL">http://maven.apache.org/guides/introduction/introduction-to-the-pom.html</a>
          - An introduction to the pom file </li>
        <li> <a  href="http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html"
 class="URL">http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html</a>-
          An overview of the lifecycles </li>
        <li> <a  href="http://suereth.blogspot.com/2008/10/maven-for-beginners.html"
 class="URL">http://suereth.blogspot.com/2008/10/maven-for-beginners.html</a>-
          A brief Maven usage tutorial </li>
        <li> <a  href="http://scala-blogs.org/2008/01/maven-for-scala.html"  class="URL">http://scala-blogs.org/2008/01/maven-for-scala.html</a>-
          A brief tutorial on using Maven geared toward Scala </li>
        <li> <a  href="http://mvnrepository.com/"  class="URL">http://mvnrepository.com/</a>-
          A website that lets you search for Maven dependencies by name.
          Invaluable when you’re trying to add libraries to your project </li>
      </ul>
      <h2  class="Section"> <a  name="toc-Section-A.7"  class="toc">A.7</a> 
        Project Layout </h2>
      <div  class="Unindented"> One of the things that allows Maven to work so
        well is that there is a standardized layout for projects. We’re not
        going to cover all of the standard locations for parts of your Maven
        project, but we do want to highlight a few locations that are important
        to Lift applications specifically: </div>
      <div  class="Description"> <span  class="Description-entry"><application_root>/src/main/scala</span> 
        This directory is where you place your Scala source, such as snippets,
        model objects, and any libraries you write. The subfolder structure
        follows the traditional Java packaging style. </div>
      <div  class="Description"> <span  class="Description-entry"><application_root>/src/main/resources</span> 
        This directory is where you would place any resources that you want to
        go into the WAR file. Typically this is used if you want to add entries
        to the <tt>META-INF</tt> directory in the WAR, since normal
        web resources should be placed under the
        <tt>webapp/WEB-INF</tt> directory. </div>
      <div  class="Description"> <span  class="Description-entry"><application_root>/src/main/webapp</span> 
        All of the web and static content for your application, such as images,
        XHTML templates, JavaScript and CSS are placed under this directory.
        This is also where your <tt>WEB-INF</tt> directory (and the
        configuration files it contains) goes. This directory is essentially
        what is packaged into the WAR in addition to the output from your Scala
        sources. </div>
      <div  class="Description"> <span  class="Description-entry"><application_root>/src/main/webapp/templates-hidden</span> 
        This is a special location for templates. As we discuss more in sections
        <a  href="#sub:snippet-tag"  class="Reference">5.1↑</a> and <a  href="#sub:embed-tag"
 class="Reference">4.5.7↑</a>, templates placed in this directory
        cannot be viewed directly by clients, but are available to other
        templates. </div>
      <div  class="Description"> <span  class="Description-entry"><application_root>/src/test/scala</span> 
        This directory is where you can put all of your test code. As with
        <tt>src/main/scala</tt>, the subfolder structure follows the
        traditional Java packaging style. </div>
      <h1  class="Chapter"> <a  name="toc-Appendix-B"  class="toc">B</a> 
        Message Handling<a  name="cha:Message-Handling"  class="Label"> </a> </h1>
      <div  class="Unindented"> When we talk about message handling in Lift,
        we’re talking about how you provide feedback to the users of your
        application. While there are already a lot of mechanisms for displaying
        data to the user via snippets, views, etc, properly binding and setting
        up HTML-level elements can get complicated, especially when you’re
        dealing with callback functions or error handling. Lift provides an
        alternate mechanism for displaying messages to users that is easy to use
        and allows flexibility in display on the client side. </div>
      <h2  class="Section"> <a  name="toc-Section-B.1"  class="toc">B.1</a> 
        Sending Messages </h2>
      <div  class="Unindented"> Messages for non-Comet requests are handled via
        the S object (yes, even Ajax is handled automatically); specifically,
        the error, notice and warning methods allow you to send a String or a
        NodeSeq back to the user for display, with or without an association
        with a particular element id. The error method also provides an overload
        that takes a List[FieldError], the type returned from Mapper field
        validation (section <a  href="#sub:Mapper-Validation"  class="Reference">8.2.3↑</a>). The messages that you send are held by
        a RequestVar (section <a  href="#sec:Session-and-Request"  class="Reference">3.11↑</a>) in the S object, so you can send
        messages from anywhere in your stateful request/response lifecycle
        without breaking the flow of your code. Listing <a  href="#lst:Using-messages-in-forms"
 class="Reference">B.1↓</a> shows how you could use messages in form
        processing to send feedback on missing fields. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using messages in form processing<a  name="lst:Using-messages-in-forms"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_26779">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">data </code><code  class="scala keyword">extends</code> <code
 class="scala plain">RequestVar[String](</code><code  class="scala string">""</code><code
 class="scala plain">)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">addNote (xhtml </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq) </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">doAdd () </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">//validate</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">(data.is </code><code
 class="scala keyword">==</code> <code  class="scala string">""</code><code  class="scala plain">) { </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">S.error(</code><code  class="scala string">"noteField"</code><code
 class="scala plain">, </code><code  class="scala string">"You need to provide a note"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">Note.create.note(data).save</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">S.notice(</code><code  class="scala string">"Note added"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">redirectTo(</code><code  class="scala string">"/viewNotes"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">bind(</code><code  class="scala string">"form"</code><code
 class="scala plain">, xhtml,</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">       </code><code
 class="scala string">"note"</code> <code  class="scala plain">-> SHtml.text(data.is, data(</code><code
 class="scala keyword">_</code><code  class="scala plain">), </code><code  class="scala string">"id"</code> <code
 class="scala plain">-> </code><code  class="scala string">"noteField"</code><code
 class="scala plain">),</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">       </code><code
 class="scala string">"add"</code> <code  class="scala plain">-> SHtml.submit(</code><code
 class="scala string">"Add"</code><code  class="scala plain">, doAdd))</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In this particular case we use two different
        messages. One is an error to be displayed when the form is re-shown;
        this error is associated with the “noteField” element. The second
        message is a simple notice to let the user know that the data was
        successfully saved. </div>
      <div  class="Indented"> For Comet<a  href="#index-Comet"  name="entry-Comet-1"
 class="IndexReference">↓</a> the only
        difference in sending messages is that the error, notice and warning
        methods are defined in the CometActor class, so you just use those
        directly and Lift handles the rest. </div>
      <h2  class="Section"> <a  name="toc-Section-B.2"  class="toc">B.2</a> 
        Displaying Messages </h2>
      <div  class="Unindented"> The display of messages is handled by two
        builtin snippets, <lift:Msgs/> and <lift:Msg/>. The Msgs
        snippet displays all messages not associated with a particular element
        Id. The messages are displayed as an unordered list, but Lift allows
        customization of the messages via XML that you embed within the snippet.
        For each of the three message types, you can specify a
        <lift:TYPE_msg> and <lift:TYPE_class> element that controls
        the message label and CSS class, respectively. The default label is
        simply the title-case type (Error, Notice, Warning). For example,
        listing <a  href="#lst:Custom-message-labels"  class="Reference">B.2↓</a> shows how we could change the error and
        notice messages. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Custom message labels<a  name="lst:Custom-message-labels"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_561663">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift</code><code
 class="scala keyword">:</code><code  class="scala plain">Msgs></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><lift</code><code  class="scala keyword">:</code><code  class="scala plain">error</code><code
 class="scala keyword">_</code><code  class="scala plain">msg>Danger, Will Robinson! </lift</code><code
 class="scala keyword">:</code><code  class="scala plain">error</code><code  class="scala keyword">_</code><code
 class="scala plain">msg></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><lift</code><code  class="scala keyword">:</code><code  class="scala plain">error</code><code
 class="scala keyword">_</code><code  class="scala plain">class>redtext</lift</code><code
 class="scala keyword">:</code><code  class="scala plain">error</code><code  class="scala keyword">_</code><code
 class="scala plain">class></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><lift</code><code  class="scala keyword">:</code><code  class="scala plain">notice</code><code
 class="scala keyword">_</code><code  class="scala plain">msg>FYI</code><code  class="scala keyword">:</code> <code
 class="scala plain"></lift</code><code  class="scala keyword">:</code><code  class="scala plain">notice</code><code
 class="scala keyword">_</code><code  class="scala plain">msg></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain"></lift</code><code
 class="scala keyword">:</code><code  class="scala plain">Msgs></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The Msg snippet is used to display all messages
        associated with a particular Id by specifying the id attribute on the
        <lift:Msg/> element. With Msg, you don’t get a message label, so
        there’s no override mechanism for it. You do, however, have the ability
        to to change the message class on a per-type basis by setting the
        noticeClass, errorClass, or warningClass attributes on the
        <lfit:Msg/> element. Listing <a  href="#lst:Per-id-messages"  class="Reference">B.2↓</a> shows usage of Msg corresponding to our
        snippet in listing <a  href="#lst:Using-messages-in-forms"  class="Reference">B.1↑</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Per-id messages<a  name="lst:Per-id-messages"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_750979">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain"><lift</code><code
 class="scala keyword">:</code><code  class="scala plain">Stuff.addNote form</code><code
 class="scala keyword">=</code><code  class="scala string">"POST"</code><code  class="scala plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain"><form</code><code  class="scala keyword">:</code><code  class="scala plain">note />lift</code><code
 class="scala keyword">:</code><code  class="scala plain">Msg id</code><code  class="scala keyword">=</code><code
 class="scala string">"noteField"</code> <code  class="scala plain">errorClass</code><code
 class="scala keyword">=</code><code  class="scala string">"redtext"</code> <code
 class="scala plain">/></code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain"><form</code><code  class="scala keyword">:</code><code  class="scala plain">add /></code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain"></lift</code><code
 class="scala keyword">:</code><code  class="scala plain">Stuff.addNote></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Appendix-C"  class="toc">C</a> Lift
        Helpers<a  name="cha:Lift-Helpers"  class="Label"> </a> </h1>
      <h2  class="Section"> <a  name="toc-Section-C.1"  class="toc">C.1</a> 
        Introduction<a  name="sec:Introduction"  class="Label"> </a> </h2>
      <div  class="Unindented"> Lift provides a fairly useful collection of
        helper artifacts. The helpers are essentially utility functions that
        minimize the need for boilerplate code. This appendix is intended to
        introduce some of the more common utility classes and objects to you so
        that you’re familiar with them. If you would like more details, you can
        look at the API documentation for the <tt>net.liftweb.util
        package</tt>. </div>
      <h2  class="Section"> <a  name="toc-Section-C.2"  class="toc">C.2</a> Box
        (or Scala’s Option class on steroids)<a  name="sec:Box-(or-Scala's"  class="Label">
        </a> </h2>
      <div  class="Unindented"> <tt>net.liftweb.util.Box</tt> (or
        Scala’s <tt>scala.Option</tt> class on steroids) is a
        utility class that mimics Scala’s <tt>Option</tt> type (also
        heavily used inside Lift). To understand some of the underlying concepts
        and assumptions, let’s take a quick look at <tt>Option</tt>
        class first. The <tt>Option</tt> class allows a type-safe
        way of dealing with a situation where you may or may not have a result.
        <tt>Option</tt> has two values, either
        <tt>Some(value)</tt>, where <tt>value</tt> is
        actually the value, and <tt>None</tt>, which is used to
        represent nothing. A typical example for <tt>Option</tt> is
        outlined using Scala’s Map type. Listing <a  href="#lst:Option-and-Map"
 class="Reference">C.2↓</a> shows a definition of a
        <tt>Map</tt>, a successful attempt to get the value of key
        <tt>a</tt>, and an attempt to get the value of key
        <tt>i</tt>. Notice that when we retrieved the existing
        key-value pair for <tt>a</tt>, the value returned was
        <tt>Some(A)</tt> and when we asked for the value of key
        <tt>i</tt>, we received None. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Option and Map example<a  name="lst:Option-and-Map"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_261946">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">scala> </code><code
 class="scala keyword">val</code> <code  class="scala plain">cap </code><code  class="scala keyword">=</code> <code
 class="scala plain">Map(</code><code  class="scala string">"a"</code> <code  class="scala plain">-> </code><code
 class="scala string">"A"</code><code  class="scala plain">, </code><code  class="scala string">"b"</code> <code
 class="scala plain">-> </code><code  class="scala string">"B"</code><code  class="scala plain">) </code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">cap</code><code
 class="scala keyword">:</code> <code  class="scala plain">scala.collection.immutable.Map[java.lang.String,java.lang.String] </code><code
 class="scala keyword">=</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">Map(a -> A, b -> B)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">scala> cap.get(</code><code
 class="scala string">"a"</code><code  class="scala plain">)  </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">res</code><code
 class="scala value">1</code><code  class="scala keyword">:</code> <code  class="scala plain">Option[java.lang.String] </code><code
 class="scala keyword">=</code> <code  class="scala plain">Some(A)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">scala> cap.get(</code><code
 class="scala string">"i"</code><code  class="scala plain">) </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">res</code><code
 class="scala value">2</code><code  class="scala keyword">:</code> <code  class="scala plain">Option[java.lang.String] </code><code
 class="scala keyword">=</code> <code  class="scala plain">None</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Getting the value out of an
        <tt>Option</tt> is usually handled via Scala’s matching
        mechanism or via the <tt>getOrElse</tt> function, as shown
        in Listing <a  href="#lst:Fetch-value-from"  class="Reference">C.2↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Fetch value from an Option<a  name="lst:Fetch-value-from"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_847305">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">prettyPrint(foo</code><code  class="scala keyword">:</code> <code
 class="scala plain">Option[String])</code><code  class="scala keyword">:</code> <code
 class="scala plain">String </code><code  class="scala keyword">=</code> <code  class="scala plain">foo </code><code
 class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Some(x) </code><code
 class="scala keyword">=</code><code  class="scala plain">> x</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">None </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code><code  class="scala string">"Nothing found."</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala comments">// Which would be used in conjunction with the previous code:</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">scala> prettyPrint(cap.get(</code><code
 class="scala string">"a"</code><code  class="scala plain">)) </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">res</code><code
 class="scala value">7</code><code  class="scala keyword">:</code> <code  class="scala plain">String </code><code
 class="scala keyword">=</code> <code  class="scala plain">A</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">scala> prettyPrint(cap.get(</code><code
 class="scala string">"i"</code><code  class="scala plain">)) </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">res</code><code
 class="scala value">8</code><code  class="scala keyword">:</code> <code  class="scala plain">String </code><code
 class="scala keyword">=</code> <code  class="scala plain">Nothing found.</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> <tt>Box</tt> in Lift covers the same
        base functionality as <tt>Option</tt> but expands the
        semantics for missing values. If we have an <tt>Option</tt>
        that is <tt>None</tt> at some point, we can’t really tell
        why that <tt>Option</tt> is <tt>None</tt>,
        although in many situations, knowing why would be quite helpful. With
        <tt>Box</tt>, on the other hand, you have either have a
        <tt>Full</tt> instance (corresponding to
        <tt>Some</tt> with <tt>Option</tt>) or an
        instance that subclasses <tt>EmptyBox</tt> (corresponding to
        <tt>None</tt>). <tt>EmptyBox</tt> can either be
        an <tt>Empty</tt> instance or a <tt>Failure</tt>
        instance incorporating the cause for the failure. So you can think of
        <tt>Box</tt> as a container with three states: full, empty,
        or empty for a particular reason. The <tt>Failure</tt> case
        class takes three arguments: a <tt>String</tt> message to
        describe the failure, a <tt>Box[Throwable]</tt> for an
        optional exception related to the failure, and a
        <tt>Box[Failure]</tt> for chaining based on earlier
        <tt>Failure</tt>s. </div>
      <div  class="Indented"> As an example of how we can use
        <tt>Box</tt> instances in real code, consider the case where
        we have to do a bunch of null checks, perform an operation, and then
        perform more null checks, other operations, and so on. Listing <a  href="#lst:Pseudocode-nested-operations"
 class="Reference">C.2↓</a> shows an example of this sort of
        structure. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Pseudocode nested operations example<a  name="lst:Pseudocode-nested-operations"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_711460">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">x </code><code  class="scala keyword">=</code> <code  class="scala plain">getSomeValue();</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">(x !</code><code  class="scala keyword">=</code> <code
 class="scala keyword">null</code><code  class="scala plain">) {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">y </code><code  class="scala keyword">=</code> <code  class="scala plain">getSomeOtherValue();</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">if</code> <code  class="scala plain">(y !</code><code  class="scala keyword">=</code> <code
 class="scala keyword">null</code><code  class="scala plain">) {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">compute(x, y);</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> This is tedious and error-prone in practice. Now
        let’s see if we can do better by combining Lift’s
        <tt>Box</tt> with Scala’s for comprehensions as shown in
        Listing <a  href="#lst:Scala-nested-operations"  class="Reference">C.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Box nested operations example<a  name="lst:Scala-nested-operations"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_790161">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">getSomeValue()</code><code
 class="scala keyword">:</code> <code  class="scala plain">Box[Int] </code><code
 class="scala keyword">=</code> <code  class="scala plain">Full(</code><code  class="scala value">12</code><code
 class="scala plain">)     </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">getSomeOtherValue()</code><code
 class="scala keyword">:</code> <code  class="scala plain">Box[Int] </code><code
 class="scala keyword">=</code> <code  class="scala plain">Full(</code><code  class="scala value">2</code><code
 class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code> </div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">compute(x</code><code
 class="scala keyword">:</code> <code  class="scala plain">Int, y</code><code  class="scala keyword">:</code> <code
 class="scala plain">Int) </code><code  class="scala keyword">=</code> <code  class="scala plain">x * y</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code> </div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">res </code><code  class="scala keyword">=</code> <code
 class="scala keyword">for</code> <code  class="scala plain">( x <- getSomeValue();</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">                    </code><code
 class="scala plain">y <- getSomeOtherValue() </code><code  class="scala keyword">if</code> <code
 class="scala plain">x > </code><code  class="scala value">10</code><code  class="scala plain">) </code><code
 class="scala keyword">yield</code> <code  class="scala plain">compute(x, y)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">println(res) </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In Listing <a  href="#lst:Scala-nested-operations"
 class="Reference">C.2↑</a>, we have two values,
        <tt>x</tt> and <tt>y</tt>, and we want to do
        some computation with these values. But we must ensure that computation
        is done on the correct data. For instance, the computation cannot be
        done if <tt>getSomeValue</tt> returns no value. In this
        context, the two functions return a <tt>Box[Int]</tt>. The
        interesting part is that if either or both of the two functions return
        an <tt>Empty</tt> Box instead of <tt>Full</tt>
        (<tt>Empty</tt> impersonating the nonexistence of the
        value), the <tt>res</tt> value will also be
        <tt>Empty</tt>. However, if both functions return a
        <tt>Full</tt> (like in Listing <a  href="#lst:Scala-nested-operations"  class="Reference">C.2↑</a>), the computation is called. In our
        example the two functions return <tt>Full(12)</tt> and
        <tt>Full(2)</tt>, so <tt>res</tt> will be a
        <tt>Full(24)</tt>. </div>
      <div  class="Indented"> But we have something else interesting here: the
        <tt>if x > 10</tt> statement (this is called a “guard” in
        Scala). If the call to <tt>getSomeValue</tt> returns a value
        less than or equal to 10, the <tt>y</tt> variable won’t be
        initialized, and the res value will be <tt>Empty</tt>. This
        is just a taste of some of the power of using <tt>Box</tt>
        for comprehensions; for more details on for comprehensions, see <i>The
          Scala Language Specification</i>, section 6.19, or one of the many
        Scala books available. </div>
      <div  class="Indented"> Lift’s <tt>Box</tt> extends
        <tt>Option</tt> with a few ideas, mainly the fact that you
        can add a message about why a <tt>Box</tt> is
        <tt>Empty</tt>. <tt>Empty</tt> corresponds to
        <tt>Option</tt>’s <tt>None</tt> and
        <tt>Full</tt> to <tt>Option</tt>’s Some. So you
        can pattern match against a <tt>Box</tt> as shown in Listing
        <a  href="#lst:Box-example"  class="Reference">C.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Box example<a  name="lst:Box-example"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_800962">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">a </code><code
 class="scala keyword">match</code> <code  class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">Full(author) </code><code  class="scala keyword">=</code><code
 class="scala plain">> Text(</code><code  class="scala string">"I found the author "</code> <code
 class="scala plain">+ author.niceName)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">Empty </code><code  class="scala keyword">=</code><code  class="scala plain">> Text(</code><code
 class="scala string">"No author by that name."</code><code  class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// message may be something like "Database disconnected."</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">Failure(message, </code><code  class="scala keyword">_</code><code
 class="scala plain">, </code><code  class="scala keyword">_</code><code  class="scala plain">) </code><code
 class="scala keyword">=</code><code  class="scala plain">> Text(</code><code  class="scala string">"Nothing found due to "</code> <code
 class="scala plain">+ message) </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">confirmDelete {     </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">(</code><code  class="scala keyword">for</code> <code  class="scala plain">(</code><code
 class="scala keyword">val</code> <code  class="scala plain">id <- param(</code><code
 class="scala string">"id"</code><code  class="scala plain">);     </code><code
 class="scala comments">// get the ID           </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">val</code> <code  class="scala plain">user <- User.find(id)) </code><code
 class="scala comments">// find the user                                                                                </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">yield</code> <code  class="scala plain">{          </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">user.delete</code><code  class="scala keyword">_</code><code
 class="scala plain">!                   </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">notice(</code><code  class="scala string">"User deleted"</code><code
 class="scala plain">)          </code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">redirectTo(</code><code  class="scala string">"/simple/index.html"</code><code
 class="scala plain">)        </code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}) getOrElse {error(</code><code  class="scala string">"User not found"</code><code
 class="scala plain">); redirectTo(</code><code  class="scala string">"/simple/index.html"</code><code
 class="scala plain">)}    </code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In conjunction with Listing <a  href="#lst:Box-example"
 class="Reference">C.2↑</a>, we can use other <tt>Box</tt>
        functions, such as the <tt>openOr</tt> function shown in
        Listing <a  href="#lst:openOr-example"  class="Reference">C.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> openOr example<a  name="lst:openOr-example"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_329602">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">lazy</code> <code
 class="scala keyword">val</code> <code  class="scala plain">UserBio </code><code
 class="scala keyword">=</code> <code  class="scala plain">UserBio.find(By(UserBio.id, id)) openOr (</code><code
 class="scala keyword">new</code> <code  class="scala plain">UserBio)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">view (xhtml</code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq)</code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">passedAuthor.map({ author </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// do bind, etc here and return a NodeSeq</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}) openOr Text(</code><code
 class="scala string">"Invalid author"</code><code  class="scala plain">) </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> We won’t be detailing all of the Box functions
        here, but a few words on the most common function might be benficial. </div>
      <div  class="Indented">
        <div  class="center">
          <table>
            <tbody>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> Function
                  name </td>
                <td  valign="top"  align="left"  style="width: 2.75in;">
                  Description </td>
                <td  valign="top"  align="left"  style="width: 2in;"> Short
                  example. Assume myBox is a Box </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> openOr </td>
                <td  valign="top"  align="left"  style="width: 2.75in;"> Returns
                  the value contained by this Box. If the Box is Empty </td>
                <td  valign="top"  align="left"  style="width: 2in;"> myBox
                  openOr “The box is Empty” </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> map </td>
                <td  valign="top"  align="left"  style="width: 2.75in;"> Apply a
                  function on the values of this Box and return something else.
                </td>
                <td  valign="top"  align="left"  style="width: 2in;"> myBox map
                  (value => value + “ suffix”) </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> dmap </td>
                <td  valign="top"  align="left"  style="width: 2.75in;">
                  Equivalent with map(..) openOr default_value. The default
                  value will be returned in case the map is Empty </td>
                <td  valign="top"  align="left"  style="width: 2in;"> myBox
                  dmap(“default”)(value => value + “ suffix”) </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> !! </td>
                <td  valign="top"  align="left"  style="width: 2.75in;"> If the
                  argument is null in will return an Empty, otherwise a Full
                  containing the arguent’s value. Note this this is a method on
                  the Box object, not a given Box instance. </td>
                <td  valign="top"  align="left"  style="width: 2in;"> Box !!
                  (<a reference>) </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> ?~ </td>
                <td  valign="top"  align="left"  style="width: 2.75in;">
                  Transforms an Empty to a Failure and passing a message. If the
                  Box is a Full it will just return <tt>this</tt>. </td>
                <td  valign="top"  align="left"  style="width: 2in;"> myBox ?~
                  (“Error message”) </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> isDefined
                </td>
                <td  valign="top"  align="left"  style="width: 2.75in;"> Returns
                  true if this Box contains a value </td>
                <td  valign="top"  align="left"  style="width: 2in;"> myBox
                  isDefined </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> isEmpty </td>
                <td  valign="top"  align="left"  style="width: 2.75in;"> Retun
                  true is this Boxis empty </td>
                <td  valign="top"  align="left"  style="width: 2in;"> myBox
                  isEmpty </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> asA[B] </td>
                <td  valign="top"  align="left"  style="width: 2.75in;"> Return
                  a Full[B] if the content of this Box is of type B, otherwise
                  return Empty </td>
                <td  valign="top"  align="left"  style="width: 2in;"> myBox
                  asA[Person] </td>
              </tr>
              <tr>
                <td  valign="top"  align="left"  style="width: 1in;"> isA[B] </td>
                <td  valign="top"  align="left"  style="width: 2.75in;"> Return
                  a Full[B] if the contents of this Box is an instance of the
                  specified class, otherwise return Empty </td>
                <td  valign="top"  align="left"  style="width: 2in;"> myBox
                  isA[Person] </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div  class="Indented"> Note that <tt>Box</tt> contains a set
        of implicit conversion functions from/to <tt>Option</tt> and
        from/to <tt>Iterable</tt>. </div>
      <div  class="Indented"> Remember that Box is heavily used in Lift and most
        of the Lift’s API’s operates with <tt>Box</tt>es. The
        rationale is to avoid <tt>n</tt>ull references and to
        operate safely in context where values may be missing. Of course, a
        <tt>Box</tt> can be set to <tt>null</tt>
        manually but we strongly recommend against doing so. There are cases,
        however, where you are using some third party Java libraries with APIs
        that return <tt>null</tt> values. To cope with such cases in
        Lift you can use the <tt>!!</tt> function to
        <tt>Box</tt> that value. Listing <a  href="#lst:Null-example"  class="Reference">C.2↓</a> shows how we can deal with a possible
        <tt>null</tt> value. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Null example<a  name="lst:Null-example"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_725244">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">x </code><code  class="scala keyword">=</code> <code  class="scala plain">getSomeValueThatMayBeNull();</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">boxified </code><code  class="scala keyword">=</code> <code
 class="scala plain">Box !! x</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> In this case the <tt>boxified</tt>
        variable will be <tt>Empty</tt> if <tt>x</tt> is
        <tt>null</tt> or <tt>Full(x)</tt> if
        <tt>x</tt> is a valid value/reference.. </div>
      <h2  class="Section"> <a  name="toc-Section-C.3"  class="toc">C.3</a> 
        ActorPing<a  name="sec:ActorPing"  class="Label"> </a> </h2>
      <div  class="Unindented"> It provides convenient functionality to schedule
        messages to Actors. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> ActorPing example<a  name="lst:ActorPing-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_77457">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Assume myActor an existing Actor</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala comments">// And a case object MyMessage</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala comments">// Send the MyMessage message after 15 seconds</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">ActorPing.schedule(myActor, MyMessage, </code><code
 class="scala value">15</code> <code  class="scala plain">seconds)</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala comments">// Send the MyMessage message every 15 seconds. The cycle is stopped </code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala comments">// if recipient actor exits or replied back with UnSchedule message</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">ActorPing.scheduleAtFixedRate(myActor, MyMessage, </code><code
 class="scala value">0</code> <code  class="scala plain">seconds, </code><code  class="scala value">15</code> <code
 class="scala plain">seconds)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-C.4"  class="toc">C.4</a> 
        ClassHelpers<a  name="sec:ClassHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> Provides convenient functions for loading
        classes using Java reflection, instantiating dinamically loaded classes,
        invoking methods vis reflection etc. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> ClassHelper example<a  name="lst:ClassHelper-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_688185">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala keyword">_</code><code  class="scala plain">root</code><code  class="scala keyword">_</code><code
 class="scala plain">.net.liftweb.util.Helpers.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala comments">// lookup the class Bar in the three packages specified in th list</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">findClass(</code><code
 class="scala string">"Bar"</code><code  class="scala plain">, </code><code  class="scala string">"com.foo"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"com.bar"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"com.baz"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">invokeMethod(myClass, myInstance, </code><code
 class="scala string">"doSomething"</code><code  class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-C.5"  class="toc">C.5</a> 
        CodeHelpers<a  name="sec:CodeHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> Provides a convenient way of telling why a
        boolean expression failed. For instance we are seeing manytime code
        like: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Expression example<a  name="lst:Expression-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_751414">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">isTooYoung </code><code  class="scala keyword">=</code> <code
 class="scala keyword">false</code><code  class="scala plain">;</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">isTooBig </code><code  class="scala keyword">=</code> <code
 class="scala keyword">false</code><code  class="scala plain">;</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">isTooLazy </code><code  class="scala keyword">=</code> <code
 class="scala keyword">true</code><code  class="scala plain">;</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">exp </code><code  class="scala keyword">=</code> <code  class="scala plain">isTooYoung && isTooBig && isTooLazy</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> As you can see we have no way of telling if the
        exp was false because of isTooYoung, isTooBig or isTooLazy unless we
        test them again. But let’s see this: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> CodeHelpers example<a  name="lst:CodeHelpers-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_999990">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.MonadicConversions.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">exp </code><code  class="scala keyword">=</code> <code  class="scala plain">(isTooYoung ~ </code><code
 class="scala string">"too young"</code><code  class="scala plain">) &&  </code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">          </code><code
 class="scala plain">(isTooBad ~ </code><code  class="scala string">"too bad"</code><code
 class="scala plain">) &&  </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">          </code><code
 class="scala plain">(isToLazy ~ </code><code  class="scala string">"too lazy"</code><code
 class="scala plain">)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">println(exp </code><code
 class="scala keyword">match</code> <code  class="scala plain">{  </code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">False(msgs) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">msgs mkString(</code><code  class="scala string">"Test failed because it is ’"</code><code
 class="scala plain">, </code><code  class="scala string">"’ and ’"</code><code
 class="scala plain">, </code><code  class="scala string">"’."</code><code  class="scala plain">)  </code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala string">"success"</code> </div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}) </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now if exp is a False we can tell why it failed as
        we have the messages now. </div>
      <h2  class="Section"> <a  name="toc-Section-C.6"  class="toc">C.6</a> 
        ControlHelpers<a  name="sec:ControlHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> Provides convenient functions for try/catch
        situations. For example: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> ControlHelpers example<a  name="lst:ControlHelpers-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_931605">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">tryo {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// code here. Any exception thrown here will be silently caught</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces"> </code> </div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">tryo((e</code><code
 class="scala keyword">:</code> <code  class="scala plain">Throwable) </code><code
 class="scala keyword">=</code><code  class="scala plain">> println(e)) {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// code here. Any exception here willbe caught add passed to </code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// the above function.</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">tryo(List(classOf[ClassNotFoundException], classOf[IOException])) {</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// code here. If IOException or ClassNotFoundException is thrown </code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// (or a subclass of the two) they will be ignored. Any other</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// exception will be rethrown.</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-C.7"  class="toc">C.7</a> 
        CSSHelpers<a  name="sec:CSSHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> This provide a convenient functionality to fix
        relative root paths in CSS (Cascade Stylesheet) files. Here is an
        example: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> CSSHelper example<a  name="lst:CSSHelper-example"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_930231">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">Assume </code><code
 class="scala keyword">this</code> <code  class="scala plain">entry in a CSS file</code><code
 class="scala keyword">:</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">.boxStyle {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">background-image</code><code  class="scala keyword">:</code> <code
 class="scala plain">url(’/img/bkg.png’)</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala comments">//in your code you can say</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">CSSHelpers.fixCSS(reader, </code><code
 class="scala string">"/myliftapp"</code><code  class="scala plain">)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala comments">// where reader is a java.io.Reader that provides the </code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala comments">// content of the CSS file.</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Now if your application is not deployed in the
        ROOT context path (“/”) and say it is deployed with the context root
        /myliftapp then the background picture will probably notbe found. Say
        <tt>http://my.domain.com/img/bkg.png</tt> is an unknown
        path. However <tt>http://my.domain.com/<u>myliftapp</u>/img/bkg.png
        </tt>is known. In the example above we are calling fixCSS so that
        it will automatically replace the root relative paths such that
        <tt>background-image: url(’/img/bkg.png’)</tt> becomes
        <tt>background-image: url(’/myliftapp/img/bkg.png’)</tt>. To
        use that in your lift application you can do: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> fixCSS example<a  name="lst:fixCSS-example"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_150982">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">boot(){</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">LiftRules.fixCSS(</code><code  class="scala string">"styles"</code> <code
 class="scala keyword">::</code> <code  class="scala string">"theme"</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil, Empty)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> When the <tt>/styles/theme.css</tt>
        file Lift will apply the prefix specified. But in this case we provided
        an Empty Box. This actually means that Lift will apply the context path
        returned by <tt>S.contextPath </tt>function which as you
        know returns the context path from the <tt>HttpSession</tt>.
      </div>
      <div  class="Indented"> Internally when you call
        <tt>fixCSS</tt> a dispatch function is automatically created
        and pre-pended to <tt>LiftRules.dispatch</tt>. This is
        needed in order to intercept the browser request to this .css resource.
        Also internally we are telling Lift the this resource must be server by
        Lift and not by container. </div>
      <div  class="Indented"> The way it works internally is that we are using
        Scala combinator parsers to augment only the root relative paths with
        the given prefix. </div>
      <h2  class="Section"> <a  name="toc-Section-C.8"  class="toc">C.8</a> 
        BindHelpers<a  name="sec:BindHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> Binders are extensiveley discussed in other
        chapters so we won’t reiterate them here. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Choose template XML<a  name="lst:Choose-template"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_253311">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">lift:CountGame.run</code> <code  class="xml color1">form</code><code
 class="xml plain">=</code><code  class="xml string">"post"</code><code  class="xml plain">></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">choose:guess</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">    </code><code
 class="xml plain">Guess a number between 1 and 100.<</code><code  class="xml keyword">br</code><code
 class="xml plain">/></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">    </code><code
 class="xml plain">Last guess: <</code><code  class="xml keyword">count:last</code><code
 class="xml plain">/><</code><code  class="xml keyword">br</code> <code  class="xml plain">/></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">    </code><code
 class="xml plain">Guess: <</code><code  class="xml keyword">count:input</code><code
 class="xml plain">/><</code><code  class="xml keyword">br</code><code  class="xml plain">/></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">input</code> <code  class="xml color1">type</code><code
 class="xml plain">=</code><code  class="xml string">"submit"</code> <code  class="xml color1">value</code><code
 class="xml plain">=</code><code  class="xml string">"Guess"</code><code  class="xml plain">/></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">choose:guess</code><code
 class="xml plain">></code></div>
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">choose:win</code><code  class="xml plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">    </code><code
 class="xml plain">You Win!!<</code><code  class="xml keyword">br</code> <code  class="xml plain">/></code></div>
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">    </code><code
 class="xml plain">You guessed <</code><code  class="xml keyword">count:number</code><code
 class="xml plain">/> after <</code><code  class="xml keyword">count:count</code><code
 class="xml plain">/> guesses.<</code><code  class="xml keyword">br</code><code
 class="xml plain">/></code></div>
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">choose:win</code><code  class="xml plain">></code></div>
                        <div  class="line number12 index11 alt1"><code  class="xml plain"></</code><code
 class="xml keyword">lift:CountGame.run</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> You can use the
        <tt>Helpers.chooseTemplate</tt> method to extract portions
        of a given XML input: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Choose template Scala code </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_966596">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">Helpers.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">class</code> <code
 class="scala plain">CountGame {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">run(xhtml</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq)</code><code
 class="scala keyword">:</code> <code  class="scala plain">NodeSeq </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">... </code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">chooseTemplate(</code><code  class="scala string">"choose"</code><code
 class="scala plain">, </code><code  class="scala string">"win"</code><code  class="scala plain">, xhtml);</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> So in the snippet conditionally we can choose
        between parts of the snippet template. In the case above only the childs
        of <tt><choose:win></tt> node will be returned by the
        snippetfunction, hence rendered. </div>
      <h2  class="Section"> <a  name="toc-Section-C.9"  class="toc">C.9</a> 
        HttpHelpers<a  name="sec:HttpHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> This provides helper functions for HTTP
        parameters manipulation, URL encoding/decoding etc. However there is
        some interesting functionality available that lets you choose between
        tags of a snippet. </div>
      <h2  class="Section"> <a  name="toc-Section-C.10"  class="toc">C.10</a> 
        JSON<a  name="sec:JSON"  class="Label"> </a> </h2>
      <div  class="Unindented"> Lift provides its own JSON parser if you ever
        need one. At a first glance it may be a bit redundant with Scala’s JSON
        parser but infact Scala’sparser has its own problems with large JSON
        objects hence List’s uses its own JSON parser implemented of course
        using combinator parsers. </div>
      <h2  class="Section"> <a  name="toc-Section-C.11"  class="toc">C.11</a> 
        LD<a  name="sec:LD"  class="Label"> </a> </h2>
      <div  class="Unindented"> Provides utility functions for calculating the
        distance between words <span  class="FootOuter"><span  class="SupFootMarker"> 
            [F] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [F] </span>http://en.wikipedia.org/wiki/Levenshtein_distance</span></span>
      </div>
      <h2  class="Section"> <a  name="toc-Section-C.12"  class="toc">C.12</a> 
        ListHelpers<a  name="sec:ListHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> Provides utility functions for manipulating
        lists that are not provided by Scala libraries. </div>
      <h2  class="Section"> <a  name="toc-Section-C.13"  class="toc">C.13</a> 
        NamedPartialFunctions<a  name="sec:NamedPartialFunctions"  class="Label">
        </a> </h2>
      <div  class="Unindented"> Provides extremly useful functions for invoking
        partial functions that are chained in lists of functions. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> NamedPF example<a  name="lst:NamedPF-example"  class="Label">
            </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_565708">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">var</code> <code
 class="scala plain">f</code><code  class="scala value">1</code><code  class="scala keyword">:</code> <code
 class="scala plain">PartialFunction[Int,Int] </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala value">10</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala value">11</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala value">12</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala value">14</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">f</code><code  class="scala value">2</code><code  class="scala keyword">:</code> <code
 class="scala plain">PartialFunction[Int,Int] </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala value">20</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala value">11</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala value">22</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala value">14</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala plain">NamedPF(</code><code
 class="scala value">10</code><code  class="scala plain">, f</code><code  class="scala value">1</code> <code
 class="scala keyword">::</code> <code  class="scala plain">f</code><code  class="scala value">2</code> <code
 class="scala keyword">::</code> <code  class="scala plain">Nil)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Remember that many LiftRules variable are
        RuleSeq-s. Meaning that most of the times we re talking about lists of
        partial functions. Hence internally lift uses NamedPF for invoking such
        functions that are ultimately provided by the user. Please see
        <tt>LiftRules.dispatch</tt> </div>
      <h2  class="Section"> <a  name="toc-Section-C.14"  class="toc">C.14</a> 
        SecurityHelpers<a  name="sec:SecurityHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> Provides various functions used for random
        number generation, encryption/decriptions (blowfish), hash calculations
        (MD5, SHA, SHA-256) and so on. </div>
      <h2  class="Section"> <a  name="toc-Section-C.15"  class="toc">C.15</a> 
        TimeHelpers<a  name="sec:TimeHelpers"  class="Label"> </a> </h2>
      <div  class="Unindented"> Utility functions for time operations. For
        instance if also provides a set of implicit conversion functions that
        allow you to type “10 seconds” and returns the value in milliseconds. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Appendix-D"  class="toc">D</a> 
        Internationalization<a  name="cha:Internationalization"  class="Label">
        </a><a  href="#index-Internationalization---see-I18N"  name="entry-Internationalization---see-I18N-0"
 class="IndexReference">↓</a><a  href="#index-I18N"  name="entry-I18N-0"  class="IndexReference">↓</a> </h1>
      <div  class="Unindented"> The ability to display pages to users of
        multiple languages is a common feature of many web frameworks. Lift
        builds on the underlying Java I18N foundations<span  class="FootOuter"><span
 class="SupFootMarker"> [G] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [G] </span>Primarily java.util.Locale and java.util.ResourceBundle</span></span>
        to provide a simple yet flexible means for using Locales and translated
        strings in your app. Locales are used to control not only what language
        the text is in that’s presented to the user, but also number and date
        formatting, among others. If you want more details on the underlying
        foundation of Java I18N we suggest you visit the Internationalization
        Homepage at <a  href="http://java.sun.com/javase/technologies/core/basic/intl/"
 class="FlexURL">http://java.sun.com/javase/technologies/core/basic/intl/</a>.
      </div>
      <div  class="Indented"> Another note is that languages are selected in
        Lift using language tags, as defined in <a  href="http://www.w3.org/International/articles/language-tags/"
 class="FlexURL">http://www.w3.org/International/articles/language-tags/</a>.
        Language tags are base on the ISO 639 standard<span  class="FootOuter"><span
 class="SupFootMarker"> [H] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [H] </span><a  href="http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes"
 class="FlexURL">http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes</a></span></span>.
        In general, you should keep language tags as short as possible and avoid
        adding information (such as regional specifiers) that does not provide
        otherwise distinguishing information. For example, if your Spanish page
        will be used for both Mexican and Spanish clients without modification,
        simply use <tt>es</tt> and not <tt>es_MX</tt> or
        <tt>es_ES</tt>. </div>
      <h2  class="Section"> <a  name="toc-Section-D.1"  class="toc">D.1</a> 
        Localized Templates<a  name="sec:Localized-Templates"  class="Label"> </a><a
 href="#index-I18N-Localized-templates"  name="entry-I18N-Localized-templates-0"
 class="IndexReference">↓</a>
      </h2>
      <div  class="Unindented"> As we described in Розділ <a  href="#sec:Templates"
 class="Reference">4.1 on page 1↑</a>, Lift automatically chooses the
        template for a request based on the current locale by appending the
        locale’s variants. That means that a request for
        <tt>/index</tt> with a calculated locale of
        <tt>en_US</tt> will try these filenames, in order: </div>
      <ul>
        <li> <tt>index_en_US.html</tt> </li>
        <li> <tt>index_en.html</tt> </li>
        <li> <tt>index.html</tt> </li>
      </ul>
      <div  class="Unindented"> Note that Java upper-cases the country portion
        of the locale, so you need to make sure you name your templates
        accordingly. For instance, in the above example a file named
        <tt>index_en_us.html</tt> wouldn’t match. </div>
      <h2  class="Section"> <a  name="toc-Section-D.2"  class="toc">D.2</a> 
        Resource Bundles<a  name="sec:Resource-Bundles"  class="Label"> </a> </h2>
      <div  class="Unindented"> Resource bundles are sets of property files<span
 class="FootOuter"><span  class="SupFootMarker"> [I] </span><span  class="HoverFoot"><span
 class="SupFootMarker">  [I] </span>Technically, they can have
            other formats, but Lift generally only deals with
            <tt>PropertyResourceBundles</tt></span></span> that
        contain keyed strings for your application to use in messages. In
        addition to the key/value pair contents of the files, the filename
        itself is significant. When a <tt>ResourceBundle</tt> is
        specified by name, the base name is used as the default, and additional
        files with names of the form “<base name>_<language tag>”
        can be used to specify translations of the default strings in a given
        language. As an example, consider listing <a  href="#lst:Default-door-bundle"
 class="Reference">D.2↓</a>, which specifies a default resource bundle
        for an application that reports the status of a door (open or closed). </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Default Door Bundle<a  name="lst:Default-door-bundle"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_915282">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">openStatus</code><code
 class="scala keyword">=</code><code  class="scala plain">The door is open</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">closedStatus</code><code
 class="scala keyword">=</code><code  class="scala plain">The door is closed</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Suppose this file is called
        “DoorMessages.properties”; we can provide an additional translation for
        Spanish by creating a file called “DoorMessages_es.properties”, shown in
        listing <a  href="#lst:Spanish-door-bundle"  class="Reference">D.2↓</a>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Spanish Door Bundle<a  name="lst:Spanish-door-bundle"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_436676">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">openStatus</code><code
 class="scala keyword">=</code><code  class="scala plain">La puerta está abierta</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">closedStatus</code><code
 class="scala keyword">=</code><code  class="scala plain">La puerta está cerrada</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> When you want to retrieve a message (covered in
        the next two sections) Lift will check the current Locale and see if
        there’s a specialized ResourceBundle available for it. If so, it uses
        the messages in that file; otherwise, it uses the default bundle. </div>
      <div  class="Indented"> Lift supports using multiple resource bundle files
        so that you can break your messages up into functional groups. You
        specify this by setting the <tt>LiftRules.resourceNames</tt>
        property to a list of the base names (without a language or
        “.properties” extension): </div>
      <pre  class="LyX-Code">LiftRules.resourceNames = "DoorMessages" :: 
                          "DoorknobMessages" :: Nil
</pre>
      <div  class="Unindented"> The order that you define the resource bundle
        names is the order that they’ll be searched for keys. The message
        properties files should be located in your
        <tt>WEB-INF/classes</tt> folder so that they are accessible
        from Lift’s classloader<span  class="FootOuter"><span  class="SupFootMarker"> 
            [J] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [J] </span>The properties files are retrieved with
            <tt>ClassLoader.getResourceAsStream</tt></span></span>;
        if you’re using Maven this will happen if you put your files in the
        <tt>src/main/resources</tt> directory. </div>
      <div  class="Indented">
        <div  class="center">
          <div  style="width: 75%;"  class="Shadowbox"> Note: According to the
            <tt>Properties</tt> documentation<span  class="FootOuter"><span  class="SupFootMarker"> [K] </span><span
 class="HoverFoot"><span  class="SupFootMarker"> [K] </span><a  href="http://download.oracle.com/javase/6/docs/api/java/util/Properties.html"
 class="FlexURL">http://download.oracle.com/javase/6/docs/api/java/util/Properties.html</a></span></span>,
            keys <i>must</i> escape significant whitespace, colons or equals
            signs in the key itself with backslashes. For example, to specify
            “this = that” as a key, you would have to write it as “this\ \=\
            that” in the properties file.<a  href="#index-I18N-whitespace-in-keys"
 name="entry-I18N-whitespace-in-keys-0"  class="IndexReference">↓</a>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-D.3"  class="toc">D.3</a> An
        Important Note on Resource Bundle Resolution<a  href="#index-I18N-Resource-bundle-resolution"
 name="entry-I18N-Resource-bundle-resolution-0"  class="IndexReference">↓</a>
      </h2>
      <div  class="Unindented"> Per Java’s documentation on <a  href="http://java.sun.com/javase/6/docs/api/java/util/ResourceBundle.html#getBundle%28java.lang.String,%20java.util.Locale,%20java.lang.ClassLoader%29"
 class="URL">ResourceBundle</a>, resolution of property files is done
        in this order: </div>
      <ul>
        <li> baseName + “_” + language1 + “_” + country1 + “_” + variant1 </li>
        <li> baseName + “_” + language1 + “_” + country1 </li>
        <li> baseName + “_” + language1 </li>
        <li> baseName + “_” + language2 + “_” + country2 + “_” + variant2 </li>
        <li> baseName + “_” + language2 + “_” + country2 </li>
        <li> baseName + “_” + language2 </li>
        <li> baseName </li>
      </ul>
      <div  class="Unindented"> where “language1”, “country1”, and “variant1”
        are the requested locale parameters, and “language2”, “country2”,
        “variant2” are the default locale parameters. </div>
      <div  class="Indented"> For example, if the default locale for your
        computer is “en_GB”, someone requests a page for “ja”, and you have the
        following property files defined: </div>
      <ul>
        <li> Messages_fr_FR.properties </li>
        <li> Messages_en_GB.properties </li>
        <li> Messages.properties </li>
      </ul>
      <div  class="Unindented"> then the <b>Messages_en_GB.properties</b> file,
        and not <b>Messages.properties</b> will be used. If you want to change
        this behavior so that any undefined locales utilize the base properties
        file, set your default Locale to the ROOT locale in your
        <tt>Boot.scala</tt> with the code shown in Listing <a  href="#lst:Setting-the-ROOT-locale"
 class="Reference">D.3↓</a>: </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Setting-the-ROOT-locale"  class="Label">
            </a>Setting the ROOT Default Locale </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_245431">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">java.util.Locale</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">Locale.setDefault(Locale.ROOT)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-D.4"  class="toc">D.4</a> 
        Localized Strings in Scala Code<a  name="sec:Localized-Strings-in-Scala"
 class="Label"> </a> </h2>
      <div  class="Unindented"> Retrieving localized strings in your Scala code
        is primarily performed using the <tt>S.?</tt> method. When
        invoked with one argument the resource bundles are searched for a key
        matching the given argument. If a matching value is found it’s returned.
        If it can’t be found then Lift calls
        <tt>LiftRules.localizationLookupFailureNotice</tt> on the
        (key, current Locale) pair and then simply returns the key. If you call
        <tt>S.?</tt> with more than one argument, the first argument
        is still the key to look up, but any remaining arguments are used as
        format parameters for <tt>String.format</tt> executed on the
        retrieved value. For example, listing <a  href="#lst:Formatted-bundles"
 class="Reference">D.4↓</a> shows a sample bundle file and the
        associated Scala code for using message formatting. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Formatted Bundles<a  name="lst:Formatted-bundles"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_85355">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// bundle</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">tempMsg</code><code
 class="scala keyword">=</code><code  class="scala plain">The current temperature is </code><code
 class="scala keyword">%</code><code  class="scala value">0.1</code> <code  class="scala plain">degrees</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala comments">// code</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">var</code> <code
 class="scala plain">currentTmp </code><code  class="scala keyword">:</code> <code
 class="scala plain">Double </code><code  class="scala keyword">=</code> <code  class="scala plain">getTemp()</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">Text(S.?(</code><code
 class="scala string">"tempMsg"</code><code  class="scala plain">, currentTemp))</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Lift also provides the <tt>S.??</tt>
        method, which is similar to <tt>S.?</tt> but uses the
        <tt>ResourceBundle</tt> for internal Lift strings. Lift’s
        resource-bundles are located in the i18n folder with the name
        lift-core.properties The resource-bundle name is given by
        <tt>LiftRules.liftCoreResourceName</tt> variable. Generally
        you won’t use this method. </div>
      <h2  class="Section"> <a  name="toc-Section-D.5"  class="toc">D.5</a> 
        Formatting Localized Strings </h2>
      <div  class="Unindented"> While Lift provides facilities for retrieving
        strings from localized property bundles (Розділ <a  href="#sec:Localized-Strings-in-Scala"
 class="Reference">D.4↑</a>), it does not provide direct support for
        localized formatting of those strings. There is an
        <tt>S.?</tt> method which takes additional parameters, but
        it uses <tt>String.format</tt> (and printf syntax) to format
        the strings and does not properly support date/time formatting. Instead,
        we recommend you use <tt>java.text.MessageFormat</tt> for
        localized strings that will use parameters. Listing <a  href="#lst:A-Utility-Method-l10n"
 class="Reference">D.5↓</a> shows a utility method that you can use in
        your code to localize strings with parameters. Note that if you have a
        lot of Lift’s implicit conversions in scope you may need to explicitly
        type some arguments as we have in this example. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> A Utility Method for Localizing Strings<a  name="lst:A-Utility-Method-l10n"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_791132">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">private</code> <code
 class="scala keyword">def</code> <code  class="scala plain">i</code><code  class="scala value">10</code><code
 class="scala plain">n(key </code><code  class="scala keyword">:</code> <code  class="scala plain">String, args </code><code
 class="scala keyword">:</code> <code  class="scala plain">Object*) </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces"> </code><code
 class="scala keyword">import</code> <code  class="scala plain">java.text.{FieldPosition,MessageFormat}</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces"> </code><code
 class="scala keyword">val</code> <code  class="scala plain">formatter </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">MessageFormat(S.?(key), S.locale)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces"> </code><code
 class="scala plain">formatter.format(args.toArray, </code><code  class="scala keyword">new</code> <code
 class="scala plain">StringBuffer, </code><code  class="scala keyword">new</code> <code
 class="scala plain">FieldPosition(</code><code  class="scala value">0</code><code
 class="scala plain">)).toString</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala plain">}</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala comments">// Usage:</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain"><span>{i</code><code
 class="scala value">10</code><code  class="scala plain">n(</code><code  class="scala string">"welcome"</code><code
 class="scala plain">, </code><code  class="scala keyword">new</code> <code  class="scala plain">java.util.Date, </code><code
 class="scala value">6</code> <code  class="scala keyword">:</code> <code  class="scala plain">Integer)}</span></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-D.6"  class="toc">D.6</a> 
        Localized Strings in Templates<a  href="#index-I18N-Localized-templates"
 name="entry-I18N-Localized-templates-1"  class="IndexReference">↓</a>
      </h2>
      <div  class="Unindented"> You can add localized strings directly in your
        templates through the <tt><lift:loc /></tt> tag. You
        can either provide a locid attribute on the tag which is used as the
        lookup key, or if you don’t provide one, the contents of the tag will be
        used as the key. In either case, if the key can’t be found in any
        resource bundles, the contents of the tag will be used. Listing <a  href="#lst:Using-the-loc-tag"
 class="Reference">D.6↓</a> shows some examples of how you could use
        lift:loc. In both examples, assume that we’re using the resource bundle
        shown in listing <a  href="#lst:Spanish-door-bundle"  class="Reference">D.2↑</a>. The fallthrough behavior lets us put a
        default text (English) directly in the template, although for
        consistency you should usually provide an explicit bundle for all
        languages. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Using the loc tag<a  name="lst:Using-the-loc-tag"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_960999">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml comments"><!-- using explicit key (preferred) --></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">lift:loc</code> <code  class="xml color1">locid</code><code
 class="xml plain">=</code><code  class="xml string">"openStatus"</code><code  class="xml plain">>The door is open</</code><code
 class="xml keyword">lift:loc</code><code  class="xml plain">></code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml comments"><!-- should be the same result, but a missing bundle</code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml spaces">     </code><code
 class="xml comments">will result in the key being displayed --></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">lift:loc</code><code  class="xml plain">>openStatus</</code><code
 class="xml keyword">lift:loc</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-D.7"  class="toc">D.7</a> 
        Calculating Locale<a  href="#index-I18N-Calculating-locale"  name="entry-I18N-Calculating-locale-0"
 class="IndexReference">↓</a><a  href="#index-Locale-calculating"  name="entry-Locale-calculating-0"
 class="IndexReference">↓</a> </h2>
      <div  class="Unindented"> The <tt>Locale</tt> for a given
        request is calculated by the function set in<tt>
        LiftRules.localeCalculator</tt>, a <span  class="formula">(<i>Box</i>[<i>HttpServletRequest</i>])
           ⇒ <i>Locale</i></span>. The default behavior is to call
        <tt>getLocale</tt> on the <tt>HTTPRequest</tt>,
        which allows the server to set it if your clients send locale
        preferences. If that call returns null, then
        <tt>Locale.getDefault</tt> is used. You can provide your own
        function for calculating locales if you desire. </div>
      <div  class="Indented"> Listing <a  href="#lst:Calculating-Locale-Based"  class="Reference">D.7↓</a> shows how you can use a cookie in addition
        to a URL query parameter to select the locale for your pages<span  class="FootOuter"><span
 class="SupFootMarker"> [L] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [L] </span>Thanks to Tim Perret for the original examples at <a  href="http://blog.getintheloop.eu/2009/7/26/how-to-extensive-localization-with-the-liftweb-framework"
 class="FlexURL">http://blog.getintheloop.eu/2009/7/26/how-to-extensive-localization-with-the-liftweb-framework</a></span></span>.
        This code would be placed in your <tt>Boot.boot</tt> method.
        Lines 2-3 define some imports beyond the standard imports (see Розділ <a
 href="#lst:Standard-import-statements"  class="Reference">3.3 on page 1↑</a>). Lines 6-10 define a utility
        function to convert a language tag string into a
        <tt>Locale</tt>. Line 13 defines the name of the cookie that
        will store your locale choice. Lines 15-34 define the partial function
        that will be used to compute the new <tt>Locale</tt>. First,
        we only do computation if the
        <tt>LiftRules.localeCalculator</tt> method is invoked with
        an <tt>HTTPRequest</tt> (line 16). Our next step is to
        determine the current locale by checking whether there is an existing
        locale cookie set (lines 18-20), or by utilizing the default Lift locale
        calculator (line 21). Our next check is to determine if the user has
        explicitly requested a locale via a query parameter (line 24). If the
        parameter is set (and not <tt>null</tt>), we construct a new
        <tt>Locale</tt> from the value (line 26), set the cookie so
        that the request is remembered (line 27), and return the new locale. If
        there is no request parameter then we use the current locale as defined
        on line 18. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Calculating Locale Based on Cookies and
            Parameters<a  name="lst:Calculating-Locale-Based"  class="Label"> </a>
          </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_21237">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Import the classes we’ll be using beyond the standard imports</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">java.util.Locale</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">provider.{HTTPCookie,HTTPRequest}</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala comments">// Properly convert a language tag to a Locale</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">def</code> <code
 class="scala plain">computeLocale(tag </code><code  class="scala keyword">:</code> <code
 class="scala plain">String) </code><code  class="scala keyword">=</code> <code
 class="scala plain">tag.split(Array(’-’, ’</code><code  class="scala keyword">_</code><code
 class="scala plain">’)) </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Array(lang) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code><code  class="scala keyword">new</code> <code
 class="scala plain">Locale(lang)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Array(lang, country) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code><code  class="scala keyword">new</code> <code
 class="scala plain">Locale(lang, country)</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">Array(lang, country, variant) </code><code
 class="scala keyword">=</code><code  class="scala plain">> </code><code  class="scala keyword">new</code> <code
 class="scala plain">Locale(lang, country, variant)</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala comments">// Define this to be whatever name you want</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">LOCALE</code><code  class="scala keyword">_</code><code  class="scala plain">COOKIE</code><code
 class="scala keyword">_</code><code  class="scala plain">NAME </code><code  class="scala keyword">=</code> <code
 class="scala string">"SelectedLocale"</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala plain">LiftRules.localeCalculator </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">fullReq </code><code
 class="scala keyword">@</code> <code  class="scala plain">Full(req) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// Check against a set cookie, or the locale sent in the request </code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">def</code> <code  class="scala plain">currentLocale </code><code
 class="scala keyword">:</code> <code  class="scala plain">Locale </code><code  class="scala keyword">=</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">S.findCookie(LOCALE</code><code  class="scala keyword">_</code><code
 class="scala plain">COOKIE</code><code  class="scala keyword">_</code><code  class="scala plain">NAME).flatMap { </code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">cookie </code><code  class="scala keyword">=</code><code  class="scala plain">> cookie.value.map(computeLocale) </code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">} openOr LiftRules.defaultLocaleCalculator(fullReq)</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">    </code><code
 class="scala comments">// Check to see if the user explicitly requests a new locale </code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">S.param(</code><code  class="scala string">"locale"</code><code
 class="scala plain">) </code><code  class="scala keyword">match</code> <code  class="scala plain">{ </code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">Full(requestedLocale) </code><code
 class="scala keyword">if</code> <code  class="scala plain">requestedLocale !</code><code
 class="scala keyword">=</code> <code  class="scala keyword">null</code> <code  class="scala keyword">=</code><code
 class="scala plain">> { </code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">val</code> <code  class="scala plain">computedLocale </code><code
 class="scala keyword">=</code> <code  class="scala plain">computeLocale(requestedLocale) </code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">S.addCookie(HTTPCookie(LOCALE</code><code  class="scala keyword">_</code><code
 class="scala plain">COOKIE</code><code  class="scala keyword">_</code><code  class="scala plain">NAME, requestedLocale)) </code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">computedLocale </code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> currentLocale </code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">} </code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> Locale.getDefault </code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Appendix-E"  class="toc">E</a> 
        Logging in Lift<a  name="cha:Logging-in-Lift"  class="Label"> </a> </h1>
      <div  class="Unindented"> Logging is a useful part of any application,
        Lift app or otherwise. Logging can be used to audit user actions, give
        insight into runtime performance and operation, and even to troubleshoot
        and debug issues. Lift comes with a thin logging facade that sits on top
        of the SLF4J library<span  class="FootOuter"><span  class="SupFootMarker"> 
            [M] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [M] </span><a  href="http://www.slf4j.org/"  class="FlexURL">http://www.slf4j.org/</a></span></span>.
        This facade provides simple access to most common logging functions and
        aims to be easy to use, flexible, and most important, inconspicuous. If
        you do decide that Lift’s logging facilities don’t meet your needs, it’s
        possible to use any Java logging framework you desire, but it’s still
        useful to understand Lift’s framework since Lift uses it internally for
        logging. </div>
      <h2  class="Section"> <a  name="toc-Section-E.1"  class="toc">E.1</a> 
        Logging Backend<a  name="sec:Logging-Backend"  class="Label"> </a> </h2>
      <div  class="Unindented"> The detailed configuration of SLF4J is outside
        the scope of this book, but we would like to highlight a few key notes
        concerning SLF4J. First, SLF4J splits the API from the implementation
        into separate JAR files. This allows you to choose the backing
        implementation that best suits your deployment. For example, SLF4J
        contains implementations for JDK logging, log4j, and more. For example,
        the JBoss application server version 5 and newer comes bundled with its
        own implementation of the SLF4J API, so you can simply deploy a Lift WAR
        on JBoss and use the server’s configuration and logging. Similarly,
        Jetty comes bundled with the SLF4J API. </div>
      <div  class="Indented"> Outside of container-provided implementations, the
        logback logging framework<span  class="FootOuter"><span  class="SupFootMarker"> 
            [N] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [N] </span><a  href="http://logback.qos.ch/"  class="FlexURL">http://logback.qos.ch/</a></span></span>
        is a very nice implementation of the SLF4J API. It’s written by the same
        people who wrote log4j and has much improved performance and
        functionality over log4j<span  class="FootOuter"><span  class="SupFootMarker"> 
            [O] </span><span  class="HoverFoot"><span  class="SupFootMarker"> 
              [O] </span><a  href="http://logback.qos.ch/reasonsToSwitch.html"  class="FlexURL">http://logback.qos.ch/reasonsToSwitch.html</a></span></span>.
        Because logback-classic implements the SLF4J API, you simply need to
        drop the logback-classic jar into your classpath, or add it as a
        dependency in your WAR to use it. One particularly nice feature of
        logback is that if it can’t locate a configuration file (which can be
        written in XML, Groovy, or soon, Scala), it will default to logging
        everything to the console. </div>
      <h2  class="Section"> <a  name="toc-Section-E.2"  class="toc">E.2</a> 
        Basic Logging </h2>
      <div  class="Unindented"> Logging in Lift is performed via the
        <tt>net.liftweb.common.Logger</tt> object and trait. The
        <tt>Logger</tt> object provides a set of utility methods for
        configuration and instantiation of logger instances. The
        <tt>Logger</tt> trait can be mixed into your snippet, comet,
        or other classes to provide direct methods for logging (we’ll cover
        these in Розділ <a  href="#sub:Logging-Methods"  class="Reference">E.2.3↓</a>). </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-E.2.1"  class="toc">E.2.1</a> 
        Logging Setup </h3>
      <div  class="Unindented"> The first step in utilizing Lift’s logging is to
        configure the logger. As we mentioned in Розділ <a  href="#sec:Logging-Backend"
 class="Reference">E.1↑</a>, Lift uses the SLF4J framework. The
        configuration of SLF4J depends on which backing implementation you use,
        but Lift comes with helpers for both log4j
        (<tt>net.liftweb.common.Log4j</tt>) and for logback
        (<tt>net.liftweb.common.Logback</tt>). These helpers are
        utilized with the <tt>Logger</tt> object’s
        <tt>setup</tt> var. The <tt>Log4j</tt> helpers
        provides methods that can be used to load a configuration from a
        <tt>String</tt>, a file (either XML or properties), or with
        Lift’s default (console) logging. The <tt>Logback</tt>
        helper provides a single method to load a configuration from an XML
        file. Listing <a  href="#lst:Configuring-Logback-via"  class="Reference">E.2.1↓</a> shows how you could use the
        <tt>Logback</tt> helper in the
        <tt>Boot.boot</tt> method to configure logging from the <i>logconfig.xml</i>
        file. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Configuring Logback via Logger.setup<a  name="lst:Configuring-Logback-via"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_950711">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">def</code> <code
 class="scala plain">boot {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Get a reference to the config from our classpath</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">logUrl </code><code
 class="scala keyword">=</code> <code  class="scala plain">LiftRules.getResource(</code><code
 class="scala string">"logconfig.xml"</code><code  class="scala plain">)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code> </div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">// Apply the reference, if found</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">logUrl.foreach { Logger.setup </code><code  class="scala keyword">=</code> <code
 class="scala plain">Logback.withFile(</code><code  class="scala keyword">_</code><code
 class="scala plain">) }</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-E.2.2"  class="toc">E.2.2</a> 
        Obtaining a Logger </h3>
      <div  class="Unindented"> There are two basic means of obtaining a logger
        instance. The first is to mix the <tt>Logger</tt> trait into
        your class. The second is to instantiate a logger using the
        <tt>Logger</tt> object’s <tt>apply</tt> methods.
      </div>
      <div  class="Indented"> Mixing the <tt>Logger</tt> trait into
        your class is a very simple way to add logging methods in your code, as
        shown in Listing. When you do this, the underlying logger will have a
        name derived from your class’s dynamic type. For example, Listing <a  href="#lst:Mixing-Logger-into"
 class="Reference">E.2.2↓</a> shows the definition of our
        <tt>Accounts</tt> snippet object with a
        <tt>Logger</tt> trait mixed in. When we log in the
        <tt>Accounts</tt> object the name will be the
        fully-qualified classname, or “com.pocketchangeapp.snippet.Accounts” in
        our case. When you mix the Logger trait into your class, you can access
        the logging methods (Розділ <a  href="#sub:Logging-Methods"  class="Reference">E.2.3↓</a>) directly. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Mixing Logger into a Class<a  name="lst:Mixing-Logger-into"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_106144">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">object</code> <code
 class="scala plain">Accounts </code><code  class="scala keyword">extends</code> <code
 class="scala plain">DispatchSnippet </code><code  class="scala keyword">with</code> <code
 class="scala plain">Logger {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">warn(</code><code  class="scala string">"This is a warning"</code><code
 class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> The second basic way to obtain a logger instance
        is to construct one directly via the <tt>Logger</tt>
        object’s <tt>apply</tt> method, as shown in Listing <a  href="#lst:Constructing-a-Logger"
 class="Reference">E.2.2↓</a>. The <tt>apply</tt> method
        takes either a <tt>String</tt> or <tt>Class</tt>
        that will be used to determine the constructed logger’s name. In our
        example, we use the <tt>classOf[Boot]</tt>, so our logger
        will be named “bootstrap.liftweb.Boot”. When you obtain a logger via
        construction you need to access the logging methods via the logger
        instance. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Constructing a Logger instance<a  name="lst:Constructing-a-Logger"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_968220">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Boot {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Set up a logger to use for startup messages</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">logger </code><code
 class="scala keyword">=</code> <code  class="scala plain">Logger(classOf[Boot])</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">logger.warn(</code><code  class="scala string">"This is a warning"</code><code
 class="scala plain">)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> There is a third, hybrid, approach to obtaining a
        <tt>Logger</tt> that allows you to mix in the
        <tt>Logger</tt> trait while controlling the logger name.
        Listing <a  href="#lst:Mixing-in-a-named-logger"  class="Reference">E.2.2↓</a> shows how we can mix in th trait and
        then override the underlying SLF4J logger with our own named instance. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Mixing in a named Logger<a  name="lst:Mixing-in-a-named-logger"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_962639">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">AddEntry </code><code  class="scala keyword">extends</code> <code
 class="scala plain">StatefulSnippet </code><code  class="scala keyword">with</code> <code
 class="scala plain">Logger {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">// Use a different name for our logger</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">import</code> <code  class="scala plain">org.slf</code><code
 class="scala value">4</code><code  class="scala plain">j.LoggerFactory</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">val</code> <code
 class="scala keyword">_</code><code  class="scala plain">logger </code><code  class="scala keyword">=</code> <code
 class="scala plain">LoggerFactory.getLogger(</code><code  class="scala string">"EntryEdit"</code><code
 class="scala plain">) </code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-E.2.3"  class="toc">E.2.3</a> 
        Logging Methods<a  name="sub:Logging-Methods"  class="Label"> </a> </h3>
      <div  class="Unindented"> The <tt>Logger</tt> trait provides
        some basic log methods which we’ll summarize here. Each log method comes
        in three forms: one with just a <span  class="formula"> ⇒ <i>Object</i></span>
        argument, one with a <span  class="formula">  ⇒ <i>Object</i></span>
        and <tt>Throwable</tt> argument, and one with a <span  class="formula"> 
          ⇒ <i>Object</i></span>, <tt>Throwable</tt>, and
        <tt>Marker</tt> argument. These correspond roughly to the
        SLF4J log methods, although the order of the parameters is different and
        the parameters are passed by-name. Pass-by-name arguments are used so
        that computation of the log message can be deferred. This is useful to
        avoid processing messages for log statements below the current logging
        threshold, a topic we’ll cover more in Розділ <a  href="#sec:Log-Levels"
 class="Reference">E.3↓</a>. </div>
      <div  class="Description"> <span  class="Description-entry">trace</span> 
        This logs a message at trace level. Trace level is generally intended
        for very detailed “tracing” of processing, even more detailed than debug
        level. </div>
      <div  class="Description"> <span  class="Description-entry">debug</span> 
        Logs a message at debug level. This level is usually used to output
        internal variable values or other information that is useful in
        debugging and troubleshooting an app. </div>
      <div  class="Description"> <span  class="Description-entry">info</span> 
        Logs a message at info level. This level is appropriate for general
        information about the app. </div>
      <div  class="Description"> <span  class="Description-entry">warn</span> 
        Logs a message at warning level. This level should be used for reporting
        issues that are in error but can be handled cleanly, such as someone
        trying to submit a character string for a numeric field value. </div>
      <div  class="Description"> <span  class="Description-entry">error</span> 
        Logs a message at error level. This level should be used for messages
        relating to errors that can’t be handled cleanly, such as a failure to
        connect to a backing database. </div>
      <div  class="Description"> <span  class="Description-entry">assertLog</span> 
        This allows you to test an assertion condition and if true, logs the
        assertion as well as a given message. </div>
      <div  class="Unindented"> Listing <a  href="#lst:Some-example-logging"  class="Reference">E.2.3↓</a> shows our REST API authentication hook,
        which uses a few different Logging methods within the handler method. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Some example logging<a  name="lst:Some-example-logging"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_507357">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">LiftRules.authentication </code><code
 class="scala keyword">=</code> <code  class="scala plain">HttpBasicAuthentication(</code><code
 class="scala string">"PocketChange"</code><code  class="scala plain">) {</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(userEmail, userPass, </code><code
 class="scala keyword">_</code><code  class="scala plain">) </code><code  class="scala keyword">=</code><code
 class="scala plain">> {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">logger.debug(</code><code  class="scala string">"Authenticating: "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">User.find(By(User.email, userEmail)).map { user </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">if</code> <code  class="scala plain">(user.password.match</code><code
 class="scala keyword">_</code><code  class="scala plain">?(userPass)) {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">logger.info(</code><code  class="scala string">"Auth succeeded for "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">User.logUserIn(user)</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala comments">// Set an MDC for logging purposes</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">        </code><code
 class="scala plain">MDC.put(</code><code  class="scala string">"user"</code><code
 class="scala plain">, user.shortName)</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">        </code><code
 class="scala comments">// Compute all of the user roles</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">userRoles(user.editable.map(acct </code><code  class="scala keyword">=</code><code
 class="scala plain">> AuthRole(</code><code  class="scala string">"editAcct:"</code> <code
 class="scala plain">+ acct.id)) ++</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">                  </code><code
 class="scala plain">user.allAccounts.map(acct </code><code  class="scala keyword">=</code><code
 class="scala plain">> AuthRole(</code><code  class="scala string">"viewAcct:"</code> <code
 class="scala plain">+ acct.id)))</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">        </code><code
 class="scala keyword">true</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">logger.warn(</code><code  class="scala string">"Auth failed for "</code> <code
 class="scala plain">+ userEmail)</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">        </code><code
 class="scala keyword">false</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">}</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} openOr </code><code  class="scala keyword">false</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <h2  class="Section"> <a  name="toc-Section-E.3"  class="toc">E.3</a> Log
        Level Guards<a  name="sec:Log-Levels"  class="Label"> </a> </h2>
      <div  class="Unindented"> We want to provide a brief discussion on the use
        of log guards and why they’re usually not needed with Lift’s log
        framework. A log guard is a simple test to see if a given log statement
        will actually be processed. The Log object provides a test method
        (returning a boolean) for each log level: </div>
      <ul>
        <li> isDebugEnabled </li>
        <li> isErrorEnabled </li>
        <li> isInfoEnabled </li>
        <li> isTraceEnabled </li>
        <li> isWarnEnabled </li>
      </ul>
      <div  class="Unindented"> Log guards are fairly common in logging
        frameworks to avoid expensive computation of log message that won’t
        actually be used. This is particularly relevant with debug logging,
        since they often cover a large section of code and usually aren’t
        enabled in production. The Log object can implicitly do log guards for
        you because of the pass-by-name message parameters. As we showed in
        listing <a  href="#lst:Some-example-logging"  class="Reference">E.2.3↑</a>, simply converting your log message into
        a closure allows the Log object decide whether to execute the closure
        based on the current log level. You get the flexibility and simplicity
        of adding log statements anywhere you want without explicit log guards,
        without losing the performance benefit of the guards. To explain it a
        bit more, let’s assume for instace that the <tt>debug</tt>
        method would have been declared as <tt>def debug(msg:AnyRef):
        Unit. </tt>When <tt>debug</tt> would be called the
        parameter will be first evaluated and then passed to the method. Inside
        the method we have the test to see if the debug level is enabled to know
        if we actaully need to trace that message or not. Well in this case even
        if the debugging level is turned off we still have the evaluation of the
        parameters and that leads to unnecessary computing and in an application
        that uses logging heavily that would likely lead to a performance
        impact. </div>
      <h2  class="Section"> <a  name="toc-Section-E.4"  class="toc">E.4</a> 
        Logging Mapper Queries<a  name="sec:Logging-Mapper-Queries"  class="Label">
        </a> </h2>
      <div  class="Unindented"> If you want to log Mapper query activity, there
        are two main approaches. The first is to utilize the
        <tt>net.liftweb.mapper.DB.addLogFunc</tt> method to add your
        own logging function. A logging function is of the type <span  class="formula">(<i>DBLog</i>,
           <i>Long</i>) ⇒ <i>Any</i></span>. The <tt>DBLog</tt>
        trait contains two separate lists of log entries, one for meta
        operations (such as <tt>getFetchSize</tt>) and one for
        actual work statements (such as <tt>executeQuery</tt>). You
        can access these two log lists via either the
        <tt>metaEntries</tt> or
        <tt>statementEntries</tt> methods. You can also access the
        entire list of both types via the <tt>allEntries</tt>
        method. Listing <a  href="#lst:Basic-Mapper-Logging"  class="Reference">E.4↓</a> shows how we can hook a log function in
        the <tt>Boot.boot</tt> method to log Mapper activity for
        each request. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Basic Mapper Logging<a  name="lst:Basic-Mapper-Logging"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_870729">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Add a query logger</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">DB.addLogFunc {</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(log, duration) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">logger.debug(</code><code  class="scala string">"Total query time : %d ms"</code><code
 class="scala plain">.format(duration))</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">log.allEntries.foreach {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">DBLogEntry(stmt,duration) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">logger.debug(</code><code  class="scala string">"  %s in %d ms"</code><code
 class="scala plain">.format(stmt, duration))</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Another approach to logging Mapper queries is to
        use the <tt>DB.queryCollector</tt> logging function and then
        either use <tt>S.queryLog</tt> to access the query log, or
        hook into <tt>S.addAnalyzer</tt>. Listing <a  href="#lst:Mapper-Logging-via-S-queryLog"
 class="Reference">E.4↓</a> shows how we could use this instead for
        our logging in <tt>Boot.boot</tt>. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Mapper Logging via S.queryLog<a  name="lst:Mapper-Logging-via-S-queryLog"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_357102">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala comments">// Add a query logger (via S.queryLog)</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">DB.addLogFunc(DB.queryCollector)</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">S.addAnalyzer {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala plain">(Full(req), duration, log) </code><code
 class="scala keyword">=</code><code  class="scala plain">> {</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">logger.debug((</code><code  class="scala string">"Total request time on %s: %d ms"</code><code
 class="scala plain">).format(req.uri, duration))</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">log.foreach {</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">(stmt,duration) </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">        </code><code
 class="scala plain">logger.debug(</code><code  class="scala string">"  %s in %d ms"</code><code
 class="scala plain">.format(stmt, duration))</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">case</code> <code  class="scala keyword">_</code> <code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala comments">// we don’t log for non-requests</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> Note that the duration you get when your analyzer
        function is called is the time spent in <tt>S</tt>, not
        necessarily the total duration of your queries. Also, only work
        statements are logged via <tt>S.queryLog</tt>. If you want
        meta entries you’ll have to use a direct logging function as in Listing
        <a  href="#lst:Basic-Mapper-Logging"  class="Reference">E.4↑</a>. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Appendix-F"  class="toc">F</a> 
        Sending Email<a  name="cha:Sending-Email"  class="Label"> </a> </h1>
      <div  class="Unindented"> Sending email is a common enough task (user
        registration, notifications, etc) within a web application that we’ve
        decided to cover it here. Although email isn’t Lift’s primary focus,
        Lift does provide some facilities to simplify email transmission. </div>
      <h2  class="Section"> <a  name="toc-Section-F.1"  class="toc">F.1</a> 
        Setup </h2>
      <div  class="Unindented"> Configuration of the mailer is handled in a few
        different ways. The <tt>net.liftweb.util.Mailer</tt> object
        defines a <tt>hostFunc</tt> function var, <span  class="formula">()
           ⇒ <i>String</i></span>, that is used to compute the hostname of your
        SMTP server to be used for transmission. The default value is a function
        that looks up the <tt>mail.smtp.host</tt> system property
        and uses that String. If that property isn’t defined then the mailer
        defaults to <tt>localhost</tt>. Setting the system property
        is the simplest way to change your SMTP relay, although you could also
        define your own function to return a custom hostname and assign it to
        <tt>Mailer.hostFunc</tt>. </div>
      <h2  class="Section"> <a  name="toc-Section-F.2"  class="toc">F.2</a> 
        Sending Emails </h2>
      <div  class="Unindented"> The mailer interface is simple but covers a wide
        variety of cases. The <tt>Mailer</tt> object defines a
        number of case classes that correspond to the components of an RFC822
        email. The addressing and subject cases classes,
        <tt>From</tt>, <tt>To</tt>,
        <tt>CC</tt>, <tt>BCC</tt>,
        <tt>ReplyTo</tt> and <tt>Subject</tt> should all
        be self-explanatory. For the body of the email you have three main
        options: </div>
      <div  class="Description"> <span  class="Description-entry">PlainMailBodyType</span> 
        Represents a plain-text email body based on a given String </div>
      <div  class="Description"> <span  class="Description-entry">XHTMLMailBodyType</span> 
        Represents an XHTML email body based on a given NodeSeq </div>
      <div  class="Description"> <span  class="Description-entry">XHTMLPlusImages</span> 
        Similar to XHTMLMailBodyType, but in addition to the NodeSeq, you can
        provide one or more PlusImageHolder instances that represent images to
        be attached to the email (embedded images, so to speak) </div>
      <div  class="Unindented"> The <tt>Mailer.sendMail</tt>
        function is used to generate and send an email. It takes three
        arguments: the <tt>From</tt> sender address, the
        <tt>Subject</tt> of the email, and a varargs list of
        recipient addresses and body components. The mailer creates
        MIME/Multipart messages, so you can send more than one body (i.e. plain
        text and XHMTL) if you would like. Listing <a  href="#lst:Sending-a-two-part-email"
 class="Reference">F.2↓</a> shows an example of sending an email to a
        group of recipients in both plain text and XHTML format. The Mailer
        object defines some implicit conversions to PlainMailBodyType and
        XHTMLMailBodyType, which we use here. We also have to do a little List
        trickery to be able to squeeze multiple arguments into the final vararg
        argument since Scala doesn’t support mixing regular values and coerced
        sequences in vararg arguments. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> Sending a two-part email<a  name="lst:Sending-a-two-part-email"
 class="Label"> </a> </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_778520">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">net.liftweb.util.Mailer</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">Mailer.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala plain">...</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">myRecips </code><code  class="scala keyword">:</code> <code
 class="scala plain">List[String] </code><code  class="scala keyword">=</code> <code
 class="scala plain">...</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">val</code> <code
 class="scala plain">plainContent </code><code  class="scala keyword">:</code> <code
 class="scala plain">String </code><code  class="scala keyword">=</code> <code  class="scala string">"..."</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">val</code> <code
 class="scala plain">xhtmlContent </code><code  class="scala keyword">:</code> <code
 class="scala plain">NodeSeq </code><code  class="scala keyword">=</code> <code
 class="scala plain">...</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala plain">Mailer.sendMail(From(</code><code
 class="scala string">"no-reply@foo.com"</code><code  class="scala plain">), Subject(</code><code
 class="scala string">"Just a test"</code><code  class="scala plain">),</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala spaces">                </code><code
 class="scala plain">(plainContent </code><code  class="scala keyword">::</code> <code
 class="scala plain">xhtmlContent </code><code  class="scala keyword">::</code> <code
 class="scala plain">myRecips.map(To(</code><code  class="scala keyword">_</code><code
 class="scala plain">))) </code><code  class="scala keyword">:</code> <code  class="scala keyword">_</code><code
 class="scala plain">*)</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented"> When you call <tt>sendMail</tt> you’re
        actually sending a message to an actor in the background that will
        handle actual mail delivery; because of this, you shouldn’t expect to
        see a synchronous relay of the message through your SMTP server. </div>
      <div  class="Indented"> </div>
      <h1  class="Chapter"> <a  name="toc-Appendix-G"  class="toc">G</a> JPA
        Code Listings<a  name="cha:Code-Listings"  class="Label"> </a> </h1>
      <div  class="Unindented"> To conserve space and preserve flow in the main
        text, we’ve placed full code listings for the JPA chapter in this
        appendix. </div>
      <h2  class="Section"> <a  name="toc-Section-G.1"  class="toc">G.1</a> JPA
        Library Demo </h2>
      <div  class="Unindented"> The full library demo is available under the
        main Lift Git repository at <a  href="http://github.com/lift/lift/tree/master/examples/JPADemo/"
 class="FlexURL">http://github.com/lift/lift/tree/master/examples/JPADemo/</a>.
        To illustrate some points, we’ve included selected listings from the
        project. </div>
      <div  class="Indented">
        <p><br />
        </p>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-G.1.1"  class="toc">G.1.1</a> 
        Author Entity </h3>
      <div  class="Unindented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Author.scala"  class="Label"> </a>Author.scala
            </div>
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_789983">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala keyword">package</code> <code
 class="scala plain">com.foo.jpaweb.model</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">javax.persistence.</code><code  class="scala keyword">_</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala comments">/**</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">An author is someone who writes books.</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala comments">*/</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala keyword">@</code><code
 class="scala plain">Entity</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala keyword">class</code> <code
 class="scala plain">Author {</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">@</code><code  class="scala plain">Id</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">@</code><code  class="scala plain">GeneratedValue(){</code><code
 class="scala keyword">val</code> <code  class="scala plain">strategy </code><code
 class="scala keyword">=</code> <code  class="scala plain">GenerationType.AUTO}</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">id </code><code  class="scala keyword">:</code> <code
 class="scala plain">Long </code><code  class="scala keyword">=</code> <code  class="scala keyword">_</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">@</code><code  class="scala plain">Column{</code><code  class="scala keyword">val</code> <code
 class="scala plain">unique </code><code  class="scala keyword">=</code> <code  class="scala keyword">true</code><code
 class="scala plain">, </code><code  class="scala keyword">val</code> <code  class="scala plain">nullable </code><code
 class="scala keyword">=</code> <code  class="scala keyword">false</code><code  class="scala plain">}</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">name </code><code  class="scala keyword">:</code> <code
 class="scala plain">String </code><code  class="scala keyword">=</code> <code  class="scala string">""</code></div>
                        <div  class="line number16 index15 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">@</code><code  class="scala plain">OneToMany(){</code><code
 class="scala keyword">val</code> <code  class="scala plain">mappedBy </code><code
 class="scala keyword">=</code> <code  class="scala string">"author"</code><code
 class="scala plain">, </code><code  class="scala keyword">val</code> <code  class="scala plain">targetEntity </code><code
 class="scala keyword">=</code> <code  class="scala plain">classOf[Book], </code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">               </code><code
 class="scala keyword">val</code> <code  class="scala plain">cascade </code><code
 class="scala keyword">=</code> <code  class="scala plain">Array(CascadeType.REMOVE)}</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">var</code> <code  class="scala plain">books </code><code
 class="scala keyword">:</code> <code  class="scala plain">java.util.Set[Book] </code><code
 class="scala keyword">=</code> <code  class="scala keyword">new</code> <code  class="scala plain">java.util.HashSet[Book]()</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala plain">}</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <p><br />
        </p>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-G.1.2"  class="toc">G.1.2</a> 
        orm.xml<a  href="#index-orm.xml"  name="entry-orm.xml-2"  class="IndexReference">↓</a> Mapping </h3>
      <div  class="Unindented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:orm.xml"  class="Label"> </a>orm.xml
            </div> <?xml version="1.0" encoding="UTF-8" ?>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_518008">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">entity-mappings</code> <code  class="xml color1">xmlns</code><code
 class="xml plain">=</code><code  class="xml string">"<a  href="http://java.sun.com/xml/ns/persistence/orm">http://java.sun.com/xml/ns/persistence/orm</a>"</code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml spaces">    </code><code
 class="xml color1">xmlns:xsi</code><code  class="xml plain">=</code><code  class="xml string">"<a
 href="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</a>"</code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml spaces">    </code><code
 class="xml plain">xsi:schemaLocation="<a  href="http://java.sun.com/xml/ns/persistence/orm">http://java.sun.com/xml/ns/persistence/orm</a></code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml spaces">        </code><code
 class="xml plain"><a  href="http://java.sun.com/xml/ns/persistence/orm_1_0.xsd">http://java.sun.com/xml/ns/persistence/orm_1_0.xsd</a>" </code><code
 class="xml color1">version</code><code  class="xml plain">=</code><code  class="xml string">"1.0"</code><code
 class="xml plain">></code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml plain">​</code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">package</code><code  class="xml plain">>com.foo.jpaweb.model</</code><code
 class="xml keyword">package</code><code  class="xml plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">entity</code> <code  class="xml color1">class</code><code
 class="xml plain">=</code><code  class="xml string">"Book"</code><code  class="xml plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">named-query</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"findBooksByAuthor"</code><code
 class="xml plain">></code></div>
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">query</code><code  class="xml plain">></code><code
 class="xml color2"><![CDATA[from Book b where b.author.id = :id order by b.title]]></code><code
 class="xml plain"></</code><code  class="xml keyword">query</code><code  class="xml plain">></code></div>
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">named-query</code><code  class="xml plain">></code></div>
                        <div  class="line number12 index11 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">named-query</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"findBooksByDate"</code><code
 class="xml plain">></code></div>
                        <div  class="line number13 index12 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">query</code><code  class="xml plain">></code><code
 class="xml color2"><![CDATA[from Book b where b.published between :startDate and :endDate]]></code><code
 class="xml plain"></</code><code  class="xml keyword">query</code><code  class="xml plain">></code></div>
                        <div  class="line number14 index13 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">named-query</code><code  class="xml plain">></code></div>
                        <div  class="line number15 index14 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">named-query</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"findBooksByTitle"</code><code
 class="xml plain">></code></div>
                        <div  class="line number16 index15 alt1"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">query</code><code  class="xml plain">></code><code
 class="xml color2"><![CDATA[from Book b where lower(b.title) like :title order by b.title]]></code><code
 class="xml plain"></</code><code  class="xml keyword">query</code><code  class="xml plain">></code></div>
                        <div  class="line number17 index16 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">named-query</code><code  class="xml plain">></code></div>
                        <div  class="line number18 index17 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">named-query</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"findAllBooks"</code><code
 class="xml plain">></code></div>
                        <div  class="line number19 index18 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">query</code><code  class="xml plain">></code><code
 class="xml color2"><![CDATA[from Book b order by b.title]]></code><code  class="xml plain"></</code><code
 class="xml keyword">query</code><code  class="xml plain">></code></div>
                        <div  class="line number20 index19 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">named-query</code><code  class="xml plain">></code></div>
                        <div  class="line number21 index20 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">entity</code><code  class="xml plain">></code></div>
                        <div  class="line number22 index21 alt1"><code  class="xml plain">​</code></div>
                        <div  class="line number23 index22 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">entity</code> <code  class="xml color1">class</code><code
 class="xml plain">=</code><code  class="xml string">"Author"</code><code  class="xml plain">></code></div>
                        <div  class="line number24 index23 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">named-query</code> <code  class="xml color1">name</code><code
 class="xml plain">=</code><code  class="xml string">"findAllAuthors"</code><code
 class="xml plain">></code></div>
                        <div  class="line number25 index24 alt2"><code  class="xml spaces">      </code><code
 class="xml plain"><</code><code  class="xml keyword">query</code><code  class="xml plain">></code><code
 class="xml color2"><![CDATA[from Author a order by a.name]]></code><code  class="xml plain"></</code><code
 class="xml keyword">query</code><code  class="xml plain">></code></div>
                        <div  class="line number26 index25 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">named-query</code><code  class="xml plain">></code></div>
                        <div  class="line number27 index26 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">entity</code><code  class="xml plain">></code></div>
                        <div  class="line number28 index27 alt1"><code  class="xml plain">​</code></div>
                        <div  class="line number29 index28 alt2"><code  class="xml plain"></</code><code
 class="xml keyword">entity-mappings</code><code  class="xml plain">></code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <p><br />
        </p>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-G.1.3"  class="toc">G.1.3</a> 
        Enumv Trait </h3>
      <div  class="Unindented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:Enumv-Trait"  class="Label"> </a>Enumv
            Trait </div>
          package com.foo.jpaweb.model
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_854175">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala comments">/* adds a valueOf function, assumes name is defined</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala comments">add optional description */</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">trait</code> <code
 class="scala plain">Enumv  {</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala spaces">  </code> </div>
                        <div  class="line number6 index5 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">this</code><code  class="scala keyword">:</code> <code  class="scala plain">Enumeration </code><code
 class="scala keyword">=</code><code  class="scala plain">></code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">private</code> <code  class="scala keyword">var</code> <code
 class="scala plain">nameDescriptionMap </code><code  class="scala keyword">=</code> <code
 class="scala plain">scala.collection.mutable.Map[String, String]()</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">/* store a name and description for forms */</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">Value(name</code><code
 class="scala keyword">:</code> <code  class="scala plain">String, desc</code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">:</code> <code  class="scala plain">Value </code><code  class="scala keyword">=</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">nameDescriptionMap +</code><code  class="scala keyword">=</code> <code
 class="scala plain">(name -> desc)</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">new</code> <code  class="scala plain">Val(name)</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code> </div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">    </code><code
 class="scala comments">/* get description if it exists else name */</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">getDescriptionOrName(ev</code><code
 class="scala keyword">:</code> <code  class="scala keyword">this</code><code  class="scala plain">.Value) </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">try</code> <code  class="scala plain">{</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">nameDescriptionMap(</code><code  class="scala string">""</code><code
 class="scala plain">+ev)</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">catch</code> <code  class="scala plain">{</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala spaces">      </code><code
 class="scala keyword">case</code> <code  class="scala plain">e</code><code  class="scala keyword">:</code> <code
 class="scala plain">NoSuchElementException </code><code  class="scala keyword">=</code><code
 class="scala plain">> ev.toString</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala spaces">  </code><code
 class="scala comments">/* get name description pair list for forms */</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">getNameDescriptionList </code><code
 class="scala keyword">=</code>  <code  class="scala keyword">this</code><code  class="scala plain">.elements.toList.map(v </code><code
 class="scala keyword">=</code><code  class="scala plain">> (v.toString, getDescriptionOrName(v) ) ).toList</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">  </code><code
 class="scala comments">/* get the enum given a string */</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">def</code> <code  class="scala plain">valueOf(str</code><code
 class="scala keyword">:</code> <code  class="scala plain">String) </code><code
 class="scala keyword">=</code> <code  class="scala keyword">this</code><code  class="scala plain">.elements.toList.filter(</code><code
 class="scala keyword">_</code><code  class="scala plain">.toString </code><code
 class="scala keyword">==</code> <code  class="scala plain">str) </code><code  class="scala keyword">match</code> <code
 class="scala plain">{</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">Nil </code><code  class="scala keyword">=</code><code
 class="scala plain">> </code><code  class="scala keyword">null</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">case</code> <code  class="scala plain">x </code><code  class="scala keyword">=</code><code
 class="scala plain">> x.head</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <p><br />
        </p>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-G.1.4"  class="toc">G.1.4</a> 
        EnumerationType </h3>
      <div  class="Unindented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:EnumvType"  class="Label"> </a>EnumvType
            class </div>
          package com.foo.jpaweb.model
          <div>
            <div  class="syntaxhighlighter  scala"  id="highlighter_859210">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                      <div  class="line number34 index33 alt1">34</div>
                      <div  class="line number35 index34 alt2">35</div>
                      <div  class="line number36 index35 alt1">36</div>
                      <div  class="line number37 index36 alt2">37</div>
                      <div  class="line number38 index37 alt1">38</div>
                      <div  class="line number39 index38 alt2">39</div>
                      <div  class="line number40 index39 alt1">40</div>
                      <div  class="line number41 index40 alt2">41</div>
                      <div  class="line number42 index41 alt1">42</div>
                      <div  class="line number43 index42 alt2">43</div>
                      <div  class="line number44 index43 alt1">44</div>
                      <div  class="line number45 index44 alt2">45</div>
                      <div  class="line number46 index45 alt1">46</div>
                      <div  class="line number47 index46 alt2">47</div>
                      <div  class="line number48 index47 alt1">48</div>
                      <div  class="line number49 index48 alt2">49</div>
                      <div  class="line number50 index49 alt1">50</div>
                      <div  class="line number51 index50 alt2">51</div>
                      <div  class="line number52 index51 alt1">52</div>
                      <div  class="line number53 index52 alt2">53</div>
                      <div  class="line number54 index53 alt1">54</div>
                      <div  class="line number55 index54 alt2">55</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number2 index1 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">java.io.Serializable</code></div>
                        <div  class="line number3 index2 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">java.sql.PreparedStatement</code></div>
                        <div  class="line number4 index3 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">java.sql.ResultSet</code></div>
                        <div  class="line number5 index4 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">java.sql.SQLException</code></div>
                        <div  class="line number6 index5 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">java.sql.Types</code></div>
                        <div  class="line number7 index6 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number8 index7 alt1"><code  class="scala keyword">import</code> <code
 class="scala plain">org.hibernate.HibernateException</code></div>
                        <div  class="line number9 index8 alt2"><code  class="scala keyword">import</code> <code
 class="scala plain">org.hibernate.usertype.UserType</code></div>
                        <div  class="line number10 index9 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number11 index10 alt2"><code  class="scala comments">/**</code></div>
                        <div  class="line number12 index11 alt1"><code  class="scala spaces"> </code><code
 class="scala comments">* Helper class to translate enum for hibernate</code></div>
                        <div  class="line number13 index12 alt2"><code  class="scala spaces"> </code><code
 class="scala comments">*/</code></div>
                        <div  class="line number14 index13 alt1"><code  class="scala keyword">abstract</code> <code
 class="scala keyword">class</code> <code  class="scala plain">EnumvType(</code><code
 class="scala keyword">val</code> <code  class="scala plain">et</code><code  class="scala keyword">:</code> <code
 class="scala plain">Enumeration </code><code  class="scala keyword">with</code> <code
 class="scala plain">Enumv) </code><code  class="scala keyword">extends</code> <code
 class="scala plain">UserType {</code></div>
                        <div  class="line number15 index14 alt2"><code  class="scala spaces">  </code> </div>
                        <div  class="line number16 index15 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">val</code> <code  class="scala plain">SQL</code><code  class="scala keyword">_</code><code
 class="scala plain">TYPES </code><code  class="scala keyword">=</code> <code  class="scala plain">Array({Types.VARCHAR})</code></div>
                        <div  class="line number17 index16 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number18 index17 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">sqlTypes() </code><code  class="scala keyword">=</code> <code
 class="scala plain">SQL</code><code  class="scala keyword">_</code><code  class="scala plain">TYPES</code></div>
                        <div  class="line number19 index18 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number20 index19 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">returnedClass </code><code  class="scala keyword">=</code> <code
 class="scala plain">classOf[et.Value]</code></div>
                        <div  class="line number21 index20 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number22 index21 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">equals(x</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object, y</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object)</code><code  class="scala keyword">:</code> <code  class="scala plain">Boolean </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number23 index22 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">return</code> <code  class="scala plain">x </code><code  class="scala keyword">==</code> <code
 class="scala plain">y</code></div>
                        <div  class="line number24 index23 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number25 index24 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number26 index25 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">hashCode(x</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object) </code><code  class="scala keyword">=</code> <code
 class="scala plain">x.hashCode</code></div>
                        <div  class="line number27 index26 alt2"><code  class="scala plain">​</code></div>
                        <div  class="line number28 index27 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">nullSafeGet(resultSet</code><code  class="scala keyword">:</code> <code
 class="scala plain">ResultSet, names</code><code  class="scala keyword">:</code> <code
 class="scala plain">Array[String], owner</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object)</code><code  class="scala keyword">:</code> <code  class="scala plain">Object </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number29 index28 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">val</code> <code  class="scala plain">value </code><code
 class="scala keyword">=</code> <code  class="scala plain">resultSet.getString(names(</code><code
 class="scala value">0</code><code  class="scala plain">))</code></div>
                        <div  class="line number30 index29 alt1"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">(resultSet.wasNull()) </code><code
 class="scala keyword">return</code> <code  class="scala keyword">null</code></div>
                        <div  class="line number31 index30 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number32 index31 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">return</code> <code  class="scala plain">et.valueOf(value)</code></div>
                        <div  class="line number33 index32 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number34 index33 alt1"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number35 index34 alt2"><code  class="scala spaces">  </code> </div>
                        <div  class="line number36 index35 alt1"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">nullSafeSet(statement</code><code  class="scala keyword">:</code> <code
 class="scala plain">PreparedStatement, value</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object, index</code><code  class="scala keyword">:</code> <code
 class="scala plain">Int)</code><code  class="scala keyword">:</code> <code  class="scala plain">Unit </code><code
 class="scala keyword">=</code> <code  class="scala plain">{</code></div>
                        <div  class="line number37 index36 alt2"><code  class="scala spaces">    </code><code
 class="scala keyword">if</code> <code  class="scala plain">(value </code><code
 class="scala keyword">==</code> <code  class="scala keyword">null</code><code  class="scala plain">) {</code></div>
                        <div  class="line number38 index37 alt1"><code  class="scala spaces">      </code><code
 class="scala plain">statement.setNull(index, Types.VARCHAR)</code></div>
                        <div  class="line number39 index38 alt2"><code  class="scala spaces">    </code><code
 class="scala plain">} </code><code  class="scala keyword">else</code> <code  class="scala plain">{</code></div>
                        <div  class="line number40 index39 alt1"><code  class="scala spaces">      </code><code
 class="scala keyword">val</code> <code  class="scala plain">en </code><code  class="scala keyword">=</code> <code
 class="scala plain">value.toString</code></div>
                        <div  class="line number41 index40 alt2"><code  class="scala spaces">      </code><code
 class="scala plain">statement.setString(index, en)</code></div>
                        <div  class="line number42 index41 alt1"><code  class="scala spaces">    </code><code
 class="scala plain">}</code></div>
                        <div  class="line number43 index42 alt2"><code  class="scala spaces">  </code><code
 class="scala plain">}</code></div>
                        <div  class="line number44 index43 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number45 index44 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">deepCopy(value</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object)</code><code  class="scala keyword">:</code> <code  class="scala plain">Object </code><code
 class="scala keyword">=</code> <code  class="scala plain">value</code></div>
                        <div  class="line number46 index45 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number47 index46 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">isMutable() </code><code  class="scala keyword">=</code> <code
 class="scala keyword">false</code></div>
                        <div  class="line number48 index47 alt1"><code  class="scala spaces">    </code> </div>
                        <div  class="line number49 index48 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">disassemble(value</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object) </code><code  class="scala keyword">=</code> <code
 class="scala plain">value.asInstanceOf[Serializable]</code></div>
                        <div  class="line number50 index49 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number51 index50 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">assemble(cached</code><code  class="scala keyword">:</code> <code
 class="scala plain">Serializable, owner</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object)</code><code  class="scala keyword">:</code> <code  class="scala plain">Serializable </code><code
 class="scala keyword">=</code> <code  class="scala plain">cached</code></div>
                        <div  class="line number52 index51 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number53 index52 alt2"><code  class="scala spaces">  </code><code
 class="scala keyword">override</code> <code  class="scala keyword">def</code> <code
 class="scala plain">replace(original</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object, target</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object, owner</code><code  class="scala keyword">:</code> <code
 class="scala plain">Object) </code><code  class="scala keyword">=</code> <code
 class="scala plain">original</code></div>
                        <div  class="line number54 index53 alt1"><code  class="scala plain">​</code></div>
                        <div  class="line number55 index54 alt2"><code  class="scala plain">}</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div  class="Indented">
        <p><br />
        </p>
      </div>
      <h3  class="Subsection"> <a  name="toc-Subsection-G.1.5"  class="toc">G.1.5</a> 
        JPA web.xml<a  href="#index-web.xml"  name="entry-web.xml-2"  class="IndexReference">↓</a> </h3>
      <div  class="Unindented"> This shows the LiftFilter setup as well as the
        persistence-context-ref. </div>
      <div  class="Indented">
        <div  class="listing">
          <div  class="caption"> <a  name="lst:JPA-web.xml"  class="Label"> </a>JPA
            web.xml </div>
          <div>
            <div  class="syntaxhighlighter  xml"  id="highlighter_739972">
              <div  class="toolbar"><span><a  class="toolbar_item command_help help"
 href="#">?</a></span></div>
              <table  cellspacing="0"  cellpadding="0"  border="0">
                <tbody>
                  <tr>
                    <td  class="gutter">
                      <div  class="line number1 index0 alt2">1</div>
                      <div  class="line number2 index1 alt1">2</div>
                      <div  class="line number3 index2 alt2">3</div>
                      <div  class="line number4 index3 alt1">4</div>
                      <div  class="line number5 index4 alt2">5</div>
                      <div  class="line number6 index5 alt1">6</div>
                      <div  class="line number7 index6 alt2">7</div>
                      <div  class="line number8 index7 alt1">8</div>
                      <div  class="line number9 index8 alt2">9</div>
                      <div  class="line number10 index9 alt1">10</div>
                      <div  class="line number11 index10 alt2">11</div>
                      <div  class="line number12 index11 alt1">12</div>
                      <div  class="line number13 index12 alt2">13</div>
                      <div  class="line number14 index13 alt1">14</div>
                      <div  class="line number15 index14 alt2">15</div>
                      <div  class="line number16 index15 alt1">16</div>
                      <div  class="line number17 index16 alt2">17</div>
                      <div  class="line number18 index17 alt1">18</div>
                      <div  class="line number19 index18 alt2">19</div>
                      <div  class="line number20 index19 alt1">20</div>
                      <div  class="line number21 index20 alt2">21</div>
                      <div  class="line number22 index21 alt1">22</div>
                      <div  class="line number23 index22 alt2">23</div>
                      <div  class="line number24 index23 alt1">24</div>
                      <div  class="line number25 index24 alt2">25</div>
                      <div  class="line number26 index25 alt1">26</div>
                      <div  class="line number27 index26 alt2">27</div>
                      <div  class="line number28 index27 alt1">28</div>
                      <div  class="line number29 index28 alt2">29</div>
                      <div  class="line number30 index29 alt1">30</div>
                      <div  class="line number31 index30 alt2">31</div>
                      <div  class="line number32 index31 alt1">32</div>
                      <div  class="line number33 index32 alt2">33</div>
                    </td>
                    <td  class="code">
                      <div  class="container">
                        <div  class="line number1 index0 alt2"><code  class="xml plain"><?</code><code
 class="xml keyword">xml</code> <code  class="xml color1">version</code><code  class="xml plain">=</code><code
 class="xml string">"1.0"</code> <code  class="xml color1">encoding</code><code
 class="xml plain">=</code><code  class="xml string">"ISO-8859-1"</code><code  class="xml plain">?></code></div>
                        <div  class="line number2 index1 alt1"><code  class="xml plain">​</code></div>
                        <div  class="line number3 index2 alt2"><code  class="xml plain"><!DOCTYPE web-app</code></div>
                        <div  class="line number4 index3 alt1"><code  class="xml plain">PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"</code></div>
                        <div  class="line number5 index4 alt2"><code  class="xml plain">"<a
 href="http://java.sun.com/j2ee/dtds/web-app_2_3.dtd">http://java.sun.com/j2ee/dtds/web-app_2_3.dtd</a>"></code></div>
                        <div  class="line number6 index5 alt1"><code  class="xml plain">​</code></div>
                        <div  class="line number7 index6 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">web-app</code><code  class="xml plain">></code></div>
                        <div  class="line number8 index7 alt1"><code  class="xml plain"><</code><code
 class="xml keyword">filter</code><code  class="xml plain">></code></div>
                        <div  class="line number9 index8 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">filter-name</code><code  class="xml plain">>LiftFilter</</code><code
 class="xml keyword">filter-name</code><code  class="xml plain">></code></div>
                        <div  class="line number10 index9 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">display-name</code><code  class="xml plain">>Lift Filter</</code><code
 class="xml keyword">display-name</code><code  class="xml plain">></code></div>
                        <div  class="line number11 index10 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">description</code><code  class="xml plain">>The Filter that intercepts lift calls</</code><code
 class="xml keyword">description</code><code  class="xml plain">></code></div>
                        <div  class="line number12 index11 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">filter-class</code><code  class="xml plain">>net.liftweb.http.LiftFilter</</code><code
 class="xml keyword">filter-class</code><code  class="xml plain">></code></div>
                        <div  class="line number13 index12 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">persistence-context-ref</code><code
 class="xml plain">></code></div>
                        <div  class="line number14 index13 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">description</code><code  class="xml plain">></code></div>
                        <div  class="line number15 index14 alt2"><code  class="xml spaces">      </code><code
 class="xml plain">Persistence context for the library app</code></div>
                        <div  class="line number16 index15 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">description</code><code  class="xml plain">></code></div>
                        <div  class="line number17 index16 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">persistence-context-ref-name</code><code
 class="xml plain">></code></div>
                        <div  class="line number18 index17 alt1"><code  class="xml spaces">      </code><code
 class="xml plain">persistence/jpaweb</code></div>
                        <div  class="line number19 index18 alt2"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">persistence-context-ref-name</code><code
 class="xml plain">></code></div>
                        <div  class="line number20 index19 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"><</code><code  class="xml keyword">persistence-unit-name</code><code
 class="xml plain">></code></div>
                        <div  class="line number21 index20 alt2"><code  class="xml spaces">      </code><code
 class="xml plain">jpaweb</code></div>
                        <div  class="line number22 index21 alt1"><code  class="xml spaces">    </code><code
 class="xml plain"></</code><code  class="xml keyword">persistence-unit-name</code><code
 class="xml plain">></code></div>
                        <div  class="line number23 index22 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"></</code><code  class="xml keyword">persistence-context-ref</code><code
 class="xml plain">></code></div>
                        <div  class="line number24 index23 alt1"><code  class="xml plain"></</code><code
 class="xml keyword">filter</code><code  class="xml plain">></code></div>
                        <div  class="line number25 index24 alt2"><code  class="xml spaces">        </code> </div>
                        <div  class="line number26 index25 alt1"><code  class="xml plain">​</code></div>
                        <div  class="line number27 index26 alt2"><code  class="xml plain"><</code><code
 class="xml keyword">filter-mapping</code><code  class="xml plain">></code></div>
                        <div  class="line number28 index27 alt1"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">filter-name</code><code  class="xml plain">>LiftFilter</</code><code
 class="xml keyword">filter-name</code><code  class="xml plain">></code></div>
                        <div  class="line number29 index28 alt2"><code  class="xml spaces">  </code><code
 class="xml plain"><</code><code  class="xml keyword">url-pattern</code><code  class="xml plain">>/*</</code><code
 class="xml keyword">url-pattern</code><code  class="xml plain">></code></div>
                        <div  class="line number30 index29 alt1"><code  class="xml plain"></</code><code
 class="xml keyword">filter-mapping</code><code  class="xml plain">></code></div>
                        <div  class="line number31 index30 alt2"><code  class="xml plain">​</code></div>
                        <div  class="line number32 index31 alt1"><code  class="xml plain"></</code><code
 class="xml keyword">web-app</code><code  class="xml plain">></code></div>
                        <div  class="line number33 index32 alt2"><code  class="xml plain">​</code></div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <a  name="Index"  class="toc"></a>
      <h1  class="index">Index</h1>
      <p  class="printindex"> <a  name="index-AJAX"  class="printindex"></a>AJAX:
        </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-AJAX-anchor-tag"  class="printindex"></a>anchor
          tag: <a  href="#entry-AJAX-anchor-tag-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Attributes"  class="printindex"></a>Attributes:
        <a  href="#entry-Attributes-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Attributes-%-operator"  class="printindex"></a>%
          operator: <a  href="#entry-Attributes-%-operator-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Attributes--%>-operator"  class="printindex"></a>-%>
          operator: <a  href="#entry-Attributes--%%3E-operator-0"  class="IndexArrow">↑</a>, <a
 href="#entry-Attributes--%%3E-operator-1"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Attributes-binding"  class="printindex"></a>binding:
          <a  href="#entry-Attributes-binding-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Attributes-computing-via-snippet"
 class="printindex"></a>computing via snippet: <a  href="#entry-Attributes-computing-via-snippet-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Attributes-delete-with-CSS-transform"
 class="printindex"></a>delete with CSS transform: <a  href="#entry-Attributes-delete-with-CSS-transform-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Attributes-discarded-in-bind"  class="printindex"></a>discarded
          in bind: <a  href="#entry-Attributes-discarded-in-bind-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Attributes-in-form-elements"  class="printindex"></a>in
          form elements: <a  href="#entry-Attributes-in-form-elements-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Attributes-retrieving-from-elements"
 class="printindex"></a>retrieving from elements: <a  href="#entry-Attributes-retrieving-from-elements-0"
 class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Authentication"  class="printindex"></a>Authentication:
        <a  href="#entry-Authentication-0"  class="IndexArrow">↑</a>, <a  href="#entry-Authentication-1"
 class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Authentication-JAAS"  class="printindex"></a>JAAS:
          <a  href="#entry-Authentication-JAAS-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Autoconversion"  class="printindex"></a>Autoconversion:
        <a  href="#entry-Autoconversion-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Binding"  class="printindex"></a>Binding:
        <a  href="#entry-Binding-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Binding-with-CSS"  class="printindex"></a>with
          CSS: <a  href="#entry-Binding-with-CSS-0"  class="IndexArrow">↑</a>, <a
 href="#entry-Binding-with-CSS-1"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Boot"  class="printindex"></a>Boot:
        <a  href="#entry-Boot-0"  class="IndexArrow">↑</a>, <a  href="#entry-Boot-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Bootstrap"  class="printindex"></a>Bootstrap:
        <a  href="#entry-Bootstrap-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-By"  class="printindex"></a>By: <a
 href="#entry-By-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-ByList"  class="printindex"></a>ByList:
        <a  href="#entry-ByList-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-ByRef"  class="printindex"></a>ByRef:
        <a  href="#entry-ByRef-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-By_>"  class="printindex"></a>By_>:
        <a  href="#entry-By_%3E-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-By_<"  class="printindex"></a>By_<:
        <a  href="#entry-By_%3C-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-CGI"  class="printindex"></a>CGI:
        <a  href="#entry-CGI-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-CMP"  class="printindex"></a>CMP:
        <a  href="#entry-CMP-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-CSS"  class="printindex"></a>CSS:
        <a  href="#entry-CSS-0"  class="IndexArrow">↑</a>,
        <a  href="#entry-CSS-1"  class="IndexArrow">↑</a>,
        <a  href="#entry-CSS-2"  class="IndexArrow">↑</a>,
        <a  href="#entry-CSS-3"  class="IndexArrow">↑</a>
      </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-CSS-selector-transforms"  class="printindex"></a>selector
          transforms: <a  href="#entry-CSS-selector-transforms-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-CSS-Transforms"  class="printindex"></a>CSS
        Transforms: <a  href="#entry-CSS-Transforms-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-CSS-Transforms-attribute-copying"
 class="printindex"></a>attribute copying: <a  href="#entry-CSS-Transforms-attribute-copying-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-CSS-Transforms-attribute-replacement"
 class="printindex"></a>attribute replacement: <a  href="#entry-CSS-Transforms-attribute-replacement-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-CSS-Transforms-deleting-attribute"
 class="printindex"></a>deleting attribute: <a  href="#entry-CSS-Transforms-deleting-attribute-0"
 class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Calendar"  class="printindex"></a>Calendar:
        <a  href="#entry-Calendar-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Comet"  class="printindex"></a>Comet:
        <a  href="#entry-Comet-0"  class="IndexArrow">↑</a>, <a  href="#entry-Comet-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Custom-dispatch"  class="printindex"></a>Custom
        dispatch: </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Custom-dispatch-per-session"  class="printindex"></a>per-session:
          <a  href="#entry-Custom-dispatch-per-session-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Custom-dispatch-stateful"  class="printindex"></a>stateful:
          <a  href="#entry-Custom-dispatch-stateful-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Custom-dispatch-stateless"  class="printindex"></a>stateless:
          <a  href="#entry-Custom-dispatch-stateless-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Designer-friendly-templates"  class="printindex"></a>Designer-friendly
        templates: <a  href="#entry-Designer-friendly-templates-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-DispatchSnippet"  class="printindex"></a>DispatchSnippet:
        <a  href="#entry-DispatchSnippet-0"  class="IndexArrow">↑</a>, <a  href="#entry-DispatchSnippet-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-EntityManager"  class="printindex"></a>EntityManager:
        <a  href="#entry-EntityManager-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Extraction"  class="printindex"></a>Extraction:
        <a  href="#entry-Extraction-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-File-uploads"  class="printindex"></a>File
        uploads: <a  href="#entry-File-uploads-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Forms"  class="printindex"></a>Forms:
        <a  href="#entry-Forms-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Forms-File-uploads"  class="printindex"></a>File
          uploads: <a  href="#entry-Forms-File-uploads-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Forms-file-upload"  class="printindex"></a>file
          upload: <a  href="#entry-Forms-file-upload-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Forms-multipart"  class="printindex"></a>multipart:
          <a  href="#entry-Forms-multipart-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Forms-saving-file-uploads-to-disk"
 class="printindex"></a>saving file uploads to disk: <a  href="#entry-Forms-saving-file-uploads-to-disk-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Forms-snippet-tag"  class="printindex"></a>snippet
          tag: <a  href="#entry-Forms-snippet-tag-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Git"  class="printindex"></a>Git:
        <a  href="#entry-Git-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-HTML"  class="printindex"></a>HTML:
        </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-HTML-Version-5"  class="printindex"></a>Version
          5: <a  href="#entry-HTML-Version-5-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-HTML5"  class="printindex"></a>HTML5:
        <a  href="#entry-HTML5-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-HTTP"  class="printindex"></a>HTTP:
        </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-HTTP-authentication"  class="printindex"></a>authentication:
          <a  href="#entry-HTTP-authentication-0"  class="IndexArrow">↑</a>, <a
 href="#entry-HTTP-authentication-1"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Hibernate"  class="printindex"></a>Hibernate:
        <a  href="#entry-Hibernate-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-HttpServletRequest"  class="printindex"></a>HttpServletRequest:
        <a  href="#entry-HttpServletRequest-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-I18N"  class="printindex"></a>I18N:
        <a  href="#entry-I18N-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-I18N-Calculating-locale"  class="printindex"></a>Calculating
          locale: <a  href="#entry-I18N-Calculating-locale-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-I18N-Localized-templates"  class="printindex"></a>Localized
          templates: <a  href="#entry-I18N-Localized-templates-0"  class="IndexArrow">↑</a>, <a
 href="#entry-I18N-Localized-templates-1"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-I18N-Resource-bundle-resolution"
 class="printindex"></a>Resource bundle resolution: <a  href="#entry-I18N-Resource-bundle-resolution-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-I18N-whitespace-in-keys"  class="printindex"></a>whitespace
          in keys: <a  href="#entry-I18N-whitespace-in-keys-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-IHaveValidatedThisSQL"  class="printindex"></a>IHaveValidatedThisSQL:
        <a  href="#entry-IHaveValidatedThisSQL-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-If"  class="printindex"></a>If: <a
 href="#entry-If-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-In"  class="printindex"></a>In: <a
 href="#entry-In-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-InMemoryFileParamHolder"  class="printindex"></a>InMemoryFileParamHolder:
        <a  href="#entry-InMemoryFileParamHolder-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-InMemoryResponse"  class="printindex"></a>InMemoryResponse:
        <a  href="#entry-InMemoryResponse-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-InRaw"  class="printindex"></a>InRaw:
        <a  href="#entry-InRaw-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-IndexedField"  class="printindex"></a>IndexedField:
        <a  href="#entry-IndexedField-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-InsecureLiftView"  class="printindex"></a>InsecureLiftView:
        <a  href="#entry-InsecureLiftView-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Internationalization---see-I18N"  class="printindex"></a>Internationalization | see I18N: <a
 href="#entry-Internationalization---see-I18N-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-JPA"  class="printindex"></a>JPA:
        <a  href="#entry-JPA-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-JPOX"  class="printindex"></a>JPOX:
        <a  href="#entry-JPOX-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-JSON"  class="printindex"></a>JSON:
        </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-JSON-extraction"  class="printindex"></a>extraction:
          <a  href="#entry-JSON-extraction-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-KeyedMapper"  class="printindex"></a>KeyedMapper:
        <a  href="#entry-KeyedMapper-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-KeyedMetaMapper"  class="printindex"></a>KeyedMetaMapper:
        <a  href="#entry-KeyedMetaMapper-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Lift-2.2"  class="printindex"></a>Lift
        2.2: <a  href="#entry-Lift-2.2-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-LiftResponse"  class="printindex"></a>LiftResponse:
        <a  href="#entry-LiftResponse-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-LiftRules"  class="printindex"></a>LiftRules:
        <a  href="#entry-LiftRules-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-LiftRules-dispatch"  class="printindex"></a>dispatch:
          <a  href="#entry-LiftRules-dispatch-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-LiftRules-statelessDispatchTable"
 class="printindex"></a>statelessDispatchTable: <a  href="#entry-LiftRules-statelessDispatchTable-0"
 class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-LiftView"  class="printindex"></a>LiftView:
        <a  href="#entry-LiftView-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Like"  class="printindex"></a>Like:
        <a  href="#entry-Like-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Locale"  class="printindex"></a>Locale:
        </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Locale-calculating"  class="printindex"></a>calculating:
          <a  href="#entry-Locale-calculating-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-MVC"  class="printindex"></a>MVC:
        <a  href="#entry-MVC-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-Map"  class="printindex"></a>Map:
        <a  href="#entry-Map-0"  class="IndexArrow">↑</a>
      </p>
      <p  class="printindex"> <a  name="index-Mapper"  class="printindex"></a>Mapper:
        <a  href="#entry-Mapper-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Mapper-asJs"  class="printindex"></a>asJs:
          <a  href="#entry-Mapper-asJs-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Mapper-multiple-databases"  class="printindex"></a>multiple
          databases: <a  href="#entry-Mapper-multiple-databases-0"  class="IndexArrow">↑</a>, <a
 href="#entry-Mapper-multiple-databases-1"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Mapper-toXml"  class="printindex"></a>toXml:
          <a  href="#entry-Mapper-toXml-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Maven"  class="printindex"></a>Maven:
        <a  href="#entry-Maven-0"  class="IndexArrow">↑</a>, <a  href="#entry-Maven-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Menu.title"  class="printindex"></a>Menu.title:
        <a  href="#entry-Menu.title-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-MetaMapper"  class="printindex"></a>MetaMapper:
        <a  href="#entry-MetaMapper-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-MetaRecord"  class="printindex"></a>MetaRecord:
        <a  href="#entry-MetaRecord-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-NodeSeq"  class="printindex"></a>NodeSeq:
        <a  href="#entry-NodeSeq-0"  class="IndexArrow">↑</a>, <a  href="#entry-NodeSeq-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-NotBy"  class="printindex"></a>NotBy:
        <a  href="#entry-NotBy-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-NotNullRef"  class="printindex"></a>NotNullRef:
        <a  href="#entry-NotNullRef-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-NullRef"  class="printindex"></a>NullRef:
        <a  href="#entry-NullRef-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-OnDiskFileParamHolder"  class="printindex"></a>OnDiskFileParamHolder:
        <a  href="#entry-OnDiskFileParamHolder-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Override-form-template"  class="printindex"></a>Override
        form template: <a  href="#entry-Override-form-template-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Parameters"  class="printindex"></a>Parameters:
        <a  href="#entry-Parameters-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-ParsePath"  class="printindex"></a>ParsePath:
        <a  href="#entry-ParsePath-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-PreCache"  class="printindex"></a>PreCache:
        <a  href="#entry-PreCache-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-RESTful"  class="printindex"></a>RESTful:
        <a  href="#entry-RESTful-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Record"  class="printindex"></a>Record:
        <a  href="#entry-Record-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-RedirectWithState"  class="printindex"></a>RedirectWithState:
        <a  href="#entry-RedirectWithState-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Reflection"  class="printindex"></a>Reflection:
        <a  href="#entry-Reflection-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-RequestVar"  class="printindex"></a>RequestVar:
        <a  href="#entry-RequestVar-0"  class="IndexArrow">↑</a>, <a  href="#entry-RequestVar-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-RewriteResponse"  class="printindex"></a>RewriteResponse:
        <a  href="#entry-RewriteResponse-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-S"  class="printindex"></a>S: <a  href="#entry-S-0"
 class="IndexArrow">↑</a>,
        <a  href="#entry-S-1"  class="IndexArrow">↑</a>
      </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-S-addHighLevelSessionDispatcher"
 class="printindex"></a>addHighLevelSessionDispatcher: <a  href="#entry-S-addHighLevelSessionDispatcher-0"
 class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-S.param"  class="printindex"></a>S.param:
        <a  href="#entry-S.param-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-SHtml"  class="printindex"></a>SHtml:
        <a  href="#entry-SHtml-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-SHtml-a"  class="printindex"></a>a:
          <a  href="#entry-SHtml-a-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Scala"  class="printindex"></a>Scala:
        <a  href="#entry-Scala-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Schemifier"  class="printindex"></a>Schemifier:
        <a  href="#entry-Schemifier-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-SessionVar"  class="printindex"></a>SessionVar:
        <a  href="#entry-SessionVar-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-SiteMap"  class="printindex"></a>SiteMap:
        <a  href="#entry-SiteMap-0"  class="IndexArrow">↑</a>, <a  href="#entry-SiteMap-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Snippet-parameters"  class="printindex"></a>Snippet
        parameters: <a  href="#entry-Snippet-parameters-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Snippets"  class="printindex"></a>Snippets:
        <a  href="#entry-Snippets-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Snippets-Dispatch"  class="printindex"></a>Dispatch:
          <a  href="#entry-Snippets-Dispatch-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-Explicit-Dispatch"  class="printindex"></a>Explicit
          Dispatch: <a  href="#entry-Snippets-Explicit-Dispatch-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-Implicit-dispatch"  class="printindex"></a>Implicit
          dispatch: <a  href="#entry-Snippets-Implicit-dispatch-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-Per-request-remapping"
 class="printindex"></a>Per-request remapping: <a  href="#entry-Snippets-Per-request-remapping-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-binding"  class="printindex"></a>binding:
          <a  href="#entry-Snippets-binding-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-binding-with-CSS"  class="printindex"></a>binding
          with CSS: <a  href="#entry-Snippets-binding-with-CSS-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-eager_eval"  class="printindex"></a>eager_eval:
          <a  href="#entry-Snippets-eager_eval-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-explicit-dispatch-with-StatefulSnippet"
 class="printindex"></a>explicit dispatch with StatefulSnippet: <a  href="#entry-Snippets-explicit-dispatch-with-StatefulSnippet-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-invoking-via-class-attributes"
 class="printindex"></a>invoking via class attributes: <a  href="#entry-Snippets-invoking-via-class-attributes-0"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-stateful"  class="printindex"></a>stateful:
          <a  href="#entry-Snippets-stateful-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Snippets-stateful-vs-stateless"
 class="printindex"></a>stateful vs stateless: <a  href="#entry-Snippets-stateful-vs-stateless-0"
 class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-StatefulSnippet"  class="printindex"></a>StatefulSnippet:
        <a  href="#entry-StatefulSnippet-0"  class="IndexArrow">↑</a>, <a  href="#entry-StatefulSnippet-1"
 class="IndexArrow">↑</a>, <a  href="#entry-StatefulSnippet-2"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-StatefulSnippet-explicit-dispatch"
 class="printindex"></a>explicit dispatch: <a  href="#entry-StatefulSnippet-explicit-dispatch-0"
 class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Tags"  class="printindex"></a>Tags:
        </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Tags-CSS"  class="printindex"></a>CSS:
          <a  href="#entry-Tags-CSS-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Tags-a"  class="printindex"></a>a:
          <a  href="#entry-Tags-a-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Tags-bind"  class="printindex"></a>bind:
          <a  href="#entry-Tags-bind-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Tags-bind-at"  class="printindex"></a>bind-at:
          <a  href="#entry-Tags-bind-at-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Tags-children"  class="printindex"></a>children:
          <a  href="#entry-Tags-children-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Tags-comet"  class="printindex"></a>comet:
          <a  href="#entry-Tags-comet-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Tags-embed"  class="printindex"></a>embed:
          <a  href="#entry-Tags-embed-0"  class="IndexArrow">↑</a>, <a  href="#entry-Tags-embed-1"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Tags-snippet"  class="printindex"></a>snippet:
          <a  href="#entry-Tags-snippet-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Tags-surround"  class="printindex"></a>surround:
          <a  href="#entry-Tags-surround-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Templates"  class="printindex"></a>Templates:
        <a  href="#entry-Templates-0"  class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Templates-Designer-friendly"  class="printindex"></a>Designer-friendly:
          <a  href="#entry-Templates-Designer-friendly-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Templates-HTML5"  class="printindex"></a>HTML5:
          <a  href="#entry-Templates-HTML5-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Templates-content-element"  class="printindex"></a>content
          element: <a  href="#entry-Templates-content-element-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Templates-embedded"  class="printindex"></a>embedded:
          <a  href="#entry-Templates-embedded-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-Title"  class="printindex"></a>Title:
        <a  href="#entry-Title-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-TopLink"  class="printindex"></a>TopLink:
        <a  href="#entry-TopLink-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Transactions"  class="printindex"></a>Transactions:
        <a  href="#entry-Transactions-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Type"  class="printindex"></a>Type:
        <a  href="#entry-Type-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-URL-rewriting"  class="printindex"></a>URL
        rewriting: <a  href="#entry-URL-rewriting-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Unless"  class="printindex"></a>Unless:
        <a  href="#entry-Unless-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Validation"  class="printindex"></a>Validation:
        <a  href="#entry-Validation-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-View-First"  class="printindex"></a>View-First:
        <a  href="#entry-View-First-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-Views"  class="printindex"></a>Views:
        <a  href="#entry-Views-0"  class="IndexArrow">↑</a>, <a  href="#entry-Views-1"
 class="IndexArrow">↑</a> </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-Views-Explicit-dispatch"  class="printindex"></a>Explicit
          dispatch: <a  href="#entry-Views-Explicit-dispatch-0"  class="IndexArrow">↑</a>, <a
 href="#entry-Views-Explicit-dispatch-1"  class="IndexArrow">↑</a>, <a  href="#entry-Views-Explicit-dispatch-2"
 class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Views-Implicit-dispatch"  class="printindex"></a>Implicit
          dispatch: <a  href="#entry-Views-Implicit-dispatch-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-Views-Reflection-dispatch"  class="printindex"></a>Reflection
          dispatch: <a  href="#entry-Views-Reflection-dispatch-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-XHTML"  class="printindex"></a>XHTML:
        <a  href="#entry-XHTML-0"  class="IndexArrow">↑</a>, <a  href="#entry-XHTML-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-XML"  class="printindex"></a>XML:
        <a  href="#entry-XML-0"  class="IndexArrow">↑</a>,
        <a  href="#entry-XML-1"  class="IndexArrow">↑</a>
      </p>
      <div  class="indexgroup">
        <p  class="printindex"> <a  name="index-XML-attribute-handling"  class="printindex"></a>attribute
          handling: <a  href="#entry-XML-attribute-handling-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-XML-attributes"  class="printindex"></a>attributes:
          <a  href="#entry-XML-attributes-0"  class="IndexArrow">↑</a> </p>
        <p  class="printindex"> <a  name="index-XML-preserving-attributes"  class="printindex"></a>preserving
          attributes: <a  href="#entry-XML-preserving-attributes-0"  class="IndexArrow">↑</a> </p>
      </div>
      <p  class="printindex"> <a  name="index-_id_>-operator"  class="printindex"></a>_id_>
        operator: <a  href="#entry-_id_%3E-operator-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-anchor"  class="printindex"></a>anchor:
        <a  href="#entry-anchor-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-annotations"  class="printindex"></a>annotations:
        <a  href="#entry-annotations-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-bind"  class="printindex"></a>bind:
        <a  href="#entry-bind-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-binding"  class="printindex"></a>binding:
        <a  href="#entry-binding-0"  class="IndexArrow">↑</a>, <a  href="#entry-binding-1"
 class="IndexArrow">↑</a>, <a  href="#entry-binding-2"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-bootloader"  class="printindex"></a>bootloader:
        <a  href="#entry-bootloader-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-children"  class="printindex"></a>children:
        <a  href="#entry-children-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-closure"  class="printindex"></a>closure:
        <a  href="#entry-closure-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-cookie"  class="printindex"></a>cookie:
        <a  href="#entry-cookie-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-create"  class="printindex"></a>create:
        <a  href="#entry-create-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-dbColumnName"  class="printindex"></a>dbColumnName:
        <a  href="#entry-dbColumnName-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-dbIndexed_?"  class="printindex"></a>dbIndexed_?:
        <a  href="#entry-dbIndexed_?-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-dbTableName"  class="printindex"></a>dbTableName:
        <a  href="#entry-dbTableName-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-eager-eval"  class="printindex"></a>eager
        eval: <a  href="#entry-eager-eval-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-embed"  class="printindex"></a>embed:
        <a  href="#entry-embed-0"  class="IndexArrow">↑</a>, <a  href="#entry-embed-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-entity-class"  class="printindex"></a>entity
        class: <a  href="#entry-entity-class-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-entity-classes"  class="printindex"></a>entity
        classes: <a  href="#entry-entity-classes-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-enumerations"  class="printindex"></a>enumerations:
        <a  href="#entry-enumerations-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-fieldOrder"  class="printindex"></a>fieldOrder:
        <a  href="#entry-fieldOrder-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-findAll"  class="printindex"></a>findAll:
        <a  href="#entry-findAll-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-form"  class="printindex"></a>form:
        <a  href="#entry-form-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-formTemplate"  class="printindex"></a>formTemplate:
        <a  href="#entry-formTemplate-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-head"  class="printindex"></a>head:
        <a  href="#entry-head-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-hidden-templates"  class="printindex"></a>hidden
        templates: <a  href="#entry-hidden-templates-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-httpAuthProtectedResources"  class="printindex"></a>httpAuthProtectedResources:
        <a  href="#entry-httpAuthProtectedResources-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-implicit-conversions"  class="printindex"></a>implicit
        conversions: <a  href="#entry-implicit-conversions-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-lift:surround"  class="printindex"></a>lift:surround:
        <a  href="#entry-lift:surround-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-many-to-many"  class="printindex"></a>many-to-many:
        <a  href="#entry-many-to-many-0"  class="IndexArrow">↑</a>, <a  href="#entry-many-to-many-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-many-to-one"  class="printindex"></a>many-to-one:
        <a  href="#entry-many-to-one-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-mapSnippet"  class="printindex"></a>mapSnippet:
        <a  href="#entry-mapSnippet-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-master-project"  class="printindex"></a>master
        project: <a  href="#entry-master-project-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-named-queries"  class="printindex"></a>named
        queries: <a  href="#entry-named-queries-0"  class="IndexArrow">↑</a>, <a
 href="#entry-named-queries-1"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-one-to-many"  class="printindex"></a>one-to-many:
        <a  href="#entry-one-to-many-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-orm.xml"  class="printindex"></a>orm.xml:
        <a  href="#entry-orm.xml-0"  class="IndexArrow">↑</a>, <a  href="#entry-orm.xml-1"
 class="IndexArrow">↑</a>, <a  href="#entry-orm.xml-2"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-redirect"  class="printindex"></a>redirect:
        <a  href="#entry-redirect-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-reflection"  class="printindex"></a>reflection:
        <a  href="#entry-reflection-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-rendering-pipeline"  class="printindex"></a>rendering
        pipeline: <a  href="#entry-rendering-pipeline-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-request-parameters"  class="printindex"></a>request
        parameters: <a  href="#entry-request-parameters-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-rewriting"  class="printindex"></a>rewriting:
        <a  href="#entry-rewriting-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-snippet"  class="printindex"></a>snippet:
        <a  href="#entry-snippet-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-snippets"  class="printindex"></a>snippets:
        <a  href="#entry-snippets-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-surround"  class="printindex"></a>surround:
        <a  href="#entry-surround-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-table-name"  class="printindex"></a>table
        name: <a  href="#entry-table-name-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-template"  class="printindex"></a>template:
        <a  href="#entry-template-0"  class="IndexArrow">↑</a>, <a  href="#entry-template-1"
 class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-toForm"  class="printindex"></a>toForm:
        <a  href="#entry-toForm-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-validation"  class="printindex"></a>validation:
        <a  href="#entry-validation-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-viewDispatch"  class="printindex"></a>viewDispatch:
        <a  href="#entry-viewDispatch-0"  class="IndexArrow">↑</a>, <a  href="#entry-viewDispatch-1"
 class="IndexArrow">↑</a>, <a  href="#entry-viewDispatch-2"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-web-service"  class="printindex"></a>web
        service: <a  href="#entry-web-service-0"  class="IndexArrow">↑</a> </p>
      <p  class="printindex"> <a  name="index-web.xml"  class="printindex"></a>web.xml:
        <a  href="#entry-web.xml-0"  class="IndexArrow">↑</a>, <a  href="#entry-web.xml-1"
 class="IndexArrow">↑</a>, <a  href="#entry-web.xml-2"  class="IndexArrow">↑</a> </p>
      <p  class="bottom">(C) 2012 Lift 2.0 EditionWritten by Derek Chen-Becker,
        Marius Danciu and Tyler Weir</p>
    </div>
    <script  type="text/javascript">SyntaxHighlighter.all()</script>
</tt></div></li></ul></code></tt></div></body></html>