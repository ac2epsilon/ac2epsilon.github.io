<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="___">Життєвий цикл актора</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="____2">Інформація про модуль</h3>
<div class="paragraph"><p>Щоб використовувати Akka Actors, додайте таку залежність у свій проект:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;com.typesafe.akka&quot;</span> <span class="o">%%</span> <span class="s">&quot;akka-actor-typed&quot;</span> <span class="o">%</span> <span class="s">&quot;2.6.5&quot;</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_">Вступ</h3>
<div class="paragraph"><p>Актор - це ресурс зі станом, який потрібно явно розпочати і зупинити.</p></div>
<div class="paragraph"><p>Важливо зазначити, що актори не зупиняються автоматично, коли на них більше немає посилань, кожен створений Актор також повинен явно знищуватися. Єдине спрощення полягає в тому, що зупинка батьківського Актора також буде рекурсивно зупиняти всіх дочірніх Акторів, яких створив цей батько. Усі актори також автоматично зупиняються, коли вимикається <code>ActorSystem</code>.</p></div>
<div class="paragraph"><p>Примітка. ActorSystem - це важка структура, яка буде виділяти нитки, тому створіть по одній на логічну програму. Зазвичай одна система акторів на один процес JVM.</p></div>
</div>
<div class="sect2">
<h3 id="__">Створення акторів</h3>
<div class="paragraph"><p>Актор може створити або нерестити довільну кількість дитячих акторів, які, в свою чергу, можуть породити своїх дітей, тим самим формуючи ієрархію акторів. <code>ActorSystem</code> формує ієрархію, і може бути лише один корінний актор, актор на вершині ієрархії <code>ActorSystem</code>. Життєвий цикл дитини-актора пов'язаний з батьком - дитина може зупинити себе або зупинити її в будь-який час, але вона ніколи не може пережити свого батька.</p></div>
<div class="sect4">
<h5 id="_actorcontext">ActorContext</h5>
<div class="paragraph"><p>Доступ до ActorContext можна отримати для багатьох цілей, таких як:</p></div>
<div class="ulist"><ul>
<li>
<p>
Створення дитячіх акторів та нагляд
</p>
</li>
<li>
<p>
Нагляд інших акторів на отримання події <code>Terminated(otherActor)</code>, якщо нагляданий актор назавжди зупиниться
</p>
</li>
<li>
<p>
Ведення журналів
</p>
</li>
<li>
<p>
Створення адаптерів повідомлень
</p>
</li>
<li>
<p>
Взаємодія запит-відповідь (<code>ask</code>) з іншим актором
</p>
</li>
<li>
<p>
Доступ до свого <code>ActorRef</code> <code>self</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>Якщо поведінка потребує використання <code>ActorContext</code>, наприклад, для продукування дітей-акторів або використання <code>context.self</code>, це можна отримати, обернувши конструкцію <code>Behaviors.setup</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">HelloWorldMain</span> <span class="o">{</span>

  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SayHello</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SayHello</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">greeter</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorld</span><span class="o">(),</span> <span class="s">&quot;greeter&quot;</span><span class="o">)</span>

      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveMessage</span> <span class="o">{</span> <span class="n">message</span> <span class="k">=&gt;</span>
        <span class="k">val</span> <span class="n">replyTo</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorldBot</span><span class="o">(</span><span class="n">max</span> <span class="k">=</span> <span class="mi">3</span><span class="o">),</span> <span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
        <span class="n">greeter</span> <span class="o">!</span> <span class="nc">HelloWorld</span><span class="o">.</span><span class="nc">Greet</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="n">replyTo</span><span class="o">)</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
</div>
</div>
<div class="sect2">
<h3 id="___actorcontext">Безпека нитки ActorContext</h3>
<div class="paragraph"><p>Багато методів у <code>ActorContext</code> не є безпечними для потоків, і тому:</p></div>
<div class="ulist"><ul>
<li>
<p>
Не можна отримувати доступ до потоків із зворотнього виклику <code>scala.concurrent.Future</code>
</p>
</li>
<li>
<p>
Не може ділитися між кількома акторами
</p>
</li>
<li>
<p>
Потрібно використовувати лише у звичайній нитці обробки повідомлень актора
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="___2">Актор-охоронець</h3>
<div class="paragraph"><p>Актор верхнього рівня, який також називають актором-охоронцем користувача, створюється разом з <code>ActorSystem</code>. Повідомлення, що надсилаються до акторської системи, спрямовуються на головного актора. Основний актор визначається поведінкою, що використовується для створення <code>ActorSystem</code>, названої <code>HelloWorldMain</code> у наведеному нижче прикладі:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">[</span><span class="kt">HelloWorldMain.SayHello</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">HelloWorldMain</span><span class="o">(),</span> <span class="s">&quot;hello&quot;</span><span class="o">)</span>

<span class="n">system</span> <span class="o">!</span> <span class="nc">HelloWorldMain</span><span class="o">.</span><span class="nc">SayHello</span><span class="o">(</span><span class="s">&quot;World&quot;</span><span class="o">)</span>
<span class="n">system</span> <span class="o">!</span> <span class="nc">HelloWorldMain</span><span class="o">.</span><span class="nc">SayHello</span><span class="o">(</span><span class="s">&quot;Akka&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Для дуже простих додатків опікун може містити фактичну логіку програми та обробляти повідомлення. Як тільки програма звертається до декількох проблем, опікун повинен замість цього лише завантажувати програму, відгалужувати різні підсистеми як дітей, та контролювати їх життєвий цикл.</p></div>
<div class="paragraph"><p>Коли актор-охоронець зупиниться, це зупинить <code>ActorSystem</code>.</p></div>
<div class="paragraph"><p>Коли робиться виклик <code>ActorSystem.terminate</code>, процес скоординованого відключення зупинить акторів і служби у визначеному порядку.</p></div>
</div>
<div class="sect2">
<h3 id="___3">Створення дітей</h3>
<div class="paragraph"><p>Дитячі актори створюються і починаються <code>ActorContext</code> <code>spawn</code> . У наведеному нижче прикладі, коли запускається кореневий актор, він породжує дочірнього актора, описаного поведінкою <code>HelloWorld</code>. Крім того, коли кореневий актор отримує повідомлення <code>Start</code>, він створює дочірній актор, визначени поведінкою <code>HelloWorldBot</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">HelloWorldMain</span> <span class="o">{</span>

  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SayHello</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SayHello</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">greeter</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorld</span><span class="o">(),</span> <span class="s">&quot;greeter&quot;</span><span class="o">)</span>

      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveMessage</span> <span class="o">{</span> <span class="n">message</span> <span class="k">=&gt;</span>
        <span class="k">val</span> <span class="n">replyTo</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorldBot</span><span class="o">(</span><span class="n">max</span> <span class="k">=</span> <span class="mi">3</span><span class="o">),</span> <span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
        <span class="n">greeter</span> <span class="o">!</span> <span class="nc">HelloWorld</span><span class="o">.</span><span class="nc">Greet</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="n">replyTo</span><span class="o">)</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Щоб вказати диспетчера під час створення актора, використовуйте <code>DispatcherSelector</code>. Якщо не вказано, актор використовуватиме диспетчер за замовчуванням, детальну інформацію див. У <a href="https://doc.akka.io/docs/akka/current/typed/dispatchers.html#default-dispatcher">диспетчері за замовчуванням</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SayHello</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">dispatcherPath</span> <span class="k">=</span> <span class="s">&quot;akka.actor.default-blocking-io-dispatcher&quot;</span>

    <span class="k">val</span> <span class="n">props</span> <span class="k">=</span> <span class="nc">DispatcherSelector</span><span class="o">.</span><span class="n">fromConfig</span><span class="o">(</span><span class="n">dispatcherPath</span><span class="o">)</span>
    <span class="k">val</span> <span class="n">greeter</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorld</span><span class="o">(),</span> <span class="s">&quot;greeter&quot;</span><span class="o">,</span> <span class="n">props</span><span class="o">)</span>

    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveMessage</span> <span class="o">{</span> <span class="n">message</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">replyTo</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorldBot</span><span class="o">(</span><span class="n">max</span> <span class="k">=</span> <span class="mi">3</span><span class="o">),</span> <span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>

      <span class="n">greeter</span> <span class="o">!</span> <span class="nc">HelloWorld</span><span class="o">.</span><span class="nc">Greet</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="n">replyTo</span><span class="o">)</span>
      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Зверніться до акторів, щоб ознайомитися з вищезазначеними прикладами.</p></div>
</div>
<div class="sect2">
<h3 id="_spawnprotocol">SpawnProtocol</h3>
<div class="paragraph"><p>Актор-опікун повинен відповідати за ініціалізацію завдань та створення початкових акторів програми, але іноді ви можете породжувати нових акторів із зовнішньої сторони актора-опікуна. Наприклад, створення одного актора на кожний запит HTTP.</p></div>
<div class="paragraph"><p>Це не важко реалізувати у вашій поведінці, але оскільки це загальний шаблон, існує попередньо визначений протокол повідомлення та реалізація поведінки для цього. Він може бути використаний як актор-охоронець системи <code>ActorSystem</code>, можливо, поєднаний з <code>Behaviors.setup</code>, щоб розпочати деякі початкові завдання чи акторів. Потім дочірніх акторів можна запустити ззовні, через <code>tell</code> або <code>ask</code> <code>SpawnProtocol.Spawn</code> до посилання на актора системи. Використання запиту аналогічно тому, як <code>ActorSystem.actorOf</code> може використовуватися в класичних акторах з тією різницею, що повертається <code>Future</code> <code>ActorRef</code>.</p></div>
<div class="paragraph"><p>Поведінку опікуна можна визначити як:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.typed.Behavior</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.SpawnProtocol</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.Behaviors</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.LoggerOps</span>

<span class="k">object</span> <span class="nc">HelloWorldMain</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SpawnProtocol.Command</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="c1">// Запуск початкових завдань</span>
      <span class="c1">// context.spawn(...)</span>

      <span class="nc">SpawnProtocol</span><span class="o">()</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>і ActorSystem можна створити з такою основною поведінкою і попросити породити інших суб'єктів:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.typed.ActorRef</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.Props</span>
<span class="k">import</span> <span class="nn">akka.util.Timeout</span>


<span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">[</span><span class="kt">SpawnProtocol.Command</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">HelloWorldMain</span><span class="o">(),</span> <span class="s">&quot;hello&quot;</span><span class="o">)</span>

<span class="c1">// треба в неявному полі для ask (?)</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.AskPattern._</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">executionContext</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">timeout</span><span class="k">:</span> <span class="kt">Timeout</span> <span class="o">=</span> <span class="nc">Timeout</span><span class="o">(</span><span class="mf">3.</span><span class="n">seconds</span><span class="o">)</span>

<span class="k">val</span> <span class="n">greeter</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">ActorRef</span><span class="o">[</span><span class="kt">HelloWorld.Greet</span><span class="o">]]</span> <span class="k">=</span>
  <span class="n">system</span><span class="o">.</span><span class="n">ask</span><span class="o">(</span><span class="nc">SpawnProtocol</span><span class="o">.</span><span class="nc">Spawn</span><span class="o">(</span><span class="n">behavior</span> <span class="k">=</span> <span class="nc">HelloWorld</span><span class="o">(),</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;greeter&quot;</span><span class="o">,</span> <span class="n">props</span> <span class="k">=</span> <span class="nc">Props</span><span class="o">.</span><span class="n">empty</span><span class="o">,</span> <span class="k">_</span><span class="o">))</span>

<span class="k">val</span> <span class="n">greetedBehavior</span> <span class="k">=</span> <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receive</span><span class="o">[</span><span class="kt">HelloWorld.Greeted</span><span class="o">]</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
  <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info2</span><span class="o">(</span><span class="s">&quot;Greeting for {} from {}&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="n">from</span><span class="o">)</span>
  <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">greetedReplyTo</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">ActorRef</span><span class="o">[</span><span class="kt">HelloWorld.Greeted</span><span class="o">]]</span> <span class="k">=</span>
  <span class="n">system</span><span class="o">.</span><span class="n">ask</span><span class="o">(</span><span class="nc">SpawnProtocol</span><span class="o">.</span><span class="nc">Spawn</span><span class="o">(</span><span class="n">greetedBehavior</span><span class="o">,</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;&quot;</span><span class="o">,</span> <span class="n">props</span> <span class="k">=</span> <span class="nc">Props</span><span class="o">.</span><span class="n">empty</span><span class="o">,</span> <span class="k">_</span><span class="o">))</span>

<span class="k">for</span> <span class="o">(</span><span class="n">greeterRef</span> <span class="k">&lt;-</span> <span class="n">greeter</span><span class="o">;</span> <span class="n">replyToRef</span> <span class="k">&lt;-</span> <span class="n">greetedReplyTo</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">greeterRef</span> <span class="o">!</span> <span class="nc">HelloWorld</span><span class="o">.</span><span class="nc">Greet</span><span class="o">(</span><span class="s">&quot;Akka&quot;</span><span class="o">,</span> <span class="n">replyToRef</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>SpawnProtocol також можна використовувати в інших місцях в ієрархії акторів. Не обов’язково бути актором-кореневим опікуном.</p></div>
<div class="paragraph"><p>Спосіб пошуку працюючих акторів описаний у відкритті Актора.</p></div>
</div>
<div class="sect2">
<h3 id="___4">Зупинка акторів</h3>
<div class="paragraph"><p>Актор може зупинити себе, повернувши <code>Behaviors.stopped</code> як наступну поведінку.</p></div>
<div class="paragraph"><p>Дитячого актора можна змусити зупинитись після того, як він закінчить обробляти своє поточне повідомлення, використовуючи метод зупинки <code>stop</code> <code>ActorContext</code> від батьківського актора. Тільки дитячі актори можуть бути зупинені таким чином.</p></div>
<div class="paragraph"><p>Усі діти будуть зупинені, коли їх батька зупинено.</p></div>
<div class="paragraph"><p>Коли актор зупиняється, він отримує сигнал <code>PostStop</code>, який можна використовувати для очищення ресурсів. Функція зворотного виклику може бути визначена як параметр <code>Behaviors.stopped</code> для обробки сигналу <code>PostStop</code> при витонченій зупинці. Це дозволяє застосовувати різні дії, коли виконання різко зупиняється.</p></div>
<div class="paragraph"><p>Ось ілюструючий приклад:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.typed.Behavior</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.Behaviors</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.</span><span class="o">{</span> <span class="nc">ActorSystem</span><span class="o">,</span> <span class="nc">PostStop</span> <span class="o">}</span>

<span class="k">object</span> <span class="nc">MasterControlProgram</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Command</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SpawnJob</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Command</span>
  <span class="k">case</span> <span class="k">object</span> <span class="nc">GracefulShutdown</span> <span class="k">extends</span> <span class="nc">Command</span>

  <span class="c1">// Визначена операція зачистки</span>
  <span class="k">def</span> <span class="n">cleanup</span><span class="o">(</span><span class="n">log</span><span class="k">:</span> <span class="kt">Logger</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Cleaning up!&quot;</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Command</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">Behaviors</span>
      <span class="o">.</span><span class="n">receive</span><span class="o">[</span><span class="kt">Command</span><span class="o">]</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="n">message</span> <span class="k">match</span> <span class="o">{</span>
          <span class="k">case</span> <span class="nc">SpawnJob</span><span class="o">(</span><span class="n">jobName</span><span class="o">)</span> <span class="k">=&gt;</span>
            <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Spawning job {}!&quot;</span><span class="o">,</span> <span class="n">jobName</span><span class="o">)</span>
            <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">Job</span><span class="o">(</span><span class="n">jobName</span><span class="o">),</span> <span class="n">name</span> <span class="k">=</span> <span class="n">jobName</span><span class="o">)</span>
            <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
          <span class="k">case</span> <span class="nc">GracefulShutdown</span> <span class="k">=&gt;</span>
            <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Initiating graceful shutdown...&quot;</span><span class="o">)</span>
            <span class="c1">// м&#39;яка зупинка перед фінальною зупинкою</span>
            <span class="c1">// поведінка очистки передана як параметр до Actor.stopped</span>
            <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span> <span class="o">{</span> <span class="o">()</span> <span class="k">=&gt;</span>
              <span class="n">cleanup</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">log</span><span class="o">)</span>
            <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
      <span class="o">.</span><span class="n">receiveSignal</span> <span class="o">{</span>
        <span class="k">case</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="nc">PostStop</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Master Control Program stopped&quot;</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Job</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Command</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Command</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveSignal</span><span class="o">[</span><span class="kt">Command</span><span class="o">]</span> <span class="o">{</span>
      <span class="k">case</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="nc">PostStop</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Worker {} stopped&quot;</span><span class="o">,</span> <span class="n">name</span><span class="o">)</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">import</span> <span class="nn">MasterControlProgram._</span>

<span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">[</span><span class="kt">Command</span><span class="o">]</span>
    <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">MasterControlProgram</span><span class="o">(),</span> <span class="s">&quot;B7700&quot;</span><span class="o">)</span>

<span class="n">system</span> <span class="o">!</span> <span class="nc">SpawnJob</span><span class="o">(</span><span class="s">&quot;a&quot;</span><span class="o">)</span>
<span class="n">system</span> <span class="o">!</span> <span class="nc">SpawnJob</span><span class="o">(</span><span class="s">&quot;b&quot;</span><span class="o">)</span>

<span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>

<span class="c1">// м&#39;яка зупинка системи</span>
<span class="n">system</span> <span class="o">!</span> <span class="nc">GracefulShutdown</span>

<span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>

<span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="n">system</span><span class="o">.</span><span class="n">whenTerminated</span><span class="o">,</span> <span class="mf">3.</span><span class="n">seconds</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Під час очищення ресурсів від <code>PostStop</code> слід також розглянути можливість виконання того ж самого для сигналу <code>PreRestart</code>, який випромінюється при перезапуску актора. Зауважте, що <code>PostStop</code> не видається для перезавантаження.</p></div>
</div>
<div class="sect2">
<h3 id="____3">Спостереження за акторами</h3>
<div class="paragraph"><p>Для того, щоб отримувати повідомлення про припинення дії іншого актора (тобто припиняється постійно, а не тимчасової несправності та перезавантаження), актор може спостерігати іншого актора. Він отримає сигнал <code>Terminated</code> після припинення (див. Припинення акторів) актора під наглядом.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">MasterControlProgram</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Command</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SpawnJob</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Command</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Command</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">Behaviors</span>
      <span class="o">.</span><span class="n">receive</span><span class="o">[</span><span class="kt">Command</span><span class="o">]</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="n">message</span> <span class="k">match</span> <span class="o">{</span>
          <span class="k">case</span> <span class="nc">SpawnJob</span><span class="o">(</span><span class="n">jobName</span><span class="o">)</span> <span class="k">=&gt;</span>
            <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Spawning job {}!&quot;</span><span class="o">,</span> <span class="n">jobName</span><span class="o">)</span>
            <span class="k">val</span> <span class="n">job</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">Job</span><span class="o">(</span><span class="n">jobName</span><span class="o">),</span> <span class="n">name</span> <span class="k">=</span> <span class="n">jobName</span><span class="o">)</span>
            <span class="n">context</span><span class="o">.</span><span class="n">watch</span><span class="o">(</span><span class="n">job</span><span class="o">)</span>
            <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
        <span class="o">}</span>
      <span class="o">}</span>
      <span class="o">.</span><span class="n">receiveSignal</span> <span class="o">{</span>
        <span class="k">case</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="nc">Terminated</span><span class="o">(</span><span class="n">ref</span><span class="o">))</span> <span class="k">=&gt;</span>
          <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Job stopped: {}&quot;</span><span class="o">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Альтернативою для <code>watch</code> є <code>watchWith</code>, що дозволяє вказати користувальницьке повідомлення замість <code>Terminated</code>. Цьом часто надається перевага, ніж використанню <code>watch</code> та сигналу <code>Terminated</code>, оскільки в повідомлення може бути включена додаткова інформація, яка може бути використана пізніше при його отриманні.</p></div>
<div class="paragraph"><p>Аналогічний приклад, як вище, але використовуючи <code>watchWith</code> та відповіді на початковий запитувач, коли робота закінчена.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">MasterControlProgram</span> <span class="o">{</span>
  <span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Command</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SpawnJob</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">replyToWhenDone</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">JobDone</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Command</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">JobDone</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
  <span class="k">private</span> <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">JobTerminated</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">replyToWhenDone</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">JobDone</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Command</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Command</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receive</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="n">message</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">SpawnJob</span><span class="o">(</span><span class="n">jobName</span><span class="o">,</span> <span class="n">replyToWhenDone</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Spawning job {}!&quot;</span><span class="o">,</span> <span class="n">jobName</span><span class="o">)</span>
          <span class="k">val</span> <span class="n">job</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">Job</span><span class="o">(</span><span class="n">jobName</span><span class="o">),</span> <span class="n">name</span> <span class="k">=</span> <span class="n">jobName</span><span class="o">)</span>
          <span class="n">context</span><span class="o">.</span><span class="n">watchWith</span><span class="o">(</span><span class="n">job</span><span class="o">,</span> <span class="nc">JobTerminated</span><span class="o">(</span><span class="n">jobName</span><span class="o">,</span> <span class="n">replyToWhenDone</span><span class="o">))</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
        <span class="k">case</span> <span class="nc">JobTerminated</span><span class="o">(</span><span class="n">jobName</span><span class="o">,</span> <span class="n">replyToWhenDone</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Job stopped: {}&quot;</span><span class="o">,</span> <span class="n">jobName</span><span class="o">)</span>
          <span class="n">replyToWhenDone</span> <span class="o">!</span> <span class="nc">JobDone</span><span class="o">(</span><span class="n">jobName</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Зверніть увагу, як <code>replyToWhenDone</code> включається до повідомлення <code>watchWith</code>, а потім використовується пізніше при отриманні повідомлення <code>JobTerminated</code>.</p></div>
<div class="paragraph"><p>Спостерігаємим актором може бути будь-який <code>ActorRef</code>, не обов’язково бути дочірним актором, як у наведеному вище прикладі.</p></div>
<div class="paragraph"><p>Слід зазначити, що <code>terminated</code> повідомлення формується незалежно від порядку, в якому відбувається реєстрація та припинення. Зокрема, спостерігаючий актор отримає повідомлення про припинення, навіть якщо спостерігаючий актор вже був припинений на момент реєстрації.</p></div>
<div class="paragraph"><p>Реєстрація кілька разів не обов'язково призводить до створення декількох повідомлень, але немає гарантії, що буде отримано лише одне саме таке повідомлення: якщо припинення переглянутого актора генерувало та ставило в чергу повідомлення, а інша реєстрація робиться до того, як це повідомлення було дійсно оброблене, тоді друге повідомлення буде в черзі, тому що реєстрація для моніторингу вже закінченого актора призводить до негайного генерування повідомлення <code>terminated</code>.</p></div>
<div class="paragraph"><p>Можливо також скасувати реєстрацію за переглядання жвавості іншого актора, використовуючи <code>context.unwatch(target)</code>. Це працює, навіть якщо повідомлення <code>terminated</code> вже зафіксовано у поштовій скриньці; після виклику <code>unatch</code> жодне припинене повідомлення для цього актора більше не буде оброблятися.</p></div>
<div class="paragraph"><p>Повідомлення <code>terminated</code> також надсилається, коли спостерігаючий актор знаходиться на вузлі, видаленому з кластеру.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2020-06-07 23:01:53 EEST
</div>
</div>
</body>
</html>
