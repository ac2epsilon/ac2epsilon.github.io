<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="___">Вступ до прикладу</h2>
<div class="sectionbody">
<div class="paragraph"><p>Під час написання прози найважчою частиною є складання перших кількох речень. Під час створення системи Akka виникає подібне «чисте полотно». Ви можете задатися питанням: який повинен бути перший актор? Де він повинен жити? Що він повинен робити? На щастя - на відміну від прози - усталені кращі практики можуть провести нас через ці початкові кроки. У решті цього посібника ми вивчаємо основну логіку простого додатка Akka, що познайомлять вас з акторами та показати, як формулювати рішення з ними. Приклад демонструє загальні зразки, які допоможуть вам почати свої проекти Akka.</p></div>
<div class="sect2">
<h3 id="_">Передумови</h3>
<div class="paragraph"><p>Ви повинні наразі ознайомитися зі вказівками у посібнику <a href="https://developer.lightbend.com/guides/akka-quickstart-scala/?_ga=2.78769181.862459059.1579167332-1972390590.1574487700">Akka Quickstart with Scala</a>, щоб завантажити та запустити приклад Hello World. Ви використовуватимете це як початковий проект та додасте функціонал, описаний у цьому підручнику.</p></div>
<div class="paragraph"><div class="title">Зауваження</div><p>NOTE
DSL і Java, і Scala модулів Akka вбудовані в один JAR. Для поступового досвіду розробки, використовуючи IDE, наприклад Eclipse або IntelliJ, ви можете відключити в автоімпортері пропонувати імпорт <code>javadsl</code> під час роботи в Scala або навпаки. Дивіться <a href="https://doc.akka.io/docs/akka/current/additional/ide.html">Поради щодо IDE</a>.</p></div>
</div>
<div class="sect2">
<h3 id="___iot">Приклад використання IoT</h3>
<div class="paragraph"><p>У цьому підручнику ми будемо використовувати Akka для створення частини системи Internet of Things (IoT), яка повідомляє дані з сенсорних пристроїв, встановлених у будинках клієнтів. Приклад зосереджується на показниках температури. Цільовий випадок використання дозволяє клієнтам увійти та переглянути останню повідомлену температуру з різних частин своїх будинків. Ви можете уявити, що такі датчики також можуть збирати відносну вологість чи інші цікаві дані, і програма, ймовірно, підтримує зчитування та зміну конфігурації пристрою, можливо, навіть попереджає власників будинків, коли стан датчика виходить за межі певного діапазону.</p></div>
<div class="paragraph"><p>У реальній системі застосування дістається клієнтів через мобільний додаток або браузер. Цей посібник зосереджений лише на основній логіці зберігання температур, які б викликалися через мережевий протокол, наприклад, HTTP. Це також включає написання тестів, щоб допомогти вам почуватись комфортно та досвідчено в тестуванні акторів.</p></div>
<div class="paragraph"><p>Навчальний додаток складається з двох основних компонентів:</p></div>
<div class="ulist"><ul>
<li>
<p>
Збір даних про пристрій: - підтримує локальне представлення віддалених пристроїв. Кілька сенсорних пристроїв для будинку організовано в одну групу пристроїв.
</p>
</li>
<li>
<p>
Інформаційна панель користувача: - періодично збирає дані з пристроїв для зареєстрованої оселі користувача та представляє результати у вигляді звіту.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Наступна схема ілюструє архітектуру застосування. Оскільки нас цікавить стан кожного сенсорного пристрою, ми будемо моделювати пристрої як актори. Запущена програма створить стільки примірників акторів пристроїв та груп пристроїв, скільки потрібно.</p></div>
<div class="imageblock">
<div class="content">
<img src="arch_boxes_diagram.png" alt="arch_boxes_diagram.png" />
</div>
</div>
</div>
<div class="sect2">
<h3 id="_______">Про що ви дізнаєтесь у цьому підручнику</h3>
<div class="paragraph"><p>Цей підручник представляє та ілюструє:</p></div>
<div class="ulist"><ul>
<li>
<p>
Ієрархія актора та те, як вона впливає на поведінку актора
</p>
</li>
<li>
<p>
Як обрати правильну деталізацію для акторів
</p>
</li>
<li>
<p>
Як визначити протоколи як повідомлення
</p>
</li>
<li>
<p>
Типові розмовні стилі
</p>
</li>
</ul></div>
<div class="paragraph"><p>Почнемо з того, що дізнаємось більше про акторів.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__1__">Частина 1: Архітектура акторів</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__2">Залежність</h3>
<div class="paragraph"><p>Додайте таку залежність у свій проект:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;com.typesafe.akka&quot;</span> <span class="o">%%</span> <span class="s">&quot;akka-actor-typed&quot;</span> <span class="o">%</span> <span class="s">&quot;2.6.1&quot;</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="__3">Вступ</h3>
<div class="paragraph"><p>Використання Akka позбавляє вас від створення інфраструктури для системи акторів та від написання коду низького рівня, необхідного для контролю базової поведінки. Щоб оцінити це, давайте подивимося на відносини між акторами, яких ви створюєте у своєму коді, та тими, які Akka створює та керує для вас внутрішньо, життєвим циклом актора та вирішенням несправностей.</p></div>
</div>
<div class="sect2">
<h3 id="___akka">Ієрархія актора Akka</h3>
<div class="paragraph"><p>Актор в Akka завжди належить до батька. Ви створите актора, виклиаючи <code>ActorContext.spawn()</code>. Актор-творець стає батьком новоствореного дитячого актора. Ви можете запитати, хто є батьком першого актора, якого ви створюєте?</p></div>
<div class="paragraph"><p>Як показано нижче, всі актори мають спільного батька, користувацького опікуна, який визначається та створюється під час запуску <code>ActorSystem</code>. Як ми розповідали в Посібнику зі швидкого початку роботи, створення актора повертає посилання, що є валідною URL-адресою. Так, наприклад, якщо ми створимо актора з ім'ям <code>someActor</code> від опікуна користувача за допомогою <code>context.spawn(someBehavior, "someActor")</code>, його посилання буде включати шлях /<code>user/someActor</code>.</p></div>
<div class="imageblock">
<div class="content">
<img src="actor_top_tree.png" alt="actor_top_tree.png" />
</div>
</div>
<div class="paragraph"><p>Насправді, до того, як розпочати ваш перший актор, Акка вже створив двох акторів у системі. Імена цих вбудованих акторів містять позначку "опікун". До акторів-опікунів належать:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>/</code> так званий кореневий опікун. Це батько всіх акторів в системі, і останній зупиняється, коли сама система припиняється.
</p>
</li>
<li>
<p>
<code>/system</code> системний опікун. Akka або інші бібліотеки, побудовані поверх Akka, можуть створювати акторів у просторі імен <code>system</code>.
</p>
</li>
<li>
<p>
<code>/ user</code> опікун користувача. Це актор вищого рівня, який ви надаєте для запуску всіх інших акторів у вашому застосуванні.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Найпростіший спосіб побачити ієрархію акторів у дії - це надрукувати екземпляри <code>ActorRef</code>. У цьому невеликому експерименті ми створюємо актора, друкуємо його посилання, створюємо дитину цього актора та друкуємо посилання на дитину. Ми починаємо з проекту <code>Hello World</code>, якщо ви ще не завантажили його, завантажте проект Quickstart з <a href="https://developer.lightbend.com/start/?group=akka&amp;project=akka-quickstart-scala&amp;_ga=2.178160684.862459059.1579167332-1972390590.1574487700">Lightbend Tech Hub</a>.</p></div>
<div class="paragraph"><p>In your Hello World project, navigate to the com.lightbend.akka.sample package and create a new Scala file called ActorHierarchyExperiments.scala here. Copy and paste the code from the snippet below to this new source file. Save your file and run sbt "runMain com.lightbend.akka.sample.ActorHierarchyExperiments" to observe the output.
У своєму проекті <code>Hello World</code> перейдіть до пакунку <code>com.lightbend.akka.sample</code> та створіть тут новий файл Scala під назвою <code>ActorHierarchyExperiment.scala</code>. Скопіюйте та вставте код із фрагмента нижче в цей новий вихідний файл. Збережіть файл і запустіть <code>sbt "runMain com.lightbend.akka.sample.ActorHierarchyExperiment"</code>, щоб спостерігати за результатами.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.typed.ActorSystem</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.Behavior</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.AbstractBehavior</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.ActorContext</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.Behaviors</span>

<span class="k">object</span> <span class="nc">PrintMyActorRefActor</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">(</span><span class="n">context</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">PrintMyActorRefActor</span><span class="o">(</span><span class="n">context</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">PrintMyActorRefActor</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">msg</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="s">&quot;printit&quot;</span> <span class="k">=&gt;</span>
        <span class="k">val</span> <span class="n">secondRef</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">Behaviors</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="s">&quot;second-actor&quot;</span><span class="o">)</span>
        <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Second: </span><span class="si">$secondRef</span><span class="s">&quot;</span><span class="o">)</span>
        <span class="k">this</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">(</span><span class="n">context</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">Main</span><span class="o">(</span><span class="n">context</span><span class="o">))</span>

<span class="o">}</span>

<span class="k">class</span> <span class="nc">Main</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">msg</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="s">&quot;start&quot;</span> <span class="k">=&gt;</span>
        <span class="k">val</span> <span class="n">firstRef</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">PrintMyActorRefActor</span><span class="o">(),</span> <span class="s">&quot;first-actor&quot;</span><span class="o">)</span>
        <span class="n">println</span><span class="o">(</span><span class="s">s&quot;First: </span><span class="si">$firstRef</span><span class="s">&quot;</span><span class="o">)</span>
        <span class="n">firstRef</span> <span class="o">!</span> <span class="s">&quot;printit&quot;</span>
        <span class="k">this</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">ActorHierarchyExperiments</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">testSystem</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">Main</span><span class="o">(),</span> <span class="s">&quot;testSystem&quot;</span><span class="o">)</span>
  <span class="n">testSystem</span> <span class="o">!</span> <span class="s">&quot;start&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Зверніть увагу на те, як повідомлення просило першого актора зробити свою роботу. Ми надіслали повідомлення, використовуючи батьківське посилання: <code>firstRef ! "printit"</code>. Коли код виконується, вивід включає посилання на першого актора та дитини, яку він створив як частину завдання друку. Ваш результат повинен виглядати приблизно так:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>First: Actor[akka://testSystem/user/first-actor#1053618476]
Second: Actor[akka://testSystem/user/first-actor/second-actor#-1544706041]</code></pre>
</div></div>
<div class="paragraph"><p>Зверніть увагу на структуру посилань:</p></div>
<div class="ulist"><ul>
<li>
<p>
Обидва шляхи починаються з <code>akka://testSystem/</code>. Оскільки всі посилання актора є дійсними URL-адресами, <code>akka://</code>- це значення поля протоколу.
</p>
</li>
<li>
<p>
Далі, як і у всесвітній павутині, URL ідентифікує систему. У цьому прикладі система називається <code>testSystem</code>, але це може бути будь-яка інша назва. Якщо ввімкнено віддалений зв’язок між декількома системами, ця частина URL-адреси включає ім'я хоста, щоб інші системи могли знайти його в мережі.
</p>
</li>
<li>
<p>
Оскільки посилання другого актора включає шлях <code>/first-actor/</code>, він ідентифікує його як дитину першого.
</p>
</li>
<li>
<p>
Остання частина посилання на актора, <code>#1053618476</code> або <code>#-1544706041</code>, є унікальним ідентифікатором, який ви можете ігнорувати в більшості випадків.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Тепер, коли ви зрозуміли, як виглядає ієрархія акторів, вам може бути цікаво: <em>навіщо нам потрібна ця ієрархія</em>? Для чого вона використовується?</p></div>
<div class="paragraph"><p>Важлива роль ієрархії - безпечне управління життєвими циклами акторів. Давайте розглянемо це далі і подивимось, як ці знання можуть допомогти нам написати кращий код.</p></div>
</div>
<div class="sect2">
<h3 id="____2">Життєвий цикл актора</h3>
<div class="paragraph"><p>Актори набувать життя, коли їх створюють, а потім, за бажанням користувачів, їх зупиняють. Кожного разу, коли актора зупиняють, всі його діти теж припиняються. Така поведінка значно спрощує очищення ресурсів та допомагає уникнути витоків ресурсів, таких як відкриті сокети та файли. Фактично, загально недооціненні труднощі при роботі з низькорівневим багатопотоковим кодом - це управління життєвим циклом різних супутніх ресурсів.</p></div>
<div class="paragraph"><p>Щоб зупинити актора, рекомендований шаблон поведінки - повернути <code>Behaviors.stopped()</code> всередині актора, щоб зупинитись самостійно, як правило у відповідь на певне повідомлення про зупинку, визначене користувачем, або коли актор скінчає свою роботу. Зупинити дочірнього актора технічно можливо, викликавши <code>context.stop(childRef)</code> від батька, але зупинити довільні (не-дочірні) актори таким чином неможливо.</p></div>
<div class="paragraph"><p>API актора Akka пропонує деякі сигнали життєвого циклу, наприклад, <code>PostStop</code> надсилається безпосередньо перед тим, як актор зупиняється. Після цього часу повідомлення не обробляються.</p></div>
<div class="paragraph"><p>Давайте використаємо сигнал життєвого циклу <code>PostStop</code> у простому експерименті, щоб спостерігати за поведінкою, коли ми зупиняємо актора. Спочатку додайте до свого проекту два класи акторів:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">StartStopActor1</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">(</span><span class="n">context</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">StartStopActor1</span><span class="o">(</span><span class="n">context</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">StartStopActor1</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;first started&quot;</span><span class="o">)</span>
  <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">StartStopActor2</span><span class="o">(),</span> <span class="s">&quot;second&quot;</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">msg</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="s">&quot;stop&quot;</span> <span class="k">=&gt;</span> <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
    <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onSignal</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Signal</span>, <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">PostStop</span> <span class="k">=&gt;</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;first stopped&quot;</span><span class="o">)</span>
      <span class="k">this</span>
  <span class="o">}</span>

<span class="o">}</span>

<span class="k">object</span> <span class="nc">StartStopActor2</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">(</span><span class="k">new</span> <span class="nc">StartStopActor2</span><span class="o">(</span><span class="k">_</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">StartStopActor2</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;second started&quot;</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="c1">// цей актор не обробляє повідомлень</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">unhandled</span>
  <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onSignal</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Signal</span>, <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">PostStop</span> <span class="k">=&gt;</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;second stopped&quot;</span><span class="o">)</span>
      <span class="k">this</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>І створіть як <code>'main'</code> клас, як вище, щоб запустити акторів, а потім надішліть їм повідомлення <code>"stop"</code>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">first</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">StartStopActor1</span><span class="o">(),</span> <span class="s">&quot;first&quot;</span><span class="o">)</span>
<span class="n">first</span> <span class="o">!</span> <span class="s">&quot;stop&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Ви знову можете використовувати sbt для запуску цієї програми. Вихід повинен виглядати так:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>first started
second started
second stopped
first stopped</code></pre>
</div></div>
<div class="paragraph"><p>Коли ми зупинили актора <code>first</code>, він зупинив свого дитячого актора, <code>second</code>, перш ніж зупинити себе. Цей порядок жорсткий, усі сигнали <code>PostStop</code> дітей обробляються до обробки <code>PostStop</code> батьківського сигналу.</p></div>
</div>
<div class="sect2">
<h3 id="__">Обробка збоїв</h3>
<div class="paragraph"><p>Батьки та діти пов'язані протягом усього життєвого циклу. Кожного разу, коли актор не спрацьовує (закидає виключення або необроблені бульбашки виключень спливають з <code>onMessage</code>), інформація про відмову просувається до стратегії нагляду, яка потім вирішує, як поводитися з виключенням, спричиненим актором. Стратегія нагляду, як правило, визначається батьківським актором, коли той породжує дитячого актора. Таким чином батьки виступають в ролі наглядачів за своїми дітьми. Стратегія нагляду за замовчуванням - зупинити дитину. Якщо ви не визначите стратегію, всі збої призводять до зупинки.</p></div>
<div class="paragraph"><p>Давайте дослідимо стратегії перезавантаження у простому експерименті. Додайте наступні класи до свого проекту, як ви робили з попередніми:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">SupervisingActor</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">(</span><span class="n">context</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">SupervisingActor</span><span class="o">(</span><span class="n">context</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">SupervisingActor</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">val</span> <span class="n">child</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">supervise</span><span class="o">(</span><span class="nc">SupervisedActor</span><span class="o">()).</span><span class="n">onFailure</span><span class="o">(</span><span class="nc">SupervisorStrategy</span><span class="o">.</span><span class="n">restart</span><span class="o">),</span>
    <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;supervised-actor&quot;</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">msg</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="s">&quot;failChild&quot;</span> <span class="k">=&gt;</span>
        <span class="n">child</span> <span class="o">!</span> <span class="s">&quot;fail&quot;</span>
        <span class="k">this</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">SupervisedActor</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">(</span><span class="n">context</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">SupervisedActor</span><span class="o">(</span><span class="n">context</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">SupervisedActor</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;supervised actor started&quot;</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">msg</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="s">&quot;fail&quot;</span> <span class="k">=&gt;</span>
        <span class="n">println</span><span class="o">(</span><span class="s">&quot;supervised actor fails now&quot;</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nc">Exception</span><span class="o">(</span><span class="s">&quot;I failed!&quot;</span><span class="o">)</span>
    <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onSignal</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Signal</span>, <span class="kt">Behavior</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">PreRestart</span> <span class="k">=&gt;</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;supervised actor will be restarted&quot;</span><span class="o">)</span>
      <span class="k">this</span>
    <span class="k">case</span> <span class="nc">PostStop</span> <span class="k">=&gt;</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;supervised actor stopped&quot;</span><span class="o">)</span>
      <span class="k">this</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>І виконайте:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">supervisingActor</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">SupervisingActor</span><span class="o">(),</span> <span class="s">&quot;supervising-actor&quot;</span><span class="o">)</span>
<span class="n">supervisingActor</span> <span class="o">!</span> <span class="s">&quot;failChild&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Ви повинні побачити вихід подібний до наступного:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>supervised actor started
supervised actor fails now
supervised actor will be restarted
supervised actor started
[ERROR] [11/12/2018 12:03:27.171] [ActorHierarchyExperiments-akka.actor.default-dispatcher-2] [akka://ActorHierarchyExperiments/user/supervising-actor/supervised-actor] Supervisor akka.actor.typed.internal.RestartSupervisor@1c452254 saw failure: I failed!
java.lang.Exception: I failed!
        at typed.tutorial_1.SupervisedActor.onMessage(ActorHierarchyExperiments.scala:113)
        at typed.tutorial_1.SupervisedActor.onMessage(ActorHierarchyExperiments.scala:106)
        at akka.actor.typed.scaladsl.AbstractBehavior.receive(AbstractBehavior.scala:59)
        at akka.actor.typed.Behavior$.interpret(Behavior.scala:395)
        at akka.actor.typed.Behavior$.interpretMessage(Behavior.scala:369)
        at akka.actor.typed.internal.InterceptorImpl$$anon$2.apply(InterceptorImpl.scala:49)
        at akka.actor.typed.internal.SimpleSupervisor.aroundReceive(Supervision.scala:85)
        at akka.actor.typed.internal.InterceptorImpl.receive(InterceptorImpl.scala:70)
        at akka.actor.typed.Behavior$.interpret(Behavior.scala:395)
        at akka.actor.typed.Behavior$.interpretMessage(Behavior.scala:369)</code></pre>
</div></div>
<div class="paragraph"><p>Ми бачимо, що після відмови керований актор зупиняється та негайно перезапускається. Ми також бачимо запис журналу, який повідомляє про виключення, який обробляли, у цьому випадку - наше тестове виключення. У цьому прикладі ми також використовували сигнал <code>PreRestart</code>, який обробляється перед перезапуском.</p></div>
<div class="paragraph"><p>For the impatient, we also recommend looking into the fault tolerance reference page for more in-depth details.
Для нетерплячих ми також радимо заглянути на довідкову сторінку щодо стійкості до відмов для отримання більш поглиблених деталей.</p></div>
</div>
<div class="sect2">
<h3 id="__4">Підсумок</h3>
<div class="paragraph"><p>Ми дізналися про те, як Akka керує акторами в ієрархіях, де батьки контролюють своїх дітей та обробляють виключення. Ми побачили, як створити дуже простого актора та дитину. Далі ми застосуємо ці знання до прикладу використання, моделюючи комунікацію, необхідну для отримання інформації від акторів пристрою. Пізніше ми розберемося з тим, як керувати акторами в групах.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__2___">Частина 2: Створення першого актора</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__5">Вступ</h3>
<div class="paragraph"><p>З розумінням ієрархії та поведінки акторів, питання, що залишається, полягає в тому, як поєднати високорівневі компоненти нашої системи IoT з акторами. Опікуном користувача може бути актор, який представляє всю програму. Іншими словами, у нас в системі IoT буде єдиний актор вищого рівня. Компоненти, які створюють пристрої та панелі керування, будуть дітьми цього актора. Це дозволяє нам переробити приклад використання діаграми архітектури випадку на дерево акторів:</p></div>
<div class="imageblock">
<div class="content">
<img src="arch_tree_diagram.png" alt="arch_tree_diagram.png" />
</div>
</div>
<div class="paragraph"><p>Ми можемо визначити першого актора, IotSupervisor, за допомогою кількох рядків коду. Щоб почати свою програму:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Створіть новий вихідний файл <code>IotSupervisor</code> в пакеті <code>com.lightbend.akka.sample</code>.
</p>
</li>
<li>
<p>
Вставте наступний код у новий файл, щоб визначити <code>IotSupervisor</code>.
</p>
</li>
</ol></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.typed.Behavior</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.PostStop</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.Signal</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.AbstractBehavior</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.ActorContext</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.Behaviors</span>

<span class="k">object</span> <span class="nc">IotSupervisor</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">](</span><span class="n">context</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">IotSupervisor</span><span class="o">(</span><span class="n">context</span><span class="o">))</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">IotSupervisor</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;IoT Application started&quot;</span><span class="o">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">Nothing</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="c1">// No need to handle any messages</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">unhandled</span>
  <span class="o">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="n">onSignal</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Signal</span>, <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">PostStop</span> <span class="k">=&gt;</span>
      <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;IoT Application stopped&quot;</span><span class="o">)</span>
      <span class="k">this</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Код подібний до прикладів акторів, які ми використовували в попередніх експериментах, але зауважте, що замість <code>printl()</code> ми використовуємо вбудований у програму журнал Akka через <code>context.log</code>.</p></div>
<div class="paragraph"><p>Щоб забезпечити головну точку входу, яка створює систему акторів, додайте наступний код до нового об'єкта <code>IotApp</code>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.typed.ActorSystem</span>

<span class="k">object</span> <span class="nc">IotApp</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="c1">// Створення ActorSystem та високорівневого наглядача</span>
    <span class="nc">ActorSystem</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">](</span><span class="nc">IotSupervisor</span><span class="o">(),</span> <span class="s">&quot;iot-system&quot;</span><span class="o">)</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Додаток робить мало, крім запису до журналу, коли він запускається. Але у нас перший актор на місці, і ми готові додати інших акторів.</p></div>
</div>
<div class="sect2">
<h3 id="___2">Що далі?</h3>
<div class="paragraph"><p>У наступних розділах ми будемо нарощувати додаток поступово:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Створимо представлення для пристрою.
</p>
</li>
<li>
<p>
Створимо компонент керування пристроєм.
</p>
</li>
<li>
<p>
Додамо можливості запитів до груп пристроїв.
</p>
</li>
</ol></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__3____">Частина 3: Робота з акторами пристроїв</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="__6">Вступ</h3>
<div class="paragraph"><p>У попередніх темах ми пояснювали, як розглядати акторські системи загалом, тобто як компоненти повинні бути представлені, як актори повинні бути розташовані в ієрархії. У цій частині ми розглянемо акторів у малому, реалізуючи актор прострою.</p></div>
<div class="paragraph"><p>Якби ми працювали з об'єктами, ми зазвичай розробляли API як інтерфейси - набір абстрактних методів, які заповнюються фактичною реалізацією. У світі акторів протоколи займають місце інтерфейсів. Хоча формалізувати загальні протоколи мовою програмування неможливо, ми можемо скласти їхній основний елемент - повідомлення. Отже, ми почнемо з ідентифікації повідомлень, які ми хочемо надіслати акторам пристроїв.</p></div>
<div class="paragraph"><p>Зазвичай повідомлення підпадають під категорії або шаблони. Визначивши ці закономірності, ви побачите, що стає простіше обирати між ними та реалізовувати їх. Перший приклад демонструє схему повідомлення на відповідь на запит.</p></div>
</div>
<div class="sect2">
<h3 id="____">Ідентифікація повідомлень для пристроїв</h3>
<div class="paragraph"><p>Завдання актора пристрою будуть простими:</p></div>
<div class="ulist"><ul>
<li>
<p>
Зберати вимірювання температури
</p>
</li>
<li>
<p>
На запит повідомити про останню вимірювану температуру
</p>
</li>
</ul></div>
<div class="paragraph"><p>Однак пристрій може запуститися без попереднього вимірювання температури. Отже, нам потрібно враховувати випадок, коли немає температури. Це також дозволяє перевірити частину запиту актора без присутності частини запису, 