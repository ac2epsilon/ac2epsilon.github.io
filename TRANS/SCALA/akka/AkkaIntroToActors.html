<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title></title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="___">Вступ до акторів</h2>
<div class="sectionbody">
<div class="paragraph"><p>Документацію цієї функції Akka Classic див. у розділі <a href="https://doc.akka.io/docs/akka/current/actors.html">Класичні актори</a>.</p></div>
<div class="sect2">
<h3 id="____2">Інформація про модуль</h3>
<div class="paragraph"><p>Щоб використовувати Akka Actors, додайте таку залежність у свій проект:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;com.typesafe.akka&quot;</span> <span class="o">%%</span> <span class="s">&quot;akka-actor-typed&quot;</span> <span class="o">%</span> <span class="s">&quot;2.6.5&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>DSL, і Java, і Scala модулів Akka вбудовані в один JAR. Для безперебійного досвіду розробки, використовуючи IDE, наприклад Eclipse або IntelliJ, ви можете відключити автоімпортеру пропонувати імпорт javadsl під час роботи в Scala або viceversa. Див. Поради щодо IDE.</p></div>
</div>
<div class="sect2">
<h3 id="__">Акка Актори</h3>
<div class="paragraph"><p>Акторська модель забезпечує більш високий рівень абстракції для написання одночасних та розподілених систем. Це позбавляє розробника від необхідності мати справу з явним блокуванням та керуванням потоками, полегшуючи запис правильних конкурентних та паралельних систем. Актори були визначені в статті 1973 року Карлом Хьюіттом, але вони були популяризовані мовою Erlang, і, наприклад, використовувались в компанії Ericsson з великим успіхом для створення високо одночасних і надійних телекомунікаційних систем. API акторів Akka запозичив частину свого синтаксису у Erlang.</p></div>
</div>
<div class="sect2">
<h3 id="___2">Перший приклад</h3>
<div class="paragraph"><p>Якщо ви новачок у Akka, ви можете почати з читання Посібника з початку роботи, а потім повернутися сюди, щоб дізнатися більше. Ми також рекомендуємо переглянути коротке вступне відео про акторів Akka.</p></div>
<div class="paragraph"><p>Корисно ознайомитись із основоположною, зовнішньою та внутрішньою екосистемою своїх акторів, щоб побачити, чим можна скористатися та налаштувати за потребою, див. Акторські системи та Довідкові матеріали акторів, Шляхи та адреси.</p></div>
<div class="paragraph"><p>Як обговорювалося в Системи Акторів, актори стосуються надсилання повідомлень між незалежними одиницями обчислення, але як це виглядає?</p></div>
<div class="paragraph"><p>У всіх наступних випадках передбачається цей імпорт:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.Behaviors</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.LoggerOps</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.</span><span class="o">{</span> <span class="nc">ActorRef</span><span class="o">,</span> <span class="nc">ActorSystem</span><span class="o">,</span> <span class="nc">Behavior</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Маючи це на своєму місці, ми можемо визначити нашого першого Актора, і він привітається!</p></div>
<div class="imageblock">
<div class="content">
<img src="hello-world1.png" alt="hello-world1.png" />
</div>
</div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Greet</span><span class="o">(</span><span class="n">whom</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">replyTo</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">Greeted</span><span class="o">])</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Greeted</span><span class="o">(</span><span class="n">whom</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">from</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">Greet</span><span class="o">])</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Greet</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receive</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Hello {}!&quot;</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="o">)</span>
    <span class="n">message</span><span class="o">.</span><span class="n">replyTo</span> <span class="o">!</span> <span class="nc">Greeted</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="n">self</span><span class="o">)</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Цей невеликий фрагмент коду визначає два типи повідомлень: одне для наказу Актору привітати когось і те, яке Актор використовуватиме для підтвердження того, що він це зробив. Тип привітання містить не тільки інформацію, кого вітати, але також містить <code>ActorRef</code>, який надає постачальник повідомлення, щоб <code>HelloWorld Actor</code> міг повернути повідомлення підтвердження.</p></div>
<div class="paragraph"><p>Поведінка Актора визначається як <code>Greeter</code> за допомогою фабрики поведінки <code>receive</code>. Потім обробка наступного повідомлення призводить до появи нової поведінки, яка потенційно може відрізнятися від цієї. Стан оновлюється шляхом повернення нової поведінки, яка утримує новий незмінний стан. У цьому випадку нам не потрібно оновлювати жоден стан, тому ми повертаємо <code>same</code>, що означає, що наступна поведінка "така ж, як і поточна".</p></div>
<div class="paragraph"><p>Тип повідомлень, якім обробляється така поведінка, оголошується класом <code>Greet</code>, тобто аргумент повідомлення також типізований як такий. Ось чому ми можемо отримати доступ до <code>whom</code> та відповісти <code>replyTo</code>, не використовуючи відповідність шаблону. Зазвичай актор обробляє більше одного конкретного типу повідомлення, де всі вони прямо чи опосередковано розширюють загальний трейт.</p></div>
<div class="paragraph"><p>В останньому рядку ми бачимо, що <code>HelloWorld Actor</code> надсилає повідомлення іншому Актору, що робиться за допомогою оператор <code>!</code> (вимовляється «bang» або «tell»). Це асинхронна операція, яка не блокує потік абонента.</p></div>
<div class="paragraph"><p>Оскільки адреса <code>replyTo</code> оголошена типу <code>ActorRef[Greeted]</code>, компілятор дозволить нам лише надсилати повідомлення такого типу, інше використання буде помилкою компілятора.</p></div>
<div class="paragraph"><p>Прийняті типи повідомлень Актора разом із усіма типами відповідей визначає протокол, яким говорить цей Актор; у цьому випадку це простий протокол запит-відповідь, але Актори можуть моделювати довільно складні протоколи за потреби. Протокол поєднується з поведінкою, яка реалізує його в добре огорнутій області - об'єкті HelloWorld.</p></div>
<div class="paragraph"><p>Як сказав Карл Хьюїтт, один актор - це не актор - це було б дуже самотньо, коли ні ким з ким говорити. Нам потрібен ще один Актор, який взаємодіє з <code>Greeter</code>. Давайте зробимо <code>HelloWorldBot</code>, який отримує відповідь від привітання та надсилає ряд додаткових вітальних повідомлень та збирає відповіді, поки не буде досягнуто заданої максимальної кількості повідомлень.</p></div>
<div class="imageblock">
<div class="content">
<img src="hello-world2.png" alt="hello-world2.png" />
</div>
</div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">HelloWorldBot</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">max</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">HelloWorld.Greeted</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">bot</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">max</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="k">private</span> <span class="k">def</span> <span class="n">bot</span><span class="o">(</span><span class="n">greetingCounter</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">max</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
    <span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">HelloWorld.Greeted</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receive</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">n</span> <span class="k">=</span> <span class="n">greetingCounter</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info2</span><span class="o">(</span><span class="s">&quot;Greeting {} for {}&quot;</span><span class="o">,</span> <span class="n">n</span><span class="o">,</span> <span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="o">)</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">max</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">message</span><span class="o">.</span><span class="n">from</span> <span class="o">!</span> <span class="nc">HelloWorld</span><span class="o">.</span><span class="nc">Greet</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="n">self</span><span class="o">)</span>
        <span class="n">bot</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">max</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Зауважте, як цей Актор управляє лічильником, змінюючи поведінку для кожної відповіді, а не використовуючи будь-які змінні. Не потрібні захисники одночасності, такі як <code>synchronized</code> або <code>AtomicInteger</code>, оскільки екземпляр актора обробляє одне повідомлення за раз.</p></div>
<div class="paragraph"><p>Третій актор породжує <code>Greeter</code> та <code>HelloWorldBot</code> і починає взаємодію між ними.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">HelloWorldMain</span> <span class="o">{</span>

  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SayHello</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SayHello</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">greeter</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorld</span><span class="o">(),</span> <span class="s">&quot;greeter&quot;</span><span class="o">)</span>

      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveMessage</span> <span class="o">{</span> <span class="n">message</span> <span class="k">=&gt;</span>
        <span class="k">val</span> <span class="n">replyTo</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorldBot</span><span class="o">(</span><span class="n">max</span> <span class="k">=</span> <span class="mi">3</span><span class="o">),</span> <span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
        <span class="n">greeter</span> <span class="o">!</span> <span class="nc">HelloWorld</span><span class="o">.</span><span class="nc">Greet</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="n">replyTo</span><span class="o">)</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Тепер ми хочемо спробувати цього Актора, тому ми повинні запустити <code>ActorSystem</code> для його розміщення:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">[</span><span class="kt">HelloWorldMain.SayHello</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">HelloWorldMain</span><span class="o">(),</span> <span class="s">&quot;hello&quot;</span><span class="o">)</span>

<span class="n">system</span> <span class="o">!</span> <span class="nc">HelloWorldMain</span><span class="o">.</span><span class="nc">SayHello</span><span class="o">(</span><span class="s">&quot;World&quot;</span><span class="o">)</span>
<span class="n">system</span> <span class="o">!</span> <span class="nc">HelloWorldMain</span><span class="o">.</span><span class="nc">SayHello</span><span class="o">(</span><span class="s">&quot;Akka&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Ми запускаємо систему з визначеної поведінки <code>HelloWorldMain</code> і надсилаємо два повідомлення <code>SayHello</code>, які розпочнуть взаємодію між двома окремими акторами <code>HelloWorldBot</code> та одним актором <code>Greeter</code>.</p></div>
<div class="paragraph"><p>Додаток, як правило, складається з однієї системи <code>ActorSystem</code>, на якій працює багато акторів, на кожній JVM.</p></div>
<div class="paragraph"><p>Вихід консолі може виглядати так:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[INFO] [03/13/2018 15:50:05.814] [hello-akka.actor.default-dispatcher-4] [akka://hello/user/greeter] Hello World!
[INFO] [03/13/2018 15:50:05.815] [hello-akka.actor.default-dispatcher-4] [akka://hello/user/greeter] Hello Akka!
[INFO] [03/13/2018 15:50:05.815] [hello-akka.actor.default-dispatcher-2] [akka://hello/user/World] Greeting 1 for World
[INFO] [03/13/2018 15:50:05.815] [hello-akka.actor.default-dispatcher-4] [akka://hello/user/Akka] Greeting 1 for Akka
[INFO] [03/13/2018 15:50:05.815] [hello-akka.actor.default-dispatcher-5] [akka://hello/user/greeter] Hello World!
[INFO] [03/13/2018 15:50:05.815] [hello-akka.actor.default-dispatcher-5] [akka://hello/user/greeter] Hello Akka!
[INFO] [03/13/2018 15:50:05.815] [hello-akka.actor.default-dispatcher-4] [akka://hello/user/World] Greeting 2 for World
[INFO] [03/13/2018 15:50:05.815] [hello-akka.actor.default-dispatcher-5] [akka://hello/user/greeter] Hello World!
[INFO] [03/13/2018 15:50:05.815] [hello-akka.actor.default-dispatcher-4] [akka://hello/user/Akka] Greeting 2 for Akka
[INFO] [03/13/2018 15:50:05.816] [hello-akka.actor.default-dispatcher-5] [akka://hello/user/greeter] Hello Akka!
[INFO] [03/13/2018 15:50:05.816] [hello-akka.actor.default-dispatcher-4] [akka://hello/user/World] Greeting 3 for World
[INFO] [03/13/2018 15:50:05.816] [hello-akka.actor.default-dispatcher-6] [akka://hello/user/Akka] Greeting 3 for Akka</code></pre>
</div></div>
<div class="paragraph"><p>Вам також потрібно буде додати <a href="https://doc.akka.io/docs/akka/current/typed/logging.html">залежність реєстрації</a>, щоб побачити цей результат під час запуску.</p></div>
<div class="paragraph"><p>Ось ще один приклад, який можна редагувати та запускати у веб-переглядачі:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.Behaviors</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.scaladsl.LoggerOps</span>
<span class="k">import</span> <span class="nn">akka.actor.typed.</span><span class="o">{</span> <span class="nc">ActorRef</span><span class="o">,</span> <span class="nc">ActorSystem</span><span class="o">,</span> <span class="nc">Behavior</span> <span class="o">}</span>

<span class="k">object</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Greet</span><span class="o">(</span><span class="n">whom</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">replyTo</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">Greeted</span><span class="o">])</span>
  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Greeted</span><span class="o">(</span><span class="n">whom</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">from</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">Greet</span><span class="o">])</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">Greet</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receive</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Hello </span><span class="si">${</span><span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="si">}</span><span class="s">!&quot;</span><span class="o">)</span>
    <span class="n">message</span><span class="o">.</span><span class="n">replyTo</span> <span class="o">!</span> <span class="nc">Greeted</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="n">self</span><span class="o">)</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">HelloWorldBot</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">max</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">HelloWorld.Greeted</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">bot</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">max</span><span class="o">)</span>
  <span class="o">}</span>

  <span class="k">private</span> <span class="k">def</span> <span class="n">bot</span><span class="o">(</span><span class="n">greetingCounter</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">max</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">HelloWorld.Greeted</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receive</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">n</span> <span class="k">=</span> <span class="n">greetingCounter</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Greeting </span><span class="si">$n</span><span class="s"> for </span><span class="si">${</span><span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="si">}</span><span class="s">&quot;</span><span class="o">)</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">max</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">message</span><span class="o">.</span><span class="n">from</span> <span class="o">!</span> <span class="nc">HelloWorld</span><span class="o">.</span><span class="nc">Greet</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">whom</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="n">self</span><span class="o">)</span>
        <span class="n">bot</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">max</span><span class="o">)</span>
      <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">HelloWorldMain</span> <span class="o">{</span>

  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SayHello</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SayHello</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">greeter</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorld</span><span class="o">(),</span> <span class="s">&quot;greeter&quot;</span><span class="o">)</span>

      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveMessage</span> <span class="o">{</span> <span class="n">message</span> <span class="k">=&gt;</span>
        <span class="k">val</span> <span class="n">replyTo</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">HelloWorldBot</span><span class="o">(</span><span class="n">max</span> <span class="k">=</span> <span class="mi">3</span><span class="o">),</span> <span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">)</span>
        <span class="n">greeter</span> <span class="o">!</span> <span class="nc">HelloWorld</span><span class="o">.</span><span class="nc">Greet</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="n">replyTo</span><span class="o">)</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
    <span class="o">}</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">system</span><span class="k">:</span> <span class="kt">ActorSystem</span><span class="o">[</span><span class="kt">HelloWorldMain.SayHello</span><span class="o">]</span> <span class="k">=</span>
      <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">HelloWorldMain</span><span class="o">(),</span> <span class="s">&quot;hello&quot;</span><span class="o">)</span>

    <span class="n">system</span> <span class="o">!</span> <span class="nc">HelloWorldMain</span><span class="o">.</span><span class="nc">SayHello</span><span class="o">(</span><span class="s">&quot;World&quot;</span><span class="o">)</span>
    <span class="n">system</span> <span class="o">!</span> <span class="nc">HelloWorldMain</span><span class="o">.</span><span class="nc">SayHello</span><span class="o">(</span><span class="s">&quot;Akka&quot;</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Це виконується в ScalaFiddle</span>
<span class="nc">HelloWorldMain</span><span class="o">.</span><span class="n">main</span><span class="o">(</span><span class="nc">Array</span><span class="o">.</span><span class="n">empty</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="____3">Більш складний приклад</h3>
<div class="paragraph"><p>Наступний приклад більш реалістичний і демонструє деякі важливі закономірності:</p></div>
<div class="ulist"><ul>
<li>
<p>
Використання закоркованого кейс класу/об'єктів для представлення кількох повідомлень, які може отримати актор
</p>
</li>
<li>
<p>
Обробка сеансів, використовуючи дитячих акторів
</p>
</li>
<li>
<p>
Поводження зі станом шляхом зміни поведінки
</p>
</li>
<li>
<p>
Використання декількох акторів для представлення різних частин протоколу безпечним способом
</p>
</li>
</ul></div>
<div class="imageblock">
<div class="content">
<img src="chat-room.png" alt="chat-room.png" />
</div>
</div>
<div class="sect3">
<h4 id="___3">Функціональний стиль</h4>
<div class="paragraph"><p>Спочатку ми покажемо цей приклад у функціональному стилі, а потім той самий приклад показаний із об’єктно-орієнтованим стилем. Який стиль ви вирішите використовувати - це питання смаку, і обидва стилі можна змішувати залежно від того, який найкращий для конкретного актора. Розглядання вибору наведено в <a href="https://doc.akka.io/docs/akka/current/typed/style-guide.html#functional-versus-object-oriented-style">Посібнику зі стилів</a>.</p></div>
<div class="paragraph"><p>Подумайте про Актора, який працює в чаті: клієнти-актори можуть підключитися, надіславши повідомлення, яке містить їх ім'я на екрані, а потім вони можуть розміщувати повідомлення. Актор чата поширюватиме всі опубліковані повідомлення всім поточно підключеним клієнтським акторам. Визначення протоколу може виглядати наступним чином:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">RoomCommand</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">GetSession</span><span class="o">(</span><span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">replyTo</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">SessionEvent</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">RoomCommand</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">SessionEvent</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SessionGranted</span><span class="o">(</span><span class="n">handle</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">PostMessage</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">SessionEvent</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SessionDenied</span><span class="o">(</span><span class="n">reason</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SessionEvent</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">MessagePosted</span><span class="o">(</span><span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SessionEvent</span>

<span class="k">trait</span> <span class="nc">SessionCommand</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">PostMessage</span><span class="o">(</span><span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SessionCommand</span>
<span class="k">private</span> <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">NotifyClient</span><span class="o">(</span><span class="n">message</span><span class="k">:</span> <span class="kt">MessagePosted</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SessionCommand</span>
</pre></div></div></div>
<div class="paragraph"><p>Спочатку клієнтські актори отримують доступ лише до <code>ActorRef[GetSession]</code>, який дозволяє їм зробити перший крок. Після того, як сеанс клієнта встановлено, він отримує повідомлення <code>SessionGranted</code>, що містить ручку для розблокування наступного кроку протоколу, розміщення повідомлень. Команду <code>PostMessage</code> потрібно буде надіслати на цю конкретну адресу, яка представляє сеанс, доданий до кімнати чату. Інший аспект сеансу полягає в тому, що клієнт виявив власну адресу через аргумент <code>replyTo</code>, щоб наступні події <code>MessagePosted</code> могли надсилатися на нього.</p></div>
<div class="paragraph"><p>Це ілюструє, як Актори можуть виражати більше, ніж просто еквівалент викликів методів на об'єктах Java. Задекларовані типи повідомлень та їх вміст описують повний протокол, який може включати декілька Акторів і може розвиватися протягом декількох кроків. Ось реалізація протоколу чатової кімнати:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">ChatRoom</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">PublishSessionMessage</span><span class="o">(</span><span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">RoomCommand</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">RoomCommand</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">chatRoom</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="n">empty</span><span class="o">)</span>

  <span class="k">private</span> <span class="k">def</span> <span class="n">chatRoom</span><span class="o">(</span><span class="n">sessions</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">ActorRef</span><span class="o">[</span><span class="kt">SessionCommand</span><span class="o">]])</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">RoomCommand</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receive</span> <span class="o">{</span> <span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="n">message</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">GetSession</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">client</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="c1">// створити дитячого актора для спілкування з клієнтом</span>
          <span class="k">val</span> <span class="n">ses</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span>
            <span class="n">session</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="n">self</span><span class="o">,</span> <span class="n">screenName</span><span class="o">,</span> <span class="n">client</span><span class="o">),</span>
            <span class="n">name</span> <span class="k">=</span> <span class="nc">URLEncoder</span><span class="o">.</span><span class="n">encode</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="nc">UTF_8</span><span class="o">.</span><span class="n">name</span><span class="o">))</span>
          <span class="n">client</span> <span class="o">!</span> <span class="nc">SessionGranted</span><span class="o">(</span><span class="n">ses</span><span class="o">)</span>
          <span class="n">chatRoom</span><span class="o">(</span><span class="n">ses</span> <span class="o">::</span> <span class="n">sessions</span><span class="o">)</span>
        <span class="k">case</span> <span class="nc">PublishSessionMessage</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="k">val</span> <span class="n">notification</span> <span class="k">=</span> <span class="nc">NotifyClient</span><span class="o">(</span><span class="nc">MessagePosted</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">))</span>
          <span class="n">sessions</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="k">_</span> <span class="o">!</span> <span class="n">notification</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
    <span class="o">}</span>

  <span class="k">private</span> <span class="k">def</span> <span class="n">session</span><span class="o">(</span>
      <span class="n">room</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">PublishSessionMessage</span><span class="o">],</span>
      <span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
      <span class="n">client</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">SessionEvent</span><span class="o">])</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SessionCommand</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveMessage</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">PostMessage</span><span class="o">(</span><span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="c1">// від клієнта, публікуємо в кімнаті</span>
        <span class="n">room</span> <span class="o">!</span> <span class="nc">PublishSessionMessage</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="k">case</span> <span class="nc">NotifyClient</span><span class="o">(</span><span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
        <span class="c1">// публікація від кімнати</span>
        <span class="n">client</span> <span class="o">!</span> <span class="n">message</span>
        <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Стан керується зміною поведінки, а не використанням будь-яких змінних.</p></div>
<div class="paragraph"><p>Коли надходить нова команда <code>GetSession</code>, ми додаємо цього клієнта до списку, який знаходиться у повернутій поведінці. Тоді нам також потрібно створити <code>ActorRef</code> сесії, який буде використовуватися для розміщення повідомлень. У цьому випадку ми хочемо створити дуже простий Actor, який перепаковує команду <code>PostMessage</code> в команду <code>PublishSessionMessage</code>, яка також включає екрана ім'я.</p></div>
<div class="paragraph"><p>Поведінка, яку ми тут декларуємо, може обробляти обидва підтипи <code>RoomCommand</code>. <code>GetSession</code> уже роз'яснено, і команди <code>PublishSessionMessage</code>, що надходять із сеансових акторів, спровокують розповсюдження вміщеного повідомлення в чаті для всіх підключених клієнтів. Але ми не хочемо надавати можливість надсилати команди <code>PublishSessionMessage</code> довільним клієнтам, ми залишаємо це право за внутрішніми акторами сессій, які ми створюємо. Інакше клієнти можуть представляти зовсім інші екранні імена (уявіть протокол <code>GetSession</code>, щоб включити інформацію про автентифікацію для подальшого захисту). Тому <code>PublishSessionMessage</code> має приватну видимість і не може бути створений поза об’єктом <code>ChatRoom</code>.</p></div>
<div class="paragraph"><p>Якщо б нам не було бажання забезпечити відповідність між сеансом та ім'ям екрана, то ми могли б змінити протокол таким чином, щоб <code>PostMessage</code> видалявся, а всі клієнти просто отримували <code>ActorRef[PublishSessionMessage]</code> для розсилки. У цьому випадку не потрібен актор сеансу, і ми могли б використовувати <code>context.self</code>. У цьому випадку перевірки типу діють, тому що <code>ActorRef[-T]</code> контрваріантний у своєму параметрі типу. Це означає, що ми можемо використовувати <code>ActorRef[RoomCommand]</code> там, де потрібен <code>ActorRef [PublishSessionMessage]</code> - це має сенс, тому що перший просто говорить на більше мовах, ніж останній. Протилежне було б проблематичним, тому передача <code>ActorRef[PublishSessionMessage]</code>, де потрібно <code>ActorRef[RoomCommand]</code>, призведе до помилки типу.</p></div>
</div>
<div class="sect3">
<h4 id="____4">Випробуйте це самостійно</h4>
<div class="paragraph"><p>Для того, щоб побачити цю кімнату чату в дії, нам потрібно написати клієнтського Актора, який може нею користуватися:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">Gabbler</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">ChatRoom._</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SessionEvent</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveMessage</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">SessionGranted</span><span class="o">(</span><span class="n">handle</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">handle</span> <span class="o">!</span> <span class="nc">PostMessage</span><span class="o">(</span><span class="s">&quot;Hello World!&quot;</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
        <span class="k">case</span> <span class="nc">MessagePosted</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info2</span><span class="o">(</span><span class="s">&quot;message has been posted by &#39;{}&#39;: {}&quot;</span><span class="o">,</span> <span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
      <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Виходячи з такої поведінки, ми можемо створити Актора, який прийме сеанс чату, опублікує повідомлення, чекатиме його публікації, а потім припиниться. Останній крок вимагає здатності змінювати поведінку, нам потрібно перейти від нормальної поведінки, що працює, до стану, що закінчується. Ось чому ми тут не повертаємо <code>same</code>, як вище, але ще одне особливе значення, <code>stopped</code>.</p></div>
<div class="paragraph"><p>Оскільки <code>SessionEvent</code> є закоркованим трейтом, компілятор Scala попередить нас, якщо ми забудемо обробити один із підтипів; у цьому випадку він нагадував нам, що альтернативно <code>SessionGranted</code> ми також можемо отримати подію <code>SessionDenied</code>.</p></div>
<div class="paragraph"><p>Тепер, щоб спробувати речі, ми повинні запустити і чат, і габлер, і, звичайно, це робимо всередині системи акторів. Оскільки може бути лише один користувач-опікун, ми можемо або запустити кімнату чату з габлера (чого ми не хочемо - це ускладнює його логіку), або габлера з чат кімнати (що є безглуздим), або ми почнемо обидва з них в третьому акторові - наш єдиний розумний вибір:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">NotUsed</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">chatRoom</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">ChatRoom</span><span class="o">(),</span> <span class="s">&quot;chatroom&quot;</span><span class="o">)</span>
      <span class="k">val</span> <span class="n">gabblerRef</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">Gabbler</span><span class="o">(),</span> <span class="s">&quot;gabbler&quot;</span><span class="o">)</span>
      <span class="n">context</span><span class="o">.</span><span class="n">watch</span><span class="o">(</span><span class="n">gabblerRef</span><span class="o">)</span>
      <span class="n">chatRoom</span> <span class="o">!</span> <span class="nc">ChatRoom</span><span class="o">.</span><span class="nc">GetSession</span><span class="o">(</span><span class="s">&quot;ol’ Gabbler&quot;</span><span class="o">,</span> <span class="n">gabblerRef</span><span class="o">)</span>

      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveSignal</span> <span class="o">{</span>
        <span class="k">case</span> <span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="nc">Terminated</span><span class="o">(</span><span class="k">_</span><span class="o">))</span> <span class="k">=&gt;</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
      <span class="o">}</span>
    <span class="o">}</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">Main</span><span class="o">(),</span> <span class="s">&quot;ChatRoomDemo&quot;</span><span class="o">)</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>За доброю традицією ми називаємо головного актора <code>Main</code>, що безпосередньо відповідає методу <code>main</code> у традиційному додатку Java. Цей Актор буде виконувати свою роботу за власним бажанням, нам не потрібно надсилати повідомлення ззовні, тому ми заявляємо, що вони не використовуються. Актори отримують не тільки зовнішні повідомлення, вони також отримують сповіщення про певні системні події, так звані <code>Signals</code>. Для того, щоб отримати доступ до них, ми вирішимо реалізувати саме цей, використовуючи декоратор поведінки прийому. Надана функція <code>onSignal</code> буде викликана для сигналів (підкласів <code>Signal</code>) або функції <code>onMessage</code> для повідомлень користувача.</p></div>
<div class="paragraph"><p>Цей головний актор створений за допомогою <code>Behaviors.setup</code>, який є як фабрика поведінки. Створення екземпляра поведінки відкладається до запуску актора, на відміну від <code>Behaviors.receive</code>, який створює екземпляр поведінки безпосередньо перед тим, як актор запрацює. Функція фабрики передається в налаштуваннях як параметр <code>ActorContext</code>, який, наприклад, може використовуватися для нересту дочірніх акторів. Цей головний актор створює чат і габлер, і сеанс між ними ініціюється передається. Коли габлер закінчиться, ми отримаємо подію <code>Terminated</code>, викликавши <code>context.watch</code>. Це дозволяє нам вимкнути систему акторів: коли головний актор припиняється, більше нічого робити.</p></div>
<div class="paragraph"><p>Тому після створення системи акторів з поведінкою головного актора ми можемо дозволити основний метод повернутися. <code>ActorSystem</code> продовжуватиме працювати, а JVM живий до тих пір, поки основний актор не зупиниться.</p></div>
</div>
<div class="sect3">
<h4 id="____">Об'єктно-орієнтований стиль</h4>
<div class="paragraph"><p>Вищевказаний приклад використовував функціональний стиль програмування, коли ви передаєте функцію фабриці, яка потім конструює поведінку. Для акторів зі станом це означає передавати незмінний стан навколо як параметри, та переходити на нову поведінку, коли вам потрібно діяти у зміненому стані. Альтернативний спосіб виразити те саме - більш об'єктно-орієнтований стиль, де визначається конкретний клас поведінки актора, і змінний стан зберігається всередині нього як поля.</p></div>
<div class="paragraph"><p>Який стиль ви вирішите використовувати - це питання смаку, і обидва стилі можна змішувати залежно від того, який найкращий для конкретного актора. Розглядання вибору наведено в <a href="https://doc.akka.io/docs/akka/current/typed/style-guide.html#functional-versus-object-oriented-style">Посібнику зі стилів</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_abstractbehavior_api">AbstractBehavior API</h4>
<div class="paragraph"><p>Визначення поведінки актора на основі класу починається з розширення <code>akka.actor.typed.scaladsl.AbstractBehavior[T]</code>, де <code>T</code> - тип повідомлень, які буде приймати поведінка.</p></div>
<div class="paragraph"><p>Повторимо зразок чатової кімнати з більш складного прикладу, наведеного вище, але реалізованого за допомогою абстрактної поведінки. Протокол взаємодії з актором виглядає однаково:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">RoomCommand</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">GetSession</span><span class="o">(</span><span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
  <span class="n">replyTo</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">SessionEvent</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">RoomCommand</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">SessionEvent</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SessionGranted</span><span class="o">(</span><span class="n">handle</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">PostMessage</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">SessionEvent</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SessionDenied</span><span class="o">(</span><span class="n">reason</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SessionEvent</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">MessagePosted</span><span class="o">(</span><span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SessionEvent</span>

<span class="k">trait</span> <span class="nc">SessionCommand</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">PostMessage</span><span class="o">(</span><span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SessionCommand</span>
<span class="k">private</span> <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">NotifyClient</span><span class="o">(</span><span class="n">message</span><span class="k">:</span> <span class="kt">MessagePosted</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">SessionCommand</span>
</pre></div></div></div>
<div class="paragraph"><p>Спочатку клієнтські актори отримують доступ лише до <code>ActorRef[GetSession]</code>, який дозволяє їм зробити перший крок. Після того, як сеанс клієнта встановлено, він отримує повідомлення <code>SessionGranted</code>, що містить ручку для розблокування наступного кроку протоколу, розміщення повідомлень. Команду <code>PostMessage</code> потрібно буде надіслати на цю конкретну адресу, яка представляє сеанс, доданий до кімнати чату. Інший аспект сеансу полягає в тому, що клієнт виявив власну адресу через аргумент <code>replyTo</code>, щоб наступні події <code>MessagePosted</code> могли надсилатися на нього.</p></div>
<div class="paragraph"><p>Це ілюструє, як Актори можуть виражати більше, ніж просто еквівалент викликів методів на об'єктах Java. Задекларовані типи повідомлень та їх вміст описують повний протокол, який може включати декілька Акторів і може розвиватися протягом декількох кроків. Ось реалізація протоколу <code>AbstractBehavior</code> протоколу чату:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">ChatRoom</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">PublishSessionMessage</span><span class="o">(</span><span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">RoomCommand</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">RoomCommand</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">(</span><span class="n">context</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">ChatRoomBehavior</span><span class="o">(</span><span class="n">context</span><span class="o">))</span>

  <span class="k">class</span> <span class="nc">ChatRoomBehavior</span><span class="o">(</span><span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">RoomCommand</span><span class="o">])</span>
      <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">RoomCommand</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">private</span> <span class="k">var</span> <span class="n">sessions</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">ActorRef</span><span class="o">[</span><span class="kt">SessionCommand</span><span class="o">]]</span> <span class="k">=</span> <span class="nc">List</span><span class="o">.</span><span class="n">empty</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">message</span><span class="k">:</span> <span class="kt">RoomCommand</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">RoomCommand</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="n">message</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">GetSession</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">client</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="c1">// створення дитячого клієнту для взаємодії з клієнтом</span>
          <span class="k">val</span> <span class="n">ses</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span>
            <span class="nc">SessionBehavior</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="n">self</span><span class="o">,</span> <span class="n">screenName</span><span class="o">,</span> <span class="n">client</span><span class="o">),</span>
            <span class="n">name</span> <span class="k">=</span> <span class="nc">URLEncoder</span><span class="o">.</span><span class="n">encode</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="nc">StandardCharsets</span><span class="o">.</span><span class="nc">UTF_8</span><span class="o">.</span><span class="n">name</span><span class="o">))</span>
          <span class="n">client</span> <span class="o">!</span> <span class="nc">SessionGranted</span><span class="o">(</span><span class="n">ses</span><span class="o">)</span>
          <span class="n">sessions</span> <span class="k">=</span> <span class="n">ses</span> <span class="o">::</span> <span class="n">sessions</span>
          <span class="k">this</span>
        <span class="k">case</span> <span class="nc">PublishSessionMessage</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="k">val</span> <span class="n">notification</span> <span class="k">=</span> <span class="nc">NotifyClient</span><span class="o">(</span><span class="nc">MessagePosted</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">))</span>
          <span class="n">sessions</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="k">_</span> <span class="o">!</span> <span class="n">notification</span><span class="o">)</span>
          <span class="k">this</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="k">object</span> <span class="nc">SessionBehavior</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">apply</span><span class="o">(</span>
        <span class="n">room</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">PublishSessionMessage</span><span class="o">],</span>
        <span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
        <span class="n">client</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">SessionEvent</span><span class="o">])</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SessionCommand</span><span class="o">]</span> <span class="k">=</span>
      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span><span class="o">(</span><span class="n">ctx</span> <span class="k">=&gt;</span> <span class="k">new</span> <span class="nc">SessionBehavior</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">room</span><span class="o">,</span> <span class="n">screenName</span><span class="o">,</span> <span class="n">client</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">private</span> <span class="k">class</span> <span class="nc">SessionBehavior</span><span class="o">(</span>
      <span class="n">context</span><span class="k">:</span> <span class="kt">ActorContext</span><span class="o">[</span><span class="kt">SessionCommand</span><span class="o">],</span>
      <span class="n">room</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">PublishSessionMessage</span><span class="o">],</span>
      <span class="n">screenName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span>
      <span class="n">client</span><span class="k">:</span> <span class="kt">ActorRef</span><span class="o">[</span><span class="kt">SessionEvent</span><span class="o">])</span>
      <span class="k">extends</span> <span class="nc">AbstractBehavior</span><span class="o">[</span><span class="kt">SessionCommand</span><span class="o">](</span><span class="n">context</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">override</span> <span class="k">def</span> <span class="n">onMessage</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">SessionCommand</span><span class="o">)</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SessionCommand</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="n">msg</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">PostMessage</span><span class="o">(</span><span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="c1">// від клієнта, публіковати іншим через room</span>
          <span class="n">room</span> <span class="o">!</span> <span class="nc">PublishSessionMessage</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
        <span class="k">case</span> <span class="nc">NotifyClient</span><span class="o">(</span><span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="c1">// опубліковано в кімнаті</span>
          <span class="n">client</span> <span class="o">!</span> <span class="n">message</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Стан керується через поля в класі, як і у звичайному об'єктно-орієнтованому класі. Оскільки стан є змінним, ми ніколи не повертаємо іншу поведінку від логіки повідомлення, але можемо повернути сам екземпляр <code>AbstractBehavior</code> (<code>this</code>) як поведінку для використання для обробки наступного повідомлення, яке надходить. Ми також могли б повернути <code>Behavior.same</code> для досягнення того самого.</p></div>
<div class="paragraph"><p>Можливо також повернути новий інший <code>AbstractBehavior</code>, наприклад представити інший стан в машині з кінцевим станом (FSM) або використовувати одну з фабрик функціональної поведінки для об'єднання об'єкт-орієнтованого з функціональним стилем для різних частин життєвого циклу тієї ж поведінки актора.</p></div>
<div class="paragraph"><p>Коли приходить нова команда <code>GetSession</code>, ми додаємо цього клієнта до списку поточних сесій. Тоді нам також потрібно створити <code>ActorRef</code> сесії, який буде використовуватися для розміщення повідомлень. У цьому випадку ми хочемо створити дуже простий Actor, який перепаковує команду <code>PostMessage</code> в команду <code>PublishSessionMessage</code>, яка також включає екранне ім'я.</p></div>
<div class="paragraph"><p>Для реалізації логіки, коли ми створюємо дитину на сеанс, нам потрібен доступ до <code>ActorContext</code>. Це вводиться як параметр конструктора при створенні поведінки. Зверніть увагу, як ми поєднуємо <code>AbstractBehavior</code> з <code>Behaviors.setup</code>, щоб зробити це у фабричному методі <code>apply</code>.</p></div>
<div class="paragraph"><p>Поведінка, яку ми декларуємо тут, може обробляти обидва підтипи <code>RoomCommand</code>. <code>GetSession</code> уже роз'яснено, і команди <code>PublishSessionMessage</code>, що надходять від сессійних акторів, спровокують розповсюдження вміщеного повідомлення в чаті для всіх підключених клієнтів. Але ми не хочемо надавати можливість надсилати команди <code>PublishSessionMessage</code> довільним клієнтам, ми залишаємо право для внутрішніх сессійних акторів, які ми створюємо. Інакше клієнти можуть представляти зовсім інші екранні імена (уявіть протокол <code>GetSession</code>, щоб включити інформацію про автентифікацію для подальшого захисту). Тому <code>PublishSessionMessage</code> має приватну видимість і не може бути створений поза об’єктом <code>ChatRoom</code>.</p></div>
<div class="paragraph"><p>Якщо б нам не було бажання забезпечити відповідність між сеансом та ім'ям екрана, то ми могли б змінити протокол таким чином, щоб <code>PostMessage</code> видалявся, а всі клієнти просто отримували <code>ActorRef[PublishSessionMessage]</code> для надсилання. Тоді не потрібен актор сеансу, і ми могли б використовувати контекст. У цьому випадку перевірки типу діють, тому що <code>ActorRef[-T]</code> контрварівантний у своєму параметрі типу. Це означає, що ми можемо використовувати <code>ActorRef[RoomCommand]</code> там, де потрібен <code>ActorRef [PublishSessionMessage</code>] - це має сенс, тому що перший просто говорить більше мов, ніж останній. Протилежне було б проблематичним, тому передача <code>ActorRef[PublishSessionMessage]</code>, де потрібно <code>ActorRef[RoomCommand]</code>, призведе до помилки типу.</p></div>
</div>
<div class="sect3">
<h4 id="___4">Спробуйте самі</h4>
<div class="paragraph"><p>Для того, щоб побачити цю кімнату чату в дії, нам потрібно написати клієнтського Актора, який може її використовувати. Для цього актора без стану не має сенсу користуватися <code>AbstractBehavior</code>, тому давайте просто повторно використовувати габлер функціонального стилю з наведеного вище зразка:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">Gabbler</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">ChatRoom._</span>

  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">SessionEvent</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveMessage</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">SessionDenied</span><span class="o">(</span><span class="n">reason</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;cannot start chat room session: {}&quot;</span><span class="o">,</span> <span class="n">reason</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
        <span class="k">case</span> <span class="nc">SessionGranted</span><span class="o">(</span><span class="n">handle</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">handle</span> <span class="o">!</span> <span class="nc">PostMessage</span><span class="o">(</span><span class="s">&quot;Hello World!&quot;</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">same</span>
        <span class="k">case</span> <span class="nc">MessagePosted</span><span class="o">(</span><span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">context</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info2</span><span class="o">(</span><span class="s">&quot;message has been posted by &#39;{}&#39;: {}&quot;</span><span class="o">,</span> <span class="n">screenName</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
      <span class="o">}</span>
    <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Тепер, щоб спробувати речі, ми повинні запустити і чат, і габлер, і, звичайно, це робимо всередині системи акторів. Оскільки може бути лише один користувач-опікун, ми можемо або запустити кімнату чату з габлера (чого ми не хочемо - це ускладнює його логіку), або габлера з чату (що є безглуздим), або ми почнемо обидва з третього актора - наш єдиний розумний вибір:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">Main</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">()</span><span class="k">:</span> <span class="kt">Behavior</span><span class="o">[</span><span class="kt">NotUsed</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Behaviors</span><span class="o">.</span><span class="n">setup</span> <span class="o">{</span> <span class="n">context</span> <span class="k">=&gt;</span>
      <span class="k">val</span> <span class="n">chatRoom</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">ChatRoom</span><span class="o">(),</span> <span class="s">&quot;chatroom&quot;</span><span class="o">)</span>
      <span class="k">val</span> <span class="n">gabblerRef</span> <span class="k">=</span> <span class="n">context</span><span class="o">.</span><span class="n">spawn</span><span class="o">(</span><span class="nc">Gabbler</span><span class="o">(),</span> <span class="s">&quot;gabbler&quot;</span><span class="o">)</span>
      <span class="n">context</span><span class="o">.</span><span class="n">watch</span><span class="o">(</span><span class="n">gabblerRef</span><span class="o">)</span>
      <span class="n">chatRoom</span> <span class="o">!</span> <span class="nc">ChatRoom</span><span class="o">.</span><span class="nc">GetSession</span><span class="o">(</span><span class="s">&quot;ol’ Gabbler&quot;</span><span class="o">,</span> <span class="n">gabblerRef</span><span class="o">)</span>

      <span class="nc">Behaviors</span><span class="o">.</span><span class="n">receiveSignal</span> <span class="o">{</span>
        <span class="k">case</span> <span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="nc">Terminated</span><span class="o">(</span><span class="k">_</span><span class="o">))</span> <span class="k">=&gt;</span>
          <span class="nc">Behaviors</span><span class="o">.</span><span class="n">stopped</span>
      <span class="o">}</span>
    <span class="o">}</span>

  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">Main</span><span class="o">(),</span> <span class="s">&quot;ChatRoomDemo&quot;</span><span class="o">)</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>За доброю традицією ми називаємо головного актора <code>Main</code>, він безпосередньо відповідає методу <code>main</code> у традиційному додатку Java. Цей Актор буде виконувати свою роботу за власним бажанням, нам не потрібно надсилати повідомлення ззовні, тому ми заявляємо, що вони не використовуються. Актори отримують не тільки зовнішні повідомлення, вони також отримують сповіщення про певні системні події, так звані <code>Signals</code>. Для того, щоб отримати доступ до них, ми вирішимо реалізувати саме на цьому, використовуючи декоратор поведінки <code>receive</code>. Надана функція onSignal буде викликана для сигналів (підкласи <code>receive</code>) або функції <code>onMessage</code> для повідомлень користувача.</p></div>
<div class="paragraph"><p>Цей головний актор створений за допомогою <code>Behaviors.setup</code>, який є як фабрика поведінки. Створення екземпляра поведінки відкладається до запуску актора, на відміну від <code>Behaviors.receive</code>, який створює екземпляр поведінки безпосередньо перед тим, як актор запрацює. Фабрична функція в налаштуваннях передається як параметр <code>ActorContext</code>, який, наприклад, може використовуватися для створення дочірніх акторів. Цей головний актор створює чат і габлер, і сеанс між ними ініціюється. Коли габлер закінчиться, ми отримаємо подію <code>Terminated</code>, викликавши <code>context.watch</code>. Це дозволяє нам вимкнути систему Актора: коли головний актор припиняється, більше нічого робити.</p></div>
<div class="paragraph"><p>Тому після створення системи Актора з поведінкою головного актора ми можемо дозволити основний метод повернутися, ActorSystem продовжуватиме працювати, а JVM живий до тих пір, поки основний актор не зупиниться.</p></div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2020-06-06 20:50:33 EEST
</div>
</div>
</body>
</html>
