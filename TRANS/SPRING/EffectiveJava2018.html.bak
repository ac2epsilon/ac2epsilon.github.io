<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Effective Java 3rd 2018 - Переклад українською</title>
  </head>
  <body>
    <p> </p>
    <address>Переклад українською - <a href="mailto:ac2epsilon@gmail.com">Арсеній
        Чеботарьов</a> - Київ 2018</address>
    <h1 class="h2f" style=" font-size: 26px; margin-top: 30px; margin-bottom: 30px; font-family: sans-serif; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Joshua
      Bloch - Effective Java (3rd) - 2018</h1>
    <h2 class="h2f" style="font-size: 26px; margin-top: 30px; margin-bottom: 30px; font-family: sans-serif; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Передмова</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      колега скаже тобі “Моя половина сьогодні ввечері вдома якусь незвичну їжу
      готуватиме. Ти міг приєднатися?” три речі можуть прийти на думку: третя -
      що ви були запрошені на вечерю; друга - що англійська не є рідною мовою
      вашого колеги; та перша це чимале здивування.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      ви колись вивчали другу мову самотуж, та потім намагались використовувати
      її за межами класної кімнати, ви знаєте, що є три речі, які маєте
      засвоїти: як структурована мова (граматика), як називаються речі
      (словник), та особливі та ефективні шляхи розповідати про щоденні речі
      (ідіоматика). Часто в класній кімнаті вивчають тільки першу частину, та ви
      побачите, що природні носії мови весь час стримують посмішки, по мірі
      того, як ви намагаєтесь дати себе зрозуміти.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      загалом те саме з мовами програмування. Вам треба розуміти базову мову: чи
      вона алгоритмічна, функціональна, об'єктно-орієнтовна? Вам треба знати
      словник: як виглядають структури даних, операндів, та можливості, які
      провадять стандартні бібліотеки? Та вам треба бути знайомим зі звичними та
      ефектіврними шлахами структурувати код. Книги щодо програмних мов часто
      покривають тільки перші дві теми, або дискутують використання дуже
      вибірково. Може це через те, що перші дещо простіші для описання.
      Граматика та словник є властивостями самої мови, але використання є
      характеристикою спільноти щодо використання.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Мова
      програмування Java, наприклад, є об'єктно-орієнтованою з подиноким
      наслідуванням, та підтримує імперативний (твердження-орієнтовний) стиль
      кодування в кожному методі. Бібліотеки адресують підтримку графіки, мереж,
      розподіленого виконання та безпеку. Але як найкраще використовувати цю
      мову на практиці?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існує
      інше міркування. Програми, на відміну від речень мовлення, та на відміну
      від більшості книг та журналів, з часом напевне будуть зазнавати змін.
      Звичайно не достатньо спродукувати код, що ефективно оперує та легко може
      бути зрозумілий іншими; ви також маєте гарно оргнізувати код, щоб його
      було легко модифікувати. Можуть існувати якісь десять способів написати
      код для деякого завдання <span class="Apple-converted-space"></span><em>T</em>.
      З ціх десяти методів сім будуть незручні, неефективні, або приголомшиві. З
      інших трох, який є найбіш вірогідим до коду, який буде вирішувати завдання
      <span class="Apple-converted-space"></span><em>T'</em><span class="Apple-converted-space">
        в наступному релізі через рік</span>?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існують
      числені книги, з яких ви можете навчитись граматики мови програмування
      Java, включаючи <span class="Apple-converted-space"></span><em>The Java</em><sup>™</sup><span
        class="Apple-converted-space">&nbsp;</span><em>Programming Language</em><span
        class="Apple-converted-space"> від</span> Arnold, Gosling, and Holmes,
      або<span class="Apple-converted-space"> </span><em>The Java</em><sup>™</sup><span
        class="Apple-converted-space">&nbsp;</span><em>Language Specification</em><span
        class="Apple-converted-space"> від</span> Gosling, Joy, щиро ваші, та
      Bracha. Так само є купа книг по бібліотекам та API, асоційованих з мовою
      програмування Java.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга адресує вашу третю потребу: звичне та ефективне використання. Joshua
      Bloch витратив роки розширюючи, реалізуючи,&nbsp; та використовуючи мову
      програмування Java в Sun Microsystems; він також читав багато кода інших
      людей, включаючий мій. Тут ми надаємо гарні поради, систематично
      організовані, по тому, як структурувати ваш код, так щоб він гарно
      працював, так щоб інші люди могли зрозуіти його, так щоб майбутні
      модифікацї та покращення малоймовірно викликали головний біль — можливо,
      навіть, так щоб ваші програми були приємні, елегантні та витончені.</p>
    <p class="right" style="margin-top: 15px; margin-bottom: 15px; text-align: right; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Guy
      L. Steele Jr.<br>
      <em>Burlington, Massachusetts<br>
        April 2001</em></p>
    <p> </p>
    <h2 class="h2f" id="preface" style="font-size: 26px; margin-top: 30px; margin-bottom: 30px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Передмова</strong></h2>
    <h3 class="h3a" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 20px; page-break-after: avoid; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Передмова
        до третього видання</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        class="Apple-converted-space"></span>В 1997-му році, коли Java була
      новою, James Gosling (батько Java), описував її як “мову синіх комірців”
      що була “досить простою” [<a href="ref.xhtml#rGosling97" style="text-decoration: none;">Gosling97</a>].
      Приблизно в той же час, Bjarne Stroustrup (батько C++) описував C++ як
      “багато-парадигмову мову”, що “навмисне відрізняється від мов, призначених
      підтримувати один спосіб написання програм” [<a href="ref.xhtml#rStroustrup95"
        style="text-decoration: none;">Stroustrup95</a>]. Stroustrup попереджав:</p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Більшість
      з відносної простоти Java — як і більшості нових мов — частково є
      іллюзією, і частково є функцією їх неповноти. Як спливатиме час, Java буде
      значно зростати в розмірі та складності. Вона зрости вдвічі або втричі за
      розміром та наростить залежні від реалізації розширення або бібліотеки. [<a
        href="ref.xhtml#rStroustrup" style="text-decoration: none;">Stroustrup</a>]</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зараз,
      двадцять років пізніше, буде часним сказати, що обоє, Gosling та
      Stroustrup, були праві. Java тепер велика та складна, з багатьма
      абстракціями для багатьох речей, від паралельного виконання, до ітерації,
      до представлення дати та часу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Я
      все ще люблю Java, хоча мій запал трохи охолов, по мірі зростання
      платформи. Маючи це зростання розміру та складності, потреба в нагальних
      практиках застосування стає все більш критичною. Це третя редакція <span
        class="Apple-converted-space"></span><em>Effective Java</em>, та я
      доклав найкращих зусиль до цього видання. Я маю надію що ця редакція
      продовжує задовільняти вашим потребам, залишаючись вірною духу перших
      двох.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Мале
      прекрасне, але просте не є простим.</p>
    <p class="right" style="margin-top: 15px; margin-bottom: 15px; text-align: right; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>San
        Jose, California<br>
        November 2017</em></p>
    <p class="noindentt" style="margin-top: 15px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">P.S.
Я
      буду нечесним, якщо не згадаю кращі практики (<em>софтверної</em>)
      індустрії, якій я присвячував більшість свого часу в минулому. З початку
      народження нашої справи в 1950-х, ми вільно реалізовували API одне одного.
      Ця практика була критичною для стрімкого успіху комп'ютерної технології. Я
      виявляв активність для збереження цієї волі (to preserve this freedom) [<a
        href="ref.xhtml#rCompSci17" style="text-decoration: none;">CompSci17</a>],
      та заохочую вас приєднатись до мене. Є критичним для здоров'я нашої
      професії, якщо ми збережемо право переписувати API один одного.</p>
    <h3 class="h3a" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 20px; page-break-after: avoid; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Передмова
        до другого видання</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Багато
      чого відбулося з пратформою Java з тих пір, коли я писав першу редакцію
      цієї книги в 2001-му році, та прийщов гарний час для другої редакції.
      Найбільш важливий набір змін було додавання дженериків, типів переліку,
      анотацій, автобоксінгу, та циклів for-each в Java 5. Близько до цого було
      додання нової конкурентної бібліотеки,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.concurrent</code>,
      що також вийшла в Java 5. Разом з Gilad Bracha, я мав гарну нагоду
      очолювати команди, що розробляли ці можливості мови. Також я мав щастя
      прислужитись команді, що розробляла бібліотеку конкурентності, та якою
      керував Doug Lea.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Інша
      велика зміна в платформі є широке поширення сучасних редакторів коду,
      Integrated Development Environments (IDEs), таких як Eclipse, IntelliJ
      IDEA, та NetBeans, та інструментів статичного аналізу, таких як FindBugs.
      Хоча я не був задіяний в ціх спробах, я безпосередньо мав вигоди від них,
      та спостерігав, як вони впливали на досвід розробки Java.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      2004 я перейшов з Sun до Google, але я продовжував мій розвиток в розробці
      на Java протягом останніх чотирьох років, докладаючи код до API
      конкуренції та колекції через гарні офіси Google та Java Community
      Process. Я мав насолоду використовувати Java платформу для розробки
      бібліотек для використання в Google. Тепер я знаю, що значить відчувати
      себе користувачем.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Як
      і в випадку року 2001, коли я писав першу редакцію, моя первинна ціль була
      поширити мій досвід серед вас, так, щоб ви могли імітувати мої вдачі,
      уникаючи моїх помилок. Новий матеріал продовжує (<em>практику</em>)
      вільного використання прикладів з реального світу від бібліотек платформи
      Java.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Перша
      редакція була успішною далеко краще моїх сподівань, і я доклав кращих
      зусиль, щоб зберігти дух (<em>першого видання</em>), при цьому втручаючи
      новий матеріал, що мав підтримувати книгу на сучасному рівні. Було
      безсумнівно, що книга буде розростатись, і вона розрослась з сорока-семи
      до семидесяти-восьми пунктів. Я не тільки додав двадцять-три пункти, але я
      також щільно передивився оригінальний матеріал, та відправив декілька
      пунктів у відставку, кращі дні яких спливли. В Додатку ви можете побачити,
      як матеріал цього видання пов'язаний з матеріалом першої редакції.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      передмові до першого видання я писав, що мова програмування Java та її
      бібліотеки значно додали в якості та продуктивності, та з ними стало
      приємніше працювати. Зміни в релізах 5 та 6 отримали гарну річ, та зробили
      її краще. Платформа стала значно більшою, ніж вона була в 2001-му році, та
      стала складнішою, але якщо ви вивчили шаблони та ідіоми для використання
      нових можливостей, ви зробите ваші програми кращими, та ваше життя
      простішим. Я маю надію, що це редакція захопила мій постійний інтузіазм
      щодо платформи, та допомагає зробити використання цієї платформи та її
      нових можливостей більш ефективним та приємним.</p>
    <p class="right" style="margin-top: 15px; margin-bottom: 15px; text-align: right; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>San
        Jose, California<br>
        April 2008</em></p>
    <h3 class="h3a" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 20px; page-break-after: avoid; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Передмова
        до першої редакції</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      1996 я підвищив ставки, та подався на Захід для роботи в компанії
      JavaSoft, як вона тоді була відома, оскільки мені було ясно, що це місце
      де відбуваються справи. Протягом наступних п'яти років я служив справі як
      архитектор бібліотек Java. Я розробляв, реалізував та підтримував багато
      бібліотек, та консультував багато кого. Робота з ціма бібліотеками по мірі
      зрослішання&nbsp; Java платформи була подією, що відбувається раз в житті.
      Не буде перебільшенням сказати, що я мав привелегію робити з деякими з
      найвеличніших софтверних інженерів нашого покоління. В процесі цього я
      навчився багато чого щодо мови програмування Java — що робить, що ні, та
      як використовувати та її бібліотеки для кращого ефекту.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга є моєю спробою поділити мій досвід з вами, так що ви можете
      імітувати мій успіх, та уникнути моїх помилок. Я позичив формат з Scott
      Meyers’s<span class="Apple-converted-space">&nbsp;</span><em>Effective C++</em>,
      що складається з п'ятидесяти елементів, кожний складає особливе правило
      для покращення ваших програм та їх дизайну. Я винайшов цей формат
      остаточно ефективним, та маю надію ви також.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      багатьох випадках я обирав вільно ілюструвати теми прикладами з реального
      світу з бібліотек платформи Java. Коли я описую дещо, що можна зробити
      краще, я намагаюсь надати код, що я писав сам, але часом я обираю код,
      написаний моїм колегою. Я щиро перепрошую, якщо, попри мої кращі
      намагання, я образив когось. Негативні приклади наведені не для розпалення
      образ, але в дусі кооперації, так що всі ми можемо отримати вигоду від
      досвіду того, що робилось до цього.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      ця книжка не націлена винятково на розробників повторно використовуваних
      компонентів, вона неодмінно розфарбована моїм досвідом в написанні ціх
      компонент на протязі останніх двох десятисіть. Я природно думаю в термінах
      експортованих&nbsp; API (Application Programming Interfaces), та я раджу
      робити так само. Навіть якщо ви не розробляєте повторно використовувані
      компоненти, мислення в ціх термінах призводить до покращення якості
      софтверу, що ви пишете. Більше того, не є загальним писати компоненти без
      того, щоб знати їх: ви пишете дещо корисне, поділяючи це з товаришом по
      цеху, та з часом ви маєте з пів дюжини користувачів. На цей час ви не
      маєте досить гнучкості змінити API за власним бажанням, та досить вдячні
      собі за весь той труд, що ви поклали в розробку API, коли перший час
      писали ваш софт.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Мій
      фокус на розробці API може виглядати трохи неприродним в світі новітніх
      методологій облегченого програмного забезпечення, як <span class="Apple-converted-space"></span><em>Екстремальне
        програмування</em>. Ці методології наполягають на написанні найпростіших
      програм, що взагалі здатні працювати. Якщо ви використовуєте одну з ціх
      методологій, ви винайдете, що фокусування на розробці API гарно
      прислужиться вам в процесі <em>рефакторінгу</em>. Фундаментальні цілі
      рефакторингу є покращення структури системи, та відсутність дублікації
      коду. Ці цілі неможливі досягти за відсутності гарно розробленого API для
      компонентів системи.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Немає
      ідеальної мови, але деякі чудові. Я знаходжу мову програмування Java та її
      бібліотеки надзвичайно сприятливі для якості та продуктивності, та також
      радості робити з нею. Я маю надію, що ця книга захопить мій інтузіазм, та
      допомагає вашому використанні мови більш ефективно та з насолодою.</p>
    <p class="right" style="margin-top: 15px; margin-bottom: 15px; text-align: right; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>Cupertino,
        California<br>
        April 2001</em></p>
    <p> </p>
    <h2 class="h2" id="ch1" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Глава
      1. Вступ</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        class="Apple-converted-space"></span>Ця книга розроблена допомогти вам
      зробити використання мови програмування Java ефективним, так само, як її
      фундаментальні бібліотеки:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.lang</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util</code>, та <code
        style="font-family: 'Courier New', monospace;">java.io</code>, та
      суб-пакунки, як<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">java.util.concurrent</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">java.util.function</code>.
      Інші бібліотеки дискутуються час від часу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга складається з дев'яноста пунктів, кожний з яких доводить одн
      правило. Правила охоплюють практичні ідеї, що визнані кращими з найбільш
      досвідчених програмістів. Правила довільно поділені на одинадцять глав,
      кожна покриває один з широких аспектів розробки програмного забезпечення.
      Книга на призначена для читання від корки до корки: кожний пункт стоїть
      окремо, більш або менш. Елементи щільно посилаються один на одне, так що
      ви можете просто прокласти свій шлях по цій книзі.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Багато
      з нових можливостей були додані до платформи з часу останньої редакції
      друку цієї книги. Більшість&nbsp; з тем цієї книги використовують ці
      можливості в деякий спосіб. Ця таблиця показує, де вам шукати первинні
      описи ціх можливостей:</p>
    <table class="tablewidth" style="border-collapse: collapse; width: 1179px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
      <tbody>
        <tr>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Можливість</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Пункти</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Реліз</strong></p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Лямбди</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch7.xhtml#lev42" style="text-decoration: none;">Пункти 42</a>–<a
                href="ch7.xhtml#lev44" style="text-decoration: none;">44</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Потоки</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch7.xhtml#lev45" style="text-decoration: none;">Пункти 45</a>–<a
                href="ch7.xhtml#lev48" style="text-decoration: none;">48</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Опції</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch8.xhtml#lev55" style="text-decoration: none;">Пункт 55</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Методи
              по замовчанню інтерфейсів</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch4.xhtml#lev21" style="text-decoration: none;">Пункт 21</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">try</code>-with-resources</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch2.xhtml#lev9" style="text-decoration: none;">Пункт 9</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              7</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">@SafeVarargs</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch5.xhtml#lev32" style="text-decoration: none;">Пункт 32</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              7</p>
          </td>
        </tr>
        <tr>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Модулі</p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch4.xhtml#lev15" style="text-decoration: none;">Пункт 15</a></p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              9</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="indentt" style="margin-top: 13.333334px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_2"></span>Більшість пунктів ілюстровані
      прикладами програм. Ключова властивість цієї книги в тому, що вона містить
      приклади коду, що ілюструють багато з шаблонів розробки та ідіом. Коли це
      доцільно, вони перекресно посилаються на стандартні роботи в цій галузі [<a
        href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Багато
      пунктів містять один або більше прикладів програм, що ілюструють деякі
      практики, яких треба уникати, Такі прклади, іноді відомі як <em>антишаблони,
        </em>ясно відмічені відповідними коментарями, як <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>// Не робіть так!</strong></code>.
      В цьому випадку пунт пояснює, чому приклад поганий, та підказує
      альтернативний підхід.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга не розрахована на початківців: вважається, що ви добре знайомі з
      Java. Якщо це не так, погляньте на один або більше вступних текстів, як
      Sestoft<span class="Apple-converted-space"> </span><em>Java Precisely</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rSestoft16"
        style="text-decoration: none;">Sestoft16</a>]. Тоді як <span class="Apple-converted-space"></span><em>Effective
        Java</em><span class="Apple-converted-space"> </span>розроблена бути
      доступною для будь-кого з робочим досвідом роботи з мовою, вона дає їжу
      для роздумів навіть для досвідчених програмістів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Більшість
      з правил в цій книзі походять від декількох фундаментальних принципів.
      Ясність та простота є наріжним каменем. Користувач компонента ніколи не
      має дивуватись його поведінкою. Компоненти можуть бути такі малі, як це
      можливо, але не менше. (Як використовується в цій книзі, термін <em>компонент</em><span
        class="Apple-converted-space"> посилається на любий повторно
        використовуваний програмний компонент, від окремого методу до складного
        фреймворку, що скаладається з декількох пакунків</span>). Код має бути
      викорстаний повторно, ніж скопійований. Залежність між компонентами має
      бути зведеною до мінімуму. Помилки треба виявляти так рано, як можливо,
      після того, як вони відбулись, в ідеалі під час компіляції.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      правила в цій книзі не застосовуються в ста відсотках випадків, вони
      характерізують кращі практикі програмування в великій більшості випадків.
      Вам не треба рабськи слідувати цім правилам, але порушувати їх треба
      тільки часом, та з гарних причин. Навчання мистецтву програмування, як і
      більшості інших дисциплін, полягає в вивченні правил, та потім як
      порушувати їх.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Для
      більшості випадків ця книга не стосується продуктивності. Вона про
      написання програм, що ясні, коректні, корисні, надійні, гнучкі та гарно
      підтримуються. Якщо ви можете досягти цього, зазвичай відносно просто
      також досягти гарної продуктивності (<a href="ch9.xhtml#lev67" style="text-decoration: none;">Пункт
        67</a>). Деякі пункти торкаються питань продуктивності, та декілька
      наводять показники продуктивності. Ці числа, що розпочинаються фразою “На
      моїй машині” треба сприймати, щонайбільше, як приблизні.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Щоб
      дещо уточнити, моя машина є саморобна 3.5GHz quad-core Intel Core
      i7-4770K, з 16Гб DDR3-1866 CL9 RAM, що виконує реліз Azul Zulu 9.0.0.15
      OpenJDK, на Microsoft Windows 7 Professional SP1 (64-bit).</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_3"></span>Коли іде мова про можливості
      мови програмування Java та її бібліотеки, іноді потрібно посилатись на
      певні релізи. Для зручності ця книга використовує псевдоніми замість
      офіційних назв. Ця таблиця показує відображення між іменами релізів та
      псевдонімами:</p>
    <table class="tablewidth" style="border-collapse: collapse; width: 1179px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
      <tbody>
        <tr>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Офіційна
                назва релізу</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Нікнейм</strong></p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">JDK
              1.0.<em>x</em></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              1.0</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">JDK
              1.1.<em>x</em></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              1.1</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2 Platform, Standard Edition, v1.2</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2 Platform, Standard Edition, v1.3</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              3</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2 Platform, Standard Edition, v1.4</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              4</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2 Platform, Standard Edition, v5.0</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              5</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              Platform, Standard Edition 6</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              6</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              Platform, Standard Edition 7</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              7</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              Platform, Standard Edition 8</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              Platform, Standard Edition 9</p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              9</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="indentt" style="margin-top: 13.333334px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Приклади
      є досить повними, але більше націлені на просте читання, ніж на повноту.
      Вони вільно використовують класи з пакунків <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">java.util</code><span class="Apple-converted-space">
        та </span><code style="font-family: 'Courier New', monospace;">java.io</code>.
      Щоб скомпілювати приклади вам треба додати одну або декілька декларацій
      імпорту, або ще якість загальні речі. Сайт цієї книги, <code style="font-family: 'Courier New', monospace;"><a
          href="http://joshbloch.com/effectivejava" style="text-decoration: none;">http://joshbloch.com/effectivejava</a></code>,
      містить розширену версію кожного криклада, що може бути скомпільований та
      виконаний.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      більшості місць яу книга використовує технічні терміни, як вони визачені в
      <span class="Apple-converted-space"></span><em>The Java Language
        Specification, Java SE 8 Edition</em><span class="Apple-converted-space">&nbsp;</span>[<a
        href="ref.xhtml#rJLS" style="text-decoration: none;">JLS</a>]. Деякі
      терміни мають власне значення. Мова підтримує чотири різновиди типів:<span
        class="Apple-converted-space"> </span><em>інтерфейси</em><span class="Apple-converted-space">
      </span>(включаючи<span class="Apple-converted-space"> </span><em>анотації</em>),<span
        class="Apple-converted-space"> </span><em>класи</em><span class="Apple-converted-space">
      </span>(включаючи<span class="Apple-converted-space"> </span><em>enum</em>),<span
        class="Apple-converted-space"> </span><em>масиви</em>, та<em> примітиви</em>.
      Перші три відомі як <em>типи посилання</em>. Примірники класів та масиви
      є об'єктами; примітивні типи ні. Члени класів складаються з <em>полів</em>,
      <em>методів, членів-класів </em>та <em>членів-інтерфейсів</em><em>.</em><span
        class="Apple-converted-space"> <em>Сигнатура метода </em>складається з
        імені та типів формальних параметрів</span>; сигнатура <em>не включає
        тип повернення метода</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга використовує деякі терміни відмінно від <span class="Apple-converted-space"></span><em>The
        Java Language Specification</em>. На відміну від <em>Java Language
        Specification</em>, ця книга використовує <span class="Apple-converted-space"></span><em>inheritance</em>as
      (наслідування) як синанім для<span class="Apple-converted-space"> </span><em>subclassing
        </em>(утворення субкласів). Замість використовувати термін наслідування
      для інтерфейсів, ця книга просто стверджує, що клас <em>реалізує </em>інтерфейс,
      або що один інтерфейс <em>розширює </em>інший. Щоб описати рівень
      доступу, що застосовується коли нічого не вказано, ця книга використовує
      тридиційне <em>пакунок-приватне, </em>замість технічно коректного <em>пакетного
        доступу</em><span class="Apple-converted-space"> </span>[JLS, 6.6.1].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга використовує декілька технічніх термінів, що н евизначені в <span class="Apple-converted-space"></span><em>The
        Java Language Specification</em>. Термін<span class="Apple-converted-space"></span><em>
        експортовані API</em>, або просто<span class="Apple-converted-space"> </span><em>API</em>,
      посилаючись на класи, інтерфейси, конструктори, члени, та серіалізовані
      форми, через які програміст отримує доступ до класів, інтерфейсів, або
      пакунку. (Термін <em>API</em>, що є скороченням до <span class="Apple-converted-space"></span><em>application
        programming interface</em>, використовується переважно до терміну <em>інтерфейс,
        </em>щоб уникнути напорозуміння з мовним конструктивом з такою ж
      назвою). Програміст, який пише програму, що використовує це API, виступає
      як <em>користувач </em>цього API. Клас, чия реалізація використовує API,
      <em>клієнтом </em>цього API.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Класи,
      інтерфейси, конструктори, члени, та серіалізовані форми загалом відомі як
      <em>елементи </em><span class="Apple-converted-space"></span><em>API</em>.
      Експортований API складається з елементів API, доступних за межами
      пакунка, в якому визначений цей API. Це елементи API, що може
      використовувати кожен клієнт, і які автор цього API обіцяє підтримувати.
      Не випадково, це також елеенти, для яких утіліта Javadoc генерує
      документацію в перебігу подій за замовчанням. Просто кажучи, експортований
      API пакунку скаладається з публічних та захищених членів та конструкторів
      кожного публічного класу або інтерфейсу в пакунку.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      Java 9 до платформи була додана<span class="Apple-converted-space"> </span><em>система
        модулів</em>. Якщо бібліотека використовує систему модулів, її
      експортований API буде об'єднаням експортованих API всіх пакунків,
      експортованих декларацією модуля бібліотеки.</p>
    <p> </p>
    <p> </p>
    <p> </p>
    <p> </p>
    <h2 class="h2" id="ch2" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Глава
      2. Створення та руйнування об'єктів</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      глава займається створенням та руйнуванням об'єктів: коли та як їх
      створювати, коли та як уникати їх створення, як переконатись, що вони
      своєчасно зруйновані, та як керувати діями з очищення, що мають передувати
      їх знищенню.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Елемент
        1: Розгляньте статичні методи-фабрики замість конструкторів</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Традиційний
      шлях для класу дозволити клієнту отримати примірник - це запровадити
      публічний конструктор. Існує також інший прийом, що повинен стати частиною
      інструментарію кожного програміста. Клас може провадити публічний <span class="Apple-converted-space"></span><em>статичний
        метод-фабрику</em>, що є просто статичним методом, що повертає примірник
      класу. Ось простий приклад від <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Boolean</code><span class="Apple-converted-space">&nbsp;</span>(<span
        class="Apple-converted-space"></span><em>боксованого примітивного класу
      </em><span class="Apple-converted-space"></span>для<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">boolean</code>).
      Цей метод транслює примітивне значення <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">boolean</code><span class="Apple-converted-space">
      </span>на об'єктне посилання на об'єкт <code style="font-family: 'Courier New', monospace;">Boolean</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static Boolean valueOf(boolean b) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return b ? Boolean.TRUE : Boolean.FALSE;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зауважте,
      що метод статичної фабрики не та саме, що і Шаблон Розробки<span class="Apple-converted-space">
      </span><em>Factory Method</em><span class="Apple-converted-space"> </span>[<a
        href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Метод статичної фабрики, описаний в цьому елементі, не має прямого
      еквіваленту в <span class="Apple-converted-space"></span><em>Design
        Patterns</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Клас
      може провадити своїм клієнтам етоди статичної фабрики, замість, або но
      додаток до, публічних конструкторів. Провадженя статичного метода-фабрики,
      замість публічного конструктора, має також принади та недоліки.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Одна
        перевага статичних методів-фабрик в тому, що вони мають імена.</strong><span
        class="Apple-converted-space"> Якщо параметри конструктора не роблять
        цього, і самі по собі не описують об'єкт, що буде повертатись, статична
        фабрика з гарно обраною назвою простіше використовувати, та отриманий
        код клієнта простіше читати</span>. Наприклад, конструктор <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">BigInteger(int, int,
        Random)</code>, що повертає <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">,
        що можливо є простим, може бути краще виражений як метод статичної
        фабрики на ім'я</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">BigInteger.probablePrime</code>.
      (Цей метод був доданий в Java 4.)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Клас
      може мати єдиний конструктор з певною сигнатурою. Програмісти раніше
      шукали обхідні шляхи коло цього обмеження, провадячи два конструктора, циї
      списки параметрів відрізняються тільки в порядку їх типів параметрів.
      Насправді це погана ідея. Користувач такого API ніколи не буде в змозі
      запам'ятати, який конструктор є який, та скінчить тим, що буде помилково
      викликати не той. Люди, які читають код, що використовує такі
      конструктори, не будуть знати що робить код, без посилання на документацію
      класу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Оскльки
      всі воні мають імена, статичні методи фабрики не поділяють обмеження,
      описані в попередньому параграфі. В випадках, коли здається, що класи
      потребують декількох конструкторів з тою самою сигнатурою, замініть
      конструктори на статичні методи фабрик, та уважно оберіть імена, щоб
      наголосити на їх відмінностями.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Друга
        перевага статичних методів фабрик в тому, що, на відміну від
        конструкторів, вони не мають створювати новий примірник кожного разу,
        коли їх викликають.</strong><span class="Apple-converted-space"> Це
        дозволяє незмінні класи </span>(<a href="ch4.xhtml#lev17" style="text-decoration: none;">Елемент
        17</a>), та використання наперед створених примірників, або кешування
      примірників по мірі створення, та повторно розподіляти їх, для уникання
      небажаної дублікації об'єктів. Метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Boolean.valueOf(boolean)</code><span
        class="Apple-converted-space"> ілюструє цей прийом</span>: він<span class="Apple-converted-space">
      </span><em>ніколи не створює</em> об'єкти. Цей прийом подібний до
      шаблону&nbsp; the<span class="Apple-converted-space">&nbsp;</span><em>Flyweight</em>
      [<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Він може покращити продуктивність, якщо часто запитуються еквівалентні
      об'єкти, особливо якщо їх створення коштовне.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Здатність
      статичних методів фабрик повертати той саммий об'єкт від повторних
      викликів дозволяє класам підтримувати прямий контроль щодо того, які
      примірники існують в кожний момент часу. Класи, що роблятьт це, називають
      <span class="Apple-converted-space"></span><em>онтрольованими-примірниками.</em><span
        class="Apple-converted-space"> Існує декілька причин писати такі класи.
        Контоль за примірниками дозволяє класу гарантувати, що він&nbsp; є
        синглтоном </span>(<a href="ch2.xhtml#lev3" style="text-decoration: none;">Елемнт
        3</a>) або його примірників взагалі немає (<a href="ch2.xhtml#lev4" style="text-decoration: none;">Елемент
        4</a>). Також це дозволяє класи з незмінним значенням (<a href="ch4.xhtml#lev17"
        style="text-decoration: none;">Елемент 17</a>), що дає гарантію, що
      немає двох еквівалентних примірників:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">a.equals(b)</code><span class="Apple-converted-space">
        тоді і тільки тоді, коли</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">a == b</code>. Це основа
      шаблону <em>Легковажності</em><span class="Apple-converted-space"> (</span><em>Flyweight</em><span
        class="Apple-converted-space">)</span> [<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Типи перелічень (<a href="ch6.xhtml#lev34" style="text-decoration: none;">Елемент
        34</a>) надають цю гарантію.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Третя
        перевага статичних методів фабрик в тому, що, на відміну від
        конструкторів, вони можуть повертати об'єт любого субтипу їх типу
        повернення.</strong><span class="Apple-converted-space"> Це дає вам
        велику гнучкість в виборі класу повернутого об'єкту</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Одне
      з застосувань цієї гнучості в тому, що API може повертати об'єкти без
      того, щоб робити їх класи публічними. Приховуючи реалізацію класів в цей
      спосіб призводить до дуже компактного API. Цей прийом сам по собі
      приводить до <em>базованих-на-інтерфейсах фреймворках</em><span class="Apple-converted-space">
      </span>(<a href="ch4.xhtml#lev20" style="text-decoration: none;">Елемент
        20</a>), де інтерфейси дають природні повертаємі типи для статичних
      методів-фабрик.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_7"></span>До появи Java 8 інтерфейси не
      могли мати ститичних методів. За домовленістю статичні методи фабрик для
      інтерфейсу на ім'я <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><em>Type</em></code><span
        class="Apple-converted-space">, покладались в <em>нестворюваний
          клас-компанйон</em></span><span class="Apple-converted-space"> </span>(<a
        href="ch2.xhtml#lev4" style="text-decoration: none;">Елемент 4</a>) на
      ім'я<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><em>Types</em></code>.
      Наприклад, Java Collections Framework мав сорок-п'ять допоміжних
      реалізацій власних інтерфейсів, провадячи немодифіковані колекції,
      синхронізовані колекції, і так далі. Майже всі з цїх реалізацій
      експортувались через статичні методи фабрики в одному нестворюваному класі
      (<code style="font-family: 'Courier New', monospace;">java.util.Collections</code>).
Класи
      повертаємих об'єктів всі були непублічними.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Collections
      Framework API є меншим, чив він мав би бути, якщо б експортував
      сорок-п'ять окремих публічних класів, по одному для кожної відомої
      реалізації. Це не тільки <em>купа </em>API, яку вдалось зменшити, але і
      <em>концептульна вага</em><em>:</em><span class="Apple-converted-space"> </span>число
      та складність концепцій, що мають засвоїти програмісти, щоб
      використовувати API. Програміст знає, що потрібний об'єкт має то саме API,
      яке вказане в інтерфейсі, так що немає потреби читати додаткові
      документації класів для класу реалізації. Більше того, маючи такий
      статичний метод фабрики потребує від клієнта посилання на повернутий
      об'єкт згідно інтерфейса, скоріше ніж класа реалізації, що загалом є
      гарною практикою (<a href="ch9.xhtml#lev64" style="text-decoration: none;">Елемент
        64</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В&nbsp;
      Java 8 обмеження, що інтерфейси не можуть містити статичні методи, було
      видалено, так що тепер є мало причин провадити нестворюваний
      клас-компанйон для інтерфейсу. Багато публічних статичних членів, що були
      б на своєму місці в такому класі, повинні замість цього бути розташовані в
      самому інтерфейсі. Зауважте, однак, що все ще може бути потрібним покласти
      багато з коду реалізації за межами ціх статичних методів в окремий,
      пакунок-приватний клас. Це тому, що Java 8 потребує, щоб статичні члени
      інтерфейса були публічними. Java 9 дозволяє приватні статичні методи, але
      статичні поля та статичні члени-класи все ще потребують бути публічними.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Четверта
        перевага статичних фабрик в тому, що клас повернутого об'єкту може
        варіюватись виклик від виклику, як функція вхідних параметрів.</strong><span
        class="Apple-converted-space"> Любий субтип задекларованого результату
        буде дозволеним. Клас повернутого об'єкту може також варіювати від
        релізу до релізу</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Клас
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">EnumSet</code><span
        class="Apple-converted-space"> </span>(<a href="ch6.xhtml#lev36" style="text-decoration: none;">Елемент
        36</a>) не має публічних конструкторів, тільки статичні фабрики. В
      реалізації OpenJDK вони повертають примірник одного з двох субкласів, в
      залежності від розміру підлеглого типу enum: якщо він має
      шістьдесят-чотири або меньше елементів, як відбувається з більшістю
      переліків, статичні фабрикі повертають примірник<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">RegularEnumSet</code>,
      що підтримується поодиноким<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">long</code>; якщо тип
      enum має 65 або більше елементів, фабрики повертають примірник<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">JumboEnumSet</code>,
      представлений як масив<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">long</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Наявність
      ціх двох класів-реалізацій невидиме для клієнтів. Якщо<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">RegularEnumSet</code><span
        class="Apple-converted-space"> припинить надавати переваги
        продуктивності для малих типів переліку, він може зникнути з наступних
        релізів без болісних ефектів. Подібно до цього, наступний реліз може
        додати третю або четверту реалізацію </span><code style="font-family: 'Courier New', monospace;">EnumSet</code><span
        class="Apple-converted-space">, якщо це буде вигідним для продуктивності</span>.
      Клієнти ніколи не знають, або не мають турбуватись щодо класу об'єкта, що
      буде повертатись з фабрики; вони турбуються тільки про те, що це якісь з
      субкласів <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">EnumSet</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>П'ята
        перевага статичних фабрик в тому, що класи повертаємих об'єктів не мають
        існувати, коли створюється клас, що містить створюваний метод. </strong><span
        class="Apple-converted-space"></span>Така гнучка статича форма метода
      фабрики є основою для <em>фреймворків провайдерів сервісіів, </em>як
      Java Database Connectivity API (JDBC). Фреймворк провайдера сервісу є
      системою, в якій провайдери реалізують сервіс, та система робить
      реалізацію доступною для кілєнтів, відділяючи клієнтів від реалізацій.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існує
      три основних компонентів в фремворці провайдера сервісу: <em>інтерфейс
        сервісу, </em>що представляє реалізацію; <em>API реєстрації провайдера</em>,
      яке провайдери використовують для реєстрації реалізацій; <em>API доступу
        до сервісів</em>, який використоує клієт для отримання примірників
      сервісу. API доступу до сервісу можуть дозволити клієнтам вказувати
      критерії для обрання реалізації. За відсутності такої критерії, API
      повертає примірник реалізації по замовчанню, або дозволяє клієнтові
      проходити по можливим реалізаціям. API доступу до сервісу є гнучкою
      статичною фабрикою, що формує базис фреймворку провайдера сервісу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Опціональний
      четвертий компонент фреймворку провайдера сервісу є <em>інтерфейс
        провайдера сервісу</em>, що описує об'єкт фабрики, що продукує
      примірники інтерфейсу сервісу. За відсутності інтерфейсу провайдерів
      сервісу, реалізації мають бути утворювати примірники рефлективно (<a href="ch9.xhtml#lev65"
        style="text-decoration: none;">Елемент 65</a>). В випадку JDBC<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Connection</code><span
        class="Apple-converted-space"> </span>відіграє роль інтерфейсу сеpвісу,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">DriverManager.registerDriver</code><span
        class="Apple-converted-space"> є </span><span class="Apple-converted-space">
        API реєстрації провайдерів</span>, <code style="font-family: 'Courier New', monospace;">DriverManager.getConnection</code><span
        class="Apple-converted-space"> </span>є API доступа до сервіса, та <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Driver</code><span
        class="Apple-converted-space"> є інтерфейсом провайдера сервісу</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існує
      багато шаблонів для фреймворку провайдера сервісів. Наприклад, API доступу
      до сервіса може повертати багатший інтерфейс сервісу до клієнтів, ніж той,
      що надають провайдери. Це шаблон Моста<span class="Apple-converted-space">.
      </span><em>Bridge</em><span class="Apple-converted-space">&nbsp;</span>pattern
      [<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Фреймворки ін'єкції залежностей (<a href="ch2.xhtml#lev5" style="text-decoration: none;">Елемент
        5</a>) можа розглядати як потужний провайдер сервісів. Починаючи з Java
      6, платформа включає фреймворк провайдера сервісів загального призначеня,
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">java.util.ServiceLoader</code>,
      так що вам немає потреби, та загалом не повинні, писати ваші власні (<a href="ch9.xhtml#lev59"
        style="text-decoration: none;">Елемент 59</a>). JDBC не використовує<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">ServiceLoader</code>,
      бо той з'явився пізніше.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Головне
        обмеження на провадження тільки статичних методів фабрик в тому, що
        класи без публічних або захищених конструкторів не можуть мати
        субкласів. </strong><span class="Apple-converted-space"></span>Наприклад,
      неможливо створити субклас любого зі звичних класів реалізації в
      Collections Framework. Напевне, цьому можна тільки радіти, оскільки це
      заохочує програмістів використовувати композицію замість наслідування (<a
        href="ch4.xhtml#lev18" style="text-decoration: none;">Елемент 18</a>),
      та є вимогою для незмінних типів (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Елемент
        17</a>).</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Другє
        обмеження статичних методів фабрик в тому, що програмістам складно їх
        знайти.</strong><span class="Apple-converted-space"> Вони не виділяються
        з документації </span>API в спосіб, як це роблять конструктори, так що
      може бути складним винайти, як можна створити примірник класу, що
      провадить статичні методи фабрик замість конструкторів. Інструмент Javadoc
      може з часом звернути увагу не статичні методи фабрики. В найближчий час
      ви можете зменшити цю проблему, через увагу до статичних методів фабрик в
      класі, або в документації, та приставши до загальних домовленостей по
      іменуванню. Ось деякі загальні імена для статичних методів фабрик. Список
      далекий від повноти:</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>from</strong></code>
      — Метод <em>перетворення типів, </em>що приймає єдиний параметр, та
      повертає відповідний примірник цього типу, наприклад:</p>
    <p class="codepb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 10.666667px; margin-bottom: 10.666667px; margin-left: 36px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Date
      d = Date.from(instant);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>of</strong></code>
      — <em>Метод агрегації, </em>що приймає декілька параметрів, та повертає
      тип, що поєднує їх всі, наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Rank&gt;
      faceCards = EnumSet.of(JACK, QUEEN, KING);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>valueOf</strong></code>
      — Більш гучна альтернатива до <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">from</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">of</code>,
      наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BigInteger
      prime = BigInteger.valueOf(Integer.MAX_VALUE);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>instance</strong></code><span
        class="Apple-converted-space"> </span>або<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>getInstance
          </strong></code>— Повертає примірник, що описаний параметром (якщо є),
      але не можна сказати, чи це буде мати те саме значення, наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">StackWalker
      luke = StackWalker.getInstance(options);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>create</strong></code><span
        class="Apple-converted-space">&nbsp;</span>oбо<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>newInstance</strong></code>
      — Як <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">instance</code><span
        class="Apple-converted-space"> </span>або<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">getInstance</code>,
      за винятком того, що метод гарантує, що кожний виклик повертає новий
      примірник, наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Object
      newArray = Array.newInstance(classObject, arrayLen);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>get</strong></code><em><strong>Type</strong></em>
      — Як<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">getInstance</code>,
      але використовується, якщо метод фабрики знаходиться в іншому класі.<span
        class="Apple-converted-space">&nbsp;</span><em>Type</em><span class="Apple-converted-space">
        є типом об'єкта. що треба повернути методом файбрикою, наприклад</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">FileStore
      fs = Files.getFileStore(path);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>new</strong></code><em><strong>Type
          </strong></em>— Як<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">newInstance</code>,
      але використовується, якщо метод фабрики є іншого класу.<span class="Apple-converted-space">&nbsp;</span><em>Type</em><span
        class="Apple-converted-space"> </span>є типом, що повертає метод
      фабрика, наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BufferedReader
      br = Files.newBufferedReader(path);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><em><strong>type</strong></em>
      — Скорочена альтернатива до <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">get</code><em>Type</em><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">new</code><em>Type</em>,
      наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">List&lt;Complaint&gt;
      litany = Collections.list(legacyLitany);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      підсумку, статичні методи фабрики та публічні конструктори, обоє мають
      своє застосування, і має сенс розібратись в їх відносних достоїнствах.
      Часто статичні фабрики є переважними, так що уникайте рефлекторного
      запровадження публічних конструкторів, зпочатку не розглянувши статичні
      фабрики.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_10"></span><strong>Елемент 2: Розгляньте
        білдер, коли стикнетесь з багатьма параметрами конструктора</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Статичні
      функції та конструктори поділяють одне обмеження: вони не маштабуються
      добре до великих чисел опціональних параметрів. Розглянемо випадок, коли
      клас представляє диєтичні факти, що клеяться на упаковках продуктів. Ці
      мітки можуть мати декілька обов'язкових полів — кількість на одну порцію,
      кількість порцій в пакунку, та калорії в одній порції — та більше ніж
      дванадцять опціональних полів — загальний вмст жирів, кількість насичених
      жирів, штучний жир, холестерол, вуглеводи і так далі. Більшість продуктів
      мають ненулеві значення тільки для деяких з ціх опціональних полів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Який
      різновид конструкторів або статичних фабрик повинні ви написати для такого
      класу? Традиційно програмісти використовують шаблон <em>телескопічні
        конструкції</em>, в якій ви провадите конструктор тільки з потрібними
      полями, інший з одним додатковим полем, третій з двома додатковими, і так
      далі, остаточно задавши конструктор з усіма функціональними параметрами.
      Ось як це виглядає на практиці. Для цілей краткості показані тільки чотири
      опціональні поля:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Шаблон телескопічного конструктора - негарно маштабується!</strong><br>
      public class NutritionFacts {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int servingSize;&nbsp;&nbsp;//
      (mL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
      потрібне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int
      servings;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// (порцій в пачці) потрібне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int
      calories;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// (на порцію)&nbsp;&nbsp;&nbsp;
      опціональне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int
      fat;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (g/порцію)&nbsp;&nbsp;&nbsp;&nbsp; опціональне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int
      sodium;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (mg/порцію)&nbsp;&nbsp;&nbsp; опціональне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int carbohydrate; //
      (g/порцію)&nbsp;&nbsp;&nbsp;&nbsp; опціональне<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(servingSize,
      servings, 0);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      calories) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(servingSize,
      servings, calories, 0);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      calories, int fat) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(servingSize,
      servings, calories, fat, 0);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      calories, int fat, int sodium) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(servingSize,
      servings, calories, fat, sodium, 0);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <span epub:type="pagebreak" id="page_11"></span><br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int calories,
      int fat, int sodium, int carbohydrate) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servingSize&nbsp;&nbsp;=
      servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servings&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
      servings;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.calories&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
      calories;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.fat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
      fat;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.sodium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      = sodium;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.carbohydrate =
      carbohydrate;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Коли
      ви бажаєте створити примірник, ви використовуєте конструктор з найменшим
      списком параметрів, що містить всі параметри, які ви бажаєте встановити:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NutritionFacts
      cocaCola =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;new NutritionFacts(240, 8, 100, 0, 35, 27);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Типово
      виклик цього конструктора буде потребувати багато параметрів, що ви не
      бажаєте встановити, але ви змушені передавати значення для них в жодному
      разі. В цьому випадку ми передаємо значення 0 для вмісту жиру. "Тільки" з
      шістьома параметрами це може виглядати не так вже і погано, але це швидко
      вийде з-під контролю по мірі зростання числа параметрів. </p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      коротко, <span class="Apple-converted-space"></span><strong>шаблон
        телескопічного конструктора працює, але для нього складно писати
        клієнтський код, коли є багато параметрів, та ще складніше </strong><strong>це
        </strong><strong>читати.</strong><span class="Apple-converted-space">
        Читач залишається здивованим, що всі ці значення значать, та має уважно
        рахувати параметри, щоб розібратись в цьому</span>. Довгі послідовності
      ідентично типізованих параметрів можуть викликати непомітні помилки. Якщо
      клієнт випадково поміняє два такі параметри, компілятор не буде сваритись,
      але програма буде невірно поводитись під час виконання (<a href="ch8.xhtml#lev51"
        style="text-decoration: none;">Елемент 51</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Друга
      альтернатива, коли ви стикаєтесь з багатьма опціональними параметрами в
      конструкторі, є шаблон<span class="Apple-converted-space"> </span><em>JavaBeans</em>,
      коли ви викликаєте конструктор без параметрів для створення об'єкту, та
      потім викликати методи сеттери для встановлення кожного цікавого
      опціонального параметра:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Шаблон JavaBeans - дозволяє неузгодженість, нав'язує змінність</strong><br>
      public class NutritionFacts {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Parameters initialized to default values (if
      any)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int servingSize&nbsp;&nbsp;= -1; //
      Потрібне, немає значення по замовчанню;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int servings&nbsp;&nbsp;&nbsp;&nbsp; = -1;
      // Потрібне, немає значення по замовчанню;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int calories&nbsp;&nbsp;&nbsp;&nbsp; = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int
      fat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int
      sodium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int carbohydrate = 0;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts() { }<br>
      <span epub:type="pagebreak" id="page_12"></span>&nbsp;&nbsp;&nbsp;&nbsp;//
      Setters<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setServingSize(int val)&nbsp;&nbsp;{
      servingSize = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setServings(int val)&nbsp;&nbsp;&nbsp;
      { servings = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setCalories(int val)&nbsp;&nbsp;&nbsp;
      { calories = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setFat(int
      val)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ fat = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setSodium(int
      val)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ sodium = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setCarbohydrate(int val) {
      carbohydrate = val; }<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Цей
      шаблон не має жодних недоліків шаблона телескопічного конструктора. Він
      простий, трохи балакучий при створенні примірників, та отриманний код
      просто читати:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NutritionFacts
      cocaCola = new NutritionFacts();<br>
      cocaCola.setServingSize(240);<br>
      cocaCola.setServings(8);<br>
      cocaCola.setCalories(100);<br>
      cocaCola.setSodium(35);<br>
      cocaCola.setCarbohydrate(27);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">На
      жаль, шаблон JavaBeans сам по собі має серйозні недоліки. Оскільки
      конструювання розбите на декілька викликів,&nbsp;<strong> JavaBean може
        бути в неузгодженому стані на протязі свого створення.</strong><span class="Apple-converted-space">
        Клас не має опцій для примусу узгодженості, просто через перевірку
        валідності параметрів конструктора. Спроба використовувати об'єкт коли
        він в неузгодженому стані може привести до відмов, що далеко відстоять
        від кода, що містить баг, і, таким чином, складно відстежується.
        Пов'язаний недолік полягає в тому, що </span><strong>шаблон JavaBeans
        заважає можливості створити незмінний клас</strong><span class="Apple-converted-space">
      </span>(<a href="ch4.xhtml#lev17" style="text-decoration: none;">Елемент
        17</a>), та потребує додаткових зусиль з боку програміста, щоб
      забезпечити поточну безпеку.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Можливо
      зменшити ці негаразди, вручну "заморозивши" об'єкт на час створення до
      завершення побудови, та заборонити його використання на час заморожування,
      але цей варіант рідко використовується на практиці. Більше того, він може
      спричинити помилки часу виконання, оскільки компілятор не може
      переконатись, що програміст викликає метод заморожування на об'єкті до
      того, як використовувати його.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">На
      щастя, існує третя альтернатива, що комбінує безпеку шаблону
      телескопічного конструктора з читаємістю шаблону JavaBeans. Це форма
      шаблону Білдера, <span class="Apple-converted-space"></span><em>Builder</em><span
        class="Apple-converted-space">&nbsp;</span>pattern [<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>]. Замість робити бажаний
      об'єкт напряму, клієнт викликає конструктор (або статичну фабрику) з усіма
      потрібними полями, та отримує об'єкт <em>білдера</em>. Поітм клієнт
      викликає сеттер-подібні методи на об'єкті білдера для встановлювання всіх
      опціональних параметрів. Нарешті, клієнт викликає метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">build</code><span class="Apple-converted-space">
        без параметрів, що генерує об'єкт, що типово є незмінним. Білдер типово
        є статичним класом членом </span>(<a href="ch4.xhtml#lev24" style="text-decoration: none;">Елемент
        24</a>) класу, який він будує. Ось як це виглядає на практиці:</p>
    <span epub:type="pagebreak" id="page_13" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Builder Pattern</strong><br>
      public class NutritionFacts {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int servings;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int calories;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int fat;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int sodium;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int carbohydrate;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static class Builder {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Обов'язкові параметри<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private final int
      servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private final int
      servings;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Опціональні параметри<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private int
      calories&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private int
      fat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private int
      sodium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private int
      carbohydrate&nbsp;&nbsp;= 0;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder(int
      servingSize, int servings) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servingSize
      = servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servings&nbsp;&nbsp;&nbsp;&nbsp;=
      servings;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder
      calories(int val)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      calories = val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder fat(int
      val)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      fat = val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      return this; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder sodium(int
      val)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      sodium = val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
      }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder
      carbohydrate(int val)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      carbohydrate = val;&nbsp;&nbsp;return this; }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts
      build() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      new NutritionFacts(this);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private NutritionFacts(Builder builder) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servingSize&nbsp;&nbsp;=
      builder.servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servings&nbsp;&nbsp;&nbsp;&nbsp;
      = builder.servings;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calories&nbsp;&nbsp;&nbsp;&nbsp;
      = builder.calories;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
      builder.fat;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sodium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      = builder.sodium;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carbohydrate =
      builder.carbohydrate;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_14"></span>Клас <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">NutritionFacts</code><span
        class="Apple-converted-space"> є незмінним, та всі значення параметрів
        знаходяться в одному місці</span>. Метод сеттера повертає сам білдер,
      так що виклики можна сціпити в ланцюжок, що дає <span class="Apple-converted-space"></span><em>побіжний
        API</em>. Ось як виглядає код клієнта:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NutritionFacts
      cocaCola = new NutritionFacts.Builder(240, 8)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.calories(100).sodium(35).carbohydrate(27).build();</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Цей
      клієнтський код просто писати, та, що більш важливо, просто читати. <strong>Шаблон
        білдера симулює іменовані опціональні параметри</strong><span class="Apple-converted-space">,
        які існують в </span>Python та Scala.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Перевірки
      валідності випущені для скорочення. Щоб виявити невалідні параметри так
      скоро, як це можливо, перевіряйте валідність в конструкторі та методах
      білдерів. Перевіряйте інваріанти, включаючи декілька параметрів в
      конструкторі, що викликаєтсья в методі <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">build</code>. Щоб
      перевірити ці інваріанти проти атак, робіть перевірки полів об'єкта після
      копіювання параметрів з білдера (<a href="ch8.xhtml#lev50" style="text-decoration: none;">Елемент
        50</a>). Якщо перевірка схибить, викликайте <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">IllegalArgumentException</code>
      (<a href="ch10.xhtml#lev72" style="text-decoration: none;">Елемент 72</a>),
      чиє детальне повідомлення вказує, які параметри є невалідними (<a href="ch10.xhtml#lev75"
        style="text-decoration: none;">Елемент 75</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Шаблон
        білдера гарно пристосований до ієрархій класів.</strong><span class="Apple-converted-space">
      </span>Використовуйте паралельну ієрархію білдерів, кожний вкладений в
      відповідний клас. Абстрактні класи мають абстрактні білдери; суцільні
      класи мають суцільні білдери. Наприклад, розглянемо абстрактний клас в
      корені ієрархії, що представляє різні сорти піцци:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Шаблон білдерів для ієрархії класів</strong><br>
      public abstract class Pizza {<br>
      &nbsp;&nbsp;&nbsp;public enum Topping { HAM, MUSHROOM, ONION, PEPPER,
      SAUSAGE }<br>
      &nbsp;&nbsp;&nbsp;final Set&lt;Topping&gt; toppings;<br>
      <br>
      &nbsp;&nbsp;&nbsp;abstract static class<span class="Apple-converted-space">&nbsp;</span><strong>Builder&lt;T
        extends Builder&lt;T&gt;&gt;</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnumSet&lt;Topping&gt; toppings =
      EnumSet.noneOf(Topping.class);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public T addTopping(Topping topping) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      toppings.add(Objects.requireNonNull(topping));<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span><strong>return
        self();</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abstract Pizza build();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>// Субкласи мають перекривати
        цей метод, щоб повертати "this"</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>protected abstract T self();</strong><br>
      &nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;Pizza(Builder&lt;?&gt; builder) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;toppings = builder.toppings.clone();
      // See Item&nbsp;&nbsp;50<br>
      &nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зауважте,
      що <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Pizza.Builder</code><span
        class="Apple-converted-space"> є</span><span class="Apple-converted-space">
        <em>дженерік типом з рекурсивним параметром типу </em></span>(<a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Елемент 30</a>). Це, разом з абстрактним
      методом <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">self</code>,
      дозволяє зціплення методів, для відповідної роботи в субкласах без потреби
      в кастингу. Це обхідний маневр для факту, що в Java бракує типу self, що
      відоме як <em>ідіома симульованого self-типу</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_15"></span>Ось два суцільних субкласи <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Pizza</code>,
      один з яких представляє стандартну пицу в стилі New-York, та інший
      кальцоне. Перший має обов'язковий параметр розміру, та другий дозволяє вам
      задати, чи соус має бути зсередини чи зовні:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class NyPizza extends Pizza {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public enum Size { SMALL, MEDIUM, LARGE }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Size size;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static class Builder extends
      Pizza.Builder&lt;Builder&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private final Size size;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder(Size size)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.size
      = Objects.requireNonNull(size);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public NyPizza
      build() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      new NyPizza(this);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override protected
      Builder self() { return this; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private NyPizza(Builder builder) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(builder);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size = builder.size;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }<br>
      <br>
      public class Calzone extends Pizza {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final boolean sauceInside;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static class Builder extends
      Pizza.Builder&lt;Builder&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private boolean
      sauceInside = false; // Default<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder
      sauceInside() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sauceInside
      = true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      this;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public Calzone
      build() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      new Calzone(this);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override protected
      Builder self() { return this; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Calzone(Builder builder) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(builder);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sauceInside =
      builder.sauceInside;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_16"></span>Зауважте, що метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">build</code><span class="Apple-converted-space">
        в білдері кожного субкласу декларований щоб повертати коректний субклас</span>:
      метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">build</code><span
        class="Apple-converted-space"> </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">NyPizza.Builder</code>
      повертає<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">NyPizza</code>,
      тоді як той самий в <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Calzone.Builder</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Calzone</code>.
      Цей прийом, коли метод субкласа декларований повертати субтип типу,
      повертаємого в супер-класі, відомий як <em>коваріантна типізація
        повернення</em>. Це дозволяє клієнтам використовувати ці білдери без
      потреби кастингу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Клієнтський
      код для ціх “ієрархічних білдерів” в основному іденичний до коду для
      простого білдера <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">NutritionFacts</code>.
      Приклад кода клієнта, показаний далі, вважає існування статичних enum
      констант:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NyPizza
      pizza = new NyPizza.Builder(SMALL)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addTopping(SAUSAGE).addTopping(ONION).build();<br>
      Calzone calzone = new Calzone.Builder()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addTopping(HAM).sauceInside().build();</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Мінорна
      перевага білдерів над конструкторами в тому, що білдери можуть мати багато
      множинних параметрів, оскільки кожний параметр вказаний у власному методі.
      Альтернативно, білдери можуть агрегувати параметри, передані в багатьох
      викликах в одне поле, як демонструється в методі <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">addTopping</code><span class="Apple-converted-space">
        раніше</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Шаблон
      Builder є досить гнучким. Єдиний білдер може використовуватись повторно
      для будування декількох об'єктів. Параметри білдера можуть бути
      налаштовані між викликами метода <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">build</code><span class="Apple-converted-space">,
        щоб варіювати створювані об'єкти</span>. Білдер може заповнювати деякі
      поля автоматично перед створенням об'єкту, такі як серійні номери, що
      збільшуються кожного разу, коли створюється об'єкт.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Шаблон
      Builder також має і недоліки. Щоб створити об'єкт ви маєте зпочатку
      створити білдер. While the cost of creating this builder is unlikely to be
      noticeable in practice, it could be a problem in performance-critical
      situations. Also, the Builder pattern is more verbose than the telescoping
      constructor pattern, so it should be used only if there are enough
      parameters to make it worthwhile, say four or more. But keep in mind that
      you may want to add more parameters in the future. But if you start out
      with constructors or static factories and switch to a builder when the
      class evolves to the point where the number of parameters gets out of
      hand, the obsolete constructors or static factories will stick out like a
      sore thumb. Therefore, it’s often better to start with a builder in the
      first place.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Підсумовуючи,
      <strong>шаблон білдера є гарним вибором при розробці класів, чиї
        конструктори або статичні фабрики можуть мати велику кількість
        параметрів</strong>, особливо якщо багато параметрів є опціональними або
      ідентичного типу. Код клієнта з білдерами стає значно простішим для
      читання та написання, ніж з телескопічними конструкторами, та білдери
      значно простіші, ніж JavaBeans.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev3" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_17"></span><strong>Item 3: Enforce the singleton property with
        a private constructor or an enum type</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A<span
        class="Apple-converted-space">&nbsp;</span><em>singleton</em><span class="Apple-converted-space">&nbsp;</span>is
      simply a class that is instantiated exactly once [<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>]. Singletons typically
      represent either a stateless object such as a function (<a href="ch4.xhtml#lev24"
        style="text-decoration: none;">Item 24</a>) or a system component that
      is intrinsically unique.<span class="Apple-converted-space">&nbsp;</span><strong>Making
        a class a singleton can make it difficult to test its clients</strong><span
        class="Apple-converted-space">&nbsp;</span>because it’s impossible to
      substitute a mock implementation for a singleton unless it implements an
      interface that serves as its type.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are two common ways to implement singletons. Both are based on keeping the
      constructor private and exporting a public static member to provide access
      to the sole instance. In one approach, the member is a final field:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex18a" id="pch2ex18" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Singleton with public final field</strong><br>
      public class Elvis {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public static final Elvis INSTANCE = new
        Elvis();</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Elvis() { ... }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void leaveTheBuilding() { ... }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      private constructor is called only once, to initialize the public static
      final field<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Elvis.INSTANCE</code>.
      The lack of a public or protected constructor<em>guarantees</em><span class="Apple-converted-space">&nbsp;</span>a
      “monoelvistic” universe: exactly one<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Elvis</code><span class="Apple-converted-space">&nbsp;</span>instance
      will exist once the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Elvis</code><span class="Apple-converted-space">&nbsp;</span>class
      is initialized—no more, no less. Nothing that a client does can change
      this, with one caveat: a privileged client can invoke the private
      constructor reflectively (<a href="ch9.xhtml#lev65" style="text-decoration: none;">Item
        65</a>) with the aid of the<code style="font-family: 'Courier New', monospace;">AccessibleObject.setAccessible</code><span
        class="Apple-converted-space">&nbsp;</span>method. If you need to defend
      against this attack, modify the constructor to make it throw an exception
      if it’s asked to create a second instance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      the second approach to implementing singletons, the public member is a
      static factory method:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex19a" id="pch2ex19" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Singleton with static factory</strong><br>
      public class Elvis {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private</strong><span class="Apple-converted-space">&nbsp;</span>static
      final Elvis INSTANCE = new Elvis();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Elvis() { ... }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public static Elvis getInstance()</strong><span
        class="Apple-converted-space">&nbsp;</span>{ return INSTANCE; }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void leaveTheBuilding() { ... }<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">All
      calls to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Elvis.getInstance</code><span
        class="Apple-converted-space">&nbsp;</span>return the same object
      reference, and no other<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Elvis</code><span class="Apple-converted-space">&nbsp;</span>instance
      will ever be created (with the same caveat mentioned earlier).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_18"></span>The main advantage of the
      public field approach is that the API makes it clear that the class is a
      singleton: the public static field is final, so it will always contain the
      same object reference. The second advantage is that it’s simpler.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      advantage of the static factory approach is that it gives you the
      flexibility to change your mind about whether the class is a singleton
      without changing its API. The factory method returns the sole instance,
      but it could be modified to return, say, a separate instance for each
      thread that invokes it. A second advantage is that you can write a<span class="Apple-converted-space">&nbsp;</span><em>generic
        singleton factory</em><span class="Apple-converted-space">&nbsp;</span>if
      your application requires it (<a href="ch5.xhtml#lev30" style="text-decoration: none;">Item
        30</a>). A final advantage of using a static factory is that a<span class="Apple-converted-space">&nbsp;</span><em>method
        reference</em><span class="Apple-converted-space">&nbsp;</span>can be
      used as a supplier, for example<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Elvis::instance</code><span
        class="Apple-converted-space">&nbsp;</span>is a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Supplier&lt;Elvis&gt;</code>.
      Unless one of these advantages is relevant, the public field approach is
      preferable.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make a singleton class that uses either of these approaches<span class="Apple-converted-space">&nbsp;</span><em>serializable</em><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch12.xhtml#ch12" style="text-decoration: none;">Chapter
        12</a>), it is not sufficient merely to add<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">implements Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>to its declaration. To
      maintain the singleton guarantee, declare all instance fields<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">transient</code><span class="Apple-converted-space">&nbsp;</span>and
      provide a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readResolve</code><span
        class="Apple-converted-space">&nbsp;</span>method (<a href="ch12.xhtml#lev89"
        style="text-decoration: none;">Item 89</a>). Otherwise, each time a
      serialized instance is deserialized, a new instance will be created,
      leading, in the case of our example, to spurious<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Elvis</code><span class="Apple-converted-space">&nbsp;</span>sightings.
      To prevent this from happening, add this<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">readResolve</code><span class="Apple-converted-space">&nbsp;</span>method
      to the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Elvis</code><span
        class="Apple-converted-space">&nbsp;</span>class:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex20a" id="pch2ex20" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        readResolve method to preserve singleton property</strong><br>
      private Object readResolve() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp; // Return the one true Elvis and let the garbage
      collector<br>
      &nbsp;&nbsp;&nbsp;&nbsp; // take care of the Elvis impersonator.<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return INSTANCE;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      third way to implement a singleton is to declare a single-element enum:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex21a" id="pch2ex21" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Enum singleton - the preferred approach</strong><br>
      public enum Elvis {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void leaveTheBuilding() { ... }<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      approach is similar to the public field approach, but it is more concise,
      provides the serialization machinery for free, and provides an ironclad
      guarantee against multiple instantiation, even in the face of
      sophisticated serialization or reflection attacks. This approach may feel
      a bit unnatural, but<span class="Apple-converted-space">&nbsp;</span><strong>a
        single-element enum type is often the best way to implement a singleton</strong>.
      Note that you can’t use this approach if your singleton must extend a
      superclass other than<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Enum</code><span class="Apple-converted-space">&nbsp;</span>(though
      you<span class="Apple-converted-space">&nbsp;</span><em>can</em><span class="Apple-converted-space">&nbsp;</span>declare
      an enum to implement interfaces).</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev4" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_19"></span><strong>Item 4: Enforce noninstantiability with a
        private constructor</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Occasionally
      you’ll want to write a class that is just a grouping of static methods and
      static fields. Such classes have acquired a bad reputation because some
      people abuse them to avoid thinking in terms of objects, but they do have
      valid uses. They can be used to group related methods on primitive values
      or arrays, in the manner of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.lang.Math</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.Arrays</code>.
      They can also be used to group static methods, including factories (<a href="ch2.xhtml#lev1"
        style="text-decoration: none;">Item 1</a>), for objects that implement
      some interface, in the manner of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.Collections</code>.
      (As of Java 8, you can also put such methods<span class="Apple-converted-space">&nbsp;</span><em>in</em><span
        class="Apple-converted-space">&nbsp;</span>the interface, assuming it’s
      yours to modify.) Lastly, such classes can be used to group methods on a
      final class, since you can’t put them in a subclass.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Such<span
        class="Apple-converted-space">&nbsp;</span><em>utility classes</em><span
        class="Apple-converted-space">&nbsp;</span>were not designed to be
      instantiated: an instance would be nonsensical. In the absence of explicit
      constructors, however, the compiler provides a public, parameterless<span
        class="Apple-converted-space">&nbsp;</span><em>default constructor</em>.
      To a user, this constructor is indistinguishable from any other. It is not
      uncommon to see unintentionally instantiable classes in published APIs.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Attempting
        to enforce noninstantiability by making a class abstract does not work.</strong><span
        class="Apple-converted-space">&nbsp;</span>The class can be subclassed
      and the subclass instantiated. Furthermore, it misleads the user into
      thinking the class was designed for inheritance (<a href="ch4.xhtml#lev19"
        style="text-decoration: none;">Item 19</a>). There is, however, a simple
      idiom to ensure noninstantiability. A default constructor is generated
      only if a class contains no explicit constructors, so<span class="Apple-converted-space">&nbsp;</span><strong>a
        class can be made noninstantiable by including a private constructor</strong>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex22a" id="pch2ex22" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Noninstantiable utility class</strong><br>
      public class UtilityClass {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// Suppress default constructor for
        noninstantiability</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;private UtilityClass() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      AssertionError();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      the explicit constructor is private, it is inaccessible outside the class.
      The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AssertionError</code><span
        class="Apple-converted-space">&nbsp;</span>isn’t strictly required, but
      it provides insurance in case the constructor is accidentally invoked from
      within the class. It guarantees the class will never be instantiated under
      any circumstances. This idiom is mildly counterintuitive because the
      constructor is provided expressly so that it cannot be invoked. It is
      therefore wise to include a comment, as shown earlier.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      a side effect, this idiom also prevents the class from being subclassed.
      All constructors must invoke a superclass constructor, explicitly or
      implicitly, and a subclass would have no accessible superclass constructor
      to invoke.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev5" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_20"></span><strong>Item 5: Prefer dependency injection to
        hardwiring resources</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      classes depend on one or more underlying resources. For example, a spell
      checker depends on a dictionary. It is not uncommon to see such classes
      implemented as static utility classes (<a href="ch2.xhtml#lev4" style="text-decoration: none;">Item
        4</a>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex23a" id="pch2ex23" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Inappropriate use of static utility - inflexible &amp; untestable!</strong><br>
      public class SpellChecker {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final Lexicon dictionary = ...;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private SpellChecker() {} // Noninstantiable<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static boolean isValid(String word) { ... }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static List&lt;String&gt;
      suggestions(String typo) { ... }<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Similarly,
      it’s not uncommon to see them implemented as singletons (<a href="ch2.xhtml#lev3"
        style="text-decoration: none;">Item 3</a>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex24a" id="pch2ex24" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Inappropriate use of singleton - inflexible &amp; untestable!</strong><br>
      public class SpellChecker {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Lexicon dictionary = ...;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private SpellChecker(...) {}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static INSTANCE = new SpellChecker(...);<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean isValid(String word) { ... }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public List&lt;String&gt; suggestions(String typo)
      { ... }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Neither
      of these approaches is satisfactory, because they assume that there is
      only one dictionary worth using. In practice, each language has its own
      dictionary, and special dictionaries are used for special vocabularies.
      Also, it may be desirable to use a special dictionary for testing. It is
      wishful thinking to assume that a single dictionary will suffice for all
      time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      could try to have<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SpellChecker</code><span
        class="Apple-converted-space">&nbsp;</span>support multiple dictionaries
      by making the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">dictionary</code><span
        class="Apple-converted-space">&nbsp;</span>field nonfinal and adding a
      method to change the dictionary in an existing spell checker, but this
      would be awkward, error-prone, and unworkable in a concurrent setting.<span
        class="Apple-converted-space">&nbsp;</span><strong>Static utility
        classes and singletons are inappropriate for classes whose behavior is
        parameterized by an underlying resource.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">What
      is required is the ability to support multiple instances of the class (in
      our example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SpellChecker</code>),
      each of which uses the resource desired by the client (in our example, the
      dictionary). A simple pattern that satisfies this requirement is to<span class="Apple-converted-space">&nbsp;</span><strong>pass
        the resource into the constructor when creating a new instance</strong>.
      This is one form of<span class="Apple-converted-space">&nbsp;</span><em>dependency
        injection</em>: the dictionary is a<span class="Apple-converted-space">&nbsp;</span><em>dependency</em><span
        class="Apple-converted-space">&nbsp;</span>of the spell checker and is<span
        class="Apple-converted-space">&nbsp;</span><em>injected</em><span class="Apple-converted-space">&nbsp;</span>into
      the spell checker when it is created.</p>
    <span epub:type="pagebreak" id="page_21" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex25a" id="pch2ex25" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Dependency injection provides flexibility and testability</strong><br>
      public class SpellChecker {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Lexicon dictionary;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public SpellChecker(Lexicon dictionary)</strong><span
        class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.dictionary =
      Objects.requireNonNull(dictionary);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean isValid(String word) { ... }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public List&lt;String&gt; suggestions(String typo)
      { ... }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      dependency injection pattern is so simple that many programmers use it for
      years without knowing it has a name. While our spell checker example had
      only a single resource (the dictionary), dependency injection works with
      an arbitrary number of resources and arbitrary dependency graphs. It
      preserves immutability (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Item
        17</a>), so multiple clients can share dependent objects (assuming the
      clients desire the same underlying resources). Dependency injection is
      equally applicable to constructors, static factories (<a href="ch2.xhtml#lev1"
        style="text-decoration: none;">Item 1</a>), and builders (<a href="ch2.xhtml#lev2"
        style="text-decoration: none;">Item 2</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      useful variant of the pattern is to pass a resource<span class="Apple-converted-space">&nbsp;</span><em>factory</em><span
        class="Apple-converted-space">&nbsp;</span>to the constructor. A factory
      is an object that can be called repeatedly to create instances of a type.
      Such factories embody the<span class="Apple-converted-space">&nbsp;</span><em>Factory
        Method</em><span class="Apple-converted-space">&nbsp;</span>pattern [<a
        href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Supplier&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>interface, introduced in Java
      8, is perfect for representing factories. Methods that take a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Supplier&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>on input should typically
      constrain the factory’s type parameter using a<span class="Apple-converted-space">&nbsp;</span><em>bounded
        wildcard type</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev31"
        style="text-decoration: none;">Item 31</a>) to allow the client to pass
      in a factory that creates any subtype of a specified type. For example,
      here is a method that makes a mosaic using a client-provided factory to
      produce each tile:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex26a" id="pch2ex26" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Mosaic
      create(Supplier&lt;? extends Tile&gt; tileFactory) { ... }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Although
      dependency injection greatly improves flexibility and testability, it can
      clutter up large projects, which typically contain thousands of
      dependencies. This clutter can be all but eliminated by using a<span class="Apple-converted-space">&nbsp;</span><em>dependency
        injection framework</em>, such as Dagger [<a href="ref.xhtml#rDagger" style="text-decoration: none;">Dagger</a>],
      Guice [<a href="ref.xhtml#rGuice" style="text-decoration: none;">Guice</a>],
      or Spring [<a href="ref.xhtml#rSpring" style="text-decoration: none;">Spring</a>].
      The use of these frameworks is beyond the scope of this book, but note
      that APIs designed for manual dependency injection are trivially adapted
      for use by these frameworks.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, do not use a singleton or static utility class to implement a
      class that depends on one or more underlying resources whose behavior
      affects that of the class, and do not have the class create these
      resources directly. Instead, pass the resources, or factories to create
      them, into the constructor (or static factory or builder). This practice,
      known as dependency injection, will greatly enhance the flexibility,
      reusability, and testability of a class.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev6" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_22"></span><strong>Item 6: Avoid creating unnecessary objects</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is often appropriate to reuse a single object instead of creating a new
      functionally equivalent object each time it is needed. Reuse can be both
      faster and more stylish. An object can always be reused if it is immutable
      (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Item 17</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      an extreme example of what not to do, consider this statement:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex27a" id="pch2ex27" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">String
      s = new String("bikini");&nbsp;&nbsp;<strong>// DON'T DO THIS!</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      statement creates a new<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>instance
      each time it is executed, and none of those object creations is necessary.
      The argument to the<code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>constructor (<code style="font-family: 'Courier New', monospace;">"bikini"</code>)
      is itself a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>instance, functionally
      identical to all of the objects created by the constructor. If this usage
      occurs in a loop or in a frequently invoked method, millions of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>instances
      can be created needlessly.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      improved version is simply the following:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">String
      s = "bikini";</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      version uses a single<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>instance,
      rather than creating a new one each time it is executed. Furthermore, it
      is guaranteed that the object will be reused by any other code running in
      the same virtual machine that happens to contain the same string literal
      [JLS, 3.10.5].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can often avoid creating unnecessary objects by using<span class="Apple-converted-space">&nbsp;</span><em>static
        factory methods</em><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch2.xhtml#lev1" style="text-decoration: none;">Item 1</a>) in
      preference to constructors on immutable classes that provide both. For
      example, the factory method<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Boolean.valueOf(String)</code><span
        class="Apple-converted-space">&nbsp;</span>is preferable to the
      constructor<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Boolean(String)</code>,
      which was deprecated in Java 9. The constructor<span class="Apple-converted-space">&nbsp;</span><em>must</em><span
        class="Apple-converted-space">&nbsp;</span>create a new object each time
      it’s called, while the factory method is never required to do so and won’t
      in practice. In addition to reusing immutable objects, you can also reuse
      mutable objects if you know they won’t be modified.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Some
      object creations are much more expensive than others. If you’re going to
      need such an “expensive object” repeatedly, it may be advisable to cache
      it for reuse. Unfortunately, it’s not always obvious when you’re creating
      such an object. Suppose you want to write a method to determine whether a
      string is a valid Roman numeral. Here’s the easiest way to do this using a
      regular expression:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex28a" id="pch2ex28" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Performance can be greatly improved!</strong><br>
      static boolean isRomanNumeral(String s) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return s.matches("^(?=.)M*(C[MD]|D?C{0,3})"<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+
      "(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$");<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_23"></span>The problem with this
      implementation is that it relies on the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String.matches</code><span
        class="Apple-converted-space">&nbsp;</span>method.<span class="Apple-converted-space">&nbsp;</span><strong>While</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>String.matches</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>is the easiest way to
        check if a string matches a regular expression, it’s not suitable for
        repeated use in performance-critical situations.</strong><span class="Apple-converted-space">&nbsp;</span>The
      problem is that it internally creates a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Pattern</code><span class="Apple-converted-space">&nbsp;</span>instance
      for the regular expression and uses it only once, after which it becomes
      eligible for garbage collection. Creating a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Pattern</code><span class="Apple-converted-space">&nbsp;</span>instance
      is expensive because it requires compiling the regular expression into a
      finite state machine.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      improve the performance, explicitly compile the regular expression into a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Pattern</code><span
        class="Apple-converted-space">&nbsp;</span>instance (which is immutable)
      as part of class initialization, cache it, and reuse the same instance for
      every invocation of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">isRomanNumeral</code><span
        class="Apple-converted-space">&nbsp;</span>method:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex29a" id="pch2ex29" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Reusing expensive object for improved performance</strong><br>
      public class RomanNumerals {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final Pattern ROMAN =
      Pattern.compile(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"^(?=.)M*(C[MD]|D?C{0,3})"<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+
      "(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$");<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;static boolean isRomanNumeral(String s) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      ROMAN.matcher(s).matches();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      improved version of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">isRomanNumeral</code><span
        class="Apple-converted-space">&nbsp;</span>provides significant
      performance gains if invoked frequently. On my machine, the original
      version takes 1.1 µs on an 8-character input string, while the improved
      version takes 0.17 µs, which is 6.5 times faster. Not only is the
      performance improved, but arguably, so is clarity. Making a static final
      field for the otherwise invisible<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Pattern</code><span class="Apple-converted-space">&nbsp;</span>instance
      allows us to give it a name, which is far more readable than the regular
      expression itself.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      the class containing the improved version of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">isRomanNumeral</code><span
        class="Apple-converted-space">&nbsp;</span>method is initialized but the
      method is never invoked, the field<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ROMAN</code><span class="Apple-converted-space">&nbsp;</span>will
      be initialized needlessly. It would be possible to eliminate the
      initialization by<span class="Apple-converted-space">&nbsp;</span><em>lazily
        initializing</em><span class="Apple-converted-space">&nbsp;</span>the
      field (<a href="ch11.xhtml#lev83" style="text-decoration: none;">Item 83</a>)
      the first time the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">isRomanNumeral</code>method
      is invoked, but this is<span class="Apple-converted-space">&nbsp;</span><em>not</em><span
        class="Apple-converted-space">&nbsp;</span>recommended. As is often the
      case with lazy initialization, it would complicate the implementation with
      no measurable performance improvement (<a href="ch9.xhtml#lev67" style="text-decoration: none;">Item
        67</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      an object is immutable, it is obvious it can be reused safely, but there
      are other situations where it is far less obvious, even counterintuitive.
      Consider the case of<span class="Apple-converted-space">&nbsp;</span><em>adapters</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>]<em>,</em><span class="Apple-converted-space">&nbsp;</span>also
      known as<span class="Apple-converted-space">&nbsp;</span><em>views</em>.
      An adapter is an object that delegates to a backing object, providing an
      alternative interface. Because an adapter has no state beyond that of its
      backing object, there’s no need to create more than one instance of a
      given adapter to a given object.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_24"></span>For example, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">keySet</code><span class="Apple-converted-space">&nbsp;</span>method
      of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code><span
        class="Apple-converted-space">&nbsp;</span>interface returns a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>view
      of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code><span
        class="Apple-converted-space">&nbsp;</span>object, consisting of all the
      keys in the map. Naively, it would seem that every call to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">keySet</code><span class="Apple-converted-space">&nbsp;</span>would
      have to create a new<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>instance,
      but every call to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">keySet</code><span
        class="Apple-converted-space">&nbsp;</span>on a given<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>object
      may return the same<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>instance.
      Although the returned<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>instance
      is typically mutable, all of the returned objects are functionally
      identical: when one of the returned objects changes, so do all the others,
      because they’re all backed by the same<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>instance.
      While it is largely harmless to create multiple instances of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">keySet</code><span class="Apple-converted-space">&nbsp;</span>view
      object, it is unnecessary and has no benefits.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Another
      way to create unnecessary objects is<span class="Apple-converted-space">&nbsp;</span><em>autoboxing</em>,
      which allows the programmer to mix primitive and boxed primitive types,
      boxing and unboxing automatically as needed.<span class="Apple-converted-space">&nbsp;</span><strong>Autoboxing
        blurs but does not erase the distinction between primitive and boxed
        primitive types.</strong>There are subtle semantic distinctions and
      not-so-subtle performance differences (<a href="ch9.xhtml#lev61" style="text-decoration: none;">Item
        61</a>). Consider the following method, which calculates the sum of all
      the positive<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space">&nbsp;</span>values. To do this, the
      program has to use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">long</code><span
        class="Apple-converted-space">&nbsp;</span>arithmetic because an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>is
      not big enough to hold the sum of all the positive<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>values:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex30a" id="pch2ex30" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Hideously slow! Can you spot the object creation?</strong><br>
      private static long sum() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Long sum = 0L;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (long i = 0; i &lt;= Integer.MAX_VALUE; i++)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum += i;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;return sum;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      program gets the right answer, but it is<span class="Apple-converted-space">&nbsp;</span><em>much</em><span
        class="Apple-converted-space">&nbsp;</span>slower than it should be, due
      to a one-character typographical error. The variable<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">sum</code><span class="Apple-converted-space">&nbsp;</span>is
      declared as a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Long</code><span
        class="Apple-converted-space">&nbsp;</span>instead of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">long</code>, which means
      that the program constructs about 2<sup>31</sup><span class="Apple-converted-space">&nbsp;</span>unnecessary<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Long</code><span
        class="Apple-converted-space">&nbsp;</span>instances (roughly one for
      each time the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">long
        i</code><span class="Apple-converted-space">&nbsp;</span>is added to the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Long
        sum</code>). Changing the declaration of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">sum</code><span class="Apple-converted-space">&nbsp;</span>from<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Long</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">long</code><span class="Apple-converted-space">&nbsp;</span>reduces
      the runtime from 6.3 seconds to 0.59 seconds on my machine. The lesson is
      clear:<span class="Apple-converted-space">&nbsp;</span><strong>prefer
        primitives to boxed primitives, and watch out for unintentional
        autoboxing.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      item should not be misconstrued to imply that object creation is expensive
      and should be avoided. On the contrary, the creation and reclamation of
      small objects whose constructors do little explicit work is cheap,
      especially on modern JVM implementations. Creating additional objects to
      enhance the clarity, simplicity, or power of a program is generally a good
      thing.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Conversely,
      avoiding object creation by maintaining your own<span class="Apple-converted-space">&nbsp;</span><em>object
        pool</em><span class="Apple-converted-space">&nbsp;</span>is a bad idea
      unless the objects in the pool are extremely heavyweight. The classic<span
        class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak" id="page_25"></span>example
      of an object that<span class="Apple-converted-space">&nbsp;</span><em>does</em><span
        class="Apple-converted-space">&nbsp;</span>justify an object pool is a
      database connection. The cost of establishing the connection is
      sufficiently high that it makes sense to reuse these objects. Generally
      speaking, however, maintaining your own object pools clutters your code,
      increases memory footprint, and harms performance. Modern JVM
      implementations have highly optimized garbage collectors that easily
      outperform such object pools on lightweight objects.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      counterpoint to this item is<span class="Apple-converted-space">&nbsp;</span><a
        href="ch8.xhtml#lev50" style="text-decoration: none;">Item 50</a><span class="Apple-converted-space">&nbsp;</span>on<span
        class="Apple-converted-space">&nbsp;</span><em>defensive copying</em>.
      The present item says, “Don’t create a new object when you should reuse an
      existing one,” while<span class="Apple-converted-space">&nbsp;</span><a href="ch8.xhtml#lev50"
        style="text-decoration: none;">Item 50</a><span class="Apple-converted-space">&nbsp;</span>says,
      “Don’t reuse an existing object when you should create a new one.” Note
      that the penalty for reusing an object when defensive copying is called
      for is far greater than the penalty for needlessly creating a duplicate
      object. Failing to make defensive copies where required can lead to
      insidious bugs and security holes; creating objects unnecessarily merely
      affects style and performance.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev7" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_26"></span><strong>Item 7: Eliminate obsolete object references</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you switched from a language with manual memory management, such as C or
      C++, to a garbage-collected language such as Java, your job as a
      programmer was made much easier by the fact that your objects are
      automatically reclaimed when you’re through with them. It seems almost
      like magic when you first experience it. It can easily lead to the
      impression that you don’t have to think about memory management, but this
      isn’t quite true.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Consider
      the following simple stack implementation:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex31a" id="pch2ex31" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Can you spot the "memory leak"?</strong><br>
      public class Stack {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Object[] elements;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int size = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int DEFAULT_INITIAL_CAPACITY
      = 16;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements = new
      Object[DEFAULT_INITIAL_CAPACITY];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(Object e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensureCapacity();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size++] = e;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Object pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
      &nbsp;&nbsp;&nbsp;&nbsp; * Ensure space for at least one more element,
      roughly<br>
      &nbsp;&nbsp;&nbsp;&nbsp; * doubling the capacity each time the array needs
      to grow.<br>
      &nbsp;&nbsp;&nbsp;&nbsp; */<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private void ensureCapacity() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (elements.length ==
      size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements
      = Arrays.copyOf(elements, 2 * size + 1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There’s
      nothing obviously wrong with this program (but see<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev29" style="text-decoration: none;">Item 29</a><span class="Apple-converted-space">&nbsp;</span>for
      a generic version). You could test it exhaustively, and it would pass
      every test with flying colors, but there’s a problem lurking. Loosely
      speaking, the program has a “memory leak,” which can silently manifest
      itself as reduced performance due to<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_27"></span>increased garbage collector
      activity or increased memory footprint. In extreme cases, such memory
      leaks can cause disk paging and even program failure with an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">OutOfMemoryError</code>,
      but such failures are relatively rare.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      where is the memory leak? If a stack grows and then shrinks, the objects
      that were popped off the stack will not be garbage collected, even if the
      program using the stack has no more references to them. This is because
      the stack maintains<span class="Apple-converted-space">&nbsp;</span><em>obsolete
        references</em><span class="Apple-converted-space">&nbsp;</span>to these
      objects. An obsolete reference is simply a reference that will never be
      dereferenced again. In this case, any references outside of the “active
      portion” of the element array are obsolete. The active portion consists of
      the elements whose index is less than<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">size</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Memory
      leaks in garbage-collected languages (more properly known as<span class="Apple-converted-space">&nbsp;</span><em>unintentional
        object retentions</em>) are insidious. If an object reference is
      unintentionally retained, not only is that object excluded from garbage
      collection, but so too are any objects referenced by that object, and so
      on. Even if only a few object references are unintentionally retained,
      many, many objects may be prevented from being garbage collected, with
      potentially large effects on performance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      fix for this sort of problem is simple: null out references once they
      become obsolete. In the case of our<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>class,
      the reference to an item becomes obsolete as soon as it’s popped off the
      stack. The corrected version of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pop</code><span class="Apple-converted-space">&nbsp;</span>method
      looks like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex32a" id="pch2ex32" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      Object pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Object result = elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>elements[size] = null; // Eliminate
        obsolete reference</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">An
      added benefit of nulling out obsolete references is that if they are
      subsequently dereferenced by mistake, the program will immediately fail
      with a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">NullPointerException</code>,
      rather than quietly doing the wrong thing. It is always beneficial to
      detect programming errors as quickly as possible.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      programmers are first stung by this problem, they may overcompensate by
      nulling out every object reference as soon as the program is finished
      using it. This is neither necessary nor desirable; it clutters up the
      program unnecessarily.<span class="Apple-converted-space">&nbsp;</span><strong>Nulling
        out object references should be the exception rather than the norm.</strong><span
        class="Apple-converted-space">&nbsp;</span>The best way to eliminate an
      obsolete reference is to let the variable that contained the reference
      fall out of scope. This occurs naturally if you define each variable in
      the narrowest possible scope (<a href="ch9.xhtml#lev57" style="text-decoration: none;">Item
        57</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_28"></span>So when should you null out a
      reference? What aspect of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>class
      makes it susceptible to memory leaks? Simply put, it<span class="Apple-converted-space">&nbsp;</span><em>manages
        its own memory</em>. The<span class="Apple-converted-space">&nbsp;</span><em>storage
        pool</em><span class="Apple-converted-space">&nbsp;</span>consists of
      the elements of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">elements</code><span class="Apple-converted-space">&nbsp;</span>array
      (the object reference cells, not the objects themselves). The elements in
      the active portion of the array (as defined earlier) are<span class="Apple-converted-space">&nbsp;</span><em>allocated</em>,
      and those in the remainder of the array are<span class="Apple-converted-space">&nbsp;</span><em>free</em>.
      The garbage collector has no way of knowing this; to the garbage
      collector, all of the object references in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">elements</code><span class="Apple-converted-space">&nbsp;</span>array
      are equally valid. Only the programmer knows that the inactive portion of
      the array is unimportant. The programmer effectively communicates this
      fact to the garbage collector by manually nulling out array elements as
      soon as they become part of the inactive portion.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Generally
      speaking,<span class="Apple-converted-space">&nbsp;</span><strong>whenever
        a class manages its own memory, the programmer should be alert for
        memory leaks</strong>. Whenever an element is freed, any object
      references contained in the element should be nulled out.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Another
        common source of memory leaks is caches.</strong><span class="Apple-converted-space">&nbsp;</span>Once
      you put an object reference into a cache, it’s easy to forget that it’s
      there and leave it in the cache long after it becomes irrelevant. There
      are several solutions to this problem. If you’re lucky enough to implement
      a cache for which an entry is relevant exactly so long as there are
      references to its key outside of the cache, represent the cache as a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">WeakHashMap</code>;
      entries will be removed automatically after they become obsolete. Remember
      that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">WeakHashMap</code><span
        class="Apple-converted-space">&nbsp;</span>is useful only if the desired
      lifetime of cache entries is determined by external references to the key,
      not the value.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">More
      commonly, the useful lifetime of a cache entry is less well defined, with
      entries becoming less valuable over time. Under these circumstances, the
      cache should occasionally be cleansed of entries that have fallen into
      disuse. This can be done by a background thread (perhaps a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ScheduledThreadPoolExecutor</code>)
      or as a side effect of adding new entries to the cache. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">LinkedHashMap</code><span
        class="Apple-converted-space">&nbsp;</span>class facilitates the latter
      approach with its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">removeEldestEntry</code><span
        class="Apple-converted-space">&nbsp;</span>method. For more
      sophisticated caches, you may need to use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.lang.ref</code><span
        class="Apple-converted-space">&nbsp;</span>directly.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>A
        third common source of memory leaks is listeners and other callbacks.</strong><span
        class="Apple-converted-space">&nbsp;</span>If you implement an API where
      clients register callbacks but don’t deregister them explicitly, they will
      accumulate unless you take some action. One way to ensure that callbacks
      are garbage collected promptly is to store only<span class="Apple-converted-space">&nbsp;</span><em>weak
        references</em><span class="Apple-converted-space">&nbsp;</span>to them,
      for instance, by storing them only as keys in a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">WeakHashMap</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      memory leaks typically do not manifest themselves as obvious failures,
      they may remain present in a system for years. They are typically
      discovered only as a result of careful code inspection or with the aid of
      a debugging tool known as a<span class="Apple-converted-space">&nbsp;</span><em>heap
        profiler</em>. Therefore, it is very desirable to learn to anticipate
      problems like this before they occur and prevent them from happening.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev8" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_29"></span><strong>Item 8: Avoid finalizers and cleaners</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Finalizers
        are unpredictable, often dangerous, and generally unnecessary.</strong><span
        class="Apple-converted-space">&nbsp;</span>Their use can cause erratic
      behavior, poor performance, and portability problems. Finalizers have a
      few valid uses, which we’ll cover later in this item, but as a rule, you
      should avoid them. As of Java 9, finalizers have been deprecated, but they
      are still being used by the Java libraries. The Java 9 replacement for
      finalizers is<span class="Apple-converted-space">&nbsp;</span><em>cleaners</em>.<span
        class="Apple-converted-space">&nbsp;</span><strong>Cleaners are less
        dangerous than finalizers, but still unpredictable, slow, and generally
        unnecessary.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">C++
      programmers are cautioned not to think of finalizers or cleaners as Java’s
      analogue of C++ destructors. In C++, destructors are the normal way to
      reclaim the resources associated with an object, a necessary counterpart
      to constructors. In Java, the garbage collector reclaims the storage
      associated with an object when it becomes unreachable, requiring no
      special effort on the part of the programmer. C++ destructors are also
      used to reclaim other nonmemory resources. In Java, a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources
      or<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">try</code>-<code
        style="font-family: 'Courier New', monospace;">finally</code><span class="Apple-converted-space">&nbsp;</span>block
      is used for this purpose (<a href="ch2.xhtml#lev9" style="text-decoration: none;">Item
        9</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      shortcoming of finalizers and cleaners is that there is no guarantee
      they’ll be executed promptly [JLS, 12.6]. It can take arbitrarily long
      between the time that an object becomes unreachable and the time its
      finalizer or cleaner runs. This means that you should<span class="Apple-converted-space">&nbsp;</span><strong>never
        do anything time-critical in a finalizer or cleaner.</strong><span class="Apple-converted-space">&nbsp;</span>For
      example, it is a grave error to depend on a finalizer or cleaner to close
      files because open file descriptors are a limited resource. If many files
      are left open as a result of the system’s tardiness in running finalizers
      or cleaners, a program may fail because it can no longer open files.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      promptness with which finalizers and cleaners are executed is primarily a
      function of the garbage collection algorithm, which varies widely across
      implementations. The behavior of a program that depends on the promptness
      of finalizer or cleaner execution may likewise vary. It is entirely
      possible that such a program will run perfectly on the JVM on which you
      test it and then fail miserably on the one favored by your most important
      customer.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Tardy
      finalization is not just a theoretical problem. Providing a finalizer for
      a class can arbitrarily delay reclamation of its instances. A colleague
      debugged a long-running GUI application that was mysteriously dying with
      an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">OutOfMemoryError</code>.
      Analysis revealed that at the time of its death, the application had
      thousands of graphics objects on its finalizer queue just waiting to be
      finalized and reclaimed. Unfortunately, the finalizer thread was running
      at a lower priority than another application thread, so objects weren’t
      getting finalized at the rate they became eligible for finalization. The
      language specification makes no guarantees<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_30"></span>as to which thread will
      execute finalizers, so there is no portable way to prevent this sort of
      problem other than to refrain from using finalizers. Cleaners are a bit
      better than finalizers in this regard because class authors have control
      over their own cleaner threads, but cleaners still run in the background,
      under the control of the garbage collector, so there can be no guarantee
      of prompt cleaning.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Not
      only does the specification provide no guarantee that finalizers or
      cleaners will run promptly; it provides no guarantee that they’ll run at
      all. It is entirely possible, even likely, that a program terminates
      without running them on some objects that are no longer reachable. As a
      consequence, you should<span class="Apple-converted-space">&nbsp;</span><strong>never
        depend on a finalizer or cleaner to update persistent state.</strong><span
        class="Apple-converted-space">&nbsp;</span>For example, depending on a
      finalizer or cleaner to release a persistent lock on a shared resource
      such as a database is a good way to bring your entire distributed system
      to a grinding halt.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Don’t
      be seduced by the methods<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">System.gc</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">System.runFinalization</code>.
      They may increase the odds of finalizers or cleaners getting executed, but
      they don’t guarantee it. Two methods once claimed to make this guarantee:<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">System.runFinalizersOnExit</code><span
        class="Apple-converted-space">&nbsp;</span>and its evil twin,<code style="font-family: 'Courier New', monospace;">Runtime.runFinalizersOnExit</code>.
      These methods are fatally flawed and have been deprecated for decades [<a
        href="ref.xhtml#rThreadStop" style="text-decoration: none;">ThreadStop</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Another
      problem with finalizers is that an uncaught exception thrown during
      finalization is ignored, and finalization of that object terminates [JLS,
      12.6]. Uncaught exceptions can leave other objects in a corrupt state. If
      another thread attempts to use such a corrupted object, arbitrary
      nondeterministic behavior may result. Normally, an uncaught exception will
      terminate the thread and print a stack trace, but not if it occurs in a
      finalizer—it won’t even print a warning. Cleaners do not have this problem
      because a library using a cleaner has control over its thread.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>There
        is a</strong><span class="Apple-converted-space">&nbsp;</span><em><strong>severe</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>performance penalty
        for using finalizers and cleaners.</strong><span class="Apple-converted-space">&nbsp;</span>On
      my machine, the time to create a simple<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">AutoCloseable</code>object,
      to close it using<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">try</code>-with-resources,
      and to have the garbage collector reclaim it is about 12 ns. Using a
      finalizer instead increases the time to 550 ns. In other words, it is
      about 50 times slower to create and destroy objects with finalizers. This
      is primarily because finalizers inhibit efficient garbage collection.
      Cleaners are comparable in speed to finalizers if you use them to clean
      all instances of the class (about 500 ns per instance on my machine), but
      cleaners are much faster if you use them only as a safety net, as
      discussed below. Under these circumstances, creating, cleaning, and
      destroying an object takes about 66 ns on my machine, which means you pay
      a factor of five (not fifty) for the insurance of a safety net<span class="Apple-converted-space">&nbsp;</span><em>if</em><span
        class="Apple-converted-space">&nbsp;</span>you don’t use it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Finalizers
        have a serious security problem: they open your class up to</strong><span
        class="Apple-converted-space">&nbsp;</span><em><strong>finalizer attacks</strong></em><strong>.</strong><span
        class="Apple-converted-space">&nbsp;</span>The idea behind a finalizer
      attack is simple: If an exception is<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_31"></span>thrown from a constructor or
      its serialization equivalents—the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">readObject</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readResolve</code><span
        class="Apple-converted-space">&nbsp;</span>methods (<a href="ch12.xhtml#ch12"
        style="text-decoration: none;">Chapter 12</a>)—the finalizer of a
      malicious subclass can run on the partially constructed object that should
      have “died on the vine.” This finalizer can record a reference to the
      object in a static field, preventing it from being garbage collected. Once
      the malformed object has been recorded, it is a simple matter to invoke
      arbitrary methods on this object that should never have been allowed to
      exist in the first place.<span class="Apple-converted-space">&nbsp;</span><strong>Throwing
        an exception from a constructor should be sufficient to prevent an
        object from coming into existence; in the presence of finalizers, it is
        not.</strong><span class="Apple-converted-space">&nbsp;</span>Such
      attacks can have dire consequences. Final classes are immune to finalizer
      attacks because no one can write a malicious subclass of a final class.<span
        class="Apple-converted-space">&nbsp;</span><strong>To protect nonfinal
        classes from finalizer attacks, write a final</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>finalize</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>method that does
        nothing.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      what should you do instead of writing a finalizer or cleaner for a class
      whose objects encapsulate resources that require termination, such as
      files or threads? Just<span class="Apple-converted-space">&nbsp;</span><strong>have
        your class implement</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>AutoCloseable</strong></code><strong>,</strong><span
        class="Apple-converted-space">&nbsp;</span>and require its clients to
      invoke the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">close</code><span
        class="Apple-converted-space">&nbsp;</span>method on each instance when
      it is no longer needed, typically using<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources
      to ensure termination even in the face of exceptions (<a href="ch2.xhtml#lev9"
        style="text-decoration: none;">Item 9</a>). One detail worth mentioning
      is that the instance must keep track of whether it has been closed: the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">close</code><span
        class="Apple-converted-space">&nbsp;</span>method must record in a field
      that the object is no longer valid, and other methods must check this
      field and throw an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">IllegalStateException</code><span
        class="Apple-converted-space">&nbsp;</span>if they are called after the
      object has been closed.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      what, if anything, are cleaners and finalizers good for? They have perhaps
      two legitimate uses. One is to act as a safety net in case the owner of a
      resource neglects to call its<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">close</code><span class="Apple-converted-space">&nbsp;</span>method.
      While there’s no guarantee that the cleaner or finalizer will run promptly
      (or at all), it is better to free the resource late than never if the
      client fails to do so. If you’re considering writing such a safety-net
      finalizer, think long and hard about whether the protection is worth the
      cost. Some Java library classes, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">FileInputStream</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">FileOutputStream</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ThreadPoolExecutor</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.sql.Connection</code>,
      have finalizers that serve as safety nets.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      second legitimate use of cleaners concerns objects with<span class="Apple-converted-space">&nbsp;</span><em>native
        peers</em>. A native peer is a native (non-Java) object to which a
      normal object delegates via native methods. Because a native peer is not a
      normal object, the garbage collector doesn’t know about it and can’t
      reclaim it when its Java peer is reclaimed. A cleaner or finalizer may be
      an appropriate vehicle for this task, assuming the performance is
      acceptable and the native peer holds no critical resources. If the
      performance is unacceptable or the native peer holds resources that must
      be reclaimed promptly, the class should have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">close</code><span class="Apple-converted-space">&nbsp;</span>method,
      as described earlier.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_32"></span>Cleaners are a bit tricky to
      use. Below is a simple<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Room</code><span class="Apple-converted-space">&nbsp;</span>class
      demonstrating the facility. Let’s assume that rooms must be cleaned before
      they are reclaimed. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Room</code><span class="Apple-converted-space">&nbsp;</span>class
      implements<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AutoCloseable</code>;
      the fact that its automatic cleaning safety net uses a cleaner is merely
      an implementation detail. Unlike finalizers, cleaners do not pollute a
      class’s public API:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex33a" id="pch2ex33" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        An autocloseable class using a cleaner as a safety net</strong><br>
      public class Room implements AutoCloseable {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final Cleaner cleaner =
      Cleaner.create();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Resource that requires cleaning.<span class="Apple-converted-space">&nbsp;</span><strong>Must
        not refer to Room!</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static class State implements Runnable {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int numJunkPiles; //
      Number of junk piles in this room<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;State(int numJunkPiles) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.numJunkPiles
      = numJunkPiles;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Invoked by close method<span
        class="Apple-converted-space">&nbsp;</span><em>or</em><span class="Apple-converted-space">&nbsp;</span>cleaner<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public void
      run() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Cleaning
      room");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numJunkPiles
      = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// The state of this room, shared with our
      cleanable<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final State state;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Our cleanable. Cleans the room when it’s
      eligible for gc<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Cleaner.Cleanable cleanable;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Room(int numJunkPiles) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state = new
      State(numJunkPiles);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cleanable =
      cleaner.register(this, state);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public void close() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cleanable.clean();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      static nested<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">State</code><span
        class="Apple-converted-space">&nbsp;</span>class holds the resources
      that are required by the cleaner to clean the room. In this case, it is
      simply the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">numJunkPiles</code>field,
      which represents the amount of mess in the room. More realistically, it
      might be a final<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">long</code><span
        class="Apple-converted-space">&nbsp;</span>that contains a pointer to a
      native peer.<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">State</code>implements<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Runnable</code>,
      and its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">run</code><span
        class="Apple-converted-space">&nbsp;</span>method is called at most
      once, by the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cleanable</code><span
        class="Apple-converted-space">&nbsp;</span>that we get when we register
      our<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">State</code><span
        class="Apple-converted-space">&nbsp;</span>instance with our cleaner in
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Room</code><span
        class="Apple-converted-space">&nbsp;</span>constructor. The call to the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">run</code><span
        class="Apple-converted-space">&nbsp;</span>method will be triggered by
      one of two things: Usually it is triggered by a call to<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_33"></span><code style="font-family: 'Courier New', monospace;">Room</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">close</code>method
      calling<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cleanable</code>’s
      clean method. If the client fails to call the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">close</code><span class="Apple-converted-space">&nbsp;</span>method
      by the time a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Room</code><span
        class="Apple-converted-space">&nbsp;</span>instance is eligible for
      garbage collection, the cleaner will (hopefully) call<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">State</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">run</code><span class="Apple-converted-space">&nbsp;</span>method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is critical that a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">State</code><span
        class="Apple-converted-space">&nbsp;</span>instance does not refer to
      its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Room</code><span
        class="Apple-converted-space">&nbsp;</span>instance. If it did, it would
      create a circularity that would prevent the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Room</code><span class="Apple-converted-space">&nbsp;</span>instance
      from becoming eligible for garbage collection (and from being
      automatically cleaned). Therefore,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">State</code><span class="Apple-converted-space">&nbsp;</span>must
      be a<span class="Apple-converted-space">&nbsp;</span><em>static</em><span
        class="Apple-converted-space">&nbsp;</span>nested class because
      nonstatic nested classes contain references to their enclosing instances (<a
        href="ch4.xhtml#lev24" style="text-decoration: none;">Item 24</a>). It
      is similarly inadvisable to use a lambda because they can easily capture
      references to enclosing objects.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      we said earlier,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Room</code>’s
      cleaner is used only as a safety net. If clients surround all<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Room</code><span class="Apple-converted-space">&nbsp;</span>instantiations
      in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">try</code>-with-resource
      blocks, automatic cleaning will never be required. This well-behaved
      client demonstrates that behavior:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex34a" id="pch2ex34" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Adult {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try (Room myRoom = new
      Room(7)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Goodbye");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      you’d expect, running the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Adult</code><span class="Apple-converted-space">&nbsp;</span>program
      prints<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Goodbye</code>,
      followed by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cleaning
        room</code>. But what about this ill-behaved program, which never cleans
      its room?</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex35a" id="pch2ex35" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Teenager {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Room(99);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Peace
      out");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      might expect it to print<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Peace out</code>,
      followed by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cleaning
        room</code>, but on my machine, it never prints<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cleaning room</code>; it
      just exits. This is the unpredictability we spoke of earlier. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cleaner</code><span class="Apple-converted-space">&nbsp;</span>spec
      says, “The behavior of cleaners during<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">System.exit</code><span class="Apple-converted-space">&nbsp;</span>is
      implementation specific. No guarantees are made relating to whether
      cleaning actions are invoked or not.” While the spec does not say it, the
      same holds true for normal program exit. On my machine, adding the line<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">System.gc()</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Teenager</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">main</code><span class="Apple-converted-space">&nbsp;</span>method
      is enough to make it print<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cleaning room</code><span
        class="Apple-converted-space">&nbsp;</span>prior to exit, but there’s no
      guarantee that you’ll see the same behavior on your machine.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, don’t use cleaners, or in releases prior to Java 9, finalizers,
      except as a safety net or to terminate noncritical native resources. Even
      then, beware the indeterminacy and performance consequences.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev9" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_34"></span><strong>Item 9: Prefer</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>try</strong></code><strong>-with-resources
        to</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>try</strong></code><strong>-</strong><code
        style="font-family: 'Courier New', monospace;"><strong>finally</strong></code></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      Java libraries include many resources that must be closed manually by
      invoking a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">close</code><span
        class="Apple-converted-space">&nbsp;</span>method. Examples include<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">InputStream</code>,<code
        style="font-family: 'Courier New', monospace;">OutputStream</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.sql.Connection</code>.
      Closing resources is often overlooked by clients, with predictably dire
      performance consequences. While many of these resources use finalizers as
      a safety net, finalizers don’t work very well (<a href="ch2.xhtml#lev8" style="text-decoration: none;">Item
        8</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Historically,
      a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">try</code>-<code
        style="font-family: 'Courier New', monospace;">finally</code><span class="Apple-converted-space">&nbsp;</span>statement
      was the best way to guarantee that a resource would be closed properly,
      even in the face of an exception or return:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex36a" id="pch2ex36" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-finally - No longer the best way to close resources!</strong><br>
      static String firstLineOfFile(String path) throws IOException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;BufferedReader br = new BufferedReader(new
      FileReader(path));<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return br.readLine();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} finally {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;br.close();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      may not look bad, but it gets worse when you add a second resource:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex37a" id="pch2ex37" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-finally is ugly when used with more than one resource!</strong><br>
      static void copy(String src, String dst) throws IOException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;InputStream in = new FileInputStream(src);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputStream out = new
      FileOutputStream(dst);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]
      buf = new byte[BUFFER_SIZE];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      n;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while
      ((n = in.read(buf)) &gt;= 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.write(buf,
      0, n);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} finally {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.close();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} finally {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in.close();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      may be hard to believe, but even good programmers got this wrong most of
      the time. For starters, I got it wrong on page 88 of<span class="Apple-converted-space">&nbsp;</span><em>Java
        Puzzlers</em>[<a href="ref.xhtml#rBloch05" style="text-decoration: none;">Bloch05</a>],
      and no one noticed for years. In fact, two-thirds of the uses of the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">close</code><span
        class="Apple-converted-space">&nbsp;</span>method in the Java libraries
      were wrong in 2007.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_35"></span>Even the correct code for
      closing resources with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-<code style="font-family: 'Courier New', monospace;">finally</code><span
        class="Apple-converted-space">&nbsp;</span>statements, as illustrated in
      the previous two code examples, has a subtle deficiency. The code in both
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">try</code><span
        class="Apple-converted-space">&nbsp;</span>block and the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">finally</code><span class="Apple-converted-space">&nbsp;</span>block
      is capable of throwing exceptions. For example, in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">firstLineOfFile</code>method,
      the call to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readLine</code><span
        class="Apple-converted-space">&nbsp;</span>could throw an exception due
      to a failure in the underlying physical device, and the call to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">close</code><span class="Apple-converted-space">&nbsp;</span>could
      then fail for the same reason. Under these circumstances, the second
      exception completely obliterates the first one. There is no record of the
      first exception in the exception stack trace, which can greatly complicate
      debugging in real systems—usually it’s the first exception that you want
      to see in order to diagnose the problem. While it is possible to write
      code to suppress the second exception in favor of the first, virtually no
      one did because it’s just too verbose.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">All
      of these problems were solved in one fell swoop when Java 7 introduced the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">try</code>-with-resources
      statement [JLS, 14.20.3]. To be usable with this construct, a resource
      must implement the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AutoCloseable</code><span
        class="Apple-converted-space">&nbsp;</span>interface, which consists of
      a single<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">void</code>-returning<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">close</code><span
        class="Apple-converted-space">&nbsp;</span>method. Many classes and
      interfaces in the Java libraries and in third-party libraries now
      implement or extend<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">AutoCloseable</code>. If
      you write a class that represents a resource that must be closed, your
      class should implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">AutoCloseable</code><span
        class="Apple-converted-space">&nbsp;</span>too.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here’s
      how our first example looks using<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex38a" id="pch2ex38" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-with-resources - the the best way to close resources!</strong><br>
      static String firstLineOfFile(String path) throws IOException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try (BufferedReader br = new BufferedReader(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new
      FileReader(path))) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return br.readLine();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">And
      here’s how our second example looks using<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex39a" id="pch2ex39" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-with-resources on multiple resources - short and sweet</strong><br>
      static void copy(String src, String dst) throws IOException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try (InputStream&nbsp;&nbsp;&nbsp;in = new
      FileInputStream(src);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OutputStream out = new
      FileOutputStream(dst)) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[] buf = new
      byte[BUFFER_SIZE];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int n;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ((n = in.read(buf))
      &gt;= 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.write(buf,
      0, n);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Not
      only are the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">try</code>-with-resources
      versions shorter and more readable than the originals, but they provide
      far better diagnostics. Consider the<code style="font-family: 'Courier New', monospace;">firstLineOfFile</code><span
        class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak" id="page_36"></span>method.
      If exceptions are thrown by both the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">readLine</code><span class="Apple-converted-space">&nbsp;</span>call
      and the (invisible)<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">close</code>, the latter
      exception is<span class="Apple-converted-space">&nbsp;</span><em>suppressed</em><span
        class="Apple-converted-space">&nbsp;</span>in favor of the former. In
      fact, multiple exceptions may be suppressed in order to preserve the
      exception that you actually want to see. These suppressed exceptions are
      not merely discarded; they are printed in the stack trace with a notation
      saying that they were suppressed. You can also access them
      programmatically with the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getSuppressed</code><span
        class="Apple-converted-space">&nbsp;</span>method, which was added to<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Throwable</code><span
        class="Apple-converted-space">&nbsp;</span>in Java 7.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can put catch clauses on<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources
      statements, just as you can on regular<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-<code style="font-family: 'Courier New', monospace;">finally</code><span
        class="Apple-converted-space">&nbsp;</span>statements. This allows you
      to handle exceptions without sullying your code with another layer of
      nesting. As a slightly contrived example, here’s a version our<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">firstLineOfFile</code>method
      that does not throw exceptions, but takes a default value to return if it
      can’t open the file or read from it:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch2_images.xhtml#pch2ex40a" id="pch2ex40" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-with-resources with a catch clause</strong><br>
      static String firstLineOfFile(String path, String defaultVal) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try (BufferedReader br = new BufferedReader(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new
      FileReader(path))) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return br.readLine();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (IOException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return defaultVal;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      lesson is clear: Always use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources
      in preference to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">try-finally</code><span
        class="Apple-converted-space">&nbsp;</span>when working with resources
      that must be closed. The resulting code is shorter and clearer, and the
      exceptions that it generates are more useful. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try-</code>with-resources
      statement makes it easy to write correct code using resources that must be
      closed, which was practically impossible using<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try</code>-<code style="font-family: 'Courier New', monospace;">finally</code>.</p>
    <p> </p>
    <h2 class="h2" id="ch3" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Chapter
      3. Methods Common to All Objects</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>A</strong><small
        style="font-size: 0.7em;">LTHOUGH</small><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>is
      a concrete class, it is designed primarily for extension. All of its
      nonfinal methods (<code style="font-family: 'Courier New', monospace;">equals</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code>,
      and<code style="font-family: 'Courier New', monospace;">finalize</code>)
      have explicit<span class="Apple-converted-space">&nbsp;</span><em>general
        contracts</em><span class="Apple-converted-space">&nbsp;</span>because
      they are designed to be overridden. It is the responsibility of any class
      overriding these methods to obey their general contracts; failure to do so
      will prevent other classes that depend on the contracts (such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashMap</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code>)
      from functioning properly in conjunction with the class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      chapter tells you when and how to override the nonfinal<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods.
      The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">finalize</code><span
        class="Apple-converted-space">&nbsp;</span>method is omitted from this
      chapter because it was discussed in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch2.xhtml#lev8" style="text-decoration: none;">Item 8</a>. While
      not an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>method,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable.compareTo</code><span
        class="Apple-converted-space">&nbsp;</span>is discussed in this chapter
      because it has a similar character.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev10" style="text-decoration: none;"></a><strong>Item 10: Obey the
        general contract when overriding</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code></h3>
    <p class="noindentb" style="margin-top: 0px; margin-bottom: 15px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Overriding
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method seems simple, but
      there are many ways to get it wrong, and consequences can be dire. The
      easiest way to avoid problems is not to override the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method,
      in which case each instance of the class is equal only to itself. This is
      the right thing to do if any of the following conditions apply:</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>Each instance of the
        class is inherently unique.</strong><span class="Apple-converted-space">&nbsp;</span>This
      is true for classes such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Thread</code><span class="Apple-converted-space">&nbsp;</span>that
      represent active entities rather than values. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>implementation
      provided by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>has exactly the right
      behavior for these classes.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>There is no need for
        the class to provide a “logical equality” test.</strong><span class="Apple-converted-space">&nbsp;</span>For
      example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.regex.Pattern</code><span
        class="Apple-converted-space">&nbsp;</span>could have overridden<code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>to check whether two<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Pattern</code><span class="Apple-converted-space">&nbsp;</span>instances
      represented exactly the same regular expression, but the designers didn’t
      think that clients would need or want this functionality. Under these
      circumstances, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>implementation inherited from<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>is ideal.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_38"></span>•<span class="Apple-converted-space">&nbsp;</span><strong>A
        superclass has already overridden</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code>,<span
        class="Apple-converted-space">&nbsp;</span><strong>and the superclass
        behavior is appropriate for this class.</strong><span class="Apple-converted-space">&nbsp;</span>For
      example, most<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code>implementations
      inherit their<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>implementation from<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">AbstractSet</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code><span
        class="Apple-converted-space">&nbsp;</span>implementations from<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">AbstractList</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code>implementations
      from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractMap</code>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>The class is private
        or package-private, and you are certain that its</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>method will never be
        invoked.</strong><span class="Apple-converted-space">&nbsp;</span>If you
      are extremely risk-averse, you can override the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      to ensure that it isn’t invoked accidentally:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex1a" id="pch3ex1" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="preb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">@Override
      public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;throw new AssertionError(); // Method is never
      called<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      when is it appropriate to override<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code>? It is when
      a class has a notion of<span class="Apple-converted-space">&nbsp;</span><em>logical
        equality</em><span class="Apple-converted-space">&nbsp;</span>that
      differs from mere object identity and a superclass has not already
      overridden<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code>.
      This is generally the case for<span class="Apple-converted-space">&nbsp;</span><em>value
        classes.</em><span class="Apple-converted-space">&nbsp;</span>A value
      class is simply a class that represents a value, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code>.
      A programmer who compares references to value objects using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      expects to find out whether they are logically equivalent, not whether
      they refer to the same object. Not only is overriding the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      necessary to satisfy programmer expectations, it enables instances to
      serve as map keys or set elements with predictable, desirable behavior.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      kind of value class that does<span class="Apple-converted-space">&nbsp;</span><em>not</em><span
        class="Apple-converted-space">&nbsp;</span>require the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      to be overridden is a class that uses instance control (<a href="ch2.xhtml#lev1"
        style="text-decoration: none;">Item 1</a>) to ensure that at most one
      object exists with each value. Enum types (<a href="ch6.xhtml#lev34" style="text-decoration: none;">Item
        34</a>) fall into this category. For these classes, logical equality is
      the same as object identity, so<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      functions as a logical<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you override the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method, you must adhere to
      its general contract. Here is the contract, from the specification for<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>:</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method implements an<span class="Apple-converted-space">&nbsp;</span><em>equivalence
        relation.</em><span class="Apple-converted-space">&nbsp;</span>It has
      these properties:</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><em>Reflexive</em>: For any
      non-null reference value<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x.equals(x)</code><span class="Apple-converted-space">&nbsp;</span>must
      return<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><em>Symmetric</em>: For any
      non-null reference values<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">y</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">x.equals(y)</code><span
        class="Apple-converted-space">&nbsp;</span>must return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code><span class="Apple-converted-space">&nbsp;</span>if
      and only if<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">y.equals(x)</code><span
        class="Apple-converted-space">&nbsp;</span>returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><em>Transitive</em>: For any
      non-null reference values<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">y</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">z</code>, if<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x.equals(y)</code><span class="Apple-converted-space">&nbsp;</span>returns<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">y.equals(z)</code><span class="Apple-converted-space">&nbsp;</span>returns<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code>,
      then<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">x.equals(z)</code><span
        class="Apple-converted-space">&nbsp;</span>must return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><em>Consistent</em>: For any
      non-null reference values<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">y</code>,
      multiple invocations of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x.equals(y)</code><span class="Apple-converted-space">&nbsp;</span>must
      consistently return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code><span class="Apple-converted-space">&nbsp;</span>or
      consistently return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code>, provided no
      information used in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>comparisons
      is modified.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      For any non-null reference value<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x.equals(null)</code><span
        class="Apple-converted-space">&nbsp;</span>must return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_39"></span>Unless you are mathematically
      inclined, this might look a bit scary, but do not ignore it! If you
      violate it, you may well find that your program behaves erratically or
      crashes, and it can be very difficult to pin down the source of the
      failure. To paraphrase John Donne, no class is an island. Instances of one
      class are frequently passed to another. Many classes, including all
      collections classes, depend on the objects passed to them obeying the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>contract.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      that you are aware of the dangers of violating the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>contract,
      let’s go over the contract in detail. The good news is that, appearances
      notwithstanding, it really isn’t very complicated. Once you understand it,
      it’s not hard to adhere to it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      what is an equivalence relation? Loosely speaking, it’s an operator that
      partitions a set of elements into subsets whose elements are deemed equal
      to one another. These subsets are known as<span class="Apple-converted-space">&nbsp;</span><em>equivalence
        classes</em>. For an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      to be useful, all of the elements in each equivalence class must be
      interchangeable from the perspective of the user. Now let’s examine the
      five requirements in turn:</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Reflexivity</strong>—The
      first requirement says merely that an object must be equal to itself. It’s
      hard to imagine violating this one unintentionally. If you were to violate
      it and then add an instance of your class to a collection, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">contains</code><span class="Apple-converted-space">&nbsp;</span>method
      might well say that the collection didn’t contain the instance that you
      just added.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Symmetry</strong>—The
      second requirement says that any two objects must agree on whether they
      are equal. Unlike the first requirement, it’s not hard to imagine
      violating this one unintentionally. For example, consider the following
      class, which implements a case-insensitive string. The case of the string
      is preserved by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>but ignored in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>comparisons:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex2a" id="pch3ex2" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Broken - violates symmetry!</strong><br>
      public final class CaseInsensitiveString {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final String s;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public CaseInsensitiveString(String s) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.s =
      Objects.requireNonNull(s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// Broken - violates symmetry!</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (o instanceof
      CaseInsensitiveString)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      s.equalsIgnoreCase(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((CaseInsensitiveString)
      o).s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>if (o instanceof
        String)&nbsp;&nbsp;// One-way interoperability!</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>return
        s.equalsIgnoreCase((String) o);</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;// Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_40"></span>The well-intentioned<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      in this class naively attempts to interoperate with ordinary strings.
      Let’s suppose that we have one case-insensitive string and one ordinary
      one:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex3a" id="pch3ex3" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">CaseInsensitiveString
      cis = new CaseInsensitiveString("Polish");<br>
      String s = "polish";</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      expected,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">cis.equals(s)</code><span
        class="Apple-converted-space">&nbsp;</span>returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code>. The problem
      is that while the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space">&nbsp;</span>knows about ordinary strings,
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>is
      oblivious to case-insensitive strings. Therefore,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">s.equals(cis)</code><span
        class="Apple-converted-space">&nbsp;</span>returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code>, a clear
      violation of symmetry. Suppose you put a case-insensitive string into a
      collection:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex4a" id="pch3ex4" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">List&lt;CaseInsensitiveString&gt;
      list = new ArrayList&lt;&gt;();<br>
      list.add(cis);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">What
      does<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">list.contains(s)</code><span
        class="Apple-converted-space">&nbsp;</span>return at this point? Who
      knows? In the current OpenJDK implementation, it happens to return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code>, but that’s
      just an implementation artifact. In another implementation, it could just
      as easily return<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space">&nbsp;</span>or throw a runtime exception.<span
        class="Apple-converted-space">&nbsp;</span><strong>Once you’ve violated
        the</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>contract, you simply
        don’t know how other objects will behave when confronted with your
        object.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      eliminate the problem, merely remove the ill-conceived attempt to
      interoperate with<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>from the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method.
      Once you do this, you can refactor the method into a single return
      statement:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex5a" id="pch3ex5" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">@Override
      public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return o instanceof CaseInsensitiveString
      &amp;&amp;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((CaseInsensitiveString)
      o).s.equalsIgnoreCase(s);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Transitivity</strong>—The
      third requirement of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>contract
      says that if one object is equal to a second and the second object is
      equal to a third, then the first object must be equal to the third. Again,
      it’s not hard to imagine violating this requirement unintentionally.
      Consider the case of a subclass that adds a new<span class="Apple-converted-space">&nbsp;</span><em>value
        component</em><span class="Apple-converted-space">&nbsp;</span>to its
      superclass. In other words, the subclass adds a piece of<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_41"></span>information that affects<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code>comparisons.
      Let’s start with a simple immutable two-dimensional integer point class:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex6a" id="pch3ex6" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int y;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Point(int x, int y) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.x = x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.y = y;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof Point))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point p = (Point)o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return p.x == x &amp;&amp;
      p.y == y;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;// Remainder omitted<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      you want to extend this class, adding the notion of color to a point:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex7a" id="pch3ex7" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class ColorPoint extends Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Color color;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public ColorPoint(int x, int y, Color color) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(x, y);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.color = color;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;// Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">How
      should the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method look? If you leave it
      out entirely, the implementation is inherited from<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Point</code><span class="Apple-converted-space">&nbsp;</span>and
      color information is ignored in<code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>comparisons. While this does
      not violate the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>contract, it is clearly
      unacceptable. Suppose you write an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      that returns<code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space">&nbsp;</span>only if its argument is
      another color point with the same position and color:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex8a" id="pch3ex8" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Broken - violates symmetry!</strong><br>
      @Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof ColorPoint))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>return super.equals(o) &amp;&amp;
        ((ColorPoint) o).color == color;</strong><br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_42"></span>The problem with this method
      is that you might get different results when comparing a point to a color
      point and vice versa. The former comparison ignores color, while the
      latter comparison always returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code><span class="Apple-converted-space">&nbsp;</span>because
      the type of the argument is incorrect. To make this concrete, let’s create
      one point and one color point:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex9a" id="pch3ex9" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Point
      p = new Point(1, 2);<br>
      ColorPoint cp = new ColorPoint(1, 2, Color.RED);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Then<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">p.equals(cp)</code><span
        class="Apple-converted-space">&nbsp;</span>returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code>, while<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">cp.equals(p)</code><span
        class="Apple-converted-space">&nbsp;</span>returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code>. You might
      try to fix the problem by having<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ColorPoint.equals</code><span
        class="Apple-converted-space">&nbsp;</span>ignore color when doing
      “mixed comparisons”:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex10a" id="pch3ex10" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Broken - violates transitivity!</strong><br>
      @Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof Point))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// If o is a normal Point, do a
        color-blind comparison</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>if (!(o instanceof ColorPoint))</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>return
        o.equals(this);</strong><br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// o is a ColorPoint; do a full comparison<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return super.equals(o) &amp;&amp; ((ColorPoint)
      o).color == color;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      approach does provide symmetry, but at the expense of transitivity:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex11a" id="pch3ex11" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ColorPoint
      p1 = new ColorPoint(1, 2, Color.RED);<br>
      Point p2 = new Point(1, 2);<br>
      ColorPoint p3 = new ColorPoint(1, 2, Color.BLUE);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">p1.equals(p2)</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">p2.equals(p3)</code><span
        class="Apple-converted-space">&nbsp;</span>return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code>, while<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">p1.equals(p3)</code><span
        class="Apple-converted-space">&nbsp;</span>returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code>, a clear
      violation of transitivity. The first two comparisons are “color-blind,”
      while the third takes color into account.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Also,
      this approach can cause infinite recursion: Suppose there are two
      subclasses of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Point</code>,
      say<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ColorPoint</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SmellPoint</code>, each
      with this sort of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method. Then a call to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">myColorPoint.equals(mySmellPoint)</code><span
        class="Apple-converted-space">&nbsp;</span>will throw a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">StackOverflowError</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      what’s the solution? It turns out that this is a fundamental problem of
      equivalence relations in object-oriented languages.<span class="Apple-converted-space">&nbsp;</span><strong>There
        is no way to extend an instantiable class and add a value component
        while preserving the</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>contract</strong>,
      unless you’re willing to forgo the benefits of object-oriented
      abstraction.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_43"></span>You may hear it said that you
      can extend an instantiable class and add a value component while
      preserving the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>contract by using a<code style="font-family: 'Courier New', monospace;">getClass</code><span
        class="Apple-converted-space">&nbsp;</span>test in place of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instanceof</code><span class="Apple-converted-space">&nbsp;</span>test
      in the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex12a" id="pch3ex12" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Broken - violates Liskov substitution principle (page 43)</strong><br>
      @Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>if (o == null || o.getClass() !=
        getClass())</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>return false;</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;Point p = (Point) o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return p.x == x &amp;&amp; p.y == y;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      has the effect of equating objects only if they have the same
      implementation class. This may not seem so bad, but the consequences are
      unacceptable: An instance of a subclass of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Point</code><span class="Apple-converted-space">&nbsp;</span>is
      still a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Point</code>,
      and it still needs to function as one, but it fails to do so if you take
      this approach! Let’s suppose we want to write a method to tell whether a
      point is on the unit circle. Here is one way we could do it:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex13a" id="pch3ex13" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Initialize unitCircle to contain all Points on the unit circle</strong><br>
      private static final Set&lt;Point&gt; unitCircle = Set.of(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Point(
      1,&nbsp;&nbsp;0), new Point( 0,&nbsp;&nbsp;1),<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new
      Point(-1,&nbsp;&nbsp;0), new Point( 0, -1));<br>
      <br>
      public static boolean onUnitCircle(Point p) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return unitCircle.contains(p);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      this may not be the fastest way to implement the functionality, it works
      fine. Suppose you extend<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Point</code><span class="Apple-converted-space">&nbsp;</span>in
      some trivial way that doesn’t add a value component, say, by having its
      constructor keep track of how many instances have been created:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex14a" id="pch3ex14" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class CounterPoint extends Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final AtomicInteger counter =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new
      AtomicInteger();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public CounterPoint(int x, int y) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(x, y);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;counter.incrementAndGet();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static int numberCreated() { return
      counter.get(); }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><em>Liskov substitution
        principle</em><span class="Apple-converted-space">&nbsp;</span>says that
      any important property of a type should also hold for all its subtypes so
      that any method written for the type should work equally well on its
      subtypes [<a href="ref.xhtml#rLiskov87" style="text-decoration: none;">Liskov87</a>].
      This is the formal statement of our<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_44"></span>earlier claim that a subclass
      of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space">&nbsp;</span>(such as<code style="font-family: 'Courier New', monospace;">CounterPoint</code>)
      is still a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space">&nbsp;</span>and must act as one. But
      suppose we pass a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">CounterPoint</code><span
        class="Apple-converted-space">&nbsp;</span>to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">onUnitCircle</code><span
        class="Apple-converted-space">&nbsp;</span>method. If the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Point</code><span class="Apple-converted-space">&nbsp;</span>class
      uses a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getClass</code>-based<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">onUnitCircle</code><span
        class="Apple-converted-space">&nbsp;</span>method will return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code><span class="Apple-converted-space">&nbsp;</span>regardless
      of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">CounterPoint</code><span
        class="Apple-converted-space">&nbsp;</span>instance’s<span class="Apple-converted-space">&nbsp;</span><em>x</em><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><em>y</em><span
        class="Apple-converted-space">&nbsp;</span>coordinates. This is so
      because most collections, including the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>used
      by the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">onUnitCircle</code><span
        class="Apple-converted-space">&nbsp;</span>method, use the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      to test for containment, and no<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CounterPoint</code><span
        class="Apple-converted-space">&nbsp;</span>instance is equal to any<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Point</code>.
      If, however, you use a proper<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instanceof</code>-based<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method on<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Point</code>, the same<code
        style="font-family: 'Courier New', monospace;">onUnitCircle</code><span
        class="Apple-converted-space">&nbsp;</span>method works fine when
      presented with a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">CounterPoint</code><span
        class="Apple-converted-space">&nbsp;</span>instance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      there is no satisfactory way to extend an instantiable class and add a
      value component, there is a fine workaround: Follow the advice of<a href="ch4.xhtml#lev18"
        style="text-decoration: none;">Item 18</a>, “<a href="ch4.xhtml#lev18" style="text-decoration: none;">Favor
        composition over inheritance</a>.” Instead of having<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ColorPoint</code><span class="Apple-converted-space">&nbsp;</span>extend<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Point</code>,
      give<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ColorPoint</code><span
        class="Apple-converted-space">&nbsp;</span>a private<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Point</code><span class="Apple-converted-space">&nbsp;</span>field
      and a public<em>view</em><span class="Apple-converted-space">&nbsp;</span>method
      (<a href="ch2.xhtml#lev6" style="text-decoration: none;">Item 6</a>) that
      returns the point at the same position as this color point:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex15a" id="pch3ex15" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Adds a value component without violating the equals contract</strong><br>
      public class ColorPoint {<br>
      &nbsp;&nbsp; private final Point point;<br>
      &nbsp;&nbsp; private final Color color;<br>
      <br>
      &nbsp;&nbsp; public ColorPoint(int x, int y, Color color) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;point = new Point(x, y);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.color =
      Objects.requireNonNull(color);<br>
      &nbsp;&nbsp; }<br>
      <br>
      &nbsp;&nbsp; /**<br>
      &nbsp;&nbsp;&nbsp;&nbsp;* Returns the point-view of this color point.<br>
      &nbsp;&nbsp;&nbsp;&nbsp;*/<br>
      &nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span><strong>public
        Point asPoint()</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return point;<br>
      &nbsp;&nbsp; }<br>
      <br>
      &nbsp;&nbsp; @Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof ColorPoint))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ColorPoint cp = (ColorPoint) o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return cp.point.equals(point)
      &amp;&amp; cp.color.equals(color);<br>
      &nbsp;&nbsp; }<br>
      <br>
      &nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;// Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are some classes in the Java platform libraries that do extend an
      instantiable class and add a value component. For example,<code style="font-family: 'Courier New', monospace;">java.sql.Timestamp</code><span
        class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak" id="page_45"></span>extends<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.Date</code><span
        class="Apple-converted-space">&nbsp;</span>and adds a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">nanoseconds</code><span class="Apple-converted-space">&nbsp;</span>field.
      The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>implementation for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Timestamp</code><span class="Apple-converted-space">&nbsp;</span>does
      violate symmetry and can cause erratic behavior if<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Timestamp</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Date</code><span
        class="Apple-converted-space">&nbsp;</span>objects are used in the same
      collection or are otherwise intermixed. The<code style="font-family: 'Courier New', monospace;">Timestamp</code><span
        class="Apple-converted-space">&nbsp;</span>class has a disclaimer
      cautioning programmers against mixing dates and timestamps. While you
      won’t get into trouble as long as you keep them separate, there’s nothing
      to prevent you from mixing them, and the resulting errors can be hard to
      debug. This behavior of the<code style="font-family: 'Courier New', monospace;">Timestamp</code><span
        class="Apple-converted-space">&nbsp;</span>class was a mistake and
      should not be emulated.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that you<span class="Apple-converted-space">&nbsp;</span><em>can</em><span
        class="Apple-converted-space">&nbsp;</span>add a value component to a
      subclass of an<span class="Apple-converted-space">&nbsp;</span><em>abstract</em><span
        class="Apple-converted-space">&nbsp;</span>class without violating the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>contract. This is important
      for the sort of class hierarchies that you get by following the advice in<span
        class="Apple-converted-space">&nbsp;</span><a href="ch4.xhtml#lev23" style="text-decoration: none;">Item
        23</a>, “Prefer class hierarchies to tagged classes.” For example, you
      could have an abstract class<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Shape</code><span class="Apple-converted-space">&nbsp;</span>with
      no value components, a subclass<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Circle</code><span class="Apple-converted-space">&nbsp;</span>that
      adds a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">radius</code><span
        class="Apple-converted-space">&nbsp;</span>field, and a subclass<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Rectangle</code><span class="Apple-converted-space">&nbsp;</span>that
      adds<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">length</code><span
        class="Apple-converted-space">&nbsp;</span>and<code style="font-family: 'Courier New', monospace;">width</code><span
        class="Apple-converted-space">&nbsp;</span>fields. Problems of the sort
      shown earlier won’t occur so long as it is impossible to create a
      superclass instance directly.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Consistency</strong>—The
      fourth requirement of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>contract
      says that if two objects are equal, they must remain equal for all time
      unless one (or both) of them is modified. In other words, mutable objects
      can be equal to different objects at different times while immutable
      objects can’t. When you write a class, think hard about whether it should
      be immutable (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Item
        17</a>). If you conclude that it should, make sure that your<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code>method
      enforces the restriction that equal objects remain equal and unequal
      objects remain unequal for all time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Whether
      or not a class is immutable,<span class="Apple-converted-space">&nbsp;</span><strong>do
        not write an</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>method that depends
        on unreliable resources.</strong><span class="Apple-converted-space">&nbsp;</span>It’s
      extremely difficult to satisfy the consistency requirement if you violate
      this prohibition. For example,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.net.URL</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method relies on comparison
      of the IP addresses of the hosts associated with the URLs. Translating a
      host name to an IP address can require network access, and it isn’t
      guaranteed to yield the same results over time. This can cause the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">URL equals</code><span class="Apple-converted-space">&nbsp;</span>method
      to violate the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>contract and has caused
      problems in practice. The behavior of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">URL</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      was a big mistake and should not be emulated. Unfortunately, it cannot be
      changed due to compatibility requirements. To avoid this sort of problem,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>methods should perform only
      deterministic computations on memory-resident objects.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Non-nullity—</strong>The
      final requirement lacks an official name, so I have taken the liberty of
      calling it “non-nullity.” It says that all objects must be unequal to<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">null</code>.
      While it is hard to imagine accidentally returning<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code><span class="Apple-converted-space">&nbsp;</span>in
      response to the invocation<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">o.equals(null)</code>, it
      isn’t hard to imagine accidentally throwing a<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_46"></span><code style="font-family: 'Courier New', monospace;">NullPointerException</code>.
      The general contract prohibits this. Many classes have<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>methods
      that guard against it with an explicit test for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex16a" id="pch3ex16" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">@Override
      public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (o == null)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      test is unnecessary. To test its argument for equality, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      must first cast its argument to an appropriate type so its accessors can
      be invoked or its fields accessed. Before doing the cast, the method must
      use the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">instanceof</code><span
        class="Apple-converted-space">&nbsp;</span>operator to check that its
      argument is of the correct type:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex17a" id="pch3ex17" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">@Override
      public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof MyType))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;MyType mt = (MyType) o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      this type check were missing and the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      were passed an argument of the wrong type, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      would throw a<code style="font-family: 'Courier New', monospace;">ClassCastException</code>,
      which violates the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>contract. But the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instanceof</code><span class="Apple-converted-space">&nbsp;</span>operator
      is specified to return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code><span class="Apple-converted-space">&nbsp;</span>if
      its first operand is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>, regardless
      of what type appears in the second operand [JLS, 15.20.2]. Therefore, the
      type check will return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">false</code><span class="Apple-converted-space">&nbsp;</span>if<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">null</code><span
        class="Apple-converted-space">&nbsp;</span>is passed in, so you don’t
      need an explicit<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">null</code><span
        class="Apple-converted-space">&nbsp;</span>check.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Putting
      it all together, here’s a recipe for a high-quality<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method:</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1.<span
        class="Apple-converted-space">&nbsp;</span><strong>Use the</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>==</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>operator to check if
        the argument is a reference to this object.</strong><span class="Apple-converted-space">&nbsp;</span>If
      so, return<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code>.
      This is just a performance optimization but one that is worth doing if the
      comparison is potentially expensive.</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2.<span
        class="Apple-converted-space">&nbsp;</span><strong>Use the</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>instanceof</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>operator to check if
        the argument has the correct type.</strong><span class="Apple-converted-space">&nbsp;</span>If
      not, return<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">false</code>.
      Typically, the correct type is the class in which the method occurs.
      Occasionally, it is some interface implemented by this class. Use an
      interface if the class implements an interface that refines the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>contract
      to permit comparisons across classes that implement the interface.
      Collection interfaces such as<code style="font-family: 'Courier New', monospace;">Set</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map.Entry</code><span
        class="Apple-converted-space">&nbsp;</span>have this property.</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3.<span
        class="Apple-converted-space">&nbsp;</span><strong>Cast the argument to
        the correct type.</strong><span class="Apple-converted-space">&nbsp;</span>Because
      this cast was preceded by an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instanceof</code><span class="Apple-converted-space">&nbsp;</span>test,
      it is guaranteed to succeed.</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_47"></span>4.<span class="Apple-converted-space">&nbsp;</span><strong>For
        each “significant” field in the class, check if that field of the
        argument matches the corresponding field of this object.</strong><span class="Apple-converted-space">&nbsp;</span>If
      all these tests succeed, return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code>; otherwise,
      return<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">false</code>.
      If the type in Step 2 is an interface, you must access the argument’s
      fields via interface methods; if the type is a class, you may be able to
      access the fields directly, depending on their accessibility.</p>
    <p class="numberp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      primitive fields whose type is not<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">float</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">double</code>,
      use the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">==</code><span
        class="Apple-converted-space">&nbsp;</span>operator for comparisons; for
      object reference fields, call the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      recursively; for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">float</code><span
        class="Apple-converted-space">&nbsp;</span>fields, use the static<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Float.compare(float,
        float)</code><span class="Apple-converted-space">&nbsp;</span>method;
      and for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">double</code><span
        class="Apple-converted-space">&nbsp;</span>fields, use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Double.compare(double,
        double)</code>. The special treatment of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">float</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">double</code><span
        class="Apple-converted-space">&nbsp;</span>fields is made necessary by
      the existence of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Float.NaN</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">-0.0f</code><span
        class="Apple-converted-space">&nbsp;</span>and the analogous<code style="font-family: 'Courier New', monospace;">double</code><span
        class="Apple-converted-space">&nbsp;</span>values; see JLS 15.21.1 or
      the documentation of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Float.equals</code><span
        class="Apple-converted-space">&nbsp;</span>for details. While you could
      compare<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">float</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">double</code><span class="Apple-converted-space">&nbsp;</span>fields
      with the static methods<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Float.equals</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Double.equals</code>,
      this would entail autoboxing on every comparison, which would have poor
      performance. For array fields, apply these guidelines to each element. If
      every element in an array field is significant, use one of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Arrays.equals</code>methods.</p>
    <p class="numberp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Some
      object reference fields may legitimately contain<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>. To avoid the
      possibility of a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">NullPointerException</code>,
      check such fields for equality using the static method<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Objects.equals(Object,
        Object)</code>.</p>
    <p class="numberp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      some classes, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space">&nbsp;</span>above, field comparisons are
      more complex than simple equality tests. If this is the case, you may want
      to store a<span class="Apple-converted-space">&nbsp;</span><em>canonical
        form</em><span class="Apple-converted-space">&nbsp;</span>of the field
      so the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method can do a cheap exact
      comparison on canonical forms rather than a more costly nonstandard
      comparison. This technique is most appropriate for immutable classes (<a href="ch4.xhtml#lev17"
        style="text-decoration: none;">Item 17</a>); if the object can change,
      you must keep the canonical form up to date.</p>
    <p class="numberp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      performance of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method may be affected by the
      order in which fields are compared. For best performance, you should first
      compare fields that are more likely to differ, less expensive to compare,
      or, ideally, both. You must not compare fields that are not part of an
      object’s logical state, such as lock fields used to synchronize
      operations. You need not compare<span class="Apple-converted-space">&nbsp;</span><em>derived
        fields</em>, which can be calculated from “significant fields,” but
      doing so may improve the performance of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method.
      If a derived field amounts to a summary description of the entire object,
      comparing this field will save you the expense of comparing the actual
      data if the comparison fails. For example, suppose you have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Polygon</code><span class="Apple-converted-space">&nbsp;</span>class,
      and you cache the area. If two polygons have unequal areas, you needn’t
      bother comparing their edges and vertices.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_48"></span><strong>When you are finished
        writing your</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>method, ask yourself
        three questions: Is it symmetric? Is it transitive? Is it consistent?</strong><span
        class="Apple-converted-space">&nbsp;</span>And don’t just ask yourself;
      write unit tests to check, unless you used AutoValue (page 49) to generate
      your<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method, in which case you can
      safely omit the tests. If the properties fail to hold, figure out why, and
      modify the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method accordingly. Of course
      your<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code>method
      must also satisfy the other two properties (reflexivity and non-nullity),
      but these two usually take care of themselves.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">An<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method constructed according
      to the previous recipe is shown in this simplistic<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex18a" id="pch3ex18" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Class with a typical equals method</strong><br>
      public final class PhoneNumber {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final short areaCode, prefix, lineNum;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public PhoneNumber(int areaCode, int prefix, int
      lineNum) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.areaCode =
      rangeCheck(areaCode,&nbsp;&nbsp;999, "area code");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.prefix&nbsp;&nbsp; =
      rangeCheck(prefix,&nbsp;&nbsp;&nbsp;&nbsp;999, "prefix");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.lineNum&nbsp;&nbsp;=
      rangeCheck(lineNum,&nbsp;&nbsp;9999, "line num");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static short rangeCheck(int val, int max,
      String arg) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (val &lt; 0 || val &gt;
      max)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new
      IllegalArgumentException(arg + ": " + val);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (short) val;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>@Override public boolean equals(Object o)</strong><span
        class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (o == this)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof
      PhoneNumber))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PhoneNumber pn =
      (PhoneNumber)o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return pn.lineNum ==
      lineNum &amp;&amp; pn.prefix == prefix<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;
      pn.areaCode == areaCode;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder omitted<br>
      }</p>
    <p class="noindentb" style="margin-top: 0px; margin-bottom: 15px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      are a few final caveats:</p>
    <p class="bullb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>Always override</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>when you override</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch3.xhtml#lev11" style="text-decoration: none;">Item
        11</a>).</p>
    <p class="bullb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>Don’t try to be too
        clever.</strong><span class="Apple-converted-space">&nbsp;</span>If you
      simply test fields for equality, it’s not hard to adhere to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>contract.
      If you are overly aggressive in searching for equivalence, it’s easy to
      get into trouble. It is generally a bad idea to take any form of aliasing
      into account. For example, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">File</code>class
      shouldn’t attempt to equate symbolic links referring to the same file.
      Thankfully, it doesn’t.</p>
    <p class="bullb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_49"></span>•<span class="Apple-converted-space">&nbsp;</span><strong>Don’t
        substitute another type for</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>Object</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>in the</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>declaration.</strong><span
        class="Apple-converted-space">&nbsp;</span>It is not uncommon for a
      programmer to write an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      that looks like this and then spend hours puzzling over why it doesn’t
      work properly:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex19a" id="pch3ex19" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="prebb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 0px; margin-bottom: 6.666667px; margin-left: 57.333336px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Broken - parameter type must be Object!</strong><br>
      public boolean equals(MyClass o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="bullp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 42.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      problem is that this method does not<span class="Apple-converted-space">&nbsp;</span><em>override</em><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object.equals</code>,
      whose argument is of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>, but<span class="Apple-converted-space">&nbsp;</span><em>overloads</em><span
        class="Apple-converted-space">&nbsp;</span>it instead (<a href="ch8.xhtml#lev52"
        style="text-decoration: none;">Item 52</a>). It is unacceptable to
      provide such a “strongly typed”<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      even in addition to the normal one, because it can cause<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Override</code>annotations
      in subclasses to generate false positives and provide a false sense of
      security.</p>
    <p class="bullp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 42.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Consistent
      use of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Override</code><span
        class="Apple-converted-space">&nbsp;</span>annotation, as illustrated
      throughout this item, will prevent you from making this mistake (<a href="ch6.xhtml#lev40"
        style="text-decoration: none;">Item 40</a>). This<code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method won’t compile, and the
      error message will tell you exactly what is wrong:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex20a" id="pch3ex20" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="prebb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 0px; margin-bottom: 6.666667px; margin-left: 57.333336px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Still broken, but won’t compile</strong><br>
      <strong>@Override</strong><span class="Apple-converted-space">&nbsp;</span>public
      boolean equals(MyClass o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Writing
      and testing<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>(and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>) methods
      is tedious, and the resulting code is mundane. An excellent alternative to
      writing and testing these methods manually is to use Google’s open source
      AutoValue framework, which automatically generates these methods for you,
      triggered by a single annotation on the class . In most cases, the methods
      generated by AutoValue are essentially identical to those you’d write
      yourself.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">IDEs,
      too, have facilities to generate<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>methods, but the resulting
      source code is more verbose and less readable than code that uses
      AutoValue, does not track changes in the class automatically, and
      therefore requires testing. That said, having IDEs generate<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code>(and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>) methods
      is generally preferable to implementing them manually because IDEs do not
      make careless mistakes, and humans do.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, don’t override the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      unless you have to: in many cases, the implementation inherited from<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>does exactly what you want.
      If you do override<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code>,
      make sure to compare all of the class’s significant fields and to compare
      them in a manner that preserves all five provisions of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>contract.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev11" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_50"></span><strong>Item 11: Always override</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>when you override</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code></h3>
    <p class="noindentb" style="margin-top: 0px; margin-bottom: 15px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>You
        must override</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>in every class that
        overrides</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><strong>.</strong><span
        class="Apple-converted-space">&nbsp;</span>If you fail to do so, your
      class will violate the general contract for<code style="font-family: 'Courier New', monospace;">hashCode</code>,
      which will prevent it from functioning properly in collections such as<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashMap</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>. Here is
      the contract, adapted from the<code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>specification :</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      When the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>method is invoked on an
      object repeatedly during an execution of an application, it must
      consistently return the same value, provided no information used in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>comparisons
      is modified. This value need not remain consistent from one execution of
      an application to another.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      If two objects are equal according to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals(Object)</code><span
        class="Apple-converted-space">&nbsp;</span>method, then calling<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>on
      the two objects must produce the same integer result.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      If two objects are unequal according to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals(Object)</code><span
        class="Apple-converted-space">&nbsp;</span>method, it is<span class="Apple-converted-space">&nbsp;</span><em>not</em><span
        class="Apple-converted-space">&nbsp;</span>required that calling<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>on
      each of the objects must produce distinct results. However, the programmer
      should be aware that producing distinct results for unequal objects may
      improve the performance of hash tables.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The
        key provision that is violated when you fail to override</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>is the second one:
        equal objects must have equal hash codes.</strong><span class="Apple-converted-space">&nbsp;</span>Two
      distinct instances may be logically equal according to a class’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method,
      but to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>method, they’re just two
      objects with nothing much in common. Therefore,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>method
      returns two seemingly random numbers instead of two equal numbers as
      required by the contract.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      example, suppose you attempt to use instances of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class
      from<span class="Apple-converted-space">&nbsp;</span><a href="ch3.xhtml#lev10"
        style="text-decoration: none;">Item 10</a><span class="Apple-converted-space">&nbsp;</span>as
      keys in a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashMap</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex21a" id="pch3ex21" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="preba" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 50.666668px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Map&lt;PhoneNumber,
      String&gt; m = new HashMap&lt;&gt;();<br>
      m.put(new PhoneNumber(707, 867, 5309), "Jenny");</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">At
      this point, you might expect<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">m.get(new PhoneNumber(707</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">867</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">5309))</code><span
        class="Apple-converted-space">&nbsp;</span>to return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">"Jenny"</code>, but
      instead, it returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>. Notice that
      two<code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>instances are involved: one
      is used for insertion into the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashMap</code>, and a
      second, equal instance is used for (attempted) retrieval. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class’s
      failure to override<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>causes
      the two equal instances to have unequal hash codes, in violation of the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code>contract.
      Therefore, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">get</code><span
        class="Apple-converted-space">&nbsp;</span>method is likely to look for
      the phone number in a different hash bucket from the one in which it was
      stored by the<code style="font-family: 'Courier New', monospace;">put</code><span
        class="Apple-converted-space">&nbsp;</span>method. Even if the two
      instances happen to hash to the same bucket, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">get</code><span class="Apple-converted-space">&nbsp;</span>method
      will almost certainly return<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>, because<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashMap</code>has
      an optimization that caches the hash code associated with each entry and
      doesn’t bother checking for object equality if the hash codes don’t match.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_51"></span>Fixing this problem is as
      simple as writing a proper<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>method
      for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>.
      So what should a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>method look like? It’s
      trivial to write a bad one. This one, for example, is always legal but
      should never be used:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex22a" id="pch3ex22" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        The worst possible legal hashCode implementation - never use!</strong><br>
      @Override public int hashCode() { return 42; }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It’s
      legal because it ensures that equal objects have the same hash code. It’s
      atrocious because it ensures that<span class="Apple-converted-space">&nbsp;</span><em>every</em><span
        class="Apple-converted-space">&nbsp;</span>object has the same hash
      code. Therefore, every object hashes to the same bucket, and hash tables
      degenerate to linked lists. Programs that should run in linear time
      instead run in quadratic time. For large hash tables, this is the
      difference between working and not working.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      good hash function tends to produce unequal hash codes for unequal
      instances. This is exactly what is meant by the third part of the<code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>contract. Ideally, a hash
      function should distribute any reasonable collection of unequal instances
      uniformly across all<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>values.
      Achieving this ideal can be difficult. Luckily it’s not too hard to
      achieve a fair approximation. Here is a simple recipe:</p>
    <p class="number" style="margin-top: 0px; margin-bottom: 4px; margin-left: 20px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1.
      Declare an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space">&nbsp;</span>variable named<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">result</code>, and
      initialize it to the hash code<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">c</code><span class="Apple-converted-space">&nbsp;</span>for
      the first significant field in your object, as computed in step 2.a.
      (Recall from<span class="Apple-converted-space">&nbsp;</span><a href="ch3.xhtml#lev10"
        style="text-decoration: none;">Item 10</a><span class="Apple-converted-space">&nbsp;</span>that
      a significant field is a field that affects equals comparisons.)</p>
    <p class="number" style="margin-top: 0px; margin-bottom: 4px; margin-left: 20px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2.
      For every remaining significant field<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">f</code><span class="Apple-converted-space">&nbsp;</span>in
      your object, do the following:</p>
    <p class="alpha" style="margin-top: 0px; margin-bottom: 4px; margin-left: 41.333336px; text-indent: -17.333334px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">a.
      Compute an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space">&nbsp;</span>hash code<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">c</code><span class="Apple-converted-space">&nbsp;</span>for
      the field:</p>
    <p class="roman" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 56px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">i.
      If the field is of a primitive type, compute<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><em>Type</em>.hashCode(f)</code>,
      where<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><em>Type</em></code><span
        class="Apple-converted-space">&nbsp;</span>is the boxed primitive class
      corresponding to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">f</code>’s
      type.</p>
    <p class="roman1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 56px; text-indent: -14.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ii.
      If the field is an object reference and this class’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      compares the field by recursively invoking<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code>,
      recursively invoke<code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>on the field. If a more
      complex comparison is required, compute a “canonical representation” for
      this field and invoke<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>on the
      canonical representation. If the value of the field is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>, use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">0</code><span class="Apple-converted-space">&nbsp;</span>(or
      some other constant, but<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">0</code><span class="Apple-converted-space">&nbsp;</span>is
      traditional).</p>
    <p class="roman2" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 54.666668px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">iii.
      If the field is an array, treat it as if each significant element were a
      separate field. That is, compute a hash code for each significant element
      by applying these rules recursively, and combine the values per step 2.b.
      If the array has no significant elements, use a constant, preferably not<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">0</code>.
      If all elements are significant, use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Arrays.hashCode</code>.</p>
    <p class="alpha" style="margin-top: 0px; margin-bottom: 4px; margin-left: 41.333336px; text-indent: -17.333334px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">b.
      Combine the hash code<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">c</code><span class="Apple-converted-space">&nbsp;</span>computed
      in step 2.a into<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">result</code><span
        class="Apple-converted-space">&nbsp;</span>as follows:</p>
    <p class="codep1" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 92px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">result
      = 31 * result + c;</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3.
      Return<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">result</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_52"></span>When you are finished writing
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>method, ask yourself whether
      equal instances have equal hash codes. Write unit tests to verify your
      intuition (unless you used AutoValue to generate your<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>methods, in which case you
      can safely omit these tests). If equal instances have unequal hash codes,
      figure out why and fix the problem.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      may exclude<span class="Apple-converted-space">&nbsp;</span><em>derived
        fields</em><span class="Apple-converted-space">&nbsp;</span>from the
      hash code computation. In other words, you may ignore any field whose
      value can be computed from fields included in the computation. You<span class="Apple-converted-space">&nbsp;</span><em>must</em><span
        class="Apple-converted-space">&nbsp;</span>exclude any fields that are
      not used in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>comparisons, or you risk
      violating the second provision of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>contract.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      multiplication in step 2.b makes the result depend on the order of the
      fields, yielding a much better hash function if the class has multiple
      similar fields. For example, if the multiplication were omitted from a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>hash function, all anagrams
      would have identical hash codes. The value 31 was chosen because it is an
      odd prime. If it were even and the multiplication overflowed, information
      would be lost, because multiplication by 2 is equivalent to shifting. The
      advantage of using a prime is less clear, but it is traditional. A nice
      property of 31 is that the multiplication can be replaced by a shift and a
      subtraction for better performance on some architectures:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">31 * i == (i &lt;&lt; 5)
        - i</code>. Modern VMs do this sort of optimization automatically.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Let’s
      apply the previous recipe to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex23a" id="pch3ex23" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typical hashCode method</strong><br>
      @Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int result = Short.hashCode(areaCode);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;result = 31 * result + Short.hashCode(prefix);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;result = 31 * result + Short.hashCode(lineNum);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      this method returns the result of a simple deterministic computation whose
      only inputs are the three significant fields in a<code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>instance, it is clear that
      equal<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>instances have equal hash
      codes. This method is, in fact, a perfectly good<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>implementation
      for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>,
      on par with those in the Java platform libraries. It is simple, is
      reasonably fast, and does a reasonable job of dispersing unequal phone
      numbers into different hash buckets.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      the recipe in this item yields reasonably good hash functions, they are
      not state-of-the-art. They are comparable in quality to the hash functions
      found in the Java platform libraries’ value types and are adequate for
      most uses. If you have a bona fide need for hash functions less likely to
      produce collisions, see Guava’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">com.google.common.hash.Hashing</code><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rGuava" style="text-decoration: none;">Guava</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_53"></span>The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Objects</code><span class="Apple-converted-space">&nbsp;</span>class
      has a static method that takes an arbitrary number of objects and returns
      a hash code for them. This method, named<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hash</code>, lets you
      write one-line<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>methods whose quality is
      comparable to those written according to the recipe in this item.
      Unfortunately, they run more slowly because they entail array creation to
      pass a variable number of arguments, as well as boxing and unboxing if any
      of the arguments are of primitive type. This style of hash function is
      recommended for use only in situations where performance is not critical.
      Here is a hash function for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>written
      using this technique:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex24a" id="pch3ex24" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        One-line hashCode method - mediocre performance</strong><br>
      @Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;return Objects.hash(lineNum, prefix, areaCode);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      a class is immutable and the cost of computing the hash code is
      significant, you might consider caching the hash code in the object rather
      than recalculating it each time it is requested. If you believe that most
      objects of this type will be used as hash keys, then you should calculate
      the hash code when the instance is created. Otherwise, you might choose to<span
        class="Apple-converted-space">&nbsp;</span><em>lazily initialize</em><span
        class="Apple-converted-space">&nbsp;</span>the hash code the first time<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hash-Code</code><span
        class="Apple-converted-space">&nbsp;</span>is invoked. Some care is
      required to ensure that the class remains thread-safe in the presence of a
      lazily initialized field (<a href="ch11.xhtml#lev83" style="text-decoration: none;">Item
        83</a>). Our<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>class does not merit this
      treatment, but just to show you how it’s done, here it is. Note that the
      initial value for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>field
      (in this case, 0) should not be the hash code of a commonly created
      instance:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex25a" id="pch3ex25" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        hashCode method with lazily initialized cached hash code</strong><br>
      private int hashCode; // Automatically initialized to 0<br>
      <br>
      @Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int result = hashCode;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (result == 0) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result =
      Short.hashCode(areaCode);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = 31 * result +
      Short.hashCode(prefix);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = 31 * result +
      Short.hashCode(lineNum);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hashCode = result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Do
        not be tempted to exclude significant fields from the hash code
        computation to improve performance.</strong><span class="Apple-converted-space">&nbsp;</span>While
      the resulting hash function may run faster, its poor quality may degrade
      hash tables’ performance to the point where they become unusable. In
      particular, the hash function may be confronted with a<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_54"></span>large collection of instances
      that differ mainly in regions you’ve chosen to ignore. If this happens,
      the hash function will map all these instances to a few hash codes, and
      programs that should run in linear time will instead run in quadratic
      time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      is not just a theoretical problem. Prior to Java 2, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>hash
      function used at most sixteen characters evenly spaced throughout the
      string, starting with the first character. For large collections of
      hierarchical names, such as URLs, this function displayed exactly the
      pathological behavior described earlier.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Don’t
        provide a detailed specification for the value returned by</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><strong>,
        so clients can’t reasonably depend on it; this gives you the flexibility
        to change it.</strong><span class="Apple-converted-space">&nbsp;</span>Many
      classes in the Java libraries, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code>,
      specify the exact value returned by their<code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>method as a function of the
      instance value. This is<span class="Apple-converted-space">&nbsp;</span><em>not</em><span
        class="Apple-converted-space">&nbsp;</span>a good idea but a mistake
      that we’re forced to live with: It impedes the ability to improve the hash
      function in future releases. If you leave the details unspecified and a
      flaw is found in the hash function or a better hash function is
      discovered, you can change it in a subsequent release.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, you<span class="Apple-converted-space">&nbsp;</span><em>must</em><span
        class="Apple-converted-space">&nbsp;</span>override<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>every
      time you override<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code>,
      or your program will not run correctly. Your<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>method
      must obey the general contract specified in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>and
      must do a reasonable job assigning unequal hash codes to unequal
      instances. This is easy to achieve, if slightly tedious, using the recipe
      on page 51. As mentioned in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev10" style="text-decoration: none;">Item 10</a>, the
      AutoValue framework provides a fine alternative to writing<code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>methods
      manually, and IDEs also provide some of this functionality.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev12" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_55"></span><strong>Item 12: Always override</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>toString</strong></code></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>provides an implementation of
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>method, the string that it
      returns is generally not what the user of your class wants to see. It
      consists of the class name followed by an “at” sign (<code style="font-family: 'Courier New', monospace;">@</code>)
      and the unsigned hexadecimal representation of the hash code, for example,<code
        style="font-family: 'Courier New', monospace;">PhoneNumber@163b91</code>.
      The general contract for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>says
      that the returned string should be “a concise but informative
      representation that is easy for a person to read.” While it could be
      argued that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber@163b91</code><span
        class="Apple-converted-space">&nbsp;</span>is concise and easy to read,
      it isn’t very informative when compared to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">707-867-5309</code>. The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>contract goes on to say, “It
      is recommended that all subclasses override this method.” Good advice,
      indeed!</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      it isn’t as critical as obeying the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>contracts (<a href="ch3.xhtml#lev10"
        style="text-decoration: none;">Items 10</a><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><a href="ch3.xhtml#lev11" style="text-decoration: none;">11</a>),<span
        class="Apple-converted-space">&nbsp;</span><strong>providing a good</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>toString</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>implementation makes
        your class much more pleasant to use and makes systems using the class
        easier to debug</strong>. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>method
      is automatically invoked when an object is passed to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">println</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">printf</code>, the string
      concatenation operator, or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">assert</code>, or is
      printed by a debugger. Even if you never call<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>on
      an object, others may. For example, a component that has a reference to
      your object may include the string representation of the object in a
      logged error message. If you fail to override<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code>, the
      message may be all but useless.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you’ve provided a good<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>method
      for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>,
      generating a useful diagnostic message is as easy as this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex26a" id="pch3ex26" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="preba" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 50.666668px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">System.out.println("Failed
      to connect to " + phoneNumber);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Programmers
      will generate diagnostic messages in this fashion whether or not you
      override<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code>,
      but the messages won’t be useful unless you do. The benefits of providing
      a good<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>method extend beyond
      instances of the class to objects containing references to these
      instances, especially collections. Which would you rather see when
      printing a map,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">{Jenny=PhoneNumber@163b91}</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">{Jenny=707-867-5309}</code>?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>When
        practical, the</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>toString</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>method should return</strong><span
        class="Apple-converted-space">&nbsp;</span><em><strong>all</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>of the interesting
        information contained in the object</strong>, as shown in the phone
      number example. It is impractical if the object is large or if it contains
      state that is not conducive to string representation. Under these
      circumstances,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>should return a summary such
      as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Manhattan
        residential phone directory (1487536 listings)</code><span class="Apple-converted-space">&nbsp;</span>or<code
        style="font-family: 'Courier New', monospace;">Thread[main,5,main]</code>.
      Ideally, the string should be self-explanatory. (The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Thread</code><span class="Apple-converted-space">&nbsp;</span>example
      flunks this test.) A particularly annoying penalty for failing to<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_56"></span>include all of an object’s
      interesting information in its string representation is test failure
      reports that look like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex27a" id="pch3ex27" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="preb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Assertion
      failure: expected {abc, 123}, but was {abc, 123}.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      important decision you’ll have to make when implementing a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>method
      is whether to specify the format of the return value in the documentation.
      It is recommended that you do this for<span class="Apple-converted-space">&nbsp;</span><em>value
        classes</em>, such as phone number or matrix. The advantage of
      specifying the format is that it serves as a standard, unambiguous,
      human-readable representation of the object. This representation can be
      used for input and output and in persistent human-readable data objects,
      such as CSV files. If you specify the format, it’s usually a good idea to
      provide a matching static factory or constructor so programmers can easily
      translate back and forth between the object and its string representation.
      This approach is taken by many value classes in the Java platform
      libraries, including<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code>, and
      most of the boxed primitive classes.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      disadvantage of specifying the format of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>return
      value is that once you’ve specified it, you’re stuck with it for life,
      assuming your class is widely used. Programmers will write code to parse
      the representation, to generate it, and to embed it into persistent data.
      If you change the representation in a future release, you’ll break their
      code and data, and they will yowl. By choosing not to specify a format,
      you preserve the flexibility to add information or improve the format in a
      subsequent release.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Whether
        or not you decide to specify the format, you should clearly document
        your intentions.</strong><span class="Apple-converted-space">&nbsp;</span>If
      you specify the format, you should do so precisely. For example, here’s a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>method to go with the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class
      in<span class="Apple-converted-space">&nbsp;</span><a href="ch3.xhtml#lev11"
        style="text-decoration: none;">Item 11</a>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex28a" id="pch3ex28" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">/**<br>
      &nbsp;* Returns the string representation of this phone number.<br>
      &nbsp;* The string consists of twelve characters whose format is<br>
      &nbsp;* "XXX-YYY-ZZZZ", where XXX is the area code, YYY is the<br>
      &nbsp;* prefix, and ZZZZ is the line number. Each of the capital<br>
      &nbsp;* letters represents a single decimal digit.<br>
      &nbsp;*<br>
      &nbsp;* If any of the three parts of this phone number is too small<br>
      &nbsp;* to fill up its field, the field is padded with leading zeros.<br>
      &nbsp;* For example, if the value of the line number is 123, the last<br>
      &nbsp;* four characters of the string representation will be "0123".<br>
      &nbsp;*/<br>
      @Override public String toString() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return String.format("%03d-%03d-%04d",<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;areaCode,
      prefix, lineNum);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_57"></span>If you decide not to specify a
      format, the documentation comment should read something like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex29a" id="pch3ex29" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">/**<br>
      &nbsp;* Returns a brief description of this potion. The exact details<br>
      &nbsp;* of the representation are unspecified and subject to change,<br>
      &nbsp;* but the following may be regarded as typical:<br>
      &nbsp;*<br>
      &nbsp;* "[Potion #9: type=love, smell=turpentine, look=india ink]"<br>
      &nbsp;*/<br>
      @Override public String toString() { ... }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">After
      reading this comment, programmers who produce code or persistent data that
      depends on the details of the format will have no one but themselves to
      blame when the format is changed.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Whether
      or not you specify the format,<span class="Apple-converted-space">&nbsp;</span><strong>provide
        programmatic access to the information contained in the value returned
        by</strong><code style="font-family: 'Courier New', monospace;"><strong>toString</strong></code><strong>.</strong><span
        class="Apple-converted-space">&nbsp;</span>For example, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class
      should contain accessors for the area code, prefix, and line number. If
      you fail to do this, you<em>force</em><span class="Apple-converted-space">&nbsp;</span>programmers
      who need this information to parse the string. Besides reducing
      performance and making unnecessary work for programmers, this process is
      error-prone and results in fragile systems that break if you change the
      format. By failing to provide accessors, you turn the string format into a
      de facto API, even if you’ve specified that it’s subject to change.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      makes no sense to write a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>method
      in a static utility class (<a href="ch2.xhtml#lev4" style="text-decoration: none;">Item
        4</a>). Nor should you write a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>method
      in most enum types (<a href="ch6.xhtml#lev34" style="text-decoration: none;">Item
        34</a>) because Java provides a perfectly good one for you. You should,
      however, write a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>method in any abstract class
      whose subclasses share a common string representation. For example, the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>methods on most collection
      implementations are inherited from the abstract collection classes.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Google’s
      open source AutoValue facility, discussed in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev10" style="text-decoration: none;">Item 10</a>, will
      generate a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>method for you, as will most
      IDEs. These methods are great for telling you the contents of each field
      but aren’t specialized to the<span class="Apple-converted-space">&nbsp;</span><em>meaning</em><span
        class="Apple-converted-space">&nbsp;</span>of the class. So, for
      example, it would be inappropriate to use an automatically generated<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>method for our<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class
      (as phone numbers have a standard string representation), but it would be
      perfectly acceptable for our<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Potion</code><span class="Apple-converted-space">&nbsp;</span>class.
      That said, an automatically generated<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>method
      is far preferable to the one inherited from<code style="font-family: 'Courier New', monospace;">Object</code>,
      which tells you<span class="Apple-converted-space">&nbsp;</span><em>nothing</em><span
        class="Apple-converted-space">&nbsp;</span>about an object’s value.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      recap, override<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp;</span>implementation in every
      instantiable class you write, unless a superclass has already done so. It
      makes classes much more pleasant to use and aids in debugging. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>method
      should return a concise, useful description of the object, in an
      aesthetically pleasing format.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev13" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_58"></span><strong>Item 13: Override</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>judiciously</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code><span
        class="Apple-converted-space">&nbsp;</span>interface was intended as a<span
        class="Apple-converted-space">&nbsp;</span><em>mixin interface</em><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch4.xhtml#lev20" style="text-decoration: none;">Item
        20</a>) for classes to advertise that they permit cloning.
      Unfortunately, it fails to serve this purpose. Its primary flaw is that it
      lacks a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      is protected. You cannot, without resorting to<em>reflection</em><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch9.xhtml#lev65" style="text-decoration: none;">Item 65</a>),
      invoke<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>on an object merely because
      it implements<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code>.
      Even a reflective invocation may fail, because there is no guarantee that
      the object has an accessible<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method.
      Despite this flaw and many others, the facility is in reasonably wide use,
      so it pays to understand it. This item tells you how to implement a
      well-behaved<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method, discusses when it is
      appropriate to do so, and presents alternatives.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      what<span class="Apple-converted-space">&nbsp;</span><em>does</em><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">&nbsp;</span>do,
      given that it contains no methods? It determines the behavior of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>’s protected<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>implementation: if a class
      implements<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method returns a
      field-by-field copy of the object; otherwise it throws<code style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code>.
      This is a highly atypical use of interfaces and not one to be emulated.
      Normally, implementing an interface says something about what a class can
      do for its clients. In this case, it modifies the behavior of a protected
      method on a superclass.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Though
      the specification doesn’t say it,<span class="Apple-converted-space">&nbsp;</span><strong>in
        practice, a class implementing</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>Cloneable</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>is expected to
        provide a properly functioning public</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>method.</strong><span
        class="Apple-converted-space">&nbsp;</span>In order to achieve this, the
      class and all of its superclasses must obey a complex, unenforceable,
      thinly documented protocol. The resulting mechanism is fragile, dangerous,
      and<span class="Apple-converted-space">&nbsp;</span><em>extralinguistic</em>:
      it creates objects without calling a constructor.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      general contract for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      is weak. Here it is, copied from the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>specification
      :</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Creates
      and returns a copy of this object. The precise meaning of “copy” may
      depend on the class of the object. The general intent is that, for any
      object<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">x</code>,
      the expression</p>
    <p class="codepbi" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 9.333334px; margin-bottom: 9.333334px; margin-left: 32px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">x.clone()
      != x</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">will
      be<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code>,
      and the expression</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex30a" id="pch3ex30" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">x.clone().getClass()
      == x.getClass()</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">will
      be<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code>,
      but these are not absolute requirements. While it is typically the case
      that</p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">x.clone().equals(x)</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">will
      be<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code>,
      this is not an absolute requirement.</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_59"></span>By convention, the object
      returned by this method should be obtained by calling<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>. If a
      class and all of its superclasses (except<code style="font-family: 'Courier New', monospace;">Object</code>)
      obey this convention, it will be the case that</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex31a" id="pch3ex31" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="codep2" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 53.333336px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">x.clone().getClass()
      == x.getClass().</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">By
      convention, the returned object should be independent of the object being
      cloned. To achieve this independence, it may be necessary to modify one or
      more fields of the object returned by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.clone</code><span class="Apple-converted-space">&nbsp;</span>before
      returning it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      mechanism is vaguely similar to constructor chaining, except that it isn’t
      enforced: if a class’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      returns an instance that is<span class="Apple-converted-space">&nbsp;</span><em>not</em>obtained
      by calling<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">super.clone</code><span
        class="Apple-converted-space">&nbsp;</span>but by calling a constructor,
      the compiler won’t complain, but if a subclass of that class calls<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>, the
      resulting object will have the wrong class, preventing the subclass from<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method from working properly.
      If a class that overrides<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>is
      final, this convention may be safely ignored, as there are no subclasses
      to worry about. But if a final class has a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      that does not invoke<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>, there
      is no reason for the class to implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code>, as it
      doesn’t rely on the behavior of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>’s clone
      implementation.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      you want to implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">&nbsp;</span>in
      a class whose superclass provides a well-behaved<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method.
      First call<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">super.clone</code>.
      The object you get back will be a fully functional replica of the
      original. Any fields declared in your class will have values identical to
      those of the original. If every field contains a primitive value or a
      reference to an immutable object, the returned object may be exactly what
      you need, in which case no further processing is necessary. This is the
      case, for example, for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class
      in<span class="Apple-converted-space">&nbsp;</span><a href="ch3.xhtml#lev11"
        style="text-decoration: none;">Item 11</a>, but note that<span class="Apple-converted-space">&nbsp;</span><strong>immutable
        classes should never provide a</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>method</strong><span
        class="Apple-converted-space">&nbsp;</span>because it would merely
      encourage wasteful copying. With that caveat, here’s how a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code>method for<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>would look:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex32a" id="pch3ex32" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Clone method for class with no references to mutable state</strong><br>
      @Override public PhoneNumber clone() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (PhoneNumber)
      super.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (CloneNotSupportedException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      AssertionError();&nbsp;&nbsp;// Can't happen<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      order for this method to work, the class declaration for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>would
      have to be modified to indicate that it implements<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code>. Though<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>, this<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code>. It is
      legal<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_60"></span>and desirable to do this because Java supports<span
        class="Apple-converted-space">&nbsp;</span><em>covariant return types</em>.
      In other words, an overriding method’s return type can be a subclass of
      the overridden method’s return type. This eliminates the need for casting
      in the client. We must cast the result of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.clone</code><span class="Apple-converted-space">&nbsp;</span>from<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>before
      returning it, but the cast is guaranteed to succeed.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      call to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">super.clone</code><span
        class="Apple-converted-space">&nbsp;</span>is contained in a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">try-catch</code><span class="Apple-converted-space">&nbsp;</span>block.
      This is because<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>declares its<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      to throw<code style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code>,
      which is a<span class="Apple-converted-space">&nbsp;</span><em>checked
        exception</em>. Because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>implements<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      we know the call to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>will
      succeed. The need for this boilerplate indicates that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code><span
        class="Apple-converted-space">&nbsp;</span>should have been unchecked (<a
        href="ch10.xhtml#lev71" style="text-decoration: none;">Item 71</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      an object contains fields that refer to mutable objects, the simple<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>implementation
      shown earlier can be disastrous. For example, consider the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>class
      in<span class="Apple-converted-space">&nbsp;</span><a href="ch2.xhtml#lev7"
        style="text-decoration: none;">Item 7</a>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex33a" id="pch3ex33" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Stack {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Object[] elements;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int size = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int DEFAULT_INITIAL_CAPACITY
      = 16;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.elements = new
      Object[DEFAULT_INITIAL_CAPACITY];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(Object e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensureCapacity();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size++] = e;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Object pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object result =
      elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size] = null; //
      Eliminate obsolete reference<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Ensure space for at least one more element.<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private void ensureCapacity() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (elements.length ==
      size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements
      = Arrays.copyOf(elements, 2 * size + 1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      you want to make this class cloneable. If the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      merely returns<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">super.clone()</code>,
      the resulting<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>instance will have the
      correct value in<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_61"></span>its<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">size</code><span class="Apple-converted-space">&nbsp;</span>field,
      but its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">elements</code><span
        class="Apple-converted-space">&nbsp;</span>field will refer to the same
      array as the original<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>instance.
      Modifying the original will destroy the invariants in the clone and vice
      versa. You will quickly find that your program produces nonsensical
      results or throws a<code style="font-family: 'Courier New', monospace;">NullPointerException</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      situation could never occur as a result of calling the sole constructor in
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>class.<span class="Apple-converted-space">&nbsp;</span><strong>In
        effect, the</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>method functions as a
        constructor; you must ensure that it does no harm to the original object
        and that it properly establishes invariants on the clone</strong>. In
      order for the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method on<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>to
      work properly, it must copy the internals of the stack. The easiest way to
      do this is to call<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code>recursively
      on the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">elements</code><span
        class="Apple-converted-space">&nbsp;</span>array:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex34a" id="pch3ex34" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Clone method for class with references to mutable state</strong><br>
      @Override public Stack clone() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stack result = (Stack)
      super.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.elements =
      elements.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (CloneNotSupportedException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      AssertionError();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that we do not have to cast the result of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">elements.clone</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object[]</code>. Calling<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>on an array returns an array
      whose runtime and compile-time types are identical to those of the array
      being cloned. This is the preferred idiom to duplicate an array. In fact,
      arrays are the sole compelling use of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>facility.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      also that the earlier solution would not work if the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">elements</code><span class="Apple-converted-space">&nbsp;</span>field
      were final because<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>would be prohibited from
      assigning a new value to the field. This is a fundamental problem: like
      serialization,<span class="Apple-converted-space">&nbsp;</span><strong>the</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>Cloneable</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>architecture is
        incompatible with normal use of final fields referring to mutable
        objects</strong>, except in cases where the mutable objects may be
      safely shared between an object and its clone. In order to make a class
      cloneable, it may be necessary to remove<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">final</code><span class="Apple-converted-space">&nbsp;</span>modifiers
      from some fields.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is not always sufficient merely to call<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>recursively.
      For example, suppose you are writing a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      for a hash table whose internals consist of an array of buckets, each of
      which references the first entry in a linked list of key-value pairs. For
      performance, the class implements its own lightweight singly linked list
      instead of using<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.LinkedList</code><span
        class="Apple-converted-space">&nbsp;</span>internally:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex35a" id="pch3ex35" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class HashTable implements Cloneable {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Entry[] buckets = ...;<br>
      <span epub:type="pagebreak" id="page_62"></span>&nbsp;&nbsp;&nbsp;&nbsp;private
      static class Entry {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final Object key;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object value;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry&nbsp;&nbsp;next;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry(Object key, Object
      value, Entry next) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.key&nbsp;&nbsp;
      = key;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.value
      = value;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.next&nbsp;&nbsp;=
      next;&nbsp;&nbsp;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      you merely clone the bucket array recursively, as we did for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex36a" id="pch3ex36" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Broken clone method - results in shared mutable state!</strong><br>
      @Override public HashTable clone() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HashTable result =
      (HashTable) super.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.buckets =
      buckets.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (CloneNotSupportedException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      AssertionError();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Though
      the clone has its own bucket array, this array references the same linked
      lists as the original, which can easily cause nondeterministic behavior in
      both the clone and the original. To fix this problem, you’ll have to copy
      the linked list that comprises each bucket. Here is one common approach:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex37a" id="pch3ex37" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Recursive clone method for class with complex mutable state</strong><br>
      public class HashTable implements Cloneable {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Entry[] buckets = ...;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static class Entry {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final Object key;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object value;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry&nbsp;&nbsp;next;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry(Object key, Object
      value, Entry next) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.key&nbsp;&nbsp;
      = key;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.value
      = value;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.next&nbsp;&nbsp;=
      next;&nbsp;&nbsp;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      <span epub:type="pagebreak" id="page_63"></span><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>// Recursively
        copy the linked list headed by this Entry</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry deepCopy() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      new Entry(key, value,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next
      == null ? null : next.deepCopy());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public HashTable clone() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HashTable
      result = (HashTable) super.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.buckets
      = new Entry[buckets.length];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for
      (int i = 0; i &lt; buckets.length; i++)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if
      (buckets[i] != null)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.buckets[i]
      = buckets[i].deepCopy();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch
      (CloneNotSupportedException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new AssertionError();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      private class<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashTable.Entry</code><span
        class="Apple-converted-space">&nbsp;</span>has been augmented to support
      a “deep copy” method. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      on<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashTable</code><span
        class="Apple-converted-space">&nbsp;</span>allocates a new<code style="font-family: 'Courier New', monospace;">buckets</code><span
        class="Apple-converted-space">&nbsp;</span>array of the proper size and
      iterates over the original<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">buckets</code><span class="Apple-converted-space">&nbsp;</span>array,
      deep-copying each nonempty bucket. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">deepCopy</code><span class="Apple-converted-space">&nbsp;</span>method
      on<code style="font-family: 'Courier New', monospace;">Entry</code><span class="Apple-converted-space">&nbsp;</span>invokes
      itself recursively to copy the entire linked list headed by the entry.
      While this technique is cute and works fine if the buckets aren’t too
      long, it is not a good way to clone a linked list because it consumes one
      stack frame for each element in the list. If the list is long, this could
      easily cause a stack overflow. To prevent this from happening, you can
      replace the recursion in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">deepCopy</code><span class="Apple-converted-space">&nbsp;</span>with
      iteration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex38a" id="pch3ex38" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Iteratively copy the linked list headed by this Entry</strong><br>
      Entry deepCopy() {<br>
      &nbsp;&nbsp;&nbsp;Entry result = new Entry(key, value, next);<br>
      &nbsp;&nbsp;&nbsp;for (Entry p = result; p.next != null; p = p.next)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.next = new Entry(p.next.key,
      p.next.value, p.next.next);<br>
      &nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      final approach to cloning complex mutable objects is to call<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>, set
      all of the fields in the resulting object to their initial state, and then
      call higher-level methods to regenerate the state of the original object.
      In the case of our<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashTable</code><span
        class="Apple-converted-space">&nbsp;</span>example, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">buckets</code><span class="Apple-converted-space">&nbsp;</span>field
      would be initialized to a new bucket array, and the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">put(key, value)</code><span
        class="Apple-converted-space">&nbsp;</span>method (not shown) would be
      invoked for each key-value<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_64"></span>mapping in the hash table
      being cloned. This approach typically yields a simple, reasonably elegant<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method that does not run as
      quickly as one that directly manipulates the innards of the clone. While
      this approach is clean, it is antithetical to the whole<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">&nbsp;</span>architecture
      because it blindly overwrites the field-by-field object copy that forms
      the basis of the architecture.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Like
      a constructor, a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method must never invoke an
      overridable method on the clone under construction (<a href="ch4.xhtml#lev19"
        style="text-decoration: none;">Item 19</a>). If<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>invokes
      a method that is overridden in a subclass, this method will execute before
      the subclass has had a chance to fix its state in the clone, quite
      possibly leading to corruption in the clone and the original. Therefore,
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">put(key,
        value)</code><span class="Apple-converted-space">&nbsp;</span>method
      discussed in the previous paragraph should be either final or private. (If
      it is private, it is presumably the “helper method” for a nonfinal public
      method.)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><code
        style="font-family: 'Courier New', monospace;">Object</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      is declared to throw<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code>,
      but overriding methods need not.<span class="Apple-converted-space">&nbsp;</span><strong>Public</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>methods should omit
        the</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>throws</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>clause</strong>, as
      methods that don’t throw checked exceptions are easier to use (<a href="ch10.xhtml#lev71"
        style="text-decoration: none;">Item 71</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      have two choices when designing a class for inheritance (<a href="ch4.xhtml#lev19"
        style="text-decoration: none;">Item 19</a>), but whichever one you
      choose, the class should<span class="Apple-converted-space">&nbsp;</span><em>not</em><span
        class="Apple-converted-space">&nbsp;</span>implement<code style="font-family: 'Courier New', monospace;">Cloneable</code>.
      You may choose to mimic the behavior of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>by
      implementing a properly functioning protected<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      that is declared to throw<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code>.
      This gives subclasses the freedom to implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">&nbsp;</span>or
      not, just as if they extended<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>directly.
      Alternatively, you may choose<span class="Apple-converted-space">&nbsp;</span><em>not</em><span
        class="Apple-converted-space">&nbsp;</span>to implement a working<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method,
      and to prevent subclasses from implementing one, by providing the
      following degenerate<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>implementation:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex39a" id="pch3ex39" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        clone method for extendable class not supporting Cloneable</strong><br>
      @Override<br>
      protected final Object clone() throws CloneNotSupportedException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;throw new CloneNotSupportedException();<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is one more detail that bears noting. If you write a thread-safe class
      that implements<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      remember that its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method must be properly
      synchronized, just like any other method (<a href="ch11.xhtml#lev78" style="text-decoration: none;">Item
        78</a>).<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method is not synchronized,
      so even if its implementation is otherwise satisfactory, you may have to
      write a synchronized<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      that returns<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">super.clone()</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      recap, all classes that implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">&nbsp;</span>should
      override<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>with a public method whose
      return type is the class itself. This method should first call<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>, then
      fix any fields that need fixing. Typically, this means copying any mutable
      objects that comprise the internal “deep structure” of the object and
      replacing the clone’s references to these objects with references to their
      copies.<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_65"></span>While these internal copies can usually be made by
      calling<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>recursively, this is not
      always the best approach. If the class contains only primitive fields or
      references to immutable objects, then it is likely the case that no fields
      need to be fixed. There are exceptions to this rule. For example, a field
      representing a serial number or other unique ID will need to be fixed even
      if it is primitive or immutable.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Is
      all this complexity really necessary? Rarely. If you extend a class that
      already implements<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      you have little choice but to implement a well-behaved<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method.
      Otherwise, you are usually better off providing an alternative means of
      object copying.<span class="Apple-converted-space">&nbsp;</span><strong>A
        better approach to object copying is to provide a</strong><span class="Apple-converted-space">&nbsp;</span><em><strong>copy
          constructor</strong></em><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><em><strong>copy factory</strong></em><strong>.</strong><span
        class="Apple-converted-space">&nbsp;</span>A copy constructor is simply
      a constructor that takes a single argument whose type is the class
      containing the constructor, for example,</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex40a" id="pch3ex40" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Copy constructor</strong><br>
      public Yum(Yum yum) { ... };</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      copy factory is the static factory (<a href="ch2.xhtml#lev1" style="text-decoration: none;">Item
        1</a>) analogue of a copy constructor:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex41a" id="pch3ex41" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Copy factory</strong><br>
      public static Yum newInstance(Yum yum) { ... };</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      copy constructor approach and its static factory variant have many
      advantages over<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code>/<code
        style="font-family: 'Courier New', monospace;">clone</code>: they don’t
      rely on a risk-prone extralinguistic object creation mechanism; they don’t
      demand unenforceable adherence to thinly documented conventions; they
      don’t conflict with the proper use of final fields; they don’t throw
      unnecessary checked exceptions; and they don’t require casts.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Furthermore,
      a copy constructor or factory can take an argument whose type is an
      interface implemented by the class. For example, by convention all
      general-purpose collection implementations provide a constructor whose
      argument is of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code>.
      Interface-based copy constructors and factories, more properly known as<span
        class="Apple-converted-space">&nbsp;</span><em>conversion constructors</em><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><em>conversion
        factories</em>, allow the client to choose the implementation type of
      the copy rather than forcing the client to accept the implementation type
      of the original. For example, suppose you have a<code style="font-family: 'Courier New', monospace;">HashSet</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">s</code>,
      and you want to copy it as a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">TreeSet</code>. The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method can’t offer this
      functionality, but it’s easy with a conversion constructor:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">new TreeSet&lt;&gt;(s)</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Given
      all the problems associated with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code>, new
      interfaces should not extend it, and new extendable classes should not
      implement it. While it’s less harmful for final classes to implement<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      this should be viewed as a performance optimization, reserved for the rare
      cases where it is justified (<a href="ch9.xhtml#lev67" style="text-decoration: none;">Item
        67</a>). As a rule, copy functionality is best provided by constructors
      or factories. A notable exception to this rule is arrays, which are best
      copied with the clone method.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev14" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_66"></span><strong>Item 14: Consider implementing</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>Comparable</strong></code></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Unlike
      the other methods discussed in this chapter, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      is not declared in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>.
      Rather, it is the sole method in the<code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">&nbsp;</span>interface. It is similar in
      character to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method, except that it
      permits order comparisons in addition to simple equality comparisons, and
      it is generic. By implementing<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>, a
      class indicates that its instances have a<span class="Apple-converted-space">&nbsp;</span><em>natural
        ordering.</em><span class="Apple-converted-space">&nbsp;</span>Sorting
      an array of objects that implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">&nbsp;</span>is
      as simple as this:</p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Arrays.sort(a);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is similarly easy to search, compute extreme values, and maintain
      automatically sorted collections of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">&nbsp;</span>objects.
      For example, the following program, which relies on the fact that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>implements<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable</code>,
      prints an alphabetized list of its command-line arguments with duplicates
      eliminated:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex42a" id="pch3ex42" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class WordList {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt; s = new
      TreeSet&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Collections.addAll(s,
      args);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">By
      implementing<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable</code>,
      you allow your class to interoperate with all of the many generic
      algorithms and collection implementations that depend on this interface.
      You gain a tremendous amount of power for a small amount of effort.
      Virtually all of the value classes in the Java platform libraries, as well
      as all enum types (<a href="ch6.xhtml#lev34" style="text-decoration: none;">Item
        34</a>), implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>. If you
      are writing a value class with an obvious natural ordering, such as
      alphabetical order, numerical order, or chronological order, you should
      implement the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">&nbsp;</span>interface:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex43a" id="pch3ex43" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      interface Comparable&lt;T&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int compareTo(T t);<br>
      }</p>
    <p class="noindentb" style="margin-top: 0px; margin-bottom: 15px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      general contract of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      is similar to that of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code>:</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Compares
      this object with the specified object for order. Returns a negative
      integer, zero, or a positive integer as this object is less than, equal
      to, or greater than the specified object. Throws<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>if the specified object’s
      type prevents it from being compared to this object.</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_67"></span>In the following description,
      the notation<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">sgn</code>(<em>expression</em>)
      designates the mathematical<span class="Apple-converted-space">&nbsp;</span><em>signum</em><span
        class="Apple-converted-space">&nbsp;</span>function, which is defined to
      return<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">-</code>1,
      0, or 1, according to whether the value of<span class="Apple-converted-space">&nbsp;</span><em>expression</em><span
        class="Apple-converted-space">&nbsp;</span>is negative, zero, or
      positive.</p>
    <p class="bull1i" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 32px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      The implementor must ensure that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">sgn(x.compareTo(y)) ==
        -sgn(y. compareTo(x))</code><span class="Apple-converted-space">&nbsp;</span>for
      all<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">x</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">y</code>. (This implies
      that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">x.compareTo(y)</code>must
      throw an exception if and only if<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">y.compareTo(x)</code><span
        class="Apple-converted-space">&nbsp;</span>throws an exception.)</p>
    <p class="bull1i" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 32px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      The implementor must also ensure that the relation is transitive:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">(x. compareTo(y) &gt; 0
        &amp;&amp; y.compareTo(z) &gt; 0)</code><span class="Apple-converted-space">&nbsp;</span>implies<code
        style="font-family: 'Courier New', monospace;">x.compareTo(z) &gt; 0</code>.</p>
    <p class="bull1i" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 32px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Finally, the implementor must ensure that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">x.compareTo(y) == 0</code><span
        class="Apple-converted-space">&nbsp;</span>implies that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">sgn(x.compareTo(z)) ==
        sgn(y.compareTo(z))</code>, for all<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">z</code>.</p>
    <p class="bull1i" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 32px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      It is strongly recommended, but not required, that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">(x.compareTo(y) == 0) ==
        (x.equals(y))</code>. Generally speaking, any class that implements the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">&nbsp;</span>interface and violates this
      condition should clearly indicate this fact. The recommended language is
      “Note: This class has a natural ordering that is inconsistent with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code>.”</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Don’t
      be put off by the mathematical nature of this contract. Like the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>contract
      (<a href="ch3.xhtml#lev10" style="text-decoration: none;">Item 10</a>),
      this contract isn’t as complicated as it looks. Unlike the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method,
      which imposes a global equivalence relation on all objects,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>doesn’t
      have to work across objects of different types: when confronted with
      objects of different types,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>is
      permitted to throw<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code>.
      Usually, that is exactly what it does. The contract does<span class="Apple-converted-space">&nbsp;</span><em>permit</em><span
        class="Apple-converted-space">&nbsp;</span>intertype comparisons, which
      are typically defined in an interface implemented by the objects being
      compared.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Just
      as a class that violates the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">&nbsp;</span>contract
      can break other classes that depend on hashing, a class that violates the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">&nbsp;</span>contract can break other
      classes that depend on comparison. Classes that depend on comparison
      include the sorted collections<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">TreeSet</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">TreeMap</code><span
        class="Apple-converted-space">&nbsp;</span>and the utility classes<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collections</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Arrays</code>, which
      contain searching and sorting algorithms.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Let’s
      go over the provisions of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>contract.
      The first provision says that if you reverse the direction of a comparison
      between two object references, the expected thing happens: if the first
      object is less than the second, then the second must be greater than the
      first; if the first object is equal to the second, then the second must be
      equal to the first; and if the first object is greater than the second,
      then the second must be less than the first. The second provision says
      that if one object is greater than a second and the second is greater than
      a third, then the first must be greater than the third. The final
      provision says that all objects that compare as equal must yield the same
      results when compared to any other object.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_68"></span>One consequence of these three
      provisions is that the equality test imposed by a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      must obey the same restrictions imposed by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>con-tract:
      reflexivity, symmetry, and transitivity. Therefore, the same caveat
      applies: there is no way to extend an instantiable class with a new value
      component while preserving the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>contract,
      unless you are willing to forgo the benefits of object-oriented
      abstraction (<a href="ch3.xhtml#lev10" style="text-decoration: none;">Item
        10</a>). The same workaround applies, too. If you want to add a value
      component to a class that implements<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>, don’t
      extend it; write an unrelated class containing an instance of the first
      class. Then provide a “view” method that returns the contained instance.
      This frees you to implement whatever<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      you like on the containing class, while allowing its client to view an
      instance of the containing class as an instance of the contained class
      when needed.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      final paragraph of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>contract,
      which is a strong suggestion rather than a true requirement, simply states
      that the equality test imposed by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      should generally return the same results as the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method.
      If this provision is obeyed, the ordering imposed by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      is said to be<span class="Apple-converted-space">&nbsp;</span><em>consistent
        with</em><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><em>equals</em></code>.
      If it’s violated, the ordering is said to be<span class="Apple-converted-space">&nbsp;</span><em>inconsistent
        with</em><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><em>equals</em></code>.
      A class whose<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">&nbsp;</span>method imposes an order that
      is inconsistent with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>will
      still work, but sorted collections containing elements of the class may
      not obey the general contract of the appropriate collection interfaces (<code
        style="font-family: 'Courier New', monospace;">Collection</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code>, or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code>). This is
      because the general contracts for these interfaces are defined in terms of
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method, but sorted
      collections use the equality test imposed by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>in
      place of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code>.
      It is not a catastrophe if this happens, but it’s something to be aware
      of.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      example, consider the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>class,
      whose<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">&nbsp;</span>method is inconsistent with<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code>.
      If you create an empty<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>instance
      and then add<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">new
        BigDecimal("1.0")</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">new
        BigDecimal("1.00")</code>, the set will contain two elements because the
      two<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigDecimal</code><span
        class="Apple-converted-space">&nbsp;</span>instances added to the set
      are unequal when compared using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method.
      If, however, you perform the same procedure using a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">TreeSet</code><span class="Apple-converted-space">&nbsp;</span>instead
      of a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code>,
      the set will contain only one element because the two<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>instances
      are equal when compared using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method.
      (See the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigDecimal</code><span
        class="Apple-converted-space">&nbsp;</span>documentation for details.)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Writing
      a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">&nbsp;</span>method is similar to writing
      an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method, but there are a few
      key differences. Because the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">&nbsp;</span>interface
      is parameterized, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      is statically typed, so you don’t need to type check or cast its argument.
      If the argument is of the wrong type, the invocation won’t even compile.
      If the argument is<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">null</code>,
      the invocation should throw a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">NullPointer-Exception</code>,
      and it will, as soon as the method attempts to access its members.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_69"></span>In a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method,
      fields are compared for order rather than equality. To compare object
      reference fields, invoke the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      recursively. If a field does not implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">&nbsp;</span>or
      you need a nonstandard ordering, use a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparator</code><span class="Apple-converted-space">&nbsp;</span>instead.
      You can write your own comparator or use an existing one, as in this<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">&nbsp;</span>method for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space">&nbsp;</span>in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev10" style="text-decoration: none;">Item 10</a>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex44a" id="pch3ex44" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Single-field Comparable with object reference field</strong><br>
      public final class CaseInsensitiveString<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implements
      Comparable&lt;CaseInsensitiveString&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int compareTo(CaseInsensitiveString cis) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      String.CASE_INSENSITIVE_ORDER.compare(s, cis.s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space">&nbsp;</span>implements<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable&lt;CaseInsensitiveString&gt;</code>.
      This means that a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code>reference
      can be compared only to another<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space">&nbsp;</span>reference. This is the normal
      pattern to follow when declaring a class to implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Prior
      editions of this book recommended that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>methods
      compare integral primitive fields using the relational operators<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">&lt;</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">&gt;</code>,
      and floating point primitive fields using the static methods<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Double.compare</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Float.compare</code>. In
      Java 7, static<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compare</code><span
        class="Apple-converted-space">&nbsp;</span>methods were added to all of
      Java’s boxed primitive classes.<span class="Apple-converted-space">&nbsp;</span><strong>Use
        of the relational operators</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>&lt;</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>and</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>&gt;</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>in</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>compareTo</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>methods is verbose
        and error-prone and no longer recommended.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      a class has multiple significant fields, the order in which you compare
      them is critical. Start with the most significant field and work your way
      down. If a comparison results in anything other than zero (which
      represents equality), you’re done; just return the result. If the most
      significant field is equal, compare the next-most-significant field, and
      so on, until you find an unequal field or compare the least significant
      field. Here is a<code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">&nbsp;</span>method for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>class
      in<span class="Apple-converted-space">&nbsp;</span><a href="ch3.xhtml#lev11"
        style="text-decoration: none;">Item 11</a><span class="Apple-converted-space">&nbsp;</span>demonstrating
      this technique:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex45a" id="pch3ex45" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Multiple-field Comparable with primitive fields</strong><br>
      public int compareTo(PhoneNumber pn) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int result = Short.compare(areaCode, pn.areaCode);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (result == 0)&nbsp;&nbsp;{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result =
      Short.compare(prefix, pn.prefix);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (result == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result
      = Short.compare(lineNum, pn.lineNum);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_70"></span>In Java 8, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparator</code><span class="Apple-converted-space">&nbsp;</span>interface
      was outfitted with a set of<span class="Apple-converted-space">&nbsp;</span><em>comparator
        construction methods</em>, which enable fluent construction of
      comparators. These comparators can then be used to implement a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method,
      as required by the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">&nbsp;</span>interface. Many programmers
      prefer the conciseness of this approach, though it does come at a modest
      performance cost: sorting arrays of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code>instances
      is about 10% slower on my machine. When using this approach, consider
      using Java’s<span class="Apple-converted-space">&nbsp;</span><em>static
        import</em><span class="Apple-converted-space">&nbsp;</span>facility so
      you can refer to static comparator construction methods by their simple
      names for clarity and brevity. Here’s how the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>method
      for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>looks using this approach:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex46a" id="pch3ex46" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Comparable with comparator construction methods</strong><br>
      private static final Comparator&lt;PhoneNumber&gt; COMPARATOR =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comparingInt((PhoneNumber
      pn) -&gt; pn.areaCode)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.thenComparingInt(pn
      -&gt; pn.prefix)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.thenComparingInt(pn
      -&gt; pn.lineNum);<br>
      <br>
      public int compareTo(PhoneNumber pn) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return COMPARATOR.compare(this, pn);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      implementation builds a comparator at class initialization time, using two
      comparator construction methods. The first is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">comparingInt</code>. It
      is a static method that takes a<span class="Apple-converted-space">&nbsp;</span><em>key
        extractor function</em><span class="Apple-converted-space">&nbsp;</span>that
      maps an object reference to a key of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>and
      returns a comparator that orders instances according to that key. In the
      previous example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">comparingInt</code><span
        class="Apple-converted-space">&nbsp;</span>takes a<span class="Apple-converted-space">&nbsp;</span><em>lambda</em><span
        class="Apple-converted-space">&nbsp;</span>() that extracts the area
      code from a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>and returns a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparator&lt;PhoneNumber&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>that orders phone numbers
      according to their area codes. Note that the lambda explicitly specifies
      the type of its input parameter (<code style="font-family: 'Courier New', monospace;">PhoneNumber
        pn</code>). It turns out that in this situation, Java’s type inference
      isn’t powerful enough to figure the type out for itself, so we’re forced
      to help it in order to make the program compile.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      two phone numbers have the same area code, we need to further refine the
      comparison, and that’s exactly what the second comparator construction
      method,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">thenComparingInt</code>,
      does. It is an instance method on<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparator</code><span class="Apple-converted-space">&nbsp;</span>that
      takes an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space">&nbsp;</span>key extractor function, and
      returns a comparator that first applies the original comparator and then
      uses the extracted key to break ties. You can stack up as many calls to<code
        style="font-family: 'Courier New', monospace;">thenComparingInt</code><span
        class="Apple-converted-space">&nbsp;</span>as you like, resulting in a<span
        class="Apple-converted-space">&nbsp;</span><em>lexicographic ordering</em>.
      In the example above, we stack up two calls to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">thenComparingInt</code>,
      resulting in an ordering whose secondary key is the prefix and whose
      tertiary key is the line number. Note that we did<span class="Apple-converted-space">&nbsp;</span><em>not</em><span
        class="Apple-converted-space">&nbsp;</span>have to specify the parameter
      type of the key extractor function passed to either of the calls to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">thenComparingInt</code>:
      Java’s type inference was smart enough to figure this one out for itself.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_71"></span>The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparator</code><span class="Apple-converted-space">&nbsp;</span>class
      has a full complement of construction methods. There are analogues to<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">comparingInt</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">thenComparingInt</code><span
        class="Apple-converted-space">&nbsp;</span>for the primitive types<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">long</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">double</code>. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>versions
      can also be used for narrower integral types, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">short</code>, as in our<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>example. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">double</code><span class="Apple-converted-space">&nbsp;</span>versions
      can also be used for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">float</code>. This
      provides coverage of all of Java’s numerical primitive types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are also comparator construction methods for object reference types. The
      static method, named<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">comparing</code>, has two
      overloadings. One takes a key extractor and uses the keys’ natural order.
      The second takes both a key extractor and a comparator to be used on the
      extracted keys. There are three overloadings of the instance method, which
      is named<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">thenComparing</code>.
      One overloading takes only a comparator and uses it to provide a secondary
      order. A second overloading takes only a key extractor and uses the key’s
      natural order as a secondary order. The final overloading takes both a key
      extractor and a comparator to be used on the extracted keys.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Occasionally
      you may see<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compare</code><span class="Apple-converted-space">&nbsp;</span>methods
      that rely on the fact that the difference between two values is negative
      if the first value is less than the second, zero if the two values are
      equal, and positive if the first value is greater. Here is an example:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex47a" id="pch3ex47" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        BROKEN difference-based comparator - violates transitivity!</strong><br>
      static Comparator&lt;Object&gt; hashCodeOrder = new Comparator&lt;&gt;() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int compare(Object o1, Object o2) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return o1.hashCode() -
      o2.hashCode();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      };</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Do
      not use this technique. It is fraught with danger from integer overflow
      and IEEE 754 floating point arithmetic artifacts [<a href="ref.xhtml#rJLS"
        style="text-decoration: none;">JLS 15.20.1, 15.21.1</a>]. Furthermore,
      the resulting methods are unlikely to be significantly faster than those
      written using the techniques described in this item. Use either a static<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compare</code><span
        class="Apple-converted-space">&nbsp;</span>method:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex48a" id="pch3ex48" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Comparator based on static compare method</strong><br>
      static Comparator&lt;Object&gt; hashCodeOrder = new Comparator&lt;&gt;() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int compare(Object o1, Object o2) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      Integer.compare(o1.hashCode(), o2.hashCode());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      };</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">or
      a comparator construction method:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex49a" id="pch3ex49" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Comparator based on Comparator construction method</strong><br>
      static Comparator&lt;Object&gt; hashCodeOrder =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comparator.comparingInt(o
      -&gt; o.hashCode());</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_72"></span>In summary, whenever you
      implement a value class that has a sensible ordering, you should have the
      class implement the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>interface
      so that its instances can be easily sorted, searched, and used in
      comparison-based collections. When comparing field values in the
      implementations of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">&nbsp;</span>methods,
      avoid the use of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">&lt;</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>operators. Instead, use the
      static<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">compare</code><span
        class="Apple-converted-space">&nbsp;</span>methods in the boxed
      primitive classes or the comparator construction methods in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparator</code><span class="Apple-converted-space">&nbsp;</span>interface.</p>
    <p></p>
    <p> </p>
    <h2 class="h2" id="ch4" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Chapter
      4. Classes and Interfaces</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>C</strong><small
        style="font-size: 0.7em;">LASSES</small><span class="Apple-converted-space">&nbsp;</span>and
      interfaces lie at the heart of the Java programming language. They are its
      basic units of abstraction. The language provides many powerful elements
      that you can use to design classes and interfaces. This chapter contains
      guidelines to help you make the best use of these elements so that your
      classes and interfaces are usable, robust, and flexible.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev15" style="text-decoration: none;"></a><strong>Item 15: Minimize
        the accessibility of classes and members</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      single most important factor that distinguishes a well-designed component
      from a poorly designed one is the degree to which the component hides its
      internal data and other implementation details from other components. A
      well-designed component hides all its implementation details, cleanly
      separating its API from its implementation. Components then communicate
      only through their APIs and are oblivious to each others’ inner workings.
      This concept, known as<span class="Apple-converted-space">&nbsp;</span><em>information
        hiding</em><span class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><em>encapsulation</em>,
      is a fundamental tenet of software design [<a href="ref.xhtml#rParnas72" style="text-decoration: none;">Parnas72</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Information
      hiding is important for many reasons, most of which stem from the fact
      that it<span class="Apple-converted-space">&nbsp;</span><em>decouples</em><span
        class="Apple-converted-space">&nbsp;</span>the components that comprise
      a system, allowing them to be developed, tested, optimized, used,
      understood, and modified in isolation. This speeds up system development
      because components can be developed in parallel. It eases the burden of
      maintenance because components can be understood more quickly and debugged
      or replaced with little fear of harming other components. While
      information hiding does not, in and of itself, cause good performance, it
      enables effective performance tuning: once a system is complete and
      profiling has determined which components are causing performance problems
      (<a href="ch9.xhtml#lev67" style="text-decoration: none;">Item 67</a>),
      those components can be optimized without affecting the correctness of
      others. Information hiding increases software reuse because components
      that aren’t tightly coupled often prove useful in other contexts besides
      the ones for which they were<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_74"></span>developed. Finally,
      information hiding decreases the risk in building large systems because
      individual components may prove successful even if the system does not.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Java
      has many facilities to aid in information hiding. The<span class="Apple-converted-space">&nbsp;</span><em>access
        control</em><span class="Apple-converted-space">&nbsp;</span>mechanism
      [JLS, 6.6] specifies the<span class="Apple-converted-space">&nbsp;</span><em>accessibility</em><span
        class="Apple-converted-space">&nbsp;</span>of classes, interfaces, and
      members. The accessibility of an entity is determined by the location of
      its declaration and by which, if any, of the access modifiers (<code style="font-family: 'Courier New', monospace;">private</code>,<code
        style="font-family: 'Courier New', monospace;">protected</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">public</code>)
      is present on the declaration. Proper use of these modifiers is essential
      to information hiding.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      rule of thumb is simple:<span class="Apple-converted-space">&nbsp;</span><strong>make
        each class or member as inaccessible as possible.</strong><span class="Apple-converted-space">&nbsp;</span>In
      other words, use the lowest possible access level consistent with the
      proper functioning of the software that you are writing.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      top-level (non-nested) classes and interfaces, there are only two possible
      access levels:<span class="Apple-converted-space">&nbsp;</span><em>package-private</em><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><em>public</em>.
      If you declare a top-level class or interface with the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">public</code><span class="Apple-converted-space">&nbsp;</span>modifier,
      it will be public; otherwise, it will be package-private. If a top-level
      class or interface can be made package-private, it should be. By making it
      package-private, you make it part of the implementation rather than the
      exported API, and you can modify it, replace it, or eliminate it in a
      subsequent release without fear of harming existing clients. If you make
      it public, you are obligated to support it forever to maintain
      compatibility.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      a package-private top-level class or interface is used by only one class,
      consider making the top-level class a private static nested class of the
      sole class that uses it (<a href="ch4.xhtml#lev24" style="text-decoration: none;">Item
        24</a>). This reduces its accessibility from all the classes in its
      package to the one class that uses it. But it is far more important to
      reduce the accessibility of a gratuitously public class than of a
      package-private top-level class: the public class is part of the package’s
      API, while the package-private top-level class is already part of its
      implementation.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      members (fields, methods, nested classes, and nested interfaces), there
      are four possible access levels, listed here in order of increasing
      accessibility:</p>
    <p class="bullb1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>private</strong>—The
      member is accessible only from the top-level class where it is declared.</p>
    <p class="bullb1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>package-private</strong>—The
      member is accessible from any class in the package where it is declared.
      Technically known as<span class="Apple-converted-space">&nbsp;</span><em>default</em><span
        class="Apple-converted-space">&nbsp;</span>access, this is the access
      level you get if no access modifier is specified (except for interface
      members, which are public by default).</p>
    <p class="bullb1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>protected</strong>—The
      member is accessible from subclasses of the class where it is declared
      (subject to a few restrictions [JLS, 6.6.2]) and from any class in the
      package where it is declared.</p>
    <p class="bullb1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>public</strong>—The
      member is accessible from anywhere.</p>
    <p class="indentt" style="margin-top: 13.333334px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_75"></span>After carefully designing your
      class’s public API, your reflex should be to make all other members
      private. Only if another class in the same package really needs to access
      a member should you remove the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">private</code><span class="Apple-converted-space">&nbsp;</span>modifier,
      making the member package-private. If you find yourself doing this often,
      you should reexamine the design of your system to see if another
      decomposition might yield classes that are better decoupled from one
      another. That said, both private and package-private members are part of a
      class’s implementation and do not normally impact its exported API. These
      fields can, however, “leak” into the exported API if the class implements<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch12.xhtml#lev86" style="text-decoration: none;">Items
        86</a><span class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><a
        href="ch12.xhtml#lev87" style="text-decoration: none;">87</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      members of public classes, a huge increase in accessibility occurs when
      the access level goes from package-private to protected. A protected
      member is part of the class’s exported API and must be supported forever.
      Also, a protected member of an exported class represents a public
      commitment to an implementation detail (<a href="ch4.xhtml#lev19" style="text-decoration: none;">Item
        19</a>). The need for protected members should be relatively rare.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is a key rule that restricts your ability to reduce the accessibility of
      methods. If a method overrides a superclass method, it cannot have a more
      restrictive access level in the subclass than in the superclass [JLS,
      8.4.8.3]. This is necessary to ensure that an instance of the subclass is
      usable anywhere that an instance of the superclass is usable (the<span class="Apple-converted-space">&nbsp;</span><em>Liskov
        substitution principle</em>, see<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev15" style="text-decoration: none;">Item 15</a>). If
      you violate this rule, the compiler will generate an error message when
      you try to compile the subclass. A special case of this rule is that if a
      class implements an interface, all of the class methods that are in the
      interface must be declared public in the class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      facilitate testing your code, you may be tempted to make a class,
      interface, or member more accessible than otherwise necessary. This is
      fine up to a point. It is acceptable to make a private member of a public
      class package-private in order to test it, but it is not acceptable to
      raise the accessibility any higher. In other words, it is not acceptable
      to make a class, interface, or member a part of a pack-age’s exported API
      to facilitate testing. Luckily, it isn’t necessary either because tests
      can be made to run as part of the package being tested, thus gaining
      access to its package-private elements.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Instance
        fields of public classes should rarely be public</strong><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch4.xhtml#lev16" style="text-decoration: none;">Item 16</a>). If
      an instance field is nonfinal or is a reference to a mutable object, then
      by making it public, you give up the ability to limit the values that can
      be stored in the field. This means you give up the ability to enforce
      invariants involving the field. Also, you give up the ability to take any
      action when the field is modified, so<span class="Apple-converted-space">&nbsp;</span><strong>classes
        with public mutable fields are not generally thread-safe.</strong><span
        class="Apple-converted-space">&nbsp;</span>Even if a field is final and
      refers to an immutable object, by making it public you give up the
      flexibility to switch to a new internal data representation in which the
      field does not exist.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_76"></span>The same advice applies to
      static fields, with one exception. You can expose constants via public
      static final fields, assuming the constants form an integral part of the
      abstraction provided by the class. By convention, such fields have names
      consisting of capital letters, with words separated by underscores (<a href="ch9.xhtml#lev68"
        style="text-decoration: none;">Item 68</a>). It is critical that these
      fields contain either primitive values or references to immutable objects
      (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Item 17</a>). a
      field containing a reference to a mutable object has all the disadvantages
      of a nonfinal field. While the reference cannot be modified, the
      referenced object can be modified—with disastrous results.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that a nonzero-length array is always mutable, so<span class="Apple-converted-space">&nbsp;</span><strong>it
        is wrong for a class to have a public static final array field, or an
        accessor that returns such a field.</strong><span class="Apple-converted-space">&nbsp;</span>If
      a class has such a field or accessor, clients will be able to modify the
      contents of the array. This is a frequent source of security holes:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex1a" id="pch4ex1" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Potential security hole!</strong><br>
      public static final Thing[] VALUES = { ... };</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Beware
      of the fact that some IDEs generate accessors that return references to
      private array fields, resulting in exactly this problem. There are two
      ways to fix the problem. You can make the public array private and add a
      public immutable list:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex2a" id="pch4ex2" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">private
      static final Thing[] PRIVATE_VALUES = { ... };<br>
      public static final List&lt;Thing&gt; VALUES =<br>
&nbsp;&nbsp;&nbsp;Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Alternatively,
      you can make the array private and add a public method that returns a copy
      of a private array:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex3a" id="pch4ex3" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">private
      static final Thing[] PRIVATE_VALUES = { ... };<br>
      public static final Thing[] values() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return PRIVATE_VALUES.clone();<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      choose between these alternatives, think about what the client is likely
      to do with the result. Which return type will be more convenient? Which
      will give better performance?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      of Java 9, there are two additional, implicit access levels introduced as
      part of the<span class="Apple-converted-space">&nbsp;</span><em>module
        system</em>. A module is a grouping of packages, like a package is a
      grouping of classes. A module may explicitly export some of its packages
      via<span class="Apple-converted-space">&nbsp;</span><em>export
        declarations</em><span class="Apple-converted-space">&nbsp;</span>in its<span
        class="Apple-converted-space">&nbsp;</span><em>module declaration</em><span
        class="Apple-converted-space">&nbsp;</span>(which is by convention
      contained in a source file named<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">module-info.java</code>).
      Public and protected members of unexported packages in a module are
      inaccessible outside the module; within the<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_77"></span>module, accessibility is
      unaffected by export declarations. Using the module system allows you to
      share classes among packages within a module without making them visible
      to the entire world. Public and protected members of public classes in
      unexported packages give rise to the two implicit access levels, which are
      intramodular analogues of the normal public and protected levels. The need
      for this kind of sharing is relatively rare and can often be eliminated by
      rearranging the classes within your packages.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Unlike
      the four main access levels, the two module-based levels are largely
      advisory. If you place a module’s JAR file on your application’s class
      path instead of its module path, the packages in the module revert to
      their non-modular behavior: all of the public and protected members of the
      packages’ public classes have their normal accessibility, regardless of
      whether the packages are exported by the module [Reinhold, 1.2]. The one
      place where the newly introduced access levels are strictly enforced is
      the JDK itself: the unexported packages in the Java libraries are truly
      inaccessible outside of their modules.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Not
      only is the access protection afforded by modules of limited utility to
      the typical Java programmer, and largely advisory in nature; in order to
      take advantage of it, you must group your packages into modules, make all
      of their dependencies explicit in module declarations, rearrange your
      source tree, and take special actions to accommodate any access to
      non-modularized packages from within your modules [Reinhold, 3]. It is too
      early to say whether modules will achieve widespread use outside of the
      JDK itself. In the meantime, it seems best to avoid them unless you have a
      compelling need.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      summarize, you should reduce accessibility of program elements as much as
      possible (within reason). After carefully designing a minimal public API,
      you should prevent any stray classes, interfaces, or members from becoming
      part of the API. With the exception of public static final fields, which
      serve as constants, public classes should have no public fields. Ensure
      that objects referenced by public static final fields are immutable.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev16" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_78"></span><strong>Item 16: In public classes, use accessor
        methods, not public fields</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Occasionally,
      you may be tempted to write degenerate classes that serve no purpose other
      than to group instance fields:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex4a" id="pch4ex4" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Degenerate classes like this should not be public!</strong><br>
      class Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public double x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public double y;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      the data fields of such classes are accessed directly, these classes do
      not offer the benefits of<span class="Apple-converted-space">&nbsp;</span><em>encapsulation</em><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch4.xhtml#lev15" style="text-decoration: none;">Item
        15</a>). You can’t change the representation without changing the API,
      you can’t enforce invariants, and you can’t take auxiliary action when a
      field is accessed. Hard-line object-oriented programmers feel that such
      classes are anathema and should always be replaced by classes with private
      fields and public<span class="Apple-converted-space">&nbsp;</span><em>accessor
        methods</em><span class="Apple-converted-space">&nbsp;</span>(getters)
      and, for mutable classes,<span class="Apple-converted-space">&nbsp;</span><em>mutators</em><span
        class="Apple-converted-space">&nbsp;</span>(setters):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex5a" id="pch4ex5" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Encapsulation of data by accessor methods and mutators</strong><br>
      class Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private double x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private double y;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Point(double x, double y) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.x = x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.y = y;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public double getX() { return x; }</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public double getY() { return y; }</strong><br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public void setX(double x) { this.x = x; }</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public void setY(double y) { this.y = y; }</strong><br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Certainly,
      the hard-liners are correct when it comes to public classes:<span class="Apple-converted-space">&nbsp;</span><strong>if
        a class is accessible outside its package, provide accessor methods</strong><span
        class="Apple-converted-space">&nbsp;</span>to preserve the flexibility
      to change the class’s internal representation. If a public class exposes
      its data fields, all hope of changing its representation is lost because
      client code can be distributed far and wide.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">However,<span
        class="Apple-converted-space">&nbsp;</span><strong>if a class is
        package-private or is a private nested class, there is nothing
        inherently wrong with exposing its data fields</strong>—assuming they do
      an<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_79"></span>adequate job of describing the abstraction provided
      by the class. This approach generates less visual clutter than the
      accessor-method approach, both in the class definition and in the client
      code that uses it. While the client code is tied to the class’s internal
      representation, this code is confined to the package containing the class.
      If a change in representation becomes desirable, you can make the change
      without touching any code outside the package. In the case of a private
      nested class, the scope of the change is further restricted to the
      enclosing class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Several
      classes in the Java platform libraries violate the advice that public
      classes should not expose fields directly. Prominent examples include the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dimension</code><span class="Apple-converted-space">&nbsp;</span>classes
      in the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.awt</code><span
        class="Apple-converted-space">&nbsp;</span>package. Rather than examples
      to be emulated, these classes should be regarded as cautionary tales. As
      described in<span class="Apple-converted-space">&nbsp;</span><a href="ch9.xhtml#lev67"
        style="text-decoration: none;">Item 67</a>, the decision to expose the
      internals of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Dimension</code><span
        class="Apple-converted-space">&nbsp;</span>class resulted in a serious
      performance problem that is still with us today.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      it’s never a good idea for a public class to expose fields directly, it is
      less harmful if the fields are immutable. You can’t change the
      representation of such a class without changing its API, and you can’t
      take auxiliary actions when a field is read, but you can enforce
      invariants. For example, this class guarantees that each instance
      represents a valid time:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex6a" id="pch4ex6" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Public class with exposed immutable fields - questionable</strong><br>
      public final class Time {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int
      HOURS_PER_DAY&nbsp;&nbsp;&nbsp;&nbsp;= 24;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int MINUTES_PER_HOUR = 60;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public final int hour;</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public final int minute;</strong><br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Time(int hour, int minute) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (hour &lt; 0 || hour
      &gt;= HOURS_PER_DAY)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new
      IllegalArgumentException("Hour: " + hour);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (minute &lt; 0 ||
      minute &gt;= MINUTES_PER_HOUR)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new
      IllegalArgumentException("Min: " + minute);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.hour = hour;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.minute = minute;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, public classes should never expose mutable fields. It is less
      harmful, though still questionable, for public classes to expose immutable
      fields. It is, however, sometimes desirable for package-private or private
      nested classes to expose fields, whether mutable or immutable.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev17" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_80"></span><strong>Item 17: Minimize mutability</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">An
      immutable class is simply a class whose instances cannot be modified. All
      of the information contained in each instance is fixed for the lifetime of
      the object, so no changes can ever be observed. The Java platform
      libraries contain many immutable classes, including<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>, the boxed
      primitive classes, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigDecimal</code>.
      There are many good reasons for this: Immutable classes are easier to
      design, implement, and use than mutable classes. They are less prone to
      error and are more secure.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make a class immutable, follow these five rules:</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1.<span
        class="Apple-converted-space">&nbsp;</span><strong>Don’t provide methods
        that modify the object’s state</strong><span class="Apple-converted-space">&nbsp;</span>(known
      as<span class="Apple-converted-space">&nbsp;</span><em>mutators</em>).</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2.<span
        class="Apple-converted-space">&nbsp;</span><strong>Ensure that the class
        can’t be extended.</strong><span class="Apple-converted-space">&nbsp;</span>This
      prevents careless or malicious subclasses from compromising the immutable
      behavior of the class by behaving as if the object’s state has changed.
      Preventing subclassing is generally accomplished by making the class
      final, but there is an alternative that we’ll discuss later.</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3.<span
        class="Apple-converted-space">&nbsp;</span><strong>Make all fields
        final.</strong><span class="Apple-converted-space">&nbsp;</span>This
      clearly expresses your intent in a manner that is enforced by the system.
      Also, it is necessary to ensure correct behavior if a reference to a newly
      created instance is passed from one thread to another without
      synchronization, as spelled out in the<em>memory model</em><span class="Apple-converted-space">&nbsp;</span>[JLS,
      17.5; Goetz06, 16].</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">4.<span
        class="Apple-converted-space">&nbsp;</span><strong>Make all fields
        private.</strong><span class="Apple-converted-space">&nbsp;</span>This
      prevents clients from obtaining access to mutable objects referred to by
      fields and modifying these objects directly. While it is technically
      permissible for immutable classes to have public final fields containing
      primitive values or references to immutable objects, it is not recommended
      because it precludes changing the internal representation in a later
      release (<a href="ch4.xhtml#lev15" style="text-decoration: none;">Items 15</a><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev16" style="text-decoration: none;">16</a>).</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">5.<span
        class="Apple-converted-space">&nbsp;</span><strong>Ensure exclusive
        access to any mutable components.</strong><span class="Apple-converted-space">&nbsp;</span>If
      your class has any fields that refer to mutable objects, ensure that
      clients of the class cannot obtain references to these objects. Never
      initialize such a field to a client-provided object reference or return
      the field from an accessor. Make<span class="Apple-converted-space">&nbsp;</span><em>defensive
        copies</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch8.xhtml#lev50"
        style="text-decoration: none;">Item 50</a>) in constructors, accessors,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readObject</code><span
        class="Apple-converted-space">&nbsp;</span>methods (<a href="ch12.xhtml#lev88"
        style="text-decoration: none;">Item 88</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      of the example classes in previous items are immutable. One such class is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev11" style="text-decoration: none;">Item 11</a>, which
      has accessors for each attribute but no corresponding mutators. Here is a
      slightly more complex example:</p>
    <span epub:type="pagebreak" id="page_81" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex7a" id="pch4ex7" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Immutable complex number class</strong><br>
      public<span class="Apple-converted-space">&nbsp;</span><strong>final</strong>&nbsp;&nbsp;class
      Complex {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private final</strong>&nbsp;&nbsp;double
      re;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private final</strong>&nbsp;&nbsp;double
      im;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex(double re, double im) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.re = re;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.im = im;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public double
      realPart()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ return re; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public double imaginaryPart() { return im; }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex plus(Complex c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex(re +
      c.re, im + c.im);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex minus(Complex c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex(re -
      c.re, im - c.im);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex times(Complex c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex(re *
      c.re - im * c.im,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      re * c.im + im * c.re);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex dividedBy(Complex c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double tmp = c.re * c.re +
      c.im * c.im;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex((re *
      c.re + im * c.im) / tmp,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      (im * c.re - re * c.im) / tmp);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (o == this)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!(o instanceof Complex))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Complex c = (Complex) o;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // See page 47 to find out why we use
      compare instead of ==<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Double.compare(c.re, re) == 0<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp;
      Double.compare(c.im, im) == 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 31 *
      Double.hashCode(re) + Double.hashCode(im);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public String toString() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "(" + re + " + " +
      im + "i)";<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_82"></span>This class represents a<span class="Apple-converted-space">&nbsp;</span><em>complex
        number</em><span class="Apple-converted-space">&nbsp;</span>(a number
      with both real and imaginary parts). In addition to the standard<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods,
      it provides accessors for the real and imaginary parts and provides the
      four basic arithmetic operations: addition, subtraction, multiplication,
      and division. Notice how the arithmetic operations create and return a new<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Complex</code><span
        class="Apple-converted-space">&nbsp;</span>instance rather than
      modifying this instance. This pattern is known as the<em>functional</em><span
        class="Apple-converted-space">&nbsp;</span>approach because methods
      return the result of applying a function to their operand, without
      modifying it. Contrast it to the<span class="Apple-converted-space">&nbsp;</span><em>procedural</em>or<span
        class="Apple-converted-space">&nbsp;</span><em>imperative</em><span class="Apple-converted-space">&nbsp;</span>approach
      in which methods apply a procedure to their operand, causing its state to
      change. Note that the method names are prepositions (such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">plus</code>) rather than
      verbs (such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">add</code>).
      This emphasizes the fact that methods don’t change the values of the
      objects. The<code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>classes
      did<span class="Apple-converted-space">&nbsp;</span><em>not</em><span class="Apple-converted-space">&nbsp;</span>obey
      this naming convention, and it led to many usage errors.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      functional approach may appear unnatural if you’re not familiar with it,
      but it enables immutability, which has many advantages.<strong>Immutable
        objects are simple.</strong><span class="Apple-converted-space">&nbsp;</span>An
      immutable object can be in exactly one state, the state in which it was
      created. If you make sure that all constructors establish class
      invariants, then it is guaranteed that these invariants will remain true
      for all time, with no further effort on your part or on the part of the
      programmer who uses the class. Mutable objects, on the other hand, can
      have arbitrarily complex state spaces. If the documentation does not
      provide a precise description of the state transitions performed by
      mutator methods, it can be difficult or impossible to use a mutable class
      reliably.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Immutable
        objects are inherently thread-safe; they require no synchronization.</strong><span
        class="Apple-converted-space">&nbsp;</span>They cannot be corrupted by
      multiple threads accessing them concurrently. This is far and away the
      easiest approach to achieve thread safety. Since no thread can ever
      observe any effect of another thread on an immutable object,<span class="Apple-converted-space">&nbsp;</span><strong>immutable
        objects can be shared freely.</strong><span class="Apple-converted-space">&nbsp;</span>Immutable
      classes should therefore encourage clients to reuse existing instances
      wherever possible. One easy way to do this is to provide public static
      final constants for commonly used values. For example, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Complex</code><span class="Apple-converted-space">&nbsp;</span>class
      might provide these constants:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex8a" id="pch4ex8" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static final Complex ZERO = new Complex(0, 0);<br>
      public static final Complex ONE&nbsp;&nbsp;= new Complex(1, 0);<br>
      public static final Complex I&nbsp;&nbsp;&nbsp;&nbsp;= new Complex(0, 1);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      approach can be taken one step further. An immutable class can provide
      static factories (<a href="ch2.xhtml#lev1" style="text-decoration: none;">Item
        1</a>) that cache frequently requested instances to avoid creating new
      instances when existing ones would do. All the boxed primitive classes and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>do this. Using such static
      factories causes clients to share instances instead of creating new ones,
      reducing memory footprint and garbage collection<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_83"></span>costs. Opting for static
      factories in place of public constructors when designing a new class gives
      you the flexibility to add caching later, without modifying clients.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      consequence of the fact that immutable objects can be shared freely is
      that you never have to make<span class="Apple-converted-space">&nbsp;</span><em>defensive
        copies</em><span class="Apple-converted-space">&nbsp;</span>of them (<a
        href="ch8.xhtml#lev50" style="text-decoration: none;">Item 50</a>). In
      fact, you never have to make any copies at all because the copies would be
      forever equivalent to the originals. Therefore, you need not and should
      not provide a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method or<span class="Apple-converted-space">&nbsp;</span><em>copy
        constructor</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch3.xhtml#lev13"
        style="text-decoration: none;">Item 13</a>) on an immutable class. This
      was not well understood in the early days of the Java platform, so the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>class does have a copy
      constructor, but it should rarely, if ever, be used (<a href="ch2.xhtml#lev6"
        style="text-decoration: none;">Item 6</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Not
        only can you share immutable objects, but they can share their
        internals.</strong><span class="Apple-converted-space">&nbsp;</span>For
      example, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>class uses a sign-magnitude
      representation internally. The sign is represented by an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code>, and the
      magnitude is represented by an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>array.
      The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">negate</code><span
        class="Apple-converted-space">&nbsp;</span>method produces a new<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">&nbsp;</span>of
      like magnitude and opposite sign. It does not need to copy the array even
      though it is mutable; the newly created<code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>points to the same internal
      array as the original.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Immutable
        objects make great building blocks for other objects,</strong><span class="Apple-converted-space">&nbsp;</span>whether
      mutable or immutable. It’s much easier to maintain the invariants of a
      complex object if you know that its component objects will not change
      underneath it. A special case of this principle is that immutable objects
      make great map keys and set elements: you don’t have to worry about their
      values changing once they’re in the map or set, which would destroy the
      map or set’s invariants.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Immutable
        objects provide failure atomicity for free</strong><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch10.xhtml#lev76" style="text-decoration: none;">Item 76</a>).
      Their state never changes, so there is no possibility of a temporary
      inconsistency.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The
        major disadvantage of immutable classes is that they require a separate
        object for each distinct value.</strong><span class="Apple-converted-space">&nbsp;</span>Creating
      these objects can be costly, especially if they are large. For example,
      suppose that you have a million-bit<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">&nbsp;</span>and
      you want to change its low-order bit:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BigInteger
      moby = ...;<br>
      moby = moby.flipBit(0);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">flipBit</code><span
        class="Apple-converted-space">&nbsp;</span>method creates a new<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">&nbsp;</span>instance,
      also a million bits long, that differs from the original in only one bit.
      The operation requires time and space proportional to the size of the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code>.
      Contrast this to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.BitSet</code>.
      Like<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BitSet</code><span
        class="Apple-converted-space">&nbsp;</span>represents an arbitrarily
      long sequence of bits, but unlike<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BitSet</code><span class="Apple-converted-space">&nbsp;</span>is
      mutable. The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BitSet</code><span
        class="Apple-converted-space">&nbsp;</span>class provides a method that
      allows you to change the state of a single bit of a million-bit instance
      in constant time:</p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BitSet
      moby = ...;<br>
      moby.flip(0);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_84"></span>The performance problem is
      magnified if you perform a multistep operation that generates a new object
      at every step, eventually discarding all objects except the final result.
      There are two approaches to coping with this problem. The first is to
      guess which multistep operations will be commonly required and to provide
      them as primitives. If a multistep operation is provided as a primitive,
      the immutable class does not have to create a separate object at each
      step. Internally, the immutable class can be arbitrarily clever. For
      example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>has a package-private mutable
      “companion class” that it uses to speed up multistep operations such as
      modular exponentiation. It is much harder to use the mutable companion
      class than to use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code>,
      for all of the reasons outlined earlier. Luckily, you don’t have to use
      it: the implementors of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code>did the
      hard work for you.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      package-private mutable companion class approach works fine if you can
      accurately predict which complex operations clients will want to perform
      on your immutable class. If not, then your best bet is to provide a<span class="Apple-converted-space">&nbsp;</span><em>public</em><span
        class="Apple-converted-space">&nbsp;</span>mutable companion class. The
      main example of this approach in the Java platform libraries is the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>class,
      whose mutable companion is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">StringBuilder</code><span
        class="Apple-converted-space">&nbsp;</span>(and its obsolete
      predecessor,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">StringBuffer</code>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      that you know how to make an immutable class and you understand the pros
      and cons of immutability, let’s discuss a few design alternatives. Recall
      that to guarantee immutability, a class must not permit itself to be
      subclassed. This can be done by making the class final, but there is
      another, more flexible alternative. Instead of making an immutable class
      final, you can make all of its constructors private or package-private and
      add public static factories in place of the public constructors (<a href="ch2.xhtml#lev1"
        style="text-decoration: none;">Item 1</a>). To make this concrete,
      here’s how<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Complex</code><span
        class="Apple-converted-space">&nbsp;</span>would look if you took this
      approach:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex9a" id="pch4ex9" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Immutable class with static factories instead of constructors</strong><br>
      public class Complex {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final double re;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final double im;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private</strong><span class="Apple-converted-space">&nbsp;</span>Complex(double
      re, double im) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.re = re;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.im = im;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public static Complex valueOf(double re,
        double im)</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex(re,
      im);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder unchanged<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_85"></span>This approach is often the
      best alternative. It is the most flexible because it allows the use of
      multiple package-private implementation classes. To its clients that
      reside outside its package, the immutable class is effectively final
      because it is impossible to extend a class that comes from another package
      and that lacks a public or protected constructor. Besides allowing the
      flexibility of multiple implementation classes, this approach makes it
      possible to tune the performance of the class in subsequent releases by
      improving the object-caching capabilities of the static factories.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      was not widely understood that immutable classes had to be effectively
      final when<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>were
      written, so all of their methods may be overridden. Unfortunately, this
      could not be corrected after the fact while preserving backward
      compatibility. If you write a class whose security depends on the
      immutability of a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>argument
      from an untrusted client, you must check to see that the argument is a
      “real”<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code>, rather
      than an instance of an untrusted subclass. If it is the latter, you must
      defensively copy it under the assumption that it might be mutable (<a href="ch8.xhtml#lev50"
        style="text-decoration: none;">Item 50</a>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex10a" id="pch4ex10" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static BigInteger safeInstance(BigInteger val) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return val.getClass() == BigInteger.class ?<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val
      : new BigInteger(val.toByteArray());<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      list of rules for immutable classes at the beginning of this item says
      that no methods may modify the object and that all its fields must be
      final. In fact these rules are a bit stronger than necessary and can be
      relaxed to improve performance. In truth, no method may produce an<em>externally
        visible</em><span class="Apple-converted-space">&nbsp;</span>change in
      the object’s state. However, some immutable classes have one or more
      nonfinal fields in which they cache the results of expensive computations
      the first time they are needed. If the same value is requested again, the
      cached value is returned, saving the cost of recalculation. This trick
      works precisely because the object is immutable, which guarantees that the
      computation would yield the same result if it were repeated.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>method (<a href="ch3.xhtml#lev11"
        style="text-decoration: none;">Item 11</a>, page 53) computes the hash
      code the first time it’s invoked and caches it in case it’s invoked again.
      This technique, an example of<span class="Apple-converted-space">&nbsp;</span><em>lazy
        initialization</em><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch11.xhtml#lev83" style="text-decoration: none;">Item 83</a>), is
      also used by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      caveat should be added concerning serializability. If you choose to have
      your immutable class implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>and it contains one or more
      fields that refer to mutable objects, you must provide an explicit<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">readObject</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readResolve</code><span
        class="Apple-converted-space">&nbsp;</span>method, or use the<code style="font-family: 'Courier New', monospace;">ObjectOutputStream.writeUnshared</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_86"></span><code style="font-family: 'Courier New', monospace;">ObjectInputStream.readUnshared</code><span
        class="Apple-converted-space">&nbsp;</span>methods, even if the default
      serialized form is acceptable. Otherwise an attacker could create a
      mutable instance of your class. This topic is covered in detail in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch12.xhtml#lev88" style="text-decoration: none;">Item 88</a>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      summarize, resist the urge to write a setter for every getter.<span class="Apple-converted-space">&nbsp;</span><strong>Classes
        should be immutable unless there’s a very good reason to make them
        mutable.</strong><span class="Apple-converted-space">&nbsp;</span>Immutable
      classes provide many advantages, and their only disadvantage is the
      potential for performance problems under certain circumstances. You should
      always make small value objects, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Complex</code>,
      immutable. (There are several classes in the Java platform libraries, such
      as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.Date</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.awt.Point</code>,
      that should have been immutable but aren’t.) You should seriously consider
      making larger value objects, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code>,
      immutable as well. You should provide a public mutable companion class for
      your immutable class<span class="Apple-converted-space">&nbsp;</span><em>only</em><span
        class="Apple-converted-space">&nbsp;</span>once you’ve confirmed that
      it’s necessary to achieve satisfactory performance (<a href="ch9.xhtml#lev67"
        style="text-decoration: none;">Item 67</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are some classes for which immutability is impractical.<span class="Apple-converted-space">&nbsp;</span><strong>If
        a class cannot be made immutable, limit its mutability as much as
        possible.</strong><span class="Apple-converted-space">&nbsp;</span>Reducing
      the number of states in which an object can exist makes it easier to
      reason about the object and reduces the likelihood of errors. Therefore,
      make every field final unless there is a compelling reason to make it
      nonfinal. Combining the advice of this item with that of<a href="ch4.xhtml#lev15"
        style="text-decoration: none;">Item 15</a>, your natural inclination
      should be to<span class="Apple-converted-space">&nbsp;</span><strong>declare
        every field</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>private final</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>unless there’s a good
        reason to do otherwise.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Constructors
        should create fully initialized objects with all of their invariants
        established.</strong><span class="Apple-converted-space">&nbsp;</span>Don’t
      provide a public initialization method separate from the constructor or
      static factory unless there is a<span class="Apple-converted-space">&nbsp;</span><em>compelling</em><span
        class="Apple-converted-space">&nbsp;</span>reason to do so. Similarly,
      don’t provide a “reinitialize” method that enables an object to be reused
      as if it had been constructed with a different initial state. Such methods
      generally provide little if any performance benefit at the expense of
      increased complexity.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">CountDownLatch</code><span
        class="Apple-converted-space">&nbsp;</span>class exemplifies these
      principles. It is mutable, but its state space is kept intentionally
      small. You create an instance, use it once, and it’s done: once the
      countdown latch’s count has reached zero, you may not reuse it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      final note should be added concerning the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Complex</code><span class="Apple-converted-space">&nbsp;</span>class
      in this item. This example was meant only to illustrate immutability. It
      is not an industrial-strength complex number implementation. It uses the
      standard formulas for complex multiplication and division, which are not
      correctly rounded and provide poor semantics for complex NaNs and
      infinities [<a href="ref.xhtml#rKahan91" style="text-decoration: none;">Kahan91</a>,<span
        class="Apple-converted-space">&nbsp;</span><a href="ref.xhtml#rSmith62"
        style="text-decoration: none;">Smith62</a>,<span class="Apple-converted-space">&nbsp;</span><a
        href="ref.xhtml#rThomas94" style="text-decoration: none;">Thomas94</a>].</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev18" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_87"></span><strong>Item 18: Favor composition over inheritance</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Inheritance
      is a powerful way to achieve code reuse, but it is not always the best
      tool for the job. Used inappropriately, it leads to fragile software. It
      is safe to use inheritance within a package, where the subclass and the
      superclass implementations are under the control of the same programmers.
      It is also safe to use inheritance when extending classes specifically
      designed and documented for extension (<a href="ch4.xhtml#lev19" style="text-decoration: none;">Item
        19</a>). Inheriting from ordinary concrete classes across package
      boundaries, however, is dangerous. As a reminder, this book uses the word
      “inheritance” to mean<em>implementation inheritance</em><span class="Apple-converted-space">&nbsp;</span>(when
      one class extends another). The problems discussed in this item do not
      apply to<span class="Apple-converted-space">&nbsp;</span><em>interface
        inheritance</em><span class="Apple-converted-space">&nbsp;</span>(when a
      class implements an interface or when one interface extends another).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Unlike
        method invocation, inheritance violates encapsulation</strong><span class="Apple-converted-space">&nbsp;</span>[<a
        href="ref.xhtml#rSnyder86" style="text-decoration: none;">Snyder86</a>].
      In other words, a subclass depends on the implementation details of its
      superclass for its proper function. The superclass’s implementation may
      change from release to release, and if it does, the subclass may break,
      even though its code has not been touched. As a consequence, a subclass
      must evolve in tandem with its superclass, unless the superclass’s authors
      have designed and documented it specifically for the purpose of being
      extended.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make this concrete, let’s suppose we have a program that uses a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>. To tune
      the performance of our program, we need to query the<code style="font-family: 'Courier New', monospace;">HashSet</code><span
        class="Apple-converted-space">&nbsp;</span>as to how many elements have
      been added since it was created (not to be confused with its current size,
      which goes down when an element is removed). To provide this
      functionality, we write a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>variant
      that keeps count of the number of attempted element insertions and exports
      an accessor for this count. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>class
      contains two methods capable of adding elements,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addAll</code>,
      so we override both of these methods:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex11a" id="pch4ex11" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Broken - Inappropriate use of inheritance!</strong><br>
      public class InstrumentedHashSet&lt;E&gt; extends HashSet&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// The number of attempted element insertions<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int addCount = 0;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public InstrumentedHashSet() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public InstrumentedHashSet(int initCap, float
      loadFactor) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(initCap,
      loadFactor);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean add(E e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addCount++;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return super.add(e);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean addAll(Collection&lt;?
      extends E&gt; c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addCount += c.size();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return super.addAll(c);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int getAddCount() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return addCount;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      class looks reasonable, but it doesn’t work. Suppose we create an instance
      and add three elements using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method.
      Incidentally, note that we create a list using the static factory method<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List.of</code>,
      which was added in Java 9; if you’re using an earlier release, use<code style="font-family: 'Courier New', monospace;">Arrays.asList</code><span
        class="Apple-converted-space">&nbsp;</span>instead:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex12a" id="pch4ex12" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">InstrumentedHashSet&lt;String&gt;
      s = new InstrumentedHashSet&lt;&gt;();<br>
      s.addAll(List.of("Snap", "Crackle", "Pop"));</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">We
      would expect the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getAddCount</code><span
        class="Apple-converted-space">&nbsp;</span>method to return three at
      this point, but it returns six. What went wrong? Internally,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code>method is
      implemented on top of its<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>method,
      although<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code>,
      quite reasonably, does not document this implementation detail. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code>method in<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Instrumented-HashSet</code><span
        class="Apple-converted-space">&nbsp;</span>added three to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addCount</code><span class="Apple-converted-space">&nbsp;</span>and
      then invoked<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addAll</code><span
        class="Apple-converted-space">&nbsp;</span>implementation using<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.addAll</code>. This
      in turn invoked the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>method,
      as overridden in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">InstrumentedHashSet</code>,
      once for each element. Each of these three invocations added one more to<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addCount</code>,
      for a total increase of six: each element added with the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method
      is double-counted.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">We
      could “fix” the subclass by eliminating its override of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method.
      While the resulting class would work, it would depend for its proper
      function on the fact that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method
      is implemented on top of its<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>method.
      This “self-use” is an implementation detail, not guaranteed to hold in all
      implementations of the Java platform and subject to change from release to
      release. Therefore, the resulting<code style="font-family: 'Courier New', monospace;">InstrumentedHashSet</code><span
        class="Apple-converted-space">&nbsp;</span>class would be fragile.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      would be slightly better to override the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method
      to iterate over the specified collection, calling the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>method
      once for each element. This would guarantee the correct result whether or
      not<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addAll</code><span
        class="Apple-converted-space">&nbsp;</span>method were implemented atop
      its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">add</code><span
        class="Apple-converted-space">&nbsp;</span>method because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>’s<code style="font-family: 'Courier New', monospace;">addAll</code><span
        class="Apple-converted-space">&nbsp;</span>implementation would no
      longer be invoked. This technique, however, does not solve all our
      problems. It amounts to reimplementing superclass methods that may or may
      not<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_88"></span>result in self-use, which is difficult,
      time-consuming, error-prone, and may reduce performance. Additionally, it
      isn’t always possible because some methods cannot be implemented without
      access to private fields inaccessible to the subclass.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      related cause of fragility in subclasses is that their superclass can
      acquire new methods in subsequent releases. Suppose a program depends for
      its security on the fact that all elements inserted into some collection
      satisfy some predicate. This can be guaranteed by subclassing the
      collection and overriding each method capable of adding an element to
      ensure that the predicate is satisfied before adding the element. This
      works fine until a new method capable of inserting an element is added to
      the superclass in a subsequent release. Once this happens, it becomes
      possible to add an “illegal” element merely by invoking the new method,
      which is not overridden in the subclass. This is not a purely theoretical
      problem. Several security holes of this nature had to be fixed when<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Hashtable</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Vector</code><span
        class="Apple-converted-space">&nbsp;</span>were retrofitted to
      participate in the Collections Framework.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Both
      of these problems stem from overriding methods. You might think that it is
      safe to extend a class if you merely add new methods and refrain from
      overriding existing methods. While this sort of extension is much safer,
      it is not without risk. If the superclass acquires a new method in a
      subsequent release and you have the bad luck to have given the subclass a
      method with the same signature and a different return type, your subclass
      will no longer compile [JLS, 8.4.8.3]. If you’ve given the subclass a
      method with the same signature and return type as the new superclass
      method, then you’re now overriding it, so you’re subject to the problems
      described earlier. Furthermore, it is doubtful that your method will
      fulfill the contract of the new superclass method, because that contract
      had not yet been written when you wrote the subclass method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Luckily,
      there is a way to avoid all of the problems described above. Instead of
      extending an existing class, give your new class a private field that
      references an instance of the existing class. This design is called<span class="Apple-converted-space">&nbsp;</span><em>composition</em><span
        class="Apple-converted-space">&nbsp;</span>because the existing class
      becomes a component of the new one. Each instance method in the new class
      invokes the corresponding method on the contained instance of the existing
      class and returns the results. This is known as<span class="Apple-converted-space">&nbsp;</span><em>forwarding</em>,
      and the methods in the new class are known as<span class="Apple-converted-space">&nbsp;</span><em>forwarding
        methods</em>. The resulting class will be rock solid, with no
      dependencies on the implementation details of the existing class. Even
      adding new methods to the existing class will have no impact on the new
      class. To make this concrete, here’s a replacement for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedHashSet</code><span
        class="Apple-converted-space">&nbsp;</span>that uses the
      composition-and-forwarding approach. Note that the implementation is
      broken into two pieces, the class itself and a reusable<span class="Apple-converted-space">&nbsp;</span><em>forwarding
        class,</em><span class="Apple-converted-space">&nbsp;</span>which
      contains all of the forwarding methods and nothing else:</p>
    <span epub:type="pagebreak" id="page_89" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex13a" id="pch4ex13" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Wrapper class - uses composition in place of inheritance</strong><br>
      public class InstrumentedSet&lt;E&gt; extends ForwardingSet&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int addCount = 0;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public InstrumentedSet(Set&lt;E&gt; s) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean add(E e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addCount++;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return super.add(e);<br>
      &nbsp;&nbsp;&nbsp;&nbsp; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp; @Override public boolean addAll(Collection&lt;?
      extends E&gt; c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addCount += c.size();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return super.addAll(c);<br>
      &nbsp;&nbsp;&nbsp;&nbsp; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp; public int getAddCount() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return addCount;<br>
      &nbsp;&nbsp;&nbsp;&nbsp; }<br>
      }<br>
      <br>
      <strong>// Reusable forwarding class</strong><br>
      public class ForwardingSet&lt;E&gt; implements Set&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Set&lt;E&gt; s;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public ForwardingSet(Set&lt;E&gt; s) { this.s = s;
      }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void
      clear()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      {
s.clear();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean contains(Object o) { return
      s.contains(o); }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean
      isEmpty()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      return s.isEmpty();&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int
      size()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.size();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Iterator&lt;E&gt;
      iterator()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ return
      s.iterator();&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean add(E
      e)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { return
      s.add(e);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean remove(Object o)&nbsp;&nbsp; {
      return s.remove(o);&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean containsAll(Collection&lt;?&gt; c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.containsAll(c); }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean addAll(Collection&lt;? extends
      E&gt; c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.addAll(c);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean removeAll(Collection&lt;?&gt; c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.removeAll(c);&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean retainAll(Collection&lt;?&gt; c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.retainAll(c);&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Object[]
      toArray()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      return s.toArray();&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; T[] toArray(T[]
      a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ return s.toArray(a); }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.equals(o);&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public int
      hashCode()&nbsp;&nbsp;&nbsp;&nbsp;{ return s.hashCode(); }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public String toString() { return
      s.toString(); }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_90"></span>The design of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class is enabled by the
      existence of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code><span
        class="Apple-converted-space">&nbsp;</span>interface, which captures the
      functionality of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>class.
      Besides being robust, this design is extremely flexible. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class implements the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>interface
      and has a single constructor whose argument is also of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code>. In essence,
      the class transforms one<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>into
      another, adding the instrumentation functionality. Unlike the
      inheritance-based approach, which works only for a single concrete class
      and requires a separate constructor for each supported constructor in the
      superclass, the wrapper class can be used to instrument any<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>implementation
      and will work in conjunction with any preexisting constructor:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex14a" id="pch4ex14" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Instant&gt;
      times = new InstrumentedSet&lt;&gt;(new TreeSet&lt;&gt;(cmp));<br>
      Set&lt;E&gt; s = new InstrumentedSet&lt;&gt;(new
      HashSet&lt;&gt;(INIT_CAPACITY));</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class can even be used to
      temporarily instrument a set instance that has already been used without
      instrumentation:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex15a" id="pch4ex15" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">static
      void walk(Set&lt;Dog&gt; dogs) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;InstrumentedSet&lt;Dog&gt; iDogs = new
      InstrumentedSet&lt;&gt;(dogs);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Within this method use iDogs instead of
      dogs<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class is known as a<span class="Apple-converted-space">&nbsp;</span><em>wrapper</em><span
        class="Apple-converted-space">&nbsp;</span>class because each<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>instance contains (“wraps”)
      another<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code><span
        class="Apple-converted-space">&nbsp;</span>instance. This is also known
      as the<span class="Apple-converted-space">&nbsp;</span><em>Decorator</em><span
        class="Apple-converted-space">&nbsp;</span>pattern [<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>] because the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class “decorates” a set by
      adding instrumentation. Sometimes the combination of composition and
      forwarding is loosely referred to as<span class="Apple-converted-space">&nbsp;</span><em>delegation.</em><span
        class="Apple-converted-space">&nbsp;</span>Technically it’s not
      delegation unless the wrapper object passes itself to the wrapped object
      [Lieberman86; Gamma95].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      disadvantages of wrapper classes are few. One caveat is that wrapper
      classes are not suited for use in<span class="Apple-converted-space">&nbsp;</span><em>callback
        frameworks</em>, wherein objects pass self-references to other objects
      for subsequent invocations (“callbacks”). Because a wrapped object doesn’t
      know of its wrapper, it passes a reference to itself (<code style="font-family: 'Courier New', monospace;">this</code>)
      and callbacks elude the wrapper. This is known as the<span class="Apple-converted-space">&nbsp;</span><em>SELF
        problem</em><span class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rLieberman86"
        style="text-decoration: none;">Lieberman86</a>]. Some people worry about
      the performance impact of forwarding method invocations or the memory
      footprint impact of wrapper objects. Neither turn out to have much impact
      in practice. It’s tedious to write forwarding methods, but you have to
      write the reusable forwarding class for each interface only once, and
      forwarding classes may be provided for you. For example, Guava provides
      forwarding classes for all of the collection interfaces [<a href="ref.xhtml#rGuava"
        style="text-decoration: none;">Guava</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_91"></span>Inheritance is appropriate
      only in circumstances where the subclass really is a<span class="Apple-converted-space">&nbsp;</span><em>subtype</em><span
        class="Apple-converted-space">&nbsp;</span>of the superclass. In other
      words, a class<span class="Apple-converted-space">&nbsp;</span><em>B</em><span
        class="Apple-converted-space">&nbsp;</span>should extend a class<span class="Apple-converted-space">&nbsp;</span><em>A</em><span
        class="Apple-converted-space">&nbsp;</span>only if an “is-a”
      relationship exists between the two classes. If you are tempted to have a
      class<span class="Apple-converted-space">&nbsp;</span><em>B</em><span class="Apple-converted-space">&nbsp;</span>extend
      a class<span class="Apple-converted-space">&nbsp;</span><em>A</em>, ask
      yourself the question: Is every<span class="Apple-converted-space">&nbsp;</span><em>B</em><span
        class="Apple-converted-space">&nbsp;</span>really an<span class="Apple-converted-space">&nbsp;</span><em>A</em>?
      If you cannot truthfully answer yes to this question,<span class="Apple-converted-space">&nbsp;</span><em>B</em><span
        class="Apple-converted-space">&nbsp;</span>should not extend<span class="Apple-converted-space">&nbsp;</span><em>A</em>.
      If the answer is no, it is often the case that<span class="Apple-converted-space">&nbsp;</span><em>B</em><span
        class="Apple-converted-space">&nbsp;</span>should contain a private
      instance of<span class="Apple-converted-space">&nbsp;</span><em>A</em><span
        class="Apple-converted-space">&nbsp;</span>and expose a different API:<span
        class="Apple-converted-space">&nbsp;</span><em>A</em><span class="Apple-converted-space">&nbsp;</span>is
      not an essential part of<span class="Apple-converted-space">&nbsp;</span><em>B</em>,
      merely a detail of its implementation.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are a number of obvious violations of this principle in the Java platform
      libraries. For example, a stack is not a vector, so<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>should
      not extend<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Vector</code>.
      Similarly, a property list is not a hash table, so<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Properties</code><span class="Apple-converted-space">&nbsp;</span>should
      not extend<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Hashtable</code>.
      In both cases, composition would have been preferable.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you use inheritance where composition is appropriate, you needlessly
      expose implementation details. The resulting API ties you to the original
      implementation, forever limiting the performance of your class. More
      seriously, by exposing the internals you let clients access them directly.
      At the very least, it can lead to confusing semantics. For example, if<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">p</code><span
        class="Apple-converted-space">&nbsp;</span>refers to a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Properties</code><span class="Apple-converted-space">&nbsp;</span>instance,
      then<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">p.getProperty(key)</code><span
        class="Apple-converted-space">&nbsp;</span>may yield different results
      from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">p.get(key)</code>:
      the former method takes defaults into account, while the latter method,
      which is inherited from<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Hashtable</code>, does
      not. Most seriously, the client may be able to corrupt invariants of the
      subclass by modifying the superclass directly. In the case of<code style="font-family: 'Courier New', monospace;">Properties</code>,
      the designers intended that only strings be allowed as keys and values,
      but direct access to the underlying<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Hashtable</code><span class="Apple-converted-space">&nbsp;</span>allows
      this invariant to be violated. Once violated, it is no longer possible to
      use other parts of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Properties</code><span class="Apple-converted-space">&nbsp;</span>API
      (<code style="font-family: 'Courier New', monospace;">load</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">store</code>).
      By the time this problem was discovered, it was too late to correct it
      because clients depended on the use of non-string keys and values.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is one last set of questions you should ask yourself before deciding to
      use inheritance in place of composition. Does the class that you
      contemplate extending have any flaws in its API? If so, are you
      comfortable propagating those flaws into your class’s API? Inheritance
      propagates any flaws in the superclass’s API, while composition lets you
      design a new API that hides these flaws.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      summarize, inheritance is powerful, but it is problematic because it
      violates encapsulation. It is appropriate only when a genuine subtype
      relationship exists between the subclass and the superclass. Even then,
      inheritance may lead to fragility if the subclass is in a different
      package from the superclass and the superclass is not designed for
      inheritance. To avoid this fragility, use composition and forwarding
      instead of inheritance, especially if an appropriate interface to
      implement a wrapper class exists. Not only are wrapper classes more robust
      than subclasses, they are also more powerful.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev19" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_92"></span><strong>Item 19: Design and document for inheritance
        or else prohibit it</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Item
      18 alerted you to the dangers of subclassing a “foreign” class that was
      not designed and documented for inheritance. So what does it mean for a
      class to be designed and documented for inheritance?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">First,
      the class must document precisely the effects of overriding any method. In
      other words,<span class="Apple-converted-space">&nbsp;</span><strong>the
        class must document its</strong><span class="Apple-converted-space">&nbsp;</span><em><strong>self-use</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>of overridable
        methods.</strong><span class="Apple-converted-space">&nbsp;</span>For
      each public or protected method, the documentation must indicate which
      overridable methods the method invokes, in what sequence, and how the
      results of each invocation affect subsequent processing. (By<span class="Apple-converted-space">&nbsp;</span><em>overridable</em>,
      we mean nonfinal and either public or protected.) More generally, a class
      must document any circumstances under which it might invoke an overridable
      method. For example, invocations might come from background threads or
      static initializers.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      method that invokes overridable methods contains a description of these
      invocations at the end of its documentation comment. The description is in
      a special section of the specification, labeled “Implementation
      Requirements,” which is generated by the Javadoc tag<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">@implSpec</code>. This
      section describes the inner workings of the method. Here’s an example,
      copied from the specification for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.AbstractCollection</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex16a" id="pch4ex16" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      boolean remove(Object o)</p>
    <p class="bqa" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 37.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Removes
      a single instance of the specified element from this collection, if it is
      present (optional operation). More formally, removes an element<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">e</code><span class="Apple-converted-space">&nbsp;</span>such
      that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Objects.equals(o,
        e)</code>, if this collection contains one or more such elements.
      Returns<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space">&nbsp;</span>if this collection contained
      the specified element (or equivalently, if this collection changed as a
      result of the call).</p>
    <p class="bqa" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 37.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Implementation
        Requirements:</strong><span class="Apple-converted-space">&nbsp;</span>This
      implementation iterates over the collection looking for the specified
      element. If it finds the element, it removes the element from the
      collection using the iterator’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">remove</code><span class="Apple-converted-space">&nbsp;</span>method.
      Note that this implementation throws an<code style="font-family: 'Courier New', monospace;">UnsupportedOperationException</code><span
        class="Apple-converted-space">&nbsp;</span>if the iterator returned by
      this collection’s<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">iterator</code><span
        class="Apple-converted-space">&nbsp;</span>method does not implement the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">remove</code><span
        class="Apple-converted-space">&nbsp;</span>method and this collection
      contains the specified object.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      documentation leaves no doubt that overriding the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">iterator</code><span class="Apple-converted-space">&nbsp;</span>method
      will affect the behavior of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">remove</code><span class="Apple-converted-space">&nbsp;</span>method.
      It also describes exactly how the behavior of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Iterator</code><span class="Apple-converted-space">&nbsp;</span>returned
      by the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">iterator</code><span
        class="Apple-converted-space">&nbsp;</span>method will affect the
      behavior of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">remove</code><span
        class="Apple-converted-space">&nbsp;</span>method. Contrast this to the
      situation in<span class="Apple-converted-space">&nbsp;</span><a href="ch4.xhtml#lev18"
        style="text-decoration: none;">Item 18</a>, where the programmer
      subclassing<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code><span
        class="Apple-converted-space">&nbsp;</span>simply could not say whether
      overriding the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">add</code><span
        class="Apple-converted-space">&nbsp;</span>method would affect the
      behavior of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addAll</code><span
        class="Apple-converted-space">&nbsp;</span>method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_93"></span>But doesn’t this violate the
      dictum that good API documentation should describe<span class="Apple-converted-space">&nbsp;</span><em>what</em><span
        class="Apple-converted-space">&nbsp;</span>a given method does and not<span
        class="Apple-converted-space">&nbsp;</span><em>how</em><span class="Apple-converted-space">&nbsp;</span>it
      does it? Yes, it does! This is an unfortunate consequence of the fact that
      inheritance violates encapsulation. To document a class so that it can be
      safely subclassed, you must describe implementation details that should
      otherwise be left unspecified.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@implSpec</code><span
        class="Apple-converted-space">&nbsp;</span>tag was added in Java 8 and
      used heavily in Java 9. This tag should be enabled by default, but as of
      Java 9, the Javadoc utility still ignores it unless you pass the command
      line switch<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">-tag
        "apiNote:a:API Note:"</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Designing
      for inheritance involves more than just documenting patterns of self-use.
      To allow programmers to write efficient subclasses without undue pain,<span
        class="Apple-converted-space">&nbsp;</span><strong>a class may have to
        provide hooks into its internal workings in the form of judiciously
        chosen protected methods</strong><span class="Apple-converted-space">&nbsp;</span>or,
      in rare instances, protected fields. For example, consider the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeRange</code><span class="Apple-converted-space">&nbsp;</span>method
      from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.AbstractList</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex17a" id="pch4ex17" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">protected
      void removeRange(int fromIndex, int toIndex)</p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Removes
      from this list all of the elements whose index is between<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">fromIndex</code>,
      inclusive, and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toIndex</code>,
      exclusive. Shifts any succeeding elements to the left (reduces their
      index). This call shortens the list by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">(toIndex - fromIndex)</code><span
        class="Apple-converted-space">&nbsp;</span>elements. (If<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toIndex == fromIndex</code>,
      this operation has no effect.)</p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method is called by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clear</code><span class="Apple-converted-space">&nbsp;</span>operation
      on this list and its sublists. Overriding this method to take advantage of
      the internals of the list implementation can substantially improve the
      performance of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clear</code><span
        class="Apple-converted-space">&nbsp;</span>operation on this list and
      its sublists.</p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Implementation
        Requirements:</strong><span class="Apple-converted-space">&nbsp;</span>This
      implementation gets a list iterator positioned before<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">fromIndex</code><span class="Apple-converted-space">&nbsp;</span>and
      repeatedly calls<code style="font-family: 'Courier New', monospace;">ListIterator.next</code><span
        class="Apple-converted-space">&nbsp;</span>followed by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ListIterator.remove</code>,
      until the entire range has been removed.<span class="Apple-converted-space">&nbsp;</span><strong>Note:
        If</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>ListIterator.remove</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>requires linear time,
        this implementation requires quadratic time.</strong></p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Parameters:</p>
    <p class="prem" style="font-size: 0.88em; margin-top: 6.666667px; margin-bottom: 26.666668px; margin-left: 41.333336px; text-align: justify; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><code
        style="font-family: 'Courier New', monospace;">fromIndex</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index
      of first element to be removed.<br>
      <code style="font-family: 'Courier New', monospace;">toIndex</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index
      after last element to be removed.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method is of no interest to end users of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>implementation.
      It is provided solely to make it easy for subclasses to provide a fast<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clear</code>method
      on sublists. In the absence of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeRange</code><span class="Apple-converted-space">&nbsp;</span>method,
      subclasses would have to make do with quadratic performance when the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clear</code>method
      was invoked on sublists or rewrite the entire<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">subList</code><span class="Apple-converted-space">&nbsp;</span>mechanism
      from scratch—not an easy task!</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_94"></span>So how do you decide what
      protected members to expose when you design a class for inheritance?
      Unfortunately, there is no magic bullet. The best you can do is to think
      hard, take your best guess, and then test it by writing subclasses. You
      should expose as few protected members as possible because each one
      represents a commitment to an implementation detail. On the other hand,
      you must not expose too few because a missing protected member can render
      a class practically unusable for inheritance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The</strong><span
        class="Apple-converted-space">&nbsp;</span><em><strong>only</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>way to test a class
        designed for inheritance is to write subclasses.</strong><span class="Apple-converted-space">&nbsp;</span>If
      you omit a crucial protected member, trying to write a subclass will make
      the omission painfully obvious. Conversely, if several subclasses are
      written and none uses a protected member, you should probably make it
      private. Experience shows that three subclasses are usually sufficient to
      test an extendable class. One or more of these subclasses should be
      written by someone other than the superclass author.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you design for inheritance a class that is likely to achieve wide use,
      realize that you are committing<span class="Apple-converted-space">&nbsp;</span><em>forever</em><span
        class="Apple-converted-space">&nbsp;</span>to the self-use patterns that
      you document and to the implementation decisions implicit in its protected
      methods and fields. These commitments can make it difficult or impossible
      to improve the performance or functionality of the class in a subsequent
      release. Therefore,<span class="Apple-converted-space">&nbsp;</span><strong>you
        must test your class by writing subclasses</strong><span class="Apple-converted-space">&nbsp;</span><em><strong>before</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>you release it.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Also,
      note that the special documentation required for inheritance clutters up
      normal documentation, which is designed for programmers who create
      instances of your class and invoke methods on them. As of this writing,
      there is little in the way of tools to separate ordinary API documentation
      from information of interest only to programmers implementing subclasses.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are a few more restrictions that a class must obey to allow inheritance.<span
        class="Apple-converted-space">&nbsp;</span><strong>Constructors must not
        invoke overridable methods,</strong>directly or indirectly. If you
      violate this rule, program failure will result. The superclass constructor
      runs before the subclass constructor, so the overriding method in the
      subclass will get invoked before the subclass constructor has run. If the
      overriding method depends on any initialization performed by the subclass
      constructor, the method will not behave as expected. To make this
      concrete, here’s a class that violates this rule:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex18a" id="pch4ex18" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Super {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// Broken - constructor invokes an
        overridable method</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Super() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overrideMe();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void overrideMe() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_95"></span>Here’s a subclass that
      overrides the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">overrideMe</code><span
        class="Apple-converted-space">&nbsp;</span>method, which is erroneously
      invoked by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Super</code>’s
      sole constructor:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex19a" id="pch4ex19" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      final class Sub extends Super {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Blank final, set by constructor<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Instant instant;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;Sub() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instant = Instant.now();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// Overriding method invoked by superclass
        constructor</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public void overrideMe() {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(instant);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sub sub = new Sub();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub.overrideMe();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      might expect this program to print out the instant twice, but it prints
      out<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">null</code><span
        class="Apple-converted-space">&nbsp;</span>the first time because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">overrideMe</code><span class="Apple-converted-space">&nbsp;</span>is
      invoked by the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Super</code>constructor
      before the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Sub</code><span
        class="Apple-converted-space">&nbsp;</span>constructor has a chance to
      initialize the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">instant</code><span
        class="Apple-converted-space">&nbsp;</span>field. Note that this program
      observes a final field in two different states! Note also that if<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">overrideMe</code><span class="Apple-converted-space">&nbsp;</span>had
      invoked any method on<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instant</code>, it would
      have thrown a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">NullPointerException</code><span
        class="Apple-converted-space">&nbsp;</span>when the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Super</code>constructor
      invoked<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">overrideMe</code>.
      The only reason this program doesn’t throw a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">NullPointerException</code><span
        class="Apple-converted-space">&nbsp;</span>as it stands is that the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">println</code><span
        class="Apple-converted-space">&nbsp;</span>method tolerates null
      parameters.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that it<span class="Apple-converted-space">&nbsp;</span><em>is</em><span class="Apple-converted-space">&nbsp;</span>safe
      to invoke private methods, final methods, and static methods, none of
      which are overridable, from a constructor.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>interfaces present special
      difficulties when designing for inheritance. It is generally not a good
      idea for a class designed for inheritance to implement either of these
      interfaces because they place a substantial burden on programmers who
      extend the class. There are, however, special actions that you can take to
      allow subclasses to implement these interfaces without mandating that they
      do so. These actions are described in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev13" style="text-decoration: none;">Item 13</a><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><a href="ch12.xhtml#lev86" style="text-decoration: none;">Item
        86</a>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you do decide to implement either<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>in a class that is designed
      for inheritance, you should be aware that because the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readObject</code><span
        class="Apple-converted-space">&nbsp;</span>methods behave a lot like
      constructors, a similar restriction applies:<span class="Apple-converted-space">&nbsp;</span><strong>neither</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>nor</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>readObject</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>may invoke an
        overridable method, directly or indirectly.</strong><span class="Apple-converted-space">&nbsp;</span>In
      the case of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readObject</code>,
      the overriding method will run before the<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_96"></span>subclass’s state has been
      deserialized. In the case of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code>, the
      overriding method will run before the subclass’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      has a chance to fix the clone’s state. In either case, a program failure
      is likely to follow. In the case of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code>, the failure
      can damage the original object as well as the clone. This can happen, for
      example, if the overriding method assumes it is modifying the clone’s copy
      of the object’s deep structure, but the copy hasn’t been made yet.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Finally,
      if you decide to implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>in a class designed for
      inheritance and the class has a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">readResolve</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">writeReplace</code>method,
      you must make the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readResolve</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">writeReplace</code><span
        class="Apple-converted-space">&nbsp;</span>method protected rather than
      private. If these methods are private, they will be silently ignored by
      subclasses. This is one more case where an implementation detail becomes
      part of a class’s API to permit inheritance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">By
      now it should be apparent that<span class="Apple-converted-space">&nbsp;</span><strong>designing
        a class for inheritance requires great effort and places substantial
        limitations on the class.</strong><span class="Apple-converted-space">&nbsp;</span>This
      is not a decision to be undertaken lightly. There are some situations
      where it is clearly the right thing to do, such as abstract classes,
      including<span class="Apple-converted-space">&nbsp;</span><em>skeletal
        implementations</em><span class="Apple-converted-space">&nbsp;</span>of
      interfaces (<a href="ch4.xhtml#lev20" style="text-decoration: none;">Item
        20</a>). There are other situations where it is clearly the wrong thing
      to do, such as immutable classes (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Item
        17</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">But
      what about ordinary concrete classes? Traditionally, they are neither
      final nor designed and documented for subclassing, but this state of
      affairs is dangerous. Each time a change is made in such a class, there is
      a chance that subclasses extending the class will break. This is not just
      a theoretical problem. It is not uncommon to receive subclassing-related
      bug reports after modifying the internals of a nonfinal concrete class
      that was not designed and documented for inheritance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The
        best solution to this problem is to prohibit subclassing in classes that
        are not designed and documented to be safely subclassed.</strong><span class="Apple-converted-space">&nbsp;</span>There
      are two ways to prohibit subclassing. The easier of the two is to declare
      the class final. The alternative is to make all the constructors private
      or package-private and to add public static factories in place of the
      constructors. This alternative, which provides the flexibility to use
      subclasses internally, is discussed in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev17" style="text-decoration: none;">Item 17</a>.
      Either approach is acceptable.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      advice may be somewhat controversial because many programmers have grown
      accustomed to subclassing ordinary concrete classes to add facilities such
      as instrumentation, notification, and synchronization or to limit
      functionality. If a class implements some interface that captures its
      essence, such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,
      or<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code>,
      then you should feel no compunction about prohibiting subclassing. The<span
        class="Apple-converted-space">&nbsp;</span><em>wrapper class</em><span class="Apple-converted-space">&nbsp;</span>pattern,
      described in<a href="ch4.xhtml#lev18" style="text-decoration: none;">Item
        18</a>, provides a superior alternative to inheritance for augmenting
      the functionality.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_97"></span>If a concrete class does not
      implement a standard interface, then you may inconvenience some
      programmers by prohibiting inheritance. If you feel that you must allow
      inheritance from such a class, one reasonable approach is to ensure that
      the class never invokes any of its overridable methods and to document
      this fact. In other words, eliminate the class’s self-use of overridable
      methods entirely. In doing so, you’ll create a class that is reasonably
      safe to subclass. Overriding a method will never affect the behavior of
      any other method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can eliminate a class’s self-use of overridable methods mechanically,
      without changing its behavior. Move the body of each overridable method to
      a private “helper method” and have each overridable method invoke its
      private helper method. Then replace each self-use of an overridable method
      with a direct invocation of the overridable method’s private helper
      method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, designing a class for inheritance is hard work. You must document
      all of its self-use patterns, and once you’ve documented them, you must
      commit to them for the life of the class. If you fail to do this,
      subclasses may become dependent on implementation details of the
      superclass and may break if the implementation of the superclass changes.
      To allow others to write<span class="Apple-converted-space">&nbsp;</span><em>efficient</em><span
        class="Apple-converted-space">&nbsp;</span>subclasses, you may also have
      to export one or more protected methods. Unless you know there is a real
      need for subclasses, you are probably better off prohibiting inheritance
      by declaring your class final or ensuring that there are no accessible
      constructors.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev20" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_98"></span><strong>Item 20: Prefer interfaces to abstract
        classes</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Java
      has two mechanisms to define a type that permits multiple implementations:
      interfaces and abstract classes. Since the introduction of<span class="Apple-converted-space">&nbsp;</span><em>default
        methods</em><span class="Apple-converted-space">&nbsp;</span>for
      interfaces in Java 8 [<a href="ref.xhtml#rJLS" style="text-decoration: none;">JLS
        9.4.3</a>], both mechanisms allow you to provide implementations for
      some instance methods. A major difference is that to implement the type
      defined by an abstract class, a class must be a subclass of the abstract
      class. Because Java permits only single inheritance, this restriction on
      abstract classes severely constrains their use as type definitions. Any
      class that defines all the required methods and obeys the general contract
      is permitted to implement an interface, regardless of where the class
      resides in the class hierarchy.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Existing
        classes can easily be retrofitted to implement a new interface.</strong><span
        class="Apple-converted-space">&nbsp;</span>All you have to do is to add
      the required methods, if they don’t yet exist, and to add an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">implements</code><span class="Apple-converted-space">&nbsp;</span>clause
      to the class declaration. For example, many existing classes were
      retrofitted to implement the<code style="font-family: 'Courier New', monospace;">Comparable</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Iterable</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Autocloseable</code><span
        class="Apple-converted-space">&nbsp;</span>interfaces when they were
      added to the platform. Existing classes cannot, in general, be retrofitted
      to extend a new abstract class. If you want to have two classes extend the
      same abstract class, you have to place it high up in the type hierarchy
      where it is an ancestor of both classes. Unfortunately, this can cause
      great collateral damage to the type hierarchy, forcing all descendants of
      the new abstract class to subclass it, whether or not it is appropriate.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Interfaces
        are ideal for defining mixins.</strong><span class="Apple-converted-space">&nbsp;</span>Loosely
      speaking, a<span class="Apple-converted-space">&nbsp;</span><em>mixin</em><span
        class="Apple-converted-space">&nbsp;</span>is a type that a class can
      implement in addition to its “primary type,” to declare that it provides
      some optional behavior. For example,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">&nbsp;</span>is
      a mixin interface that allows a class to declare that its instances are
      ordered with respect to other mutually comparable objects. Such an
      interface is called a mixin because it allows the optional functionality
      to be “mixed in” to the type’s primary functionality. Abstract classes
      can’t be used to define mixins for the same reason that they can’t be
      retrofitted onto existing classes: a class cannot have more than one
      parent, and there is no reasonable place in the class hierarchy to insert
      a mixin.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Interfaces
        allow for the construction of nonhierarchical type frameworks.</strong><span
        class="Apple-converted-space">&nbsp;</span>Type hierarchies are great
      for organizing some things, but other things don’t fall neatly into a
      rigid hierarchy. For example, suppose we have an interface representing a
      singer and another representing a songwriter:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex20a" id="pch4ex20" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      interface Singer {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;AudioClip sing(Song s);<br>
      }<br>
      <span epub:type="pagebreak" id="page_99"></span>public interface
      Songwriter {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Song compose(int chartPosition);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      real life, some singers are also songwriters. Because we used interfaces
      rather than abstract classes to define these types, it is perfectly
      permissible for a single class to implement both<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Singer</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Songwriter</code>.
      In fact, we can define a third interface that extends both<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Singer</code><span class="Apple-converted-space">&nbsp;</span>and<code
        style="font-family: 'Courier New', monospace;">Songwriter</code><span class="Apple-converted-space">&nbsp;</span>and
      adds new methods that are appropriate to the combination:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex21a" id="pch4ex21" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      interface SingerSongwriter extends Singer, Songwriter {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;AudioClip strum();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;void actSensitive();<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      don’t always need this level of flexibility, but when you do, interfaces
      are a lifesaver. The alternative is a bloated class hierarchy containing a
      separate class for every supported combination of attributes. If there are<span
        class="Apple-converted-space">&nbsp;</span><em>n</em><span class="Apple-converted-space">&nbsp;</span>attributes
      in the type system, there are 2<em><sup>n</sup></em><span class="Apple-converted-space">&nbsp;</span>possible
      combinations that you might have to support. This is what’s known as a<span
        class="Apple-converted-space">&nbsp;</span><em>combinatorial explosion</em>.
      Bloated class hierarchies can lead to bloated classes with many methods
      that differ only in the type of their arguments because there are no types
      in the class hierarchy to capture common behaviors.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Interfaces
        enable safe, powerful functionality enhancements</strong><span class="Apple-converted-space">&nbsp;</span>via
      the<span class="Apple-converted-space">&nbsp;</span><em>wrapper class</em><span
        class="Apple-converted-space">&nbsp;</span>idiom (<a href="ch4.xhtml#lev18"
        style="text-decoration: none;">Item 18</a>). If you use abstract classes
      to define types, you leave the programmer who wants to add functionality
      with no alternative but inheritance. The resulting classes are less
      powerful and more fragile than wrapper classes.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      there is an obvious implementation of an interface method in terms of
      other interface methods, consider providing implementation assistance to
      programmers in the form of a default method. For an example of this
      technique, see the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">removeIf</code><span
        class="Apple-converted-space">&nbsp;</span>method on page 104. If you
      provide default methods, be sure to document them for inheritance using
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@implSpec</code><span
        class="Apple-converted-space">&nbsp;</span>Javadoc tag (<a href="ch4.xhtml#lev19"
        style="text-decoration: none;">Item 19</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are limits on how much implementation assistance you can provide with
      default methods. Although many interfaces specify the behavior of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods
      such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>, you are
      not permitted to provide default methods for them. Also, interfaces are
      not permitted to contain instance fields or nonpublic static members (with
      the exception of private static methods). Finally, you can’t add default
      methods to an interface that you don’t control.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can, however, combine the advantages of interfaces and abstract classes by
      providing an abstract<span class="Apple-converted-space">&nbsp;</span><em>skeletal
        implementation class</em><span class="Apple-converted-space">&nbsp;</span>to
      go with an interface. The interface defines the type, perhaps providing
      some default methods, while the skeletal implementation class implements
      the remaining non-primitive interface<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_100"></span>methods atop the primitive
      interface methods. Extending a skeletal implementation takes most of the
      work out of implementing an interface. This is the<span class="Apple-converted-space">&nbsp;</span><em>Template
        Method</em><span class="Apple-converted-space">&nbsp;</span>pattern [<a
        href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">By
      convention, skeletal implementation classes are called<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Abstract</code><em>Interface</em>,
      where<span class="Apple-converted-space">&nbsp;</span><em>Interface</em><span
        class="Apple-converted-space">&nbsp;</span>is the name of the interface
      they implement. For example, the Collections Framework provides a skeletal
      implementation to go along with each main collection interface:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">AbstractCollection</code>,<code
        style="font-family: 'Courier New', monospace;">AbstractSet</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractList</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractMap</code>.
      Arguably it would have made sense to call them<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SkeletalCollection</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SkeletalSet</code>,<code
        style="font-family: 'Courier New', monospace;">SkeletalList</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SkeletalMap</code>,
      but the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Abstract</code><span
        class="Apple-converted-space">&nbsp;</span>convention is now firmly
      established. When properly designed, skeletal implementations (whether a
      separate abstract class, or consisting solely of default methods on an
      interface) can make it<span class="Apple-converted-space">&nbsp;</span><em>very</em><span
        class="Apple-converted-space">&nbsp;</span>easy for programmers to
      provide their own implementations of an interface. For example, here’s a
      static factory method containing a complete, fully functional<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>implementation
      atop<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractList</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex22a" id="pch4ex22" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Concrete implementation built atop skeletal implementation</strong><br>
      static List&lt;Integer&gt; intArrayAsList(int[] a) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Objects.requireNonNull(a);<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// The diamond operator is only legal here in Java
      9 and later<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// If you're using an earlier release, specify
      &lt;Integer&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return new AbstractList<strong>&lt;&gt;</strong>()
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public Integer
      get(int i) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      a[i];&nbsp;&nbsp;// Autoboxing (<a href="ch2.xhtml#lev6" style="text-decoration: none;">Item
        6</a>)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public Integer
      set(int i, Integer val) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      oldVal = a[i];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a[i]
      = val;&nbsp;&nbsp;&nbsp;&nbsp; // Auto-unboxing<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      oldVal;&nbsp;&nbsp;// Autoboxing<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public int
      size() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      a.length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;};<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you consider all that a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>implementation
      does for you, this example is an impressive demonstration of the power of
      skeletal implementations. Incidentally, this example is an<span class="Apple-converted-space">&nbsp;</span><em>Adapter</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>] that allows an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>array
      to be viewed as a list of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code><span class="Apple-converted-space">&nbsp;</span>instances.
      Because of all the translation back and forth between<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>values
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code><span
        class="Apple-converted-space">&nbsp;</span>instances (boxing and
      unboxing), its performance is not terribly good. Note that the
      implementation takes the form of an<span class="Apple-converted-space">&nbsp;</span><em>anonymous
        class</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch4.xhtml#lev24"
        style="text-decoration: none;">Item 24</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_101"></span>The beauty of skeletal
      implementation classes is that they provide all of the implementation
      assistance of abstract classes without imposing the severe constraints
      that abstract classes impose when they serve as type definitions. For most
      implementors of an interface with a skeletal implementation class,
      extending this class is the obvious choice, but it is strictly optional.
      If a class cannot be made to extend the skeletal implementation, the class
      can always implement the interface directly. The class still benefits from
      any default methods present on the interface itself. Furthermore, the
      skeletal implementation can still aid the implementor’s task. The class
      implementing the interface can forward invocations of interface methods to
      a contained instance of a private inner class that extends the skeletal
      implementation. This technique, known as<span class="Apple-converted-space">&nbsp;</span><em>simulated
        multiple inheritance</em>, is closely related to the wrapper class idiom
      discussed in<span class="Apple-converted-space">&nbsp;</span><a href="ch4.xhtml#lev18"
        style="text-decoration: none;">Item 18</a>. It provides many of the
      benefits of multiple inheritance, while avoiding the pitfalls.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Writing
      a skeletal implementation is a relatively simple, if somewhat tedious,
      process. First, study the interface and decide which methods are the
      primitives in terms of which the others can be implemented. These
      primitives will be the abstract methods in your skeletal implementation.
      Next, provide default methods in the interface for all of the methods that
      can be implemented directly atop the primitives, but recall that you may
      not provide default methods for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods
      such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>. If the
      primitives and default methods cover the interface, you’re done, and have
      no need for a skeletal implementation class. Otherwise, write a class
      declared to implement the interface, with implementations of all of the
      remaining interface methods. The class may contain any nonpublic fields
      ands methods appropriate to the task.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      a simple example, consider the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map.Entry</code><span class="Apple-converted-space">&nbsp;</span>interface.
      The obvious primitives are<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getKey</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getValue</code>, and
      (optionally)<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">setValue</code>.
      The interface specifies the behavior of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code>,
      and there is an obvious implementation of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>in
      terms of the primitives. Since you are not allowed to provide default
      implementations for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods,
      all implementations are placed in the skeletal implementation class:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex23a" id="pch4ex23" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Skeletal implementation class</strong><br>
      public abstract class AbstractMapEntry&lt;K,V&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implements
      Map.Entry&lt;K,V&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Entries in a modifiable map must override this
      method<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public V setValue(V value) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      UnsupportedOperationException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <span epub:type="pagebreak" id="page_102"></span>&nbsp;&nbsp;&nbsp;&nbsp;//
      Implements the general contract of Map.Entry.equals<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (o == this)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof
      Map.Entry))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map.Entry&lt;?,?&gt; e =
      (Map.Entry) o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      Objects.equals(e.getKey(),&nbsp;&nbsp;getKey())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;
      Objects.equals(e.getValue(), getValue());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Implements the general contract of
      Map.Entry.hashCode<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      Objects.hashCode(getKey())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^
      Objects.hashCode(getValue());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public String toString() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return getKey() + "=" +
      getValue();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that this skeletal implementation could not be implemented in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map.Entry</code><span class="Apple-converted-space">&nbsp;</span>interface
      or as a subinterface because default methods are not permitted to override<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>methods such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      skeletal implementations are designed for inheritance, you should follow
      all of the design and documentation guidelines in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev19" style="text-decoration: none;">Item 19</a>. For
      brevity’s sake, the documentation comments were omitted from the previous
      example, but<span class="Apple-converted-space">&nbsp;</span><strong>good
        documentation is absolutely essential in a skeletal implementation,</strong><span
        class="Apple-converted-space">&nbsp;</span>whether it consists of
      default methods on an interface or a separate abstract class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      minor variant on the skeletal implementation is the<span class="Apple-converted-space">&nbsp;</span><em>simple
        implementation,</em><span class="Apple-converted-space">&nbsp;</span>exemplified
      by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractMap.SimpleEntry</code>.
      A simple implementation is like a skeletal implementation in that it
      implements an interface and is designed for inheritance, but it differs in
      that it isn’t abstract: it is the simplest possible working
      implementation. You can use it as it stands or subclass it as
      circumstances warrant.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      summarize, an interface is generally the best way to define a type that
      permits multiple implementations. If you export a nontrivial interface,
      you should strongly consider providing a skeletal implementation to go
      with it. To the extent possible, you should provide the skeletal
      implementation via default methods on the interface so that all
      implementors of the interface can make use of it. That said, restrictions
      on interfaces typically mandate that a skeletal implementation take the
      form of an abstract class.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev21" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_103"></span><strong>Item 21: Design interfaces for posterity</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Prior
      to Java 8, it was impossible to add methods to interfaces without breaking
      existing implementations. If you added a new method to an interface,
      existing implementations would, in general, lack the method, resulting in
      a compile-time error. In Java 8, the<span class="Apple-converted-space">&nbsp;</span><em>default
        method</em><span class="Apple-converted-space">&nbsp;</span>construct
      was added [<a href="ref.xhtml#rJLS" style="text-decoration: none;">JLS 9.4</a>],
      with the intent of allowing the addition of methods to existing
      interfaces. But adding new methods to existing interfaces is fraught with
      risk.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      declaration for a default method includes a<span class="Apple-converted-space">&nbsp;</span><em>default
        implementation</em><span class="Apple-converted-space">&nbsp;</span>that
      is used by all classes that implement the interface but do not implement
      the default method. While the addition of default methods to Java makes it
      possible to add methods to an existing interface, there is no guarantee
      that these methods will work in all preexisting implementations. Default
      methods are “injected” into existing implementations without the knowledge
      or consent of their implementors. Before Java 8, these implementations
      were written with the tacit understanding that their interfaces would<span
        class="Apple-converted-space">&nbsp;</span><em>never</em><span class="Apple-converted-space">&nbsp;</span>acquire
      any new methods.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      new default methods were added to the core collection interfaces in Java
      8, primarily to facilitate the use of lambdas (<a href="ch6.xhtml#ch6" style="text-decoration: none;">Chapter
        6</a>). The Java libraries’ default methods are high-quality
      general-purpose implementations, and in most cases, they work fine. But<span
        class="Apple-converted-space">&nbsp;</span><strong>it is not always
        possible to write a default method that maintains all invariants of
        every conceivable implementation.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      example, consider the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>method,
      which was added to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection</code><span class="Apple-converted-space">&nbsp;</span>interface
      in Java 8. This method removes all elements for which a given<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">boolean</code><span class="Apple-converted-space">&nbsp;</span>function
      (or<span class="Apple-converted-space">&nbsp;</span><em>predicate</em>)
      returns<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code>.
      The default implementation is specified to traverse the collection using
      its iterator, invoking the predicate on each element, and using the
      iterator’s<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">remove</code><span
        class="Apple-converted-space">&nbsp;</span>method to remove the elements
      for which the predicate returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code>. Presumably
      the declaration looks something like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex24a" id="pch4ex24" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Default method added to the Collection interface in Java 8</strong><br>
      default boolean removeIf(Predicate&lt;? super E&gt; filter) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Objects.requireNonNull(filter);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;boolean result = false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (Iterator&lt;E&gt; it = iterator();
      it.hasNext(); ) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if
      (filter.test(it.next())) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it.remove();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result
      = true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_104"></span>This is the best
      general-purpose implementation one could possibly write for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>method,
      but sadly, it fails on some real-world<code style="font-family: 'Courier New', monospace;">Collection</code><span
        class="Apple-converted-space">&nbsp;</span>implementations. For example,
      consider<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">org.apache.commons.collections4.-collection.SynchronizedCollection</code>.
      This class, from the Apache Commons library, is similar to the one
      returned by the static factory<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collections.-synchronizedCollection</code><span
        class="Apple-converted-space">&nbsp;</span>in<code style="font-family: 'Courier New', monospace;">java.util</code>.
      The Apache version additionally provides the ability to use a
      client-supplied object for locking, in place of the collection. In other
      words, it is a wrapper class (<a href="ch4.xhtml#lev18" style="text-decoration: none;">Item
        18</a>), all of whose methods synchronize on a locking object before
      delegating to the wrapped collection.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      Apache<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SynchronizedCollection</code><span
        class="Apple-converted-space">&nbsp;</span>class is still being actively
      maintained, but as of this writing, it does not override the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>method.
      If this class is used in conjunction with Java 8, it will therefore
      inherit the default implementation of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code>, which
      does not, indeed<span class="Apple-converted-space">&nbsp;</span><em>cannot</em>,
      maintain the class’s fundamental promise: to automatically synchronize
      around each method invocation. The default implementation knows nothing
      about synchronization and has no access to the field that contains the
      locking object. If a client calls the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>method
      on a<code style="font-family: 'Courier New', monospace;">SynchronizedCollection</code><span
        class="Apple-converted-space">&nbsp;</span>instance in the presence of
      concurrent modification of the collection by another thread, a<code style="font-family: 'Courier New', monospace;">ConcurrentModificationException</code><span
        class="Apple-converted-space">&nbsp;</span>or other unspecified behavior
      may result.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      order to prevent this from happening in similar Java platform libraries
      implementations, such as the package-private class returned by<code style="font-family: 'Courier New', monospace;">Collections.synchronizedCollection</code>,
      the JDK maintainers had to override the default<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>implementation
      and other methods like it to perform the necessary synchronization before
      invoking the default implementation. Preexisting collection
      implementations that were not part of the Java platform did not have the
      opportunity to make analogous changes in lockstep with the interface
      change, and some have yet to do so.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>In
        the presence of default methods, existing implementations of an
        interface may compile without error or warning but fail at runtime.</strong><span
        class="Apple-converted-space">&nbsp;</span>While not terribly common,
      this problem is not an isolated incident either. A handful of the methods
      added to the collections interfaces in Java 8 are known to be susceptible,
      and a handful of existing implementations are known to be affected.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Using
      default methods to add new methods to existing interfaces should be
      avoided unless the need is critical, in which case you should think long
      and hard about whether an existing interface implementation might be
      broken by your default method implementation. Default methods are,
      however, extremely useful for providing standard method implementations
      when an interface is created, to ease the task of implementing the
      interface (<a href="ch4.xhtml#lev20" style="text-decoration: none;">Item
        20</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_105"></span>It is also worth noting that
      default methods were not designed to support removing methods from
      interfaces or changing the signatures of existing methods. Neither of
      these interface changes is possible without breaking existing clients.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      moral is clear. Even though default methods are now a part of the Java
      platform,<span class="Apple-converted-space">&nbsp;</span><strong>it is
        still of the utmost importance to design interfaces with great care.</strong><span
        class="Apple-converted-space">&nbsp;</span>While default methods make it<span
        class="Apple-converted-space">&nbsp;</span><em>possible</em><span class="Apple-converted-space">&nbsp;</span>to
      add methods to existing interfaces, there is great risk in doing so. If an
      interface contains a minor flaw, it may irritate its users forever; if an
      interface is severely deficient, it may doom the API that contains it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Therefore,
      it is critically important to test each new interface before you release
      it. Multiple programmers should implement each interface in different
      ways. At a minimum, you should aim for three diverse implementations.
      Equally important is to write multiple client programs that use instances
      of each new interface to perform various tasks. This will go a long way
      toward ensuring that each interface satisfies all of its intended uses.
      These steps will allow you to discover flaws in interfaces before they are
      released, when you can still correct them easily.<span class="Apple-converted-space">&nbsp;</span><strong>While
        it may be possible to correct some interface flaws after an interface is
        released, you cannot count on it</strong>.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev22" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_106"></span><strong>Item 22: Use interfaces only to define
        types</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      a class implements an interface, the interface serves as a<span class="Apple-converted-space">&nbsp;</span><em>type</em><span
        class="Apple-converted-space">&nbsp;</span>that can be used to refer to
      instances of the class. That a class implements an interface should
      therefore say something about what a client can do with instances of the
      class. It is inappropriate to define an interface for any other purpose.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      kind of interface that fails this test is the so-called<span class="Apple-converted-space">&nbsp;</span><em>constant
        interface</em>. Such an interface contains no methods; it consists
      solely of static final fields, each exporting a constant. Classes using
      these constants implement the interface to avoid the need to qualify
      constant names with a class name. Here is an example:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex25a" id="pch4ex25" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Constant interface antipattern - do not use!</strong><br>
      public interface PhysicalConstants {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Avogadro's number (1/mol)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final double AVOGADROS_NUMBER&nbsp;&nbsp; =
      6.022_140_857e23;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Boltzmann constant (J/K)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final double BOLTZMANN_CONSTANT =
      1.380_648_52e-23;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Mass of the electron (kg)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final double
      ELECTRON_MASS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 9.109_383_56e-31;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The
        constant interface pattern is a poor use of interfaces.</strong><span class="Apple-converted-space">&nbsp;</span>That
      a class uses some constants internally is an implementation detail.
      Implementing a constant interface causes this implementation detail to
      leak into the class’s exported API. It is of no consequence to the users
      of a class that the class implements a constant interface. In fact, it may
      even confuse them. Worse, it represents a commitment: if in a future
      release the class is modified so that it no longer needs to use the
      constants, it still must implement the interface to ensure binary
      compatibility. If a nonfinal class implements a constant interface, all of
      its subclasses will have their namespaces polluted by the constants in the
      interface.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are several constant interfaces in the Java platform libraries, such as<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.io.ObjectStreamConstants</code>.
      These interfaces should be regarded as anomalies and should not be
      emulated.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you want to export constants, there are several reasonable choices. If the
      constants are strongly tied to an existing class or interface, you should
      add them to the class or interface. For example, all of the boxed
      numerical primitive classes, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Double,</code><span
        class="Apple-converted-space">&nbsp;</span>export<code style="font-family: 'Courier New', monospace;">MIN_VALUE</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">MAX_VALUE</code><span class="Apple-converted-space">&nbsp;</span>constants.
      If the constants are best viewed as members of an enumerated type, you
      should export<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_107"></span>them with an<span class="Apple-converted-space">&nbsp;</span><em>enum
        type</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch6.xhtml#lev34"
        style="text-decoration: none;">Item 34</a>). Otherwise, you should
      export the constants with a noninstantiable<span class="Apple-converted-space">&nbsp;</span><em>utility
        class</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch2.xhtml#lev4"
        style="text-decoration: none;">Item 4</a>). Here is a utility class
      version of the<code style="font-family: 'Courier New', monospace;">PhysicalConstants</code><span
        class="Apple-converted-space">&nbsp;</span>example shown earlier:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex26a" id="pch4ex26" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Constant utility class</strong><br>
      package com.effectivejava.science;<br>
      <br>
      public class PhysicalConstants {<br>
      &nbsp;&nbsp;private PhysicalConstants() { }&nbsp;&nbsp;// Prevents
      instantiation<br>
      <br>
      &nbsp;&nbsp;public static final double AVOGADROS_NUMBER =
      6.022_140_857e23;<br>
      &nbsp;&nbsp;public static final double BOLTZMANN_CONST&nbsp;&nbsp;=
      1.380_648_52e-23;<br>
      &nbsp;&nbsp;public static final double
      ELECTRON_MASS&nbsp;&nbsp;&nbsp;&nbsp;= 9.109_383_56e-31;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Incidentally,
      note the use of the underscore character (<code style="font-family: 'Courier New', monospace;">_</code>)
      in the numeric literals. Underscores, which have been legal since Java 7,
      have no effect on the values of numeric literals, but can make them much
      easier to read if used with discretion. Consider adding underscores to
      numeric literals, whether fixed of floating point, if they contain five or
      more consecutive digits. For base ten literals, whether integral or
      floating point, you should use underscores to separate literals into
      groups of three digits indicating positive and negative powers of one
      thousand.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Normally
      a utility class requires clients to qualify constant names with a class
      name, for example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhysicalConstants.AVOGADROS_NUMBER</code>.
      If you make heavy use of the constants exported by a utility class, you
      can avoid the need for qualifying the constants with the class name by
      making use of the<span class="Apple-converted-space">&nbsp;</span><em>static
        import</em><span class="Apple-converted-space">&nbsp;</span>facility:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex27a" id="pch4ex27" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Use of static import to avoid qualifying constants</strong><br>
      import static com.effectivejava.science.PhysicalConstants.*;<br>
      <br>
      public class Test {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;&nbsp;atoms(double mols) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return AVOGADROS_NUMBER *
      mols;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Many more uses of PhysicalConstants justify
      static import<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, interfaces should be used only to define types. They should not
      be used merely to export constants.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev23" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_108"></span><strong>Item 23: Prefer class hierarchies to tagged
        classes</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Occasionally
      you may run across a class whose instances come in two or more flavors and
      contain a<span class="Apple-converted-space">&nbsp;</span><em>tag</em><span
        class="Apple-converted-space">&nbsp;</span>field indicating the flavor
      of the instance. For example, consider this class, which is capable of
      representing a circle or a rectangle:</p>
    <span epub:type="pagebreak" id="page_109" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex28a" id="pch4ex28" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Tagged class - vastly inferior to a class hierarchy!</strong><br>
      class Figure {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;enum Shape { RECTANGLE, CIRCLE };<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Tag field - the shape of this figure<br>
      &nbsp;&nbsp;&nbsp;&nbsp;final Shape shape;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// These fields are used only if shape is
      RECTANGLE<br>
      &nbsp;&nbsp;&nbsp;&nbsp;double length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;double width;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// This field is used only if shape is CIRCLE<br>
      &nbsp;&nbsp;&nbsp;&nbsp;double radius;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Constructor for circle<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Figure(double radius) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shape = Shape.CIRCLE;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.radius = radius;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Constructor for rectangle<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Figure(double length, double width) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shape = Shape.RECTANGLE;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.length = length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.width = width;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;double area() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(shape) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case
      RECTANGLE:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      length * width;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case CIRCLE:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      Math.PI * (radius * radius);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new AssertionError(shape);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_110"></span>Such<span class="Apple-converted-space">&nbsp;</span><em>tagged
        classes</em><span class="Apple-converted-space">&nbsp;</span>have
      numerous shortcomings. They are cluttered with boilerplate, including enum
      declarations, tag fields, and switch statements. Readability is further
      harmed because multiple implementations are jumbled together in a single
      class. Memory footprint is increased because instances are burdened with
      irrelevant fields belonging to other flavors. Fields can’t be made final
      unless constructors initialize irrelevant fields, resulting in more
      boilerplate. Constructors must set the tag field and initialize the right
      data fields with no help from the compiler: if you initialize the wrong
      fields, the program will fail at runtime. You can’t add a flavor to a
      tagged class unless you can modify its source file. If you do add a
      flavor, you must remember to add a case to every switch statement, or the
      class will fail at runtime. Finally, the data type of an instance gives no
      clue as to its flavor. In short,<span class="Apple-converted-space">&nbsp;</span><strong>tagged
        classes are verbose, error-prone, and inefficient.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Luckily,
      object-oriented languages such as Java offer a far better alternative for
      defining a single data type capable of representing objects of multiple
      flavors: subtyping.<span class="Apple-converted-space">&nbsp;</span><strong>A
        tagged class is just a pallid imitation of a class hierarchy.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      transform a tagged class into a class hierarchy, first define an abstract
      class containing an abstract method for each method in the tagged class
      whose behavior depends on the tag value. In the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Figure</code><span class="Apple-converted-space">&nbsp;</span>class,
      there is only one such method, which is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">area</code>. This
      abstract class is the root of the class hierarchy. If there are any
      methods whose behavior does not depend on the value of the tag, put them
      in this class. Similarly, if there are any data fields used by all the
      flavors, put them in this class. There are no such flavor-independent
      methods or fields in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Figure</code><span class="Apple-converted-space">&nbsp;</span>class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Next,
      define a concrete subclass of the root class for each flavor of the
      original tagged class. In our example, there are two: circle and
      rectangle. Include in each subclass the data fields particular to its
      flavor. In our example,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">radius</code><span class="Apple-converted-space">&nbsp;</span>is
      particular to circle, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">length</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">width</code><span
        class="Apple-converted-space">&nbsp;</span>are particular to rectangle.
      Also include in each subclass the appropriate implementation of each
      abstract method in the root class. Here is the class hierarchy
      corresponding to the original<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Figure</code><span class="Apple-converted-space">&nbsp;</span>class:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex29a" id="pch4ex29" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Class hierarchy replacement for a tagged class</strong><br>
      abstract class Figure {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;abstract double area();<br>
      }<br>
      <br>
      class Circle extends Figure {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;final double radius;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;Circle(double radius) { this.radius = radius; }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override double area() { return Math.PI * (radius
      * radius); }<br>
      }<br>
      <span epub:type="pagebreak" id="page_111"></span>class Rectangle extends
      Figure {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;final double length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;final double width;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;Rectangle(double length, double width) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.length = length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.width&nbsp;&nbsp;=
      width;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override double area() { return length * width; }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      class hierarchy corrects every shortcoming of tagged classes noted
      previously. The code is simple and clear, containing none of the
      boilerplate found in the original. The implementation of each flavor is
      allotted its own class, and none of these classes is encumbered by
      irrelevant data fields. All fields are final. The compiler ensures that
      each class’s constructor initializes its data fields and that each class
      has an implementation for every abstract method declared in the root
      class. This eliminates the possibility of a runtime failure due to a
      missing switch case. Multiple programmers can extend the hierarchy
      independently and interoperably without access to the source for the root
      class. There is a separate data type associated with each flavor, allowing
      programmers to indicate the flavor of a variable and to restrict variables
      and input parameters to a particular flavor.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Another
      advantage of class hierarchies is that they can be made to reflect natural
      hierarchical relationships among types, allowing for increased flexibility
      and better compile-time type checking. Suppose the tagged class in the
      original example also allowed for squares. The class hierarchy could be
      made to reflect the fact that a square is a special kind of rectangle
      (assuming both are immutable):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex30a" id="pch4ex30" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">class
      Square extends Rectangle {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Square(double side) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(side, side);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that the fields in the above hierarchy are accessed directly rather than
      by accessor methods. This was done for brevity and would be a poor design
      if the hierarchy were public (<a href="ch4.xhtml#lev16" style="text-decoration: none;">Item
        16</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, tagged classes are seldom appropriate. If you’re tempted to write
      a class with an explicit tag field, think about whether the tag could be
      eliminated and the class replaced by a hierarchy. When you encounter an
      existing class with a tag field, consider refactoring it into a hierarchy.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev24" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_112"></span><strong>Item 24: Favor static member classes over
        nonstatic</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A<span
        class="Apple-converted-space">&nbsp;</span><em>nested class</em><span class="Apple-converted-space">&nbsp;</span>is
      a class defined within another class. A nested class should exist only to
      serve its enclosing class. If a nested class would be useful in some other
      context, then it should be a top-level class. There are four kinds of
      nested classes:<span class="Apple-converted-space">&nbsp;</span><em>static
        member classes</em>,<span class="Apple-converted-space">&nbsp;</span><em>nonstatic
        member classes</em>,<span class="Apple-converted-space">&nbsp;</span><em>anonymous
        classes</em>, and<span class="Apple-converted-space">&nbsp;</span><em>local
        classes</em>. All but the first kind are known as<span class="Apple-converted-space">&nbsp;</span><em>inner
        classes</em>. This item tells you when to use which kind of nested class
      and why.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      static member class is the simplest kind of nested class. It is best
      thought of as an ordinary class that happens to be declared inside another
      class and has access to all of the enclosing class’s members, even those
      declared private. A static member class is a static member of its
      enclosing class and obeys the same accessibility rules as other static
      members. If it is declared private, it is accessible only within the
      enclosing class, and so forth.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      common use of a static member class is as a public helper class, useful
      only in conjunction with its outer class. For example, consider an enum
      describing the operations supported by a calculator (<a href="ch6.xhtml#lev34"
        style="text-decoration: none;">Item 34</a>). The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Operation</code><span class="Apple-converted-space">&nbsp;</span>enum
      should be a public static member class of the<code style="font-family: 'Courier New', monospace;">Calculator</code><span
        class="Apple-converted-space">&nbsp;</span>class. Clients of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Calculator</code><span class="Apple-converted-space">&nbsp;</span>could
      then refer to operations using names like<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Calculator.Operation.PLUS</code><span
        class="Apple-converted-space">&nbsp;</span>and<code style="font-family: 'Courier New', monospace;">Calculator.Operation.MINUS</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Syntactically,
      the only difference between static and nonstatic member classes is that
      static member classes have the modifier<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">static</code><span class="Apple-converted-space">&nbsp;</span>in
      their declarations. Despite the syntactic similarity, these two kinds of
      nested classes are very different. Each instance of a nonstatic member
      class is implicitly associated with an<span class="Apple-converted-space">&nbsp;</span><em>enclosing
        instance</em><span class="Apple-converted-space">&nbsp;</span>of its
      containing class. Within instance methods of a nonstatic member class, you
      can invoke methods on the enclosing instance or obtain a reference to the
      enclosing instance using the<span class="Apple-converted-space">&nbsp;</span><em>qualified
        this</em><span class="Apple-converted-space">&nbsp;</span>construct
      [JLS, 15.8.4]. If an instance of a nested class can exist in isolation
      from an instance of its enclosing class, then the nested class<span class="Apple-converted-space">&nbsp;</span><em>must</em><span
        class="Apple-converted-space">&nbsp;</span>be a static member class: it
      is impossible to create an instance of a nonstatic member class without an
      enclosing instance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      association between a nonstatic member class instance and its enclosing
      instance is established when the member class instance is created and
      cannot be modified thereafter. Normally, the association is established
      automatically by invoking a nonstatic member class constructor from within
      an instance method of the enclosing class. It is possible, though rare, to
      establish the association manually using the expression<code style="font-family: 'Courier New', monospace;">enclosingInstance.new
        MemberClass(args)</code>. As you would expect, the association takes up
      space in the nonstatic member class instance and adds time to its
      construction.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_113"></span>One common use of a nonstatic
      member class is to define an<span class="Apple-converted-space">&nbsp;</span><em>Adapter</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>] that allows an instance of
      the outer class to be viewed as an instance of some unrelated class. For
      example, implementations of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>interface
      typically use nonstatic member classes to implement their<em>collection
        views</em>, which are returned by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">keySet</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">entrySet</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">values</code><span
        class="Apple-converted-space">&nbsp;</span>methods. Similarly,
      implementations of the collection interfaces, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,
      typically use nonstatic member classes to implement their iterators:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex31a" id="pch4ex31" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typical use of a nonstatic member class</strong><br>
      public class MySet&lt;E&gt; extends AbstractSet&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Bulk of the class omitted<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public Iterator&lt;E&gt; iterator() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new MyIterator();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private class MyIterator implements
        Iterator&lt;E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>If
        you declare a member class that does not require access to an enclosing
        instance,</strong><span class="Apple-converted-space">&nbsp;</span><em><strong>always</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>put the</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>static</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>modifier in its
        declaration,</strong><span class="Apple-converted-space">&nbsp;</span>making
      it a static rather than a nonstatic member class. If you omit this
      modifier, each instance will have a hidden extraneous reference to its
      enclosing instance. As previously mentioned, storing this reference takes
      time and space. More seriously, it can result in the enclosing instance
      being retained when it would otherwise be eligible for garbage collection
      (<a href="ch2.xhtml#lev7" style="text-decoration: none;">Item 7</a>). The
      resulting memory leak can be catastrophic. It is often difficult to detect
      because the reference is invisible.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      common use of private static member classes is to represent components of
      the object represented by their enclosing class. For example, consider a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code><span
        class="Apple-converted-space">&nbsp;</span>instance, which associates
      keys with values. Many<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>implementations
      have an internal<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Entry</code><span
        class="Apple-converted-space">&nbsp;</span>object for each key-value
      pair in the map. While each entry is associated with a map, the methods on
      an entry (<code style="font-family: 'Courier New', monospace;">getKey</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getValue</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">setValue</code>)
      do not need access to the map. Therefore, it would be wasteful to use a
      nonstatic member class to represent entries: a private static member class
      is best. If you accidentally omit the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">static</code><span class="Apple-converted-space">&nbsp;</span>modifier
      in the entry declaration, the map will still work, but each entry will
      contain a superfluous reference to the map, which wastes space and time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is doubly important to choose correctly between a static and a nonstatic
      member class if the class in question is a public or protected member of
      an<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_114"></span>exported class. In this case, the member class is
      an exported API element and cannot be changed from a nonstatic to a static
      member class in a subsequent release without violating backward
      compatibility.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      you would expect, an anonymous class has no name. It is not a member of
      its enclosing class. Rather than being declared along with other members,
      it is simultaneously declared and instantiated at the point of use.
      Anonymous classes are permitted at any point in the code where an
      expression is legal. Anonymous classes have enclosing instances if and
      only if they occur in a nonstatic context. But even if they occur in a
      static context, they cannot have any static members other than<span class="Apple-converted-space">&nbsp;</span><em>constant
        variables</em>, which are final primitive or string fields initialized
      to constant expressions [JLS, 4.12.4].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are many limitations on the applicability of anonymous classes. You can’t
      instantiate them except at the point they’re declared. You can’t perform<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">instanceof</code><span
        class="Apple-converted-space">&nbsp;</span>tests or do anything else
      that requires you to name the class. You can’t declare an anonymous class
      to implement multiple interfaces or to extend a class and implement an
      interface at the same time. Clients of an anonymous class can’t invoke any
      members except those it inherits from its supertype. Because anonymous
      classes occur in the midst of expressions, they must be kept short—about
      ten lines or fewer—or readability will suffer.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Before
      lambdas were added to Java (<a href="ch6.xhtml#ch6" style="text-decoration: none;">Chapter
        6</a>), anonymous classes were the preferred means of creating small<span
        class="Apple-converted-space">&nbsp;</span><em>function objects</em><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><em>process
        objects</em><span class="Apple-converted-space">&nbsp;</span>on the fly,
      but lambdas are now preferred (<a href="ch7.xhtml#lev42" style="text-decoration: none;">Item
        42</a>). Another common use of anonymous classes is in the
      implementation of static factory methods (see<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">intArrayAsList</code><span
        class="Apple-converted-space">&nbsp;</span>in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev20" style="text-decoration: none;">Item 20</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Local
      classes are the least frequently used of the four kinds of nested classes.
      A local class can be declared practically anywhere a local variable can be
      declared and obeys the same scoping rules. Local classes have attributes
      in common with each of the other kinds of nested classes. Like member
      classes, they have names and can be used repeatedly. Like anonymous
      classes, they have enclosing instances only if they are defined in a
      nonstatic context, and they cannot contain static members. And like
      anonymous classes, they should be kept short so as not to harm
      readability.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      recap, there are four different kinds of nested classes, and each has its
      place. If a nested class needs to be visible outside of a single method or
      is too long to fit comfortably inside a method, use a member class. If
      each instance of a member class needs a reference to its enclosing
      instance, make it nonstatic; otherwise, make it static. Assuming the class
      belongs inside a method, if you need to create instances from only one
      location and there is a preexisting type that characterizes the class,
      make it an anonymous class; otherwise, make it a local class.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev25" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_115"></span><strong>Item 25: Limit source files to a single
        top-level class</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      the Java compiler lets you define multiple top-level classes in a single
      source file, there are no benefits associated with doing so, and there are
      significant risks. The risks stem from the fact that defining multiple
      top-level classes in a source file makes it possible to provide multiple
      definitions for a class. Which definition gets used is affected by the
      order in which the source files are passed to the compiler.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make this concrete, consider this source file, which contains only a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Main</code><span
        class="Apple-converted-space">&nbsp;</span>class that refers to members
      of two other top-level classes (<code style="font-family: 'Courier New', monospace;">Utensil</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert</code>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex32a" id="pch4ex32" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Main {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(Utensil.NAME
      + Dessert.NAME);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      suppose you define both<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Utensil</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Dessert</code><span
        class="Apple-converted-space">&nbsp;</span>in a single source file named<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Utensil.java</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex33a" id="pch4ex33" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Two classes defined in one file. Don't ever do this!</strong><br>
      class Utensil {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final String NAME = "pan";<br>
      }<br>
      <br>
      class Dessert {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final String NAME = "cake";<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Of
      course the main program prints<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pancake</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      suppose you accidentally make<span class="Apple-converted-space">&nbsp;</span><em>another</em><span
        class="Apple-converted-space">&nbsp;</span>source file named<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert.java</code><span
        class="Apple-converted-space">&nbsp;</span>that defines the same two
      classes:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex34a" id="pch4ex34" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Two classes defined in one file. Don't ever do this!</strong><br>
      class Utensil {<br>
      &nbsp;&nbsp;&nbsp; static final String NAME = "pot";<br>
      }<br>
      <br>
      class Dessert {<br>
      &nbsp;&nbsp;&nbsp; static final String NAME = "pie";<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you’re lucky enough to compile the program with the command<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">javac Main.java
        Dessert.java</code>, the compilation will fail, and the compiler will<span
        class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak" id="page_116"></span>tell
      you that you’ve multiply defined the classes<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Utensil</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Dessert</code>.
      This is so because the compiler will first compile<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Main.java</code>, and
      when it sees the reference to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Utensil</code><span class="Apple-converted-space">&nbsp;</span>(which
      precedes the reference to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert</code>), it will
      look in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Utensil.java</code><span
        class="Apple-converted-space">&nbsp;</span>for this class and find both<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Utensil</code><span
        class="Apple-converted-space">&nbsp;</span>and<code style="font-family: 'Courier New', monospace;">Dessert</code>.
      When the compiler encounters<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert.java</code><span
        class="Apple-converted-space">&nbsp;</span>on the command line, it will
      pull in that file too, causing it to encounter both definitions of<code style="font-family: 'Courier New', monospace;">Utensil</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you compile the program with the command<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">javac Main.java</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">javac Main.java
        Utensil.java</code>, it will behave as it did before you wrote the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Dessert.java</code><span
        class="Apple-converted-space">&nbsp;</span>file, printing<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pancake</code>. But if
      you compile the program with the command<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">javac Dessert.java
        Main.java</code>, it will print<code style="font-family: 'Courier New', monospace;">potpie</code>.
      The behavior of the program is thus affected by the order in which the
      source files are passed to the compiler, which is clearly unacceptable.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Fixing
      the problem is as simple as splitting the top-level classes (<code style="font-family: 'Courier New', monospace;">Utensil</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert</code>, in the
      case of our example) into separate source files. If you are tempted to put
      multiple top-level classes into a single source file, consider using
      static member classes (<a href="ch4.xhtml#lev24" style="text-decoration: none;">Item
        24</a>) as an alternative to splitting the classes into separate source
      files. If the classes are subservient to another class, making them into
      static member classes is generally the better alternative because it
      enhances readability and makes it possible to reduce the accessibility of
      the classes by declaring them private (<a href="ch4.xhtml#lev15" style="text-decoration: none;">Item
        15</a>). Here is how our example looks with static member classes:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex35a" id="pch4ex35" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Static member classes instead of multiple top-level classes</strong><br>
      public class Test {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(Utensil.NAME
      + Dessert.NAME);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static class Utensil {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static final String NAME =
      "pan";<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static class Dessert {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static final String NAME =
      "cake";<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      lesson is clear:<span class="Apple-converted-space">&nbsp;</span><strong>Never
        put multiple top-level classes or interfaces in a single source file.</strong><span
        class="Apple-converted-space">&nbsp;</span>Following this rule
      guarantees that you can’t have multiple definitions for a single class at
      compile time. This in turn guarantees that the class files generated by
      compilation, and the behavior of the resulting program, are independent of
      the order in which the source files are passed to the compiler.</p>
    <p></p>
    <p> </p>
    <h2 class="h2" id="ch5" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Chapter
      5. Generics</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>S</strong><small
        style="font-size: 0.7em;">INCE</small><span class="Apple-converted-space">&nbsp;</span>Java
      5, generics have been a part of the language. Before generics, you had to
      cast every object you read from a collection. If someone accidentally
      inserted an object of the wrong type, casts could fail at runtime. With
      generics, you tell the compiler what types of objects are permitted in
      each collection. The compiler inserts casts for you automatically and
      tells you<span class="Apple-converted-space">&nbsp;</span><em>at compile
        time</em><span class="Apple-converted-space">&nbsp;</span>if you try to
      insert an object of the wrong type. This results in programs that are both
      safer and clearer, but these benefits, which are not limited to
      collections, come at a price. This chapter tells you how to maximize the
      benefits and minimize the complications.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev26" style="text-decoration: none;"></a><strong>Item 26: Don’t use
        raw types</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">First,
      a few terms. A class or interface whose declaration has one or more<span class="Apple-converted-space">&nbsp;</span><em>type
        parameters</em><span class="Apple-converted-space">&nbsp;</span>is a<span
        class="Apple-converted-space">&nbsp;</span><em>generic</em><span class="Apple-converted-space">&nbsp;</span>class
      or interface [JLS, 8.1.2, 9.1.2]. For example, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>interface
      has a single type parameter,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>, representing
      its element type. The full name of the interface is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(read “list of<code style="font-family: 'Courier New', monospace;">E</code>”),
      but people often call it<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>for
      short. Generic classes and interfaces are collectively known as<span class="Apple-converted-space">&nbsp;</span><em>generic
        types</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Each
      generic type defines a set of<span class="Apple-converted-space">&nbsp;</span><em>parameterized
        types</em>, which consist of the class or interface name followed by an
      angle-bracketed list of<em>actual type parameters</em><span class="Apple-converted-space">&nbsp;</span>corresponding
      to the generic type’s formal type parameters [JLS, 4.4, 4.5]. For example,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(read “list of string”) is a
      parameterized type representing a list whose elements are of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>. (<code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>is the actual type parameter
      corresponding to the formal type parameter<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>.)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Finally,
      each generic type defines a<span class="Apple-converted-space">&nbsp;</span><em>raw
        type</em>, which is the name of the generic type used without any
      accompanying type parameters [JLS, 4.8]. For example, the raw type
      corresponding to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>. Raw types
      behave as if all of the generic type information were erased from the type
      declaration. They exist primarily for compatibility with pre-generics
      code.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_118"></span>Before generics were added to
      Java, this would have been an exemplary collection declaration. As of Java
      9, it is still legal, but far from exemplary:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex1a" id="pch5ex1" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Raw collection type - don't do this!</strong><br>
      <br>
      // My stamp collection. Contains only Stamp instances.<br>
      private final<span class="Apple-converted-space">&nbsp;</span><strong>Collection</strong><span
        class="Apple-converted-space">&nbsp;</span>stamps = ... ;</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you use this declaration today and then accidentally put a coin into your
      stamp collection, the erroneous insertion compiles and runs without error
      (though the compiler does emit a vague warning):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex2a" id="pch5ex2" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Erroneous insertion of coin into stamp collection</strong><br>
      stamps.add(new Coin( ... )); // Emits "unchecked call" warning</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      don’t get an error until you try to retrieve the coin from the stamp
      collection:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex3a" id="pch5ex3" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Raw iterator type - don't do this!</strong><br>
      for (<strong>Iterator</strong><span class="Apple-converted-space">&nbsp;</span>i
      = stamps.iterator(); i.hasNext(); )<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Stamp stamp =<span class="Apple-converted-space">&nbsp;</span><strong>(Stamp)</strong><span
        class="Apple-converted-space">&nbsp;</span>i.next();<span class="Apple-converted-space">&nbsp;</span><strong>//
        Throws ClassCastException</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stamp.cancel();</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      mentioned throughout this book, it pays to discover errors as soon as
      possible after they are made, ideally at compile time. In this case, you
      don’t discover the error until runtime, long after it has happened, and in
      code that may be distant from the code containing the error. Once you see
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code>,
      you have to search through the codebase looking for the method invocation
      that put the coin into the stamp collection. The compiler can’t help you,
      because it can’t understand the comment that says, “<code style="font-family: 'Courier New', monospace;">Contains
        only Stamp instances</code>.”</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">With
      generics, the type declaration contains the information, not the comment:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex4a" id="pch5ex4" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Parameterized collection type - typesafe</strong><br>
      private final<span class="Apple-converted-space">&nbsp;</span><strong>Collection&lt;Stamp&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>stamps = ... ;</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">From
      this declaration, the compiler knows that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">stamps</code><span class="Apple-converted-space">&nbsp;</span>should
      contain only<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stamp</code><span
        class="Apple-converted-space">&nbsp;</span>instances and<span class="Apple-converted-space">&nbsp;</span><em>guarantees</em><span
        class="Apple-converted-space">&nbsp;</span>it to be true, assuming your
      entire codebase compiles without emitting (or suppressing; see<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev27" style="text-decoration: none;">Item 27</a>) any
      warnings. When<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">stamps</code><span
        class="Apple-converted-space">&nbsp;</span>is declared with a
      parameterized type declaration, the erroneous insertion generates a
      compile-time error message that tells you<span class="Apple-converted-space">&nbsp;</span><em>exactly</em><span
        class="Apple-converted-space">&nbsp;</span>what is wrong:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex5a" id="pch5ex5" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Test.java:9:
      error: incompatible types: Coin cannot be converted<br>
      to Stamp<br>
      &nbsp;&nbsp;&nbsp;&nbsp;c.add(new Coin());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_119"></span>The compiler inserts
      invisible casts for you when retrieving elements from collections and
      guarantees that they won’t fail (assuming, again, that all of your code
      did not generate or suppress any compiler warnings). While the prospect of
      accidentally inserting a coin into a stamp collection may appear
      far-fetched, the problem is real. For example, it is easy to imagine
      putting a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>into a collection that is
      supposed to contain only<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>instances.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      noted earlier, it is legal to use raw types (generic types without their
      type parameters), but you should never do it.<span class="Apple-converted-space">&nbsp;</span><strong>If
        you use raw types, you lose all the safety and expressiveness benefits
        of generics.</strong><span class="Apple-converted-space">&nbsp;</span>Given
      that you shouldn’t use them, why did the language designers permit raw
      types in the first place? For compatibility. Java was about to enter its
      second decade when generics were added, and there was an enormous amount
      of code in existence that did not use generics. It was deemed critical
      that all of this code remain legal and interoperate with newer code that
      does use generics. It had to be legal to pass instances of parameterized
      types to methods that were designed for use with raw types, and vice
      versa. This requirement, known as<span class="Apple-converted-space">&nbsp;</span><em>migration
        compatibility</em>, drove the decisions to support raw types and to
      implement generics using<span class="Apple-converted-space">&nbsp;</span><em>erasure</em>(<a
        href="ch5.xhtml#lev28" style="text-decoration: none;">Item 28</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      you shouldn’t use raw types such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>, it is fine
      to use types that are parameterized to allow insertion of arbitrary
      objects, such as<code style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>.
      Just what is the difference between the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>and
      the parameterized type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>?
      Loosely speaking, the former has opted out of the generic type system,
      while the latter has explicitly told the compiler that it is capable of
      holding objects of any type. While you can pass a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>to a parameter of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>, you can’t
      pass it to a parameter of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>.
      There are sub-typing rules for generics, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is a subtype of the raw type<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,
      but not of the parameterized type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev28" style="text-decoration: none;">Item
        28</a>). As a consequence,<strong>you lose type safety if you use a raw
        type such as</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>List</strong></code><strong>,
        but not if you use a parameterized type such as</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>List&lt;Object&gt;</strong></code><strong>.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make this concrete, consider the following program:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex6a" id="pch5ex6" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Fails at runtime - unsafeAdd method uses a raw type (List)!</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;List&lt;String&gt; strings = new
      ArrayList&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;unsafeAdd(strings, Integer.valueOf(42));<br>
      &nbsp;&nbsp;&nbsp;&nbsp;String s =<span class="Apple-converted-space">&nbsp;</span><strong>strings.get(0);
        // Has compiler-generated cast</strong><br>
      }<br>
      <br>
      private static void unsafeAdd(<strong>List</strong><span class="Apple-converted-space">&nbsp;</span>list,
      Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;list.add(o);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_120"></span>This program compiles, but
      because it uses the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>, you get a
      warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex7a" id="pch5ex7" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Test.java:10:
      warning: [unchecked] unchecked call to add(E) as a<br>
      member of the raw type List<br>
      &nbsp;&nbsp;&nbsp;&nbsp;list.add(o);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">And
      indeed, if you run the program, you get a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>when the program tries to
      cast the result of the invocation<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">strings.get(0)</code>,
      which is an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code>,
      to a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code>.
      This is a compiler-generated cast, so it’s normally guaranteed to succeed,
      but in this case we ignored a compiler warning and paid the price.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you replace the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>with
      the parameterized type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">unsafeAdd</code><span class="Apple-converted-space">&nbsp;</span>declaration
      and try to recompile the program, you’ll find that it no longer compiles
      but emits the error message:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex8a" id="pch5ex8" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Test.java:5:
      error: incompatible types: List&lt;String&gt; cannot be<br>
      converted to List&lt;Object&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;unsafeAdd(strings, Integer.valueOf(42));<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      might be tempted to use a raw type for a collection whose element type is
      unknown and doesn’t matter. For example, suppose you want to write a
      method that takes two sets and returns the number of elements they have in
      common. Here’s how you might write such a method if you were new to
      generics:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex9a" id="pch5ex9" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Use of raw type for unknown element type - don't do this!</strong><br>
      static int numElementsInCommon(<strong>Set s1, Set s2</strong>) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int result = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (Object o1 : s1)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (s2.contains(o1))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result++;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method works but it uses raw types, which are dangerous. The safe
      alternative is to use<span class="Apple-converted-space">&nbsp;</span><em>unbounded
        wildcard types</em>. If you want to use a generic type but you don’t
      know or care what the actual type parameter is, you can use a question
      mark instead. For example, the unbounded wildcard type for the generic
      type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(read “set of some type”). It
      is the most general parameterized<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>type,
      capable of holding<em>any</em><span class="Apple-converted-space">&nbsp;</span>set.
      Here is how the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">numElementsInCommon</code><span
        class="Apple-converted-space">&nbsp;</span>declaration looks with
      unbounded wildcard types:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex10a" id="pch5ex10" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Uses unbounded wildcard type - typesafe and flexible</strong><br>
      static int numElementsInCommon(<strong>Set&lt;?&gt; s1, Set&lt;?&gt; s2</strong>)
      { ... }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_121"></span>What is the difference
      between the unbounded wildcard type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code>? Does the
      question mark really buy you anything? Not to belabor the point, but the
      wildcard type is safe and the raw type isn’t. You can put<span class="Apple-converted-space">&nbsp;</span><em>any</em><span
        class="Apple-converted-space">&nbsp;</span>element into a collection
      with a raw type, easily corrupting the collection’s type invariant (as
      demonstrated by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">unsafeAdd</code><span class="Apple-converted-space">&nbsp;</span>method
      on page 119);<span class="Apple-converted-space">&nbsp;</span><strong>you
        can’t put any element (other than</strong><code style="font-family: 'Courier New', monospace;"><strong>null</strong></code><strong>)
        into a</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>Collection&lt;?&gt;</strong></code><strong>.</strong><span
        class="Apple-converted-space">&nbsp;</span>Attempting to do so will
      generate a compile-time error message like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex11a" id="pch5ex11" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">WildCard.java:13:
      error: incompatible types: String cannot be<br>
      converted to CAP#1<br>
      &nbsp;&nbsp;&nbsp;&nbsp;c.add("verboten");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^<br>
      &nbsp;&nbsp;where CAP#1 is a fresh type-variable:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;CAP#1 extends Object from capture of ?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Admittedly
      this error message leaves something to be desired, but the compiler has
      done its job, preventing you from corrupting the collection’s type
      invariant, whatever its element type may be. Not only can’t you put any
      element (other than<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>) into a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collection&lt;?&gt;</code>,
      but you can’t assume anything about the type of the objects that you get
      out. If these restrictions are unacceptable, you can use<span class="Apple-converted-space">&nbsp;</span><em>generic
        methods</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Item 30</a>) or<em>bounded wildcard types</em><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev31" style="text-decoration: none;">Item
        31</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are a few minor exceptions to the rule that you should not use raw types.<span
        class="Apple-converted-space">&nbsp;</span><strong>You must use raw
        types in class literals.</strong><span class="Apple-converted-space">&nbsp;</span>The
      specification does not permit the use of parameterized types (though it
      does permit array types and primitive types) [JLS, 15.8.2]. In other
      words,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List.class</code>,<code
        style="font-family: 'Courier New', monospace;">String[].class</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">int.class</code><span
        class="Apple-converted-space">&nbsp;</span>are all legal, but<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;?&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>are not.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      second exception to the rule concerns the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instanceof</code><span class="Apple-converted-space">&nbsp;</span>operator.
      Because generic type information is erased at runtime, it is illegal to
      use the<code style="font-family: 'Courier New', monospace;">instanceof</code><span
        class="Apple-converted-space">&nbsp;</span>operator on parameterized
      types other than unbounded wildcard types. The use of unbounded wildcard
      types in place of raw types does not affect the behavior of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instanceof</code><span class="Apple-converted-space">&nbsp;</span>operator
      in any way. In this case, the angle brackets and question marks are just
      noise.<span class="Apple-converted-space">&nbsp;</span><strong>This is the
        preferred way to use the</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>instanceof</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>operator with generic
        types:</strong></p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex12a" id="pch5ex12" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Legitimate use of raw type - instanceof operator</strong><br>
      if (o instanceof<span class="Apple-converted-space">&nbsp;</span><strong>Set</strong>)
      {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Raw type<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>Set&lt;?&gt;</strong><span class="Apple-converted-space">&nbsp;</span>s
      =<span class="Apple-converted-space">&nbsp;</span><strong>(Set&lt;?&gt;)</strong><span
        class="Apple-converted-space">&nbsp;</span>o;&nbsp;&nbsp;&nbsp;&nbsp;//
      Wildcard type<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_122"></span>Note that once you’ve
      determined that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">o</code><span
        class="Apple-converted-space">&nbsp;</span>is a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code>, you must cast
      it to the wildcard type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;?&gt;</code>, not
      the raw type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code>.
      This is a checked cast, so it will not cause a compiler warning.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, using raw types can lead to exceptions at runtime, so don’t use
      them. They are provided only for compatibility and interoperability with
      legacy code that predates the introduction of generics. As a quick review,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is a parameterized type
      representing a set that can contain objects of any type,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is a wildcard type
      representing a set that can contain only objects of some unknown type, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code><span
        class="Apple-converted-space">&nbsp;</span>is a raw type, which opts out
      of the generic type system. The first two are safe, and the last is not.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      quick reference, the terms introduced in this item (and a few introduced
      later in this chapter) are summarized in the following table:</p>
    <table class="tablewidth" style="border-collapse: collapse; width: 1179px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
      <tbody>
        <tr>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Term</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Example</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Item</strong></p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Parameterized
              type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Actual
              type parameter</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">String</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Generic
              type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Items
              26, 29</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Formal
              type parameter</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">E</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Unbounded
              wildcard type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List&lt;?&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Raw
              type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Bounded
              type parameter</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">&lt;E extends
                Number&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              29</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Recursive
              type bound</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">&lt;T extends
                Comparable&lt;T&gt;&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              30</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Bounded
              wildcard type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List&lt;? extends
                Number&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              31</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Generic
              method</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">static &lt;E&gt;
                List&lt;E&gt; asList(E[] a)</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              30</p>
          </td>
        </tr>
        <tr>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Type
              token</p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">String.class</code></p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              33</p>
          </td>
        </tr>
      </tbody>
    </table>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev27" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_123"></span><strong>Item 27: Eliminate unchecked warnings</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you program with generics, you will see many compiler warnings: unchecked
      cast warnings, unchecked method invocation warnings, unchecked
      parameterized vararg type warnings, and unchecked conversion warnings. The
      more experience you acquire with generics, the fewer warnings you’ll get,
      but don’t expect newly written code to compile cleanly.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      unchecked warnings are easy to eliminate. For example, suppose you
      accidentally write this declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex13a" id="pch5ex13" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Lark&gt;
      exaltation = new HashSet();</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      compiler will gently remind you what you did wrong:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex14a" id="pch5ex14" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Venery.java:4:
      warning: [unchecked] unchecked conversion<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;Lark&gt; exaltation
      = new HashSet();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;required: Set&lt;Lark&gt;<br>
      &nbsp;&nbsp;found:&nbsp;&nbsp;&nbsp;&nbsp;HashSet</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can then make the indicated correction, causing the warning to disappear.
      Note that you don’t actually have to specify the type parameter, merely to
      indicate that it’s present with the<span class="Apple-converted-space">&nbsp;</span><em>diamond
        operator</em><span class="Apple-converted-space">&nbsp;</span>(<code style="font-family: 'Courier New', monospace;">&lt;&gt;</code>),
      introduced in Java 7. The compiler will then<span class="Apple-converted-space">&nbsp;</span><em>infer</em><span
        class="Apple-converted-space">&nbsp;</span>the correct actual type
      parameter (in this case,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Lark</code>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex15a" id="pch5ex15" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Lark&gt;
      exaltation = new HashSet<strong>&lt;&gt;</strong>();</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Some
      warnings will be<span class="Apple-converted-space">&nbsp;</span><em>much</em><span
        class="Apple-converted-space">&nbsp;</span>more difficult to eliminate.
      This chapter is filled with examples of such warnings. When you get
      warnings that require some thought, persevere!<span class="Apple-converted-space">&nbsp;</span><strong>Eliminate
        every unchecked warning that you can.</strong><span class="Apple-converted-space">&nbsp;</span>If
      you eliminate all warnings, you are assured that your code is typesafe,
      which is a very good thing. It means that you won’t get a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime, and it increases
      your confidence that your program will behave as you intended.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>If
        you can’t eliminate a warning, but you can prove that the code that
        provoked the warning is typesafe, then (and only then) suppress the
        warning with an</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>@SuppressWarnings("unchecked")</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>annotation.</strong><span
        class="Apple-converted-space">&nbsp;</span>If you suppress warnings
      without first proving that the code is typesafe, you are giving yourself a
      false sense of security. The code may compile without emitting any
      warnings, but it can still throw a<code style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime. If, however, you
      ignore unchecked warnings that you know to be safe (instead of suppressing
      them), you won’t notice when a new warning crops up that represents a real
      problem. The new warning will get lost amidst all the false alarms that
      you didn’t silence.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_124"></span>The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SuppressWarnings</code><span
        class="Apple-converted-space">&nbsp;</span>annotation can be used on any
      declaration, from an individual local variable declaration to an entire
      class.<span class="Apple-converted-space">&nbsp;</span><strong>Always use
        the</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>SuppressWarnings</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>annotation on the
        smallest scope possible.</strong><span class="Apple-converted-space">&nbsp;</span>Typically
      this will be a variable declaration or a very short method or constructor.
      Never use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SuppressWarnings</code><span
        class="Apple-converted-space">&nbsp;</span>on an entire class. Doing so
      could mask critical warnings.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you find yourself using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SuppressWarnings</code><span
        class="Apple-converted-space">&nbsp;</span>annotation on a method or
      constructor that’s more than one line long, you may be able to move it
      onto a local variable declaration. You may have to declare a new local
      variable, but it’s worth it. For example, consider this<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toArray</code>method,
      which comes from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ArrayList</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex16a" id="pch5ex16" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      &lt;T&gt; T[] toArray(T[] a) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (a.length &lt; size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (T[]) Arrays.copyOf(elements,
      size, a.getClass());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(elements, 0, a, 0, size);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (a.length &gt; size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a[size] = null;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return a;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you compile<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ArrayList</code>,
      the method generates this warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex17a" id="pch5ex17" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ArrayList.java:305:
      warning: [unchecked] unchecked cast<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (T[]) Arrays.copyOf(elements,
      size, a.getClass());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;required: T[]<br>
      &nbsp;&nbsp;found:&nbsp;&nbsp;&nbsp;&nbsp;Object[]</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is illegal to put a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SuppressWarnings</code><span
        class="Apple-converted-space">&nbsp;</span>annotation on the return
      statement, because it isn’t a declaration [JLS, 9.7]. You might be tempted
      to put the annotation on the entire method, but don’t. Instead, declare a
      local variable to hold the return value and annotate its declaration, like
      so:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex18a" id="pch5ex18" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Adding local variable to reduce scope of @SuppressWarnings</strong><br>
      public &lt;T&gt; T[] toArray(T[] a) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (a.length &lt; size) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>// This cast is
        correct because the array we're creating</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>// is of the same
        type as the one passed in, which is T[].</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>@SuppressWarnings("unchecked")
        T[] result =</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>(T[])
        Arrays.copyOf(elements, size, a.getClass());</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>return result;</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(elements, 0, a, 0, size);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (a.length &gt; size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a[size] = null;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return a;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_125"></span>The resulting method compiles
      cleanly and minimizes the scope in which unchecked warnings are
      suppressed.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Every
        time you use a</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>@SuppressWarnings("unchecked")</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>annotation, add a
        comment saying why it is safe to do so.</strong><span class="Apple-converted-space">&nbsp;</span>This
      will help others understand the code, and more importantly, it will
      decrease the odds that someone will modify the code so as to make the
      computation unsafe. If you find it hard to write such a comment, keep
      thinking. You may end up figuring out that the unchecked operation isn’t
      safe after all.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, unchecked warnings are important. Don’t ignore them. Every
      unchecked warning represents the potential for a<code style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime. Do your best to
      eliminate these warnings. If you can’t eliminate an unchecked warning and
      you can prove that the code that provoked it is typesafe, suppress the
      warning with a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@SuppressWarnings("unchecked")</code><span
        class="Apple-converted-space">&nbsp;</span>annotation in the narrowest
      possible scope. Record the rationale for your decision to suppress the
      warning in a comment.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev28" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_126"></span><strong>Item 28: Prefer lists to arrays</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Arrays
      differ from generic types in two important ways. First, arrays are<span class="Apple-converted-space">&nbsp;</span><em>covariant</em>.
      This scary-sounding word means simply that if<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Sub</code><span class="Apple-converted-space">&nbsp;</span>is
      a subtype of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Super</code>,
      then the array type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Sub[]</code><span class="Apple-converted-space">&nbsp;</span>is
      a subtype of the array type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Super[]</code>. Generics,
      by contrast, are<span class="Apple-converted-space">&nbsp;</span><em>invariant</em>:
      for any two distinct types<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Type1</code>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Type2</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Type1&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is neither a subtype nor a
      supertype of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Type2&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>[JLS, 4.10; Naftalin07, 2.5].
      You might think this means that generics are deficient, but arguably it is
      arrays that are deficient. This code fragment is legal:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex19a" id="pch5ex19" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Fails at runtime!</strong><br>
      Object[] objectArray = new Long[1];<br>
      objectArray[0] = "I don't fit in";<span class="Apple-converted-space">&nbsp;</span><strong>//
        Throws ArrayStoreException</strong></p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">but
      this one is not:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex20a" id="pch5ex20" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Won't compile!</strong><br>
      List&lt;Object&gt; ol = new ArrayList&lt;Long&gt;();<span class="Apple-converted-space">&nbsp;</span><strong>//
        Incompatible types</strong><br>
      ol.add("I don't fit in");</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Either
      way you can’t put a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>into
      a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Long</code><span
        class="Apple-converted-space">&nbsp;</span>container, but with an array
      you find out that you’ve made a mistake at runtime; with a list, you find
      out at compile time. Of course, you’d rather find out at compile time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      second major difference between arrays and generics is that arrays are<span
        class="Apple-converted-space">&nbsp;</span><em>reified</em><span class="Apple-converted-space">&nbsp;</span>[JLS,
      4.7]. This means that arrays know and enforce their element type at
      runtime. As noted earlier, if you try to put a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>into
      an array of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Long</code>,
      you’ll get an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ArrayStoreException</code>.
      Generics, by contrast, are implemented by<span class="Apple-converted-space">&nbsp;</span><em>erasure</em><span
        class="Apple-converted-space">&nbsp;</span>[JLS, 4.6]. This means that
      they enforce their type constraints only at compile time and discard (or<span
        class="Apple-converted-space">&nbsp;</span><em>erase</em>) their element
      type information at runtime. Erasure is what allowed generic types to
      interoperate freely with legacy code that didn’t use generics (<a href="ch5.xhtml#lev26"
        style="text-decoration: none;">Item 26</a>), ensuring a smooth
      transition to generics in Java 5.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      of these fundamental differences, arrays and generics do not mix well. For
      example, it is illegal to create an array of a generic type, a
      parameterized type, or a type parameter. Therefore, none of these array
      creation expressions are legal:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">new List&lt;E&gt;[]</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">new
        List&lt;String&gt;[]</code>,<code style="font-family: 'Courier New', monospace;">new
        E[]</code>. All will result in<span class="Apple-converted-space">&nbsp;</span><em>generic
        array creation</em><span class="Apple-converted-space">&nbsp;</span>errors
      at compile time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Why
      is it illegal to create a generic array? Because it isn’t typesafe. If it
      were legal, casts generated by the compiler in an otherwise correct
      program could fail at runtime with a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>.
      This would violate the fundamental guarantee provided by the generic type
      system.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_127"></span>To make this more concrete,
      consider the following code fragment:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex21a" id="pch5ex21" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Why generic array creation is illegal - won't compile!</strong><br>
      List&lt;String&gt;[] stringLists =<span class="Apple-converted-space">&nbsp;</span><strong>new
        List&lt;String&gt;[1]</strong>;&nbsp;&nbsp;// (1)<br>
      List&lt;Integer&gt; intList =
      List.of(42);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      // (2)<br>
      Object[] objects =
      stringLists;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (3)<br>
      objects[0] =
      intList;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (4)<br>
      String s =
      stringLists[0].get(0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (5)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Let’s
      pretend that line 1, which creates a generic array, is legal. Line 2
      creates and initializes a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>containing a single element.
      Line 3 stores the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>array into an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>array
      variable, which is legal because arrays are covariant. Line 4 stores the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>into the sole element of the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>array, which succeeds because
      generics are implemented by erasure: the runtime type of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code>instance
      is simply<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,
      and the runtime type of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;[]</code><span
        class="Apple-converted-space">&nbsp;</span>instance is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List[]</code>, so this
      assignment doesn’t generate an<code style="font-family: 'Courier New', monospace;">ArrayStoreException</code>.
      Now we’re in trouble. We’ve stored a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>instance into an array that
      is declared to hold only<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>instances.
      In line 5, we retrieve the sole element from the sole list in this array.
      The compiler automatically casts the retrieved element to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>, but it’s
      an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code>,
      so we get a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime. In order to
      prevent this from happening, line 1 (which creates a generic array) must
      generate a compile-time error.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Types
      such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>are technically known as<span
        class="Apple-converted-space">&nbsp;</span><em>nonreifiable</em><span class="Apple-converted-space">&nbsp;</span>types
      [JLS, 4.7]. Intuitively speaking, a non-reifiable type is one whose
      runtime representation contains less information than its compile-time
      representation. Because of erasure, the only parameterized types that are
      reifiable are unbounded wildcard types such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map&lt;?,?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev26" style="text-decoration: none;">Item
        26</a>). It is legal, though rarely useful, to create arrays of
      unbounded wildcard types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      prohibition on generic array creation can be annoying. It means, for
      example, that it’s not generally possible for a generic collection to
      return an array of its element type (but see<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev33" style="text-decoration: none;">Item 33</a><span class="Apple-converted-space">&nbsp;</span>for
      a partial solution). It also means that you get confusing warnings when
      using varargs methods (<a href="ch8.xhtml#lev53" style="text-decoration: none;">Item
        53</a>) in combination with generic types. This is because every time
      you invoke a varargs method, an array is created to hold the varargs
      parameters. If the element type of this array is not reifiable, you get a
      warning. The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>annotation can be used to
      address this issue (<a href="ch5.xhtml#lev32" style="text-decoration: none;">Item
        32</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you get a generic array creation error or an unchecked cast warning on a
      cast to an array type, the best solution is often to use the collection
      type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>in preference to the array
      type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E[]</code>.
      You might sacrifice some conciseness or performance, but in exchange you
      get better type safety and interoperability.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_128"></span>For example, suppose you want
      to write a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Chooser</code><span
        class="Apple-converted-space">&nbsp;</span>class with a constructor that
      takes a collection, and a single method that returns an element of the
      collection chosen at random. Depending on what collection you pass to the
      constructor, you could use a chooser as a game die, a magic 8-ball, or a
      data source for a Monte Carlo simulation. Here’s a simplistic
      implementation without generics:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex22a" id="pch5ex22" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Chooser - a class badly in need of generics!</strong><br>
      public class Chooser {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Object[] choiceArray;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Chooser(Collection choices) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceArray =
      choices.toArray();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Object choose() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Random rnd =
      ThreadLocalRandom.current();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      choiceArray[rnd.nextInt(choiceArray.length)];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      use this class, you have to cast the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">choose</code><span class="Apple-converted-space">&nbsp;</span>method’s
      return value from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>to the desired type every
      time you use invoke the method, and the cast will fail at runtime if you
      get the type wrong. Taking the advice of<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev29" style="text-decoration: none;">Item 29</a><span class="Apple-converted-space">&nbsp;</span>to
      heart, we attempt to modify<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Chooser</code><span class="Apple-converted-space">&nbsp;</span>to
      make it generic. Changes are shown in boldface:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex23a" id="pch5ex23" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        A first cut at making Chooser generic - won't compile</strong><br>
      public class Chooser<strong>&lt;T&gt;</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final<span class="Apple-converted-space">&nbsp;</span><strong>T</strong>[]
      choiceArray;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Chooser(Collection<strong>&lt;T&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>choices) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceArray =
      choices.toArray();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// choose method unchanged<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you try to compile this class, you’ll get this error message:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex24a" id="pch5ex24" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Chooser.java:9:
      error: incompatible types: Object[] cannot be<br>
      converted to T[]<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceArray =
      choices.toArray();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;where T is a type-variable:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;T extends Object declared in class Chooser</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_129"></span>No big deal, you say, I’ll
      cast the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>array to a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>array:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex25a" id="pch5ex25" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="prec" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; text-align: center; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">choiceArray
      = (T[]) choices.toArray();</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      gets rid of the error, but instead you get a warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex26a" id="pch5ex26" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Chooser.java:9:
      warning: [unchecked] unchecked cast<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceArray = (T[])
      choices.toArray();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;required: T[], found: Object[]<br>
      &nbsp;&nbsp;where T is a type-variable:<br>
      T extends Object declared in class Chooser</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      compiler is telling you that it can’t vouch for the safety of the cast at
      runtime because the program won’t know what type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>represents—remember,
      element type information is erased from generics at runtime. Will the
      program work? Yes, but the compiler can’t prove it. You could prove it to
      yourself, put the proof in a comment and suppress the warning with an
      annotation, but you’re better off eliminating the cause of warning (<a href="ch5.xhtml#lev27"
        style="text-decoration: none;">Item 27</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      eliminate the unchecked cast warning, use a list instead of an array. Here
      is a version of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Chooser</code><span class="Apple-converted-space">&nbsp;</span>class
      that compiles without error or warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex27a" id="pch5ex27" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        List-based Chooser - typesafe</strong><br>
      public class Chooser&lt;T&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final<span class="Apple-converted-space">&nbsp;</span><strong>List&lt;T&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>choiceList;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Chooser(Collection&lt;T&gt; choices) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceList =<span class="Apple-converted-space">&nbsp;</span><strong>new
        ArrayList&lt;&gt;(choices)</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public T choose() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Random rnd =
      ThreadLocalRandom.current();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="Apple-converted-space">&nbsp;</span><strong>choiceList.get(rnd.nextInt(choiceList.size()))</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      version is a tad more verbose, and perhaps a tad slower, but it’s worth it
      for the peace of mind that you won’t get a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, arrays and generics have very different type rules. Arrays are
      covariant and reified; generics are invariant and erased. As a
      consequence, arrays provide runtime type safety but not compile-time type
      safety, and vice versa for generics. As a rule, arrays and generics don’t
      mix well. If you find yourself mixing them and getting compile-time errors
      or warnings, your first impulse should be to replace the arrays with
      lists.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev29" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_130"></span><strong>Item 29: Favor generic types</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is generally not too difficult to parameterize your declarations and make
      use of the generic types and methods provided by the JDK. Writing your own
      generic types is a bit more difficult, but it’s worth the effort to learn
      how.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Consider
      the simple (toy) stack implementation from<span class="Apple-converted-space">&nbsp;</span><a
        href="ch2.xhtml#lev7" style="text-decoration: none;">Item 7</a>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex28a" id="pch5ex28" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Object-based collection - a prime candidate for generics</strong><br>
      public class Stack {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private<span class="Apple-converted-space">&nbsp;</span><strong>Object</strong>[]
      elements;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int size = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int DEFAULT_INITIAL_CAPACITY
      = 16;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements = new<span class="Apple-converted-space">&nbsp;</span><strong>Object</strong>[DEFAULT_INITIAL_CAPACITY];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(<strong>Object</strong><span class="Apple-converted-space">&nbsp;</span>e)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensureCapacity();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size++] = e;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public<span class="Apple-converted-space">&nbsp;</span><strong>Object</strong><span
        class="Apple-converted-space">&nbsp;</span>pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Object</strong><span
        class="Apple-converted-space">&nbsp;</span>result = elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size] = null; //
      Eliminate obsolete reference<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean isEmpty() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return size == 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private void ensureCapacity() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (elements.length ==
      size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements
      = Arrays.copyOf(elements, 2 * size + 1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      class should have been parameterized to begin with, but since it wasn’t,
      we can<span class="Apple-converted-space">&nbsp;</span><em>generify</em><span
        class="Apple-converted-space">&nbsp;</span>it after the fact. In other
      words, we can parameterize it without harming clients of the original
      non-parameterized version. As it stands, the client has to cast objects
      that are popped off the stack, and those casts might fail at runtime. The
      first step in generifying a class is to add one or more type parameters to
      its<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_131"></span>declaration. In this case there is one type
      parameter, representing the element type of the stack, and the
      conventional name for this type parameter is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch9.xhtml#lev68" style="text-decoration: none;">Item 68</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      next step is to replace all the uses of the type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>with
      the appropriate type parameter and then try to compile the resulting
      program:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex29a" id="pch5ex29" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Initial attempt to generify Stack - won't compile!</strong><br>
      public class Stack<strong>&lt;E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private<span class="Apple-converted-space">&nbsp;</span><strong>E</strong>[]
      elements;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int size = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int DEFAULT_INITIAL_CAPACITY
      = 16;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements = new<span class="Apple-converted-space">&nbsp;</span><strong>E</strong>[DEFAULT_INITIAL_CAPACITY];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(<strong>E</strong><span class="Apple-converted-space">&nbsp;</span>e)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensureCapacity();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size++] = e;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public<span class="Apple-converted-space">&nbsp;</span><strong>E</strong><span
        class="Apple-converted-space">&nbsp;</span>pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>E</strong><span class="Apple-converted-space">&nbsp;</span>result
      = elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size] = null; //
      Eliminate obsolete reference<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // no changes in isEmpty or ensureCapacity<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You’ll
      generally get at least one error or warning, and this class is no
      exception. Luckily, this class generates only one error:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex30a" id="pch5ex30" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack.java:8:
      generic array creation<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements =<span class="Apple-converted-space">&nbsp;</span><strong>new
        E[DEFAULT_INITIAL_CAPACITY]</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      explained in<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a>, you can’t create an array of
      a non-reifiable type, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>. This problem
      arises every time you write a generic type that is backed by an array.
      There are two reasonable ways to solve it. The first solution directly
      circumvents the prohibition on generic array creation: create an array of<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>and cast<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_132"></span>it to the generic array type.
      Now in place of an error, the compiler will emit a warning. This usage is
      legal, but it’s not (in general) typesafe:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex31a" id="pch5ex31" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack.java:8:
      warning: [unchecked] unchecked cast<br>
      found: Object[], required: E[]<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements =<span class="Apple-converted-space">&nbsp;</span><strong>(E[])
        new Object[DEFAULT_INITIAL_CAPACITY]</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      compiler may not be able to prove that your program is typesafe, but you
      can. You must convince yourself that the unchecked cast will not
      compromise the type safety of the program. The array in question (<code style="font-family: 'Courier New', monospace;">elements</code>)
      is stored in a private field and never returned to the client or passed to
      any other method. The only elements stored in the array are those passed
      to the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">push</code><span
        class="Apple-converted-space">&nbsp;</span>method, which are of type<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code>,
      so the unchecked cast can do no harm.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Once
      you’ve proved that an unchecked cast is safe, suppress the warning in as
      narrow a scope as possible (<a href="ch5.xhtml#lev27" style="text-decoration: none;">Item
        27</a>). In this case, the constructor contains only the unchecked array
      creation, so it’s appropriate to suppress the warning in the entire
      constructor. With the addition of an annotation to do this,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>compiles
      cleanly, and you can use it without explicit casts or fear of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex32a" id="pch5ex32" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        The elements array will contain only E instances from push(E).</strong><br>
      <strong>// This is sufficient to ensure type safety, but the runtime</strong><br>
      <strong>// type of the array won't be E[]; it will always be Object[]!</strong><br>
      <strong>@SuppressWarnings("unchecked")</strong><br>
      public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;elements = (E[]) new
      Object[DEFAULT_INITIAL_CAPACITY];<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      second way to eliminate the generic array creation error in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>is
      to change the type of the field<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">elements</code><span class="Apple-converted-space">&nbsp;</span>from<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E[]</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object[]</code>. If you
      do this, you’ll get a different error:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex33a" id="pch5ex33" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack.java:19:
      incompatible types<br>
      found: Object, required: E<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>E result =
        elements[--size];</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can change this error into a warning by casting the element retrieved from
      the array to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code>,
      but you will get a warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex34a" id="pch5ex34" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack.java:19:
      warning: [unchecked] unchecked cast<br>
      found: Object, required: E<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E result =<span class="Apple-converted-space">&nbsp;</span><strong>(E)</strong><span
        class="Apple-converted-space">&nbsp;</span>elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_133"></span>Because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>is
      a non-reifiable type, there’s no way the compiler can check the cast at
      runtime. Again, you can easily prove to yourself that the unchecked cast
      is safe, so it’s appropriate to suppress the warning. In line with the
      advice of<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev27"
        style="text-decoration: none;">Item 27</a>, we suppress the warning only
      on the assignment that contains the unchecked cast, not on the entire<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pop</code><span
        class="Apple-converted-space">&nbsp;</span>method:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex35a" id="pch5ex35" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Appropriate suppression of unchecked warning</strong><br>
      public E pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      EmptyStackException();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// push requires elements to be of type E,
        so cast is correct</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>@SuppressWarnings("unchecked")</strong><span
        class="Apple-converted-space">&nbsp;</span>E result =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(E) elements[--size];<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;elements[size] = null; // Eliminate obsolete
      reference<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Both
      techniques for eliminating the generic array creation have their
      adherents. The first is more readable: the array is declared to be of type<code
        style="font-family: 'Courier New', monospace;">E[]</code>, clearly
      indicating that it contains only<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>instances.
      It is also more concise: in a typical generic class, you read from the
      array at many points in the code; the first technique requires only a
      single cast (where the array is created), while the second requires a
      separate cast each time an array element is read. Thus, the first
      technique is preferable and more commonly used in practice. It does,
      however, cause<span class="Apple-converted-space">&nbsp;</span><em>heap
        pollution</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev32"
        style="text-decoration: none;">Item 32</a>): the runtime type of the
      array does not match its compile-time type (unless<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>happens
      to be<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>).
      This makes some programmers sufficiently queasy that they opt for the
      second technique, though the heap pollution is harmless in this situation.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      following program demonstrates the use of our generic<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>class.
      The program prints its command line arguments in reverse order and
      converted to uppercase. No explicit cast is necessary to invoke<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toUpperCase</code><span class="Apple-converted-space">&nbsp;</span>method
      on the elements popped from the stack, and the automatically generated
      cast is guaranteed to succeed:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex36a" id="pch5ex36" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Little program to exercise our generic Stack</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Stack&lt;String&gt; stack = new Stack&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (String arg : args)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stack.push(arg);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;while (!stack.isEmpty())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<strong>stack.pop().toUpperCase()</strong>);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_134"></span>The foregoing example may
      appear to contradict<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a>, which encourages the use of
      lists in preference to arrays. It is not always possible or desirable to
      use lists inside your generic types. Java doesn’t support lists natively,
      so some generic types, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ArrayList</code>,<span class="Apple-converted-space">&nbsp;</span><em>must</em><span
        class="Apple-converted-space">&nbsp;</span>be implemented atop arrays.
      Other generic types, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashMap</code>, are
      implemented atop arrays for performance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      great majority of generic types are like our<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>example
      in that their type parameters have no restrictions: you can create a<code
        style="font-family: 'Courier New', monospace;">Stack&lt;Object&gt;</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack&lt;int[]&gt;</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack&lt;List&lt;String&gt;&gt;</code>,
      or<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>of any other object reference
      type. Note that you can’t create a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>of
      a primitive type: trying to create a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack&lt;int&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack&lt;double&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>will result in a compile-time
      error. This is a fundamental limitation of Java’s generic type system. You
      can work around this restriction by using boxed primitive types (<a href="ch9.xhtml#lev61"
        style="text-decoration: none;">Item 61</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are some generic types that restrict the permissible values of their type
      parameters. For example, consider<code style="font-family: 'Courier New', monospace;">java.util.concurrent.DelayQueue</code>,
      whose declaration looks like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex37a" id="pch5ex37" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">class
      DelayQueue<strong>&lt;E extends Delayed&gt;</strong><span class="Apple-converted-space">&nbsp;</span>implements
      BlockingQueue&lt;E&gt;</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      type parameter list (<code style="font-family: 'Courier New', monospace;">&lt;E
        extends Delayed&gt;</code>) requires that the actual type parameter<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>be a subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.concurrent.Delayed</code>.
      This allows the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">DelayQueue</code><span
        class="Apple-converted-space">&nbsp;</span>implementation and its
      clients to take advantage of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Delayed</code><span class="Apple-converted-space">&nbsp;</span>methods
      on the elements of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">DelayQueue</code>,
      without the need for explicit casting or the risk of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>.
      The type parameter<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>is known as a<span class="Apple-converted-space">&nbsp;</span><em>bounded
        type parameter</em>. Note that the subtype relation is defined so that
      every type is a subtype of itself [JLS, 4.10], so it is legal to create a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">DelayQueue&lt;Delayed&gt;</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, generic types are safer and easier to use than types that require
      casts in client code. When you design new types, make sure that they can
      be used without such casts. This will often mean making the types generic.
      If you have any existing types that should be generic but aren’t, generify
      them. This will make life easier for new users of these types without
      breaking existing clients (<a href="ch5.xhtml#lev26" style="text-decoration: none;">Item
        26</a>).</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev30" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_135"></span><strong>Item 30: Favor generic methods</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Just
      as classes can be generic, so can methods. Static utility methods that
      operate on parameterized types are usually generic. All of the “algorithm”
      methods in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collections</code><span
        class="Apple-converted-space">&nbsp;</span>(such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">binarySearch</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">sort</code>) are generic.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Writing
      generic methods is similar to writing generic types. Consider this
      deficient method, which returns the union of two sets:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex38a" id="pch5ex38" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Uses raw types - unacceptable! (<a href="ch5.xhtml#lev26" style="text-decoration: none;">Item
          26</a>)</strong><br>
      public static Set union(Set s1, Set s2) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set result = new HashSet(s1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;result.addAll(s2);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method compiles but with two warnings:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex39a" id="pch5ex39" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Union.java:5:
      warning: [unchecked] unchecked call to<br>
      HashSet(Collection&lt;? extends E&gt;) as a member of raw type HashSet<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set result = new
      HashSet(s1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      Union.java:6: warning: [unchecked] unchecked call to<br>
      addAll(Collection&lt;? extends E&gt;) as a member of raw type Set<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.addAll(s2);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      fix these warnings and make the method typesafe, modify its declaration to
      declare a<span class="Apple-converted-space">&nbsp;</span><em>type
        parameter</em><span class="Apple-converted-space">&nbsp;</span>representing
      the element type for the three sets (the two arguments and the return
      value) and use this type parameter throughout the method.<span class="Apple-converted-space">&nbsp;</span><strong>The
        type parameter list, which declares the type parameters, goes between a
        method’s modifiers and its return type.</strong><span class="Apple-converted-space">&nbsp;</span>In
      this example, the type parameter list is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">&lt;E&gt;</code>, and the
      return type is<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set&lt;E&gt;</code>.
      The naming conventions for type parameters are the same for generic
      methods and generic types (<a href="ch5.xhtml#lev29" style="text-decoration: none;">Items
        29</a>,<span class="Apple-converted-space">&nbsp;</span><a href="ch9.xhtml#lev68"
        style="text-decoration: none;">68</a>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex40a" id="pch5ex40" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Generic method</strong><br>
      public static<span class="Apple-converted-space">&nbsp;</span><strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>Set<strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>union(Set<strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>s1, Set<strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>s2) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set<strong>&lt;E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>result
      = new HashSet<strong>&lt;&gt;</strong>(s1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;result.addAll(s2);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">At
      least for simple generic methods, that’s all there is to it. This method
      compiles without generating any warnings and provides type safety as well
      as ease of<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_136"></span>use. Here’s a simple program to exercise the
      method. This program contains no casts and compiles without errors or
      warnings:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex41a" id="pch5ex41" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Simple program to exercise generic method</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt; guys = Set.of("Tom", "Dick",
      "Harry");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt; stooges = Set.of("Larry", "Moe",
      "Curly");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt; aflCio = union(guys, stooges);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;System.out.println(aflCio);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you run the program, it prints<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">[Moe, Tom, Harry, Larry,
        Curly, Dick]</code>. (The order of the elements in the output is
      implementation-dependent.)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      limitation of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">union</code><span
        class="Apple-converted-space">&nbsp;</span>method is that the types of
      all three sets (both input parameters and the return value) have to be
      exactly the same. You can make the method more flexible by using<span class="Apple-converted-space">&nbsp;</span><em>bounded
        wildcard types</em><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch5.xhtml#lev31" style="text-decoration: none;">Item 31</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">On
      occasion, you will need to create an object that is immutable but
      applicable to many different types. Because generics are implemented by
      erasure (<a href="ch5.xhtml#lev28" style="text-decoration: none;">Item 28</a>),
      you can use a single object for all required type parameterizations, but
      you need to write a static factory method to repeatedly dole out the
      object for each requested type parameterization. This pattern, called the<span
        class="Apple-converted-space">&nbsp;</span><em>generic singleton factory</em>,
      is used for function objects (<a href="ch7.xhtml#lev42" style="text-decoration: none;">Item
        42</a>) such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collections.reverseOrder</code>,
      and occasionally for collections such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collections.emptySet</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      that you want to write an identity function dispenser. The libraries
      provide<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Function.identity</code>,
      so there’s no reason to write your own (<a href="ch9.xhtml#lev59" style="text-decoration: none;">Item
        59</a>), but it is instructive. It would be wasteful to create a new
      identity function object time one is requested, because it’s stateless. If
      Java’s generics were reified, you would need one identity function per
      type, but since they’re erased a generic singleton will suffice. Here’s
      how it looks:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex42a" id="pch5ex42" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Generic singleton factory pattern</strong><br>
      private static UnaryOperator&lt;Object&gt; IDENTITY_FN = (t) -&gt; t;<br>
      <br>
      <strong>@SuppressWarnings("unchecked")</strong><br>
      public static &lt;T&gt; UnaryOperator&lt;T&gt; identityFunction() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return<span class="Apple-converted-space">&nbsp;</span><strong>(UnaryOperator&lt;T&gt;)</strong><span
        class="Apple-converted-space">&nbsp;</span>IDENTITY_FN;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      cast of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">IDENTITY_FN</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">(UnaryFunction&lt;T&gt;)</code><span
        class="Apple-converted-space">&nbsp;</span>generates an unchecked cast
      warning, as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">UnaryOperator&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is not a<code style="font-family: 'Courier New', monospace;">UnaryOperator&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>for every<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>. But the
      identity function is special: it returns its argument unmodified, so we
      know that it is typesafe to use it as a<code style="font-family: 'Courier New', monospace;">UnaryFunction&lt;T&gt;</code>,
      whatever the value of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>.<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_137"></span>Therefore, we can confidently
      suppress the unchecked cast warning generated by this cast. Once we’ve
      done this, the code compiles without error or warning.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a sample program that uses our generic singleton as a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">UnaryOperator&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">UnaryOperator&lt;Number&gt;</code>.
      As usual, it contains no casts and compiles without errors or warnings:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex43a" id="pch5ex43" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Sample program to exercise generic singleton</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;String[] strings = { "jute", "hemp", "nylon" };<br>
      &nbsp;&nbsp;&nbsp;&nbsp;UnaryOperator&lt;String&gt; sameString =
      identityFunction();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (String s : strings)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(sameString.apply(s));<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;Number[] numbers = { 1, 2.0, 3L };<br>
      &nbsp;&nbsp;&nbsp;&nbsp;UnaryOperator&lt;Number&gt; sameNumber =
      identityFunction();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (Number n : numbers)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(sameNumber.apply(n));<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is permissible, though relatively rare, for a type parameter to be bounded
      by some expression involving that type parameter itself. This is what’s
      known as a<span class="Apple-converted-space">&nbsp;</span><em>recursive
        type bound</em>. A common use of recursive type bounds is in connection
      with the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">&nbsp;</span>interface, which defines a
      type’s natural ordering (<a href="ch3.xhtml#lev14" style="text-decoration: none;">Item
        14</a>). This interface is shown here:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex44a" id="pch5ex44" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      interface Comparable&lt;T&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int compareTo(T o);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      type parameter<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code><span
        class="Apple-converted-space">&nbsp;</span>defines the type to which
      elements of the type implementing<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>can be compared. In practice,
      nearly all types can be compared only to elements of their own type. So,
      for example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>implements<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable&lt;String&gt;</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code><span
        class="Apple-converted-space">&nbsp;</span>implements<code style="font-family: 'Courier New', monospace;">Comparable&lt;Integer&gt;</code>,
      and so on.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      methods take a collection of elements implementing<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">&nbsp;</span>to
      sort it, search within it, calculate its minimum or maximum, and the like.
      To do these things, it is required that every element in the collection be
      comparable to every other element in it, in other words, that the elements
      of the list be<span class="Apple-converted-space">&nbsp;</span><em>mutually
        comparable</em>. Here is how to express that constraint:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex45a" id="pch5ex45" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Using a recursive type bound to express mutual comparability</strong><br>
      public static<span class="Apple-converted-space">&nbsp;</span><strong>&lt;E
        extends Comparable&lt;E&gt;&gt;</strong><span class="Apple-converted-space">&nbsp;</span>E
      max(Collection&lt;E&gt; c);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_138"></span>The type bound<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">&lt;E extends
        Comparable&lt;E&gt;&gt;</code><span class="Apple-converted-space">&nbsp;</span>may
      be read as “any type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>that
      can be compared to itself,” which corresponds more or less precisely to
      the notion of mutual comparability.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a method to go with the previous declaration. It calculates the maximum
      value in a collection according to its elements’ natural order, and it
      compiles without errors or warnings:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex46a" id="pch5ex46" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Returns max value in a collection - uses recursive type bound</strong><br>
      public static &lt;E extends Comparable&lt;E&gt;&gt; E
      max(Collection&lt;E&gt; c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (c.isEmpty())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      IllegalArgumentException("Empty collection");<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;E result = null;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (E e : c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (result == null ||
      e.compareTo(result) &gt; 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result
      = Objects.requireNonNull(e);<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that this method throws<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">IllegalArgumentException</code><span
        class="Apple-converted-space">&nbsp;</span>if the list is empty. A
      better alternative would be to return an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Optional&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch8.xhtml#lev55" style="text-decoration: none;">Item
        55</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Recursive
      type bounds can get much more complex, but luckily they rarely do. If you
      understand this idiom, its wildcard variant (<a href="ch5.xhtml#lev31" style="text-decoration: none;">Item
        31</a>), and the<span class="Apple-converted-space">&nbsp;</span><em>simulated
        self-type</em><span class="Apple-converted-space">&nbsp;</span>idiom (<a
        href="ch2.xhtml#lev2" style="text-decoration: none;">Item 2</a>), you’ll
      be able to deal with most of the recursive type bounds you encounter in
      practice.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, generic methods, like generic types, are safer and easier to use
      than methods requiring their clients to put explicit casts on input
      parameters and return values. Like types, you should make sure that your
      methods can be used without casts, which often means making them generic.
      And like types, you should generify existing methods whose use requires
      casts. This makes life easier for new users without breaking existing
      clients (<a href="ch5.xhtml#lev26" style="text-decoration: none;">Item 26</a>).</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev31" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_139"></span><strong>Item 31: Use bounded wildcards to increase
        API flexibility</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      noted in<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a>, parameterized types are<span
        class="Apple-converted-space">&nbsp;</span><em>invariant</em>. In other
      words, for any two distinct types<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Type1</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Type2</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Type1&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is neither a subtype nor a
      supertype of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Type2&gt;</code>.
      Although it is counterintuitive that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is not a subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>,
      it really does make sense. You can put any object into a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>,
      but you can put only strings into a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>.
      Since a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>can’t do everything a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>can, it isn’t a subtype (by
      the Liskov substitution principal,<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev10" style="text-decoration: none;">Item 10</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Sometimes
      you need more flexibility than invariant typing can provide. Consider the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>class from<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev29" style="text-decoration: none;">Item 29</a>. To
      refresh your memory, here is its public API:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex47a" id="pch5ex47" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Stack&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(E e);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public E pop();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean isEmpty();<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      we want to add a method that takes a sequence of elements and pushes them
      all onto the stack. Here’s a first attempt:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex48a" id="pch5ex48" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        pushAll method without wildcard type - deficient!</strong><br>
      public void pushAll(Iterable&lt;E&gt; src) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (E e : src)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(e);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method compiles cleanly, but it isn’t entirely satisfactory. If the
      element type of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Iterable src</code><span
        class="Apple-converted-space">&nbsp;</span>exactly matches that of the
      stack, it works fine. But suppose you have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack&lt;Number&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and you invoke<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">push(intVal)</code>,
      where<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">intVal</code><span
        class="Apple-converted-space">&nbsp;</span>is of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code>. This
      works because<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code><span
        class="Apple-converted-space">&nbsp;</span>is a subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Number</code>. So
      logically, it seems that this should work, too:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex49a" id="pch5ex49" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack&lt;Number&gt;
      numberStack = new Stack&lt;&gt;();<br>
      Iterable&lt;Integer&gt; integers = ... ;<br>
      numberStack.pushAll(integers);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you try it, however, you’ll get this error message because parameterized
      types are invariant:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex50a" id="pch5ex50" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">StackTest.java:7:
      error: incompatible types: Iterable&lt;Integer&gt;<br>
      cannot be converted to Iterable&lt;Number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numberStack.pushAll(integers);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_140"></span>Luckily, there’s a way out.
      The language provides a special kind of parameterized type call a<span class="Apple-converted-space">&nbsp;</span><em>bounded
        wildcard type</em><span class="Apple-converted-space">&nbsp;</span>to
      deal with situations like this. The type of the input parameter to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pushAll</code><span class="Apple-converted-space">&nbsp;</span>should
      not be “<code style="font-family: 'Courier New', monospace;">Iterable</code><span
        class="Apple-converted-space">&nbsp;</span>of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>” but “<code style="font-family: 'Courier New', monospace;">Iterable</code><span
        class="Apple-converted-space">&nbsp;</span>of some subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>,” and there is a
      wildcard type that means precisely that:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Iterable&lt;? extends
        E&gt;</code>. (The use of the keyword<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">extends</code><span class="Apple-converted-space">&nbsp;</span>is
      slightly misleading: recall from<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev29" style="text-decoration: none;">Item 29</a><span class="Apple-converted-space">&nbsp;</span>that<em>subtype</em><span
        class="Apple-converted-space">&nbsp;</span>is defined so that every type
      is a subtype of itself, even though it does not extend itself.) Let’s
      modify<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pushAll</code><span
        class="Apple-converted-space">&nbsp;</span>to use this type:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex51a" id="pch5ex51" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Wildcard type for a parameter that serves as an E producer</strong><br>
      public void pushAll(<strong>Iterable&lt;? extends E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>src)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (E e : src)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(e);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">With
      this change, not only does<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>compile
      cleanly, but so does the client code that wouldn’t compile with the
      original<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pushAll</code><span
        class="Apple-converted-space">&nbsp;</span>declaration. Because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>and
      its client compile cleanly, you know that everything is typesafe.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      suppose you want to write a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code><span class="Apple-converted-space">&nbsp;</span>method
      to go with<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pushAll</code>.
      The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">popAll</code><span
        class="Apple-converted-space">&nbsp;</span>method pops each element off
      the stack and adds the elements to the given collection. Here’s how a
      first attempt at writing the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code><span class="Apple-converted-space">&nbsp;</span>method
      might look:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex52a" id="pch5ex52" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        popAll method without wildcard type - deficient!</strong><br>
      public void popAll(Collection&lt;E&gt; dst) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;while (!isEmpty())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst.add(pop());<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Again,
      this compiles cleanly and works fine if the element type of the
      destination collection exactly matches that of the stack. But again, it
      isn’t entirely satisfactory. Suppose you have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack&lt;Number&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and variable of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>. If you pop
      an element from the stack and store it in the variable, it compiles and
      runs without error. So shouldn’t you be able to do this, too?</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex53a" id="pch5ex53" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack&lt;Number&gt;
      numberStack = new Stack&lt;Number&gt;();<br>
      Collection&lt;Object&gt; objects = ... ;<br>
      numberStack.popAll(objects);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you try to compile this client code against the version of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code><span class="Apple-converted-space">&nbsp;</span>shown
      earlier, you’ll get an error very similar to the one that we got with our
      first version of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pushAll</code>:<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collection&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is not a subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection&lt;Number&gt;</code>.
      Once again, wildcard types provide a way out. The type of the input
      parameter to<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_141"></span><code style="font-family: 'Courier New', monospace;">popAll</code><span
        class="Apple-converted-space">&nbsp;</span>should not be “collection of<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code>”
      but “collection of some supertype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>” (where
      supertype is defined such that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>is
      a supertype of itself [JLS, 4.10]). Again, there is a wildcard type that
      means precisely that:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection&lt;? super
        E&gt;</code>. Let’s modify<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code><span class="Apple-converted-space">&nbsp;</span>to
      use it:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex54a" id="pch5ex54" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Wildcard type for parameter that serves as an E consumer</strong><br>
      public void popAll(<strong>Collection&lt;? super E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>dst)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;while (!isEmpty())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst.add(pop());<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">With
      this change, both<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>and the client code compile
      cleanly.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      lesson is clear.<span class="Apple-converted-space">&nbsp;</span><strong>For
        maximum flexibility, use wildcard types on input parameters that
        represent producers or consumers.</strong><span class="Apple-converted-space">&nbsp;</span>If
      an input parameter is both a producer and a consumer, then wildcard types
      will do you no good: you need an exact type match, which is what you get
      without any wildcards.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a mnemonic to help you remember which wildcard type to use:</p>
    <p class="center" style="margin-top: 7.5px; margin-bottom: 7.5px; text-align: center; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>PECS
        stands for producer-</strong><code style="font-family: 'Courier New', monospace;"><strong>extends</strong></code><strong>,
        consumer-</strong><code style="font-family: 'Courier New', monospace;"><strong>super</strong></code><strong>.</strong></p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      other words, if a parameterized type represents a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>producer,
      use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">&lt;?
        extends T&gt;</code>; if it represents a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>consumer,
      use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">&lt;?
        super T&gt;</code>. In our<code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>example,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pushAll</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">src</code><span class="Apple-converted-space">&nbsp;</span>parameter
      produces<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>instances for use by the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code>,
      so the appropriate type for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">src</code><span class="Apple-converted-space">&nbsp;</span>is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Iterable&lt;?
        extends E&gt;</code>;<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">dst</code><span class="Apple-converted-space">&nbsp;</span>parameter
      consumes<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>instances from the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code>, so the
      appropriate type for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">dst</code><span class="Apple-converted-space">&nbsp;</span>is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collection&lt;?
        super E&gt;</code>. The PECS mnemonic captures the fundamental principle
      that guides the use of wild-card types. Naftalin and Wadler call it the<span
        class="Apple-converted-space">&nbsp;</span><em>Get and Put Principle</em>[Naftalin07,
      2.4].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">With
      this mnemonic in mind, let’s take a look at some method and constructor
      declarations from previous items in this chapter. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Chooser</code>constructor
      in<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a><span class="Apple-converted-space">&nbsp;</span>has
      this declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex55a" id="pch5ex55" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      Chooser(Collection&lt;T&gt; choices)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      constructor uses the collection<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">choices</code><span class="Apple-converted-space">&nbsp;</span>only
      to<span class="Apple-converted-space">&nbsp;</span><strong>produce</strong><span
        class="Apple-converted-space">&nbsp;</span>values of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>(and
      stores them for later use), so its declaration should use a wildcard type
      that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>extends</strong><span
          class="Apple-converted-space">&nbsp;</span>T</code>. Here’s the
      resulting constructor declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex56a" id="pch5ex56" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Wildcard type for parameter that serves as an T producer</strong><br>
      public Chooser(Collection&lt;<strong>? extends T</strong>&gt; choices)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">And
      would this change make any difference in practice? Yes, it would. Suppose
      you have a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code>,
      and you want to pass it in to the constructor<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_142"></span>for a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Chooser&lt;Number&gt;</code>.
      This would not compile with the original declaration, but it does once you
      add the bounded wildcard type to the declaration.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      let’s look at the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">union</code><span
        class="Apple-converted-space">&nbsp;</span>method from<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev30" style="text-decoration: none;">Item 30</a>. Here
      is the declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex57a" id="pch5ex57" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static &lt;E&gt; Set&lt;E&gt; union(Set&lt;E&gt; s1, Set&lt;E&gt; s2)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Both
      parameters,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">s1</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">s2</code>, are<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>producers,
      so the PECS mnemonic tells us that the declaration should be as follows:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex58a" id="pch5ex58" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static &lt;E&gt; Set&lt;E&gt; union(Set&lt;? extends E&gt; s1,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;?
      extends E&gt; s2)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that the return type is still<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;E&gt;</code>.<span
        class="Apple-converted-space">&nbsp;</span><strong>Do not use bounded
        wildcard types as return types.</strong><span class="Apple-converted-space">&nbsp;</span>Rather
      than providing additional flexibility for your users, it would force them
      to use wildcard types in client code. With the revised declaration, this
      code will compile cleanly:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex59a" id="pch5ex59" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Integer&gt;&nbsp;&nbsp;integers
      =&nbsp;&nbsp;Set.of(1, 3, 5);<br>
      Set&lt;Double&gt;&nbsp;&nbsp; doubles&nbsp;&nbsp;=&nbsp;&nbsp;Set.of(2.0,
      4.0, 6.0);<br>
      Set&lt;Number&gt;&nbsp;&nbsp;
      numbers&nbsp;&nbsp;=&nbsp;&nbsp;union(integers, doubles);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Properly
      used, wildcard types are nearly invisible to the users of a class. They
      cause methods to accept the parameters they should accept and reject those
      they should reject.<span class="Apple-converted-space">&nbsp;</span><strong>If
        the user of a class has to think about wildcard types, there is probably
        something wrong with its API.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Prior
      to Java 8, the type inference rules were not clever enough to handle the
      previous code fragment, which requires the compiler to use the
      contextually specified return type (or<span class="Apple-converted-space">&nbsp;</span><em>target
        type</em>) to infer the type of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>. The target type
      of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">union</code><span
        class="Apple-converted-space">&nbsp;</span>invocation shown earlier is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set&lt;Number&gt;</code>.
      If you try to compile the fragment in an earlier version of Java (with an
      appropriate replacement for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set.of</code><span class="Apple-converted-space">&nbsp;</span>factory),
      you’ll get a long, convoluted error message like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex60a" id="pch5ex60" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Union.java:14:
      error: incompatible types<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;Number&gt; numbers
      = union(integers, doubles);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;required: Set&lt;Number&gt;<br>
      &nbsp;&nbsp;found:&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;INT#1&gt;<br>
      &nbsp;&nbsp;where INT#1,INT#2 are intersection types:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;INT#1 extends Number,Comparable&lt;? extends
      INT#2&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;INT#2 extends Number,Comparable&lt;?&gt;</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Luckily
      there is a way to deal with this sort of error. If the compiler doesn’t
      infer the correct type, you can always tell it what type to use with an<em>explicit
        type<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
          id="page_143"></span>argument</em><span class="Apple-converted-space">&nbsp;</span>[JLS,
      15.12]. Even prior to the introduction of target typing in Java 8, this
      isn’t something that you had to do often, which is good because explicit
      type arguments aren’t very pretty. With the addition of an explicit type
      argument, as shown here, the code fragment compiles cleanly in versions
      prior to Java 8:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex61a" id="pch5ex61" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Explicit type parameter - required prior to Java 8</strong><br>
      Set&lt;Number&gt; numbers = Union<strong>.&lt;Number&gt;</strong>union(integers,
      doubles);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Next
      let’s turn our attention to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">max</code><span class="Apple-converted-space">&nbsp;</span>method
      in<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Item 30</a>. Here is the original
      declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex62a" id="pch5ex62" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static &lt;T extends Comparable&lt;T&gt;&gt; T max(List&lt;T&gt; list)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a revised declaration that uses wildcard types:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex63a" id="pch5ex63" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static &lt;T extends<span class="Apple-converted-space">&nbsp;</span><strong>Comparable&lt;?
        super T&gt;</strong>&gt; T max(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>List&lt;? extends
        T&gt;</strong><span class="Apple-converted-space">&nbsp;</span>list)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      get the revised declaration from the original, we applied the PECS
      heuristic twice. The straightforward application is to the parameter<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">list</code>.
      It produces<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code><span
        class="Apple-converted-space">&nbsp;</span>instances, so we change the
      type from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;? extends T&gt;</code>.
      The tricky application is to the type parameter<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>. This is the
      first time we’ve seen a wildcard applied to a type parameter. Originally,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code><span
        class="Apple-converted-space">&nbsp;</span>was specified to extend<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable&lt;T&gt;</code>,
      but a comparable of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>consumes<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>instances
      (and produces integers indicating order relations). Therefore, the
      parameterized type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is replaced by the bounded
      wildcard type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable&lt;?
        super T&gt;</code>. Comparables are always consumers, so you should
      generally<span class="Apple-converted-space">&nbsp;</span><strong>use</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>Comparable&lt;?
          super T&gt;</strong></code><span class="Apple-converted-space">&nbsp;</span><strong>in
        preference to</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>Comparable&lt;T&gt;</strong></code><strong>.</strong><span
        class="Apple-converted-space">&nbsp;</span>The same is true of
      comparators; therefore, you should generally<span class="Apple-converted-space">&nbsp;</span><strong>use</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>Comparator&lt;?
          super T&gt;</strong></code><span class="Apple-converted-space">&nbsp;</span><strong>in
        preference to</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>Comparator&lt;T&gt;</strong></code><strong>.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      revised<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">max</code><span
        class="Apple-converted-space">&nbsp;</span>declaration is probably the
      most complex method declaration in this book. Does the added complexity
      really buy you anything? Again, it does. Here is a simple example of a
      list that would be excluded by the original declaration but is permitted
      by the revised one:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex64a" id="pch5ex64" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">List&lt;ScheduledFuture&lt;?&gt;&gt;
      scheduledFutures = ... ;</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      reason that you can’t apply the original method declaration to this list
      is that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ScheduledFuture</code><span
        class="Apple-converted-space">&nbsp;</span>does not implement<code style="font-family: 'Courier New', monospace;">Comparable&lt;ScheduledFuture&gt;</code>.
      Instead, it is a subinterface of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Delayed</code>, which
      extends<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable&lt;Delayed&gt;</code>.
      In other words, a<code style="font-family: 'Courier New', monospace;">ScheduledFuture</code><span
        class="Apple-converted-space">&nbsp;</span>instance isn’t merely
      comparable to other<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_144"></span><code style="font-family: 'Courier New', monospace;">ScheduledFuture</code><span
        class="Apple-converted-space">&nbsp;</span>instances; it is comparable
      to any<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Delayed</code><span
        class="Apple-converted-space">&nbsp;</span>instance, and that’s enough
      to cause the original declaration to reject it. More generally, the
      wildcard is required to support types that do not implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>(or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparator</code>)
      directly but extend a type that does.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is one more wildcard-related topic that bears discussing. There is a
      duality between type parameters and wildcards, and many methods can be
      declared using one or the other. For example, here are two possible
      declarations for a static method to swap two indexed items in a list. The
      first uses an unbounded type parameter (<a href="ch5.xhtml#lev30" style="text-decoration: none;">Item
        30</a>) and the second an unbounded wildcard:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex65a" id="pch5ex65" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Two possible declarations for the swap method</strong><br>
      public static<span class="Apple-converted-space">&nbsp;</span><strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>void swap(<strong>List&lt;E&gt;
        list</strong>, int i, int j);<br>
      public static void swap(<strong>List&lt;?&gt; list</strong>, int i, int
      j);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Which
      of these two declarations is preferable, and why? In a public API, the
      second is better because it’s simpler. You pass in a list—any list—and the
      method swaps the indexed elements. There is no type parameter to worry
      about. As a rule,<span class="Apple-converted-space">&nbsp;</span><strong>if
        a type parameter appears only once in a method declaration, replace it
        with a wildcard.</strong><span class="Apple-converted-space">&nbsp;</span>If
      it’s an unbounded type parameter, replace it with an unbounded wildcard;
      if it’s a bounded type parameter, replace it with a bounded wildcard.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There’s
      one problem with the second declaration for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">swap</code>. The
      straightforward implementation won’t compile:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex66a" id="pch5ex66" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static void swap(List&lt;?&gt; list, int i, int j) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;list.set(i, list.set(j, list.get(i)));<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Trying
      to compile it produces this less-than-helpful error message:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex67a" id="pch5ex67" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Swap.java:5:
      error: incompatible types: Object cannot be<br>
      converted to CAP#1<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.set(i, list.set(j,
      list.get(i)));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^<br>
      &nbsp;&nbsp;where CAP#1 is a fresh type-variable:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;CAP#1 extends Object from capture of ?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      doesn’t seem right that we can’t put an element back into the list that we
      just took it out of. The problem is that the type of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">list</code><span class="Apple-converted-space">&nbsp;</span>is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;?&gt;</code>,
      and you can’t put any value except<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code><span class="Apple-converted-space">&nbsp;</span>into
      a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;?&gt;</code>.
      Fortunately, there is a way to implement this method without resorting to
      an unsafe cast or a raw type. The idea is to write a<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_145"></span>private helper method to<span
        class="Apple-converted-space">&nbsp;</span><em>capture</em><span class="Apple-converted-space">&nbsp;</span>the
      wildcard type. The helper method must be a generic method in order to
      capture the type. Here’s how it looks:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex68a" id="pch5ex68" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static void swap(List&lt;?&gt; list, int i, int j) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;swapHelper(list, i, j);<br>
      }<br>
      <br>
      <strong>// Private helper method for wildcard capture</strong><br>
      private static &lt;E&gt; void swapHelper(List&lt;E&gt; list, int i, int j)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;list.set(i, list.set(j, list.get(i)));<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">swapHelper</code><span
        class="Apple-converted-space">&nbsp;</span>method knows that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">list</code><span class="Apple-converted-space">&nbsp;</span>is
      a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code>.
      Therefore, it knows that any value it gets out of this list is of type<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>and that it’s safe to put any
      value of type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>into the list. This slightly
      convoluted implementation of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">swap</code><span class="Apple-converted-space">&nbsp;</span>compiles
      cleanly. It allows us to export the nice wildcard-based declaration, while
      taking advantage of the more complex generic method internally. Clients of
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">swap</code><span
        class="Apple-converted-space">&nbsp;</span>method don’t have to confront
      the more complex<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">swapHelper</code><span
        class="Apple-converted-space">&nbsp;</span>declaration, but they do
      benefit from it. It is worth noting that the helper method has precisely
      the signature that we dismissed as too complex for the public method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, using wildcard types in your APIs, while tricky, makes the APIs
      far more flexible. If you write a library that will be widely used, the
      proper use of wildcard types should be considered mandatory. Remember the
      basic rule: producer-<code style="font-family: 'Courier New', monospace;">extends</code>,
      consumer-<code style="font-family: 'Courier New', monospace;">super</code><span
        class="Apple-converted-space">&nbsp;</span>(PECS). Also remember that
      all comparables and comparators are consumers.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev32" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_146"></span><strong>Item 32: Combine generics and varargs
        judiciously</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Varargs
      methods (<a href="ch8.xhtml#lev53" style="text-decoration: none;">Item 53</a>)
      and generics were both added to the platform in Java 5, so you might
      expect them to interact gracefully; sadly, they do not. The purpose of
      varargs is to allow clients to pass a variable number of arguments to a
      method, but it is a<span class="Apple-converted-space">&nbsp;</span><em>leaky
        abstraction</em>: when you invoke a varargs method, an array is created
      to hold the varargs parameters; that array, which should be an
      implementation detail, is visible. As a consequence, you get confusing
      compiler warnings when varargs parameters have generic or parameterized
      types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Recall
      from<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a><span class="Apple-converted-space">&nbsp;</span>that
      a non-reifiable type is one whose runtime representation has less
      information than its compile-time representation, and that nearly all
      generic and parameterized types are non-reifiable. If a method declares
      its varargs parameter to be of a non-reifiable type, the compiler
      generates a warning on the declaration. If the method is invoked on
      varargs parameters whose inferred type is non-reifiable, the compiler
      generates a warning on the invocation too. The warnings look something
      like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex69a" id="pch5ex69" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">warning:
      [unchecked] Possible heap pollution from<br>
      &nbsp;&nbsp;&nbsp;&nbsp;parameterized vararg type List&lt;String&gt;</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>Heap
        pollution</em><span class="Apple-converted-space">&nbsp;</span>occurs
      when a variable of a parameterized type refers to an object that is not of
      that type [JLS, 4.12.2]. It can cause the compiler’s automatically
      generated casts to fail, violating the fundamental guarantee of the
      generic type system.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      example, consider this method, which is a thinly disguised variant of the
      code fragment on page 127:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex70a" id="pch5ex70" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Mixing generics and varargs can violate type safety!</strong><br>
      static void dangerous(<strong>List&lt;String&gt;... stringLists</strong>)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;List&lt;Integer&gt; intList = List.of(42);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Object[] objects = stringLists;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;objects[0] =
intList;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>//
        Heap pollution</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;String s = stringLists[0].get(0);<span class="Apple-converted-space">&nbsp;</span><strong>//
        ClassCastException</strong><br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method has no visible casts yet throws a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>when invoked with one or more
      arguments. Its last line has an invisible cast that is generated by the
      compiler. This cast fails, demonstrating that type safety has been
      compromised, and<span class="Apple-converted-space">&nbsp;</span><strong>it
        is unsafe to store a value in a generic varargs array parameter.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      example raises an interesting question: Why is it even legal to declare a
      method with a generic varargs parameter, when it is illegal to create a
      generic array explicitly? In other words, why does the method shown
      previously generate only a warning, while the code fragment on page 127
      generates an error? The<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_147"></span>answer is that methods with
      varargs parameters of generic or parameterized types can be very useful in
      practice, so the language designers opted to live with this inconsistency.
      In fact, the Java libraries export several such methods, including<code style="font-family: 'Courier New', monospace;">Arrays.asList(T...
        a)</code>,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collections.addAll(Collection&lt;?
        super T&gt; c, T... elements)</code>, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">EnumSet.of(E first, E...
        rest)</code>. Unlike the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">dangerous</code><span class="Apple-converted-space">&nbsp;</span>method
      shown earlier, these library methods are typesafe.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Prior
      to Java 7, there was nothing the author of a method with a generic varargs
      parameter could do about the warnings at the call sites. This made these
      APIs unpleasant to use. Users had to put up with the warnings or,
      preferably, to eliminate them with<code style="font-family: 'Courier New', monospace;">@SuppressWarnings("unchecked")</code><span
        class="Apple-converted-space">&nbsp;</span>annotations at every call
      site (<a href="ch5.xhtml#lev27" style="text-decoration: none;">Item 27</a>).
      This was tedious, harmed readability, and hid warnings that flagged real
      issues.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      Java 7, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>annotation was added to the
      platform, to allow the author of a method with a generic varargs parameter
      to suppress client warnings automatically. In essence,<span class="Apple-converted-space">&nbsp;</span><strong>the</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>SafeVarargs</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>annotation
        constitutes a promise by the author of a method that it is typesafe.</strong><span
        class="Apple-converted-space">&nbsp;</span>In exchange for this promise,
      the compiler agrees not to warn the users of the method that calls may be
      unsafe.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is critical that you do not annotate a method with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">@SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>unless it actually<span class="Apple-converted-space">&nbsp;</span><em>is</em><span
        class="Apple-converted-space">&nbsp;</span>safe. So what does it take to
      ensure this? Recall that a generic array is created when the method is
      invoked, to hold the varargs parameters. If the method doesn’t store
      anything into the array (which would overwrite the parameters) and doesn’t
      allow a reference to the array to escape (which would enable untrusted
      code to access the array), then it’s safe. In other words, if the varargs
      parameter array is used only to transmit a variable number of arguments
      from the caller to the method—which is, after all, the purpose of
      varargs—then the method is safe.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is worth noting that you can violate type safety without ever storing
      anything in the varargs parameter array. Consider the following generic
      varargs method, which returns an array containing its parameters. At first
      glance, it may look like a handy little utility:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex71a" id="pch5ex71" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        UNSAFE - Exposes a reference to its generic parameter array!</strong><br>
      static &lt;T&gt; T[] toArray(T... args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return args;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method simply returns its varargs parameter array. The method may not look
      dangerous, but it is! The type of this array is determined by the
      compile-time types of the arguments passed in to the method, and the
      compiler may not have enough information to make an accurate
      determination. Because this method returns its varargs parameter array, it
      can propagate heap pollution up the call stack.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_148"></span>To make this concrete,
      consider the following generic method, which takes three arguments of type<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code><span
        class="Apple-converted-space">&nbsp;</span>and returns an array
      containing two of the arguments, chosen at random:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex72a" id="pch5ex72" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">static
      &lt;T&gt; T[] pickTwo(T a, T b, T c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;switch(ThreadLocalRandom.current().nextInt(3)) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 0: return toArray(a, b);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 1: return toArray(a, c);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 2: return toArray(b, c);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;throw new AssertionError(); // Can't get here<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method is not, in and of itself, dangerous and would not generate a
      warning except that it invokes the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toArray</code><span class="Apple-converted-space">&nbsp;</span>method,
      which has a generic varargs parameter.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      compiling this method, the compiler generates code to create a varargs
      parameter array in which to pass two<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>instances
      to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toArray</code>.
      This code allocates an array of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object[]</code>, which is
      the most specific type that is guaranteed to hold these instances, no
      matter what types of objects are passed to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pickTwo</code><span class="Apple-converted-space">&nbsp;</span>at
      the call site. The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toArray</code><span
        class="Apple-converted-space">&nbsp;</span>method simply returns this
      array to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pickTwo</code>,
      which in turn returns it to its caller, so<code style="font-family: 'Courier New', monospace;">pickTwo</code><span
        class="Apple-converted-space">&nbsp;</span>will always return an array
      of type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object[]</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      consider this main method, which exercises<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pickTwo</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex73a" id="pch5ex73" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;String[] attributes = pickTwo("Good", "Fast",
      "Cheap");<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is nothing at all wrong with this method, so it compiles without
      generating any warnings. But when you run it, it throws a<code style="font-family: 'Courier New', monospace;">ClassCastException</code>,
      though it contains no visible casts. What you don’t see is that the
      compiler has generated a hidden cast to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String[]</code><span class="Apple-converted-space">&nbsp;</span>on
      the value returned by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pickTwo</code><span class="Apple-converted-space">&nbsp;</span>so
      that it can be stored in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">attributes</code>. The
      cast fails, because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object[]</code><span class="Apple-converted-space">&nbsp;</span>is
      not a subtype of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String[]</code>.
      This failure is quite disconcerting because it is two levels removed from
      the method that actually causes the heap pollution (<code style="font-family: 'Courier New', monospace;">toArray</code>),
      and the varargs parameter array is not modified after the actual
      parameters are stored in it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      example is meant to drive home the point that<span class="Apple-converted-space">&nbsp;</span><strong>it
        is unsafe to give another method access to a generic varargs parameter
        array,</strong>with two exceptions: it is safe to pass the array to
      another varargs method that is correctly annotated with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">@SafeVarargs</code>, and
      it is safe to pass the array to a non-varargs method that merely computes
      some function of the contents of the array.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_149"></span>Here is a typical example of
      a safe use of a generic varargs parameter. This method takes an arbitrary
      number of lists as arguments and returns a single list containing the
      elements of all of the input lists in sequence. Because the method is
      annotated with<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@SafeVarargs</code>,
      it doesn’t generate any warnings, on the declaration or at its call sites:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex74a" id="pch5ex74" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Safe method with a generic varargs parameter</strong><br>
      @SafeVarargs<br>
      static &lt;T&gt; List&lt;T&gt; flatten(List&lt;? extends T&gt;... lists) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;List&lt;T&gt; result = new ArrayList&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (List&lt;? extends T&gt; list : lists)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.addAll(list);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      rule for deciding when to use the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SafeVarargs</code><span class="Apple-converted-space">&nbsp;</span>annotation
      is simple:<span class="Apple-converted-space">&nbsp;</span><strong>Use</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>@SafeVarargs</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>on every method with
        a varargs parameter of a generic or parameterized type,</strong><span class="Apple-converted-space">&nbsp;</span>so
      its users won’t be burdened by needless and confusing compiler warnings.
      This implies that you should<em>never</em><span class="Apple-converted-space">&nbsp;</span>write
      unsafe varargs methods like<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">dangerous</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toArray</code>.
      Every time the compiler warns you of possible heap pollution from a
      generic varargs parameter in a method you control, check that the method
      is safe. As a reminder, a generic varargs methods is safe if:</p>
    <p class="number1" style="margin-top: 2.6666667px; margin-bottom: 2.6666667px; margin-left: 36px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1.
      it doesn’t store anything in the varargs parameter array, and</p>
    <p class="number1" style="margin-top: 2.6666667px; margin-bottom: 2.6666667px; margin-left: 36px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2.
      it doesn’t make the array (or a clone) visible to untrusted code. If
      either of these prohibitions is violated, fix it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>annotation is legal only on
      methods that can’t be overridden, because it is impossible to guarantee
      that every possible overriding method will be safe. In Java 8, the
      annotation was legal only on static methods and final instance methods; in
      Java 9, it became legal on private instance methods as well.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">An
      alternative to using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SafeVarargs</code><span class="Apple-converted-space">&nbsp;</span>annotation
      is to take the advice of<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev28" style="text-decoration: none;">Item 28</a><span class="Apple-converted-space">&nbsp;</span>and
      replace the varargs parameter (which is an array in disguise) with a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code><span
        class="Apple-converted-space">&nbsp;</span>parameter. Here’s how this
      approach looks when applied to our<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">flatten</code><span class="Apple-converted-space">&nbsp;</span>method.
      Note that only the parameter declaration has changed:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex75a" id="pch5ex75" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        List as a typesafe alternative to a generic varargs parameter</strong><br>
      static &lt;T&gt; List&lt;T&gt; flatten(<strong>List&lt;List&lt;? extends
        T&gt;&gt; lists</strong>) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;List&lt;T&gt; result = new ArrayList&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (List&lt;? extends T&gt; list : lists)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.addAll(list);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_150"></span>This method can then be used
      in conjunction with the static factory method<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List.of</code><span class="Apple-converted-space">&nbsp;</span>to
      allow for a variable number of arguments. Note that this approach relies
      on the fact that the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List.of</code><span class="Apple-converted-space">&nbsp;</span>declaration
      is annotated with<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@SafeVarargs</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex76a" id="pch5ex76" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">audience
      = flatten(List.of(friends, romans, countrymen));</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      advantage of this approach is that the compiler can<span class="Apple-converted-space">&nbsp;</span><em>prove</em><span
        class="Apple-converted-space">&nbsp;</span>that the method is typesafe.
      You don’t have to vouch for its safety with a<code style="font-family: 'Courier New', monospace;">SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>annotation, and you don’t
      have worry that you might have erred in determining that it was safe. The
      main disadvantage is that the client code is a bit more verbose and may be
      a bit slower.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      trick can also be used in situations where it is impossible to write a
      safe varargs method, as is the case with the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toArray</code><span class="Apple-converted-space">&nbsp;</span>method
      on page 147. Its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code><span
        class="Apple-converted-space">&nbsp;</span>analogue<span class="Apple-converted-space">&nbsp;</span><em>is</em><span
        class="Apple-converted-space">&nbsp;</span>the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List.of</code><span class="Apple-converted-space">&nbsp;</span>method,
      so we don’t even have to write it; the Java libraries authors have done
      the work for us. The<code style="font-family: 'Courier New', monospace;">pickTwo</code><span
        class="Apple-converted-space">&nbsp;</span>method then becomes this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex77a" id="pch5ex77" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">static
      &lt;T&gt;<span class="Apple-converted-space">&nbsp;</span><strong>List&lt;T&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>pickTwo(T a, T b, T c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;switch(rnd.nextInt(3)) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 0: return<span class="Apple-converted-space">&nbsp;</span><strong>List.of(a,
        b)</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 1: return<span class="Apple-converted-space">&nbsp;</span><strong>List.of(a,
        c)</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 2: return<span class="Apple-converted-space">&nbsp;</span><strong>List.of(b,
        c)</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;throw new AssertionError();<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">and
      the main method becomes this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex78a" id="pch5ex78" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>List&lt;String&gt;</strong><span class="Apple-converted-space">&nbsp;</span>attributes
      = pickTwo("Good", "Fast", "Cheap");<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      resulting code is typesafe because it uses only generics, and not arrays.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, varargs and generics do not interact well because the varargs
      facility is a leaky abstraction built atop arrays, and arrays have
      different type rules from generics. Though generic varargs parameters are
      not typesafe, they are legal. If you choose to write a method with a
      generic (or parameterized) varargs parameter, first ensure that the method
      is typesafe, and then annotate it with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">@SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>so it is not unpleasant to
      use.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev33" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_151"></span><strong>Item 33: Consider typesafe heterogeneous
        containers</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Common
      uses of generics include collections, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map&lt;K,V&gt;</code>,
      and single-element containers, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ThreadLocal&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and<code style="font-family: 'Courier New', monospace;">AtomicReference&lt;T&gt;</code>.
      In all of these uses, it is the container that is parameterized. This
      limits you to a fixed number of type parameters per container. Normally
      that is exactly what you want. A<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>has
      a single type parameter, representing its element type; a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>has
      two, representing its key and value types; and so forth.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Sometimes,
      however, you need more flexibility. For example, a database row can have
      arbitrarily many columns, and it would be nice to be able to access all of
      them in a typesafe manner. Luckily, there is an easy way to achieve this
      effect. The idea is to parameterize the<span class="Apple-converted-space">&nbsp;</span><em>key</em><span
        class="Apple-converted-space">&nbsp;</span>instead of the<em>container</em>.
      Then present the parameterized key to the container to insert or retrieve
      a value. The generic type system is used to guarantee that the type of the
      value agrees with its key.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      a simple example of this approach, consider a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>class
      that allows its clients to store and retrieve a favorite instance of
      arbitrarily many types. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      for the type will play the part of the parameterized key. The reason this
      works is that class<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>is
      generic. The type of a class literal is not simply<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code>, but<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class&lt;T&gt;</code>.
      For example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String.class</code><span
        class="Apple-converted-space">&nbsp;</span>is of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class&lt;String&gt;</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer.class</code><span
        class="Apple-converted-space">&nbsp;</span>is of type<code style="font-family: 'Courier New', monospace;">Class&lt;Integer&gt;</code>.
      When a class literal is passed among methods to communicate both
      compile-time and runtime type information, it is called a<em>type token</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rBracha04"
        style="text-decoration: none;">Bracha04</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      API for the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>class is simple. It looks
      just like a simple map, except that the key is parameterized instead of
      the map. The client presents a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      when setting and getting favorites. Here is the API:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex79a" id="pch5ex79" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typesafe heterogeneous container pattern - API</strong><br>
      public class Favorites {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; void putFavorite(Class&lt;T&gt;
      type, T instance);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; T getFavorite(Class&lt;T&gt;
      type);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a sample program that exercises the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>class,
      storing, retrieving, and printing a favorite<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class</code><span
        class="Apple-converted-space">&nbsp;</span>instance:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex80a" id="pch5ex80" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typesafe heterogeneous container pattern - client</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Favorites f = new Favorites();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;f.putFavorite(String.class, "Java");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;f.putFavorite(Integer.class, 0xcafebabe);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;f.putFavorite(Class.class, Favorites.class);<br>
      <span epub:type="pagebreak" id="page_152"></span>&nbsp;&nbsp;&nbsp;&nbsp;String
      favoriteString = f.getFavorite(String.class);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int favoriteInteger =
      f.getFavorite(Integer.class);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt; favoriteClass =
      f.getFavorite(Class.class);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;System.out.printf("%s %x %s%n", favoriteString,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;favoriteInteger,
      favoriteClass.getName());<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      you would expect, this program prints<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Java cafebabe Favorites</code>.
      Note, incidentally, that Java’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">printf</code><span class="Apple-converted-space">&nbsp;</span>method
      differs from C’s in that you should use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">%n</code><span class="Apple-converted-space">&nbsp;</span>where
      you’d use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">\n</code><span
        class="Apple-converted-space">&nbsp;</span>in C. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">%n</code><span class="Apple-converted-space">&nbsp;</span>generates
      the applicable platform-specific line separator, which is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">\n</code><span class="Apple-converted-space">&nbsp;</span>on
      many but not all platforms.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>instance is<span class="Apple-converted-space">&nbsp;</span><em>typesafe</em>:
      it will never return an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code><span class="Apple-converted-space">&nbsp;</span>when
      you ask it for a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code>.
      It is also<span class="Apple-converted-space">&nbsp;</span><em>heterogeneous</em>:
      unlike an ordinary map, all the keys are of different types. Therefore, we
      call<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>a<span class="Apple-converted-space">&nbsp;</span><em>typesafe
        heterogeneous container</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      implementation of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>is surprisingly tiny. Here it
      is, in its entirety:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex81a" id="pch5ex81" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typesafe heterogeneous container pattern - implementation</strong><br>
      public class Favorites {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private<span class="Apple-converted-space">&nbsp;</span><strong>Map&lt;Class&lt;?&gt;,
        Object&gt; favorites</strong><span class="Apple-converted-space">&nbsp;</span>=
      new HashMap&lt;&gt;();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; void putFavorite(Class&lt;T&gt;
      type, T instance) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;favorites.put(Objects.requireNonNull(type),
      instance);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; T getFavorite(Class&lt;T&gt;
      type) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="Apple-converted-space">&nbsp;</span><strong>type.cast(favorites.get(type))</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are a few subtle things going on here. Each<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>instance
      is backed by a private<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map&lt;Class&lt;?&gt;,
        Object&gt;</code><span class="Apple-converted-space">&nbsp;</span>called<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">favorites</code>.
      You might think that you couldn’t put anything into this<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>because
      of the unbounded wildcard type, but the truth is quite the opposite. The
      thing to notice is that the wildcard type is nested: it’s not the type of
      the map that’s a wildcard type but the type of its key. This means that
      every key can have a<span class="Apple-converted-space">&nbsp;</span><em>different</em><span
        class="Apple-converted-space">&nbsp;</span>parameterized type: one can
      be<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class&lt;String&gt;</code>,
      the next<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class&lt;Integer&gt;</code>,
      and so on. That’s where the heterogeneity comes from.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      next thing to notice is that the value type of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">favorites Map</code><span
        class="Apple-converted-space">&nbsp;</span>is simply<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>. In other
      words, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code><span
        class="Apple-converted-space">&nbsp;</span>does not guarantee the type
      relationship between keys and values, which is that every value is of the
      type represented by its key. In<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_153"></span>fact, Java’s type system is
      not powerful enough to express this. But we know that it’s true, and we
      take advantage of it when the time comes to retrieve a favorite.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">putFavorite</code><span
        class="Apple-converted-space">&nbsp;</span>implementation is trivial: it
      simply puts into<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">favorites</code><span
        class="Apple-converted-space">&nbsp;</span>a mapping from the given<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class</code><span
        class="Apple-converted-space">&nbsp;</span>object to the given favorite
      instance. As noted, this discards the “type linkage” between the key and
      the value; it loses the knowledge that the value is an instance of the
      key. But that’s OK, because the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getFavorites</code><span
        class="Apple-converted-space">&nbsp;</span>method can and does
      reestablish this linkage.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      implementation of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getFavorite</code><span
        class="Apple-converted-space">&nbsp;</span>is trickier than that of<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">putFavorite</code>.
      First, it gets from the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">favorites</code><span class="Apple-converted-space">&nbsp;</span>map
      the value corresponding to the given<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object.
      This is the correct object reference to return, but it has the wrong
      compile-time type: it is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>(the
      value type of the<code style="font-family: 'Courier New', monospace;">favorites</code><span
        class="Apple-converted-space">&nbsp;</span>map) and we need to return a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code>.
      So, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getFavorite</code><span
        class="Apple-converted-space">&nbsp;</span>implementation<span class="Apple-converted-space">&nbsp;</span><em>dynamically
        casts</em><span class="Apple-converted-space">&nbsp;</span>the object
      reference to the type represented by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object,
      using<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">cast</code><span
        class="Apple-converted-space">&nbsp;</span>method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">cast</code><span
        class="Apple-converted-space">&nbsp;</span>method is the dynamic
      analogue of Java’s cast operator. It simply checks that its argument is an
      instance of the type represented by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object.
      If so, it returns the argument; otherwise it throws a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>.
      We know that the cast invocation in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getFavorite</code>won’t
      throw<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code>,
      assuming the client code compiled cleanly. That is to say, we know that
      the values in the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">favorites</code><span
        class="Apple-converted-space">&nbsp;</span>map always match the types of
      their keys.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      what does the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">cast</code><span
        class="Apple-converted-space">&nbsp;</span>method do for us, given that
      it simply returns its argument? The signature of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">cast</code><span class="Apple-converted-space">&nbsp;</span>method
      takes full advantage of the fact that class<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>is
      generic. Its return type is the type parameter of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex82a" id="pch5ex82" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Class&lt;T&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;T cast(Object obj);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      is precisely what’s needed by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getFavorite</code><span class="Apple-converted-space">&nbsp;</span>method.
      It is what allows us to make<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>typesafe
      without resorting to an unchecked cast to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are two limitations to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>class
      that are worth noting. First, a malicious client could easily corrupt the
      type safety of a<code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>instance, by using a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      in its raw form. But the resulting client code would generate an unchecked
      warning when it was compiled. This is no different from a normal
      collection implementations such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashMap</code>.
      You can easily put a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>into
      a<code style="font-family: 'Courier New', monospace;">HashSet&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>by using the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch5.xhtml#lev26" style="text-decoration: none;">Item 26</a>). That
      said, you can have runtime type safety if you’re willing to pay for it.
      The way to ensure that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>never
      violates its type invariant is to have the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">putFavorite</code><span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_154"></span>method check that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instance</code><span class="Apple-converted-space">&nbsp;</span>is
      actually an instance of the type represented by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">type</code>, and we
      already know how to do this. Just use a dynamic cast:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex83a" id="pch5ex83" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Achieving runtime type safety with a dynamic cast</strong><br>
      public &lt;T&gt; void putFavorite(Class&lt;T&gt; type, T instance) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;favorites.put(type, type.cast(instance));<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are collection wrappers in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.Collections</code><span
        class="Apple-converted-space">&nbsp;</span>that play the same trick.
      They are called<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">checkedSet</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">checkedList</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">checkedMap</code>,
      and so forth. Their static factories take a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      (or two) in addition to a collection (or map). The static factories are
      generic methods, ensuring that the compile-time types of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      and the collection match. The wrappers add reification to the collections
      they wrap. For example, the wrapper throws a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime if someone tries
      to put a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Coin</code><span
        class="Apple-converted-space">&nbsp;</span>into your<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection&lt;Stamp&gt;</code>.
      These wrappers are useful for tracking down client code that adds an
      incorrectly typed element to a collection, in an application that mixes
      generic and raw types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      second limitation of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>class
      is that it cannot be used on a non-reifiable type (<a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a>). In other words, you can
      store your favorite<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String[]</code>,
      but not your favorite<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>.
      If you try to store your favorite<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>,
      your program won’t compile. The reason is that you can’t get a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>.
      The class literal<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>is a syntax error, and it’s a
      good thing, too.<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>share a single<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object,
      which is<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List.class</code>.
      It would wreak havoc with the internals of a<code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>object if the “type literals”<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>were legal and returned the
      same object reference. There is no entirely satisfactory workaround for
      this limitation.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      type tokens used by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>are
      unbounded:<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getFavorite</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">put-Favorite</code><span
        class="Apple-converted-space">&nbsp;</span>accept any<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object.
      Sometimes you may need to limit the types that can be passed to a method.
      This can be achieved with a<span class="Apple-converted-space">&nbsp;</span><em>bounded
        type token</em>, which is simply a type token that places a bound on
      what type can be represented, using a bounded type parameter (<a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Item 30</a>) or a bounded wildcard (<a href="ch5.xhtml#lev31"
        style="text-decoration: none;">Item 31</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      annotations API (<a href="ch6.xhtml#lev39" style="text-decoration: none;">Item
        39</a>) makes extensive use of bounded type tokens. For example, here is
      the method to read an annotation at runtime. This method comes from the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AnnotatedElement</code><span
        class="Apple-converted-space">&nbsp;</span>interface, which is
      implemented by the reflective types that represent classes, methods,
      fields, and other program elements:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex84a" id="pch5ex84" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      &lt;T extends Annotation&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;T getAnnotation(Class&lt;T&gt; annotationType);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_155"></span>The argument,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">annotationType</code>, is
      a bounded type token representing an annotation type. The method returns
      the element’s annotation of that type, if it has one, or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>, if it
      doesn’t. In essence, an annotated element is a typesafe heterogeneous
      container whose keys are annotation types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      you have an object of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and you want to pass it to a
      method that requires a bounded type token, such as<code style="font-family: 'Courier New', monospace;">getAnnotation</code>.
      You could cast the object to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class&lt;? extends
        Annotation&gt;</code>, but this cast is unchecked, so it would generate
      a compile-time warning (<a href="ch5.xhtml#lev27" style="text-decoration: none;">Item
        27</a>). Luckily, class<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>provides
      an instance method that performs this sort of cast safely (and
      dynamically). The method is called<code style="font-family: 'Courier New', monospace;">asSubclass</code>,
      and it casts the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class</code><span
        class="Apple-converted-space">&nbsp;</span>object on which it is called
      to represent a subclass of the class represented by its argument. If the
      cast succeeds, the method returns its argument; if it fails, it throws a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here’s
      how you use the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">asSubclass</code><span
        class="Apple-converted-space">&nbsp;</span>method to read an annotation
      whose type is unknown at compile time. This method compiles without error
      or warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex85a" id="pch5ex85" style="text-decoration: none;">Click
        here to view code image</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Use of asSubclass to safely cast to a bounded type token</strong><br>
      static Annotation getAnnotation(AnnotatedElement element,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String
      annotationTypeName) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>Class&lt;?&gt; annotationType</strong><span
        class="Apple-converted-space">&nbsp;</span>= null; // Unbounded type
      token<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotationType =
      Class.forName(annotationTypeName);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (Exception ex) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      IllegalArgumentException(ex);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return element.getAnnotation(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>annotationType.asSubclass(Annotation.class)</strong>);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, the normal use of generics, exemplified by the collections APIs,
      restricts you to a fixed number of type parameters per container. You can
      get around this restriction by placing the type parameter on the key
      rather than the container. You can use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>objects
      as keys for such typesafe heterogeneous containers. A<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      used in this fashion is called a type token. You can also use a custom key
      type. For example, you could have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">DatabaseRow</code><span class="Apple-converted-space">&nbsp;</span>type
      representing a database row (the container), and a generic type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Column&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>as its key.</p>
    <p></p>
    <p>1 </p>
  </body>
</html>
