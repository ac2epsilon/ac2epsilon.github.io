<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Effective Java 3rd 2018 - Переклад українською</title>
  </head>
  <body>
    <p> </p>
    <address>%Переклад українською - <a href="mailto:ac2epsilon@gmail.com">Арсеній
        Чеботарьов</a> - Київ 2018</address>
    <h1 class="h2f" style=" font-size: 26px; margin-top: 30px; margin-bottom: 30px; font-family: sans-serif; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Joshua
      Bloch - Effective Java (3rd) - 2018</h1>
    <h2 class="h2f" style="font-size: 26px; margin-top: 30px; margin-bottom: 30px; font-family: sans-serif; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Передмова</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      колега скаже тобі “Моя половина сьогодні ввечері вдома якусь незвичну їжу
      готуватиме. Ти міг приєднатися?” три речі можуть прийти на думку: третя -
      що ви були запрошені на вечерю; друга - що англійська не є рідною мовою
      вашого колеги; та перша це чимале здивування.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      ви колись вивчали другу мову самотужки, та потім намагались
      використовувати її за межами класної кімнати, ви знаєте, що є три речі,
      які маєте засвоїти: як структурована мова (граматика), як називаються речі
      (словник), та особливі та ефективні шляхи розповідати про щоденні речі
      (ідіоматика). Часто в класній кімнаті вивчають тільки першу частину, та ви
      побачите, що природні носії мови весь час стримують посмішки, по мірі
      того, як ви намагаєтесь дати себе зрозуміти.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      загалом те саме з мовами програмування. Вам треба розуміти базову мову: чи
      вона алгоритмічна, функціональна, об'єктно-орієнтовна? Вам треба знати
      словник: як виглядають структури даних, операндів, та можливості, які
      провадять стандартні бібліотеки? Та вам треба бути знайомим зі звичними та
      ефектіврними шляхами структурувати код. Книги щодо програмних мов часто
      покривають тільки перші дві теми, або дискутують використання дуже
      вибірково. Може це через те, що перші дещо простіші для описання.
      Граматика та словник є властивостями самої мови, але використання є
      характеристикою спільноти щодо використання.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Мова
      програмування Java, наприклад, є об'єктно-орієнтованою з поодиноким
      наслідуванням, та підтримує імперативний (твердження-орієнтовний) стиль
      кодування в кожному методі. Бібліотеки адресують підтримку графіки, мереж,
      розподіленого виконання та безпеку. Але як найкраще використовувати цю
      мову на практиці?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існує
      інше міркування. Програми, на відміну від речень мовлення, та на відміну
      від більшості книг та журналів, з часом напевне будуть зазнавати змін.
      Звичайно не достатньо спродукувати код, що ефективно оперує та легко може
      бути зрозумілий іншими; ви також маєте гарно оргнізувати код, щоб його
      було легко модифікувати. Можуть існувати якісь десять способів написати
      код для деякого завдання <span class="Apple-converted-space"></span><em>T</em>.
      З ціх десяти методів сім будуть незручні, неефективні, або приголомшиві. З
      інших трох, який є найбіш вірогідим до коду, який буде вирішувати завдання
      <span class="Apple-converted-space"></span><em>T'</em><span class="Apple-converted-space">
        в наступному релізі через рік</span>?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існують
      числені книги, з яких ви можете навчитись граматики мови програмування
      Java, включаючи <span class="Apple-converted-space"></span><em>The Java</em><sup>™</sup><span
        class="Apple-converted-space">&nbsp;</span><em>Programming Language</em><span
        class="Apple-converted-space"> від</span> Arnold, Gosling, and Holmes,
      або<span class="Apple-converted-space"> </span><em>The Java</em><sup>™</sup><span
        class="Apple-converted-space">&nbsp;</span><em>Language Specification</em><span
        class="Apple-converted-space"> від</span> Gosling, Joy, щиро ваші, та
      Bracha. Так само є купа книг по бібліотекам та API, асоційованих з мовою
      програмування Java.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга адресує вашу третю потребу: звичне та ефективне використання. Joshua
      Bloch витратив роки розширюючи, реалізуючи,&nbsp; та використовуючи мову
      програмування Java в Sun Microsystems; він також читав багато кода інших
      людей, включаючий мій. Тут ми надаємо гарні поради, систематично
      організовані, по тому, як структурувати ваш код, так щоб він гарно
      працював, так щоб інші люди могли зрозуіти його, та щоб майбутні
      модифікацї та покращення малоймовірно викликали головний біль — можливо,
      навіть так, щоб ваші програми були приємні, елегантні та витончені.</p>
    <p class="right" style="margin-top: 15px; margin-bottom: 15px; text-align: right; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.3; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Guy
      L. Steele Jr.<br>
      <em>Burlington, Massachusetts<br>
        April 2001</em></p>
    <p> </p>
    <h2 class="h2f" id="preface" style="font-size: 26px; margin-top: 30px; margin-bottom: 30px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Передмова</strong></h2>
    <h3 class="h3a" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 20px; page-break-after: avoid; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Передмова
        до третього видання</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        class="Apple-converted-space"></span>В 1997-му році, коли Java була
      новою, James Gosling (батько Java), описував її як “мову синіх комірців”
      що була “досить простою” [<a href="ref.xhtml#rGosling97" style="text-decoration: none;">Gosling97</a>].
      Приблизно в той же час, Bjarne Stroustrup (батько C++) описував C++ як
      “багато-парадигмову мову”, що “навмисне відрізняється від мов, призначених
      підтримувати один спосіб написання програм” [<a href="ref.xhtml#rStroustrup95"
        style="text-decoration: none;">Stroustrup95</a>]. Stroustrup попереджав:</p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Більшість
      з відносної простоти Java — як і більшості нових мов — частково є
      іллюзією, і частково є функцією їх неповноти. Як спливатиме час, Java буде
      значно зростати в розмірі та складності. Вона зросте вдвічі або втричі за
      розміром та наростить залежні від реалізації розширення або бібліотеки. [<a
        href="ref.xhtml#rStroustrup" style="text-decoration: none;">Stroustrup</a>]</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зараз,
      на двадцять років пізніше, буде часним сказати, що обоє, Gosling та
      Stroustrup, були праві. Java тепер велика та складна, з багатьма
      абстракціями для багатьох речей, від паралельного виконання, до ітерації,
      до представлення дати та часу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Я
      все ще люблю Java, хоча мій запал трохи охолов, по мірі зростання
      платформи. Маючи це зростання розміру та складності, потреба в нагальних
      практиках застосування стає все більш критичною. Це третя редакція <span
        class="Apple-converted-space"></span><em>Effective Java</em>, та я
      доклав найкращих зусиль до цього видання. Я маю надію що ця редакція
      продовжує задовільняти вашим потребам, залишаючись вірною духу перших
      двох.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Мале
      прекрасне, але просте не є простим.</p>
    <p class="right" style="margin-top: 15px; margin-bottom: 15px; text-align: right; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>San
        Jose, California<br>
        November 2017</em></p>
    <p class="noindentt" style="margin-top: 15px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">P.S.
Я
      буду нечесним, якщо не згадаю кращі практики (<em>софтверної</em>)
      індустрії, якій я присвячував більшість свого часу в минулому. З початку
      народження нашої справи в 1950-х, ми вільно реалізовували API одне одного.
      Ця практика була критичною для стрімкого успіху комп'ютерної технології. Я
      виявляв активність для збереження цієї волі (to preserve this freedom) [<a
        href="ref.xhtml#rCompSci17" style="text-decoration: none;">CompSci17</a>],
      та заохочую вас приєднатись до мене. Є критичним для здоров'я нашої
      професії, якщо ми збережемо право переписувати API один одного.</p>
    <h3 class="h3a" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 20px; page-break-after: avoid; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Передмова
        до другого видання</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Багато
      чого відбулося з платформою Java з тих пір, коли я писав першу редакцію
      цієї книги в 2001-му році, та прийщов гарний час для другої редакції.
      Найбільш важливий набір змін було додавання дженериків, типів переліку,
      анотацій, автобоксінгу, та циклів for-each в Java 5. Близько до цого було
      додання нової конкурентної бібліотеки,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.concurrent</code>,
      що також вийшла в Java 5. Разом з Gilad Bracha, я мав гарну нагоду
      очолювати команди, що розробляли ці можливості мови. Також я мав щастя
      прислужитись команді, що розробляла бібліотеку конкурентності, та якою
      керував Doug Lea.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Інша
      велика зміна в платформі є широке поширення сучасних редакторів коду,
      Integrated Development Environments (IDEs), таких як Eclipse, IntelliJ
      IDEA, та NetBeans, та інструментів статичного аналізу, таких як FindBugs.
      Хоча я не був задіяний в ціх спробах, я безпосередньо мав вигоди від них,
      та спостерігав, як вони впливали на досвід розробки Java.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      2004 я перейшов з Sun до Google, але я продовжував мій розвиток в розробці
      на Java протягом останніх чотирьох років, докладаючи код до API
      конкуренції та колекції через гарні офіси Google та Java Community
      Process. Я мав насолоду використовувати Java платформу для розробки
      бібліотек для використання в Google. Тепер я знаю, що значить відчувати
      себе користувачем.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Як
      і в випадку року 2001, коли я писав першу редакцію, моя первинна ціль була
      поширити мій досвід серед вас, так, щоб ви могли імітувати мої вдачі,
      уникаючи моїх помилок. Новий матеріал продовжує (<em>практику</em>)
      вільного використання прикладів з реального світу від бібліотек платформи
      Java.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Перша
      редакція була успішною далеко краще моїх сподівань, і я доклав кращих
      зусиль, щоб зберігти дух (<em>першого видання</em>), при цьому втручаючи
      новий матеріал, що мав підтримувати книгу на сучасному рівні. Було
      безсумнівно, що книга буде розростатись, і вона розрослась з сорокасеми до
      семидесятивосьми пунктів. Я не тільки додав двадцятьтри пункти, але я
      також щільно передивився оригінальний матеріал, та відправив декілька
      пунктів у відставку, кращі дні яких спливли. В Додатку ви можете побачити,
      як матеріал цього видання пов'язаний з матеріалом першої редакції.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      передмові до першого видання я писав, що мова програмування Java та її
      бібліотеки значно додали в якості та продуктивності, та з ними стало
      приємніше працювати. Зміни в релізах 5 та 6 отримали гарну річ, та зробили
      її краще. Платформа стала значно більшою, ніж вона була в 2001-му році, та
      стала складнішою, але якщо ви вивчили шаблони та ідіоми для використання
      нових можливостей, ви зробите ваші програми кращими, та ваше життя
      простішим. Я маю надію, що це редакція захопила мій постійний інтузіазм
      щодо платформи, та допомагає зробити використання цієї платформи та її
      нових можливостей більш ефективним та приємним.</p>
    <p class="right" style="margin-top: 15px; margin-bottom: 15px; text-align: right; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>San
        Jose, California<br>
        April 2008</em></p>
    <h3 class="h3a" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 20px; page-break-after: avoid; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Передмова
        до першої редакції</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      1996 я підвищив ставки, та подався на Захід для роботи в компанії
      JavaSoft, як вона тоді була відома, оскільки мені було ясно, що це місце
      де відбуваються справи. Протягом наступних п'яти років я служив справі як
      архитектор бібліотек Java. Я розробляв, реалізував та підтримував багато
      бібліотек, та консультував багато кого. Робота з ціма бібліотеками по мірі
      зрослішання&nbsp; Java платформи була подією, що відбувається раз в житті.
      Не буде перебільшенням сказати, що я мав привелегію робити з деякими з
      найвеличніших софтверних інженерів нашого покоління. В процесі цього я
      навчився багато чого щодо мови програмування Java — що робить, що ні, та
      як використовувати її бібліотеки для кращого ефекту.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга є моєю спробою поділити мій досвід з вами, так що ви можете
      імітувати мій успіх, та уникнути моїх помилок. Я позичив формат з Scott
      Meyers’s<span class="Apple-converted-space">&nbsp;</span><em>Effective C++</em>,
      що складається з п'ятидесяти елементів, кожний складає особливе правило
      для покращення ваших програм та їх дизайну. Я винайшов цей формат
      остаточно ефективним, та маю надію ви також.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      багатьох випадках я обирав вільно ілюструвати теми прикладами з реального
      світу з бібліотек платформи Java. Коли я описую дещо, що можна зробити
      краще, я намагаюсь надати код, що я писав сам, але часом я обираю код,
      написаний моїм колегою. Я щиро перепрошую, якщо, попри мої кращі
      намагання, я образив когось. Негативні приклади наведені не для розпалення
      образ, але в дусі кооперації, так що всі ми можемо отримати вигоду від
      досвіду того, що робилось до цього.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      ця книжка не націлена винятково на розробників повторно використовуваних
      компонентів, вона неодмінно розфарбована моїм досвідом в написанні ціх
      компонент на протязі останніх двох десятисіть. Я природно думаю в термінах
      експортованих&nbsp; API (Application Programming Interfaces), та я раджу
      робити так само. Навіть якщо ви не розробляєте повторно використовувані
      компоненти, мислення в ціх термінах призводить до покращення якості
      софтверу, що ви пишете. Більше того, не є загальним писати компоненти без
      того, щоб знати їх: ви пишете дещо корисне, поділяючи це з товаришом по
      цеху, та з часом ви маєте з пів дюжини користувачів. На цей час ви не
      маєте досить гнучкості змінити API за власним бажанням, та досить вдячні
      собі за весь той труд, що ви поклали в розробку API, коли перший час
      писали ваш софт.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Мій
      фокус на розробці API може виглядати трохи неприродним в світі новітніх
      методологій облегченого програмного забезпечення, як <span class="Apple-converted-space"></span><em>Екстремальне
        програмування</em>. Ці методології наполягають на написанні найпростіших
      програм, що взагалі здатні працювати. Якщо ви використовуєте одну з ціх
      методологій, ви винайдете, що фокусування на розробці API гарно
      прислужиться вам в процесі <em>рефакторінгу</em>. Фундаментальні цілі
      рефакторингу є покращення структури системи, та відсутність дублікації
      коду. Ці цілі неможливі досягти за відсутності гарно розробленого API для
      компонентів системи.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Немає
      ідеальної мови, але деякі чудові. Я знаходжу мову програмування Java та її
      бібліотеки надзвичайно сприятливі для якості та продуктивності, та також
      радості робити з нею. Я маю надію, що ця книга захопить мій інтузіазм, та
      допомагає вашому використанні мови більш ефективно та з насолодою.</p>
    <p class="right" style="margin-top: 15px; margin-bottom: 15px; text-align: right; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>Cupertino,
        California<br>
        April 2001</em></p>
    <p> </p>
    <h2 class="h2" id="ch1" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Глава
      1. Вступ</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        class="Apple-converted-space"></span>Ця книга розроблена допомогти вам
      зробити використання мови програмування Java ефективним, так само, як її
      фундаментальні бібліотеки:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.lang</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util</code>, та <code
        style="font-family: 'Courier New', monospace;">java.io</code>, та
      суб-пакунки, як<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">java.util.concurrent</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">java.util.function</code>.
      Інші бібліотеки дискутуються час від часу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга складається з дев'яноста пунктів, кожний з яких доводить одне
      правило. Правила охоплюють практичні ідеї, що визнані кращими з найбільш
      досвідчених програмістів. Правила довільно поділені на одинадцять глав,
      кожна покриває один з широких аспектів розробки програмного забезпечення.
      Книга на призначена для читання від корки до корки: кожний пункт стоїть
      окремо, більш або менш. Елементи щільно посилаються один на одне, так що
      ви можете просто прокласти свій шлях по цій книзі.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Багато
      з нових можливостей були додані до платформи з часу останньої редакції
      друку цієї книги. Більшість&nbsp; з тем цієї книги використовують ці
      можливості в деякий спосіб. Ця таблиця показує, де вам шукати первинні
      описи ціх можливостей:</p>
    <table class="tablewidth" style="border-collapse: collapse; width: 1179px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px; height: 319px;">
      <tbody>
        <tr>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Можливість</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Пункти</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Реліз</strong></p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Лямбди</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch7.xhtml#lev42" style="text-decoration: none;">Пункти 42</a>–<a
                href="ch7.xhtml#lev44" style="text-decoration: none;">44</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Потоки</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch7.xhtml#lev45" style="text-decoration: none;">Пункти 45</a>–<a
                href="ch7.xhtml#lev48" style="text-decoration: none;">48</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Опції</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch8.xhtml#lev55" style="text-decoration: none;">Пункт 55</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Методи
              по замовчанню інтерфейсів</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch4.xhtml#lev21" style="text-decoration: none;">Пункт 21</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">try</code>-with-resources</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch2.xhtml#lev9" style="text-decoration: none;">Пункт 9</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              7</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">@SafeVarargs</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch5.xhtml#lev32" style="text-decoration: none;">Пункт 32</a></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              7</p>
          </td>
        </tr>
        <tr>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Модулі</p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><a
                href="ch4.xhtml#lev15" style="text-decoration: none;">Пункт 15</a></p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              9</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="indentt" style="margin-top: 13.333334px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_2"></span>Більшість пунктів ілюстровані
      прикладами програм. Ключова властивість цієї книги в тому, що вона містить
      приклади коду, що ілюструють багато з шаблонів розробки та ідіом. Коли це
      доцільно, вони перекресно посилаються на стандартні роботи в цій галузі [<a
        href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Багато
      пунктів містять один або більше прикладів програм, що ілюструють деякі
      практики, яких треба уникати, Такі прклади, іноді відомі як <em>антишаблони,
        </em>ясно відмічені відповідними коментарями, як <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>// Не робіть так!</strong></code>.
      В цьому випадку пунт пояснює, чому приклад поганий, та підказує
      альтернативний підхід.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга не розрахована на початківців: вважається, що ви добре знайомі з
      Java. Якщо це не так, погляньте на один або більше вступних текстів, як
      Sestoft<span class="Apple-converted-space"> </span><em>Java Precisely</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rSestoft16"
        style="text-decoration: none;">Sestoft16</a>]. Тоді як <span class="Apple-converted-space"></span><em>Effective
        Java</em><span class="Apple-converted-space"> </span>розроблена бути
      доступною для будь-кого з робочим досвідом роботи з мовою, вона дає їжу
      для роздумів навіть для досвідчених програмістів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Більшість
      з правил в цій книзі походять від декількох фундаментальних принципів.
      Ясність та простота є наріжним каменем. Користувач компонента ніколи не
      має дивуватись його поведінкою. Компоненти можуть бути такі малі, як це
      можливо, але не менше. (Як використовується в цій книзі, термін <em>компонент</em><span
        class="Apple-converted-space"> посилається на любий повторно
        використовуваний програмний компонент, від окремого методу до складного
        фреймворку, що скаладається з декількох пакунків</span>). Код має бути
      викорстаний повторно, ніж скопійований. Залежність між компонентами має
      бути зведеною до мінімуму. Помилки треба виявляти так рано, як можливо,
      після того, як вони відбулись, в ідеалі під час компіляції.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      правила в цій книзі не застосовуються в ста відсотках випадків, вони
      характерізують кращі практикі програмування в великій більшості випадків.
      Вам не треба рабськи слідувати цім правилам, але порушувати їх треба
      тільки часом, та з гарних причин. Навчання мистецтву програмування, як і
      більшості інших дисциплін, полягає в вивченні правил, та потім як
      порушувати їх.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Для
      більшості випадків ця книга не стосується продуктивності. Вона про
      написання програм, що ясні, коректні, корисні, надійні, гнучкі та гарно
      підтримуються. Якщо ви можете досягти цього, зазвичай відносно просто
      також досягти гарної продуктивності (Елемент 67). Деякі пункти торкаються
      питань продуктивності, та декілька наводять показники продуктивності. Ці
      числа, що розпочинаються фразою “На моїй машині” треба сприймати,
      щонайбільше, як приблизні.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Щоб
      дещо уточнити, моя машина є саморобна 3.5GHz quad-core Intel Core
      i7-4770K, з 16Гб DDR3-1866 CL9 RAM, що виконує реліз Azul Zulu 9.0.0.15
      OpenJDK, на Microsoft Windows 7 Professional SP1 (64-bit).</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_3"></span>Коли іде мова про можливості
      мови програмування Java та її бібліотеки, іноді потрібно посилатись на
      певні релізи. Для зручності ця книга використовує псевдоніми замість
      офіційних назв. Ця таблиця показує відображення між іменами релізів та
      псевдонімами:</p>
    <table class="tablewidth" style="border-collapse: collapse; width: 1179px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
      <tbody>
        <tr>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Офіційна
                назва релізу</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Нікнейм</strong></p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">JDK
              1.0.<em>x</em></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              1.0</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">JDK
              1.1.<em>x</em></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              1.1</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2 Platform, Standard Edition, v1.2</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2 Platform, Standard Edition, v1.3</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              3</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2 Platform, Standard Edition, v1.4</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              4</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              2 Platform, Standard Edition, v5.0</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              5</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              Platform, Standard Edition 6</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              6</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              Platform, Standard Edition 7</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              7</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              Platform, Standard Edition 8</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              8</p>
          </td>
        </tr>
        <tr>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              Platform, Standard Edition 9</p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Java
              9</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="indentt" style="margin-top: 13.333334px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Приклади
      є досить повними, але більше націлені на просте читання, ніж на повноту.
      Вони вільно використовують класи з пакунків <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">java.util</code><span class="Apple-converted-space">
        та </span><code style="font-family: 'Courier New', monospace;">java.io</code>.
      Щоб скомпілювати приклади вам треба додати одну або декілька декларацій
      імпорту, або ще якість загальні речі. Сайт цієї книги, <code style="font-family: 'Courier New', monospace;"><a
          href="http://joshbloch.com/effectivejava" style="text-decoration: none;">http://joshbloch.com/effectivejava</a></code>,
      містить розширену версію кожного криклада, що може бути скомпільований та
      виконаний.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      більшості місць ця книга використовує технічні терміни, як вони визачені в
      <span class="Apple-converted-space"></span><em>The Java Language
        Specification, Java SE 8 Edition</em><span class="Apple-converted-space">&nbsp;</span>[<a
        href="ref.xhtml#rJLS" style="text-decoration: none;">JLS</a>]. Деякі
      терміни мають власне значення. Мова підтримує чотири різновиди типів:<span
        class="Apple-converted-space"> </span><em>інтерфейси</em><span class="Apple-converted-space">
      </span>(включаючи<span class="Apple-converted-space"> </span><em>анотації</em>),<span
        class="Apple-converted-space"> </span><em>класи</em><span class="Apple-converted-space">
      </span>(включаючи<span class="Apple-converted-space"> </span><em>enum</em>),<span
        class="Apple-converted-space"> </span><em>масиви</em>, та<em> примітиви</em>.
      Перші три відомі як <em>типи посилання</em>. Примірники класів та масиви
      є об'єктами; примітивні типи ні. Члени класів складаються з <em>полів</em>,
      <em>методів, членів-класів </em>та <em>членів-інтерфейсів</em><em>.</em><span
        class="Apple-converted-space"> <em>Сигнатура метода </em>складається з
        імені та типів формальних параметрів</span>; сигнатура <em>не включає
        тип повернення метода</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга використовує деякі терміни відмінно від <span class="Apple-converted-space"></span><em>The
        Java Language Specification</em>. На відміну від <em>Java Language
        Specification</em>, ця книга використовує <span class="Apple-converted-space"></span><em>inheritance</em>as
      (наслідування) як синонім для<span class="Apple-converted-space"> </span><em>subclassing
        </em>(утворення субкласів). Замість використовувати термін наслідування
      для інтерфейсів, ця книга просто стверджує, що клас <em>реалізує </em>інтерфейс,
      або що один інтерфейс <em>розширює </em>інший. Щоб описати рівень
      доступу, що застосовується коли нічого не вказано, ця книга використовує
      тридиційне <em>пакунок-приватне, </em>замість технічно коректного <em>пакетного
        доступу</em><span class="Apple-converted-space"> </span>[JLS, 6.6.1].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      книга використовує декілька технічніх термінів, що не визначені в <span class="Apple-converted-space"></span><em>The
        Java Language Specification</em>. Термін<span class="Apple-converted-space"></span><em>
        експортовані API</em>, або просто<span class="Apple-converted-space"> </span><em>API</em>,
      посилаючись на класи, інтерфейси, конструктори, члени, та серіалізовані
      форми, через які програміст отримує доступ до класів, інтерфейсів, або
      пакунку. (Термін <em>API</em>, що є скороченням до <span class="Apple-converted-space"></span><em>application
        programming interface</em>, використовується переважно до терміну <em>інтерфейс,
        </em>щоб уникнути напорозуміння з мовним конструктивом з такою ж
      назвою). Програміст, який пише програму, що використовує це API, виступає
      як <em>користувач </em>цього API. Клас, чия реалізація використовує API,
      <em>клієнтом </em>цього API.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Класи,
      інтерфейси, конструктори, члени, та серіалізовані форми загалом відомі як
      <em>елементи </em><span class="Apple-converted-space"></span><em>API</em>.
      Експортований API складається з елементів API, доступних за межами
      пакунка, в якому визначений цей API. Це елементи API, що може
      використовувати кожен клієнт, і які автор цього API обіцяє підтримувати.
      Не випадково, це також елеенти, для яких утіліта Javadoc генерує
      документацію в перебігу подій за замовчанням. Просто кажучи, експортований
      API пакунку скаладається з публічних та захищених членів та конструкторів
      кожного публічного класу або інтерфейсу в пакунку.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      Java 9 до платформи була додана<span class="Apple-converted-space"> </span><em>система
        модулів</em>. Якщо бібліотека використовує систему модулів, її
      експортований API буде об'єднаням експортованих API всіх пакунків,
      експортованих декларацією модуля бібліотеки.</p>
    <p> </p>
    <p> </p>
    <p> </p>
    <p> </p>
    <h2 class="h2" id="ch2" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Глава
      2. Створення та руйнування об'єктів</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      глава займається створенням та руйнуванням об'єктів: коли та як їх
      створювати, коли та як уникати їх створення, як переконатись, що вони
      своєчасно зруйновані, та як керувати діями з очищення, що мають передувати
      їх знищенню.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Елемент
        1: Розгляньте статичні методи-фабрики замість конструкторів</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Традиційний
      шлях для класу дозволити клієнту отримати примірник - це запровадити
      публічний конструктор. Існує також інший прийом, що повинен стати частиною
      інструментарію кожного програміста. Клас може провадити публічний <span class="Apple-converted-space"></span><em>статичний
        метод-фабрику</em>, що є просто статичним методом, що повертає примірник
      класу. Ось простий приклад від <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Boolean</code><span class="Apple-converted-space">&nbsp;</span>(<span
        class="Apple-converted-space"></span><em>боксованого примітивного класу
      </em><span class="Apple-converted-space"></span>для<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">boolean</code>).
      Цей метод транслює примітивне значення <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">boolean</code><span class="Apple-converted-space">
      </span>на об'єктне посилання на об'єкт <code style="font-family: 'Courier New', monospace;">Boolean</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static Boolean valueOf(boolean b) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return b ? Boolean.TRUE : Boolean.FALSE;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зауважте,
      що метод статичної фабрики не та саме, що і Шаблон Розробки<span class="Apple-converted-space">
      </span><em>Factory Method</em><span class="Apple-converted-space"> </span>[<a
        href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Метод статичної фабрики, описаний в цьому елементі, не має прямого
      еквіваленту в <span class="Apple-converted-space"></span><em>Design
        Patterns</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Клас
      може провадити своїм клієнтам етоди статичної фабрики, замість, або но
      додаток до, публічних конструкторів. Провадженя статичного метода-фабрики,
      замість публічного конструктора, має також принади та недоліки.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Одна
        перевага статичних методів-фабрик в тому, що вони мають імена.</strong><span
        class="Apple-converted-space"> Якщо параметри конструктора не роблять
        цього, і самі по собі не описують об'єкт, що буде повертатись, статична
        фабрика з гарно обраною назвою простіше використовувати, та отриманий
        код клієнта простіше читати</span>. Наприклад, конструктор <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">BigInteger(int, int,
        Random)</code>, що повертає <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">,
        що можливо є простим, може бути краще виражений як метод статичної
        фабрики на ім'я</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">BigInteger.probablePrime</code>.
      (Цей метод був доданий в Java 4.)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Клас
      може мати єдиний конструктор з певною сигнатурою. Програмісти раніше
      шукали обхідні шляхи коло цього обмеження, провадячи два конструктора, циї
      списки параметрів відрізняються тільки в порядку їх типів параметрів.
      Насправді це погана ідея. Користувач такого API ніколи не буде в змозі
      запам'ятати, який конструктор є який, та скінчить тим, що буде помилково
      викликати не той. Люди, які читають код, що використовує такі
      конструктори, не будуть знати що робить код, без посилання на документацію
      класу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Оскльки
      всі воні мають імена, статичні методи фабрики не поділяють обмеження,
      описані в попередньому параграфі. В випадках, коли здається, що класи
      потребують декількох конструкторів з тою самою сигнатурою, замініть
      конструктори на статичні методи фабрик, та уважно оберіть імена, щоб
      наголосити на їх відмінностями.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Друга
        перевага статичних методів фабрик в тому, що, на відміну від
        конструкторів, вони не мають створювати новий примірник кожного разу,
        коли їх викликають.</strong><span class="Apple-converted-space"> Це
        дозволяє незмінні класи </span>(<a href="ch4.xhtml#lev17" style="text-decoration: none;">Елемент
        17</a>), та використання наперед створених примірників, або кешування
      примірників по мірі створення, та повторно розподіляти їх, для уникання
      небажаної дублікації об'єктів. Метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Boolean.valueOf(boolean)</code><span
        class="Apple-converted-space"> ілюструє цей прийом</span>: він<span class="Apple-converted-space">
      </span><em>ніколи не створює</em> об'єкти. Цей прийом подібний до
      шаблону&nbsp; the<span class="Apple-converted-space">&nbsp;</span><em>Flyweight</em>
      [<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Він може покращити продуктивність, якщо часто запитуються еквівалентні
      об'єкти, особливо якщо їх створення коштовне.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Здатність
      статичних методів фабрик повертати той саммий об'єкт від повторних
      викликів дозволяє класам підтримувати прямий контроль щодо того, які
      примірники існують в кожний момент часу. Класи, що роблятьт це, називають
      <span class="Apple-converted-space"></span><em>онтрольованими-примірниками.</em><span
        class="Apple-converted-space"> Існує декілька причин писати такі класи.
        Контоль за примірниками дозволяє класу гарантувати, що він&nbsp; є
        синглтоном </span>(<a href="ch2.xhtml#lev3" style="text-decoration: none;">Елемнт
        3</a>) або його примірників взагалі немає (<a href="ch2.xhtml#lev4" style="text-decoration: none;">Елемент
        4</a>). Також це дозволяє класи з незмінним значенням (<a href="ch4.xhtml#lev17"
        style="text-decoration: none;">Елемент 17</a>), що дає гарантію, що
      немає двох еквівалентних примірників:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">a.equals(b)</code><span class="Apple-converted-space">
        тоді і тільки тоді, коли</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">a == b</code>. Це основа
      шаблону <em>Легковажності</em><span class="Apple-converted-space"> (</span><em>Flyweight</em><span
        class="Apple-converted-space">)</span> [<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Типи перелічень (<a href="ch6.xhtml#lev34" style="text-decoration: none;">Елемент
        34</a>) надають цю гарантію.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Третя
        перевага статичних методів фабрик в тому, що, на відміну від
        конструкторів, вони можуть повертати об'єт любого субтипу їх типу
        повернення.</strong><span class="Apple-converted-space"> Це дає вам
        велику гнучкість в виборі класу повернутого об'єкту</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Одне
      з застосувань цієї гнучості в тому, що API може повертати об'єкти без
      того, щоб робити їх класи публічними. Приховуючи реалізацію класів в цей
      спосіб призводить до дуже компактного API. Цей прийом сам по собі
      приводить до <em>базованих-на-інтерфейсах фреймворках</em><span class="Apple-converted-space">
      </span>(<a href="ch4.xhtml#lev20" style="text-decoration: none;">Елемент
        20</a>), де інтерфейси дають природні повертаємі типи для статичних
      методів-фабрик.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_7"></span>До появи Java 8 інтерфейси не
      могли мати ститичних методів. За домовленістю статичні методи фабрик для
      інтерфейсу на ім'я <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><em>Type</em></code><span
        class="Apple-converted-space">, покладались в <em>нестворюваний
          клас-компанйон</em></span><span class="Apple-converted-space"> </span>(<a
        href="ch2.xhtml#lev4" style="text-decoration: none;">Елемент 4</a>) на
      ім'я<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><em>Types</em></code>.
      Наприклад, Java Collections Framework мав сорок-п'ять допоміжних
      реалізацій власних інтерфейсів, провадячи немодифіковані колекції,
      синхронізовані колекції, і так далі. Майже всі з цїх реалізацій
      експортувались через статичні методи фабрики в одному нестворюваному класі
      (<code style="font-family: 'Courier New', monospace;">java.util.Collections</code>).
Класи
      повертаємих об'єктів всі були непублічними.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Collections
      Framework API є меншим, чив він мав би бути, якщо б експортував
      сорок-п'ять окремих публічних класів, по одному для кожної відомої
      реалізації. Це не тільки <em>купа </em>API, яку вдалось зменшити, але і
      <em>концептульна вага</em><em>:</em><span class="Apple-converted-space"> </span>число
      та складність концепцій, що мають засвоїти програмісти, щоб
      використовувати API. Програміст знає, що потрібний об'єкт має то саме API,
      яке вказане в інтерфейсі, так що немає потреби читати додаткові
      документації класів для класу реалізації. Більше того, маючи такий
      статичний метод фабрики потребує від клієнта посилання на повернутий
      об'єкт згідно інтерфейса, скоріше ніж класа реалізації, що загалом є
      гарною практикою (<a href="ch9.xhtml#lev64" style="text-decoration: none;">Елемент
        64</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В&nbsp;
      Java 8 обмеження, що інтерфейси не можуть містити статичні методи, було
      видалено, так що тепер є мало причин провадити нестворюваний
      клас-компанйон для інтерфейсу. Багато публічних статичних членів, що були
      б на своєму місці в такому класі, повинні замість цього бути розташовані в
      самому інтерфейсі. Зауважте, однак, що все ще може бути потрібним покласти
      багато з коду реалізації за межами ціх статичних методів в окремий,
      пакунок-приватний клас. Це тому, що Java 8 потребує, щоб статичні члени
      інтерфейса були публічними. Java 9 дозволяє приватні статичні методи, але
      статичні поля та статичні члени-класи все ще потребують бути публічними.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Четверта
        перевага статичних фабрик в тому, що клас повернутого об'єкту може
        варіюватись виклик від виклику, як функція вхідних параметрів.</strong><span
        class="Apple-converted-space"> Любий субтип задекларованого результату
        буде дозволеним. Клас повернутого об'єкту може також варіювати від
        релізу до релізу</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Клас
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">EnumSet</code><span
        class="Apple-converted-space"> </span>(<a href="ch6.xhtml#lev36" style="text-decoration: none;">Елемент
        36</a>) не має публічних конструкторів, тільки статичні фабрики. В
      реалізації OpenJDK вони повертають примірник одного з двох субкласів, в
      залежності від розміру підлеглого типу enum: якщо він має
      шістьдесят-чотири або меньше елементів, як відбувається з більшістю
      переліків, статичні фабрикі повертають примірник<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">RegularEnumSet</code>,
      що підтримується поодиноким<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">long</code>; якщо тип
      enum має 65 або більше елементів, фабрики повертають примірник<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">JumboEnumSet</code>,
      представлений як масив<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">long</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Наявність
      ціх двох класів-реалізацій невидиме для клієнтів. Якщо<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">RegularEnumSet</code><span
        class="Apple-converted-space"> припинить надавати переваги
        продуктивності для малих типів переліку, він може зникнути з наступних
        релізів без болісних ефектів. Подібно до цього, наступний реліз може
        додати третю або четверту реалізацію </span><code style="font-family: 'Courier New', monospace;">EnumSet</code><span
        class="Apple-converted-space">, якщо це буде вигідним для продуктивності</span>.
      Клієнти ніколи не знають, або не мають турбуватись щодо класу об'єкта, що
      буде повертатись з фабрики; вони турбуються тільки про те, що це якісь з
      субкласів <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">EnumSet</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>П'ята
        перевага статичних фабрик в тому, що класи повертаємих об'єктів не мають
        існувати, коли створюється клас, що містить створюваний метод. </strong><span
        class="Apple-converted-space"></span>Така гнучка статича форма метода
      фабрики є основою для <em>фреймворків провайдерів сервісіів, </em>як
      Java Database Connectivity API (JDBC). Фреймворк провайдера сервісу є
      системою, в якій провайдери реалізують сервіс, та система робить
      реалізацію доступною для кілєнтів, відділяючи клієнтів від реалізацій.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існує
      три основних компонентів в фремворці провайдера сервісу: <em>інтерфейс
        сервісу, </em>що представляє реалізацію; <em>API реєстрації провайдера</em>,
      яке провайдери використовують для реєстрації реалізацій; <em>API доступу
        до сервісів</em>, який використоує клієт для отримання примірників
      сервісу. API доступу до сервісу можуть дозволити клієнтам вказувати
      критерії для обрання реалізації. За відсутності такої критерії, API
      повертає примірник реалізації по замовчанню, або дозволяє клієнтові
      проходити по можливим реалізаціям. API доступу до сервісу є гнучкою
      статичною фабрикою, що формує базис фреймворку провайдера сервісу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Опціональний
      четвертий компонент фреймворку провайдера сервісу є <em>інтерфейс
        провайдера сервісу</em>, що описує об'єкт фабрики, що продукує
      примірники інтерфейсу сервісу. За відсутності інтерфейсу провайдерів
      сервісу, реалізації мають бути утворювати примірники рефлективно (<a href="ch9.xhtml#lev65"
        style="text-decoration: none;">Елемент 65</a>). В випадку JDBC<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Connection</code><span
        class="Apple-converted-space"> </span>відіграє роль інтерфейсу сеpвісу,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">DriverManager.registerDriver</code><span
        class="Apple-converted-space"> є </span><span class="Apple-converted-space">
        API реєстрації провайдерів</span>, <code style="font-family: 'Courier New', monospace;">DriverManager.getConnection</code><span
        class="Apple-converted-space"> </span>є API доступа до сервіса, та <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Driver</code><span
        class="Apple-converted-space"> є інтерфейсом провайдера сервісу</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існує
      багато шаблонів для фреймворку провайдера сервісів. Наприклад, API доступу
      до сервіса може повертати багатший інтерфейс сервісу до клієнтів, ніж той,
      що надають провайдери. Це шаблон Моста<span class="Apple-converted-space">.
      </span><em>Bridge</em><span class="Apple-converted-space">&nbsp;</span>pattern
      [<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Фреймворки ін'єкції залежностей (<a href="ch2.xhtml#lev5" style="text-decoration: none;">Елемент
        5</a>) можа розглядати як потужний провайдер сервісів. Починаючи з Java
      6, платформа включає фреймворк провайдера сервісів загального призначеня,
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">java.util.ServiceLoader</code>,
      так що вам немає потреби, та загалом не повинні, писати ваші власні (<a href="ch9.xhtml#lev59"
        style="text-decoration: none;">Елемент 59</a>). JDBC не використовує<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">ServiceLoader</code>,
      бо той з'явився пізніше.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Головне
        обмеження на провадження тільки статичних методів фабрик в тому, що
        класи без публічних або захищених конструкторів не можуть мати
        субкласів. </strong><span class="Apple-converted-space"></span>Наприклад,
      неможливо створити субклас любого зі звичних класів реалізації в
      Collections Framework. Напевне, цьому можна тільки радіти, оскільки це
      заохочує програмістів використовувати композицію замість наслідування (<a
        href="ch4.xhtml#lev18" style="text-decoration: none;">Елемент 18</a>),
      та є вимогою для незмінних типів (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Елемент
        17</a>).</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Другє
        обмеження статичних методів фабрик в тому, що програмістам складно їх
        знайти.</strong><span class="Apple-converted-space"> Вони не виділяються
        з документації </span>API в спосіб, як це роблять конструктори, так що
      може бути складним винайти, як можна створити примірник класу, що
      провадить статичні методи фабрик замість конструкторів. Інструмент Javadoc
      може з часом звернути увагу не статичні методи фабрики. В найближчий час
      ви можете зменшити цю проблему, через увагу до статичних методів фабрик в
      класі, або в документації, та приставши до загальних домовленостей по
      іменуванню. Ось деякі загальні імена для статичних методів фабрик. Список
      далекий від повноти:</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>from</strong></code>
      — Метод <em>перетворення типів, </em>що приймає єдиний параметр, та
      повертає відповідний примірник цього типу, наприклад:</p>
    <p class="codepb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 10.666667px; margin-bottom: 10.666667px; margin-left: 36px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Date
      d = Date.from(instant);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>of</strong></code>
      — <em>Метод агрегації, </em>що приймає декілька параметрів, та повертає
      тип, що поєднує їх всі, наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Rank&gt;
      faceCards = EnumSet.of(JACK, QUEEN, KING);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>valueOf</strong></code>
      — Більш гучна альтернатива до <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">from</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">of</code>,
      наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BigInteger
      prime = BigInteger.valueOf(Integer.MAX_VALUE);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>instance</strong></code><span
        class="Apple-converted-space"> </span>або<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>getInstance
          </strong></code>— Повертає примірник, що описаний параметром (якщо є),
      але не можна сказати, чи це буде мати те саме значення, наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">StackWalker
      luke = StackWalker.getInstance(options);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>create</strong></code><span
        class="Apple-converted-space">&nbsp;</span>oбо<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>newInstance</strong></code>
      — Як <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">instance</code><span
        class="Apple-converted-space"> </span>або<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">getInstance</code>,
      за винятком того, що метод гарантує, що кожний виклик повертає новий
      примірник, наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Object
      newArray = Array.newInstance(classObject, arrayLen);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>get</strong></code><em><strong>Type</strong></em>
      — Як<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">getInstance</code>,
      але використовується, якщо метод фабрики знаходиться в іншому класі.<span
        class="Apple-converted-space">&nbsp;</span><em>Type</em><span class="Apple-converted-space">
        є типом об'єкта. що треба повернути методом файбрикою, наприклад</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">FileStore
      fs = Files.getFileStore(path);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>new</strong></code><em><strong>Type
          </strong></em>— Як<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">newInstance</code>,
      але використовується, якщо метод фабрики є іншого класу.<span class="Apple-converted-space">&nbsp;</span><em>Type</em><span
        class="Apple-converted-space"> </span>є типом, що повертає метод
      фабрика, наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BufferedReader
      br = Files.newBufferedReader(path);</p>
    <p class="bull" style="margin-top: 0px; margin-bottom: 0px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><em><strong>type</strong></em>
      — Скорочена альтернатива до <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">get</code><em>Type</em><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">new</code><em>Type</em>,
      наприклад:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">List&lt;Complaint&gt;
      litany = Collections.list(legacyLitany);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      підсумку, статичні методи фабрики та публічні конструктори, обоє мають
      своє застосування, і має сенс розібратись в їх відносних достоїнствах.
      Часто статичні фабрики є переважними, так що уникайте рефлекторного
      запровадження публічних конструкторів, зпочатку не розглянувши статичні
      фабрики.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_10"></span><strong>Елемент 2: Розгляньте
        білдер, коли стикнетесь з багатьма параметрами конструктора</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Статичні
      функції та конструктори поділяють одне обмеження: вони не маштабуються
      добре до великих чисел опціональних параметрів. Розглянемо випадок, коли
      клас представляє диєтичні факти, що клеяться на упаковках продуктів. Ці
      мітки можуть мати декілька обов'язкових полів — кількість на одну порцію,
      кількість порцій в пакунку, та калорії в одній порції — та більше ніж
      дванадцять опціональних полів — загальний вмст жирів, кількість насичених
      жирів, штучний жир, холестерол, вуглеводи і так далі. Більшість продуктів
      мають ненулеві значення тільки для деяких з ціх опціональних полів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Який
      різновид конструкторів або статичних фабрик повинні ви написати для такого
      класу? Традиційно програмісти використовують шаблон <em>телескопічні
        конструкції</em>, в якій ви провадите конструктор тільки з потрібними
      полями, інший з одним додатковим полем, третій з двома додатковими, і так
      далі, остаточно задавши конструктор з усіма функціональними параметрами.
      Ось як це виглядає на практиці. Для цілей краткості показані тільки чотири
      опціональні поля:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Шаблон телескопічного конструктора - негарно маштабується!</strong><br>
      public class NutritionFacts {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int servingSize;&nbsp;&nbsp;//
      (mL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;
      потрібне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int
      servings;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// (порцій в пачці) потрібне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int
      calories;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// (на порцію)&nbsp;&nbsp;&nbsp;
      опціональне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int
      fat;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (g/порцію)&nbsp;&nbsp;&nbsp;&nbsp; опціональне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int
      sodium;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (mg/порцію)&nbsp;&nbsp;&nbsp; опціональне<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int carbohydrate; //
      (g/порцію)&nbsp;&nbsp;&nbsp;&nbsp; опціональне<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(servingSize,
      servings, 0);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      calories) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(servingSize,
      servings, calories, 0);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      calories, int fat) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(servingSize,
      servings, calories, fat, 0);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      calories, int fat, int sodium) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this(servingSize,
      servings, calories, fat, sodium, 0);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <span epub:type="pagebreak" id="page_11"></span><br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts(int servingSize, int
      servings,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int calories,
      int fat, int sodium, int carbohydrate) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servingSize&nbsp;&nbsp;=
      servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servings&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
      servings;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.calories&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
      calories;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.fat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
      fat;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.sodium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      = sodium;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.carbohydrate =
      carbohydrate;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Коли
      ви бажаєте створити примірник, ви використовуєте конструктор з найменшим
      списком параметрів, що містить всі параметри, які ви бажаєте встановити:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NutritionFacts
      cocaCola =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;new NutritionFacts(240, 8, 100, 0, 35, 27);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Типово
      виклик цього конструктора буде потребувати багато параметрів, що ви не
      бажаєте встановити, але ви змушені передавати значення для них в жодному
      разі. В цьому випадку ми передаємо значення 0 для вмісту жиру. "Тільки" з
      шістьома параметрами це може виглядати не так вже і погано, але це швидко
      вийде з-під контролю по мірі зростання числа параметрів. </p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      коротко, <span class="Apple-converted-space"></span><strong>шаблон
        телескопічного конструктора працює, але для нього складно писати
        клієнтський код, коли є багато параметрів, та ще складніше </strong><strong>це
        </strong><strong>читати.</strong><span class="Apple-converted-space">
        Читач залишається здивованим, що всі ці значення значать, та має уважно
        рахувати параметри, щоб розібратись в цьому</span>. Довгі послідовності
      ідентично типізованих параметрів можуть викликати непомітні помилки. Якщо
      клієнт випадково поміняє два такі параметри, компілятор не буде сваритись,
      але програма буде невірно поводитись під час виконання (<a href="ch8.xhtml#lev51"
        style="text-decoration: none;">Елемент 51</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Друга
      альтернатива, коли ви стикаєтесь з багатьма опціональними параметрами в
      конструкторі, є шаблон<span class="Apple-converted-space"> </span><em>JavaBeans</em>,
      коли ви викликаєте конструктор без параметрів для створення об'єкту, та
      потім викликати методи сеттери для встановлення кожного цікавого
      опціонального параметра:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Шаблон JavaBeans - дозволяє неузгодженість, нав'язує змінність</strong><br>
      public class NutritionFacts {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Parameters initialized to default values (if
      any)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int servingSize&nbsp;&nbsp;= -1; //
      Потрібне, немає значення по замовчанню;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int servings&nbsp;&nbsp;&nbsp;&nbsp; = -1;
      // Потрібне, немає значення по замовчанню;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int calories&nbsp;&nbsp;&nbsp;&nbsp; = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int
      fat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int
      sodium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int carbohydrate = 0;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts() { }<br>
      <span epub:type="pagebreak" id="page_12"></span>&nbsp;&nbsp;&nbsp;&nbsp;//
      Setters<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setServingSize(int val)&nbsp;&nbsp;{
      servingSize = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setServings(int val)&nbsp;&nbsp;&nbsp;
      { servings = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setCalories(int val)&nbsp;&nbsp;&nbsp;
      { calories = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setFat(int
      val)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ fat = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setSodium(int
      val)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ sodium = val; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void setCarbohydrate(int val) {
      carbohydrate = val; }<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Цей
      шаблон не має жодних недоліків шаблона телескопічного конструктора. Він
      простий, трохи балакучий при створенні примірників, та отриманний код
      просто читати:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NutritionFacts
      cocaCola = new NutritionFacts();<br>
      cocaCola.setServingSize(240);<br>
      cocaCola.setServings(8);<br>
      cocaCola.setCalories(100);<br>
      cocaCola.setSodium(35);<br>
      cocaCola.setCarbohydrate(27);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">На
      жаль, шаблон JavaBeans сам по собі має серйозні недоліки. Оскільки
      конструювання розбите на декілька викликів,&nbsp;<strong> JavaBean може
        бути в неузгодженому стані на протязі свого створення.</strong><span class="Apple-converted-space">
        Клас не має опцій для примусу узгодженості, просто через перевірку
        валідності параметрів конструктора. Спроба використовувати об'єкт коли
        він в неузгодженому стані може привести до відмов, що далеко відстоять
        від кода, що містить баг, і, таким чином, складно відстежується.
        Пов'язаний недолік полягає в тому, що </span><strong>шаблон JavaBeans
        заважає можливості створити незмінний клас</strong><span class="Apple-converted-space">
      </span>(<a href="ch4.xhtml#lev17" style="text-decoration: none;">Елемент
        17</a>), та потребує додаткових зусиль з боку програміста, щоб
      забезпечити поточну безпеку.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Можливо
      зменшити ці негаразди, вручну "заморозивши" об'єкт на час створення до
      завершення побудови, та заборонити його використання на час заморожування,
      але цей варіант рідко використовується на практиці. Більше того, він може
      спричинити помилки часу виконання, оскільки компілятор не може
      переконатись, що програміст викликає метод заморожування на об'єкті до
      того, як використовувати його.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">На
      щастя, існує третя альтернатива, що комбінує безпеку шаблону
      телескопічного конструктора з читаємістю шаблону JavaBeans. Це форма
      шаблону Білдера, <span class="Apple-converted-space"></span><em>Builder</em><span
        class="Apple-converted-space">&nbsp;</span>pattern [<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>]. Замість робити бажаний
      об'єкт напряму, клієнт викликає конструктор (або статичну фабрику) з усіма
      потрібними полями, та отримує об'єкт <em>білдера</em>. Поітм клієнт
      викликає сеттер-подібні методи на об'єкті білдера для встановлювання всіх
      опціональних параметрів. Нарешті, клієнт викликає метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">build</code><span class="Apple-converted-space">
        без параметрів, що генерує об'єкт, що типово є незмінним. Білдер типово
        є статичним класом членом </span>(<a href="ch4.xhtml#lev24" style="text-decoration: none;">Елемент
        24</a>) класу, який він будує. Ось як це виглядає на практиці:</p>
    <span epub:type="pagebreak" id="page_13" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Builder Pattern</strong><br>
      public class NutritionFacts {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int servings;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int calories;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int fat;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int sodium;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int carbohydrate;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static class Builder {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Обов'язкові параметри<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private final int
      servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private final int
      servings;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Опціональні параметри<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private int
      calories&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private int
      fat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private int
      sodium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private int
      carbohydrate&nbsp;&nbsp;= 0;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder(int
      servingSize, int servings) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servingSize
      = servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.servings&nbsp;&nbsp;&nbsp;&nbsp;=
      servings;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder
      calories(int val)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      calories = val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder fat(int
      val)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      fat = val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      return this; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder sodium(int
      val)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      sodium = val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this;
      }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder
      carbohydrate(int val)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      carbohydrate = val;&nbsp;&nbsp;return this; }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public NutritionFacts
      build() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      new NutritionFacts(this);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private NutritionFacts(Builder builder) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servingSize&nbsp;&nbsp;=
      builder.servingSize;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;servings&nbsp;&nbsp;&nbsp;&nbsp;
      = builder.servings;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;calories&nbsp;&nbsp;&nbsp;&nbsp;
      = builder.calories;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fat&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
      builder.fat;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sodium&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      = builder.sodium;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carbohydrate =
      builder.carbohydrate;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_14"></span>Клас <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">NutritionFacts</code><span
        class="Apple-converted-space"> є незмінним, та всі значення параметрів
        знаходяться в одному місці</span>. Метод сеттера повертає сам білдер,
      так що виклики можна сціпити в ланцюжок, що дає <span class="Apple-converted-space"></span><em>побіжний
        API</em>. Ось як виглядає код клієнта:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NutritionFacts
      cocaCola = new NutritionFacts.Builder(240, 8)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.calories(100).sodium(35).carbohydrate(27).build();</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Цей
      клієнтський код просто писати, та, що більш важливо, просто читати. <strong>Шаблон
        білдера симулює іменовані опціональні параметри</strong><span class="Apple-converted-space">,
        які існують в </span>Python та Scala.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Перевірки
      валідності випущені для скорочення. Щоб виявити невалідні параметри так
      скоро, як це можливо, перевіряйте валідність в конструкторі та методах
      білдерів. Перевіряйте інваріанти, включаючи декілька параметрів в
      конструкторі, що викликаєтсья в методі <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">build</code>. Щоб
      перевірити ці інваріанти проти атак, робіть перевірки полів об'єкта після
      копіювання параметрів з білдера (<a href="ch8.xhtml#lev50" style="text-decoration: none;">Елемент
        50</a>). Якщо перевірка схибить, викликайте <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">IllegalArgumentException</code>
      (<a href="ch10.xhtml#lev72" style="text-decoration: none;">Елемент 72</a>),
      чиє детальне повідомлення вказує, які параметри є невалідними (<a href="ch10.xhtml#lev75"
        style="text-decoration: none;">Елемент 75</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Шаблон
        білдера гарно пристосований до ієрархій класів.</strong><span class="Apple-converted-space">
      </span>Використовуйте паралельну ієрархію білдерів, кожний вкладений в
      відповідний клас. Абстрактні класи мають абстрактні білдери; суцільні
      класи мають суцільні білдери. Наприклад, розглянемо абстрактний клас в
      корені ієрархії, що представляє різні сорти піцци:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Шаблон білдерів для ієрархії класів</strong><br>
      public abstract class Pizza {<br>
      &nbsp;&nbsp;&nbsp;public enum Topping { HAM, MUSHROOM, ONION, PEPPER,
      SAUSAGE }<br>
      &nbsp;&nbsp;&nbsp;final Set&lt;Topping&gt; toppings;<br>
      <br>
      &nbsp;&nbsp;&nbsp;abstract static class<span class="Apple-converted-space">&nbsp;</span><strong>Builder&lt;T
        extends Builder&lt;T&gt;&gt;</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EnumSet&lt;Topping&gt; toppings =
      EnumSet.noneOf(Topping.class);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public T addTopping(Topping topping) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      toppings.add(Objects.requireNonNull(topping));<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span><strong>return
        self();</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abstract Pizza build();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>// Субкласи мають перекривати
        цей метод, щоб повертати "this"</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>protected abstract T self();</strong><br>
      &nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;Pizza(Builder&lt;?&gt; builder) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;toppings = builder.toppings.clone();
      // See Item&nbsp;&nbsp;50<br>
      &nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зауважте,
      що <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Pizza.Builder</code><span
        class="Apple-converted-space"> є</span><span class="Apple-converted-space">
        <em>дженерік типом з рекурсивним параметром типу </em></span>(<a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Елемент 30</a>). Це, разом з абстрактним
      методом <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">self</code>,
      дозволяє зціплення методів, для відповідної роботи в субкласах без потреби
      в кастингу. Це обхідний маневр для факту, що в Java бракує типу self, що
      відоме як <em>ідіома симульованого self-типу</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_15"></span>Ось два суцільних субкласи <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Pizza</code>,
      один з яких представляє стандартну пицу в стилі New-York, та інший
      кальцоне. Перший має обов'язковий параметр розміру, та другий дозволяє вам
      задати, чи соус має бути зсередини чи зовні:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class NyPizza extends Pizza {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public enum Size { SMALL, MEDIUM, LARGE }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Size size;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static class Builder extends
      Pizza.Builder&lt;Builder&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private final Size size;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder(Size size)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.size
      = Objects.requireNonNull(size);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public NyPizza
      build() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      new NyPizza(this);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override protected
      Builder self() { return this; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private NyPizza(Builder builder) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(builder);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size = builder.size;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }<br>
      <br>
      public class Calzone extends Pizza {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final boolean sauceInside;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static class Builder extends
      Pizza.Builder&lt;Builder&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;private boolean
      sauceInside = false; // Default<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public Builder
      sauceInside() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sauceInside
      = true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      this;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public Calzone
      build() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      new Calzone(this);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override protected
      Builder self() { return this; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Calzone(Builder builder) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(builder);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sauceInside =
      builder.sauceInside;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_16"></span>Зауважте, що метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">build</code><span class="Apple-converted-space">
        в білдері кожного субкласу декларований щоб повертати коректний субклас</span>:
      метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">build</code><span
        class="Apple-converted-space"> </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">NyPizza.Builder</code>
      повертає<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">NyPizza</code>,
      тоді як той самий в <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Calzone.Builder</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Calzone</code>.
      Цей прийом, коли метод субкласа декларований повертати субтип типу,
      повертаємого в супер-класі, відомий як <em>коваріантна типізація
        повернення</em>. Це дозволяє клієнтам використовувати ці білдери без
      потреби кастингу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Клієнтський
      код для ціх “ієрархічних білдерів” в основному іденичний до коду для
      простого білдера <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">NutritionFacts</code>.
      Приклад кода клієнта, показаний далі, вважає існування статичних enum
      констант:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">NyPizza
      pizza = new NyPizza.Builder(SMALL)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addTopping(SAUSAGE).addTopping(ONION).build();<br>
      Calzone calzone = new Calzone.Builder()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.addTopping(HAM).sauceInside().build();</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Мінорна
      перевага білдерів над конструкторами в тому, що білдери можуть мати багато
      множинних параметрів, оскільки кожний параметр вказаний у власному методі.
      Альтернативно, білдери можуть агрегувати параметри, передані в багатьох
      викликах в одне поле, як демонструється в методі <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">addTopping</code><span class="Apple-converted-space">
        раніше</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Шаблон
      Builder є досить гнучким. Єдиний білдер може використовуватись повторно
      для будування декількох об'єктів. Параметри білдера можуть бути
      налаштовані між викликами метода <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">build</code><span class="Apple-converted-space">,
        щоб варіювати створювані об'єкти</span>. Білдер може заповнювати деякі
      поля автоматично перед створенням об'єкту, такі як серійні номери, що
      збільшуються кожного разу, коли створюється об'єкт.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Шаблон
      Builder також має і недоліки. Щоб створити об'єкт ви маєте зпочатку
      створити білдер. Хоча ціна створення цього білдера навряд чи буде помітною
      на практиці, це може бути проблемою в критичних ситуаціях. Також шаблон
      Builder більш галасливий, ніж шаблон телескопічного конструктора, так що
      він має використовуватись тільки якщо досить параметрів, щоб воно було
      того варте - скажімо, чотири або більше. Але майте на увазі, що ви можете
      побажати додати параметрів в майбутньому. Але якщо ви починаєте з
      конструкторів або статичних фабрик, та перемикаєтесь на білдер, тоді клас
      розвівається до точки, де число параметрів виходить з під контролю, та
      застарілі конструктори або статичні фабрики будуть стирчати, як великий
      палець. Таким чином, часто краще почати з білдера в першу чергу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Підсумовуючи,
      <strong>шаблон білдера є гарним вибором при розробці класів, чиї
        конструктори або статичні фабрики можуть мати велику кількість
        параметрів</strong>, особливо якщо багато параметрів є опціональними або
      ідентичного типу. Код клієнта з білдерами стає значно простішим для
      читання та написання, ніж з телескопічними конструкторами, та білдери
      значно простіші, ніж JavaBeans.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_17"></span><strong>Елемент 3: Вимушений
        синглтон через приватний конструктор або тип enum</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        class="Apple-converted-space"></span><em>Синглтон є простий клас</em>,
      що має рівно один примірник [<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
      Синглтони типово представляють або об'єкт без стану, такий як функція (<a
        href="ch4.xhtml#lev24" style="text-decoration: none;">Елемент 24</a>),
      або системний компонент, що внутрішньо унікальний.<span class="Apple-converted-space">
      </span><strong>Перетворення класу на синглтон робить складним тестування
        тестування клієнтів</strong><span class="Apple-converted-space">,
        оскільки неможливо замінити мок-реалізацію для синглтона, тільки якщо
        він не реалізує інтерфейс, що служить як його тип</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існує
      два загальні шляхи реалізувати синглтони. Обоє базуються на утримання
      конструктора приватним, та експортування публічного статичного члена для
      доступа до єдиного примірника. В одному підході член є фінальним полем:</p>
    <br>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
      public class Elvis {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public static final Elvis INSTANCE = new
        Elvis();</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Elvis() { ... }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void leaveTheBuilding() { ... }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Приватний
      конструктор викликається тільки один раз, щоб ініціалізувати публічне
      статичне поле <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Elvis.INSTANCE</code>.
      Нестача публічного або захищеного конструктора <em>гарантує </em>“моноелвістичний”
      всесвіт: буде існувати рівно один примірник <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Elvis</code><span class="Apple-converted-space">
      </span>після ініціалізації класу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Elvis</code><span class="Apple-converted-space">
      </span>— не більше, не менше. Немає нічого, як клієнт може змінити це, з
      маленькою зачипкою: привілійований клієнт може викликати приватний
      конструктор через рефлексію (<a href="ch9.xhtml#lev65" style="text-decoration: none;">Елемент
        65</a>) за допомогою метода <code style="font-family: 'Courier New', monospace;">AccessibleObject.setAccessible</code>.
      Якщо ви потребуєте захисту від цієї атаки, модифікуйте консруктор, щоб він
      викликав виключення, якщо його просят викнати інший примірник.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      другому підході для релізації синглтонів публічний член є статичним
      методом-фабрикою:</p>
    <strong></strong><br>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
      public class Elvis {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private</strong><span class="Apple-converted-space">&nbsp;</span>static
      final Elvis INSTANCE = new Elvis();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Elvis() { ... }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public static Elvis getInstance()</strong><span
        class="Apple-converted-space">&nbsp;</span>{ return INSTANCE; }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void leaveTheBuilding() { ... }<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Всі
      виклики до <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Elvis.getInstance</code><span
        class="Apple-converted-space"> повертають те саме посилання на об'єкт,
        та ніколи не буде створене іншого примірника </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Elvis</code><span class="Apple-converted-space">
      </span>(з тим самим виключенням, наведеним вище).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Головна
      перевага підходу публічного поля в тому, що API робить зрозумілим, що клас
      є синглтоном: поле є статичне та фінальне, так що воно буде завжди містити
      те саме об'єктне посилання. Друга перевага в тому, що це простіше.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Одна
      перевага підходу статичної фабрики в тому, що це дає вам гнучкість змінити
      вашу думку щодо того, чи клас є синглтоном, без зміни його API.
      Метод-фабрика повертає єдиний примірник, але він може бути модифікований
      для повертання, скажімо, окремого примірника для кожного потоку, що
      викликає його. Друа перевага в тому, що ви можете написати <em>дженерік-фабрику
        синглтонів</em>, якщо ваше застосування потрубує цього (<a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Елемент 30</a>). Остаточна перевага від
      використання статичної фабрики в тому, що <em>в якості поставника може
        виступати посилання на метод</em>, наприклад<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Elvis::instance</code><span
        class="Apple-converted-space"> є</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Supplier&lt;Elvis&gt;</code>.
      За винятком коли одна з ціх переваг має місце, підхід публічного поля має
      перевагу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Щоб
      зробити клас синглона, що використовує кожний з ціх підходів <span class="Apple-converted-space"></span><em>серіалізуємим</em><span
        class="Apple-converted-space"> </span>(<a href="ch12.xhtml#ch12" style="text-decoration: none;">Глава
        12</a>), недостатньо просто додати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">implements Serializable</code><span
        class="Apple-converted-space"> до його декларації</span>. Щоб
      обслуговувати гарантованість синглтона, декларуйте всі поля примірника <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">transient</code><span
        class="Apple-converted-space">, та провадьте метод</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">readResolve</code><span
        class="Apple-converted-space"> </span>(<a href="ch12.xhtml#lev89" style="text-decoration: none;">Елемент
        89</a>). Інакше кожного разу, коли ви десеріалізуєте прмірник буде
      створюватись новий приірник, приводячи, в разі нашого випадку, до
      виникнення підробних <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Elvis</code>.
      Щоб запобігти цьому, додайте метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">readResolve</code><span class="Apple-converted-space">
        до класу</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Elvis</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>
    </p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
метод
        readResolve для збереження властивості синглтону</strong><br>
      private Object readResolve() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp; // Повернути одного справжнього Elvis, та
      дозволити збирачу сміття<br>
      &nbsp;&nbsp;&nbsp;&nbsp; // потурбуватись про копіювача Elvis.<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return INSTANCE;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Третій
      шлях реалізувати синглтон є декларувати одно-елементний enum:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>
    </p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Enum синглтон - переважний підхід</strong><br>
      public enum Elvis {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;INSTANCE;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void leaveTheBuilding() { ... }<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Цей
      підхід подібний до підхід публічного поля, але він більш стислий,
      безкоштовно провадить механізм серіалізації, та провадить залізну гарантію
      проти множинних примірників, навіть під тиском вишуканих атак серіалізації
      або рефлексії. Цей підхід може виглядати дещо неприродним, але <span class="Apple-converted-space"></span><strong>одноелементний
        тип enum часто є кращим шляхом реалізувати синглтон</strong>. Зауважте,
      що ви не можете використовувати цей підхід, якщо ваш синглтом має
      розширяти суперклас, інший, ніж<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">Enum</code><span class="Apple-converted-space">&nbsp;</span>(хоча
      ви <em>можете </em>декларувати enum для реалізації інтерфейсів).</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_19"></span><strong>Елемент 4: Заборона
        створення примірників за допомогою приватного конструктора<br>
      </strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Часом
      ви бажаєте написати клас, що є тільки угрупуванням статичних методів та
      статичних полів. Такі класи отримали погану репутацію, оскільки деякі люди
      шкодять їм уникнути мислення в термінах об'єктів, але вони мають валідні
      застосування. Вони можуть використовуватись для групування пов'язаних
      методів, в стилі <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">java.lang.Math</code><span
        class="Apple-converted-space"> або</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">java.util.Arrays</code>.
      Вони також можуть бути використані для групування статичних методів,
      включаючи фабрики (<a href="ch2.xhtml#lev1" style="text-decoration: none;">Елемент
        1</a>), для об'єктів, що реалізують деякий інтерфейс, в манері <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">java.util.Collections</code>.
      З Java 8 ви також можете покласти такі методи <em>в </em>інтерфейс,
      вважаючи, що він ваш для роблення змін. Нарешті такі класи можуть
      використовуватись для групування методів на фінальному класі, оскільки ви
      не можете покласти їх в субклас.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Такі
      <em>допоміжні класи </em>не були розроблені для створення примірників:
      примірник не мав би сенсу. Однак за відсутності явних конструкторів,
      компілятор провадить власний, публічний <em>конструктор по замовчанню без
        параметрів</em>. Для користувача цей конструктор не відрізняється від
      кожного іншого. Не є рідкістю побачити ненавмисне відкриті через це класи
      в публічних API.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Спроба
        примусити до заборони створення примірників, через об'явлення класу
        абстрактним, не працює.</strong><span class="Apple-converted-space"> Цей
        клас може мати субкласи, та субкласи можуть мати примірники</span>.
      Більше того, це заплутує користувача, і він починає думати, що клас був
      створений для наслідування (<a href="ch4.xhtml#lev19" style="text-decoration: none;">Елемент
        19</a>). Існує, однак, проста ідіома, щоб гарантувати нестворення
      примірників.&nbsp; Конструктор по замовчанню генерується тільки якщо клас
      не має явних конструкторів, так що <span class="Apple-converted-space"></span><strong>клас
        можна зробити напридатним до створення примірників, якщо створити
        приватний конструктор</strong>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Клас,
        що не матиме екземплярів</strong><br>
      public class UtilityClass {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// Подавляємо констрктор по замовчанню</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;private UtilityClass() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      AssertionError();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Оскількі
      явний конструктор є приватним, він недоступний за межами класу. <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">AssertionError</code><span
        class="Apple-converted-space"> не є суто необхідним</span>, але це
      провадить гарантію в випадку, коли конструктор випадково викликається
      зсередини самого класу. Це гарантує, що клас не буде створювати примірники
      ні за яких умов. Ця ідіома дещо контр-інтуітивна, оскільки конструктор
      провадиться таким чином, що він не може бути викликаний. Так що буде
      розумним додати коментар, як показано раніше.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Як
      побічний ефект, як ідіома також запобігає від створення субкласі цього
      класу. Всі конструктори мають викликати конструктор суперкласа, явно або
      неявно, але субклас не матиме доступного конструктора суперкласу, який
      можна визвати.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_20"></span><strong>Елемент 5: Схиляйтесь
        до ін'єкції замість жорсткого зв'язку ресурсів</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Багато
      класів залежать від одного або більше підлеглих ресурсів. Наприклад,
      перевірка правопису залежить від словника. Не є загальним бачити такі
      класи реалізованими як статичні класи-утіліти (<a href="ch2.xhtml#lev4" style="text-decoration: none;">Елемент
        4</a>):</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Невідповідне
        використання статичних утіліт - негнучко &amp; нетестовно!</strong><br>
      public class SpellChecker {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final Lexicon dictionary = ...;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private SpellChecker() {} // Noninstantiable<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static boolean isValid(String word) { ... }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static List&lt;String&gt;
      suggestions(String typo) { ... }<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Подібним
      чином, не рідкість побачити їх реалізованими як синглтони (<a href="ch2.xhtml#lev3"
        style="text-decoration: none;">Елемент 3</a>):</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Невідповідне застосування синглтона - негнучко &amp; нетестовно!</strong><br>
      public class SpellChecker {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Lexicon dictionary = ...;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private SpellChecker(...) {}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static INSTANCE = new SpellChecker(...);<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean isValid(String word) { ... }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public List&lt;String&gt; suggestions(String typo)
      { ... }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Жодний
      з ціх підходів не є задовільним, оскільки вони передбачають, що існує
      тільки один словник, гідний використання. На практиці кожна мова має свій
      власний словник, та для спеціальних вокабулярів використовуються різні
      словники. Також може бути бажаним використовувати спеціальний словник для
      тестування. Це дуже сміливе припущення, що одного словника буде достатньо
      на всі часи.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ви
      можете спробувати змусити<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">SpellChecker</code><span
        class="Apple-converted-space"> підтримувати декілька словників, що
        робить поле </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">dictionary</code><span
        class="Apple-converted-space"> не-фінальним, та потребує додавання
        метода для зміни словника в існуючій перевірці, але це може бути
        резграбним, схильним до помилок, </span>та нездатне робити в
      конкурентному середовищі.<span class="Apple-converted-space"> </span><strong>Статичні
        класи-утіліти та синглтони невідоповідні для класів, чия поведінка
        параметризована підлеглим ресурсом.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Що
      потрібне - це можливість підтримувати декілька примірників класу (в нашому
      прикладі <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">SpellChecker</code>),
кожний
      з яких використовує використовує ресурс, який обирає клієнт (в нашому
      випадку - словник). Простий шаблон, що задовільняє цій вимозі, є <span class="Apple-converted-space"></span><strong>передання
        ресурсів в конструктор при ствренні нового примірника</strong>. Це одна
      з форм <em>ін'єкції залежностей</em>: словник є <em>залежністю </em>для
      перевірки правопису, та <em>ін'єктується (вставляється) </em>в правопис,
      коли той створюється.</p>
    <span epub:type="pagebreak" id="page_21" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Ін'єкція залежностей провадить гнучкість та тестованість</strong><br>
      public class SpellChecker {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Lexicon dictionary;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public SpellChecker(Lexicon dictionary)</strong><span
        class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.dictionary =
      Objects.requireNonNull(dictionary);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean isValid(String word) { ... }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public List&lt;String&gt; suggestions(String typo)
      { ... }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>
    </p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Шаблон
      ін'єкції залежностей такий простий, що багато програмістів використовує
      його протягом років, не знаючи, що він має ім'я. Доки наша перевірка
      правопису має тільки одни русурс (словник), ін'єкція залежностей робить з
      довільним числом ресурсів, та довільними графами залежностей. Він зберігає
      незмінність (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Елемент
        17</a>), так що декілька клієнтів можуть поділяти залежні&nbsp; об'єкти
      (вважаючи, що клієнти запрошують ті самі ресурси). Ін'єкція залежнсотей
      рівно застосовується для конструкторів, статичних фабрик (<a href="ch2.xhtml#lev1"
        style="text-decoration: none;">Елемент 1</a>), та білдерів (<a href="ch2.xhtml#lev2"
        style="text-decoration: none;">Елемент 2</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Корисний
      варіант шаблону є передати конструктору <em>фабрику </em>ресурсів.
      Фабрика є об'єкт, що може використовуватись неодноразово для створення
      примірників певного типу. Такі фабрики втілюють шаблон <em>Метода фабрики
      </em>[<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].
Інтерфейс
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Supplier&lt;T&gt;</code><span
        class="Apple-converted-space">, введений в </span>Java 8, є ідеальним
      для створення фабрик. Методи, що приймають<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Supplier&lt;T&gt;</code><span
        class="Apple-converted-space"> на вході повинен типово обмежити параметр
        типу фабрики, використовуючи <em>обмежений тип з зірочкою</em></span><span
        class="Apple-converted-space"> </span>(<a href="ch5.xhtml#lev31" style="text-decoration: none;">Елемент
        31</a>), щоб озволити клієнту передати в фабрику, що створює любий
      субтип певного типу. Наприклад, ось метод, що створює мозайку,
      використовуючи проваджену клієнтом фабрику для створення кожної плитки:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Mosaic
      create(Supplier&lt;? extends Tile&gt; tileFactory) { ... }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      ін'єкція залежностей гарно покращує гнучкість та тестованість, буде
      ускладнювати великі проекти, що типово містять тисячі залежностей. Цей
      безлад можна усунути, використовуючи <em>фреймворк ін'єкуції залежностей</em>,
      такого, як Dagger [<a href="ref.xhtml#rDagger" style="text-decoration: none;">Dagger</a>],
      Guice [<a href="ref.xhtml#rGuice" style="text-decoration: none;">Guice</a>],
      або Spring [<a href="ref.xhtml#rSpring" style="text-decoration: none;">Spring</a>].
      Використання ціх фреймворків за межами розгляду цієї книги, але зауважте,
      що API, розроблені для ручної ін'єкції тривіально адаптовані для
      використання в ціх фреймворках.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      підсумку, не використовуйте синглтон або статичний клас-утиліту для
      реалізації класу, що залежить від одного або більше ресурсів, чия
      поведінка впливає на клас, та не змушувати клас створювати ці ресурси
      самотуж. Замість цього передайте ресурси, або фабрики для їх створення, в
      конструктор (або статичну фабрику, або білдер). Ця практика, відома як
      ін'єкція залежностей, буде гарно розширювати гнучкість, повторне
      використання та тестованість класу.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_22"></span><strong>Елемент 6: Уникайте
        створення непотрібних об'єктів</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Часто
      краще повторно використати єдиний об'єкт, замість створення нового,
      фукнціонально еквіалентного об'єкта, кожного разу, коли це треба. Повторне
      викоирстання може бути обоє, більш швидке та додавата стилю. Об'єкт завжди
      може бути повторно використаний, якщо він незмінний (<a href="ch4.xhtml#lev17"
        style="text-decoration: none;">Елемент 17</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      якості екстремального приклада того, що не треба робити, розглянемо таке
      твердження:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">String
      s = new String("bikini");&nbsp;&nbsp;<strong>// НЕ РОБІТЬ ЦЬОГО!</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      твердження створює новий примірник <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">
      </span>кожного разу, коли виконується, та жодне з ціх створень не є
      необхідним. Аргумент конструктора <code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space"> </span>(<code style="font-family: 'Courier New', monospace;">"bikini"</code>)
      є сам по собі примірником <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">String</code>,
      функціонально ідентичним до всіх об'єктів, створених конструктором. Якщо
      це використання трапляється в циклі, або в часто використованому методі,
      мільйони примірників <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space"> можуть бути створені без жодних потреб</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Покращена
      версія виглядає просто:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">String
      s = "bikini";</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      версія використовує один примірник <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">String</code>, ніж
      створювати новий примірник кожного разу при виконанні. Більше того, це
      гарантує, що об'єт буде використовуватись повторно, коли будь-який код
      буде виконуватись на тій самій віртуальній машині, що буде задіяти той
      самий літерал рядка [JLS, 3.10.5].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Часто
      ви можете уникнути створення небажених об'єктів, через використання <span
        class="Apple-converted-space"></span><em>статичних методів-фабрик</em><span
        class="Apple-converted-space"> </span>(<a href="ch2.xhtml#lev1" style="text-decoration: none;">Елемент
        1</a>) замість конструкторів або незмінних класів, що провадять обоє.
      Наприклад, метод-фабрика <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Boolean.valueOf(String)</code><span
        class="Apple-converted-space"> більш бажаний, ніж конструктор </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Boolean(String)</code>,
      що був відмінений в Java 9. Констуктор <em>має </em>створювати новий
      об'єкт кожного разу, коли він викликається, тоді як метод-фабрика ніколи
      не змушений робити це, і не робить це на практиці. На додаток до повторно
      використання назмінних об'єктів, ви також можете повторно використовувати
      змінні об'єкти, якщо ви знаєте, що вони не були модифіковані.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Деякі
      створення об'єктів значно більш коштовні, ніж інші. Якщо ви маєте намір
      постійно створювати такі “коштовні об'єкти”, можна порадити кешувти їх для
      подальшого використання. Нажаль, не завжди очевидно, коли ви створюєте
      такий об'єкт. Уявімо, ви бажаєте написати метод для визначення, чи є рядок
      валідним числом в римській нотацїі. Найпростіше зробити це за допомогою
      регулярного виразу:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Продуктивність
        можна гарно покращити!</strong><br>
      static boolean isRomanNumeral(String s) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return s.matches("^(?=.)M*(C[MD]|D?C{0,3})"<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+
      "(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$");<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_23"></span>Проблема з цією реалізацією в
      тому, що вона покладається на метод<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">String.matches</code>.<span
        class="Apple-converted-space"> </span><strong>Хоча</strong><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>String.matches</strong></code><span
        class="Apple-converted-space"> </span><strong>є найпростішим шляхом
        перевірити, чи рядок співпадає з регулярним виразом, це не підходить до
        частого використання в критичних по швидкості ситуаціях.</strong><span class="Apple-converted-space">
        Проблема в тому, що це зпочатку створює примірник </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Pattern</code><span class="Apple-converted-space">
        для регулярного виразу, та використовує його тільки один раз, після чого
        він стає матеріалом для збірника сміття. Створення примірника </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Pattern</code><span
        class="Apple-converted-space"> коштовне, бо воно потребує компіляції
        регулярного виразу в машину кінечних станів</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Щоб
      покращити продуктивність явно компілюйте регулярний вираз в
      примірник&nbsp;<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Pattern</code>
      (що буде незмінним) як частина ініціалізації класу, кешуйте його, та
      повторно використовуйте той самий примірник для кожного виклику методу<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">isRomanNumeral</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Повторне використання коштовного об'єкту для покращення ефективності</strong><br>
      public class RomanNumerals {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final Pattern ROMAN =
      Pattern.compile(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"^(?=.)M*(C[MD]|D?C{0,3})"<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+
      "(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$");<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;static boolean isRomanNumeral(String s) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      ROMAN.matcher(s).matches();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Покращена
      версія <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">isRomanNumeral</code><span
        class="Apple-converted-space"> провадить значний додаток ефективності,
        якщо викликаєтсья часто</span>. На моїй машині оригінальна версія триває
      1.1 µs на 8-симольному рядку, тоді як покращена версія триває 0.17 µs, що
      в 6.5 разів швидше. Це впливає не тільки на швидкість, але також і на
      ясність. Роблячи статичне фінальне поле для інакше невидимого&nbsp;
      примірника <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Pattern</code><span
        class="Apple-converted-space"> </span>дозволяє нам надать йому ім'я, що
      більш зрозуміло, ніж самий регулярний вираз.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      клас, що містить покращену версію методу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">isRomanNumeral</code><span
        class="Apple-converted-space"> ініціалізований, але метод ніколи не
        викликається, поле </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">ROMAN</code><span class="Apple-converted-space">
        буде ініціалізоване без потреби</span>. Можливо уникнути ініціалізації
      через <em>ліниву ініціалізацію </em>поля (<a href="ch11.xhtml#lev83" style="text-decoration: none;">Елемент
        83</a>), коли <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">isRomanNumeral</code>m
      викликається перший раз, але це <em>не </em>рекомендовано. Як це часто
      буває з лінивою ініціалізацією, це може ускладнити ініціалізацію з
      невимирним покращенням продуктивності (<a href="ch9.xhtml#lev67" style="text-decoration: none;">Елемент
        67</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      об'єкт незмінний, є очевидним, що його можна безпечно використовувати
      повторно, але є ситуації, коли не все таке очевидно, та навіть
      контр-інтуітивно. Розглянемо випадок <em>адаптерів</em><span class="Apple-converted-space">
      </span>[<a href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>]<em>,</em><span
        class="Apple-converted-space"> також відомі як </span><span class="Apple-converted-space"></span><em>перегляди
        (вью)</em>. Адаптер є об'єктом, що делегує підлеглий об'єкт підтримки,
      провадячи альтернативний інтерфейс. Оскільки адаптер не має стану за
      межами свого зворотнього об'єкту, немає потреби створювати більше ніж один
      примірник даного адаптера до даного об'єкта.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_24"></span>Наприклад, метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">keySet</code><span class="Apple-converted-space">
        інтерфейсу</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Map</code><span
        class="Apple-converted-space"> повертає перегляд </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">
        об'єкту</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Map</code>,
      що складається з усіх ключів мапи. Мислячі наївно, може здатись, що кожний
      виклик до <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">keySet</code><span
        class="Apple-converted-space"> має створювати новий примірник </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Set</code>,
      але кожний виклик до <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">keySet</code><span
        class="Apple-converted-space"> на певному об'єкті </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">
        може повертати той самий примірник </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Set</code>. Хоча
      отриманий примірник <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Set</code><span
        class="Apple-converted-space"> типово є змінним</span>, всі повернуті
      об'єкти функціонально ідентичні: коли один з повернутих об'єктів
      змінюється, те саме відбувається з іншими, бо всі вони базуються на тому
      самому примірнику <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Map</code>.
      Доки це досить безболічне створювати декілька примірників об'єкта <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">keySet</code>, це не є
      нобхідним, та не надає переваг.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Інший
      шлях створити непотрібрі об'єкти є <em>автобоксинг</em>, що дозволяє
      програмісту міксувати примітивні типи, атоматично боксуючи та розбоксуючи
      по мірі необхідності.<span class="Apple-converted-space"> </span><strong>Автобоксування
        розмиває, але не зтирає різницю між примітивними та боксованими
        примітвними типами. </strong>Існує тонке симантичне розбіжжя, та
      не-таке-незначне розбіжжя в продуктивності (<a href="ch9.xhtml#lev61" style="text-decoration: none;">Елемент
        61</a>). Розглянемо наступний метод, що обчислює суму всіх позитивних
      значень <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">int</code>.
      Щоб зробити це, програма має використовувати арифметику <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">long</code><span class="Apple-converted-space"></span>,
      оскільки <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space"> </span>не достатньо великий, щоб
      підсумувати всі додатні значення <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">int</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Приховано повільно! Чи ви помітили створення об'єктів?</strong><br>
      private static long sum() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Long sum = 0L;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (long i = 0; i &lt;= Integer.MAX_VALUE; i++)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sum += i;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;return sum;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      програма дає вірний результат, але він <em>значно </em>повільніший, ніж
      повинен бути, через помилку в один символ. Змінна <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">sum</code><span class="Apple-converted-space">
      </span>декларована як <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Long</code><span
        class="Apple-converted-space"> замість</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">long</code>,
      що означає, що програма спожиє до 2<sup>31</sup><span class="Apple-converted-space">
        непотрібних примірників</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">Long</code> (рівно один
      раз, коли <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">long
        i</code><span class="Apple-converted-space"> додається до </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Long
        sum</code>). Зміна декларації <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">sum</code><span class="Apple-converted-space">
        з</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Long</code><span
        class="Apple-converted-space"> на</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">long</code><span
        class="Apple-converted-space"> зменшує час виконання з</span> 6.3 секунд
      до 0.59 секунд на моїй машині. Урок ясний:<span class="Apple-converted-space">
      </span><strong>схиляйтесь до примітивів замість боксованих примітивів, та
        начувайтесь щодо ненамисного аутобоксигу.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      не має бути невірно розтлумачене, що створення об'єктів коштовне, та його
      треба уникати. Навпаки, створення та повернення малих об'єктів, чиї
      конструктори роблять небагато зайвої роботи, є дешевим, особливо на
      сучасних реалізаціях JVM. Створення додаткових об'єктів поширює ясність,
      спрощення або потужність програми, і загалом є гарною річчю.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Навпаки,
      уникнення стовення об'єктів та підтримка власного <em>пулу об'єктів </em>є
      поганою ідеєю, за виключенням випадку, коли об'єкти в пулі є виключно
      важковаговими. Класичний приклад об'єкту, що <em>не задовільняє вимогам </em>пулу
      об'єктів,&nbsp; є з'єднання з базою даних. Вартість встановлення з'єднання
      досить висока, що робить нагальним сенс повторного використання таких
      об'єктів. Однак, кажучи взагалі, підтримка власного пулу об'єктів
      захаращує ваш код, збільшує використання пам'яті, та впливає на
      продуктивність. Сучасні реалізації JVM мають вкрай оптимізований збирач
      сміття, що легко перевершить такі пули для легковажних об'єктів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Контраргумент
      цього є <span class="Apple-converted-space"></span><a href="ch8.xhtml#lev50"
        style="text-decoration: none;">Елемент 50</a><span class="Apple-converted-space">
        щодо</span><span class="Apple-converted-space"> </span><em>захисного
        копіювання</em>. Цей елемент каже “Не створюйте новий елемент, коли вам
      слідує повторно використати існуючий”, тоді як<span class="Apple-converted-space">
      </span><a href="ch8.xhtml#lev50" style="text-decoration: none;">Елемент 50</a><span
        class="Apple-converted-space"> каже</span>, “Не використовуйте існуючий
      об'єкт, коли вам треба створити новий”. Зауважте, що коштовність
      використання об'єкта при використанні захисного копіювання значно більша,
      ніж вартість непотрібного створення дублікуючого об'єкта. Невміле
      створення захисних копій в разі потреби може призвести до невичерпних
      багів та дірок безпеки, коли створення об'єктів без потреби лише впливає
      на стиль та продуктивність.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_26"></span><strong>Елемент 7: Уникайте
        застарілих посиланть на об'єкти</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      ви перемикнулись з мови з ручним керуванням пам'яттю, як C або C++, на
      мову зі збором сміття, як Java, ваша робота як програміста стала значно
      простішою через факт, що ваші об'єкти автоматично видаляються, коли ви
      покінчили робити з ними. Це виглядає як магія, коли ви вперше маєте цей
      досвід. Це може просто призвести до думки, що вам не треба думати про
      керування пам'яттю, але це не зовсім так.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Розглянемо
      наступну просту реалізацію стека:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Чи ви помітили витік пам'яті?</strong><br>
      public class Stack {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Object[] elements;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int size = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int DEFAULT_INITIAL_CAPACITY
      = 16;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements = new
      Object[DEFAULT_INITIAL_CAPACITY];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(Object e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensureCapacity();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size++] = e;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Object pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;/**<br>
      &nbsp;&nbsp;&nbsp;&nbsp; * Впевняємось в місці щонайменш до одного
      елементу<br>
      &nbsp;&nbsp;&nbsp;&nbsp; * Подвоюємо розмір масиву в разі необхіднсоті.<br>
      &nbsp;&nbsp;&nbsp;&nbsp; */<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private void ensureCapacity() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (elements.length ==
      size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements
      = Arrays.copyOf(elements, 2 * size + 1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Немає
      нічого очевидно помилкового в цій програмі (але дивіться<span class="Apple-converted-space">
      </span><a href="ch5.xhtml#lev29" style="text-decoration: none;">Елемент 29</a><span
        class="Apple-converted-space"> </span>для узагальненої версії). Ви
      можете всебічно протестувати її, та вона пройде всі тести під переможними
      кольорами, але проблема причаїлась всередині. Просто кажучи, програма має
      витік пам'яті, що може тихо проявити себе через знижену продуктивність,
      через підвищення активності збирача сміття, або через надлишкове
      використання пам'яті. В екстремальних випадках, такі витоки пам'яті можуть
      викликати підкачку сторінок з диску, та навіть збій програми з <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">OutOfMemoryError</code>,
      але такі відмови вкрай рідкі.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Так
      де тут витік пам'яті? Якщо стек зростає, та потіс зменшуєтсья, об'єкти, що
      були виштовнені зі стеку не будуть зібрані колектором, навіть якщо
      програма, що використовує стек, не матиме більше посилань на них. Це тому,
      що стек утримує <em>застарілі посиланя </em>на ці об'єкти. Застарілі
      посилання це просто такі посилання, що більше ніколи не будуть
      розіменовані. В цьому випадку, всі посилання за межами "активного
      фрагменту" масива елементів є втраченими. Активна частина складається з
      елементів, чий індекс менший за розмір<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">size</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Витоки
      пам'яті в мовах зі збіркою сміття (більш точно відомі як <span class="Apple-converted-space"></span><em>ненавмисне
        збереження об'єктів</em>) дуже підступні. Якщо посилання на об'єкт
      випадково зберігається, не тільки цей об'єкт виключається зі збору сміття,
      але також і всі об'єкти, що посилаються на цей об'єкт, і так далі. Навіть
      якщо ненавмисне зберігаються тільки декілька посилань, багато, багато
      об'єктів можуть виключитись з процесу збору сміття, з потенційним великим
      впливом на продуктивність.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Полагодження
      цього різновиду пробелм просте: зануляйте посилання, коли вони вже не
      використовуються. В випадку нашого класу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Stack</code>, посилання
      на елемент стає непотрібнм як тільки цей об'єкт видаляється зі стеку.
      Скорегована версія метода <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">pop</code><span class="Apple-converted-space">
        виглядає таким чином</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      Object pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Object result = elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>elements[size] = null; // Видаляємо
        застарілі посилання</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Додаткова
      вигода від занулювання посилань в тому, що якщо вони помилково будуть
      використані, програма терміново завершиться з <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">NullPointerException</code>,
      замість того, щоб тихо робити погані речі. Завжди краще визначати помилки
      програми так швидко, як це можливо.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Коли
      програмісти перший раз обпіклися на цій проблемі, вони почали старанно
      компенсувати недоліки, зануляючи кожне об'єктне посилання, як тільки
      програма переставала використовувати його. Це ані потрібно, ані бажано; це
      захаращує програму без потреби.<span class="Apple-converted-space"> </span><strong>Занулення
        об'єктних посилань має бути виключенням, скоріше, ніж нормою.</strong><span
        class="Apple-converted-space"> </span>Кращий шлях уникнути зайвих
      посилань, це дозволити змінній, що містить посилання, вийти з області
      огляду. Це відбувається природно, якщо ви визначаєте кожну змінну в самому
      обмеженому колі (<a href="ch9.xhtml#lev57" style="text-decoration: none;">Елемент
        57</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_28"></span>Так коли ви маєте зануляти
      посилання? Який аспект класу<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">
      </span>дає підозру щодо витоку пам'яті? Просто кажучі, він <span class="Apple-converted-space"></span><em>керує
        своєю власною памят'ю</em>. <em>Пул сховища </em>складається з
      елементів масиву <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">elements</code><span
        class="Apple-converted-space"> </span>(клітини об'єктних посилань, не
      самі об'єкти). Елементи в активній частині масиву (як визначено вище) <span
        class="Apple-converted-space"></span><em>розміщені</em>, та інші в
      залишку масива <em>вільні</em>. Збирач сміття не може знати цього; для
      збирача сміття всі об'єктні посилання в масиві<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">elements</code><span
        class="Apple-converted-space"> однаково гарні</span>. Тільки програміст
      знає, що нактивна частина масиву не має значення. Програміст ефективно
      комунікує цей факт збирачу сміття, обнуляючи елементи масиву, як тільки
      вони стають частиною неактивної частини.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Кажучи
      загалом, <span class="Apple-converted-space"></span><strong>коли клас
        керує своєю власною пам'ятю, програміст має начуватись щодо витоку
        пам'яті</strong>. Коли елемент вивільнюється, об'єктні посилання, що
      зберігається в елементі, повинні бути занульовані.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Інше
        загальне джерело витоків пам'яті є кеші.</strong><span class="Apple-converted-space">
        Коли ви покладаєте об'єктне посилання в кеш, легко забути що воно там,
        та залишити його в кеші довше, ніж воно залишатиметься релевантним.
        Існує декілька рішень цієї проблеми. Якщо ви досить щасливі реалізувати
        кеш, для якого входження релевантні рівно стільки, доки існують
        посилання на ключ за межами кешу, представляйте кеш як </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">WeakHashMap</code>;
      входження будуть видалені після того, як вони вийдуть з ужитку.
      Пам'ятайте, що <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">WeakHashMap</code><span
        class="Apple-converted-space"> корисний тільки якщо бажаний час життя
        елементів кешу визначається зовнішніми посиланями на ключ, не на
        значення</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Більш
      загально, корисний час життя входження кешу менш гарно визначений, коли
      входження стають менш значущими з часом. За таких умов кеш повинен часом
      очищуватись від входжень, що вийшли з ужитку. Це можна зробити в фоновому
      потоці&nbsp; (можливо в<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">ScheduledThreadPoolExecutor</code>),
      або як побічний ефект додавання нових елементів в кеш. Клас<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">LinkedHashMap</code><span
        class="Apple-converted-space"> спрощує останній підхід за допомогою
        методу </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">removeEldestEntry</code>.
      Для більш складних кешів вам може знадобитись використовувати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">java.lang.ref</code><span
        class="Apple-converted-space"> напряму</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Третє
        загальне джерело витоків пам'яті є слухачі та інші зворотні виклики.</strong><span
        class="Apple-converted-space"> Якщо ви реалізуєте </span>API, де
      клієнти реєструють зворотні вклики, але не відреєстроюють їх в явній
      формі, вони будуть накопичуватись, якщо ви не приймете певних дій. Один
      шлях переконатись, що зворотні виклики збираються в смітник, є зберігання
      тільки <em>слабких посилань </em>на них, наприклад, зберігати їх як
      ключі в <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">WeakHashMap</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Оскільки
      витоки пам'яті не заявляють про себе як очевидні збої, вони можуть
      залишатись присутніми в системі на протязі років. Вони типово знаходяться
      тільки як результат прискіпливої інспекції коду, або за допомогою
      інструменту налаштування, відомому як <em>профайлер кіпи. </em>Таким
      чином дуже бажано навчатись протистояти проблемам, як ці, перед тим, як
      вони з'являться, та запобігати їх траплянню.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Елемент
        8: Уникайте фіналайзерів та очищувачів</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong><span
          style="color: #0000ee;"></span>Фіналайзери непередбачувані, часто
        небезпечні, та загалом непотрібні.</strong><span class="Apple-converted-space">
      </span>Їх використання може спричинити помилкову поведінку, погану
      продуктивність та проблеми портабельності. Фіналайзери мають декілька
      валідних використань, які ми покажемо пізніше, але як правило ви повинні
      уникати їх. В Java 9 фіналайзери були відкинуті, але вони все ще
      використовуються в Java бібліотеках. На заміну фіналайзерів в Java 9
      з'явились <em>очищувачі</em>.<span class="Apple-converted-space"> </span><strong>Очищувачі
        менш небезпечні, ніж фіналайзери, але все ще непередбачувані, повільні,
        та загалом непотрібні.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Програмісти
      C++ попереджаються, що про фіналайзери або очищувачі не слід думати, як
      про Java аналог деструкторів C++. В C++ деструктори є звичайним шляхом
      повернути ресурси, асоційовані&nbsp; з об'єктом, необхідне доповнення до
      конструкторів. В Java збирач сміття повертає місце, асоційоване з
      об'єктом, коли він стає недосяжним, не потребуючи додаткових зусиль з боку
      програміста. Деструктори C++ також використовуються для повернення інших
      ресурсів, крім пам'яті. В Java для ціх цілей використовуються блоки<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">try</code>-with-resources
      або<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">try</code>-<code
        style="font-family: 'Courier New', monospace;">finally</code> (<a href="ch2.xhtml#lev9"
        style="text-decoration: none;">Елемент 9</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Одна
      з вад фіналайзерів та очищувачів полягає в тому, що немає гарантії, що
      вони будуть виконані в передбачуваній перспективі [JLS, 12.6]. Може пройти
      довільнй час між моментом, коли об'єкт стає недосяжним, та часом, коли
      буде виконано фіналайзер або очищувач. Це означає, що вам <span class="Apple-converted-space"></span><strong>ніколи
        не слід робити нічого час-критичного в фіналайзері та очищувачах.</strong><span
        class="Apple-converted-space"> Наприклад, це смертельна помилка -
        розраховувати </span>на фіналайзер або очищувач для закриття файлів,
      оскільки дескриптори відкритих файлів є обмеженим ресурсом. Якщо багато
      файлів залишити відкритими, як результат системної затримки виконання
      фіналайзерів та очищувачів, програма може схибити, оскільки вона не зможе
      відкривати нові файли.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Передбачуваність,
      з якою виконуються фіналайзери та очищувачі, в основному є функцією
      алгоритму збирача сміття, що варіює в широких межах між реалізаціями.
      Поведінка програми, що залежить від передбачуваності фіналайзера або
      очищувача, також може варіюватись. Цілком можливо, що така програма буде
      робити чудово на JVM, на якій ви тестували, та потім жалюгідно схибити на
      тій, яку вподобав ваш найбільш важливий клієнт.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Затримка
      фіналізації не є тільки теоретичною проблемою. Провадження фіналайзера для
      класа може довільно затримати прибирання ресурсів. Колега налаштовував
      довготривале GUI застосування, що містично гинуло з <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">OutOfMemoryError</code>.
      Аналіз виявив, що під час краху застосування мало тисячі графічних
      об'єктів в черзі фіналізації, що просто чекали фіналізації та прибирання.
      Нажаль, потік фіналізатора робив з низьким преоритетом, порівняно з іншим
      потоком застосування, так що об'єкти не були фіналізованими зі швидкістю,
      з якою вони надходили до фіналізації. Специфікація мови не дає гарантій
      щодо того, який потік буде виконувати фіналізацію, так що немає
      портабельного шляху запобігти цьому різновиду проблем, крім того, щоб
      взагалі утриматись від використання фіналізаторів. Очищувачі трохи кращі,
      ніж фіналізатори, в тому сенсі, оскільки автори класу мають контроль над
      власними потоками очищувачів, але очищувачі все ще роблять в фоні, під
      керівництвом збирача сміття, так що не може бути гарантії щодо
      передбачуваної очистки.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Не
      тільки специфікація не дає гарантій, що фіналізатори та очистка буде
      виконуватись передбачувано; вона не провадить гарантії, що вони взагалі
      будуть виконуватись. Повністю можливо, навіть вірогідно, що програма
      завершиться без їх виконання для деякого об'єкта, що більше недоступний.
      Як слідоцтво, ви ніколи <span class="Apple-converted-space"></span><strong>не
        повинні залежати від фіналізатора або очистки, щоб оновити збережений
        стан.</strong><span class="Apple-converted-space"> Наприклад,
        покладатись на фіналайзер або очищувач для вивільнення постійного
        блокування на розділеному ресурсі, такому, як база даних, є гарним
        способом поставити всю вашу розподілену систему на мертвий прикол</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Не
      спокушайтесь методвами <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">System.gc</code><span
        class="Apple-converted-space"> </span>та<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">System.runFinalization</code>.
      Вони можуть збільшити шанси фіналізаторів або очищувачів бути виконаними,
      але вони не гарантують цього. Два метода колись обіцяли дати цю гарантію:<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">System.runFinalizersOnExit</code><span
        class="Apple-converted-space">, </span>та його злий близнюк, <code style="font-family: 'Courier New', monospace;">Runtime.runFinalizersOnExit</code>.
      Ці методи фатально недосконалі, та були ігноровані протягом десятиріч [<a
        href="ref.xhtml#rThreadStop" style="text-decoration: none;">ThreadStop</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>
      &nbsp; Інша проблема з фіналізаторами в тому, що неперехоплене виключення
      під час фіналізації ігнорується, та фіналізація цього об'єкта припиняється
      [JLS, 12.6]. Неперехоплені виключення можуть залишити інші об'єкти в
      пошкодженому стані. Якщо інший потік намагається використати такий
      пошкоджений об'єкт, результатом буде довільна невизначена поведінка.
      Звичайно неперехоплене виключення буде припиняти потік, та друкувати трасу
      стеку, але тільки не в фіналізаторі — навіть не буде надруковане
      попередження. Очищувачі не мають цієї проблеми, оскільки бібліотека,
      використовуючи очищувач, має контроль над його потоком.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Існує
        <em>суттєве </em>пенальті продуктивності для використання фіналайзерів
        та очищувачів</strong><strong>.</strong><span class="Apple-converted-space">
        На моїй машині час створення простого </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">AutoCloseable</code>object,
та
      його закриття з використанням <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources,
      та час, коли збирач сміття прибере ресурси, складає близько 12 ns.
      Використання замість цього фіналайзера збільшує час до 550 ns. Іншими
      словами, це близько&nbsp; 50 разів повільніше, коли ви створюєте та
      руйнуєте об'єкти за допомогою фіналайзерів. В основі це відбувається через
      те, що фіналайзери заважають ефективному збиранню сміття. Очищувачі можна
      порівняти в швидкості з фіналайзерами, якщо ви використовуєте їх для
      очищення всіх примірників класу (близько 500 ns на примірник на моїй
      машині), але очищувачі значно швидші, якщо ви використовуєте тільки як
      страховку, як показано нижче. За таких умов створення, очищення та
      руйнування о'бєкту займає близько 66 ns на моїй машині, що означає, що ви
      платите п'ятикратну ціну (не п'ядесят) за страховку, <em>якщо ви не
        користуєтесь єю</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Фіналайзери
        мають серйозну проблему безпеки: вони відчиняють ваш клас для <em>фіналайзрної
          атаки</em></strong><strong>.</strong><span class="Apple-converted-space">
      </span>Ідея фіналайзерної атаки проста: якщо викликати виключення в
      конструкторі або його серіалізованих евівалентах — методах <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">readObject</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">readResolve</code>
      (<a href="ch12.xhtml#ch12" style="text-decoration: none;">Глава 12</a>) —
      фіналайзер зловмисного субкласу меже отримати керування на частково
      сконструйованому об'єкті, що мав би “загинути на корню”. Цей фіналайзер
      може записати посилання на об'єкт в статичному полі, заважаючи його
      прибиранню збирачем сміття. Коли спотворений об'єкт вже записаний, стає
      простою річчю виклик довільних методів на цьому об'єкті, що не було б
      дозволеним за звичайних умов. <span class="Apple-converted-space"></span><strong>Виклик
        виключення в конструкторі мав бути достатнім для того, щоб запобігти
        створенню об'єкта як такого; в присутності фіналайзера це вже не так.</strong><span
        class="Apple-converted-space"> Такі атаки можуть мати важкі наслідки</span>.
      Фінальні класи мають імунітет до фіналайзерних атак, оскільки ніхто не
      може написати зловмисний субклас фінального класу.<span class="Apple-converted-space">
      </span><strong>Щоб захистити нефінальні класи від фіналайзерних атак,
        напишіть фінальний метод </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>finalize</strong></code><span
        class="Apple-converted-space">, </span><strong>що нічого не робить.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Так
      що робити замість написання фіналайзерів та очищувачів для класа, чиї
      об'єкти інкапсулюють ресурси, що потребують завершення, такі, як файли або
      потоки? Просто<span class="Apple-converted-space"> </span><strong>зробіть,
        щоб ваш клас реалізував</strong><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;"><strong>AutoCloseable</strong></code><strong>,</strong><span
        class="Apple-converted-space"> </span>та вимагати від клієнтів
      викликати метод&nbsp;<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">close</code><span
        class="Apple-converted-space"> на кожному примірнику, коли він більше не
        потрібен</span>, типово використовуючи <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources,
      щоб впевнитись в завершенні, навіть перед лицем виключення (<a href="ch2.xhtml#lev9"
        style="text-decoration: none;">Елемент 9</a>). Одна деталь, яку варто
      згадати, це те, що примірник має відстежувати, чи не був він часом
      зачинений: метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">close</code><span
        class="Apple-converted-space"> </span>має записувати в поле, що цей
      об'єкт більше невалідний, та інші методи мають перевіряти це поле, та
      підіймати <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">IllegalStateException</code><span
        class="Apple-converted-space">, якщо вони викликаються після того, як
        об'єкт був зачинений</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Та
      що, яи є щось, для чого фіналайзери та очищувачі гарні? Можливо, вони
      мають два легітимних використання. Одне - діяти як старховка в випадку,
      коли власник ресурсів зневажає викликати метод<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">close</code>.
      Хоча немає гарантії, що очищувач або фіналайзер будуть виконуватись
      негайно (або взагалі будуть), краще звільнити ресурси пізніше, ніж ніколи,
      якщо клієнт не зробить це сам. Якщо ви вирішите написати такий
      страховочний фіналайзер, думайте довго і наполегливо, чи цей захист вартий
      ціни. Деякі класи бібліотеки Java, як<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">FileInputStream</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">FileOutputStream</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ThreadPoolExecutor</code>,
      та<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">java.sql.Connection</code>,
      мають фіналайзери, що служать такою страховкою.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Друге
      лігитимне використання очищувачів торкаються об'єктів з <em>природним
        напарником</em>. Природний напарник є природним (не-Java) о'бєктом, до
      якого нормальний об'єкт делегує через природні методи. Оскільки природні
      частини не є звичайними об'єктами, збирач сміття не знає щодо його, та не
      може повернути ресурси під час утілізації його Java напарника. Очищувач
      або фіналайзер може бути потрібним механізмом для цього завдання,
      вважаючи, що продуктивність прийнятна, та природна частина не утримує
      критичних ресурсів. Якщо продуктивність неприпустима, або природний код
      утримує ресурси, що мають бути безпосередньо повернуті, клас повинен мати
      метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">close</code>,
      як описано вище.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Очищувачі
      трохи складно використовувати. Нижче простий клас <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Room</code><span class="Apple-converted-space">,
        що демонструє цей механізм</span>. Будемо вважати, що кімнати мають бути
      очищені до того, як вони будуть відновлені. Клас <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Room</code><span class="Apple-converted-space">
        реалізує</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">AutoCloseable</code>;
      факт, що його страховочна сітка автоматичного очищення використовує
      очищувач, є тільки деталлю реалізації. На відміну від фіналайзерів,
      очищувачі не вкидають до публічного API класу:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Самоочищуваний клас використовує очищувач як страховочну сітку</strong><br>
      public class Room implements AutoCloseable {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final Cleaner cleaner =
      Cleaner.create();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Ресурс, що потребує очищення.<span class="Apple-converted-space">
      </span><strong>Не має посилатись на Room!</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static class State implements Runnable {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int numJunkPiles; // Число
      сміття в кімнаті<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;State(int numJunkPiles) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.numJunkPiles
      = numJunkPiles;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Викликається з метода
      close <em>або</em><span class="Apple-converted-space"> </span>очищувача<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public void
      run() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Cleaning
      room");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numJunkPiles
      = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Стан цієї кімати, поділяється з нашим cleanable<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final State state;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Наше cleanable. Очищує кімнату, коли та стає
      жертвою gc<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Cleaner.Cleanable cleanable;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Room(int numJunkPiles) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state = new
      State(numJunkPiles);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cleanable =
      cleaner.register(this, state);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public void close() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cleanable.clean();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Вкладений
      статичний клас<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">State</code><span
        class="Apple-converted-space"> містить ресурси, що потрібні очищувачу
        для виконання своєї роботи.</span> В цьому випадку, це просто <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">numJunkPiles</code>field,
      що представляє число безладу в кімнаті. Більш реалістично, це може бути
      final<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">long</code><span
        class="Apple-converted-space">, що містить вказівник на природний об'єкт</span>.<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">State
        </code>реалізує <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Runnable</code>,
      та його метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">run</code><span
        class="Apple-converted-space"> викликається в основному один раз</span>,
      з боку <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Cleanable</code><span
        class="Apple-converted-space">, що ми отримуємо, коли ми реєструємо наш
        примірник </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">State</code><span
        class="Apple-converted-space"> з нашим очисником в конструкторі </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Room</code>.
      Виклик до методу <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">run</code><span
        class="Apple-converted-space"> буде спрацьовувати по одній з двох речей</span>:
      звичайно, він викликатиметься через виклик методу <span class="Apple-converted-space"></span><span
        epub:type="pagebreak" id="page_33"></span><code style="font-family: 'Courier New', monospace;">Room</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">close</code>,
      що викличе метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Cleanable</code>
      clean. Якщо клієнт забуде викликати метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">close</code><span class="Apple-converted-space">
        під час того, як примірник</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">Room</code><span class="Apple-converted-space">
        буде на шляху до збирача сміття</span>, очищувач буде (нащастя)
      викликати метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">State</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">run</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Є
      критичним, щоб примірник <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">State</code><span class="Apple-converted-space">
        не посилався на свій примірник </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Room</code>. Якщо зробити
      це, це створить цикл, що заважатиме примірнику <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Room</code><span class="Apple-converted-space">
      </span>стати предметом збирача сміття (та від автоматичної очистки). Таким
      чином, <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">State</code><span
        class="Apple-converted-space"> має бути вкладеним</span><span class="Apple-converted-space">
      </span><em>static</em><span class="Apple-converted-space"> класом,
        оскільки нестатичні вкладені класи містять посилання на свої оточуючі
        примірники </span>(<a href="ch4.xhtml#lev24" style="text-decoration: none;">Елемент
        24</a>). Також подібним чином нерекомендоване використовувати лямбду, бо
      вони легко можуть захопити посилання на оточуючі об'єкти.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Як
      ми казали раніше, очищувач <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Room</code>
      використовується тільлки як страховка. Якщо клієнти оточать всі примірники
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Room</code><span
        class="Apple-converted-space"> в блоки</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">try</code>-with-resource,
      автоматичне очищення ніколи не знадобиться. Цей гарно-поведінковий клієнт
      демонструє цю поведінку:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Adult {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try (Room myRoom = new
      Room(7)) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Goodbye");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Як
      ви очікували, виконання програми<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">Adult</code><span class="Apple-converted-space">
        друкує</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Goodbye</code>,
      за чим слідує<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Cleaning
        room</code>. Але що до ціх хворобливо-поведінкових програм, що ніколи не
      очищають кімнати?</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Teenager {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Room(99);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Peace
      out");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br>
      Ви можете очікувати, що воно надрукує<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Peace out</code>,
      за чим послідує<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Cleaning
        room</code>, але на моїй машині воно ніколи не друкує<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Cleaning room</code>;
      воно просто виходить. Це та непередбачуваність, про яку ми казали раніше.
      Специфікація<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Cleaner</code><span
        class="Apple-converted-space"> каже:</span> “Поведінка очищувачів під
      час <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">System.exit</code><span
        class="Apple-converted-space"> залежить від реалізації</span>. Немає
      гарантій відносно того, будуть виконані дії з очистки, або ні”. Хоча
      специфікація не каже цього, те саме вірно для нормального виходу з
      програми. На моїй машині додавання рядка <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">System.gc()</code><span class="Apple-converted-space">
        до методу</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Teenager</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">main</code><span
        class="Apple-converted-space"> досить, щоб воно почало друкувати </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Cleaning
        room</code><span class="Apple-converted-space"> перед виходом</span>,
      але немає гарантії, що ви побачите таку ж поведінку на вашій машині.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      результаті - не використовуйте очищувачі, або в версії до Java 9
      фіналізоатори, за винятком страхуючої сітки, або щоб завершити некритичні
      зовнішні ресурси. Та навіть і тоді ачувайтесь щодо невизначеності та
      наслідках для продуктивності.</p>
    <h3 class="h3b" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 72px; text-indent: -72px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_34"></span><strong>Елемент 9: Обирайте</strong><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><strong>try</strong></code><strong>-with-resources
        замість</strong><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><strong>try</strong></code><strong>-</strong><code
        style="font-family: 'Courier New', monospace;"><strong>finally</strong></code></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Бібліотеки
      Java включають багато ресурсів, що мають бути зачинені вручну, через
      виклик методу <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">close</code>.
      Приклади включають <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">InputStream</code>,<code
        style="font-family: 'Courier New', monospace;"> OutputStream</code>, та<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">java.sql.Connection</code>.
      Зачинення ресурсів часто недоглядається з боку клієнтів, з передбачувано
      тяжкими наслідками для продуктивності. Хоча багато з ціх ресурсів
      використовують фіналайзери як страховку, ці фіналайзери не роблять дуже
      гарно (<a href="ch2.xhtml#lev8" style="text-decoration: none;">Елемент 8</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Історично,
      твердження <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">try</code>-<code
        style="font-family: 'Courier New', monospace;">finally</code><span class="Apple-converted-space">
        було кращим шляхом гарантувати, що ресурс буде зачинено вірно, навіть
        перед лицем виключення або </span>return:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-finally - Більше не кращий спосіб закрити ресурси!</strong><br>
      static String firstLineOfFile(String path) throws IOException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;BufferedReader br = new BufferedReader(new
      FileReader(path));<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return br.readLine();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} finally {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;br.close();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      може виглядати непогано, але все піде гірше, коли ви додасте другий
      ресурс:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-finally непривабливе, коли використовується більше ніж з одним
        ресурсом!</strong><br>
      static void copy(String src, String dst) throws IOException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;InputStream in = new FileInputStream(src);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OutputStream out = new
      FileOutputStream(dst);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[]
      buf = new byte[BUFFER_SIZE];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      n;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while
      ((n = in.read(buf)) &gt;= 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.write(buf,
      0, n);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} finally {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.close();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} finally {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in.close();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Можливо,
      в це складно повірити, але навіть гарні програмісти невірно все це
      розуміють в більшості випадків. Для початківців, я не зрозумів цього на
      сторінці 88 в<span class="Apple-converted-space"> </span><em>Java
        Puzzlers</em>[<a href="ref.xhtml#rBloch05" style="text-decoration: none;">Bloch05</a>],
      і ніхто не зрообив зауваження на протязі років. Фактично, дві треті
      використань метода&nbsp;<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">close</code><span class="Apple-converted-space">
        в бібліотеках </span>Java були помилковими в 2007-му році.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_35"></span>Навіть коректний код для
      замикання ресурсів в виразах<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">try</code>-<code style="font-family: 'Courier New', monospace;">finally</code>,
      як ілюстровано в попередніх двох прикладах, мають невеликий недолік. Код в
      обох блоках <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">try</code><span
        class="Apple-converted-space"> </span>та<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">finally</code><span
        class="Apple-converted-space"> </span>може в викликати виключення.
      Наприклад, в <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">firstLineOfFile</code>method,
виклик
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">readLine</code><span
        class="Apple-converted-space"> може викликати виключення через відмову в
        фізичному пристрої, та виклик до</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">close</code><span
        class="Apple-converted-space"> може також потім схибити з тієї ж причини</span>.
      За таких обставин друге виключення повністю знищить перше. Немає запису
      щодо першоно виключення в стеку виключень, що може значно ускладнити
      налагодження в реальних системах — зазвичай ви бажаєте бачити перше
      виключеня, щоб диагностувати проблему. Хоча можливо написати код для
      придушення другого виключеня на користь першого, буквально ніхто не робить
      це через велику складність.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Всі
      з ціх проблем були вирішені в один крок, коли Java 7 ввела твердження<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">try</code>-with-resources
      [JLS, 14.20.3]. Щоб бути корисним з цією конструкцією, ресурс має
      реалізувати інтерфейс <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">AutoCloseable</code>,
      що складається з одного метода <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">close</code>. Зараз
      багато класів та інтерфейсів в бібліотеках Java та сторонніх бібліотеках
      реалізують або розширюють <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">AutoCloseable</code>.
      Якщо ви пишете клас, що представляє ресурс, який має зачинятись, ваш клас
      має також реалізувати <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">AutoCloseable</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ось
      як наш перший приклад виглядає з використанням <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-resources:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-with-resources - кращий спосіб зачиняти ресурси!</strong><br>
      static String firstLineOfFile(String path) throws IOException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try (BufferedReader br = new BufferedReader(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new
      FileReader(path))) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return br.readLine();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Та
      ось як виглядає наш другий приклад з використанням<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">try</code>-with-resources:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-with-resources на багатьох ресурсах - влучно та мило</strong><br>
      static void copy(String src, String dst) throws IOException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try (InputStream&nbsp;&nbsp;&nbsp;in = new
      FileInputStream(src);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; OutputStream out = new
      FileOutputStream(dst)) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;byte[] buf = new
      byte[BUFFER_SIZE];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int n;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while ((n = in.read(buf))
      &gt;= 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out.write(buf,
      0, n);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Версія
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">try</code>-with-resources
не
      тільки коротша та більш читабельна, ніж оригінальна, але вона також
      провадить кращу діагностику. Розглянемо метод the<code style="font-family: 'Courier New', monospace;">firstLineOfFile</code>.
      Якщо виключення виникають в обох викликах, <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">readLine</code><span class="Apple-converted-space">
        та</span> (прихованому)<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">close</code>, останє
      виключеня <em>придушується </em>на користь першого. Фактично, декілька
      виключень можуть бути придушені, щоб зберігти виключення, що ми насправді
      бажаємо бачити. Ці придушені виключення не просто відкидаються; вони
      друкуються в стеку з повідомленням, що вони були придушені. Ви також
      можете отримати доступ до них програмно, за допомогою метода <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">getSuppressed</code>, що
      було додане до <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Throwable</code><span
        class="Apple-converted-space"> в</span> Java 7.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ви
      можете додати вирази catch до тверджень<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">try</code>-with-resources,
      так само, як ви можете зробити це для звичайного <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">try</code>-<code style="font-family: 'Courier New', monospace;">finally</code>.
      Це дозволяє вам обробляти виключення без забруднення вашого коду
      додатковим рівнями вкладання. Як трохи надуманий приклад, ось версія
      нашого <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">firstLineOfFile</code>method,
      що не підіймає виключень, але приймає значення по замовчанню, що
      повертається, якщо файл неможливо відкрити або прочитати з нього:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        try-with-resources з твердженням catch</strong><br>
      static String firstLineOfFile(String path, String defaultVal) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try (BufferedReader br = new BufferedReader(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new
      FileReader(path))) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return br.readLine();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (IOException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return defaultVal;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Урок
      простий: заджди використовуйте <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">try</code>-with-reso
      переважно до&nbsp;<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">try-finally</code><span
        class="Apple-converted-space">, коли робите з ресурсами, що мають
        зачинятись</span>. Отриманий код коротший та ясніший, та згенеровані
      виключення більш корисні. Твердження <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">try-</code>with-resources
      робить простим написання коректного коду з використанням ресурсів, що має
      зачинятись, що було практично неможливо за допомогою <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">try</code>-<code style="font-family: 'Courier New', monospace;">finally</code>.</p>
    <p> </p>
    <h2 class="h2" id="ch3" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Глава
      3. Методи, загальні для всіх об'єктів</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><span
          style="font-family: sans-serif;">Хоча </span>Object</code><span class="Apple-converted-space">
        є суцільним класом, він розроблений в основному для розширення. Всі його
        нефінальні методи </span>(<code style="font-family: 'Courier New', monospace;">equals</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code>,
      <code style="font-family: 'Courier New', monospace;">finalize</code>)
      мають явні<span class="Apple-converted-space"> <em>загальні контракти</em>,
        оскільки вони розроблені бути перекритими. Відповідальністю кожного
        класу є перекриття ціх методів, що підкорятимуться їх загальним
        контрактам</span>; неспроможність зробити це заважить іншим класам, що
      залежать від ціх контрактів (таких, як <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">HashMap</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">HashSet</code>)
      від відповідного функціонування разом з класом.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      глава каже вам, коли та як перекривати нефінальні методи <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code>. Метод <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">finalize</code><span
        class="Apple-converted-space"> видалений з цієї глави, оскільки він
        обговорений&nbsp; в</span><span class="Apple-converted-space"> </span><a
        href="ch2.xhtml#lev8" style="text-decoration: none;">Елементі 8</a>.
      Хоча він і не є методом, <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable.compareTo</code><span
        class="Apple-converted-space"> обговорюється в цій главі, оскільки він
        має подібний характер</span>.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Елемент
        10: підкоряйтесь загальному контракту, коли перекриваєте </strong><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code></h3>
    <p class="noindentb" style="margin-top: 0px; margin-bottom: 15px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Перекриття
      методу <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> виглядає простим, але багато шляхів
        зробити це невірно, та наслідки будуть значними. Найпростіший спосіб
        уникнути проблем - це не перекривати метод&nbsp;</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code>,
      в якому випадку кожний примірник класу еквівалентний тільки сам собі. Це
      правильна річ, яку треба робити, якщо виникає одна з наступних умов:</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space"> </span><strong>Кожний примірник класу
        природно унікальнийй.</strong><span class="Apple-converted-space"> Це
        вірно для класів, таких як </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Thread</code><span class="Apple-converted-space">,
        що презентують активні сутності, скоріше, ніж значення. Реалізація</span><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, запроваджена </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">,
        має виключно правильну поведінку для цього випадку.</span></p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space"> </span><strong>Для класу немає потреби
        провадити перевірку “логічної еквівалентності”.</strong><span class="Apple-converted-space">
        Наприклад, </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">java.util.regex.Pattern</code><span
        class="Apple-converted-space"> може мати перекритий </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> </span>для перевірки, коли примірники <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Pattern</code><span
        class="Apple-converted-space"> представляють той самий регулярний вираз,
        але розробники не вважають, що клієнти мають потребувати або бажати </span>цієї
      функціональності. За таких умов, реалізація<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, наслідувана від </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">,
        є ідеальною</span>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_38"></span>•<span class="Apple-converted-space">
      </span><strong>Суперклас вже перекриває </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code>,<span
        class="Apple-converted-space"> </span><strong>і поведінка реалізації
        суперкласу підходить до цього класу.</strong><span class="Apple-converted-space">
        Наприклад, більшість реалзацій </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Set</code> наслідують
      свої реалізації<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> від</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">AbstractSet</code>,<span
        class="Apple-converted-space"> реалізації </span><code style="font-family: 'Courier New', monospace;">List</code><span
        class="Apple-converted-space"> від</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">AbstractList</code>,
      та<span class="Apple-converted-space"> реалізації </span><code style="font-family: 'Courier New', monospace;">Map
        від</code><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">AbstractMap</code>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space"> </span><strong>Клас є приватним або
        пакунок-приватним, та ви впевнені, що його метод</strong><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space"> </span><strong>ніколи не буде
        викликатись.</strong><span class="Apple-converted-space"> Якщо ви
        екстремально не схильні до ризику, ви можете перекрити метод </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, щоб переконатись, що він не викликається
        випадково</span>:</p>
    <p class="preb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">@Override
      public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;throw new AssertionError(); // Метод ніколи не
      викликається<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Так
      коли має сенс викликати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>? Це тоді,
      коли клас має логику <span class="Apple-converted-space"></span><em>логічної
        еквівалентності, </em>що відрізяється від простої ідентичносі об'єктів,
      та суперклас не має вже перекритого <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>. Це,
      загалом, випадок для <em>класів значень</em><em>.</em><span class="Apple-converted-space">
        Клас-значення є класом, що просто представляє значення</span>, таке, як
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Integer</code><span
        class="Apple-converted-space"> або</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">String</code>.
      Програміст, що порівнює посилання на о'бєкти-значення з використанням
      методу <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, очікує з'ясувати, чи вони логічно
        еквівалентні, не те, чи вони посилаються на один об'єкт. Перекриття
        методу </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>
      потрібне не тільки для задоволення потреб програміста. Це також служить
      для ключів мапи або множини,&nbsp; з передбачуваною поведінкою.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Один
      тип з класів-значень, що <em>не </em>потребує перекриття методу<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, є клас, що використовує контроль за
        екземпляром</span> (<a href="ch2.xhtml#lev1" style="text-decoration: none;">Елемент
        1</a>), щоб переконатись, що щонайбільше існує один об'єкт з кожним
      значенням. Тип енумерацій (<a href="ch6.xhtml#lev34" style="text-decoration: none;">Елемент
        34</a>) підпадає в цю категорію. Для ціх класів логічна еквівалентність
      це те саме, що і ідентичність о'бєктів, так що метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> функціонує як метод логічної
        еквівалнтності </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Коли
      ви перекриваєте метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>,
      ви маєте притримуватись його загальному контракту. Ось контракт зі
      специфікації <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>:</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Метод
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> </span>реалізує&nbsp; <span class="Apple-converted-space"></span><em>відношення
        еквівалентності.</em><span class="Apple-converted-space"> </span>Він
      має такі властивості:</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space"> </span><em>Рефлексивність</em>: для
      любого&nbsp; non-null посилання значення<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">x</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">x.equals(x)</code><span
        class="Apple-converted-space"> повинне повертати</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space"> </span><em>Симетричність</em>: для
      любого non-null посилання на<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">x</code><span class="Apple-converted-space">
        на</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">y</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">x.equals(y)</code><span
        class="Apple-converted-space"> має повертати</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space">, тоді і тільки тоді, коли</span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"> y.equals(x)</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      <span class="Apple-converted-space"></span><em>Транзитивність</em>: для
      любого&nbsp; non-null посилання на значення<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">x</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">y</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">z</code>,
      якщо <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">x.equals(y)</code><span
        class="Apple-converted-space"> </span>повертає<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">y.equals(z)</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code>, <code
        style="font-family: 'Courier New', monospace;"></code>тоді&nbsp;<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">x.equals(z)</code><span
        class="Apple-converted-space"> має повертати</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space"> </span><em>Узгодженість</em>: для любого
      non-null посилання на значення<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">x</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">y</code>,
      множинні виклики&nbsp;<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">x.equals(y)</code><span
        class="Apple-converted-space"> мають узгоджено повертати </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">true</code><span class="Apple-converted-space">
        або узгоджено повертати</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">false</code>, якщо
      інформація, використана в<span class="Apple-converted-space"> порівняннях
      </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, не модифікована</span>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Для любого non-null посилання на значення<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">x</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">x.equals(null)</code><span
        class="Apple-converted-space"> має повертати</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">false</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_39"></span>Якщо ви не схильні до
      математики, все це може виглядати трохи лячно, але не ігноруйте це! Якщо
      ви порушите це, ви можете виявити, що ваша програма поводиться помилково
      або падає, та може бути дуже складно пришпилити джерело помилки.
      Перефразуючи John Donne, жодний клас не є островом. Примірники одного
      класу часто передаються до іншого. Багато класів, включаючі всі класи
      колекцій, залежать від того, що передані їм об'єкти дотримуються контракту
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Тепер,
      коли ви попереджені про небезпеку порушення контракту <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>, давайте
      пройдемось по контракту в деталях. Гарні новини полягають в тому, що всі
      вони не такі складні. Як тільки ви їх зрозумієте, стане просто слідувати
      їм.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Так
      що таке відношення еквівалентності? Кажучи просто, це оператор, що поділяє
      набір елементів на підмножини, чиї елементи виглядають еквівалентними один
      одному. Ці підмножини відомі як <span class="Apple-converted-space"></span><em>класи
        еквівалентності</em>. Щоб метод<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        був користний</span>, всі з елементів кожного класу еквівалентності
      мають бути взаємозамінні з точки зору користувача. Тепер давайте
      перевіримио п'ять вимог, одне за одним:</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Рефлективність
        </strong>— Перша вимога каже лише те, що об'єкт має бути еквівалентний
      самий собі. Складно уявити, що ви порушите це правило випадково. Якщо ви
      порушите його, та потім додасте клас до колекції, метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">contains</code><span class="Apple-converted-space">
        може сказати, що колекція не містить цього примірника, хоча він був
        доданий</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Симетрія
        </strong>— Друга вимога каже, що любі два об'єкти мають домовитись, чи
      вони є еквівалентними. На відміну від першої вимоги, нескладно уявити
      ненавмисне порушення цього правила. Наприклад, розглянемо клас, що
      реалізує рядки без розрізняння реєстру. Реєстр рядка зберігається<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">, але ігнорується порівнянням </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Поламане
        - порушує симетрію!</strong><br>
      public final class CaseInsensitiveString {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final String s;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public CaseInsensitiveString(String s) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.s =
      Objects.requireNonNull(s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// П</strong><strong>оламане - порушує
        симетрію!</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (o instanceof
      CaseInsensitiveString)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      s.equalsIgnoreCase(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((CaseInsensitiveString)
      o).s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>if (o instanceof
        String)&nbsp;&nbsp;// Взаємодіє в одну сторону!</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>return
        s.equalsIgnoreCase((String) o);</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;// Закінчення не показане<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Гарно
      налаштований метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> в цьому класі наївно намагається
        взаємодіяти зі звичайними рядками. Давайте уявимо, що ми маємо один
        нечутливий до реєстру рядок, та один звичайний</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">CaseInsensitiveString
      cis = new CaseInsensitiveString("Polish");<br>
      String s = "polish";</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Як
      і очікувалось, <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">cis.equals(s)</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code>.
      Проблема в тому, що хоча метод<span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"> equals</code><span class="Apple-converted-space">
        в</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space"> знає про звичайні рядки, метод </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> в</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space"> байдужий до нечутливих рядків. Таким
        чином</span>,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">s.equals(cis)</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">false</code>,
      що явно порушує симетрію. Уявімо, що ми поклали нечутливий рядок до
      колекції:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">List&lt;CaseInsensitiveString&gt;
      list = new ArrayList&lt;&gt;();<br>
      list.add(cis);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Що<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">list.contains(s)</code><span
        class="Apple-converted-space"> </span>повертатиме в цьому місці? Хто
      знає? В поточній версії OpenJDK воно повертає <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">false</code>, але це
      тільки атрифакт реалізації. В іншій реалізації воно може так само просто
      повернути <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space">, або підняти виключення часу виконання</span>.<span
        class="Apple-converted-space"> </span><strong>Одного разу, коли ви
        порушили контракт </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><strong>,
        ви вже не знаєте, як буде діяти інший об'єкт в протистоянні з вашим
        об'єктом.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Щоб
      уникнути проблеми, просто видаліть хворобливе намагання взаємодіяти зі <code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">
        з метода</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code>.
      Як тільки ви зробите це, ви можете зробити рефакторинг метода в єдиний
      рядок return:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">@Override
      public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return o instanceof CaseInsensitiveString
      &amp;&amp;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((CaseInsensitiveString)
      o).s.equalsIgnoreCase(s);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Транзитивність
        </strong>— Третя вимога контракту <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        каже, що якщо один об'єкт еквівалентний до іншого, а той до третього, то
        перший має бути еквівалентним до третього</span>. Знову, нескладно
      уявити ненавмистне порушення цієї вимови. Розглянемо випадок субкласу, що
      додає до свого суперкласу новий <span class="Apple-converted-space"></span><em>компонент
        значення</em>. Іншими словами, субклас додає частину інформації, що
      впливає на порівняння <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>.
      Давайте почнемо з простого незмінного класу двовимірної точки:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final int y;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Point(int x, int y) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.x = x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.y = y;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof Point))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Point p = (Point)o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return p.x == x &amp;&amp;
      p.y == y;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;// Залишок не показаний<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Уявімо,
      що ви бажаєте розширити цей клас, додаючи до точки значення кольору:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class ColorPoint extends Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Color color;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public ColorPoint(int x, int y, Color color) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(x, y);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.color = color;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;//&nbsp;Залишок не показаний<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Як
      має виглядати метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code>?
      Якщо ми повністю полишимо його, реалізація буде наслідувана з<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space">, та інформація про колір буде
        ігноруватись при порівнянні</span>. Хоча це не порушує контракт <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>, зрозуміло,
      що це неприйнятно. Уявімо, що ви написали метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">,
        що повертає </span><code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space"> тільки якщо його аргумент є точкою з
        кольором, та має той самий колір та координати</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Поломане - порушує симетрію!</strong><br>
      @Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof ColorPoint))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>return super.equals(o) &amp;&amp;
        ((ColorPoint) o).color == color;</strong><br>
      }</p>
    <span style="font-family: sans-serif;">Проблема з цім методом в тому, що ви
      можете отримати різні результати, коли порівнюєте точку з кольоровою
      точкою, та навпаки. Перше порівняння ігнорує колір, тоді як друге завжди
      повертатиме</span><code style="font-family: 'Courier New', monospace;">
      false, оскільки тип аргумента некоректний. Щоб надати цьому конкретики,
      давайте створимо одну точку, та одну кольорову точку</code>:
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Point
      p = new Point(1, 2);<br>
      ColorPoint cp = new ColorPoint(1, 2, Color.RED);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Тоді<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">p.equals(cp)</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code>, в
      той час, як <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">cp.equals(p)</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">false</code>.
      Ви можете спробувати полагодити цю проблему, зробивши, щоб <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">ColorPoint.equals</code><span
        class="Apple-converted-space"> ігнорував колір, коли виконуються </span>“змішані
      порівняння”:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Поломане - порушує транзитивність!</strong><br>
      @Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof Point))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// Якщо o є звичайна Point, закрити очі на
        колір при порівнянні</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>if (!(o instanceof ColorPoint))</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>return
        o.equals(this);</strong><br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// o є ColorPoint; зробити повне порівняння<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return super.equals(o) &amp;&amp; ((ColorPoint)
      o).color == color;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Цей
      підхід надає симетрію, але ціною транзитивності:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ColorPoint
      p1 = new ColorPoint(1, 2, Color.RED);<br>
      Point p2 = new Point(1, 2);<br>
      ColorPoint p3 = new ColorPoint(1, 2, Color.BLUE);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Тепер<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">p1.equals(p2)</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">p2.equals(p3)</code><span
        class="Apple-converted-space"> повертають</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code>,
      але<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">p1.equals(p3)</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">false</code>,
      чисте порушення транзитивності. Перші два порівняння ігнорують колір, але
      третє приймає його до уваги.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Також,
      цей підхід може викликати безкінечну рекурсію: уявіть, що є два субкласи<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Point</code>,
      скажімо, <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">ColorPoint</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">SmellPoint</code>,
      і кожний має такий різновид методу<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">equals</code>. Тоді
      виклик до<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">myColorPoint.equals(mySmellPoint)</code><span
        class="Apple-converted-space"> буде викликати</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">StackOverflowError</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">То
      яке може бути рішення? Виявляється, що це фундаментальна проблема
      відношення еквівалентності в об'єктно-орієнтованих мовах.<span class="Apple-converted-space">
      </span><strong>Немає способу розширити клас з примірниками, та додати
        компонент значення, зберігши контракт </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code>,
      за винятком, коли ви не бажаєте забути про переваги об'єктно-орієнтовної
      абстракції.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Можливо,
      ви чули як кажуть, що ви можете <span epub:type="pagebreak" id="page_43"></span>клас,
      та додати компонент значення, і при цьому зберігти контракт <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">,
        через перевірку </span><code style="font-family: 'Courier New', monospace;">getClass</code><span
        class="Apple-converted-space">, замість перевірки</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">instanceof</code><span
        class="Apple-converted-space"> в методі </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Поломане - порушує принцип підстановки Ліскова</strong><br>
      @Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>if (o == null || o.getClass() !=
        getClass())</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>return false;</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;Point p = (Point) o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return p.x == x &amp;&amp; p.y == y;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      матиме ефект еквівалентності об'єктів, тільки якщо вони мають той самий
      клас реалізації. Це може виглядати непогано, але наслідки неприйнятні:
      примірник субкласу<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space"> все ще є </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Point</code>, та він все
      ще має функціонувати як такий, але він не зможе цього робити, якщо
      використати цей підхід! Давайте уявімо, що ми бажаємо написати метод, що
      казатиме, чи точка лежить на одиничному колі. Ось один зі способів, як це
      можна зробити:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Ініціалізуємо
        unitCircle що містить всі Point на одиничному колі</strong><br>
      private static final Set&lt;Point&gt; unitCircle = Set.of(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Point(
      1,&nbsp;&nbsp;0), new Point( 0,&nbsp;&nbsp;1),<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new
      Point(-1,&nbsp;&nbsp;0), new Point( 0, -1));<br>
      <br>
      public static boolean onUnitCircle(Point p) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return unitCircle.contains(p);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      це, можливо, не найшвидший спосіб реалізувати цю функціональність, але це
      робить гарно. Уявімо, що ви розширили <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Point</code><span class="Apple-converted-space">
        в деякий тривіальний спосіб, що не додає компонент значення, скажімо,
        щоб конструктор відстежував, скільки примірників було створено</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class CounterPoint extends Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final AtomicInteger counter =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; new
      AtomicInteger();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public CounterPoint(int x, int y) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(x, y);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;counter.incrementAndGet();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static int numberCreated() { return
      counter.get(); }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>Принцип
        підстановки Ліскова </em><span class="Apple-converted-space"></span>каже,
      що люба важлива властивість типу має також зберігатись для всіх підтипів,
      так що любий метод, написаний для типу, повинен так само робити на його
      підтипах [<a href="ref.xhtml#rLiskov87" style="text-decoration: none;">Liskov87</a>].
      Це формальне твердження нашого попереднього зауваження, що субклас<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space">&nbsp;</span>( такий як <code style="font-family: 'Courier New', monospace;">CounterPoint</code>)
      все ще є <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space">, та має діяти як такий</span>. Але
      уявімо, що ми передали <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">CounterPoint</code><span
        class="Apple-converted-space"> в метод</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">onUnitCircle</code>.
      Якщо клас <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space"> використовує базований на </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">getClass</code> метод<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code>,
      метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">onUnitCircle</code><span
        class="Apple-converted-space"> буде повертати </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">false</code><span class="Apple-converted-space">,
        н незалежно від координат x та y примірника </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">CounterPoint</code>. Це
      так, бо більшість колекцій, включаючи <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">,
        використаний в методі</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">onUnitCircle</code>,
      використовують метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> для перевірки приналежності, та ніякий
        примірник</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">CounterPoint</code><span
        class="Apple-converted-space"> не еквівалентний до жодного</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Point</code>.
      Якщо, однак, ми використовуємо відповідний метод<span class="Apple-converted-space"></span><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> на основі </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">instanceof</code> для<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Point</code>,
      метод same<code style="font-family: 'Courier New', monospace;">onUnitCircle</code><span
        class="Apple-converted-space"> робить гарно, коли представлений
        примірником </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">CounterPoint</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      немає задовільного способу розширити клас та додати компонент значення, є
      гарний кружний шлях: слідуйте пораді <a href="ch4.xhtml#lev18" style="text-decoration: none;">Елементу
        18</a>, “<a href="ch4.xhtml#lev18" style="text-decoration: none;">Обирайте
        композицію замість наслідування</a>”. Замість того, щоб <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">ColorPoint</code><span class="Apple-converted-space">
        розширював</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Point</code>,
      надайте<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">ColorPoint</code><span
        class="Apple-converted-space"> приватне поле</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space">, та публічний метод </span><em>view</em>
      (<a href="ch2.xhtml#lev6" style="text-decoration: none;">Елемент 6</a>),
      що повертає точку в тій же позиції, що і ця кольорова точка:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Додає компонент значення без порушення контракту еквівалентності</strong><br>
      public class ColorPoint {<br>
      &nbsp;&nbsp; private final Point point;<br>
      &nbsp;&nbsp; private final Color color;<br>
      <br>
      &nbsp;&nbsp; public ColorPoint(int x, int y, Color color) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;point = new Point(x, y);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.color =
      Objects.requireNonNull(color);<br>
      &nbsp;&nbsp; }<br>
      <br>
      &nbsp;&nbsp; /**<br>
      &nbsp;&nbsp;&nbsp;&nbsp;* Повертає точку для цієї кольорової точки.<br>
      &nbsp;&nbsp;&nbsp;&nbsp;*/<br>
      &nbsp;&nbsp;<span class="Apple-converted-space">&nbsp;</span><strong>public
        Point asPoint()</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return point;<br>
      &nbsp;&nbsp; }<br>
      <br>
      &nbsp;&nbsp; @Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof ColorPoint))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ColorPoint cp = (ColorPoint) o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return cp.point.equals(point)
      &amp;&amp; cp.color.equals(color);<br>
      &nbsp;&nbsp; }<br>
      <br>
      &nbsp;&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;// Залишок опущений<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Існують
      деякі класи в бібліотеках на платформі Java, що розширюють клас та додають
      компонент значення. Наприклад, <code style="font-family: 'Courier New', monospace;">java.sql.Timestamp</code><span
        class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak" id="page_45"></span>розширює<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">java.util.Date</code><span
        class="Apple-converted-space">, та додає поле </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">nanoseconds</code>.
      Реалізація <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> для </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Timestamp</code><span class="Apple-converted-space">
        порушує симетрію, та може викликати помилкову поведінку, якщо
        об'єкти&nbsp;</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Timestamp</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Date</code><span
        class="Apple-converted-space"> використовуються в тій же колекції, або
        змішуються в інший спосіб</span>. Клас <code style="font-family: 'Courier New', monospace;">Timestamp</code><span
        class="Apple-converted-space"> має дисклаймер, що попереджає
        програмістів не змішувати дати та відтиски часу. Хоча ви не потрапите в
        халепу, доки ви утримуватимете їх окремо, нічого не заважає вам змішати
        їх, та отриману помилку буде важко викрити</span>. Ця поведінка класу <code
        style="font-family: 'Courier New', monospace;">Timestamp</code><span class="Apple-converted-space">
        була помилкою, яку не варто відтворювати</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зауважте,
      що ви <em>можете </em>додати компонент значення до субкласу <em>абстрактного
        </em>класу, без порушення контракту <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>. Це важливо
      для сортування ієрархій класу, до яких ми дійдемо, слідуя порадам в <span
        class="Apple-converted-space"></span><a href="ch4.xhtml#lev23" style="text-decoration: none;">Елементі
        23</a>, “Надавайте перевагу ієрархіям класів перед поміченими класами”.
      Наприклад, ви можете мати абстрактний клас <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Shape</code><span class="Apple-converted-space">
        без компонент значеннь</span>, субклас<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Circle</code><span
        class="Apple-converted-space">, що додає поле</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">radius</code>,
      ту субклас <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Rectangle</code><span
        class="Apple-converted-space">, що додає поля </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">length</code><span class="Apple-converted-space">
        та </span><code style="font-family: 'Courier New', monospace;">width</code>.
      Проблеми показаного вище сорту не виникатимуть, доки неможливо створити
      примірник суперкласу напряму.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Узгодженість
        </strong>— Четверта вимога контракту <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        каже, що якщо два об'єкти еквівалентні, вони мають лишатись еквівалентні
        весь час, за винятком, коли один (або обидва) не будуть модифіковані</span>.
      Іншими словами, змінні об'єкти можуть бути еквівалентні до різних об'єктів
      в різний час, але незмінні об'єкти не можуть. Коли ви пишете клас, гарно
      поміркуйте, чи має він бути незмінним (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Елемент
        17</a>). Якщо ви дійдете висновку, що це так, переконайтесь, що ваш
      метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals
        </code>накладає обмеження, що еквівалентні методи залишаються
      еквівалентними, а нееквівалентні нееквівалентними, весь час.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Незалежно,
      чи є клас незмінним, або ні, <span class="Apple-converted-space"></span><strong>не
        пишіть метод </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">, </span><strong>що покладається на
        ненадійні ресурси.</strong><span class="Apple-converted-space"> Вкрай
        складно задовільнити вимозі узгодженості, якщо ви порушуєте цю заборону.
        Наприклад, метод </span><span class="Apple-converted-space"><span class="Apple-converted-space"></span><code
          style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space"></span>
      </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">java.net.URL</code><span
        class="Apple-converted-space"> покладається на порівняння </span><span
        class="Apple-converted-space"><span class="Apple-converted-space"></span>IP
        адрес </span>вузлів, асоційованих з URL. Переклад імені вузла на IP
      адресу потребує доступу до мережі, та не дає гарантовано тих самих
      результатів з часом. Це може призветси до того, що метод <code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">URL</code><span
        class="Apple-converted-space"> </span>порушить контракт <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        , та може викликати проблеми на практиці</span>. Ця поведінка методу <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">URL</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> була великою помилкою, яку не треба
        повторювати</span>. Нажаль, це не можна змінити через вимоги сумісності.
      Щоб уникати цього сорту проблем, методи <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
      </span>повинні виконувати тільки детермініські обчислення на резидентних в
      пам'яті об'єктах.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Не-null
        —</strong> Заключна вимога не має офіційного ім'я, так що довільно
      назвемо її не-null-овість”. Вона каже, що всі об'єкти мають бути нерівними
      з <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">null</code>.
      Хоча складно уявити випадкове повернення <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">true</code><span class="Apple-converted-space">
        у відповідь на&nbsp;</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">o.equals(null)</code>,
      нескладно уявити випадкое виключення <code style="font-family: 'Courier New', monospace;">NullPointerException</code>.
      Головний контракт забороняє це. Багато класів мають методи<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, що чатують проти цього, явно перевіряючи
        на </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">null</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">@Override
      public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (o == null)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      перевірка не потрібна. Щоб перевірити аргумент на рівність, метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        має спершу привести свій аргумент до відповідного типу, так що його
        ассесори зможуть бути викликані, або буде доступ до його полів</span>.
      Перед виконання приведення метод має виконати оператор <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">instanceof</code><span class="Apple-converted-space">
        для перевірки, що аргумент коректного типу</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">@Override
      public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof MyType))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;MyType mt = (MyType) o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      перевірка типу відсутня, і методу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        переданий аргумент невірного типу, метод </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        буде викликати </span><code style="font-family: 'Courier New', monospace;">ClassCastException</code>,
      що порушує контракт <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>.
      Але оператор <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">instanceof</code><span
        class="Apple-converted-space"> налаштований повертати </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">false</code><span class="Apple-converted-space">,
        якщо його операнд </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">null</code>, безвідносно,
      який тип з'являється в другому операнді [JLS, 15.20.2]. Таким чином,
      перевірка типу поверне <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">false</code><span
        class="Apple-converted-space">, якщо їй переданий</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">null</code>,
      так що вам не треба явно перевіряти на <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">null</code>.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Складаючи
      все докупи, ось рецепт для високоякісного методу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>:</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1.<span
        class="Apple-converted-space"> </span><strong>Використовуйте оператор</strong><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><strong>==</strong></code><span
        class="Apple-converted-space"> </span><strong>для перевірки, чи
        аргумент є посиланням на сам об'єкт.</strong><span class="Apple-converted-space">
        Якщо це так, повертайте </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">true</code>. Це лише
      оптимізація продуктивності, але її варто робити, якщо перевірка потенційно
      коштовна.</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2.<span
        class="Apple-converted-space"> </span><strong>Використовуйте оператор</strong><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><strong>instanceof</strong></code><span
        class="Apple-converted-space"> </span><strong>для перевірки, чи
        аргумент має коректний тип.</strong><span class="Apple-converted-space">
        Якщо ні, повертайте </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">false</code>. Зазвичай,
      коректний тип є класом, в якому трапляється цей метод. Іноді це деякий
      інтерфейс, реализований в цьому класі. Використовуйте інтерфейс, якщо клас
      реалізує інтерфейс, що визначає контракт <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">,
        щоб дозволити порівняння між класами, що реалізують інтерфейс</span>.
      Інтерфейси колекцій, такі як <code style="font-family: 'Courier New', monospace;">Set</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code>
      та&nbsp;<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Map.Entry</code><span
        class="Apple-converted-space"> </span>мають цю властивість.</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3.<span
        class="Apple-converted-space"> </span><strong>Приведіть аргумент до
        коректного типу.</strong><span class="Apple-converted-space"> </span>Оскільки
      цьому приведенню передувала перевірка <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">instanceof</code>, воно
      буде гарантовано успішним.</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_47"></span>4.<span class="Apple-converted-space">
      </span><strong>Для кожного “значущого” поля в класі, перевірте, чи це поле
        в аргументі співпадає з відповідним полем цього об'єкта.</strong><span class="Apple-converted-space">
        Якщо це буде успішним</span>, повертайте<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">true</code>;
      інакше повертайте<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">false</code>.
      Якшр тип еа кроці 2 є інтерфейсом, ви маєте отримати доступ до полів
      аргумента через методи інтерфейса; якщо типом є клас, ви можете бути в
      змозі отримати доступ до полів напряму, в залежнсоті від їх доступності.</p>
    <p class="numberp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      primitive fields whose type is not<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">float</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">double</code>,
      use the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">==</code><span
        class="Apple-converted-space">&nbsp;</span>operator for comparisons; for
      object reference fields, call the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method
      recursively; for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">float</code><span
        class="Apple-converted-space">&nbsp;</span>fields, use the static<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Float.compare(float,
        float)</code><span class="Apple-converted-space">&nbsp;</span>method;
      and for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">double</code><span
        class="Apple-converted-space">&nbsp;</span>fields, use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Double.compare(double,
        double)</code>. The special treatment of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">float</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">double</code><span
        class="Apple-converted-space">&nbsp;</span>fields is made necessary by
      the existence of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Float.NaN</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">-0.0f</code><span
        class="Apple-converted-space">&nbsp;</span>and the analogous<code style="font-family: 'Courier New', monospace;">double</code><span
        class="Apple-converted-space">&nbsp;</span>values; see JLS 15.21.1 or
      the documentation of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Float.equals</code><span
        class="Apple-converted-space">&nbsp;</span>for details. While you could
      compare<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">float</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">double</code><span class="Apple-converted-space">&nbsp;</span>fields
      with the static methods<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Float.equals</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Double.equals</code>,
      this would entail autoboxing on every comparison, which would have poor
      performance. For array fields, apply these guidelines to each element. If
      every element in an array field is significant, use one of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Arrays.equals</code>methods.</p>
    <p class="numberp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Some
      object reference fields may legitimately contain<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>. To avoid the
      possibility of a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">NullPointerException</code>,
      check such fields for equality using the static method<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Objects.equals(Object,
        Object)</code>.</p>
    <p class="numberp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      some classes, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space">&nbsp;</span>above, field comparisons are
      more complex than simple equality tests. If this is the case, you may want
      to store a<span class="Apple-converted-space">&nbsp;</span><em>canonical
        form</em><span class="Apple-converted-space">&nbsp;</span>of the field
      so the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method can do a cheap exact
      comparison on canonical forms rather than a more costly nonstandard
      comparison. This technique is most appropriate for immutable classes (<a href="ch4.xhtml#lev17"
        style="text-decoration: none;">Item 17</a>); if the object can change,
      you must keep the canonical form up to date.</p>
    <p class="numberp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      performance of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>method may be affected by the
      order in which fields are compared. For best performance, you should first
      compare fields that are more likely to differ, less expensive to compare,
      or, ideally, both. You must not compare fields that are not part of an
      object’s logical state, such as lock fields used to synchronize
      operations. You need not compare<span class="Apple-converted-space">&nbsp;</span><em>derived
        fields</em>, which can be calculated from “significant fields,” but
      doing so may improve the performance of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>method.
      If a derived field amounts to a summary description of the entire object,
      comparing this field will save you the expense of comparing the actual
      data if the comparison fails. For example, suppose you have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Polygon</code><span class="Apple-converted-space">&nbsp;</span>class,
      and you cache the area. If two polygons have unequal areas, you needn’t
      bother comparing their edges and vertices.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_48"></span><strong>Коли ви закінчили
        писати метод </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><strong>,
        запитайте себе три питання: Чи він симетричний? Чи він транзитивний? Чи
        він узгоджений?</strong><span class="Apple-converted-space"> І не тільки
        запитайте це в себе</span>; напишіть тести для перевірки, тільки якщо ви
      не використовували AutoValue для генерації вашого метода<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code>.
      В цьому випадку ви можете просто оминути ці тести. Якщо ці властивості не
      дотримуються, зрозумійте чому, та відповідно модифікуйте<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code>.
      Звичайно, ваш метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals
        </code>має також задовільняти іншим двом принципам (рефлексивності та
      не-null-овості), але ці двоє звичайно потурбуються про себе самі.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Метод
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, побудований згідно попередньому рецепту,
        показаний в цьому спрощеному класі </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Клас з типовим методом equals</strong><br>
      public final class PhoneNumber {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final short areaCode, prefix, lineNum;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public PhoneNumber(int areaCode, int prefix, int
      lineNum) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.areaCode =
      rangeCheck(areaCode,&nbsp;&nbsp;999, "area code");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.prefix&nbsp;&nbsp; =
      rangeCheck(prefix,&nbsp;&nbsp;&nbsp;&nbsp;999, "prefix");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.lineNum&nbsp;&nbsp;=
      rangeCheck(lineNum,&nbsp;&nbsp;9999, "line num");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static short rangeCheck(int val, int max,
      String arg) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (val &lt; 0 || val &gt;
      max)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new
      IllegalArgumentException(arg + ": " + val);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (short) val;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>@Override public boolean equals(Object o)</strong><span
        class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (o == this)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof
      PhoneNumber))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PhoneNumber pn =
      (PhoneNumber)o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return pn.lineNum ==
      lineNum &amp;&amp; pn.prefix == prefix<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;
      pn.areaCode == areaCode;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Залишок опущений<br>
      }</p>
    <p class="noindentb" style="margin-top: 0px; margin-bottom: 15px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ось
      декілька заключних тонкощів:</p>
    <p class="bullb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space"> </span><strong>Завжди перекривайте</strong><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><span
        class="Apple-converted-space"> </span><strong>коли перекриваєте </strong><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch3.xhtml#lev11" style="text-decoration: none;">Елемент
        11</a>).</p>
    <p class="bullb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space"> </span><strong>Не намагайтесь бути дуже
        розумним.</strong><span class="Apple-converted-space"> Якщо ви просто
        перевірите поля на рівність, нескладно дотримуватись контракту</span><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code>.
      Якщо ви будете надто агресивні в пошуку еквівалентності, легко натрапити
      на складнощі. Загалом є поганою ідеєю приймати до уваги любі форми
      псевдонимів. Наприклад, клас<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">File <span style="font-family: sans-serif;">не
          повинен намагатись порівнювати символічні посилання, що посилаються на
          той самий файл</span></code>. Дякуємо, що він цього і не робить.</p>
    <p class="bullb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_49"></span>•<span class="Apple-converted-space">
      </span><strong>Не підставляйте інший тип замість</strong><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>Object</strong></code><span
        class="Apple-converted-space"> </span><strong>в декларації</strong><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><strong>.</strong><span
        class="Apple-converted-space"> </span>Не є винятком, коли програміст
      пише метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, що виглядає як цей, та потім витрачає
        години, здогадуючись, чомі він не робить вірно</span>:</p>
    <p class="prebb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 0px; margin-bottom: 6.666667px; margin-left: 57.333336px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Поломане - параметр має бути Object!</strong><br>
      public boolean equals(MyClass o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="bullp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 42.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Проблема
      в тому, що цей метод <em>не перекриває </em><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object.equals</code>, чий
      аргумент має тип<span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Object</code>,
      але замість цього <em>перевантажує </em>його (<a href="ch8.xhtml#lev52"
        style="text-decoration: none;">Елемент 52</a>). Неприпустимо провадити
      такий “сувого типізований” метод<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        на додаток до звичайного, оскільки це може призвести до того, що
        анотації&nbsp;</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">Override</code> в
      субкласах будуть давати фальшивий позитивний результат, та провадити хибне
      уявлення про безпеку.</p>
    <p class="bullp" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 42.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Узгоджене
      використання анотацій <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Override</code>,
      як показане на протязі цього елементу, буде зопобігати від утворення
      помилок (<a href="ch6.xhtml#lev40" style="text-decoration: none;">Елемент
        40</a>). Метод <code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> не буде компілюватись, та повідомлення
        помилки буде казати вам, що саме пішло не так</span>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch3_images.xhtml#pch3ex20a" id="pch3ex20" style="text-decoration: none;">&nbsp;</a></p>
    <p class="prebb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 0px; margin-bottom: 6.666667px; margin-left: 57.333336px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Все
        ще поламане, але не буде компілюватись</strong><br>
      <strong>@Override</strong><span class="Apple-converted-space">&nbsp;</span>public
      boolean equals(MyClass o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Написання
      та тестування методів <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>(та<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">hashCode</code>)
      тонке, але отриманий код є необхідним. Чудовою альтернативою написанню та
      тестуванню ціх методів вручну є використання відкритого фреймворку
      Google&nbsp; AutoValue, що автоматично генерує ці методи для вас, що
      вмикається одною анотацією на класі. В більшості випадків методи,
      згенеровані AutoValue, будуть ідентичні до тих, що ви напишете руками.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">IDE,
також,
      мають можливості генерувати методи <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">hashCode</code>,
      але отриманий початковий код більш балакучий та складніший до читання, нуж
      код, що використовує&nbsp; AutoValue, не відстежує зміни в класі
      автоматично, і, таким чином, вимагає тестування. Тим не менш, генерація
      IDE <span class="Apple-converted-space">методів </span><code style="font-family: 'Courier New', monospace;">equals</code>(та<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">hashCode</code>)
      загалом краща, ніж реалізація їх вручну, оскільки IDE не роблять неуважних
      помилок, які роблять люди.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Підсумовуючи,
      не перекривайте метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> без потреби</span>: в багатьох випадках
      реалізація, наслідувана від <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">,
        робить саме те, що вам потрібно</span>. Якщо ви перекриваєте <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>,
      переконайтесь, що порівняли всі важливі поля класу, та порівняли їх в
      спосіб, що зберігає всі п'ять властивостей контракту <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_50"></span><strong>Елемент 11: Завжди
        перекривайте </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><span
        class="Apple-converted-space">, коли перекриваєте </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>equals</strong></code></h3>
    <p class="noindentb" style="margin-top: 0px; margin-bottom: 15px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Ви
        маєте перекрити </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><span
        class="Apple-converted-space"> </span><strong>в кожному класі, який
        перекриває </strong><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>equals</strong></code><strong>.</strong><span
        class="Apple-converted-space"> Якщо ви схибите зробити це, ваш клас буде
        порушувати головний контракт </span><code style="font-family: 'Courier New', monospace;">hashCode</code>,
      що буде запобігати потрібному функціонуванню в колекціях, як <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">HashMap</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">HashSet</code>.
      Ось контракт, адаптований зі специфікації <code style="font-family: 'Courier New', monospace;">Object</code>:</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Коли метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space"> постійно викликається на об'єкті під час
        виконання застосування, він має постійно повертати те саме значення,
        вважаючи, що інформація, використана в порівнянні не змінилась. Це
        значення не має бути тим самим від одного виконання застосування до
        іншого</span>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Якщо два об'єкти рівні згідно метода<span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"> equals(Object)</code>,
      тоді виклик <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space"> на двох об'єктах має продукувати той
        самий цілий результат</span>.</p>
    <p class="bull1" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 40px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Якщо два методи нерівні згідно метода <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals(Object)</code>, <em>не
        обов'язково </em>виклик <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">
        на кожному об'єкті має продукувати інший результат</span>. Однак
      програміст має бути попереджений, що продукування різних результатів для
      нерівних об'єктів може покращити продуктивність хеш таблиць.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Ключова
        засада, що порушується при відсутності перекриття </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><span
        class="Apple-converted-space"> </span><strong>є друга: рівні об'єкти
        мають рівні хеш коди.</strong><span class="Apple-converted-space"> Два
        різні примірники можуть бути логічно рівними, відповідно до методу </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> класу</span>, але щодо методу<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">hashCode</code>,
      вони лише два об'єкти, що не мають нічого спільного. Таким чином, метод <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space"> повертає два вочевидь випадкові числа,
        замість двох рівних чисел, як виммагається в контракті</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Наприклад,
      уявімо, що ви намагаєтесь використовувати примірники класу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">
        з Елементу 10, в якості ключів в </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">HashMap</code>:</p>
    <p class="preba" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 50.666668px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Map&lt;PhoneNumber,
      String&gt; m = new HashMap&lt;&gt;();<br>
      m.put(new PhoneNumber(707, 867, 5309), "Jenny");</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      цій точці ви можете очікувати, що <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">m.get(new PhoneNumber(707</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">867</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">5309))</code><span
        class="Apple-converted-space"> поверне</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">"Jenny"</code>,
      але замість цього він повертає <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">null</code>. Зауважте, що
      задіяні два примірники <code style="font-family: 'Courier New', monospace;">PhoneNumber</code>:
      один використано для вставки в <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">HashMap</code>, та
      другий, еквівалентний примірник, використаний для (спроби) отримання.
      Відмова класу <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space"> перекрити </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">
        призводить до того, що два рівні примірника мають нерівні хеш коди, </span>в
      порушення контракту <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">hashCode</code>.
      Таким чином, метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">get</code><span
        class="Apple-converted-space"> вірогідно шукатиме номер телефону в
        іншому бакеті хешу, відмінним від того, </span>в якому він був
      збережений методом <code style="font-family: 'Courier New', monospace;">put</code>.
      Навіть якщо два примірника випадково захешуються в один бакет, метод <code
        style="font-family: 'Courier New', monospace;">get</code><span class="Apple-converted-space">
        майже напевне поверне </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">null</code>, завдяки
      оптимізації<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">HashMap</code>has,
      що кешує хеш коди, асоційовані з кожним входженням, та не буде вовтузитись
      з рівністю об'єктів, якщо хеш коди не співпадають.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_51"></span>Вирішення цієї проблеми так
      само просте, як написати відповідний метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">
        для</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>.
      Так на що має бтуи схожий метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>?
      Тривіально написати поганий метод. Наприклад, настуний завжди легальний,
      але ніколи не буде використаний:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Найгірша з легальних реалізацій hashCode - ніколи не використовуйте!</strong><br>
      @Override public int hashCode() { return 42; }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      легально, бо це гарантує, що рівні об'єкти матимуть той самий хеш код. Це
      нелюдяно, бо дає гарантію, що <em>кожний </em>об'єкт матиме той самий
      хеш код. Таким чином, кожний об'єкт хешується в той самий бакет, і хеш
      таблиця дегенерує до пов'язаного списку. Програми, що мали б виконуватись
      за лінійний час, будуть виконуватись за квадратичний. Для великих хеш
      таблиць це різниця між робити та не робити.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Гарна
      хеш функція схильна продукувати нерівні хеш коди для нерівних примірників.
      Це саме те, що мається на увазі в третій частині контракту <code style="font-family: 'Courier New', monospace;">hashCode</code>.
      В ідеалі хеш функція має роподіляти любу доцільну колекцію на нерівні
      відстані одноманітно по всіх <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">int</code> значеннях.
      Досягнення цього ідеалу може бути складним. На щастя не дуже складно
      досягти чесної апроксимації. Ось простий рецепт:</p>
    <p class="number" style="margin-top: 0px; margin-bottom: 4px; margin-left: 20px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1.
      Декларуйте змінну <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space"> </span>на ім'я <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">result</code>, та
      ініціалізуйте її хеш кодом <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">c</code><span class="Apple-converted-space">
      </span>для першого значущого поля вашого об'єкта, як обчислено на кроці
      2.a. (Нагадайте собі з Елементу 10, що значуще поле є те, що впливає на
      порівняння рівності).</p>
    <p class="number" style="margin-top: 0px; margin-bottom: 4px; margin-left: 20px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2.
      Для кожного іншого значущого поля <code style="font-family: 'Courier New', monospace;">f</code><span
        class="Apple-converted-space"> вашого об'єкта зробіть наступне</span>:</p>
    <p class="alpha" style="margin-top: 0px; margin-bottom: 4px; margin-left: 41.333336px; text-indent: -17.333334px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">a.
      Обчіслять <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space"> хеш код</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">c</code><span
        class="Apple-converted-space"> для поля</span>:</p>
    <p class="roman" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 56px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">i.
Якщо
      поле примітивного типу, обчисліть <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><em>Type</em>.hashCode(f)</code>,
      де&nbsp;<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;"><em>Type</em></code><span
        class="Apple-converted-space"> є боксованим примітивним класом,
        відповідним до типу </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">f</code>.</p>
    <p class="roman1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 56px; text-indent: -14.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ii.
Якщо
      поле є об'єктним посиланням, та метод <code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space"> цього класу порівнює поле через
        рекурсивні виклики </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>, рекурсивно
      викличте <code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space"> для поля</span>. Якщо потрібне більш
      вкладне порівняння, обчисліть “канонічне представлення” для цього поля, та
      викличте <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">hashCode
        </code>на канонічній репрезентації. Якщо значення поля <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">null</code>,
      використовуйте<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">0</code><span
        class="Apple-converted-space">&nbsp;</span>(або любу іншу константу, але
      традиційно це <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">0</code>).</p>
    <p class="roman2" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 54.666668px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">iii.
      Якщо поле є масив, розглядайте його, якби кожний елемент був окремим
      полем. Тобто, обчисліть хеш код для кожного важливого елементу, через
      рекурсивне застосування ціх правил, та скомбінуйте значення згідно крока
      2.b. Якщо масив не має значущих елементів, використовуйте константу,
      бажано не <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">0</code>.
      Якщо всі елементи значущі, використовуйте <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Arrays.hashCode</code>.</p>
    <p class="alpha" style="margin-top: 0px; margin-bottom: 4px; margin-left: 41.333336px; text-indent: -17.333334px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">b.
Скомбінуйте
      хеш код <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">c,
        обчислений на кроці </code>2.a з <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">result</code><span class="Apple-converted-space">
        наступним чином</span>:</p>
    <p class="codep1" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 92px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">result
      = 31 * result + c;</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3.
      Поверніть<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">result</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_52"></span>Коли ви закінчите написання
      метода <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">hashCode</code>,
      запитайте себе, чи будуть однакові примірники мати однаковий хеш код.
      Напишіть юніт тести для перевірки вашої інтуіції (за винятком коли ви
      використовуєте AutoValue для генерації ваших методів <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">hashCode</code>,
      в якому випадку ви можете безпечно пропустити ці тести). Якщо рівні
      примірники мають неоднакові хеш коди, з'ясуйте в чому проблема, та
      вирішіть її.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ви
      можете виключити <em>похідні поля </em>з обчислень хеш коду. Іншими
      словами, ви можете ігнорувати любі поля, чиї значення можуть бути
      обчислені з полів, які включені в обчислення. Ви <em>маєте </em>виключити
      любі поля, що не приймають участі в обчисленні <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>, або ви
      ризикуєте порушити другу засаду контракту <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Множення
      на кроці 2.b робить результат залежним від порядку полів, даючи значно
      кращу хеш функцію, якщо клас має декілька подібних полів. Наприклад, якщо
      оминути множення для хеш функції<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">String</code>, всі
      анаграми матимуть ідентичні хеш коди. Значення 31 було обране, оскільки це
      непарне просте. Якщо це було б парне, та множення дало переповнення,
      інформація була б втрачена, оскільки множення на 2 еквівалентне до зсуву.
      Перевага використання простого менш зрозуміла, але це вже традиція. Гарна
      властивість&nbsp; числа 31 в тому, що множення можна замінити на зсув та
      відіймання для кращої продуктивності на деяких архитектурах:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">31 * i == (i &lt;&lt; 5)
        - i</code>. Сучасні VM роблять такий різновид оптимізації автоматично.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Давайте
      застосуємо попередній рецепт до класу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Типовий метод hashCode</strong><br>
      @Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int result = Short.hashCode(areaCode);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;result = 31 * result + Short.hashCode(prefix);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;result = 31 * result + Short.hashCode(lineNum);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Оскільки
      цей метод повертає результат простого детермінованого обчислення, на вхід
      якого надходять лише три значущі поля примірника <code style="font-family: 'Courier New', monospace;">PhoneNumber</code>,
      ясно, що еквівалентні примірники <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">
        мають однакові хеш коди</span>. Цей метод, фактично, є ідеально гарною
      реалізацією <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">hashCode</code>
      для примірників <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>,
      порівнянно з такими в бібліотеках Java платформи. Він простий, достатньо
      швидкий, та робить досить роботи по розпорошенню неоднакових номерів по
      різних хеш бакетах.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      рецепт в цьому елементі дає досить хороші хеш функції, вони не є витвором
      мистецтва. По якості їх можна порівняти&nbsp; з хеш функціями, що можна
      знайти на Java платформі в бібліотеці типів, та адекватні в більшості
      випадків. Якщо ви переконані, що вам потрібіні хеш функції, що з меншою
      вірогідністю продукують колізії, дивіться&nbsp; Guava’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">com.google.common.hash.Hashing</code><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rGuava" style="text-decoration: none;">Guava</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_53"></span>Клас<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Objects</code><span
        class="Apple-converted-space"> має статичний метод, що приймає довільне
        число об'єктів, та повертає хеш код для них</span>. Цей метод з назвою <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">hash</code>
      дозволяє вам писати однорядкові методи<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">, чия якість порівняна з тою, яку можна
        отримати завдяки застосуванню наданого вище рецепту. Нажаль, вони
        виконуються більш повільно, оскільки вони призводять до створення
        массиву, щоб передати змінне число аргументів, так само, як боксування
        та розбоксування, якщо деякі аргументи є примітивного типу. Цей стиль
        хеш функції рекомендований для використання тільки в ситуаціях, коли
        продуктивність некритична.</span> Ось хеш функція для <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space"></span>,
      написана з застосуванням цієї техніки:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Однорядковий метод hashCode - поміркована продуктивність</strong><br>
      @Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;return Objects.hash(lineNum, prefix, areaCode);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      клас незмінний, та вартість обчислення хеш коду є значною, ви можете
      розглянути кешування хеш коду в об'єкті, скоріше, ніж переобчислення його
      кожного разу, коли він потрібен. Якщо ви вважаєте, що більшість об'єктів
      цього типу будуть використані як хеш ключі, тоді вам потрібно обчислювати
      хеш код при створенні примірника. Інакше ви можете обрати <em>ліниву
        ініціалізацію</em><span class="Apple-converted-space"> </span>хеш коду
      при першому запиті хеш коду. Потрібно докласти певної уваги, щоб
      переконатись, що клас залишається потіко-безпечним в присутності ліниво
      ініціалізованого поля (Елемент 83). Наш клас<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space"> не підпадає під таку класифікацію</span>,
      але щоб просто показати, як це робиться, ось результат. Зауважте, що
      початкове значення поля<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">hashCode</code> (в цьому
      випадку 0) не повинне бути хеш кодом загально створюваного примірника:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        метод hashCode з ліниво ініціалізованим хеш кодом</strong><br>
      private int hashCode; // Автоматично ініціалізоване як 0<br>
      <br>
      @Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int result = hashCode;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (result == 0) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result =
      Short.hashCode(areaCode);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = 31 * result +
      Short.hashCode(prefix);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = 31 * result +
      Short.hashCode(lineNum);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hashCode = result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Не
        впадайте в спокусу виключити важливі поля з хеш коду для підвищення
        продуктивності.</strong><span class="Apple-converted-space"> Хоча
        отримана хеш функція може бути скорішою, </span>її низька якість може
      деградувати продуктивність хеш таблиць до межі, коли вони стануть
      непридатні для використання. Зокрема, хеш функція може зтикнутись з
      великою колекцією примірників, які відрізняються в основному в регіонах,
      які ви зібрались ігнорувати. Якщо це станеться, хеш функція буде
      відзеркалювати всі ці примірники на декілька хеш кодів, та програми, що
      мали б робити за лінійний час, будуть робити за квадратичний.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Це
      не тільки теоретична проблема. До Java 2 хеш функція <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">
        застосовувалась до щонайбільше шістнадцятьох символів, рівномірно
        розподілених по рядку, починаючи з першого символа. Для великих колекцій
        ієрархічних імен, як </span>URL, ця функція показувала саме ту
      патологічну поведінку, що описана вище.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Не
        провадьте детальну специфікацію для значення, що повертає </strong><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>hashCode</strong></code><strong>,
        так що клієнт не зможе досить залежати на нього; це дає вам гнучкість
        змінити її.</strong><span class="Apple-converted-space"> Багато класів в
        бібліотеках</span> Java, такі, як <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Integer</code>,
      вказують точне значення, що повертає їх метод<span style="font-family: &quot;Courier New&quot;,monospace;">
      </span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space"> як функцію від значення примірника</span>.
      Це <em>негарна </em>ідея, а помилка, з якою ми змушені жити: це виключає
      здатність покращити хеш функцію в наступних релізах. Якщо ви залишите
      деталі невизначеними, та буде знайдено слабкість в хеш функції, або її
      кращий варіант, ви можете змінити її в наступному релізі.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Підсумовуючи,
      ви <em>маєте </em>перекривати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">
        кожного разу, коли перекриваєте </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>, або ваша
      програма не буде робити коректно. Ваш метод<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space"> має підкорюватись головному контракту,
        вказаному в </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"></span>, та має виконувати доцільну
      роботу, присвоюючи нерівні хеш коди нарівним примірникам. Цього просто
      досягти, хоча і дещо тендітно, використовуючи рецепт, наведений вище. Як
      зазначалось в Елементі 10, фреймворк AutoValue провадить гарну
      альтернативу написанню методів <code style="font-family: 'Courier New', monospace;">quals</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space"> вручну</span>, та IDE також провадять
      деяку з цієї функціональності.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_55"></span><strong>Елемент 12: Завжди
        перекривайте</strong><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;"><strong>toString</strong></code></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> провадить реалізацію методу </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">toString</code>,
      рядок, що він повертає, загалом не є тим, що бажає бачити користувач. Він
      складається з імені класу, за яким слідує знак “at” (<code style="font-family: 'Courier New', monospace;">@</code>),
      та беззнакове шістнадцятеричне представлення хеш коду, наприклад, <code style="font-family: 'Courier New', monospace;">PhoneNumber@163b91</code>.
      Загальний контракт до <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space"> каже, що повернутий рядок повинен бути</span>
      “скороченим, але інформативним представленням, що може легко читатись
      людиною”. Хоча можна погодитись, що <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber@163b91</code><span
        class="Apple-converted-space"> стисле та просте для читання</span>, воно
      не дуже інформативне, коли порівняти з <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">707-867-5309</code>.
      Контракт <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">, продовжуючи, каже: </span>“Рекомендовано,
      щоб всі субкласи перекривали цей метод”. Безумовно, гарна порада!</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      це не так критично, як підкорення контрактам <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">hashCode</code>
      (Елементи 10 та 11),<span class="Apple-converted-space"> </span><strong>провадження
        реалізації </strong><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>toString</strong></code><strong>
        робить ваш клас значно приємнішим для використання, та робить системи,
        що використовують його, простішими в налаштуванні</strong>. Метод<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space"> викликається автоматично, коли об'єкт
        передається до</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">println</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">printf</code>, оператора
      конкатенації, або до<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">assert</code>,
      або друкується дебагером. Навіть якщо ви ніколи не викликаєте <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        на об'єкті, інші можуть це робити</span>. Наприклад, компонент, що має
      посилання на ваш об'єкт, може включати рядкове представлення об'єкта до
      повідомлення в журналі про помилку. Якщо ви схибите перекрити<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">toString</code>,
      повідомлення може бути незмістовним.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      ви провадите гарний метод<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        для</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>,
      генерація корисного діагностичного повідомлення буде простою:</p>
    <p class="preba" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 50.666668px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">System.out.println("Failed
      to connect to " + phoneNumber);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Програмісти
      будуть генерувати диагностичні повідомлення в цей спосіб, перевизначите
      ви&nbsp;<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">toString</code>,
      або ні, але в останньому випадку повідомлення не будуть корисними.
      Переваги від провадження гарного методу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        простягаються за межі примірників класу, до посилань об'єктів на ці
        примірники, особливо колекції</span>. Що ви швидше бажаєте побачити при
      друці мапи, <code style="font-family: 'Courier New', monospace;">{Jenny=PhoneNumber@163b91}</code><span
        class="Apple-converted-space"> або</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">{Jenny=707-867-5309}</code>?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Коли
        це практично, метод </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>toString</strong></code><span
        class="Apple-converted-space"> </span><strong>повинен првертати <em>всю
          </em>цікаву інформацію, що міститься в об'єкті</strong>, як показано в
      прикладі з номером телефону. Це непрактично, якщо об'єкт виликий, або якщо
      він містить стан, що не поєднується з рядковим представленням. За ціх умов
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space"> повинен повертати відсумкові дані, як </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Manhattan
        residential phone directory (1487536 номерів)</code><span class="Apple-converted-space">
        або</span> <code style="font-family: 'Courier New', monospace;">Thread[main,5,main]</code>.
      В ідеалі рядок повинен бути самодостатнім. (Приклад зі <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Thread</code><span class="Apple-converted-space">
        провалює цей тест</span>). Особливо докучливе покарання за невключення
      всіх цікавих полів об'єкту в рядкове представлення є повідомлення про
      схиблений тест такого вигляду:</p>
    <p class="preb" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Assertion
      failure: expected {abc, 123}, but was {abc, 123}.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Одне
      важливе рішення, яке ви маєте зробити при реалізації методу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">:
        чи вказувати формат значення, що повертається, в документації</span>.
      Рекомендується, щоб ви робили це для класів <em>значень, </em>таких, як
      телефонний номер або матриця. Перевага від вказання формату в тому, що це
      служить як стандартна, однозначна, читаєма людиною репрезентація об'єкту.
      Ця репрезентація може бути використана для вводу та виводу в вигляді
      стійких, читаємих людиною, об'єктів даних, як CSV файли. Якщо ви вкажете
      формат, загалом буде гарною ідеєю запровадити відповідну статичну фабрику
      або конструктор, так що програмісти зможуть легко транслювати в обидві
      боки між об'єктом та рядковим представленням. Цей підхід взятий з багатьох
      класів значень в бібліотеках платформи Java, включаючи<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">BigInteger</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigDecimal</code>,
      та більшість з боксованих примітивних класів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Недолік
      вказувати формат результату <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        в тому, що коли ви колись вже вкажете його, ви пристанете до нього на
        все життя, вважаючи, що ваш клас буде широко уживаний. Програмісти
        будуть писати код для розбору вашої репрезентації, генерувати її, та
        вбудовувати в стійкі дані. </span>Якщо ви зміните репрезентацію в
      майбутньому релізі, ви зруйнуєте їх код та дані, і вони заверещать. Якщо
      ви оберете не вказувати формат, ви збережете гнучкість додавати інформацію
      в формат в наступному релізі.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Чи
        вирішите ви вказувати формат, чи ні, вам слід ясно документувати свої
        наміри.</strong><span class="Apple-converted-space"> Якщо ви вказали
        формат, вам треба робити це з точністю</span>. Наприклад, ось метод <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">, що іде разом з класом</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>
      з Елемента 11:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">/**<br>
      &nbsp;* Повертає рядкову репрезентацію цього телефонного номера.<br>
      &nbsp;* Рядок складається з дванадцятьох символів, в форматі<br>
      &nbsp;* "XXX-YYY-ZZZZ", де XXX є кодом місцевості, YYY є префіксом,<br>
      &nbsp;* та ZZZZ є лінійним номером. Кожна з великих літер представляє<br>
      &nbsp;* одну десяткову цифру.<br>
      &nbsp;*<br>
      &nbsp;* Якщо кожна з трьох частин цього номеру замала для заповнення<br>
      &nbsp;* поля, поле доповнюється нулями зліва.<br>
      &nbsp;* Наприклад, якщо значення лінійного номера є 123, останні<br>
      &nbsp;* чотири цифри рядка репрезентації будуть "0123".<br>
      &nbsp;*/<br>
      @Override public String toString() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return String.format("%03d-%03d-%04d",<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;areaCode,
      prefix, lineNum);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_57"></span>Якщо ви вирішуєте не задавати
      формат, документуючий коментар повинен читатись приблизно наступним чином:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">/**<br>
      &nbsp;* Повертає скорочений опис цього напою. Точні деталі представлення<br>
      &nbsp;* не вказуються, та можуть змінюватись, але наступне може вважатись<br>
      &nbsp;* як типове:<br>
      &nbsp;*<br>
      &nbsp;* "[Potion #9: type=love, smell=turpentine, look=india ink]"<br>
      &nbsp;*/<br>
      @Override public String toString() { ... }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Після
      читання цього коментаря програмісти, що продукують код або зберігають
      дані, що залежить від формату, не зможуть звинувачувати нікого, окрім
      себе, якщо формат зміниться.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Чи
      задаєте ви формат, чи ні, <span class="Apple-converted-space"></span><strong>провадьте
        програмний доступ до інформації, що міститься в значенні, яке повертає </strong><code
        style="font-family: 'Courier New', monospace;"><strong>toString</strong></code><strong>.</strong><span
        class="Apple-converted-space"> Наприклад, клас </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">
        повинен мати аксессори для коду місцевості, префіксу та лінійного
        номеру. Якщо ви не зробите це, ви <em>примушуєте </em>програмістів,
        якім потрібна ця інформація, розбирати рядок. Крім зменшення
        продуктивоності, та зайвої роботи для програмістів, цей процес схильний
        до помилок, та призведе до крихкої системи, що зламається, якщо формат
        буде змінено</span>. Не надаючи аксессори ви перетворюєте рядковий
      формат на де-факто API, навіть якщо ви зазначили, що він може змінитись.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Має
      сенс написати метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space"> в статичному допоміжньому класі</span>
      (Елемент 4). Ви не повинні писати метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        для більшості типів </span>enum (Елемент 34), оскільки Java провадить
      довершено гарний варіант. Однак вам слідує написати метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        для любого абстрактного класу, чий субкласи поділяють загальне
        представлення рядка</span>. Наприклад, методи <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        для більшості з реалізацій колекцій наслідують від </span>абстрактних
      класів колекцій.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Інструмент
      з відкритим кодом Google AutoValue, описаний в Елементі 10, згенерує метод
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space">&nbsp; за вас, так само, як і більшість </span>IDE.
      Ці методи гарні для показу вас вмісту всіх полів, але не націлені на <em>значення
        </em>класу. Так що, наприклад, може бути неприйнятним використовувати
      згенерований метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space"> для класу </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">
      </span>(бо номери телефонів мають стандартну репрезентацію як рядок), але
      досить прийнятним для нашого класу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Potion</code>. При всьому
      тому, згенерований метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        значно кращий від наслідуваного від </span><code style="font-family: 'Courier New', monospace;">Object</code>,
      що не каже <em>зовсім нічого </em>про значення об'єкту.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Щоб
      підсумувати, перевизначайте реалізацію<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">toString</code><span
        class="Apple-converted-space"> в кожному класі, який ви пишете, за
        винятком того, що суерклас вже зробив це. Це робить класи значено більш
        приємними в використанні, та сприяє налаштуванню</span>. Метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">
        повинен повертати стислий, корисний опис об'єкта, в естетично приємному
        форматі</span>.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_58"></span><strong>Елемент 13: Розсудливо
        перекривайте </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><strong></strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Інтерфейс
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Cloneable</code><span
        class="Apple-converted-space"> був задуманий як </span><span class="Apple-converted-space"></span><em>інтерфейс-міксін</em><span
        class="Apple-converted-space"> </span>(Елемент 20) для класів, щоб
      повідомити, що вони можуть клонуватись. Нажаль, він схибив прислужитись
      цій ролі. Його головна хиба полягає в тому, що йому бракує метода <code style="font-family: 'Courier New', monospace;">clone</code>,
      та метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> є захищеним</span>. Ви не можете, не
      вдаючись до <em>рефлексії</em> (Елемент 65), викликати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
        на об'єкті, тільки через те, що він реалізує </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code>. Навіть
      рефлективний виклик може схибити, оскільки немає гарантії, що об'єкт має
      доступний метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code>.
      Не зважаючи на&nbsp; цю ваду, та багато інших, можливість набула досить
      широкого застосування, так що має сенс зрозуміти її. Цей елемент розкаже
      вам, як реалізувати метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
        з гарною поведінкою</span>, обговорює, коли має сенс це робити, та
      представляє альтернативи.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Так
      що ж <em>робить </em><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      зважаючи, що він не має методів? Він визначає поведінку захищеної
      реалізації<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Object</code>
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code>:
      якщо клас реалізує<span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">
        Cloneable</code>,<span class="Apple-converted-space"> метод </span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> повертає поле-за-полем копію об'єкту</span>;
      інакше це викликає <code style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code>.
      Це вкрай нетипове використання інтерфейсів, і не те, чому треба слідувати.
      Зазвичай, реалізація інтерфейсу каже, що клас може зробити для своїх
      клієнтів. В цьому випадку він модифікує поведінку захищеного методу
      суперкласа. </p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      специфікація не каже цього, <span class="Apple-converted-space"></span><strong>на
        практиці очікується, що клас, який реалізує </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>Cloneable</strong></code><span
        class="Apple-converted-space"></span><strong>, провадить відповідно
        функціонуючий публічний метод</strong><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><strong>.</strong><span
        class="Apple-converted-space"> Щоб досягти цього, клас, та всі його
        субкласи мають підкорятись складному, непримусовний, тонко
        документованому протоколу</span>. Результуючий механізм крихкий,
      небезпечний, та <em>екстралінгвістичний:</em> він створює об'єкти без
      виклику конструктора.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Головний
      контракт для метода <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> слабкий</span>. Ось він, скопійований зі
      специфікації<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Object</code>:</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Створює
      та повертає копію об'єкта. Точне значення "копії" може залежати від класу
      або об'єкту. Головний намір полягає в тому, щоб для об'єкта <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">x</code>, вираз</p>
    <p class="codepbi" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 9.333334px; margin-bottom: 9.333334px; margin-left: 32px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">x.clone()
      != x</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">був<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">true</code>,
      та вираз</p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">x.clone().getClass()
      == x.getClass()</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">був<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">true</code>,
      але це не абсолютна вимога. Хоча в типовому випадку </p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">x.clone().equals(x)</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">буде<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">true</code>,
      це не абсолютна вимога.</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_59"></span>За домовленістю, об'єкт, що
      повертає цей метод, має утворитись через виклик <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>. Якщо
      клас, та всі його суеркласи (виключаючи <code style="font-family: 'Courier New', monospace;">Object</code>)
      притримуються цієї домовленості, буде випадок, що</p>
    <p class="codep2" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 53.333336px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">x.clone().getClass()
      == x.getClass().</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">За
      домовленістю, об'єкт, що повертається, повинен бути незалежним від
      об'єкта, з якого він клонований. Щоб досягти цієї незалежності, може бути
      потрібним можифікувати одне або більше полів в об'єкті, повернутому з <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">super.clone</code><span
        class="Apple-converted-space"> перед його поверненням</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Цей
      механізм мляво подібний до сціплення конструкторів, за винятком того, що
      він непримусовний: якщо метод класу <code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> повертає примірник, що <em>не отриманий</em>
        від виклику</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">super.clone</code><span
        class="Apple-converted-space"></span>, але через виклик конструктора,
      компілятор не буде скаржитись, але якщо субклас цього класу викличе <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">super.clone</code>,
      отриманий об'єкт матиме невірний клас, перешкоджаючи субкласу вірно
      виконувати метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code>.
      Якщо клас, що перекриває <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
        є фінальним, ця домовленість може біти безпечно проігнорована, бо немає
        субкласів, про які треба турбуватись</span>. Але якщо фінальний клас має
      метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">, що не викликає </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>, для
      класу немає сенсу реалізувати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code>, бо він
      не покладається на поведінку <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code>&nbsp; в
      реалізації клонування.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Уявімо,
      що ви бажаєте реалізувати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">
        в класі, чий суперклас провадить гарно поводячий себе метод </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code>.
      Спершу викличте <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">super.clone</code>.
      Об'єкт, що ви отримаєте взамін, буде повністю функціональною реплікою
      оригіналу. Любі поля, декларовані в вашому класі, будуть мати значення,
      ідентичні до таких самих в оригіналі. Якщо кожне поле має примітивне
      значення, або посилання на незмінний об'єкт, повернутий об'єкт може бути
      саме тим, що вам потрібне, і в такому випадку подальша обробка непотрібна.
      Це випадок, наприклад, для класу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">
        з Елементу 11</span>, але зауважте, що <span class="Apple-converted-space"></span><strong>незмінні
        класи не повинні ніколи провадити метод </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space">, оскільки це буде невідворотно сприяти
        даремному копіюванню</span>. З урахуванням цього нюансу, ось як має
      виглядати метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone
        </code>для<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Метод
        clone для класу без посилань на змінний стан</strong><br>
      @Override public PhoneNumber clone() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (PhoneNumber)
      super.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (CloneNotSupportedException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      AssertionError();&nbsp;&nbsp;// Не може трапитись<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Для
      того, щоб цей метод робив, декларація класу для <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">
        має бути модифікованою, щоб вказати, що він реалізує</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Cloneable</code>.
      Хоча метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Object</code>,
      цей метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> повертає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>.
      Є легальним та бажаним робити це, оскільки Java підтримує <em>коваріантні
        типи повернення</em>. Іншими словами, перекриваючий метод повертає тип,
      що може бути субкласом типу повернення перекритого метода. Це уникає
      потреби кастингу на стороні клієнта. Ми маємо приводити результат <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">super.clone</code><span class="Apple-converted-space">
        з</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> до</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space"> перед поверненням</span>, але кастинг
      гарантовано буде успішним.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Виклик
      до <code style="font-family: 'Courier New', monospace;">super.clone</code><span
        class="Apple-converted-space"> зачинений в блок</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">try-catch</code>.
      Це тому що<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> декларує свій метод&nbsp;</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> що викликає </span><code style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code>,
      що є <em>перевіреним виключенням</em>. Оскільки <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">
        реалізує</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      ми знаємо, що виклик <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">super.clone
        буде успішним</code>. Потреба для цього шаблонного кода вказує, що
      виключення <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code><span
        class="Apple-converted-space"> ніколи не повинно залишитись
        неперевіреним</span> (Елемент 71).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщ
      об'єкт містить поля, що посилаються на змінні об'єкти, проста реалізація <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code>,
      показана вище, може бути руйнівною. Наприклад, розглянемо клас в Елементі
      7:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Stack {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Object[] elements;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int size = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int DEFAULT_INITIAL_CAPACITY
      = 16;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.elements = new
      Object[DEFAULT_INITIAL_CAPACITY];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(Object e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensureCapacity();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size++] = e;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Object pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object result =
      elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size] = null; //
      Видаляємо застаріле посилання<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Гарантуємо місце щонайменьше ще для одного
      елементу.<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private void ensureCapacity() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (elements.length ==
      size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements
      = Arrays.copyOf(elements, 2 * size + 1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Уявімо,
      що ми робимо цей клас клонованим. Якщо метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
        просто повертає</span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">
        super.clone()</code>, отриманий примірник <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">
      </span>буде мати коректне значення в полі розміру, але його елементи
      будуть посилатись на тай самий масив, що і оригінальний примірник <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Stack</code>. Модифікація
      оригіналу буде руйнувати інваріанти в клоні, і навпаки. Ви швидко
      зрозумієте, що ваша програма продукує нонсенс, або викликає <code style="font-family: 'Courier New', monospace;">NullPointerException</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      ситуація ніколи не може відбутись як результат виклику тільки конструктора
      класу <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Stack</code>.<span
        class="Apple-converted-space"> </span><strong>Насправді метод </strong><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space"> </span><strong>функціонує як
        конструктор; ви маєте переконатись, що він не шкодить оригінальному
        об'єктові, та що він відповідно встановлює інваріанти на клоні</strong>.
      Щоб метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> на</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space"> робив відповідно</span>, він має
      копіювати внутрощі стеку. Простіший шлях зробити це, є викликати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code> рекурсивно
      для елементів масиву:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Метод
        клонування для класу з посиланнями на змінний стан</strong><br>
      @Override public Stack clone() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stack result = (Stack)
      super.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.elements =
      elements.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (CloneNotSupportedException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      AssertionError();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зауважте,
      що не маємо робити кастинг результата<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">elements.clone</code><span
        class="Apple-converted-space"> до</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Object[]</code>.
      Виклик <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> на масиві повертає масив, в якого типи
        часу компіляції та виконання ідентичні до того масиву, що був
        клонований. Це переважна ідіома для дублікації масиву. Фактично, масиви
        є єдиним дієздатним використанням можливості клонування</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Також
      зауважте, що попереднє рішення не робить, якщо поле<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">elements</code><span
        class="Apple-converted-space"> буде</span> final, оскільки <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
      </span>буде заборонено присвоєння нового значення цьому полю. Це
      фундаментальна проблема: подібно до серіалізації,<span class="Apple-converted-space">
      </span><strong>архитектура </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>Cloneable</strong></code><span
        class="Apple-converted-space"> </span><strong>несумісна з нормальним
        використанням фінальних полів, що посилаються на змінні об'єкти</strong>,
      за винятком, коли змінні об'єкти можуть бути безпечно розділені між
      об'єктом та клоном. Щоб зробити клас клонованим, можливо знадобиться
      видалити модифікатор <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">final</code><span
        class="Apple-converted-space"> </span>для деякіх полів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Не
      завжди достатньо просто викликати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
        рекурсивно</span>. Наприклад, уявімо, що ви пишете метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
        для хеш таблиці, чиї внутрощі складаються з масива бакетів, кожний з
        яких посилається на перший елемент в зв'язаному списку пар
        ключ-значення. Для продуктивності клас реалізує свій власний,
        легковажний, зв'язаний список, замість внутрішнього використання </span>using<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.LinkedList</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class HashTable implements Cloneable {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Entry[] buckets = ...;<br>
      <span epub:type="pagebreak" id="page_62"></span>&nbsp;&nbsp;&nbsp;&nbsp;private
      static class Entry {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final Object key;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object value;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry&nbsp;&nbsp;next;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry(Object key, Object
      value, Entry next) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.key&nbsp;&nbsp;
      = key;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.value
      = value;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.next&nbsp;&nbsp;=
      next;&nbsp;&nbsp;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Залишок випущено<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Уявімо,
      ми просто склонували масив бакетів рекурсивно, як ми робили для <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Stack</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Поломаний метод clone - призводить до загального змінного стану!</strong><br>
      @Override public HashTable clone() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HashTable result =
      (HashTable) super.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.buckets =
      buckets.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (CloneNotSupportedException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      AssertionError();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Хоча
      клон має власний масив бакетів, цей масив повилається на ті самі списки,
      що і оригінал, що легко створить непередбачувану поведінку в обох, клоні
      та оригіналі. Щоб виправити цю проблему, ви маєте скопіювати зв'язані
      списки, що складають кожний бакет. Ось загальний підхід:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Рекурсивний метод клонування для класу зі складним змінним станом</strong><br>
      public class HashTable implements Cloneable {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private Entry[] buckets = ...;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static class Entry {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final Object key;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object value;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry&nbsp;&nbsp;next;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry(Object key, Object
      value, Entry next) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.key&nbsp;&nbsp;
      = key;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.value
      = value;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.next&nbsp;&nbsp;=
      next;&nbsp;&nbsp;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      <span epub:type="pagebreak" id="page_63"></span><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>// Рекурсивна
        копія зв'язаного списку від цього Entry</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry deepCopy() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      new Entry(key, value,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next
      == null ? null : next.deepCopy());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public HashTable clone() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HashTable
      result = (HashTable) super.clone();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.buckets
      = new Entry[buckets.length];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for
      (int i = 0; i &lt; buckets.length; i++)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if
      (buckets[i] != null)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.buckets[i]
      = buckets[i].deepCopy();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch
      (CloneNotSupportedException e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new AssertionError();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Залишок випущений<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Приватний
      клас <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">HashTable.Entry</code><span
        class="Apple-converted-space"> був розширений для підтримки методу </span>“глибокого
      копіювання”. Метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> для</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">HashTable</code><span
        class="Apple-converted-space"> розміщує масив нових бакетів відповідного
        розміру, та ітерує по масиву бакетів оригіналу</span>, глибоко копіюючи
      непусті бакети. Метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">deepCopy</code><span
        class="Apple-converted-space"> на&nbsp;</span> on<code style="font-family: 'Courier New', monospace;">Entry</code><span
        class="Apple-converted-space"> викликає себе, для копіювання цілого
        пов'язаного списку, що іде за цім елементом</span>. Хоча цей прийом
      втішний, і гарно робить, якщо бакети не задовгі, це не дуже гарний спосіб
      клонування зв'язаних списків, оскільки він споживає по одному фрейму стека
      для кожного елементу в списку. Якщо список довгий, ціе може просто
      привести до переповнення стеку. Щоб запобігти цьому, ви можете замінити
      рекурсію в <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">deepCopy</code><span
        class="Apple-converted-space"> на ітерацію</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Ітеративно копіює зв'язаний список, від цього Entry</strong><br>
      Entry deepCopy() {<br>
      &nbsp;&nbsp;&nbsp;Entry result = new Entry(key, value, next);<br>
      &nbsp;&nbsp;&nbsp;for (Entry p = result; p.next != null; p = p.next)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.next = new Entry(p.next.key,
      p.next.value, p.next.next);<br>
      &nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Фінальний
      підхід до клонування складних змінних об'єктів є виклик <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>,
      встановлення всіх полів в отриманому об'єкті в свій первинний стан, та
      потім виклик методів вищого рівня для відновлення стану оригінального
      об'єкту. В нашому випадку <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">HashTable</code>,
      поле&nbsp; <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">buckets</code><span
        class="Apple-converted-space"> може бути ініціалізоване новим масивом
        бакетів, та метод </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">put(key, value)</code><span
        class="Apple-converted-space"> </span>(не показаний) може бути
      викликаний для кожної пари ключ-значення в хеш таблиці, що клонується. Цей
      підхід типово дає простий, відносно елегантний метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">,
        що не робить так швидко, як той, що напряму маніпулює внутрощами клону</span>.
      Хоча цей підхід ясний, він протистоїть всій архитектурі <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">,
        оскільки він сліпо переписує копію об'єкта поле-за-полем, що складає
        базис архитектури.</span></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Як
      і конструктор, метод клонування має ніколи не викликати перевантажувані
      методи на клоні, що будується (Елемент 19). Якщо клон викликає метод, що
      перекритий в субкласі, цей метод буде викликатись до того, як субклас
      матиме шанс полагодити власний стан в клоні, що, досить вірогідно,
      призведе до пошкодження клона та оригіналу. Таким чином, метод<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">put(key,
        value)</code><span class="Apple-converted-space">, обговорений в
        попередньому параграфі, має бути або фінальним, або приватним. </span>(Якщо
      він приватний, він, можливо, є "допомжіний метод" для нефінального
      публічного метода).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><code
        style="font-family: 'Courier New', monospace;">Метод Object</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> декларований викликати </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code>,
      але перекриті методи не мають це робити.<span class="Apple-converted-space">
      </span><strong>Публічні методи </strong><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space"> </span><strong>повинні уникати
        твердження </strong><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>throws</strong></code>,
      бо методи, що не викликають перевірених виключень простіше використовувати
      (Елемент 71).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ви
      маєте два вибори при розробці класу для наслідування (Елемент 19), але
      який ви не оберете, клас має <em>не реалізувати </em><code style="font-family: 'Courier New', monospace;">Cloneable</code>.
      Ви можете обрати копіювати поведінку <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">,
        реалізуючи відповідно функціонуючий метод </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">,
        що декларований для виклику </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">CloneNotSupportedException</code>.
      Це дає субкласу свободу реалізувати <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">
        або ні</span>, так, якби він наслідував <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object </code>напряму.
      Альтернативно, ви можете обрати <em>не реалізувати </em>робочий метод <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code>,
      та запобігти субкласи від його реалізації, через провадження наступної
      виродженої реалізації <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">clone</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
метод
        клонування для розширюваного класу без підтримки Cloneable</strong><br>
      @Override<br>
      protected final Object clone() throws CloneNotSupportedException {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;throw new CloneNotSupportedException();<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Є
      ще одна деталь, що криється за всім цім. Якщо ви пишете потік-безпечний
      клас, що реалізує <code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      пам'ятайте, що його метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
        має бути відповідно синхронізований, так само, як любий інший метод</span>
      (Елемент 78).<span class="Apple-converted-space"> Метод </span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space"> не є синхронізованим, так що навіть коли
        його реалізація задовільняє вас в іншому, ви маєте писати
        синхронізований метод&nbsp;</span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">,
        що повертає</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">super.clone()</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Для
      підсумку, всі класи, що реалізують <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">,
        повинні перекрити </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">
        публічним методом, тип повернення якого є самий клас. Цей метод має
        спочатку викликати </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">super.clone</code>, та
      потім полагодити всі поля, що мають бути полагоджені. Типово, це означає
      копіювання всіх змінних об'єктів, що складають внутрішню “глибоку
      структуру” об'єкта, та заміну посилань клону на ці об'єкти на посилання на
      копії.<span class="Apple-converted-space"> Хоча ці внутрішні копії можуть
        зазвичай утворитись через рекурсивний виклик </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code>, але це не
      завжди кращий підхід. Якщо клас містить тільки примітивні поля, або
      посилання на незмінні об'єкти, тоді виглядає так, що наче поля не треба
      полагуджувати. Існують виключення з цього правила. Наприклад, поле, що
      представляє серійний номер, або інший унікальний ID, буде треба
      полагоджувати, навіть якщо він примітивний або незмінний.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Чи
      вся ця складність є необхідною? Рідко. Якщо ви розширюєте клас, що вже
      реалізує <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      ви маєте малий вибір, крім реалізації гарно поводячогось метода <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">clone</code>.
      З іншого блоку, вам часто буде краще запровадити альтернатівні шляхи для
      копіювання об'єктів.<span class="Apple-converted-space"> </span><strong>Кращий
        підхід до копіювання об'єктів буде провадження <em>копіюючого
          конструктора або копіюючої фабрики</em></strong><strong>.</strong><span
        class="Apple-converted-space"> </span>Копіюючий конструктор це просто
      конструктор, що приймає єдиний аргумент, чий тип є клас, що містить
      конструктор. Наприклад,</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Копіюючий
        конструктор</strong><br>
      public Yum(Yum yum) { ... };</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Копіююча
      фабрика є статичною фабрикою (Елемент 1), аналогічною до конструктора:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Копіююча
        фабрика</strong><br>
      public static Yum newInstance(Yum yum) { ... };</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Підхід
      копіюючого конструктора та варіант статичної фабрики мають багато переваг
      над <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Cloneable</code>/<code
        style="font-family: 'Courier New', monospace;">clone</code>: вони не
      покладаються на схильний до ризику екстралінгвістичний механізм створення
      об'єкту; вони не вимагають нездійсненного дотримання ретельно
      документованих конвенцій; вони не конфліктують з відповідним використанням
      фінальних полів; вони не викликають непотрібних перевірених виключень; та
      вони не потребують кастингу.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Більше
      того, конструктор копіювання або фабрика може приймати аргумент, чий тип є
      інтерфейсом, реалізованим в класі. Наприклад, за домовленостю всі колекції
      загального призначення провадять конструктор, чий аргмент має тип <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Collection</code><span class="Apple-converted-space">
        або</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Map</code>.
      Базовані на інтерфейсі копіюючі конструктори або фабрики, більш відомі як
      <em>перетворюючі конструктори </em>або <em>перетворюючі фабрики, </em>дозволяють
      клієнту обирати тип реалізації копії, замість примушувати клієнта приймати
      тип реалізації оригіналу. Наприклад, уявіть, що ви маєте&nbsp; <code style="font-family: 'Courier New', monospace;">HashSet</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">s</code>,
      та бажаєте зробити копію як <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">TreeSet</code>. Метод
      клонування не надасть цієї функціональності, але це легко робиться через
      конструктор перетворення:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">new TreeSet&lt;&gt;(s)</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Беручи
      до уваги всі проблеми, асоційовані з <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code>, нові
      інтерфейси не повинні розширювати його, та нові розширювані класи не
      повинні реалізувати його. Хоча це менш шкідливо для фінальних класів
      реалізувати <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Cloneable</code>,
      це треба розглядати як оптимізацію продуктивності, резервуючи для рідких
      випадків, коли це виправдано (Елемент 67). Як правило, функціональність
      копіювання краще провадити в конструкторах або фабриках. Варте уваги
      виключення з цього є масиви, що найкраще копіюються за допомогою метода
      clone.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_66"></span><strong>Елемент 14: Розгляньте
        реалізацію </strong><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>Comparable</strong></code></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">На
      відміну від інших методів, обговорених в цій главі, метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">
        не декларований в </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code>.
      Скоріше, це єдиний метод в інтерфейсі <code style="font-family: 'Courier New', monospace;">Comparable</code>.
      Він подібний за характром до метода <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code>,
      за тим винятком, що дозволяє також вказувати порівняння за порядком, на
      додаток до простої еквівалентності, та є дженеріком. Реалізуючи<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Comparable</code>,
      клас вказує, що його примірники мають <span class="Apple-converted-space"></span><em>природне
        впорядкування.</em><span class="Apple-converted-space"> Сортування
        масиву об'єктів, що реалізують</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">, таке просте, як це</span>:</p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Arrays.sort(a);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Так
      само легко шукати, обчислювати екстремуми значень, та підтримувати
      автоматично сортовані колекції об'єктів <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>.
      Наприклад, наступна програма, що покладається на факт, що <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">
        реалізує</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Comparable</code>,
      друкує впорядкований за алфавитом список аргументів командного рядка,
      виключаючи дублікати:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class WordList {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt; s = new
      TreeSet&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Collections.addAll(s,
      args);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Реалізуючи
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Comparable</code>
      ви дозволяєте вашому класу взаємодіяти з всіма із багатьох дженерік
      алгоритмів та реалізацій колекцій, що покладаються на цей інтерфейс. Ви
      отримуєте нечувану кількість потужності за невелику кількість зусиль.
      Віртуально всі з класів значень в бібліотеках платформи Java, так само, як
      і enum типи (Елемент 34), реалізують<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>. Якщо
      ви пишете класс значення з вочевидь природним впорядкуванням, як алфавітне
      впорядкування, числовий порядок, або хронологічний порядок, вам слідує
      реалізовати інтерфейс<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Comparable</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      interface Comparable&lt;T&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int compareTo(T t);<br>
      }</p>
    <p class="noindentb" style="margin-top: 0px; margin-bottom: 15px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Загальний
      контракт щодо метода <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> подібний до такого в </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>:</p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Порівнює
      цей об'єкт зі вказаним об'єктом щодо впорядкування. Повертає від'ємне,
      нуль або додатнє ціле, коли об'єкт менший за, рівний або більший за
      вказаний об'єкт. Підіймає <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">, якщо </span><span class="Apple-converted-space"><span
          class="Apple-converted-space">тип&nbsp; </span>вказаного об'єкту
        перешкоджає йому бути порівняним з цім об'єктом. <br>
      </span></p>
    <p class="indenti" style="margin-top: 6.666667px; margin-bottom: 6.666667px; margin-left: 18.666668px; text-indent: 0px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      наступному описі нотація <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">sgn</code>(<em>expression</em>)
      позначає математичну функцію <em>сігнум</em>, що визначена повертати<span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">-</code>1,
      0, або 1, відповідно до того, чи значення <span class="Apple-converted-space"></span><em>expression</em><span
        class="Apple-converted-space"> негативне (від'ємне)</span>, нуль, або
      позитивне (додатнє).</p>
    <p class="bull1i" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 32px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Реалізатоор має переконатись, що <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">sgn(x.compareTo(y)) ==
        -sgn(y. compareTo(x))</code><span class="Apple-converted-space"> для
        всіх </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">x</code><span
        class="Apple-converted-space"> </span>та<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">y</code>. (Це
      також передбачає, що<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">x.compareTo(y)
        </code>має викликати виключення, якщо і тільки якщо<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">y.compareTo(x)</code><span
        class="Apple-converted-space"> </span>викликає виключення).</p>
    <p class="bull1i" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 32px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Реалізатор має також переконатись, що відношення є транзитивним:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">(x. compareTo(y) &gt; 0
        &amp;&amp; y.compareTo(z) &gt; 0)</code><span class="Apple-converted-space">
        передбачає, що</span><code style="font-family: 'Courier New', monospace;">
        x.compareTo(z) &gt; 0</code>.</p>
    <p class="bull1i" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 32px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Нарешті, реалізатор має впевнитись, що <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">x.compareTo(y) == 0</code><span
        class="Apple-converted-space"> передбачає</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">sgn(x.compareTo(z))
        == sgn(y.compareTo(z))</code>, для всіх<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">z</code>.</p>
    <p class="bull1i" style="margin-top: 0px; margin-bottom: 9.333334px; margin-left: 32px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•
      Дуже рекомендовано, але не вимагається, що <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">(x.compareTo(y) == 0) ==
        (x.equals(y))</code>. Взагалі кажучи, любий клас, що реалізує інтерфейс
      <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">, та порушує цю умову, має ясно вказувати
        на цей факт</span>. Рекомендовано висловлюватись так: “Зауваження: цей
      клас має природне впорядкування, що неузгоджене з<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code>.”</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Не
      лякайтесь математичної природи цього контракту. Як і контракт<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code>
      (Елемент 10), цей контракт не такий складний, як виглядає. На відміну від
      метода <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>,
      що вводить глобальне відношення еквівалентності для всіх об'єктів, <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> не має робити між об'єктами різних типів</span>:
      коли стикається з об'єктами різних типів,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">
        дозволяється підіймати </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>.
      Звичайно, це саме те, що він і робить. Контракт <em>дозволяє </em>міжтипові
      порівняння, що зазвичай визначене в інтерфейсі, реалізованому об'єктами,
      що порівнюються.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Так
      само як клас, що порушує контракт <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">hashCode</code><span class="Apple-converted-space">,
        може зруйнувати інші класи, що залежать від хешування, клас, що порівнює
        контракт</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> може зруйнувати інші класи, що залежать
        від порівняння</span>. Класи, що залежать від порівняння, включають
      сортовані колекції<span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">
        TreeSet</code><span class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">TreeMap</code><span
        class="Apple-converted-space">, та допоміжні класи</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Collections</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Arrays</code>,
      що містять алгоритми пошуку та сортування.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Давайте
      пройдемось по засадах контракту <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compareTo</code>.
      Перша засада каже, що якщо ви зміните напрямок порівняння між двома
      об'єктними посиланнями, має трапитись очікуване: якщо перший об'єкт менший
      за другий, тоді другий має бути більший за перший; якщо перший дорівнює
      другому, то другий має дорівнювати першому; та якщо перший більший за
      другий, другий має бути менший за перший. Друга засада каже, що якщо
      об'єкт більше за другий, та другий більший за третій, тоді перший має бути
      більший за третій. Заключна засада каже, що всі об'єкти, що порівнюються
      як рівні, повинні давати той самий результат при порівнянні з любим іншим
      об'єктом.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_68"></span>Одне зі слідоцтв з ціх трьох
      засад є те, що тест на рівність, що накладає метод<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">, має підкорюватись тим самим обмеженням,
        що і контракт </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>:
      рефлективність, симетричність та транзитивність. Таким чином, виникає та
      сама особливість: немає способу розширити клас новим компонентом значення,
      зберігши при цьому контракт <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compareTo</code>, за
      винятком, коли ви бажаєте відмовитись від переваг об'єктно-орієнтовної
      абстракції (Елемент 10). Також існує той самий обхідний шлях. Якщо ви
      бажаєте додати компонент значення до класу, що реалізує <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>, не
      розлирюйте його; напишіть непов'язаний клас, що містить примірник першого
      класу. Потім впровадьте метод “перегляду”, що повертає той примірник. Це
      вивільняє вас реалізувати будь-який метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">,
        що вам сподобається, для класу контейнера, при цьому даючи його клієнтам
        перегляд примірника класу контейнера як примірник прихованого класу, за
        такої потреби</span>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Фінальний
      параграф контракту <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code>,
      є доброю порадою, скоріше, ніж дійсною вимогою, та просто стверджує, що
      тест на рівність, наданий методом<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">,
        загалом повинен повертати той самий результат, що і метод</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code>.
      Якщо підкорюватись цій засаді, впорядкування, накладене методом <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">,
        кажуть, буде <em>узгодженим з</em></span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><em>equals</em></code>.
      Якщо це порушити, кажуть, що впорядкування<span class="Apple-converted-space">
        <em>неузгоджене з</em></span><span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;"><em>equals</em></code>.
      Клас, метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> якого накладає порядок, неузгоджений з </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">, все ще буде робити</span>, але сортовані
      колекції, що містять елементи цього класу, можуть не підкорятись головному
      контракту відповідних інтерфейсів колекцій (<code style="font-family: 'Courier New', monospace;">Collection</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code>,
      або<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Map</code>).
      Це через те, що головний контракт ціх інтерфейсів визначений в термінах
      методу<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">equals</code>,
      але сортовані колекції використовують перевірку на рівність, накладену <span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">, замість </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>. Не буде
      катастрофою, якщо таке станеться, але це треба мати на увазі.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Наприклад,
      розглянемо клас<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">BigDecimal</code>,
      метод <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> якого неузгоджений з</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">equals</code>.
      Якщо ви створите пустий примірник <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">,
        та потім додасте </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">new BigDecimal("1.0")</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">new
        BigDecimal("1.00")</code>, множина буде містити два елементи, оскільки
      обидва примірники&nbsp;<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">,
        додані до множини, нерівні, якщо порівнювати через метод </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">equals</code>. Однак якщо
      ви виконаєте ту ж саму процедуру з використанням <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">TreeSet</code><span class="Apple-converted-space">
        замість</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">HashSet</code>,
      множина буде містити тільки один елемент, оскільки два примірника<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">BigDecimal</code><span
        class="Apple-converted-space"> рівні, коли порівнюютсья з використанням
        методу </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code>.
      (Дивіться документацію<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">BigDecimal</code><span
        class="Apple-converted-space"> щодо подробиць</span>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Написання
      метода <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> подібне до написання метода </span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">equals</code>,
      але декілька ключових різниць. Оскільки інтерфейс <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">
        параметризований</span>, метод<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">
        статично типизований, так що вам не треба перевіряти тип або приводити
        аргументи через кастинг. Якщо аргумент невірного типу, виклик даже не
        скомпілюється. Якщо аргумент є </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">null</code>, виклик
      повинен викликати виключення <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">NullPointer</code>, і він
      так і зробить, як тільки метод спробує отримати доступ до членів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">В
      методі <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> поля порівнюються для впорядкування,
        скоріше, ніж на рівність</span>. Щоб порівняти поля об'єктних посилань
      рекурсивно викликайте метод<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">compareTo</code>. Якщо
      поле не реалізовує <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">, </span>або вам треба нестандартне
      впорядкування, замість цього використовуйте<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Comparator</code>.
      Ви можете написати свій власний компаратор, або використати існуючий, як
      це зроблене в цьому методі<span class="Apple-converted-space"> </span><code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">
        для</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space"> в</span><span class="Apple-converted-space">
        Елементі 10</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Comparable одного поля з об'єктним посиланням</strong><br>
      public final class CaseInsensitiveString<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implements
      Comparable&lt;CaseInsensitiveString&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int compareTo(CaseInsensitiveString cis) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      String.CASE_INSENSITIVE_ORDER.compare(s, cis.s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Залишок випущено<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Зауважте,
      що <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code><span
        class="Apple-converted-space"> реалізує</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Comparable&lt;CaseInsensitiveString&gt;</code>.
      Це означає, що <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code>reference
      може бути порівняним тільки з іншим посиланням&nbsp;<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">CaseInsensitiveString</code>.
      Це звичайний шаблон, якому треба слідувати при декларації класу, що
      реалізує<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">Comparable</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Попередні
      редакції цієї книги рекомендували, щоб методи<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space">, порівнювали цілі примітивні поля з
        використанням операторів порівняння&nbsp;</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">&lt;</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">&gt;</code>,
      та поля з плаваючою крапкою з використанням методів<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Double.compare</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Float.compare</code>.
      В&nbsp; Java 7 були додані статичні методи <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compare</code><span class="Apple-converted-space">
        для всіх боксованих класів примітивів </span>Java.<span class="Apple-converted-space">
        <strong>Використання відносних операторів </strong></span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;"><strong>&lt;</strong></code><span
        class="Apple-converted-space"> <strong>та</strong></span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;"><strong>&gt;</strong></code><span
        class="Apple-converted-space"> <strong>в методах </strong></span><span
        class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;"><strong>compareTo</strong></code><span
        class="Apple-converted-space"> </span><strong>кашлате та схильне до
        помилок, і більше не рекомендується.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      клас має декілька значущих полів, порядок, в якому ви порівнюєте їх, є
      критичним. Починайте з найбільш важливого поля, та потім ідіть донизу.
      Якщо порівняння закінчується будь-чим, крім нуля (що означає рівність), ви
      скінчуєте порівняння; просто повертайте результат. Якщо найбільш важливе
      поле дає рівність, порівнюйте наступне не-таке-важливе поле. Ось метод <code
        style="font-family: 'Courier New', monospace;">compareTo</code><span class="Apple-converted-space">
        для класу</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space"> в Елементі 11</span><span class="Apple-converted-space">,
        що демонструє цей прийом</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
Comparable
        з багатьма примітивними полями</strong><br>
      public int compareTo(PhoneNumber pn) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int result = Short.compare(areaCode, pn.areaCode);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (result == 0)&nbsp;&nbsp;{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result =
      Short.compare(prefix, pn.prefix);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (result == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result
      = Short.compare(lineNum, pn.lineNum);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_70"></span>В Java 8 інтерфейс <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Comparator</code><span class="Apple-converted-space">
        був витіснений набором <em>методів побудови компаратора</em></span>, що
      дозволяє вільне конструювання компараторів. Ці компаратори потім можуть
      бути використані для реалізації методу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compareTo</code>,
      як того вимагає інтерфейс <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>. Багато
      програмістів обирають стислість цього підходу, хоче це іде з помірною
      ціною продуктивності: сортування масивів примірників<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>
      близько 10% повільніший на моїй машині. Коли використовувати цей підхід,
      розгляньте можливість використання можливості <em>статичного імпорту </em>Java,
      так що ви зможете посилатись на статичний метод конструктора компаратора
      через їх прості імена, заради ясності та краткості. Ось як <span class="Apple-converted-space">виглядатиме
        </span>метод<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> для </span><span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">
        при цьому підході</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Comparable з методами конструкторів компараторів</strong><br>
      private static final Comparator&lt;PhoneNumber&gt; COMPARATOR =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;comparingInt((PhoneNumber
      pn) -&gt; pn.areaCode)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.thenComparingInt(pn
      -&gt; pn.prefix)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.thenComparingInt(pn
      -&gt; pn.lineNum);<br>
      <br>
      public int compareTo(PhoneNumber pn) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return COMPARATOR.compare(this, pn);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Ця
      реалізаця будує компаратор під час ініціалізації класа, використовуючи два
      методи конструкції компаратора. Перша це <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">comparingInt</code>. Це
      статичний метод, що приймає <em>функцію екстрактор поля, </em>що
      відображує посилання на об'єкт на ключ типу<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space">, та повертає компаратор, що впорядковує
        примірники згідно цього ключа</span>. В попередньому прикладі <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">comparingInt</code><span
        class="Apple-converted-space"> приймає</span><span class="Apple-converted-space">
      </span><em>лямбду</em><span class="Apple-converted-space"> </span>(), що
      виділяє код місцевості з <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">,
        та повертає </span><span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Comparator&lt;PhoneNumber&gt;</code><span
        class="Apple-converted-space">, що впорядковує номери телефонів згідно
        кодам місцевості</span>. Зауважте, що лямбда явно вказує тип свого
      вхідного параметру (<code style="font-family: 'Courier New', monospace;">PhoneNumber
        pn</code>). В цій ситуації, як з'ясувалось, вивід типів Java не досить
      потужний, щоб самотужки вичислити тип, так що ми змушені допомагати йому,
      щоб програма могла скомпілюватись.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Якщо
      два номери телефонів мають той самий код місцевості, нам треба далі
      уточнити порівняння, і це саме те, що робить другий метод конструктора
      компаратоів,&nbsp;<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">thenComparingInt</code>.
      Це метод примірника на <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">Comparator</code><span
        class="Apple-converted-space">, що приймає функцію екстрактора ключ</span><span
        class="Apple-converted-space">а </span><code style="font-family: 'Courier New', monospace;">int</code>,
      та повертає компаратор, що спочатку застосовує оригінальний компаратор, та
      потім застосовує екстрагований ключ для подальшого уточнення. Ви можете
      накопичити стільки викликів <code style="font-family: 'Courier New', monospace;">thenComparingInt</code><span
        class="Apple-converted-space">, скільки побажаєте</span>, отримавши в
      результаті <em>лексографічне впорядкування</em>. В прикладі вище ми
      наклали два виклики<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">thenComparingInt</code>,
      де другий ключ є префікс, а третій ключ є лінійний номер. Зауважте, що ми
      <em>не мали вказувати </em>тип параметру ключа для функцій, переданих до
      викликів<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">thenComparingInt</code>:
      вивід типів&nbsp; Java був досить розумним, щоб з'ясувати це самостійно.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_71"></span>Клас<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">Comparator</code><span
        class="Apple-converted-space"> має повний комплект методів конструкції</span>.
      Існують аналоги до <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">comparingInt</code><span
        class="Apple-converted-space"> та</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">thenComparingInt</code><span
        class="Apple-converted-space"> </span>для примітивних типів <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">long</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">double</code>.
      Версії<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">int</code><span
        class="Apple-converted-space"> </span>можуть також бути використані для
      вужчих цілих типів, як <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">short</code>,
      як в нашому прикладі<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>.
      Версії<span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">double</code><span
        class="Apple-converted-space"> також можуть використовуватись для</span><span
        class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">float</code>.
      Це надає покриття всіх примітивних числових типів Java.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Також
      є методи конструкції компаратоів для типів об'єктних посилань. Статичний
      метод на ім'я <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">comparing</code>,
      що має два перевантаження. Одне приймає екстрактор ключа, та використовує
      природне порівняння за ключем. Другий приймає обоє, екстрактор ключа та
      компаратор, що буде застосований для екстрагованих ключів. Є три
      перевантаження методів примірника з назвою<span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">thenComparing</code>.
      Одне перевантаження приймає тільки компаратор, та використовує його для
      провадження вторинного впорядкування. Друге перевантаження приймає тільки
      екстрактор ключа, та використовує природней порівняння в якості вторинного
      впорядкування. Останнє перевантаження приймає обоє, екстрактор ключа та
      компаратор, що буде застосований до ціх ключів.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Можливо
      ви могли бачити методи <span class="Apple-converted-space"></span><code style="font-family: 'Courier New', monospace;">compareTo</code><span
        class="Apple-converted-space"> або</span><span class="Apple-converted-space">
      </span><code style="font-family: 'Courier New', monospace;">compare</code><span
        class="Apple-converted-space">, що покладаються на факт, що різниця між
        двома значеннями є негативною, якщо перше значення менше за друге, нулю
        якщо вони рівні, або позитивне, якщо перше значення більше. Ось приклад</span>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//&nbsp;</strong><strong><strong>ПОЛОМАН</strong>ИЙ
        компаратор на базі різниць - порушує транзитивність!</strong><br>
      static Comparator&lt;Object&gt; hashCodeOrder = new Comparator&lt;&gt;() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int compare(Object o1, Object o2) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return o1.hashCode() -
      o2.hashCode();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      };</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Не
      використовуйте цей прийом. Це пов'язане з загрозою цілого переповнення, та
      арифметичними артифактами плаваючої крапки IEEE 754 [<a href="ref.xhtml#rJLS"
        style="text-decoration: none;">JLS 15.20.1, 15.21.1</a>]. Більше того,
      отримані методи навряд чи будуть значно швидші, ніж ті, що описані в цьому
      елементі. Використовуйте або статичний метод <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compare</code>:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Компаратор, базований на статичному методі compare</strong><br>
      static Comparator&lt;Object&gt; hashCodeOrder = new Comparator&lt;&gt;() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int compare(Object o1, Object o2) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      Integer.compare(o1.hashCode(), o2.hashCode());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      };</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">або
      на методі конструкції компаратора:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Компаратор, базований на методі конструкції Comparator</strong><br>
      static Comparator&lt;Object&gt; hashCodeOrder =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Comparator.comparingInt(o
      -&gt; o.hashCode());</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_72"></span>Підсумовуючи, кожного разу,
      коли ви реалізуєте класс-значення, що має осмислене впорядкування, вам
      слідує реалізовати в класі інтерфейс <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>, так що
      його примірники&nbsp; можуть бути легко впорядковані, знайдені, та
      використані в базованих на порівнянні колекціях. Коли порівнюєте значення
      полів в реалізаціях методу <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">compareTo</code>,
      уникайте використання операторів <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">&lt;</code><span class="Apple-converted-space">
        та</span><span class="Apple-converted-space"> </span><code style="font-family: 'Courier New', monospace;">&gt;</code>.
      Замість цього використовуйте методи порівняння в боксованих класах для
      примітивів, або методи конструювання компараторів в інтерфейсі <span class="Apple-converted-space"></span><code
        style="font-family: 'Courier New', monospace;">Comparator</code>.</p>
    <p></p>
    <p> </p>
    <h2 class="h2" id="ch4" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Глава
      4. Класи та інтерфейси</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Класи
      та інтерфейси лежать в серці мови програмування Java. Вони є базовими They
      are its basic units of abstraction. The language provides many powerful
      elements that you can use to design classes and interfaces. This chapter
      contains guidelines to help you make the best use of these elements so
      that your classes and interfaces are usable, robust, and flexible.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev15" style="text-decoration: none;"></a><strong>Item 15: Minimize
        the accessibility of classes and members</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      single most important factor that distinguishes a well-designed component
      from a poorly designed one is the degree to which the component hides its
      internal data and other implementation details from other components. A
      well-designed component hides all its implementation details, cleanly
      separating its API from its implementation. Components then communicate
      only through their APIs and are oblivious to each others’ inner workings.
      This concept, known as<span class="Apple-converted-space">&nbsp;</span><em>information
        hiding</em><span class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><em>encapsulation</em>,
      is a fundamental tenet of software design [<a href="ref.xhtml#rParnas72" style="text-decoration: none;">Parnas72</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Information
      hiding is important for many reasons, most of which stem from the fact
      that it<span class="Apple-converted-space">&nbsp;</span><em>decouples</em><span
        class="Apple-converted-space">&nbsp;</span>the components that comprise
      a system, allowing them to be developed, tested, optimized, used,
      understood, and modified in isolation. This speeds up system development
      because components can be developed in parallel. It eases the burden of
      maintenance because components can be understood more quickly and debugged
      or replaced with little fear of harming other components. While
      information hiding does not, in and of itself, cause good performance, it
      enables effective performance tuning: once a system is complete and
      profiling has determined which components are causing performance problems
      (<a href="ch9.xhtml#lev67" style="text-decoration: none;">Item 67</a>),
      those components can be optimized without affecting the correctness of
      others. Information hiding increases software reuse because components
      that aren’t tightly coupled often prove useful in other contexts besides
      the ones for which they were<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_74"></span>developed. Finally,
      information hiding decreases the risk in building large systems because
      individual components may prove successful even if the system does not.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Java
      has many facilities to aid in information hiding. The<span class="Apple-converted-space">&nbsp;</span><em>access
        control</em><span class="Apple-converted-space">&nbsp;</span>mechanism
      [JLS, 6.6] specifies the<span class="Apple-converted-space">&nbsp;</span><em>accessibility</em><span
        class="Apple-converted-space">&nbsp;</span>of classes, interfaces, and
      members. The accessibility of an entity is determined by the location of
      its declaration and by which, if any, of the access modifiers (<code style="font-family: 'Courier New', monospace;">private</code>,<code
        style="font-family: 'Courier New', monospace;">protected</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">public</code>)
      is present on the declaration. Proper use of these modifiers is essential
      to information hiding.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      rule of thumb is simple:<span class="Apple-converted-space">&nbsp;</span><strong>make
        each class or member as inaccessible as possible.</strong><span class="Apple-converted-space">&nbsp;</span>In
      other words, use the lowest possible access level consistent with the
      proper functioning of the software that you are writing.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      top-level (non-nested) classes and interfaces, there are only two possible
      access levels:<span class="Apple-converted-space">&nbsp;</span><em>package-private</em><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><em>public</em>.
      If you declare a top-level class or interface with the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">public</code><span class="Apple-converted-space">&nbsp;</span>modifier,
      it will be public; otherwise, it will be package-private. If a top-level
      class or interface can be made package-private, it should be. By making it
      package-private, you make it part of the implementation rather than the
      exported API, and you can modify it, replace it, or eliminate it in a
      subsequent release without fear of harming existing clients. If you make
      it public, you are obligated to support it forever to maintain
      compatibility.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      a package-private top-level class or interface is used by only one class,
      consider making the top-level class a private static nested class of the
      sole class that uses it (<a href="ch4.xhtml#lev24" style="text-decoration: none;">Item
        24</a>). This reduces its accessibility from all the classes in its
      package to the one class that uses it. But it is far more important to
      reduce the accessibility of a gratuitously public class than of a
      package-private top-level class: the public class is part of the package’s
      API, while the package-private top-level class is already part of its
      implementation.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      members (fields, methods, nested classes, and nested interfaces), there
      are four possible access levels, listed here in order of increasing
      accessibility:</p>
    <p class="bullb1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>private</strong>—The
      member is accessible only from the top-level class where it is declared.</p>
    <p class="bullb1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>package-private</strong>—The
      member is accessible from any class in the package where it is declared.
      Technically known as<span class="Apple-converted-space">&nbsp;</span><em>default</em><span
        class="Apple-converted-space">&nbsp;</span>access, this is the access
      level you get if no access modifier is specified (except for interface
      members, which are public by default).</p>
    <p class="bullb1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>protected</strong>—The
      member is accessible from subclasses of the class where it is declared
      (subject to a few restrictions [JLS, 6.6.2]) and from any class in the
      package where it is declared.</p>
    <p class="bullb1" style="margin-top: 0px; margin-bottom: 6.666667px; margin-left: 20px; text-indent: -10.666667px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">•<span
        class="Apple-converted-space">&nbsp;</span><strong>public</strong>—The
      member is accessible from anywhere.</p>
    <p class="indentt" style="margin-top: 13.333334px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_75"></span>After carefully designing your
      class’s public API, your reflex should be to make all other members
      private. Only if another class in the same package really needs to access
      a member should you remove the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">private</code><span class="Apple-converted-space">&nbsp;</span>modifier,
      making the member package-private. If you find yourself doing this often,
      you should reexamine the design of your system to see if another
      decomposition might yield classes that are better decoupled from one
      another. That said, both private and package-private members are part of a
      class’s implementation and do not normally impact its exported API. These
      fields can, however, “leak” into the exported API if the class implements<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch12.xhtml#lev86" style="text-decoration: none;">Items
        86</a><span class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><a
        href="ch12.xhtml#lev87" style="text-decoration: none;">87</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      members of public classes, a huge increase in accessibility occurs when
      the access level goes from package-private to protected. A protected
      member is part of the class’s exported API and must be supported forever.
      Also, a protected member of an exported class represents a public
      commitment to an implementation detail (<a href="ch4.xhtml#lev19" style="text-decoration: none;">Item
        19</a>). The need for protected members should be relatively rare.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is a key rule that restricts your ability to reduce the accessibility of
      methods. If a method overrides a superclass method, it cannot have a more
      restrictive access level in the subclass than in the superclass [JLS,
      8.4.8.3]. This is necessary to ensure that an instance of the subclass is
      usable anywhere that an instance of the superclass is usable (the<span class="Apple-converted-space">&nbsp;</span><em>Liskov
        substitution principle</em>, see<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev15" style="text-decoration: none;">Item 15</a>). If
      you violate this rule, the compiler will generate an error message when
      you try to compile the subclass. A special case of this rule is that if a
      class implements an interface, all of the class methods that are in the
      interface must be declared public in the class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      facilitate testing your code, you may be tempted to make a class,
      interface, or member more accessible than otherwise necessary. This is
      fine up to a point. It is acceptable to make a private member of a public
      class package-private in order to test it, but it is not acceptable to
      raise the accessibility any higher. In other words, it is not acceptable
      to make a class, interface, or member a part of a pack-age’s exported API
      to facilitate testing. Luckily, it isn’t necessary either because tests
      can be made to run as part of the package being tested, thus gaining
      access to its package-private elements.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Instance
        fields of public classes should rarely be public</strong><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch4.xhtml#lev16" style="text-decoration: none;">Item 16</a>). If
      an instance field is nonfinal or is a reference to a mutable object, then
      by making it public, you give up the ability to limit the values that can
      be stored in the field. This means you give up the ability to enforce
      invariants involving the field. Also, you give up the ability to take any
      action when the field is modified, so<span class="Apple-converted-space">&nbsp;</span><strong>classes
        with public mutable fields are not generally thread-safe.</strong><span
        class="Apple-converted-space">&nbsp;</span>Even if a field is final and
      refers to an immutable object, by making it public you give up the
      flexibility to switch to a new internal data representation in which the
      field does not exist.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_76"></span>The same advice applies to
      static fields, with one exception. You can expose constants via public
      static final fields, assuming the constants form an integral part of the
      abstraction provided by the class. By convention, such fields have names
      consisting of capital letters, with words separated by underscores (<a href="ch9.xhtml#lev68"
        style="text-decoration: none;">Item 68</a>). It is critical that these
      fields contain either primitive values or references to immutable objects
      (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Item 17</a>). a
      field containing a reference to a mutable object has all the disadvantages
      of a nonfinal field. While the reference cannot be modified, the
      referenced object can be modified—with disastrous results.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that a nonzero-length array is always mutable, so<span class="Apple-converted-space">&nbsp;</span><strong>it
        is wrong for a class to have a public static final array field, or an
        accessor that returns such a field.</strong><span class="Apple-converted-space">&nbsp;</span>If
      a class has such a field or accessor, clients will be able to modify the
      contents of the array. This is a frequent source of security holes:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex1a" id="pch4ex1" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Potential security hole!</strong><br>
      public static final Thing[] VALUES = { ... };</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Beware
      of the fact that some IDEs generate accessors that return references to
      private array fields, resulting in exactly this problem. There are two
      ways to fix the problem. You can make the public array private and add a
      public immutable list:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex2a" id="pch4ex2" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">private
      static final Thing[] PRIVATE_VALUES = { ... };<br>
      public static final List&lt;Thing&gt; VALUES =<br>
&nbsp;&nbsp;&nbsp;Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Alternatively,
      you can make the array private and add a public method that returns a copy
      of a private array:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex3a" id="pch4ex3" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">private
      static final Thing[] PRIVATE_VALUES = { ... };<br>
      public static final Thing[] values() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return PRIVATE_VALUES.clone();<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      choose between these alternatives, think about what the client is likely
      to do with the result. Which return type will be more convenient? Which
      will give better performance?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      of Java 9, there are two additional, implicit access levels introduced as
      part of the<span class="Apple-converted-space">&nbsp;</span><em>module
        system</em>. A module is a grouping of packages, like a package is a
      grouping of classes. A module may explicitly export some of its packages
      via<span class="Apple-converted-space">&nbsp;</span><em>export
        declarations</em><span class="Apple-converted-space">&nbsp;</span>in its<span
        class="Apple-converted-space">&nbsp;</span><em>module declaration</em><span
        class="Apple-converted-space">&nbsp;</span>(which is by convention
      contained in a source file named<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">module-info.java</code>).
      Public and protected members of unexported packages in a module are
      inaccessible outside the module; within the<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_77"></span>module, accessibility is
      unaffected by export declarations. Using the module system allows you to
      share classes among packages within a module without making them visible
      to the entire world. Public and protected members of public classes in
      unexported packages give rise to the two implicit access levels, which are
      intramodular analogues of the normal public and protected levels. The need
      for this kind of sharing is relatively rare and can often be eliminated by
      rearranging the classes within your packages.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Unlike
      the four main access levels, the two module-based levels are largely
      advisory. If you place a module’s JAR file on your application’s class
      path instead of its module path, the packages in the module revert to
      their non-modular behavior: all of the public and protected members of the
      packages’ public classes have their normal accessibility, regardless of
      whether the packages are exported by the module [Reinhold, 1.2]. The one
      place where the newly introduced access levels are strictly enforced is
      the JDK itself: the unexported packages in the Java libraries are truly
      inaccessible outside of their modules.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Not
      only is the access protection afforded by modules of limited utility to
      the typical Java programmer, and largely advisory in nature; in order to
      take advantage of it, you must group your packages into modules, make all
      of their dependencies explicit in module declarations, rearrange your
      source tree, and take special actions to accommodate any access to
      non-modularized packages from within your modules [Reinhold, 3]. It is too
      early to say whether modules will achieve widespread use outside of the
      JDK itself. In the meantime, it seems best to avoid them unless you have a
      compelling need.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      summarize, you should reduce accessibility of program elements as much as
      possible (within reason). After carefully designing a minimal public API,
      you should prevent any stray classes, interfaces, or members from becoming
      part of the API. With the exception of public static final fields, which
      serve as constants, public classes should have no public fields. Ensure
      that objects referenced by public static final fields are immutable.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev16" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_78"></span><strong>Item 16: In public classes, use accessor
        methods, not public fields</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Occasionally,
      you may be tempted to write degenerate classes that serve no purpose other
      than to group instance fields:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex4a" id="pch4ex4" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Degenerate classes like this should not be public!</strong><br>
      class Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public double x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public double y;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      the data fields of such classes are accessed directly, these classes do
      not offer the benefits of<span class="Apple-converted-space">&nbsp;</span><em>encapsulation</em><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch4.xhtml#lev15" style="text-decoration: none;">Item
        15</a>). You can’t change the representation without changing the API,
      you can’t enforce invariants, and you can’t take auxiliary action when a
      field is accessed. Hard-line object-oriented programmers feel that such
      classes are anathema and should always be replaced by classes with private
      fields and public<span class="Apple-converted-space">&nbsp;</span><em>accessor
        methods</em><span class="Apple-converted-space">&nbsp;</span>(getters)
      and, for mutable classes,<span class="Apple-converted-space">&nbsp;</span><em>mutators</em><span
        class="Apple-converted-space">&nbsp;</span>(setters):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex5a" id="pch4ex5" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Encapsulation of data by accessor methods and mutators</strong><br>
      class Point {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private double x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private double y;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Point(double x, double y) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.x = x;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.y = y;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public double getX() { return x; }</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public double getY() { return y; }</strong><br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public void setX(double x) { this.x = x; }</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public void setY(double y) { this.y = y; }</strong><br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Certainly,
      the hard-liners are correct when it comes to public classes:<span class="Apple-converted-space">&nbsp;</span><strong>if
        a class is accessible outside its package, provide accessor methods</strong><span
        class="Apple-converted-space">&nbsp;</span>to preserve the flexibility
      to change the class’s internal representation. If a public class exposes
      its data fields, all hope of changing its representation is lost because
      client code can be distributed far and wide.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">However,<span
        class="Apple-converted-space">&nbsp;</span><strong>if a class is
        package-private or is a private nested class, there is nothing
        inherently wrong with exposing its data fields</strong>—assuming they do
      an<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_79"></span>adequate job of describing the abstraction provided
      by the class. This approach generates less visual clutter than the
      accessor-method approach, both in the class definition and in the client
      code that uses it. While the client code is tied to the class’s internal
      representation, this code is confined to the package containing the class.
      If a change in representation becomes desirable, you can make the change
      without touching any code outside the package. In the case of a private
      nested class, the scope of the change is further restricted to the
      enclosing class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Several
      classes in the Java platform libraries violate the advice that public
      classes should not expose fields directly. Prominent examples include the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Point</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dimension</code><span class="Apple-converted-space">&nbsp;</span>classes
      in the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.awt</code><span
        class="Apple-converted-space">&nbsp;</span>package. Rather than examples
      to be emulated, these classes should be regarded as cautionary tales. As
      described in<span class="Apple-converted-space">&nbsp;</span><a href="ch9.xhtml#lev67"
        style="text-decoration: none;">Item 67</a>, the decision to expose the
      internals of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Dimension</code><span
        class="Apple-converted-space">&nbsp;</span>class resulted in a serious
      performance problem that is still with us today.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      it’s never a good idea for a public class to expose fields directly, it is
      less harmful if the fields are immutable. You can’t change the
      representation of such a class without changing its API, and you can’t
      take auxiliary actions when a field is read, but you can enforce
      invariants. For example, this class guarantees that each instance
      represents a valid time:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex6a" id="pch4ex6" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Public class with exposed immutable fields - questionable</strong><br>
      public final class Time {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int
      HOURS_PER_DAY&nbsp;&nbsp;&nbsp;&nbsp;= 24;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int MINUTES_PER_HOUR = 60;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public final int hour;</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public final int minute;</strong><br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Time(int hour, int minute) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (hour &lt; 0 || hour
      &gt;= HOURS_PER_DAY)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new
      IllegalArgumentException("Hour: " + hour);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (minute &lt; 0 ||
      minute &gt;= MINUTES_PER_HOUR)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw new
      IllegalArgumentException("Min: " + minute);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.hour = hour;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.minute = minute;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder omitted<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, public classes should never expose mutable fields. It is less
      harmful, though still questionable, for public classes to expose immutable
      fields. It is, however, sometimes desirable for package-private or private
      nested classes to expose fields, whether mutable or immutable.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev17" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_80"></span><strong>Item 17: Minimize mutability</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">An
      immutable class is simply a class whose instances cannot be modified. All
      of the information contained in each instance is fixed for the lifetime of
      the object, so no changes can ever be observed. The Java platform
      libraries contain many immutable classes, including<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>, the boxed
      primitive classes, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigDecimal</code>.
      There are many good reasons for this: Immutable classes are easier to
      design, implement, and use than mutable classes. They are less prone to
      error and are more secure.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make a class immutable, follow these five rules:</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1.<span
        class="Apple-converted-space">&nbsp;</span><strong>Don’t provide methods
        that modify the object’s state</strong><span class="Apple-converted-space">&nbsp;</span>(known
      as<span class="Apple-converted-space">&nbsp;</span><em>mutators</em>).</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2.<span
        class="Apple-converted-space">&nbsp;</span><strong>Ensure that the class
        can’t be extended.</strong><span class="Apple-converted-space">&nbsp;</span>This
      prevents careless or malicious subclasses from compromising the immutable
      behavior of the class by behaving as if the object’s state has changed.
      Preventing subclassing is generally accomplished by making the class
      final, but there is an alternative that we’ll discuss later.</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">3.<span
        class="Apple-converted-space">&nbsp;</span><strong>Make all fields
        final.</strong><span class="Apple-converted-space">&nbsp;</span>This
      clearly expresses your intent in a manner that is enforced by the system.
      Also, it is necessary to ensure correct behavior if a reference to a newly
      created instance is passed from one thread to another without
      synchronization, as spelled out in the<em>memory model</em><span class="Apple-converted-space">&nbsp;</span>[JLS,
      17.5; Goetz06, 16].</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">4.<span
        class="Apple-converted-space">&nbsp;</span><strong>Make all fields
        private.</strong><span class="Apple-converted-space">&nbsp;</span>This
      prevents clients from obtaining access to mutable objects referred to by
      fields and modifying these objects directly. While it is technically
      permissible for immutable classes to have public final fields containing
      primitive values or references to immutable objects, it is not recommended
      because it precludes changing the internal representation in a later
      release (<a href="ch4.xhtml#lev15" style="text-decoration: none;">Items 15</a><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev16" style="text-decoration: none;">16</a>).</p>
    <p class="numberb" style="margin-top: 0px; margin-bottom: 13.333334px; margin-left: 33.333336px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">5.<span
        class="Apple-converted-space">&nbsp;</span><strong>Ensure exclusive
        access to any mutable components.</strong><span class="Apple-converted-space">&nbsp;</span>If
      your class has any fields that refer to mutable objects, ensure that
      clients of the class cannot obtain references to these objects. Never
      initialize such a field to a client-provided object reference or return
      the field from an accessor. Make<span class="Apple-converted-space">&nbsp;</span><em>defensive
        copies</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch8.xhtml#lev50"
        style="text-decoration: none;">Item 50</a>) in constructors, accessors,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readObject</code><span
        class="Apple-converted-space">&nbsp;</span>methods (<a href="ch12.xhtml#lev88"
        style="text-decoration: none;">Item 88</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      of the example classes in previous items are immutable. One such class is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code><span
        class="Apple-converted-space">&nbsp;</span>in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev11" style="text-decoration: none;">Item 11</a>, which
      has accessors for each attribute but no corresponding mutators. Here is a
      slightly more complex example:</p>
    <span epub:type="pagebreak" id="page_81" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex7a" id="pch4ex7" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Immutable complex number class</strong><br>
      public<span class="Apple-converted-space">&nbsp;</span><strong>final</strong>&nbsp;&nbsp;class
      Complex {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private final</strong>&nbsp;&nbsp;double
      re;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private final</strong>&nbsp;&nbsp;double
      im;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex(double re, double im) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.re = re;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.im = im;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public double
      realPart()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ return re; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public double imaginaryPart() { return im; }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex plus(Complex c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex(re +
      c.re, im + c.im);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex minus(Complex c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex(re -
      c.re, im - c.im);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex times(Complex c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex(re *
      c.re - im * c.im,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      re * c.im + im * c.re);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Complex dividedBy(Complex c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double tmp = c.re * c.re +
      c.im * c.im;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex((re *
      c.re + im * c.im) / tmp,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      (im * c.re - re * c.im) / tmp);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (o == this)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!(o instanceof Complex))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Complex c = (Complex) o;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // See page 47 to find out why we use
      compare instead of ==<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Double.compare(c.re, re) == 0<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;&amp;
      Double.compare(c.im, im) == 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 31 *
      Double.hashCode(re) + Double.hashCode(im);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public String toString() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return "(" + re + " + " +
      im + "i)";<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_82"></span>This class represents a<span class="Apple-converted-space">&nbsp;</span><em>complex
        number</em><span class="Apple-converted-space">&nbsp;</span>(a number
      with both real and imaginary parts). In addition to the standard<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods,
      it provides accessors for the real and imaginary parts and provides the
      four basic arithmetic operations: addition, subtraction, multiplication,
      and division. Notice how the arithmetic operations create and return a new<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Complex</code><span
        class="Apple-converted-space">&nbsp;</span>instance rather than
      modifying this instance. This pattern is known as the<em>functional</em><span
        class="Apple-converted-space">&nbsp;</span>approach because methods
      return the result of applying a function to their operand, without
      modifying it. Contrast it to the<span class="Apple-converted-space">&nbsp;</span><em>procedural</em>or<span
        class="Apple-converted-space">&nbsp;</span><em>imperative</em><span class="Apple-converted-space">&nbsp;</span>approach
      in which methods apply a procedure to their operand, causing its state to
      change. Note that the method names are prepositions (such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">plus</code>) rather than
      verbs (such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">add</code>).
      This emphasizes the fact that methods don’t change the values of the
      objects. The<code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>classes
      did<span class="Apple-converted-space">&nbsp;</span><em>not</em><span class="Apple-converted-space">&nbsp;</span>obey
      this naming convention, and it led to many usage errors.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      functional approach may appear unnatural if you’re not familiar with it,
      but it enables immutability, which has many advantages.<strong>Immutable
        objects are simple.</strong><span class="Apple-converted-space">&nbsp;</span>An
      immutable object can be in exactly one state, the state in which it was
      created. If you make sure that all constructors establish class
      invariants, then it is guaranteed that these invariants will remain true
      for all time, with no further effort on your part or on the part of the
      programmer who uses the class. Mutable objects, on the other hand, can
      have arbitrarily complex state spaces. If the documentation does not
      provide a precise description of the state transitions performed by
      mutator methods, it can be difficult or impossible to use a mutable class
      reliably.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Immutable
        objects are inherently thread-safe; they require no synchronization.</strong><span
        class="Apple-converted-space">&nbsp;</span>They cannot be corrupted by
      multiple threads accessing them concurrently. This is far and away the
      easiest approach to achieve thread safety. Since no thread can ever
      observe any effect of another thread on an immutable object,<span class="Apple-converted-space">&nbsp;</span><strong>immutable
        objects can be shared freely.</strong><span class="Apple-converted-space">&nbsp;</span>Immutable
      classes should therefore encourage clients to reuse existing instances
      wherever possible. One easy way to do this is to provide public static
      final constants for commonly used values. For example, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Complex</code><span class="Apple-converted-space">&nbsp;</span>class
      might provide these constants:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex8a" id="pch4ex8" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static final Complex ZERO = new Complex(0, 0);<br>
      public static final Complex ONE&nbsp;&nbsp;= new Complex(1, 0);<br>
      public static final Complex I&nbsp;&nbsp;&nbsp;&nbsp;= new Complex(0, 1);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      approach can be taken one step further. An immutable class can provide
      static factories (<a href="ch2.xhtml#lev1" style="text-decoration: none;">Item
        1</a>) that cache frequently requested instances to avoid creating new
      instances when existing ones would do. All the boxed primitive classes and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>do this. Using such static
      factories causes clients to share instances instead of creating new ones,
      reducing memory footprint and garbage collection<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_83"></span>costs. Opting for static
      factories in place of public constructors when designing a new class gives
      you the flexibility to add caching later, without modifying clients.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      consequence of the fact that immutable objects can be shared freely is
      that you never have to make<span class="Apple-converted-space">&nbsp;</span><em>defensive
        copies</em><span class="Apple-converted-space">&nbsp;</span>of them (<a
        href="ch8.xhtml#lev50" style="text-decoration: none;">Item 50</a>). In
      fact, you never have to make any copies at all because the copies would be
      forever equivalent to the originals. Therefore, you need not and should
      not provide a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clone</code><span
        class="Apple-converted-space">&nbsp;</span>method or<span class="Apple-converted-space">&nbsp;</span><em>copy
        constructor</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch3.xhtml#lev13"
        style="text-decoration: none;">Item 13</a>) on an immutable class. This
      was not well understood in the early days of the Java platform, so the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>class does have a copy
      constructor, but it should rarely, if ever, be used (<a href="ch2.xhtml#lev6"
        style="text-decoration: none;">Item 6</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Not
        only can you share immutable objects, but they can share their
        internals.</strong><span class="Apple-converted-space">&nbsp;</span>For
      example, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>class uses a sign-magnitude
      representation internally. The sign is represented by an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code>, and the
      magnitude is represented by an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>array.
      The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">negate</code><span
        class="Apple-converted-space">&nbsp;</span>method produces a new<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">&nbsp;</span>of
      like magnitude and opposite sign. It does not need to copy the array even
      though it is mutable; the newly created<code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>points to the same internal
      array as the original.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Immutable
        objects make great building blocks for other objects,</strong><span class="Apple-converted-space">&nbsp;</span>whether
      mutable or immutable. It’s much easier to maintain the invariants of a
      complex object if you know that its component objects will not change
      underneath it. A special case of this principle is that immutable objects
      make great map keys and set elements: you don’t have to worry about their
      values changing once they’re in the map or set, which would destroy the
      map or set’s invariants.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Immutable
        objects provide failure atomicity for free</strong><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch10.xhtml#lev76" style="text-decoration: none;">Item 76</a>).
      Their state never changes, so there is no possibility of a temporary
      inconsistency.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The
        major disadvantage of immutable classes is that they require a separate
        object for each distinct value.</strong><span class="Apple-converted-space">&nbsp;</span>Creating
      these objects can be costly, especially if they are large. For example,
      suppose that you have a million-bit<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">&nbsp;</span>and
      you want to change its low-order bit:</p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BigInteger
      moby = ...;<br>
      moby = moby.flipBit(0);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">flipBit</code><span
        class="Apple-converted-space">&nbsp;</span>method creates a new<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code><span class="Apple-converted-space">&nbsp;</span>instance,
      also a million bits long, that differs from the original in only one bit.
      The operation requires time and space proportional to the size of the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code>.
      Contrast this to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.BitSet</code>.
      Like<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BitSet</code><span
        class="Apple-converted-space">&nbsp;</span>represents an arbitrarily
      long sequence of bits, but unlike<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BitSet</code><span class="Apple-converted-space">&nbsp;</span>is
      mutable. The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BitSet</code><span
        class="Apple-converted-space">&nbsp;</span>class provides a method that
      allows you to change the state of a single bit of a million-bit instance
      in constant time:</p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">BitSet
      moby = ...;<br>
      moby.flip(0);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_84"></span>The performance problem is
      magnified if you perform a multistep operation that generates a new object
      at every step, eventually discarding all objects except the final result.
      There are two approaches to coping with this problem. The first is to
      guess which multistep operations will be commonly required and to provide
      them as primitives. If a multistep operation is provided as a primitive,
      the immutable class does not have to create a separate object at each
      step. Internally, the immutable class can be arbitrarily clever. For
      example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>has a package-private mutable
      “companion class” that it uses to speed up multistep operations such as
      modular exponentiation. It is much harder to use the mutable companion
      class than to use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code>,
      for all of the reasons outlined earlier. Luckily, you don’t have to use
      it: the implementors of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigInteger</code>did the
      hard work for you.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      package-private mutable companion class approach works fine if you can
      accurately predict which complex operations clients will want to perform
      on your immutable class. If not, then your best bet is to provide a<span class="Apple-converted-space">&nbsp;</span><em>public</em><span
        class="Apple-converted-space">&nbsp;</span>mutable companion class. The
      main example of this approach in the Java platform libraries is the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>class,
      whose mutable companion is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">StringBuilder</code><span
        class="Apple-converted-space">&nbsp;</span>(and its obsolete
      predecessor,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">StringBuffer</code>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      that you know how to make an immutable class and you understand the pros
      and cons of immutability, let’s discuss a few design alternatives. Recall
      that to guarantee immutability, a class must not permit itself to be
      subclassed. This can be done by making the class final, but there is
      another, more flexible alternative. Instead of making an immutable class
      final, you can make all of its constructors private or package-private and
      add public static factories in place of the public constructors (<a href="ch2.xhtml#lev1"
        style="text-decoration: none;">Item 1</a>). To make this concrete,
      here’s how<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Complex</code><span
        class="Apple-converted-space">&nbsp;</span>would look if you took this
      approach:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex9a" id="pch4ex9" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Immutable class with static factories instead of constructors</strong><br>
      public class Complex {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final double re;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final double im;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private</strong><span class="Apple-converted-space">&nbsp;</span>Complex(double
      re, double im) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.re = re;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.im = im;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>public static Complex valueOf(double re,
        double im)</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Complex(re,
      im);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Remainder unchanged<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_85"></span>This approach is often the
      best alternative. It is the most flexible because it allows the use of
      multiple package-private implementation classes. To its clients that
      reside outside its package, the immutable class is effectively final
      because it is impossible to extend a class that comes from another package
      and that lacks a public or protected constructor. Besides allowing the
      flexibility of multiple implementation classes, this approach makes it
      possible to tune the performance of the class in subsequent releases by
      improving the object-caching capabilities of the static factories.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      was not widely understood that immutable classes had to be effectively
      final when<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>were
      written, so all of their methods may be overridden. Unfortunately, this
      could not be corrected after the fact while preserving backward
      compatibility. If you write a class whose security depends on the
      immutability of a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>argument
      from an untrusted client, you must check to see that the argument is a
      “real”<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code>, rather
      than an instance of an untrusted subclass. If it is the latter, you must
      defensively copy it under the assumption that it might be mutable (<a href="ch8.xhtml#lev50"
        style="text-decoration: none;">Item 50</a>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex10a" id="pch4ex10" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static BigInteger safeInstance(BigInteger val) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return val.getClass() == BigInteger.class ?<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;val
      : new BigInteger(val.toByteArray());<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      list of rules for immutable classes at the beginning of this item says
      that no methods may modify the object and that all its fields must be
      final. In fact these rules are a bit stronger than necessary and can be
      relaxed to improve performance. In truth, no method may produce an<em>externally
        visible</em><span class="Apple-converted-space">&nbsp;</span>change in
      the object’s state. However, some immutable classes have one or more
      nonfinal fields in which they cache the results of expensive computations
      the first time they are needed. If the same value is requested again, the
      cached value is returned, saving the cost of recalculation. This trick
      works precisely because the object is immutable, which guarantees that the
      computation would yield the same result if it were repeated.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhoneNumber</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code><span
        class="Apple-converted-space">&nbsp;</span>method (<a href="ch3.xhtml#lev11"
        style="text-decoration: none;">Item 11</a>, page 53) computes the hash
      code the first time it’s invoked and caches it in case it’s invoked again.
      This technique, an example of<span class="Apple-converted-space">&nbsp;</span><em>lazy
        initialization</em><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch11.xhtml#lev83" style="text-decoration: none;">Item 83</a>), is
      also used by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      caveat should be added concerning serializability. If you choose to have
      your immutable class implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>and it contains one or more
      fields that refer to mutable objects, you must provide an explicit<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">readObject</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readResolve</code><span
        class="Apple-converted-space">&nbsp;</span>method, or use the<code style="font-family: 'Courier New', monospace;">ObjectOutputStream.writeUnshared</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_86"></span><code style="font-family: 'Courier New', monospace;">ObjectInputStream.readUnshared</code><span
        class="Apple-converted-space">&nbsp;</span>methods, even if the default
      serialized form is acceptable. Otherwise an attacker could create a
      mutable instance of your class. This topic is covered in detail in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch12.xhtml#lev88" style="text-decoration: none;">Item 88</a>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      summarize, resist the urge to write a setter for every getter.<span class="Apple-converted-space">&nbsp;</span><strong>Classes
        should be immutable unless there’s a very good reason to make them
        mutable.</strong><span class="Apple-converted-space">&nbsp;</span>Immutable
      classes provide many advantages, and their only disadvantage is the
      potential for performance problems under certain circumstances. You should
      always make small value objects, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">PhoneNumber</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Complex</code>,
      immutable. (There are several classes in the Java platform libraries, such
      as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.Date</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.awt.Point</code>,
      that should have been immutable but aren’t.) You should seriously consider
      making larger value objects, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code>,
      immutable as well. You should provide a public mutable companion class for
      your immutable class<span class="Apple-converted-space">&nbsp;</span><em>only</em><span
        class="Apple-converted-space">&nbsp;</span>once you’ve confirmed that
      it’s necessary to achieve satisfactory performance (<a href="ch9.xhtml#lev67"
        style="text-decoration: none;">Item 67</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are some classes for which immutability is impractical.<span class="Apple-converted-space">&nbsp;</span><strong>If
        a class cannot be made immutable, limit its mutability as much as
        possible.</strong><span class="Apple-converted-space">&nbsp;</span>Reducing
      the number of states in which an object can exist makes it easier to
      reason about the object and reduces the likelihood of errors. Therefore,
      make every field final unless there is a compelling reason to make it
      nonfinal. Combining the advice of this item with that of<a href="ch4.xhtml#lev15"
        style="text-decoration: none;">Item 15</a>, your natural inclination
      should be to<span class="Apple-converted-space">&nbsp;</span><strong>declare
        every field</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>private final</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>unless there’s a good
        reason to do otherwise.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Constructors
        should create fully initialized objects with all of their invariants
        established.</strong><span class="Apple-converted-space">&nbsp;</span>Don’t
      provide a public initialization method separate from the constructor or
      static factory unless there is a<span class="Apple-converted-space">&nbsp;</span><em>compelling</em><span
        class="Apple-converted-space">&nbsp;</span>reason to do so. Similarly,
      don’t provide a “reinitialize” method that enables an object to be reused
      as if it had been constructed with a different initial state. Such methods
      generally provide little if any performance benefit at the expense of
      increased complexity.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">CountDownLatch</code><span
        class="Apple-converted-space">&nbsp;</span>class exemplifies these
      principles. It is mutable, but its state space is kept intentionally
      small. You create an instance, use it once, and it’s done: once the
      countdown latch’s count has reached zero, you may not reuse it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      final note should be added concerning the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Complex</code><span class="Apple-converted-space">&nbsp;</span>class
      in this item. This example was meant only to illustrate immutability. It
      is not an industrial-strength complex number implementation. It uses the
      standard formulas for complex multiplication and division, which are not
      correctly rounded and provide poor semantics for complex NaNs and
      infinities [<a href="ref.xhtml#rKahan91" style="text-decoration: none;">Kahan91</a>,<span
        class="Apple-converted-space">&nbsp;</span><a href="ref.xhtml#rSmith62"
        style="text-decoration: none;">Smith62</a>,<span class="Apple-converted-space">&nbsp;</span><a
        href="ref.xhtml#rThomas94" style="text-decoration: none;">Thomas94</a>].</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev18" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_87"></span><strong>Item 18: Favor composition over inheritance</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Inheritance
      is a powerful way to achieve code reuse, but it is not always the best
      tool for the job. Used inappropriately, it leads to fragile software. It
      is safe to use inheritance within a package, where the subclass and the
      superclass implementations are under the control of the same programmers.
      It is also safe to use inheritance when extending classes specifically
      designed and documented for extension (<a href="ch4.xhtml#lev19" style="text-decoration: none;">Item
        19</a>). Inheriting from ordinary concrete classes across package
      boundaries, however, is dangerous. As a reminder, this book uses the word
      “inheritance” to mean<em>implementation inheritance</em><span class="Apple-converted-space">&nbsp;</span>(when
      one class extends another). The problems discussed in this item do not
      apply to<span class="Apple-converted-space">&nbsp;</span><em>interface
        inheritance</em><span class="Apple-converted-space">&nbsp;</span>(when a
      class implements an interface or when one interface extends another).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Unlike
        method invocation, inheritance violates encapsulation</strong><span class="Apple-converted-space">&nbsp;</span>[<a
        href="ref.xhtml#rSnyder86" style="text-decoration: none;">Snyder86</a>].
      In other words, a subclass depends on the implementation details of its
      superclass for its proper function. The superclass’s implementation may
      change from release to release, and if it does, the subclass may break,
      even though its code has not been touched. As a consequence, a subclass
      must evolve in tandem with its superclass, unless the superclass’s authors
      have designed and documented it specifically for the purpose of being
      extended.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make this concrete, let’s suppose we have a program that uses a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>. To tune
      the performance of our program, we need to query the<code style="font-family: 'Courier New', monospace;">HashSet</code><span
        class="Apple-converted-space">&nbsp;</span>as to how many elements have
      been added since it was created (not to be confused with its current size,
      which goes down when an element is removed). To provide this
      functionality, we write a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>variant
      that keeps count of the number of attempted element insertions and exports
      an accessor for this count. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>class
      contains two methods capable of adding elements,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addAll</code>,
      so we override both of these methods:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex11a" id="pch4ex11" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Поломане - Inappropriate use of inheritance!</strong><br>
      public class InstrumentedHashSet&lt;E&gt; extends HashSet&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// The number of attempted element insertions<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int addCount = 0;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public InstrumentedHashSet() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public InstrumentedHashSet(int initCap, float
      loadFactor) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(initCap,
      loadFactor);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean add(E e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addCount++;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return super.add(e);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean addAll(Collection&lt;?
      extends E&gt; c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addCount += c.size();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return super.addAll(c);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int getAddCount() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return addCount;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      class looks reasonable, but it doesn’t work. Suppose we create an instance
      and add three elements using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method.
      Incidentally, note that we create a list using the static factory method<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List.of</code>,
      which was added in Java 9; if you’re using an earlier release, use<code style="font-family: 'Courier New', monospace;">Arrays.asList</code><span
        class="Apple-converted-space">&nbsp;</span>instead:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex12a" id="pch4ex12" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">InstrumentedHashSet&lt;String&gt;
      s = new InstrumentedHashSet&lt;&gt;();<br>
      s.addAll(List.of("Snap", "Crackle", "Pop"));</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">We
      would expect the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getAddCount</code><span
        class="Apple-converted-space">&nbsp;</span>method to return three at
      this point, but it returns six. What went wrong? Internally,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code>method is
      implemented on top of its<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>method,
      although<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code>,
      quite reasonably, does not document this implementation detail. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code>method in<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Instrumented-HashSet</code><span
        class="Apple-converted-space">&nbsp;</span>added three to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addCount</code><span class="Apple-converted-space">&nbsp;</span>and
      then invoked<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addAll</code><span
        class="Apple-converted-space">&nbsp;</span>implementation using<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">super.addAll</code>. This
      in turn invoked the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>method,
      as overridden in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">InstrumentedHashSet</code>,
      once for each element. Each of these three invocations added one more to<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addCount</code>,
      for a total increase of six: each element added with the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method
      is double-counted.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">We
      could “fix” the subclass by eliminating its override of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method.
      While the resulting class would work, it would depend for its proper
      function on the fact that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method
      is implemented on top of its<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>method.
      This “self-use” is an implementation detail, not guaranteed to hold in all
      implementations of the Java platform and subject to change from release to
      release. Therefore, the resulting<code style="font-family: 'Courier New', monospace;">InstrumentedHashSet</code><span
        class="Apple-converted-space">&nbsp;</span>class would be fragile.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      would be slightly better to override the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">addAll</code><span class="Apple-converted-space">&nbsp;</span>method
      to iterate over the specified collection, calling the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">add</code><span class="Apple-converted-space">&nbsp;</span>method
      once for each element. This would guarantee the correct result whether or
      not<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addAll</code><span
        class="Apple-converted-space">&nbsp;</span>method were implemented atop
      its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">add</code><span
        class="Apple-converted-space">&nbsp;</span>method because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>’s<code style="font-family: 'Courier New', monospace;">addAll</code><span
        class="Apple-converted-space">&nbsp;</span>implementation would no
      longer be invoked. This technique, however, does not solve all our
      problems. It amounts to reimplementing superclass methods that may or may
      not<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_88"></span>result in self-use, which is difficult,
      time-consuming, error-prone, and may reduce performance. Additionally, it
      isn’t always possible because some methods cannot be implemented without
      access to private fields inaccessible to the subclass.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      related cause of fragility in subclasses is that their superclass can
      acquire new methods in subsequent releases. Suppose a program depends for
      its security on the fact that all elements inserted into some collection
      satisfy some predicate. This can be guaranteed by subclassing the
      collection and overriding each method capable of adding an element to
      ensure that the predicate is satisfied before adding the element. This
      works fine until a new method capable of inserting an element is added to
      the superclass in a subsequent release. Once this happens, it becomes
      possible to add an “illegal” element merely by invoking the new method,
      which is not overridden in the subclass. This is not a purely theoretical
      problem. Several security holes of this nature had to be fixed when<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Hashtable</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Vector</code><span
        class="Apple-converted-space">&nbsp;</span>were retrofitted to
      participate in the Collections Framework.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Both
      of these problems stem from overriding methods. You might think that it is
      safe to extend a class if you merely add new methods and refrain from
      overriding existing methods. While this sort of extension is much safer,
      it is not without risk. If the superclass acquires a new method in a
      subsequent release and you have the bad luck to have given the subclass a
      method with the same signature and a different return type, your subclass
      will no longer compile [JLS, 8.4.8.3]. If you’ve given the subclass a
      method with the same signature and return type as the new superclass
      method, then you’re now overriding it, so you’re subject to the problems
      described earlier. Furthermore, it is doubtful that your method will
      fulfill the contract of the new superclass method, because that contract
      had not yet been written when you wrote the subclass method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Luckily,
      there is a way to avoid all of the problems described above. Instead of
      extending an existing class, give your new class a private field that
      references an instance of the existing class. This design is called<span class="Apple-converted-space">&nbsp;</span><em>composition</em><span
        class="Apple-converted-space">&nbsp;</span>because the existing class
      becomes a component of the new one. Each instance method in the new class
      invokes the corresponding method on the contained instance of the existing
      class and returns the results. This is known as<span class="Apple-converted-space">&nbsp;</span><em>forwarding</em>,
      and the methods in the new class are known as<span class="Apple-converted-space">&nbsp;</span><em>forwarding
        methods</em>. The resulting class will be rock solid, with no
      dependencies on the implementation details of the existing class. Even
      adding new methods to the existing class will have no impact on the new
      class. To make this concrete, here’s a replacement for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedHashSet</code><span
        class="Apple-converted-space">&nbsp;</span>that uses the
      composition-and-forwarding approach. Note that the implementation is
      broken into two pieces, the class itself and a reusable<span class="Apple-converted-space">&nbsp;</span><em>forwarding
        class,</em><span class="Apple-converted-space">&nbsp;</span>which
      contains all of the forwarding methods and nothing else:</p>
    <span epub:type="pagebreak" id="page_89" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex13a" id="pch4ex13" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Wrapper class - uses composition in place of inheritance</strong><br>
      public class InstrumentedSet&lt;E&gt; extends ForwardingSet&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int addCount = 0;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public InstrumentedSet(Set&lt;E&gt; s) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(s);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean add(E e) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addCount++;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return super.add(e);<br>
      &nbsp;&nbsp;&nbsp;&nbsp; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp; @Override public boolean addAll(Collection&lt;?
      extends E&gt; c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; addCount += c.size();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return super.addAll(c);<br>
      &nbsp;&nbsp;&nbsp;&nbsp; }<br>
      &nbsp;&nbsp;&nbsp;&nbsp; public int getAddCount() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return addCount;<br>
      &nbsp;&nbsp;&nbsp;&nbsp; }<br>
      }<br>
      <br>
      <strong>// Reusable forwarding class</strong><br>
      public class ForwardingSet&lt;E&gt; implements Set&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Set&lt;E&gt; s;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public ForwardingSet(Set&lt;E&gt; s) { this.s = s;
      }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void
      clear()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      {
s.clear();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean contains(Object o) { return
      s.contains(o); }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean
      isEmpty()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      return s.isEmpty();&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public int
      size()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.size();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Iterator&lt;E&gt;
      iterator()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ return
      s.iterator();&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean add(E
      e)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { return
      s.add(e);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean remove(Object o)&nbsp;&nbsp; {
      return s.remove(o);&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean containsAll(Collection&lt;?&gt; c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.containsAll(c); }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean addAll(Collection&lt;? extends
      E&gt; c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.addAll(c);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean removeAll(Collection&lt;?&gt; c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.removeAll(c);&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean retainAll(Collection&lt;?&gt; c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.retainAll(c);&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Object[]
      toArray()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{
      return s.toArray();&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; T[] toArray(T[]
      a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ return s.toArray(a); }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      { return s.equals(o);&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public int
      hashCode()&nbsp;&nbsp;&nbsp;&nbsp;{ return s.hashCode(); }<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public String toString() { return
      s.toString(); }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_90"></span>The design of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class is enabled by the
      existence of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code><span
        class="Apple-converted-space">&nbsp;</span>interface, which captures the
      functionality of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code>class.
      Besides being robust, this design is extremely flexible. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class implements the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>interface
      and has a single constructor whose argument is also of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code>. In essence,
      the class transforms one<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>into
      another, adding the instrumentation functionality. Unlike the
      inheritance-based approach, which works only for a single concrete class
      and requires a separate constructor for each supported constructor in the
      superclass, the wrapper class can be used to instrument any<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>implementation
      and will work in conjunction with any preexisting constructor:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex14a" id="pch4ex14" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Instant&gt;
      times = new InstrumentedSet&lt;&gt;(new TreeSet&lt;&gt;(cmp));<br>
      Set&lt;E&gt; s = new InstrumentedSet&lt;&gt;(new
      HashSet&lt;&gt;(INIT_CAPACITY));</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class can even be used to
      temporarily instrument a set instance that has already been used without
      instrumentation:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex15a" id="pch4ex15" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">static
      void walk(Set&lt;Dog&gt; dogs) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;InstrumentedSet&lt;Dog&gt; iDogs = new
      InstrumentedSet&lt;&gt;(dogs);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Within this method use iDogs instead of
      dogs<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class is known as a<span class="Apple-converted-space">&nbsp;</span><em>wrapper</em><span
        class="Apple-converted-space">&nbsp;</span>class because each<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>instance contains (“wraps”)
      another<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code><span
        class="Apple-converted-space">&nbsp;</span>instance. This is also known
      as the<span class="Apple-converted-space">&nbsp;</span><em>Decorator</em><span
        class="Apple-converted-space">&nbsp;</span>pattern [<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>] because the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">InstrumentedSet</code><span
        class="Apple-converted-space">&nbsp;</span>class “decorates” a set by
      adding instrumentation. Sometimes the combination of composition and
      forwarding is loosely referred to as<span class="Apple-converted-space">&nbsp;</span><em>delegation.</em><span
        class="Apple-converted-space">&nbsp;</span>Technically it’s not
      delegation unless the wrapper object passes itself to the wrapped object
      [Lieberman86; Gamma95].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      disadvantages of wrapper classes are few. One caveat is that wrapper
      classes are not suited for use in<span class="Apple-converted-space">&nbsp;</span><em>callback
        frameworks</em>, wherein objects pass self-references to other objects
      for subsequent invocations (“callbacks”). Because a wrapped object doesn’t
      know of its wrapper, it passes a reference to itself (<code style="font-family: 'Courier New', monospace;">this</code>)
      and callbacks elude the wrapper. This is known as the<span class="Apple-converted-space">&nbsp;</span><em>SELF
        problem</em><span class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rLieberman86"
        style="text-decoration: none;">Lieberman86</a>]. Some people worry about
      the performance impact of forwarding method invocations or the memory
      footprint impact of wrapper objects. Neither turn out to have much impact
      in practice. It’s tedious to write forwarding methods, but you have to
      write the reusable forwarding class for each interface only once, and
      forwarding classes may be provided for you. For example, Guava provides
      forwarding classes for all of the collection interfaces [<a href="ref.xhtml#rGuava"
        style="text-decoration: none;">Guava</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_91"></span>Inheritance is appropriate
      only in circumstances where the subclass really is a<span class="Apple-converted-space">&nbsp;</span><em>subtype</em><span
        class="Apple-converted-space">&nbsp;</span>of the superclass. In other
      words, a class<span class="Apple-converted-space">&nbsp;</span><em>B</em><span
        class="Apple-converted-space">&nbsp;</span>should extend a class<span class="Apple-converted-space">&nbsp;</span><em>A</em><span
        class="Apple-converted-space">&nbsp;</span>only if an “is-a”
      relationship exists between the two classes. If you are tempted to have a
      class<span class="Apple-converted-space">&nbsp;</span><em>B</em><span class="Apple-converted-space">&nbsp;</span>extend
      a class<span class="Apple-converted-space">&nbsp;</span><em>A</em>, ask
      yourself the question: Is every<span class="Apple-converted-space">&nbsp;</span><em>B</em><span
        class="Apple-converted-space">&nbsp;</span>really an<span class="Apple-converted-space">&nbsp;</span><em>A</em>?
      If you cannot truthfully answer yes to this question,<span class="Apple-converted-space">&nbsp;</span><em>B</em><span
        class="Apple-converted-space">&nbsp;</span>should not extend<span class="Apple-converted-space">&nbsp;</span><em>A</em>.
      If the answer is no, it is often the case that<span class="Apple-converted-space">&nbsp;</span><em>B</em><span
        class="Apple-converted-space">&nbsp;</span>should contain a private
      instance of<span class="Apple-converted-space">&nbsp;</span><em>A</em><span
        class="Apple-converted-space">&nbsp;</span>and expose a different API:<span
        class="Apple-converted-space">&nbsp;</span><em>A</em><span class="Apple-converted-space">&nbsp;</span>is
      not an essential part of<span class="Apple-converted-space">&nbsp;</span><em>B</em>,
      merely a detail of its implementation.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are a number of obvious violations of this principle in the Java platform
      libraries. For example, a stack is not a vector, so<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>should
      not extend<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Vector</code>.
      Similarly, a property list is not a hash table, so<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Properties</code><span class="Apple-converted-space">&nbsp;</span>should
      not extend<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Hashtable</code>.
      In both cases, composition would have been preferable.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you use inheritance where composition is appropriate, you needlessly
      expose implementation details. The resulting API ties you to the original
      implementation, forever limiting the performance of your class. More
      seriously, by exposing the internals you let clients access them directly.
      At the very least, it can lead to confusing semantics. For example, if<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">p</code><span
        class="Apple-converted-space">&nbsp;</span>refers to a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Properties</code><span class="Apple-converted-space">&nbsp;</span>instance,
      then<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">p.getProperty(key)</code><span
        class="Apple-converted-space">&nbsp;</span>may yield different results
      from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">p.get(key)</code>:
      the former method takes defaults into account, while the latter method,
      which is inherited from<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Hashtable</code>, does
      not. Most seriously, the client may be able to corrupt invariants of the
      subclass by modifying the superclass directly. In the case of<code style="font-family: 'Courier New', monospace;">Properties</code>,
      the designers intended that only strings be allowed as keys and values,
      but direct access to the underlying<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Hashtable</code><span class="Apple-converted-space">&nbsp;</span>allows
      this invariant to be violated. Once violated, it is no longer possible to
      use other parts of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Properties</code><span class="Apple-converted-space">&nbsp;</span>API
      (<code style="font-family: 'Courier New', monospace;">load</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">store</code>).
      By the time this problem was discovered, it was too late to correct it
      because clients depended on the use of non-string keys and values.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is one last set of questions you should ask yourself before deciding to
      use inheritance in place of composition. Does the class that you
      contemplate extending have any flaws in its API? If so, are you
      comfortable propagating those flaws into your class’s API? Inheritance
      propagates any flaws in the superclass’s API, while composition lets you
      design a new API that hides these flaws.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      summarize, inheritance is powerful, but it is problematic because it
      violates encapsulation. It is appropriate only when a genuine subtype
      relationship exists between the subclass and the superclass. Even then,
      inheritance may lead to fragility if the subclass is in a different
      package from the superclass and the superclass is not designed for
      inheritance. To avoid this fragility, use composition and forwarding
      instead of inheritance, especially if an appropriate interface to
      implement a wrapper class exists. Not only are wrapper classes more robust
      than subclasses, they are also more powerful.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev19" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_92"></span><strong>Item 19: Design and document for inheritance
        or else prohibit it</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Item
      18 alerted you to the dangers of subclassing a “foreign” class that was
      not designed and documented for inheritance. So what does it mean for a
      class to be designed and documented for inheritance?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">First,
      the class must document precisely the effects of overriding any method. In
      other words,<span class="Apple-converted-space">&nbsp;</span><strong>the
        class must document its</strong><span class="Apple-converted-space">&nbsp;</span><em><strong>self-use</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>of overridable
        methods.</strong><span class="Apple-converted-space">&nbsp;</span>For
      each public or protected method, the documentation must indicate which
      overridable methods the method invokes, in what sequence, and how the
      results of each invocation affect subsequent processing. (By<span class="Apple-converted-space">&nbsp;</span><em>overridable</em>,
      we mean nonfinal and either public or protected.) More generally, a class
      must document any circumstances under which it might invoke an overridable
      method. For example, invocations might come from background threads or
      static initializers.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      method that invokes overridable methods contains a description of these
      invocations at the end of its documentation comment. The description is in
      a special section of the specification, labeled “Implementation
      Requirements,” which is generated by the Javadoc tag<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">@implSpec</code>. This
      section describes the inner workings of the method. Here’s an example,
      copied from the specification for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.AbstractCollection</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex16a" id="pch4ex16" style="text-decoration: none;">&nbsp;</a></p>
    <p class="codep" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 22.666668px; page-break-after: avoid; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      boolean remove(Object o)</p>
    <p class="bqa" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 37.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Removes
      a single instance of the specified element from this collection, if it is
      present (optional operation). More formally, removes an element<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">e</code><span class="Apple-converted-space">&nbsp;</span>such
      that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Objects.equals(o,
        e)</code>, if this collection contains one or more such elements.
      Returns<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code><span
        class="Apple-converted-space">&nbsp;</span>if this collection contained
      the specified element (or equivalently, if this collection changed as a
      result of the call).</p>
    <p class="bqa" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 37.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Implementation
        Requirements:</strong><span class="Apple-converted-space">&nbsp;</span>This
      implementation iterates over the collection looking for the specified
      element. If it finds the element, it removes the element from the
      collection using the iterator’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">remove</code><span class="Apple-converted-space">&nbsp;</span>method.
      Note that this implementation throws an<code style="font-family: 'Courier New', monospace;">UnsupportedOperationException</code><span
        class="Apple-converted-space">&nbsp;</span>if the iterator returned by
      this collection’s<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">iterator</code><span
        class="Apple-converted-space">&nbsp;</span>method does not implement the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">remove</code><span
        class="Apple-converted-space">&nbsp;</span>method and this collection
      contains the specified object.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      documentation leaves no doubt that overriding the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">iterator</code><span class="Apple-converted-space">&nbsp;</span>method
      will affect the behavior of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">remove</code><span class="Apple-converted-space">&nbsp;</span>method.
      It also describes exactly how the behavior of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Iterator</code><span class="Apple-converted-space">&nbsp;</span>returned
      by the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">iterator</code><span
        class="Apple-converted-space">&nbsp;</span>method will affect the
      behavior of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">remove</code><span
        class="Apple-converted-space">&nbsp;</span>method. Contrast this to the
      situation in<span class="Apple-converted-space">&nbsp;</span><a href="ch4.xhtml#lev18"
        style="text-decoration: none;">Item 18</a>, where the programmer
      subclassing<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashSet</code><span
        class="Apple-converted-space">&nbsp;</span>simply could not say whether
      overriding the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">add</code><span
        class="Apple-converted-space">&nbsp;</span>method would affect the
      behavior of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">addAll</code><span
        class="Apple-converted-space">&nbsp;</span>method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_93"></span>But doesn’t this violate the
      dictum that good API documentation should describe<span class="Apple-converted-space">&nbsp;</span><em>what</em><span
        class="Apple-converted-space">&nbsp;</span>a given method does and not<span
        class="Apple-converted-space">&nbsp;</span><em>how</em><span class="Apple-converted-space">&nbsp;</span>it
      does it? Yes, it does! This is an unfortunate consequence of the fact that
      inheritance violates encapsulation. To document a class so that it can be
      safely subclassed, you must describe implementation details that should
      otherwise be left unspecified.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@implSpec</code><span
        class="Apple-converted-space">&nbsp;</span>tag was added in Java 8 and
      used heavily in Java 9. This tag should be enabled by default, but as of
      Java 9, the Javadoc utility still ignores it unless you pass the command
      line switch<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">-tag
        "apiNote:a:API Note:"</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Designing
      for inheritance involves more than just documenting patterns of self-use.
      To allow programmers to write efficient subclasses without undue pain,<span
        class="Apple-converted-space">&nbsp;</span><strong>a class may have to
        provide hooks into its internal workings in the form of judiciously
        chosen protected methods</strong><span class="Apple-converted-space">&nbsp;</span>or,
      in rare instances, protected fields. For example, consider the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeRange</code><span class="Apple-converted-space">&nbsp;</span>method
      from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.util.AbstractList</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex17a" id="pch4ex17" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">protected
      void removeRange(int fromIndex, int toIndex)</p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Removes
      from this list all of the elements whose index is between<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">fromIndex</code>,
      inclusive, and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toIndex</code>,
      exclusive. Shifts any succeeding elements to the left (reduces their
      index). This call shortens the list by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">(toIndex - fromIndex)</code><span
        class="Apple-converted-space">&nbsp;</span>elements. (If<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toIndex == fromIndex</code>,
      this operation has no effect.)</p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method is called by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clear</code><span class="Apple-converted-space">&nbsp;</span>operation
      on this list and its sublists. Overriding this method to take advantage of
      the internals of the list implementation can substantially improve the
      performance of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clear</code><span
        class="Apple-converted-space">&nbsp;</span>operation on this list and
      its sublists.</p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Implementation
        Requirements:</strong><span class="Apple-converted-space">&nbsp;</span>This
      implementation gets a list iterator positioned before<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">fromIndex</code><span class="Apple-converted-space">&nbsp;</span>and
      repeatedly calls<code style="font-family: 'Courier New', monospace;">ListIterator.next</code><span
        class="Apple-converted-space">&nbsp;</span>followed by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ListIterator.remove</code>,
      until the entire range has been removed.<span class="Apple-converted-space">&nbsp;</span><strong>Note:
        If</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>ListIterator.remove</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>requires linear time,
        this implementation requires quadratic time.</strong></p>
    <p class="bq" style="font-size: medium; margin-top: 7.5px; margin-bottom: 7.5px; margin-left: 19.5px; text-indent: 0px; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Parameters:</p>
    <p class="prem" style="font-size: 0.88em; margin-top: 6.666667px; margin-bottom: 26.666668px; margin-left: 41.333336px; text-align: justify; font-family: sans-serif; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><code
        style="font-family: 'Courier New', monospace;">fromIndex</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index
      of first element to be removed.<br>
      <code style="font-family: 'Courier New', monospace;">toIndex</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;index
      after last element to be removed.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method is of no interest to end users of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>implementation.
      It is provided solely to make it easy for subclasses to provide a fast<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clear</code>method
      on sublists. In the absence of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeRange</code><span class="Apple-converted-space">&nbsp;</span>method,
      subclasses would have to make do with quadratic performance when the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">clear</code>method
      was invoked on sublists or rewrite the entire<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">subList</code><span class="Apple-converted-space">&nbsp;</span>mechanism
      from scratch—not an easy task!</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_94"></span>So how do you decide what
      protected members to expose when you design a class for inheritance?
      Unfortunately, there is no magic bullet. The best you can do is to think
      hard, take your best guess, and then test it by writing subclasses. You
      should expose as few protected members as possible because each one
      represents a commitment to an implementation detail. On the other hand,
      you must not expose too few because a missing protected member can render
      a class practically unusable for inheritance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The</strong><span
        class="Apple-converted-space">&nbsp;</span><em><strong>only</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>way to test a class
        designed for inheritance is to write subclasses.</strong><span class="Apple-converted-space">&nbsp;</span>If
      you omit a crucial protected member, trying to write a subclass will make
      the omission painfully obvious. Conversely, if several subclasses are
      written and none uses a protected member, you should probably make it
      private. Experience shows that three subclasses are usually sufficient to
      test an extendable class. One or more of these subclasses should be
      written by someone other than the superclass author.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you design for inheritance a class that is likely to achieve wide use,
      realize that you are committing<span class="Apple-converted-space">&nbsp;</span><em>forever</em><span
        class="Apple-converted-space">&nbsp;</span>to the self-use patterns that
      you document and to the implementation decisions implicit in its protected
      methods and fields. These commitments can make it difficult or impossible
      to improve the performance or functionality of the class in a subsequent
      release. Therefore,<span class="Apple-converted-space">&nbsp;</span><strong>you
        must test your class by writing subclasses</strong><span class="Apple-converted-space">&nbsp;</span><em><strong>before</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>you release it.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Also,
      note that the special documentation required for inheritance clutters up
      normal documentation, which is designed for programmers who create
      instances of your class and invoke methods on them. As of this writing,
      there is little in the way of tools to separate ordinary API documentation
      from information of interest only to programmers implementing subclasses.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are a few more restrictions that a class must obey to allow inheritance.<span
        class="Apple-converted-space">&nbsp;</span><strong>Constructors must not
        invoke overridable methods,</strong>directly or indirectly. If you
      violate this rule, program failure will result. The superclass constructor
      runs before the subclass constructor, so the overriding method in the
      subclass will get invoked before the subclass constructor has run. If the
      overriding method depends on any initialization performed by the subclass
      constructor, the method will not behave as expected. To make this
      concrete, here’s a class that violates this rule:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex18a" id="pch4ex18" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Super {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// Поломане - constructor invokes an
        overridable method</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Super() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;overrideMe();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void overrideMe() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_95"></span>Here’s a subclass that
      overrides the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">overrideMe</code><span
        class="Apple-converted-space">&nbsp;</span>method, which is erroneously
      invoked by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Super</code>’s
      sole constructor:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex19a" id="pch4ex19" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      final class Sub extends Super {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Blank final, set by constructor<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Instant instant;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;Sub() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instant = Instant.now();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// Overriding method invoked by superclass
        constructor</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public void overrideMe() {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(instant);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sub sub = new Sub();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub.overrideMe();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      might expect this program to print out the instant twice, but it prints
      out<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">null</code><span
        class="Apple-converted-space">&nbsp;</span>the first time because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">overrideMe</code><span class="Apple-converted-space">&nbsp;</span>is
      invoked by the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Super</code>constructor
      before the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Sub</code><span
        class="Apple-converted-space">&nbsp;</span>constructor has a chance to
      initialize the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">instant</code><span
        class="Apple-converted-space">&nbsp;</span>field. Note that this program
      observes a final field in two different states! Note also that if<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">overrideMe</code><span class="Apple-converted-space">&nbsp;</span>had
      invoked any method on<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instant</code>, it would
      have thrown a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">NullPointerException</code><span
        class="Apple-converted-space">&nbsp;</span>when the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Super</code>constructor
      invoked<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">overrideMe</code>.
      The only reason this program doesn’t throw a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">NullPointerException</code><span
        class="Apple-converted-space">&nbsp;</span>as it stands is that the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">println</code><span
        class="Apple-converted-space">&nbsp;</span>method tolerates null
      parameters.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that it<span class="Apple-converted-space">&nbsp;</span><em>is</em><span class="Apple-converted-space">&nbsp;</span>safe
      to invoke private methods, final methods, and static methods, none of
      which are overridable, from a constructor.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Cloneable</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>interfaces present special
      difficulties when designing for inheritance. It is generally not a good
      idea for a class designed for inheritance to implement either of these
      interfaces because they place a substantial burden on programmers who
      extend the class. There are, however, special actions that you can take to
      allow subclasses to implement these interfaces without mandating that they
      do so. These actions are described in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev13" style="text-decoration: none;">Item 13</a><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><a href="ch12.xhtml#lev86" style="text-decoration: none;">Item
        86</a>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you do decide to implement either<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Cloneable</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>in a class that is designed
      for inheritance, you should be aware that because the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readObject</code><span
        class="Apple-converted-space">&nbsp;</span>methods behave a lot like
      constructors, a similar restriction applies:<span class="Apple-converted-space">&nbsp;</span><strong>neither</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>clone</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>nor</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>readObject</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>may invoke an
        overridable method, directly or indirectly.</strong><span class="Apple-converted-space">&nbsp;</span>In
      the case of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readObject</code>,
      the overriding method will run before the<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_96"></span>subclass’s state has been
      deserialized. In the case of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code>, the
      overriding method will run before the subclass’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code><span class="Apple-converted-space">&nbsp;</span>method
      has a chance to fix the clone’s state. In either case, a program failure
      is likely to follow. In the case of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">clone</code>, the failure
      can damage the original object as well as the clone. This can happen, for
      example, if the overriding method assumes it is modifying the clone’s copy
      of the object’s deep structure, but the copy hasn’t been made yet.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Finally,
      if you decide to implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Serializable</code><span
        class="Apple-converted-space">&nbsp;</span>in a class designed for
      inheritance and the class has a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">readResolve</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">writeReplace</code>method,
      you must make the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">readResolve</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">writeReplace</code><span
        class="Apple-converted-space">&nbsp;</span>method protected rather than
      private. If these methods are private, they will be silently ignored by
      subclasses. This is one more case where an implementation detail becomes
      part of a class’s API to permit inheritance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">By
      now it should be apparent that<span class="Apple-converted-space">&nbsp;</span><strong>designing
        a class for inheritance requires great effort and places substantial
        limitations on the class.</strong><span class="Apple-converted-space">&nbsp;</span>This
      is not a decision to be undertaken lightly. There are some situations
      where it is clearly the right thing to do, such as abstract classes,
      including<span class="Apple-converted-space">&nbsp;</span><em>skeletal
        implementations</em><span class="Apple-converted-space">&nbsp;</span>of
      interfaces (<a href="ch4.xhtml#lev20" style="text-decoration: none;">Item
        20</a>). There are other situations where it is clearly the wrong thing
      to do, such as immutable classes (<a href="ch4.xhtml#lev17" style="text-decoration: none;">Item
        17</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">But
      what about ordinary concrete classes? Traditionally, they are neither
      final nor designed and documented for subclassing, but this state of
      affairs is dangerous. Each time a change is made in such a class, there is
      a chance that subclasses extending the class will break. This is not just
      a theoretical problem. It is not uncommon to receive subclassing-related
      bug reports after modifying the internals of a nonfinal concrete class
      that was not designed and documented for inheritance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The
        best solution to this problem is to prohibit subclassing in classes that
        are not designed and documented to be safely subclassed.</strong><span class="Apple-converted-space">&nbsp;</span>There
      are two ways to prohibit subclassing. The easier of the two is to declare
      the class final. The alternative is to make all the constructors private
      or package-private and to add public static factories in place of the
      constructors. This alternative, which provides the flexibility to use
      subclasses internally, is discussed in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev17" style="text-decoration: none;">Item 17</a>.
      Either approach is acceptable.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      advice may be somewhat controversial because many programmers have grown
      accustomed to subclassing ordinary concrete classes to add facilities such
      as instrumentation, notification, and synchronization or to limit
      functionality. If a class implements some interface that captures its
      essence, such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,
      or<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code>,
      then you should feel no compunction about prohibiting subclassing. The<span
        class="Apple-converted-space">&nbsp;</span><em>wrapper class</em><span class="Apple-converted-space">&nbsp;</span>pattern,
      described in<a href="ch4.xhtml#lev18" style="text-decoration: none;">Item
        18</a>, provides a superior alternative to inheritance for augmenting
      the functionality.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_97"></span>If a concrete class does not
      implement a standard interface, then you may inconvenience some
      programmers by prohibiting inheritance. If you feel that you must allow
      inheritance from such a class, one reasonable approach is to ensure that
      the class never invokes any of its overridable methods and to document
      this fact. In other words, eliminate the class’s self-use of overridable
      methods entirely. In doing so, you’ll create a class that is reasonably
      safe to subclass. Overriding a method will never affect the behavior of
      any other method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can eliminate a class’s self-use of overridable methods mechanically,
      without changing its behavior. Move the body of each overridable method to
      a private “helper method” and have each overridable method invoke its
      private helper method. Then replace each self-use of an overridable method
      with a direct invocation of the overridable method’s private helper
      method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, designing a class for inheritance is hard work. You must document
      all of its self-use patterns, and once you’ve documented them, you must
      commit to them for the life of the class. If you fail to do this,
      subclasses may become dependent on implementation details of the
      superclass and may break if the implementation of the superclass changes.
      To allow others to write<span class="Apple-converted-space">&nbsp;</span><em>efficient</em><span
        class="Apple-converted-space">&nbsp;</span>subclasses, you may also have
      to export one or more protected methods. Unless you know there is a real
      need for subclasses, you are probably better off prohibiting inheritance
      by declaring your class final or ensuring that there are no accessible
      constructors.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev20" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_98"></span><strong>Item 20: Prefer interfaces to abstract
        classes</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Java
      has two mechanisms to define a type that permits multiple implementations:
      interfaces and abstract classes. Since the introduction of<span class="Apple-converted-space">&nbsp;</span><em>default
        methods</em><span class="Apple-converted-space">&nbsp;</span>for
      interfaces in Java 8 [<a href="ref.xhtml#rJLS" style="text-decoration: none;">JLS
        9.4.3</a>], both mechanisms allow you to provide implementations for
      some instance methods. A major difference is that to implement the type
      defined by an abstract class, a class must be a subclass of the abstract
      class. Because Java permits only single inheritance, this restriction on
      abstract classes severely constrains their use as type definitions. Any
      class that defines all the required methods and obeys the general contract
      is permitted to implement an interface, regardless of where the class
      resides in the class hierarchy.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Existing
        classes can easily be retrofitted to implement a new interface.</strong><span
        class="Apple-converted-space">&nbsp;</span>All you have to do is to add
      the required methods, if they don’t yet exist, and to add an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">implements</code><span class="Apple-converted-space">&nbsp;</span>clause
      to the class declaration. For example, many existing classes were
      retrofitted to implement the<code style="font-family: 'Courier New', monospace;">Comparable</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Iterable</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Autocloseable</code><span
        class="Apple-converted-space">&nbsp;</span>interfaces when they were
      added to the platform. Existing classes cannot, in general, be retrofitted
      to extend a new abstract class. If you want to have two classes extend the
      same abstract class, you have to place it high up in the type hierarchy
      where it is an ancestor of both classes. Unfortunately, this can cause
      great collateral damage to the type hierarchy, forcing all descendants of
      the new abstract class to subclass it, whether or not it is appropriate.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Interfaces
        are ideal for defining mixins.</strong><span class="Apple-converted-space">&nbsp;</span>Loosely
      speaking, a<span class="Apple-converted-space">&nbsp;</span><em>mixin</em><span
        class="Apple-converted-space">&nbsp;</span>is a type that a class can
      implement in addition to its “primary type,” to declare that it provides
      some optional behavior. For example,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">&nbsp;</span>is
      a mixin interface that allows a class to declare that its instances are
      ordered with respect to other mutually comparable objects. Such an
      interface is called a mixin because it allows the optional functionality
      to be “mixed in” to the type’s primary functionality. Abstract classes
      can’t be used to define mixins for the same reason that they can’t be
      retrofitted onto existing classes: a class cannot have more than one
      parent, and there is no reasonable place in the class hierarchy to insert
      a mixin.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Interfaces
        allow for the construction of nonhierarchical type frameworks.</strong><span
        class="Apple-converted-space">&nbsp;</span>Type hierarchies are great
      for organizing some things, but other things don’t fall neatly into a
      rigid hierarchy. For example, suppose we have an interface representing a
      singer and another representing a songwriter:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex20a" id="pch4ex20" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      interface Singer {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;AudioClip sing(Song s);<br>
      }<br>
      <span epub:type="pagebreak" id="page_99"></span>public interface
      Songwriter {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Song compose(int chartPosition);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      real life, some singers are also songwriters. Because we used interfaces
      rather than abstract classes to define these types, it is perfectly
      permissible for a single class to implement both<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Singer</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Songwriter</code>.
      In fact, we can define a third interface that extends both<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Singer</code><span class="Apple-converted-space">&nbsp;</span>and<code
        style="font-family: 'Courier New', monospace;">Songwriter</code><span class="Apple-converted-space">&nbsp;</span>and
      adds new methods that are appropriate to the combination:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex21a" id="pch4ex21" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      interface SingerSongwriter extends Singer, Songwriter {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;AudioClip strum();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;void actSensitive();<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      don’t always need this level of flexibility, but when you do, interfaces
      are a lifesaver. The alternative is a bloated class hierarchy containing a
      separate class for every supported combination of attributes. If there are<span
        class="Apple-converted-space">&nbsp;</span><em>n</em><span class="Apple-converted-space">&nbsp;</span>attributes
      in the type system, there are 2<em><sup>n</sup></em><span class="Apple-converted-space">&nbsp;</span>possible
      combinations that you might have to support. This is what’s known as a<span
        class="Apple-converted-space">&nbsp;</span><em>combinatorial explosion</em>.
      Bloated class hierarchies can lead to bloated classes with many methods
      that differ only in the type of their arguments because there are no types
      in the class hierarchy to capture common behaviors.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Interfaces
        enable safe, powerful functionality enhancements</strong><span class="Apple-converted-space">&nbsp;</span>via
      the<span class="Apple-converted-space">&nbsp;</span><em>wrapper class</em><span
        class="Apple-converted-space">&nbsp;</span>idiom (<a href="ch4.xhtml#lev18"
        style="text-decoration: none;">Item 18</a>). If you use abstract classes
      to define types, you leave the programmer who wants to add functionality
      with no alternative but inheritance. The resulting classes are less
      powerful and more fragile than wrapper classes.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      there is an obvious implementation of an interface method in terms of
      other interface methods, consider providing implementation assistance to
      programmers in the form of a default method. For an example of this
      technique, see the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">removeIf</code><span
        class="Apple-converted-space">&nbsp;</span>method on page 104. If you
      provide default methods, be sure to document them for inheritance using
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@implSpec</code><span
        class="Apple-converted-space">&nbsp;</span>Javadoc tag (<a href="ch4.xhtml#lev19"
        style="text-decoration: none;">Item 19</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are limits on how much implementation assistance you can provide with
      default methods. Although many interfaces specify the behavior of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods
      such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>, you are
      not permitted to provide default methods for them. Also, interfaces are
      not permitted to contain instance fields or nonpublic static members (with
      the exception of private static methods). Finally, you can’t add default
      methods to an interface that you don’t control.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can, however, combine the advantages of interfaces and abstract classes by
      providing an abstract<span class="Apple-converted-space">&nbsp;</span><em>skeletal
        implementation class</em><span class="Apple-converted-space">&nbsp;</span>to
      go with an interface. The interface defines the type, perhaps providing
      some default methods, while the skeletal implementation class implements
      the remaining non-primitive interface<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_100"></span>methods atop the primitive
      interface methods. Extending a skeletal implementation takes most of the
      work out of implementing an interface. This is the<span class="Apple-converted-space">&nbsp;</span><em>Template
        Method</em><span class="Apple-converted-space">&nbsp;</span>pattern [<a
        href="ref.xhtml#rGamma95" style="text-decoration: none;">Gamma95</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">By
      convention, skeletal implementation classes are called<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Abstract</code><em>Interface</em>,
      where<span class="Apple-converted-space">&nbsp;</span><em>Interface</em><span
        class="Apple-converted-space">&nbsp;</span>is the name of the interface
      they implement. For example, the Collections Framework provides a skeletal
      implementation to go along with each main collection interface:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">AbstractCollection</code>,<code
        style="font-family: 'Courier New', monospace;">AbstractSet</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractList</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractMap</code>.
      Arguably it would have made sense to call them<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SkeletalCollection</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SkeletalSet</code>,<code
        style="font-family: 'Courier New', monospace;">SkeletalList</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SkeletalMap</code>,
      but the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Abstract</code><span
        class="Apple-converted-space">&nbsp;</span>convention is now firmly
      established. When properly designed, skeletal implementations (whether a
      separate abstract class, or consisting solely of default methods on an
      interface) can make it<span class="Apple-converted-space">&nbsp;</span><em>very</em><span
        class="Apple-converted-space">&nbsp;</span>easy for programmers to
      provide their own implementations of an interface. For example, here’s a
      static factory method containing a complete, fully functional<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>implementation
      atop<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractList</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex22a" id="pch4ex22" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Concrete implementation built atop skeletal implementation</strong><br>
      static List&lt;Integer&gt; intArrayAsList(int[] a) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Objects.requireNonNull(a);<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// The diamond operator is only legal here in Java
      9 and later<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// If you're using an earlier release, specify
      &lt;Integer&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return new AbstractList<strong>&lt;&gt;</strong>()
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public Integer
      get(int i) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      a[i];&nbsp;&nbsp;// Autoboxing (<a href="ch2.xhtml#lev6" style="text-decoration: none;">Item
        6</a>)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public Integer
      set(int i, Integer val) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int
      oldVal = a[i];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a[i]
      = val;&nbsp;&nbsp;&nbsp;&nbsp; // Auto-unboxing<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      oldVal;&nbsp;&nbsp;// Autoboxing<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Override public int
      size() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      a.length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;};<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you consider all that a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>implementation
      does for you, this example is an impressive demonstration of the power of
      skeletal implementations. Incidentally, this example is an<span class="Apple-converted-space">&nbsp;</span><em>Adapter</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>] that allows an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>array
      to be viewed as a list of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code><span class="Apple-converted-space">&nbsp;</span>instances.
      Because of all the translation back and forth between<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">int</code><span class="Apple-converted-space">&nbsp;</span>values
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code><span
        class="Apple-converted-space">&nbsp;</span>instances (boxing and
      unboxing), its performance is not terribly good. Note that the
      implementation takes the form of an<span class="Apple-converted-space">&nbsp;</span><em>anonymous
        class</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch4.xhtml#lev24"
        style="text-decoration: none;">Item 24</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_101"></span>The beauty of skeletal
      implementation classes is that they provide all of the implementation
      assistance of abstract classes without imposing the severe constraints
      that abstract classes impose when they serve as type definitions. For most
      implementors of an interface with a skeletal implementation class,
      extending this class is the obvious choice, but it is strictly optional.
      If a class cannot be made to extend the skeletal implementation, the class
      can always implement the interface directly. The class still benefits from
      any default methods present on the interface itself. Furthermore, the
      skeletal implementation can still aid the implementor’s task. The class
      implementing the interface can forward invocations of interface methods to
      a contained instance of a private inner class that extends the skeletal
      implementation. This technique, known as<span class="Apple-converted-space">&nbsp;</span><em>simulated
        multiple inheritance</em>, is closely related to the wrapper class idiom
      discussed in<span class="Apple-converted-space">&nbsp;</span><a href="ch4.xhtml#lev18"
        style="text-decoration: none;">Item 18</a>. It provides many of the
      benefits of multiple inheritance, while avoiding the pitfalls.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Writing
      a skeletal implementation is a relatively simple, if somewhat tedious,
      process. First, study the interface and decide which methods are the
      primitives in terms of which the others can be implemented. These
      primitives will be the abstract methods in your skeletal implementation.
      Next, provide default methods in the interface for all of the methods that
      can be implemented directly atop the primitives, but recall that you may
      not provide default methods for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods
      such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">equals</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>. If the
      primitives and default methods cover the interface, you’re done, and have
      no need for a skeletal implementation class. Otherwise, write a class
      declared to implement the interface, with implementations of all of the
      remaining interface methods. The class may contain any nonpublic fields
      ands methods appropriate to the task.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      a simple example, consider the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map.Entry</code><span class="Apple-converted-space">&nbsp;</span>interface.
      The obvious primitives are<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getKey</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getValue</code>, and
      (optionally)<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">setValue</code>.
      The interface specifies the behavior of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">hashCode</code>,
      and there is an obvious implementation of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toString</code><span class="Apple-converted-space">&nbsp;</span>in
      terms of the primitives. Since you are not allowed to provide default
      implementations for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>methods,
      all implementations are placed in the skeletal implementation class:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex23a" id="pch4ex23" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Skeletal implementation class</strong><br>
      public abstract class AbstractMapEntry&lt;K,V&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;implements
      Map.Entry&lt;K,V&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Entries in a modifiable map must override this
      method<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public V setValue(V value) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      UnsupportedOperationException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <span epub:type="pagebreak" id="page_102"></span>&nbsp;&nbsp;&nbsp;&nbsp;//
      Implements the general contract of Map.Entry.equals<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public boolean equals(Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (o == this)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!(o instanceof
      Map.Entry))<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Map.Entry&lt;?,?&gt; e =
      (Map.Entry) o;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      Objects.equals(e.getKey(),&nbsp;&nbsp;getKey())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;
      Objects.equals(e.getValue(), getValue());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Implements the general contract of
      Map.Entry.hashCode<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public int hashCode() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      Objects.hashCode(getKey())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ^
      Objects.hashCode(getValue());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public String toString() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return getKey() + "=" +
      getValue();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that this skeletal implementation could not be implemented in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map.Entry</code><span class="Apple-converted-space">&nbsp;</span>interface
      or as a subinterface because default methods are not permitted to override<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>methods such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">equals</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">hashCode</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toString</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      skeletal implementations are designed for inheritance, you should follow
      all of the design and documentation guidelines in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev19" style="text-decoration: none;">Item 19</a>. For
      brevity’s sake, the documentation comments were omitted from the previous
      example, but<span class="Apple-converted-space">&nbsp;</span><strong>good
        documentation is absolutely essential in a skeletal implementation,</strong><span
        class="Apple-converted-space">&nbsp;</span>whether it consists of
      default methods on an interface or a separate abstract class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      minor variant on the skeletal implementation is the<span class="Apple-converted-space">&nbsp;</span><em>simple
        implementation,</em><span class="Apple-converted-space">&nbsp;</span>exemplified
      by<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AbstractMap.SimpleEntry</code>.
      A simple implementation is like a skeletal implementation in that it
      implements an interface and is designed for inheritance, but it differs in
      that it isn’t abstract: it is the simplest possible working
      implementation. You can use it as it stands or subclass it as
      circumstances warrant.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      summarize, an interface is generally the best way to define a type that
      permits multiple implementations. If you export a nontrivial interface,
      you should strongly consider providing a skeletal implementation to go
      with it. To the extent possible, you should provide the skeletal
      implementation via default methods on the interface so that all
      implementors of the interface can make use of it. That said, restrictions
      on interfaces typically mandate that a skeletal implementation take the
      form of an abstract class.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev21" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_103"></span><strong>Item 21: Design interfaces for posterity</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Prior
      to Java 8, it was impossible to add methods to interfaces without breaking
      existing implementations. If you added a new method to an interface,
      existing implementations would, in general, lack the method, resulting in
      a compile-time error. In Java 8, the<span class="Apple-converted-space">&nbsp;</span><em>default
        method</em><span class="Apple-converted-space">&nbsp;</span>construct
      was added [<a href="ref.xhtml#rJLS" style="text-decoration: none;">JLS 9.4</a>],
      with the intent of allowing the addition of methods to existing
      interfaces. But adding new methods to existing interfaces is fraught with
      risk.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      declaration for a default method includes a<span class="Apple-converted-space">&nbsp;</span><em>default
        implementation</em><span class="Apple-converted-space">&nbsp;</span>that
      is used by all classes that implement the interface but do not implement
      the default method. While the addition of default methods to Java makes it
      possible to add methods to an existing interface, there is no guarantee
      that these methods will work in all preexisting implementations. Default
      methods are “injected” into existing implementations without the knowledge
      or consent of their implementors. Before Java 8, these implementations
      were written with the tacit understanding that their interfaces would<span
        class="Apple-converted-space">&nbsp;</span><em>never</em><span class="Apple-converted-space">&nbsp;</span>acquire
      any new methods.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      new default methods were added to the core collection interfaces in Java
      8, primarily to facilitate the use of lambdas (<a href="ch6.xhtml#ch6" style="text-decoration: none;">Chapter
        6</a>). The Java libraries’ default methods are high-quality
      general-purpose implementations, and in most cases, they work fine. But<span
        class="Apple-converted-space">&nbsp;</span><strong>it is not always
        possible to write a default method that maintains all invariants of
        every conceivable implementation.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      example, consider the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>method,
      which was added to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection</code><span class="Apple-converted-space">&nbsp;</span>interface
      in Java 8. This method removes all elements for which a given<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">boolean</code><span class="Apple-converted-space">&nbsp;</span>function
      (or<span class="Apple-converted-space">&nbsp;</span><em>predicate</em>)
      returns<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">true</code>.
      The default implementation is specified to traverse the collection using
      its iterator, invoking the predicate on each element, and using the
      iterator’s<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">remove</code><span
        class="Apple-converted-space">&nbsp;</span>method to remove the elements
      for which the predicate returns<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">true</code>. Presumably
      the declaration looks something like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex24a" id="pch4ex24" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Default method added to the Collection interface in Java 8</strong><br>
      default boolean removeIf(Predicate&lt;? super E&gt; filter) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Objects.requireNonNull(filter);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;boolean result = false;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (Iterator&lt;E&gt; it = iterator();
      it.hasNext(); ) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if
      (filter.test(it.next())) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it.remove();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result
      = true;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_104"></span>This is the best
      general-purpose implementation one could possibly write for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>method,
      but sadly, it fails on some real-world<code style="font-family: 'Courier New', monospace;">Collection</code><span
        class="Apple-converted-space">&nbsp;</span>implementations. For example,
      consider<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">org.apache.commons.collections4.-collection.SynchronizedCollection</code>.
      This class, from the Apache Commons library, is similar to the one
      returned by the static factory<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collections.-synchronizedCollection</code><span
        class="Apple-converted-space">&nbsp;</span>in<code style="font-family: 'Courier New', monospace;">java.util</code>.
      The Apache version additionally provides the ability to use a
      client-supplied object for locking, in place of the collection. In other
      words, it is a wrapper class (<a href="ch4.xhtml#lev18" style="text-decoration: none;">Item
        18</a>), all of whose methods synchronize on a locking object before
      delegating to the wrapped collection.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      Apache<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SynchronizedCollection</code><span
        class="Apple-converted-space">&nbsp;</span>class is still being actively
      maintained, but as of this writing, it does not override the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>method.
      If this class is used in conjunction with Java 8, it will therefore
      inherit the default implementation of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code>, which
      does not, indeed<span class="Apple-converted-space">&nbsp;</span><em>cannot</em>,
      maintain the class’s fundamental promise: to automatically synchronize
      around each method invocation. The default implementation knows nothing
      about synchronization and has no access to the field that contains the
      locking object. If a client calls the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>method
      on a<code style="font-family: 'Courier New', monospace;">SynchronizedCollection</code><span
        class="Apple-converted-space">&nbsp;</span>instance in the presence of
      concurrent modification of the collection by another thread, a<code style="font-family: 'Courier New', monospace;">ConcurrentModificationException</code><span
        class="Apple-converted-space">&nbsp;</span>or other unspecified behavior
      may result.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      order to prevent this from happening in similar Java platform libraries
      implementations, such as the package-private class returned by<code style="font-family: 'Courier New', monospace;">Collections.synchronizedCollection</code>,
      the JDK maintainers had to override the default<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">removeIf</code><span class="Apple-converted-space">&nbsp;</span>implementation
      and other methods like it to perform the necessary synchronization before
      invoking the default implementation. Preexisting collection
      implementations that were not part of the Java platform did not have the
      opportunity to make analogous changes in lockstep with the interface
      change, and some have yet to do so.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>In
        the presence of default methods, existing implementations of an
        interface may compile without error or warning but fail at runtime.</strong><span
        class="Apple-converted-space">&nbsp;</span>While not terribly common,
      this problem is not an isolated incident either. A handful of the methods
      added to the collections interfaces in Java 8 are known to be susceptible,
      and a handful of existing implementations are known to be affected.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Using
      default methods to add new methods to existing interfaces should be
      avoided unless the need is critical, in which case you should think long
      and hard about whether an existing interface implementation might be
      broken by your default method implementation. Default methods are,
      however, extremely useful for providing standard method implementations
      when an interface is created, to ease the task of implementing the
      interface (<a href="ch4.xhtml#lev20" style="text-decoration: none;">Item
        20</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_105"></span>It is also worth noting that
      default methods were not designed to support removing methods from
      interfaces or changing the signatures of existing methods. Neither of
      these interface changes is possible without breaking existing clients.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      moral is clear. Even though default methods are now a part of the Java
      platform,<span class="Apple-converted-space">&nbsp;</span><strong>it is
        still of the utmost importance to design interfaces with great care.</strong><span
        class="Apple-converted-space">&nbsp;</span>While default methods make it<span
        class="Apple-converted-space">&nbsp;</span><em>possible</em><span class="Apple-converted-space">&nbsp;</span>to
      add methods to existing interfaces, there is great risk in doing so. If an
      interface contains a minor flaw, it may irritate its users forever; if an
      interface is severely deficient, it may doom the API that contains it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Therefore,
      it is critically important to test each new interface before you release
      it. Multiple programmers should implement each interface in different
      ways. At a minimum, you should aim for three diverse implementations.
      Equally important is to write multiple client programs that use instances
      of each new interface to perform various tasks. This will go a long way
      toward ensuring that each interface satisfies all of its intended uses.
      These steps will allow you to discover flaws in interfaces before they are
      released, when you can still correct them easily.<span class="Apple-converted-space">&nbsp;</span><strong>While
        it may be possible to correct some interface flaws after an interface is
        released, you cannot count on it</strong>.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev22" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_106"></span><strong>Item 22: Use interfaces only to define
        types</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      a class implements an interface, the interface serves as a<span class="Apple-converted-space">&nbsp;</span><em>type</em><span
        class="Apple-converted-space">&nbsp;</span>that can be used to refer to
      instances of the class. That a class implements an interface should
      therefore say something about what a client can do with instances of the
      class. It is inappropriate to define an interface for any other purpose.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      kind of interface that fails this test is the so-called<span class="Apple-converted-space">&nbsp;</span><em>constant
        interface</em>. Such an interface contains no methods; it consists
      solely of static final fields, each exporting a constant. Classes using
      these constants implement the interface to avoid the need to qualify
      constant names with a class name. Here is an example:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex25a" id="pch4ex25" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Constant interface antipattern - do not use!</strong><br>
      public interface PhysicalConstants {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Avogadro's number (1/mol)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final double AVOGADROS_NUMBER&nbsp;&nbsp; =
      6.022_140_857e23;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Boltzmann constant (J/K)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final double BOLTZMANN_CONSTANT =
      1.380_648_52e-23;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Mass of the electron (kg)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final double
      ELECTRON_MASS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 9.109_383_56e-31;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>The
        constant interface pattern is a poor use of interfaces.</strong><span class="Apple-converted-space">&nbsp;</span>That
      a class uses some constants internally is an implementation detail.
      Implementing a constant interface causes this implementation detail to
      leak into the class’s exported API. It is of no consequence to the users
      of a class that the class implements a constant interface. In fact, it may
      even confuse them. Worse, it represents a commitment: if in a future
      release the class is modified so that it no longer needs to use the
      constants, it still must implement the interface to ensure binary
      compatibility. If a nonfinal class implements a constant interface, all of
      its subclasses will have their namespaces polluted by the constants in the
      interface.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are several constant interfaces in the Java platform libraries, such as<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">java.io.ObjectStreamConstants</code>.
      These interfaces should be regarded as anomalies and should not be
      emulated.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you want to export constants, there are several reasonable choices. If the
      constants are strongly tied to an existing class or interface, you should
      add them to the class or interface. For example, all of the boxed
      numerical primitive classes, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Double,</code><span
        class="Apple-converted-space">&nbsp;</span>export<code style="font-family: 'Courier New', monospace;">MIN_VALUE</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">MAX_VALUE</code><span class="Apple-converted-space">&nbsp;</span>constants.
      If the constants are best viewed as members of an enumerated type, you
      should export<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_107"></span>them with an<span class="Apple-converted-space">&nbsp;</span><em>enum
        type</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch6.xhtml#lev34"
        style="text-decoration: none;">Item 34</a>). Otherwise, you should
      export the constants with a noninstantiable<span class="Apple-converted-space">&nbsp;</span><em>utility
        class</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch2.xhtml#lev4"
        style="text-decoration: none;">Item 4</a>). Here is a utility class
      version of the<code style="font-family: 'Courier New', monospace;">PhysicalConstants</code><span
        class="Apple-converted-space">&nbsp;</span>example shown earlier:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex26a" id="pch4ex26" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Constant utility class</strong><br>
      package com.effectivejava.science;<br>
      <br>
      public class PhysicalConstants {<br>
      &nbsp;&nbsp;private PhysicalConstants() { }&nbsp;&nbsp;// Prevents
      instantiation<br>
      <br>
      &nbsp;&nbsp;public static final double AVOGADROS_NUMBER =
      6.022_140_857e23;<br>
      &nbsp;&nbsp;public static final double BOLTZMANN_CONST&nbsp;&nbsp;=
      1.380_648_52e-23;<br>
      &nbsp;&nbsp;public static final double
      ELECTRON_MASS&nbsp;&nbsp;&nbsp;&nbsp;= 9.109_383_56e-31;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Incidentally,
      note the use of the underscore character (<code style="font-family: 'Courier New', monospace;">_</code>)
      in the numeric literals. Underscores, which have been legal since Java 7,
      have no effect on the values of numeric literals, but can make them much
      easier to read if used with discretion. Consider adding underscores to
      numeric literals, whether fixed of floating point, if they contain five or
      more consecutive digits. For base ten literals, whether integral or
      floating point, you should use underscores to separate literals into
      groups of three digits indicating positive and negative powers of one
      thousand.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Normally
      a utility class requires clients to qualify constant names with a class
      name, for example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">PhysicalConstants.AVOGADROS_NUMBER</code>.
      If you make heavy use of the constants exported by a utility class, you
      can avoid the need for qualifying the constants with the class name by
      making use of the<span class="Apple-converted-space">&nbsp;</span><em>static
        import</em><span class="Apple-converted-space">&nbsp;</span>facility:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex27a" id="pch4ex27" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Use of static import to avoid qualifying constants</strong><br>
      import static com.effectivejava.science.PhysicalConstants.*;<br>
      <br>
      public class Test {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;double&nbsp;&nbsp;atoms(double mols) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return AVOGADROS_NUMBER *
      mols;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Many more uses of PhysicalConstants justify
      static import<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, interfaces should be used only to define types. They should not
      be used merely to export constants.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev23" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_108"></span><strong>Item 23: Prefer class hierarchies to tagged
        classes</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Occasionally
      you may run across a class whose instances come in two or more flavors and
      contain a<span class="Apple-converted-space">&nbsp;</span><em>tag</em><span
        class="Apple-converted-space">&nbsp;</span>field indicating the flavor
      of the instance. For example, consider this class, which is capable of
      representing a circle or a rectangle:</p>
    <span epub:type="pagebreak" id="page_109" style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"></span><span
      style="font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; display: inline !important; float: none;"></span>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex28a" id="pch4ex28" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Tagged class - vastly inferior to a class hierarchy!</strong><br>
      class Figure {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;enum Shape { RECTANGLE, CIRCLE };<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Tag field - the shape of this figure<br>
      &nbsp;&nbsp;&nbsp;&nbsp;final Shape shape;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// These fields are used only if shape is
      RECTANGLE<br>
      &nbsp;&nbsp;&nbsp;&nbsp;double length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;double width;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// This field is used only if shape is CIRCLE<br>
      &nbsp;&nbsp;&nbsp;&nbsp;double radius;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Constructor for circle<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Figure(double radius) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shape = Shape.CIRCLE;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.radius = radius;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// Constructor for rectangle<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Figure(double length, double width) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shape = Shape.RECTANGLE;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.length = length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.width = width;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;double area() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch(shape) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case
      RECTANGLE:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      length * width;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case CIRCLE:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      Math.PI * (radius * radius);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new AssertionError(shape);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_110"></span>Such<span class="Apple-converted-space">&nbsp;</span><em>tagged
        classes</em><span class="Apple-converted-space">&nbsp;</span>have
      numerous shortcomings. They are cluttered with boilerplate, including enum
      declarations, tag fields, and switch statements. Readability is further
      harmed because multiple implementations are jumbled together in a single
      class. Memory footprint is increased because instances are burdened with
      irrelevant fields belonging to other flavors. Fields can’t be made final
      unless constructors initialize irrelevant fields, resulting in more
      boilerplate. Constructors must set the tag field and initialize the right
      data fields with no help from the compiler: if you initialize the wrong
      fields, the program will fail at runtime. You can’t add a flavor to a
      tagged class unless you can modify its source file. If you do add a
      flavor, you must remember to add a case to every switch statement, or the
      class will fail at runtime. Finally, the data type of an instance gives no
      clue as to its flavor. In short,<span class="Apple-converted-space">&nbsp;</span><strong>tagged
        classes are verbose, error-prone, and inefficient.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Luckily,
      object-oriented languages such as Java offer a far better alternative for
      defining a single data type capable of representing objects of multiple
      flavors: subtyping.<span class="Apple-converted-space">&nbsp;</span><strong>A
        tagged class is just a pallid imitation of a class hierarchy.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      transform a tagged class into a class hierarchy, first define an abstract
      class containing an abstract method for each method in the tagged class
      whose behavior depends on the tag value. In the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Figure</code><span class="Apple-converted-space">&nbsp;</span>class,
      there is only one such method, which is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">area</code>. This
      abstract class is the root of the class hierarchy. If there are any
      methods whose behavior does not depend on the value of the tag, put them
      in this class. Similarly, if there are any data fields used by all the
      flavors, put them in this class. There are no such flavor-independent
      methods or fields in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Figure</code><span class="Apple-converted-space">&nbsp;</span>class.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Next,
      define a concrete subclass of the root class for each flavor of the
      original tagged class. In our example, there are two: circle and
      rectangle. Include in each subclass the data fields particular to its
      flavor. In our example,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">radius</code><span class="Apple-converted-space">&nbsp;</span>is
      particular to circle, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">length</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">width</code><span
        class="Apple-converted-space">&nbsp;</span>are particular to rectangle.
      Also include in each subclass the appropriate implementation of each
      abstract method in the root class. Here is the class hierarchy
      corresponding to the original<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Figure</code><span class="Apple-converted-space">&nbsp;</span>class:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex29a" id="pch4ex29" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Class hierarchy replacement for a tagged class</strong><br>
      abstract class Figure {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;abstract double area();<br>
      }<br>
      <br>
      class Circle extends Figure {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;final double radius;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;Circle(double radius) { this.radius = radius; }<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override double area() { return Math.PI * (radius
      * radius); }<br>
      }<br>
      <span epub:type="pagebreak" id="page_111"></span>class Rectangle extends
      Figure {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;final double length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;final double width;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;Rectangle(double length, double width) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.length = length;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.width&nbsp;&nbsp;=
      width;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override double area() { return length * width; }<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      class hierarchy corrects every shortcoming of tagged classes noted
      previously. The code is simple and clear, containing none of the
      boilerplate found in the original. The implementation of each flavor is
      allotted its own class, and none of these classes is encumbered by
      irrelevant data fields. All fields are final. The compiler ensures that
      each class’s constructor initializes its data fields and that each class
      has an implementation for every abstract method declared in the root
      class. This eliminates the possibility of a runtime failure due to a
      missing switch case. Multiple programmers can extend the hierarchy
      independently and interoperably without access to the source for the root
      class. There is a separate data type associated with each flavor, allowing
      programmers to indicate the flavor of a variable and to restrict variables
      and input parameters to a particular flavor.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Another
      advantage of class hierarchies is that they can be made to reflect natural
      hierarchical relationships among types, allowing for increased flexibility
      and better compile-time type checking. Suppose the tagged class in the
      original example also allowed for squares. The class hierarchy could be
      made to reflect the fact that a square is a special kind of rectangle
      (assuming both are immutable):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex30a" id="pch4ex30" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">class
      Square extends Rectangle {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Square(double side) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(side, side);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that the fields in the above hierarchy are accessed directly rather than
      by accessor methods. This was done for brevity and would be a poor design
      if the hierarchy were public (<a href="ch4.xhtml#lev16" style="text-decoration: none;">Item
        16</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, tagged classes are seldom appropriate. If you’re tempted to write
      a class with an explicit tag field, think about whether the tag could be
      eliminated and the class replaced by a hierarchy. When you encounter an
      existing class with a tag field, consider refactoring it into a hierarchy.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev24" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_112"></span><strong>Item 24: Favor static member classes over
        nonstatic</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A<span
        class="Apple-converted-space">&nbsp;</span><em>nested class</em><span class="Apple-converted-space">&nbsp;</span>is
      a class defined within another class. A nested class should exist only to
      serve its enclosing class. If a nested class would be useful in some other
      context, then it should be a top-level class. There are four kinds of
      nested classes:<span class="Apple-converted-space">&nbsp;</span><em>static
        member classes</em>,<span class="Apple-converted-space">&nbsp;</span><em>nonstatic
        member classes</em>,<span class="Apple-converted-space">&nbsp;</span><em>anonymous
        classes</em>, and<span class="Apple-converted-space">&nbsp;</span><em>local
        classes</em>. All but the first kind are known as<span class="Apple-converted-space">&nbsp;</span><em>inner
        classes</em>. This item tells you when to use which kind of nested class
      and why.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      static member class is the simplest kind of nested class. It is best
      thought of as an ordinary class that happens to be declared inside another
      class and has access to all of the enclosing class’s members, even those
      declared private. A static member class is a static member of its
      enclosing class and obeys the same accessibility rules as other static
      members. If it is declared private, it is accessible only within the
      enclosing class, and so forth.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">One
      common use of a static member class is as a public helper class, useful
      only in conjunction with its outer class. For example, consider an enum
      describing the operations supported by a calculator (<a href="ch6.xhtml#lev34"
        style="text-decoration: none;">Item 34</a>). The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Operation</code><span class="Apple-converted-space">&nbsp;</span>enum
      should be a public static member class of the<code style="font-family: 'Courier New', monospace;">Calculator</code><span
        class="Apple-converted-space">&nbsp;</span>class. Clients of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Calculator</code><span class="Apple-converted-space">&nbsp;</span>could
      then refer to operations using names like<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Calculator.Operation.PLUS</code><span
        class="Apple-converted-space">&nbsp;</span>and<code style="font-family: 'Courier New', monospace;">Calculator.Operation.MINUS</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Syntactically,
      the only difference between static and nonstatic member classes is that
      static member classes have the modifier<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">static</code><span class="Apple-converted-space">&nbsp;</span>in
      their declarations. Despite the syntactic similarity, these two kinds of
      nested classes are very different. Each instance of a nonstatic member
      class is implicitly associated with an<span class="Apple-converted-space">&nbsp;</span><em>enclosing
        instance</em><span class="Apple-converted-space">&nbsp;</span>of its
      containing class. Within instance methods of a nonstatic member class, you
      can invoke methods on the enclosing instance or obtain a reference to the
      enclosing instance using the<span class="Apple-converted-space">&nbsp;</span><em>qualified
        this</em><span class="Apple-converted-space">&nbsp;</span>construct
      [JLS, 15.8.4]. If an instance of a nested class can exist in isolation
      from an instance of its enclosing class, then the nested class<span class="Apple-converted-space">&nbsp;</span><em>must</em><span
        class="Apple-converted-space">&nbsp;</span>be a static member class: it
      is impossible to create an instance of a nonstatic member class without an
      enclosing instance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      association between a nonstatic member class instance and its enclosing
      instance is established when the member class instance is created and
      cannot be modified thereafter. Normally, the association is established
      automatically by invoking a nonstatic member class constructor from within
      an instance method of the enclosing class. It is possible, though rare, to
      establish the association manually using the expression<code style="font-family: 'Courier New', monospace;">enclosingInstance.new
        MemberClass(args)</code>. As you would expect, the association takes up
      space in the nonstatic member class instance and adds time to its
      construction.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_113"></span>One common use of a nonstatic
      member class is to define an<span class="Apple-converted-space">&nbsp;</span><em>Adapter</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rGamma95"
        style="text-decoration: none;">Gamma95</a>] that allows an instance of
      the outer class to be viewed as an instance of some unrelated class. For
      example, implementations of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>interface
      typically use nonstatic member classes to implement their<em>collection
        views</em>, which are returned by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">keySet</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">entrySet</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">values</code><span
        class="Apple-converted-space">&nbsp;</span>methods. Similarly,
      implementations of the collection interfaces, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,
      typically use nonstatic member classes to implement their iterators:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex31a" id="pch4ex31" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typical use of a nonstatic member class</strong><br>
      public class MySet&lt;E&gt; extends AbstractSet&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // Bulk of the class omitted<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;@Override public Iterator&lt;E&gt; iterator() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new MyIterator();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>private class MyIterator implements
        Iterator&lt;E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>If
        you declare a member class that does not require access to an enclosing
        instance,</strong><span class="Apple-converted-space">&nbsp;</span><em><strong>always</strong></em><span
        class="Apple-converted-space">&nbsp;</span><strong>put the</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>static</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>modifier in its
        declaration,</strong><span class="Apple-converted-space">&nbsp;</span>making
      it a static rather than a nonstatic member class. If you omit this
      modifier, each instance will have a hidden extraneous reference to its
      enclosing instance. As previously mentioned, storing this reference takes
      time and space. More seriously, it can result in the enclosing instance
      being retained when it would otherwise be eligible for garbage collection
      (<a href="ch2.xhtml#lev7" style="text-decoration: none;">Item 7</a>). The
      resulting memory leak can be catastrophic. It is often difficult to detect
      because the reference is invisible.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      common use of private static member classes is to represent components of
      the object represented by their enclosing class. For example, consider a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code><span
        class="Apple-converted-space">&nbsp;</span>instance, which associates
      keys with values. Many<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>implementations
      have an internal<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Entry</code><span
        class="Apple-converted-space">&nbsp;</span>object for each key-value
      pair in the map. While each entry is associated with a map, the methods on
      an entry (<code style="font-family: 'Courier New', monospace;">getKey</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getValue</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">setValue</code>)
      do not need access to the map. Therefore, it would be wasteful to use a
      nonstatic member class to represent entries: a private static member class
      is best. If you accidentally omit the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">static</code><span class="Apple-converted-space">&nbsp;</span>modifier
      in the entry declaration, the map will still work, but each entry will
      contain a superfluous reference to the map, which wastes space and time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is doubly important to choose correctly between a static and a nonstatic
      member class if the class in question is a public or protected member of
      an<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_114"></span>exported class. In this case, the member class is
      an exported API element and cannot be changed from a nonstatic to a static
      member class in a subsequent release without violating backward
      compatibility.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      you would expect, an anonymous class has no name. It is not a member of
      its enclosing class. Rather than being declared along with other members,
      it is simultaneously declared and instantiated at the point of use.
      Anonymous classes are permitted at any point in the code where an
      expression is legal. Anonymous classes have enclosing instances if and
      only if they occur in a nonstatic context. But even if they occur in a
      static context, they cannot have any static members other than<span class="Apple-converted-space">&nbsp;</span><em>constant
        variables</em>, which are final primitive or string fields initialized
      to constant expressions [JLS, 4.12.4].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are many limitations on the applicability of anonymous classes. You can’t
      instantiate them except at the point they’re declared. You can’t perform<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">instanceof</code><span
        class="Apple-converted-space">&nbsp;</span>tests or do anything else
      that requires you to name the class. You can’t declare an anonymous class
      to implement multiple interfaces or to extend a class and implement an
      interface at the same time. Clients of an anonymous class can’t invoke any
      members except those it inherits from its supertype. Because anonymous
      classes occur in the midst of expressions, they must be kept short—about
      ten lines or fewer—or readability will suffer.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Before
      lambdas were added to Java (<a href="ch6.xhtml#ch6" style="text-decoration: none;">Chapter
        6</a>), anonymous classes were the preferred means of creating small<span
        class="Apple-converted-space">&nbsp;</span><em>function objects</em><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><em>process
        objects</em><span class="Apple-converted-space">&nbsp;</span>on the fly,
      but lambdas are now preferred (<a href="ch7.xhtml#lev42" style="text-decoration: none;">Item
        42</a>). Another common use of anonymous classes is in the
      implementation of static factory methods (see<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">intArrayAsList</code><span
        class="Apple-converted-space">&nbsp;</span>in<span class="Apple-converted-space">&nbsp;</span><a
        href="ch4.xhtml#lev20" style="text-decoration: none;">Item 20</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Local
      classes are the least frequently used of the four kinds of nested classes.
      A local class can be declared practically anywhere a local variable can be
      declared and obeys the same scoping rules. Local classes have attributes
      in common with each of the other kinds of nested classes. Like member
      classes, they have names and can be used repeatedly. Like anonymous
      classes, they have enclosing instances only if they are defined in a
      nonstatic context, and they cannot contain static members. And like
      anonymous classes, they should be kept short so as not to harm
      readability.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      recap, there are four different kinds of nested classes, and each has its
      place. If a nested class needs to be visible outside of a single method or
      is too long to fit comfortably inside a method, use a member class. If
      each instance of a member class needs a reference to its enclosing
      instance, make it nonstatic; otherwise, make it static. Assuming the class
      belongs inside a method, if you need to create instances from only one
      location and there is a preexisting type that characterizes the class,
      make it an anonymous class; otherwise, make it a local class.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev25" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_115"></span><strong>Item 25: Limit source files to a single
        top-level class</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      the Java compiler lets you define multiple top-level classes in a single
      source file, there are no benefits associated with doing so, and there are
      significant risks. The risks stem from the fact that defining multiple
      top-level classes in a source file makes it possible to provide multiple
      definitions for a class. Which definition gets used is affected by the
      order in which the source files are passed to the compiler.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make this concrete, consider this source file, which contains only a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Main</code><span
        class="Apple-converted-space">&nbsp;</span>class that refers to members
      of two other top-level classes (<code style="font-family: 'Courier New', monospace;">Utensil</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert</code>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex32a" id="pch4ex32" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Main {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(Utensil.NAME
      + Dessert.NAME);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      suppose you define both<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Utensil</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Dessert</code><span
        class="Apple-converted-space">&nbsp;</span>in a single source file named<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Utensil.java</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex33a" id="pch4ex33" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Two classes defined in one file. Don't ever do this!</strong><br>
      class Utensil {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final String NAME = "pan";<br>
      }<br>
      <br>
      class Dessert {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;static final String NAME = "cake";<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Of
      course the main program prints<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pancake</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      suppose you accidentally make<span class="Apple-converted-space">&nbsp;</span><em>another</em><span
        class="Apple-converted-space">&nbsp;</span>source file named<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert.java</code><span
        class="Apple-converted-space">&nbsp;</span>that defines the same two
      classes:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex34a" id="pch4ex34" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Two classes defined in one file. Don't ever do this!</strong><br>
      class Utensil {<br>
      &nbsp;&nbsp;&nbsp; static final String NAME = "pot";<br>
      }<br>
      <br>
      class Dessert {<br>
      &nbsp;&nbsp;&nbsp; static final String NAME = "pie";<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you’re lucky enough to compile the program with the command<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">javac Main.java
        Dessert.java</code>, the compilation will fail, and the compiler will<span
        class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak" id="page_116"></span>tell
      you that you’ve multiply defined the classes<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Utensil</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Dessert</code>.
      This is so because the compiler will first compile<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Main.java</code>, and
      when it sees the reference to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Utensil</code><span class="Apple-converted-space">&nbsp;</span>(which
      precedes the reference to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert</code>), it will
      look in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Utensil.java</code><span
        class="Apple-converted-space">&nbsp;</span>for this class and find both<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Utensil</code><span
        class="Apple-converted-space">&nbsp;</span>and<code style="font-family: 'Courier New', monospace;">Dessert</code>.
      When the compiler encounters<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert.java</code><span
        class="Apple-converted-space">&nbsp;</span>on the command line, it will
      pull in that file too, causing it to encounter both definitions of<code style="font-family: 'Courier New', monospace;">Utensil</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you compile the program with the command<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">javac Main.java</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">javac Main.java
        Utensil.java</code>, it will behave as it did before you wrote the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Dessert.java</code><span
        class="Apple-converted-space">&nbsp;</span>file, printing<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pancake</code>. But if
      you compile the program with the command<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">javac Dessert.java
        Main.java</code>, it will print<code style="font-family: 'Courier New', monospace;">potpie</code>.
      The behavior of the program is thus affected by the order in which the
      source files are passed to the compiler, which is clearly unacceptable.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Fixing
      the problem is as simple as splitting the top-level classes (<code style="font-family: 'Courier New', monospace;">Utensil</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Dessert</code>, in the
      case of our example) into separate source files. If you are tempted to put
      multiple top-level classes into a single source file, consider using
      static member classes (<a href="ch4.xhtml#lev24" style="text-decoration: none;">Item
        24</a>) as an alternative to splitting the classes into separate source
      files. If the classes are subservient to another class, making them into
      static member classes is generally the better alternative because it
      enhances readability and makes it possible to reduce the accessibility of
      the classes by declaring them private (<a href="ch4.xhtml#lev15" style="text-decoration: none;">Item
        15</a>). Here is how our example looks with static member classes:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch4_images.xhtml#pch4ex35a" id="pch4ex35" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Static member classes instead of multiple top-level classes</strong><br>
      public class Test {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(Utensil.NAME
      + Dessert.NAME);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static class Utensil {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static final String NAME =
      "pan";<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static class Dessert {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static final String NAME =
      "cake";<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      lesson is clear:<span class="Apple-converted-space">&nbsp;</span><strong>Never
        put multiple top-level classes or interfaces in a single source file.</strong><span
        class="Apple-converted-space">&nbsp;</span>Following this rule
      guarantees that you can’t have multiple definitions for a single class at
      compile time. This in turn guarantees that the class files generated by
      compilation, and the behavior of the resulting program, are independent of
      the order in which the source files are passed to the compiler.</p>
    <p></p>
    <p> </p>
    <h2 class="h2" id="ch5" style="font-size: 29px; margin-top: 30px; margin-bottom: 30px; text-align: justify; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Chapter
      5. Generics</h2>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>S</strong><small
        style="font-size: 0.7em;">INCE</small><span class="Apple-converted-space">&nbsp;</span>Java
      5, generics have been a part of the language. Before generics, you had to
      cast every object you read from a collection. If someone accidentally
      inserted an object of the wrong type, casts could fail at runtime. With
      generics, you tell the compiler what types of objects are permitted in
      each collection. The compiler inserts casts for you automatically and
      tells you<span class="Apple-converted-space">&nbsp;</span><em>at compile
        time</em><span class="Apple-converted-space">&nbsp;</span>if you try to
      insert an object of the wrong type. This results in programs that are both
      safer and clearer, but these benefits, which are not limited to
      collections, come at a price. This chapter tells you how to maximize the
      benefits and minimize the complications.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev26" style="text-decoration: none;"></a><strong>Item 26: Don’t use
        raw types</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">First,
      a few terms. A class or interface whose declaration has one or more<span class="Apple-converted-space">&nbsp;</span><em>type
        parameters</em><span class="Apple-converted-space">&nbsp;</span>is a<span
        class="Apple-converted-space">&nbsp;</span><em>generic</em><span class="Apple-converted-space">&nbsp;</span>class
      or interface [JLS, 8.1.2, 9.1.2]. For example, the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>interface
      has a single type parameter,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>, representing
      its element type. The full name of the interface is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(read “list of<code style="font-family: 'Courier New', monospace;">E</code>”),
      but people often call it<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>for
      short. Generic classes and interfaces are collectively known as<span class="Apple-converted-space">&nbsp;</span><em>generic
        types</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Each
      generic type defines a set of<span class="Apple-converted-space">&nbsp;</span><em>parameterized
        types</em>, which consist of the class or interface name followed by an
      angle-bracketed list of<em>actual type parameters</em><span class="Apple-converted-space">&nbsp;</span>corresponding
      to the generic type’s formal type parameters [JLS, 4.4, 4.5]. For example,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(read “list of string”) is a
      parameterized type representing a list whose elements are of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>. (<code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>is the actual type parameter
      corresponding to the formal type parameter<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>.)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Finally,
      each generic type defines a<span class="Apple-converted-space">&nbsp;</span><em>raw
        type</em>, which is the name of the generic type used without any
      accompanying type parameters [JLS, 4.8]. For example, the raw type
      corresponding to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>. Raw types
      behave as if all of the generic type information were erased from the type
      declaration. They exist primarily for compatibility with pre-generics
      code.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_118"></span>Before generics were added to
      Java, this would have been an exemplary collection declaration. As of Java
      9, it is still legal, but far from exemplary:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex1a" id="pch5ex1" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Raw collection type - don't do this!</strong><br>
      <br>
      // My stamp collection. Contains only Stamp instances.<br>
      private final<span class="Apple-converted-space">&nbsp;</span><strong>Collection</strong><span
        class="Apple-converted-space">&nbsp;</span>stamps = ... ;</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you use this declaration today and then accidentally put a coin into your
      stamp collection, the erroneous insertion compiles and runs without error
      (though the compiler does emit a vague warning):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex2a" id="pch5ex2" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Erroneous insertion of coin into stamp collection</strong><br>
      stamps.add(new Coin( ... )); // Emits "unchecked call" warning</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      don’t get an error until you try to retrieve the coin from the stamp
      collection:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex3a" id="pch5ex3" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Raw iterator type - don't do this!</strong><br>
      for (<strong>Iterator</strong><span class="Apple-converted-space">&nbsp;</span>i
      = stamps.iterator(); i.hasNext(); )<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Stamp stamp =<span class="Apple-converted-space">&nbsp;</span><strong>(Stamp)</strong><span
        class="Apple-converted-space">&nbsp;</span>i.next();<span class="Apple-converted-space">&nbsp;</span><strong>//
        Throws ClassCastException</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stamp.cancel();</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      mentioned throughout this book, it pays to discover errors as soon as
      possible after they are made, ideally at compile time. In this case, you
      don’t discover the error until runtime, long after it has happened, and in
      code that may be distant from the code containing the error. Once you see
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code>,
      you have to search through the codebase looking for the method invocation
      that put the coin into the stamp collection. The compiler can’t help you,
      because it can’t understand the comment that says, “<code style="font-family: 'Courier New', monospace;">Contains
        only Stamp instances</code>.”</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">With
      generics, the type declaration contains the information, not the comment:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex4a" id="pch5ex4" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Parameterized collection type - typesafe</strong><br>
      private final<span class="Apple-converted-space">&nbsp;</span><strong>Collection&lt;Stamp&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>stamps = ... ;</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">From
      this declaration, the compiler knows that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">stamps</code><span class="Apple-converted-space">&nbsp;</span>should
      contain only<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stamp</code><span
        class="Apple-converted-space">&nbsp;</span>instances and<span class="Apple-converted-space">&nbsp;</span><em>guarantees</em><span
        class="Apple-converted-space">&nbsp;</span>it to be true, assuming your
      entire codebase compiles without emitting (or suppressing; see<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev27" style="text-decoration: none;">Item 27</a>) any
      warnings. When<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">stamps</code><span
        class="Apple-converted-space">&nbsp;</span>is declared with a
      parameterized type declaration, the erroneous insertion generates a
      compile-time error message that tells you<span class="Apple-converted-space">&nbsp;</span><em>exactly</em><span
        class="Apple-converted-space">&nbsp;</span>what is wrong:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex5a" id="pch5ex5" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Test.java:9:
      error: incompatible types: Coin cannot be converted<br>
      to Stamp<br>
      &nbsp;&nbsp;&nbsp;&nbsp;c.add(new Coin());<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_119"></span>The compiler inserts
      invisible casts for you when retrieving elements from collections and
      guarantees that they won’t fail (assuming, again, that all of your code
      did not generate or suppress any compiler warnings). While the prospect of
      accidentally inserting a coin into a stamp collection may appear
      far-fetched, the problem is real. For example, it is easy to imagine
      putting a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">BigInteger</code><span
        class="Apple-converted-space">&nbsp;</span>into a collection that is
      supposed to contain only<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">BigDecimal</code><span class="Apple-converted-space">&nbsp;</span>instances.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      noted earlier, it is legal to use raw types (generic types without their
      type parameters), but you should never do it.<span class="Apple-converted-space">&nbsp;</span><strong>If
        you use raw types, you lose all the safety and expressiveness benefits
        of generics.</strong><span class="Apple-converted-space">&nbsp;</span>Given
      that you shouldn’t use them, why did the language designers permit raw
      types in the first place? For compatibility. Java was about to enter its
      second decade when generics were added, and there was an enormous amount
      of code in existence that did not use generics. It was deemed critical
      that all of this code remain legal and interoperate with newer code that
      does use generics. It had to be legal to pass instances of parameterized
      types to methods that were designed for use with raw types, and vice
      versa. This requirement, known as<span class="Apple-converted-space">&nbsp;</span><em>migration
        compatibility</em>, drove the decisions to support raw types and to
      implement generics using<span class="Apple-converted-space">&nbsp;</span><em>erasure</em>(<a
        href="ch5.xhtml#lev28" style="text-decoration: none;">Item 28</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">While
      you shouldn’t use raw types such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>, it is fine
      to use types that are parameterized to allow insertion of arbitrary
      objects, such as<code style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>.
      Just what is the difference between the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>and
      the parameterized type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>?
      Loosely speaking, the former has opted out of the generic type system,
      while the latter has explicitly told the compiler that it is capable of
      holding objects of any type. While you can pass a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>to a parameter of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>, you can’t
      pass it to a parameter of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>.
      There are sub-typing rules for generics, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is a subtype of the raw type<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,
      but not of the parameterized type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev28" style="text-decoration: none;">Item
        28</a>). As a consequence,<strong>you lose type safety if you use a raw
        type such as</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>List</strong></code><strong>,
        but not if you use a parameterized type such as</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>List&lt;Object&gt;</strong></code><strong>.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      make this concrete, consider the following program:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex6a" id="pch5ex6" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Fails at runtime - unsafeAdd method uses a raw type (List)!</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;List&lt;String&gt; strings = new
      ArrayList&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;unsafeAdd(strings, Integer.valueOf(42));<br>
      &nbsp;&nbsp;&nbsp;&nbsp;String s =<span class="Apple-converted-space">&nbsp;</span><strong>strings.get(0);
        // Has compiler-generated cast</strong><br>
      }<br>
      <br>
      private static void unsafeAdd(<strong>List</strong><span class="Apple-converted-space">&nbsp;</span>list,
      Object o) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;list.add(o);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_120"></span>This program compiles, but
      because it uses the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code>, you get a
      warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex7a" id="pch5ex7" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Test.java:10:
      warning: [unchecked] unchecked call to add(E) as a<br>
      member of the raw type List<br>
      &nbsp;&nbsp;&nbsp;&nbsp;list.add(o);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">And
      indeed, if you run the program, you get a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>when the program tries to
      cast the result of the invocation<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">strings.get(0)</code>,
      which is an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code>,
      to a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code>.
      This is a compiler-generated cast, so it’s normally guaranteed to succeed,
      but in this case we ignored a compiler warning and paid the price.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you replace the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List</code><span class="Apple-converted-space">&nbsp;</span>with
      the parameterized type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>in the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">unsafeAdd</code><span class="Apple-converted-space">&nbsp;</span>declaration
      and try to recompile the program, you’ll find that it no longer compiles
      but emits the error message:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex8a" id="pch5ex8" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Test.java:5:
      error: incompatible types: List&lt;String&gt; cannot be<br>
      converted to List&lt;Object&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;unsafeAdd(strings, Integer.valueOf(42));<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      might be tempted to use a raw type for a collection whose element type is
      unknown and doesn’t matter. For example, suppose you want to write a
      method that takes two sets and returns the number of elements they have in
      common. Here’s how you might write such a method if you were new to
      generics:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex9a" id="pch5ex9" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Use of raw type for unknown element type - don't do this!</strong><br>
      static int numElementsInCommon(<strong>Set s1, Set s2</strong>) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int result = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (Object o1 : s1)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (s2.contains(o1))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result++;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method works but it uses raw types, which are dangerous. The safe
      alternative is to use<span class="Apple-converted-space">&nbsp;</span><em>unbounded
        wildcard types</em>. If you want to use a generic type but you don’t
      know or care what the actual type parameter is, you can use a question
      mark instead. For example, the unbounded wildcard type for the generic
      type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(read “set of some type”). It
      is the most general parameterized<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>type,
      capable of holding<em>any</em><span class="Apple-converted-space">&nbsp;</span>set.
      Here is how the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">numElementsInCommon</code><span
        class="Apple-converted-space">&nbsp;</span>declaration looks with
      unbounded wildcard types:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex10a" id="pch5ex10" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Uses unbounded wildcard type - typesafe and flexible</strong><br>
      static int numElementsInCommon(<strong>Set&lt;?&gt; s1, Set&lt;?&gt; s2</strong>)
      { ... }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_121"></span>What is the difference
      between the unbounded wildcard type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code>? Does the
      question mark really buy you anything? Not to belabor the point, but the
      wildcard type is safe and the raw type isn’t. You can put<span class="Apple-converted-space">&nbsp;</span><em>any</em><span
        class="Apple-converted-space">&nbsp;</span>element into a collection
      with a raw type, easily corrupting the collection’s type invariant (as
      demonstrated by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">unsafeAdd</code><span class="Apple-converted-space">&nbsp;</span>method
      on page 119);<span class="Apple-converted-space">&nbsp;</span><strong>you
        can’t put any element (other than</strong><code style="font-family: 'Courier New', monospace;"><strong>null</strong></code><strong>)
        into a</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>Collection&lt;?&gt;</strong></code><strong>.</strong><span
        class="Apple-converted-space">&nbsp;</span>Attempting to do so will
      generate a compile-time error message like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex11a" id="pch5ex11" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">WildCard.java:13:
      error: incompatible types: String cannot be<br>
      converted to CAP#1<br>
      &nbsp;&nbsp;&nbsp;&nbsp;c.add("verboten");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^<br>
      &nbsp;&nbsp;where CAP#1 is a fresh type-variable:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;CAP#1 extends Object from capture of ?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Admittedly
      this error message leaves something to be desired, but the compiler has
      done its job, preventing you from corrupting the collection’s type
      invariant, whatever its element type may be. Not only can’t you put any
      element (other than<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>) into a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collection&lt;?&gt;</code>,
      but you can’t assume anything about the type of the objects that you get
      out. If these restrictions are unacceptable, you can use<span class="Apple-converted-space">&nbsp;</span><em>generic
        methods</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Item 30</a>) or<em>bounded wildcard types</em><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev31" style="text-decoration: none;">Item
        31</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are a few minor exceptions to the rule that you should not use raw types.<span
        class="Apple-converted-space">&nbsp;</span><strong>You must use raw
        types in class literals.</strong><span class="Apple-converted-space">&nbsp;</span>The
      specification does not permit the use of parameterized types (though it
      does permit array types and primitive types) [JLS, 15.8.2]. In other
      words,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List.class</code>,<code
        style="font-family: 'Courier New', monospace;">String[].class</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">int.class</code><span
        class="Apple-converted-space">&nbsp;</span>are all legal, but<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;?&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>are not.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      second exception to the rule concerns the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instanceof</code><span class="Apple-converted-space">&nbsp;</span>operator.
      Because generic type information is erased at runtime, it is illegal to
      use the<code style="font-family: 'Courier New', monospace;">instanceof</code><span
        class="Apple-converted-space">&nbsp;</span>operator on parameterized
      types other than unbounded wildcard types. The use of unbounded wildcard
      types in place of raw types does not affect the behavior of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instanceof</code><span class="Apple-converted-space">&nbsp;</span>operator
      in any way. In this case, the angle brackets and question marks are just
      noise.<span class="Apple-converted-space">&nbsp;</span><strong>This is the
        preferred way to use the</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>instanceof</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>operator with generic
        types:</strong></p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex12a" id="pch5ex12" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Legitimate use of raw type - instanceof operator</strong><br>
      if (o instanceof<span class="Apple-converted-space">&nbsp;</span><strong>Set</strong>)
      {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // Raw type<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>Set&lt;?&gt;</strong><span class="Apple-converted-space">&nbsp;</span>s
      =<span class="Apple-converted-space">&nbsp;</span><strong>(Set&lt;?&gt;)</strong><span
        class="Apple-converted-space">&nbsp;</span>o;&nbsp;&nbsp;&nbsp;&nbsp;//
      Wildcard type<br>
      &nbsp;&nbsp;&nbsp;&nbsp;...<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_122"></span>Note that once you’ve
      determined that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">o</code><span
        class="Apple-converted-space">&nbsp;</span>is a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code>, you must cast
      it to the wildcard type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;?&gt;</code>, not
      the raw type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code>.
      This is a checked cast, so it will not cause a compiler warning.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, using raw types can lead to exceptions at runtime, so don’t use
      them. They are provided only for compatibility and interoperability with
      legacy code that predates the introduction of generics. As a quick review,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is a parameterized type
      representing a set that can contain objects of any type,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is a wildcard type
      representing a set that can contain only objects of some unknown type, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set</code><span
        class="Apple-converted-space">&nbsp;</span>is a raw type, which opts out
      of the generic type system. The first two are safe, and the last is not.</p>
    <p class="indentb" style="margin-top: 0px; margin-bottom: 13.333334px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      quick reference, the terms introduced in this item (and a few introduced
      later in this chapter) are summarized in the following table:</p>
    <table class="tablewidth" style="border-collapse: collapse; width: 1179px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
      <tbody>
        <tr>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Term</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Example</strong></p>
          </td>
          <td class="table1" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; padding: 0.3em; border-top-style: solid; border-top-width: 0.2em; border-top-border-bottom-style: solid; border-bottom-width: 0.1em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent-t" style="margin-top: 4.5px; margin-bottom: 4.5px; margin-left: 6px; text-indent: 0px;"><strong>Item</strong></p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Parameterized
              type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Actual
              type parameter</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">String</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Generic
              type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Items
              26, 29</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Formal
              type parameter</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">E</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Unbounded
              wildcard type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List&lt;?&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Raw
              type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              26</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Bounded
              type parameter</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">&lt;E extends
                Number&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              29</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Recursive
              type bound</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">&lt;T extends
                Comparable&lt;T&gt;&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              30</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Bounded
              wildcard type</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">List&lt;? extends
                Number&gt;</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              31</p>
          </td>
        </tr>
        <tr>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Generic
              method</p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">static &lt;E&gt;
                List&lt;E&gt; asList(E[] a)</code></p>
          </td>
          <td style="vertical-align: top;">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              30</p>
          </td>
        </tr>
        <tr>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Type
              token</p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;"><code
                style="font-family: 'Courier New', monospace;">String.class</code></p>
          </td>
          <td class="table2" style="vertical-align: top; margin-top: 0px; margin-bottom: 0px; border-bottom-style: solid; border-bottom-width: 0.2em; border-bottom-color: rgb(0, 0, 0);">
            <p class="noindent1" style="margin-top: 3px; margin-bottom: 7.5px; margin-left: 7.5px; text-indent: 0.0026666669px;">Item
              33</p>
          </td>
        </tr>
      </tbody>
    </table>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev27" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_123"></span><strong>Item 27: Eliminate unchecked warnings</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you program with generics, you will see many compiler warnings: unchecked
      cast warnings, unchecked method invocation warnings, unchecked
      parameterized vararg type warnings, and unchecked conversion warnings. The
      more experience you acquire with generics, the fewer warnings you’ll get,
      but don’t expect newly written code to compile cleanly.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      unchecked warnings are easy to eliminate. For example, suppose you
      accidentally write this declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex13a" id="pch5ex13" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Lark&gt;
      exaltation = new HashSet();</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      compiler will gently remind you what you did wrong:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex14a" id="pch5ex14" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Venery.java:4:
      warning: [unchecked] unchecked conversion<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;Lark&gt; exaltation
      = new HashSet();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;required: Set&lt;Lark&gt;<br>
      &nbsp;&nbsp;found:&nbsp;&nbsp;&nbsp;&nbsp;HashSet</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can then make the indicated correction, causing the warning to disappear.
      Note that you don’t actually have to specify the type parameter, merely to
      indicate that it’s present with the<span class="Apple-converted-space">&nbsp;</span><em>diamond
        operator</em><span class="Apple-converted-space">&nbsp;</span>(<code style="font-family: 'Courier New', monospace;">&lt;&gt;</code>),
      introduced in Java 7. The compiler will then<span class="Apple-converted-space">&nbsp;</span><em>infer</em><span
        class="Apple-converted-space">&nbsp;</span>the correct actual type
      parameter (in this case,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Lark</code>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex15a" id="pch5ex15" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Lark&gt;
      exaltation = new HashSet<strong>&lt;&gt;</strong>();</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Some
      warnings will be<span class="Apple-converted-space">&nbsp;</span><em>much</em><span
        class="Apple-converted-space">&nbsp;</span>more difficult to eliminate.
      This chapter is filled with examples of such warnings. When you get
      warnings that require some thought, persevere!<span class="Apple-converted-space">&nbsp;</span><strong>Eliminate
        every unchecked warning that you can.</strong><span class="Apple-converted-space">&nbsp;</span>If
      you eliminate all warnings, you are assured that your code is typesafe,
      which is a very good thing. It means that you won’t get a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime, and it increases
      your confidence that your program will behave as you intended.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>If
        you can’t eliminate a warning, but you can prove that the code that
        provoked the warning is typesafe, then (and only then) suppress the
        warning with an</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>@SuppressWarnings("unchecked")</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>annotation.</strong><span
        class="Apple-converted-space">&nbsp;</span>If you suppress warnings
      without first proving that the code is typesafe, you are giving yourself a
      false sense of security. The code may compile without emitting any
      warnings, but it can still throw a<code style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime. If, however, you
      ignore unchecked warnings that you know to be safe (instead of suppressing
      them), you won’t notice when a new warning crops up that represents a real
      problem. The new warning will get lost amidst all the false alarms that
      you didn’t silence.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_124"></span>The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SuppressWarnings</code><span
        class="Apple-converted-space">&nbsp;</span>annotation can be used on any
      declaration, from an individual local variable declaration to an entire
      class.<span class="Apple-converted-space">&nbsp;</span><strong>Always use
        the</strong><span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>SuppressWarnings</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>annotation on the
        smallest scope possible.</strong><span class="Apple-converted-space">&nbsp;</span>Typically
      this will be a variable declaration or a very short method or constructor.
      Never use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SuppressWarnings</code><span
        class="Apple-converted-space">&nbsp;</span>on an entire class. Doing so
      could mask critical warnings.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you find yourself using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SuppressWarnings</code><span
        class="Apple-converted-space">&nbsp;</span>annotation on a method or
      constructor that’s more than one line long, you may be able to move it
      onto a local variable declaration. You may have to declare a new local
      variable, but it’s worth it. For example, consider this<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toArray</code>method,
      which comes from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ArrayList</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex16a" id="pch5ex16" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      &lt;T&gt; T[] toArray(T[] a) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (a.length &lt; size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (T[]) Arrays.copyOf(elements,
      size, a.getClass());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(elements, 0, a, 0, size);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (a.length &gt; size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a[size] = null;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return a;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you compile<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ArrayList</code>,
      the method generates this warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex17a" id="pch5ex17" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">ArrayList.java:305:
      warning: [unchecked] unchecked cast<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (T[]) Arrays.copyOf(elements,
      size, a.getClass());<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;required: T[]<br>
      &nbsp;&nbsp;found:&nbsp;&nbsp;&nbsp;&nbsp;Object[]</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is illegal to put a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SuppressWarnings</code><span
        class="Apple-converted-space">&nbsp;</span>annotation on the return
      statement, because it isn’t a declaration [JLS, 9.7]. You might be tempted
      to put the annotation on the entire method, but don’t. Instead, declare a
      local variable to hold the return value and annotate its declaration, like
      so:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex18a" id="pch5ex18" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Adding local variable to reduce scope of @SuppressWarnings</strong><br>
      public &lt;T&gt; T[] toArray(T[] a) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (a.length &lt; size) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>// This cast is
        correct because the array we're creating</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>// is of the same
        type as the one passed in, which is T[].</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>@SuppressWarnings("unchecked")
        T[] result =</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>(T[])
        Arrays.copyOf(elements, size, a.getClass());</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>return result;</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;System.arraycopy(elements, 0, a, 0, size);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (a.length &gt; size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a[size] = null;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return a;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_125"></span>The resulting method compiles
      cleanly and minimizes the scope in which unchecked warnings are
      suppressed.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>Every
        time you use a</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>@SuppressWarnings("unchecked")</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>annotation, add a
        comment saying why it is safe to do so.</strong><span class="Apple-converted-space">&nbsp;</span>This
      will help others understand the code, and more importantly, it will
      decrease the odds that someone will modify the code so as to make the
      computation unsafe. If you find it hard to write such a comment, keep
      thinking. You may end up figuring out that the unchecked operation isn’t
      safe after all.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, unchecked warnings are important. Don’t ignore them. Every
      unchecked warning represents the potential for a<code style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime. Do your best to
      eliminate these warnings. If you can’t eliminate an unchecked warning and
      you can prove that the code that provoked it is typesafe, suppress the
      warning with a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@SuppressWarnings("unchecked")</code><span
        class="Apple-converted-space">&nbsp;</span>annotation in the narrowest
      possible scope. Record the rationale for your decision to suppress the
      warning in a comment.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev28" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_126"></span><strong>Item 28: Prefer lists to arrays</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Arrays
      differ from generic types in two important ways. First, arrays are<span class="Apple-converted-space">&nbsp;</span><em>covariant</em>.
      This scary-sounding word means simply that if<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Sub</code><span class="Apple-converted-space">&nbsp;</span>is
      a subtype of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Super</code>,
      then the array type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Sub[]</code><span class="Apple-converted-space">&nbsp;</span>is
      a subtype of the array type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Super[]</code>. Generics,
      by contrast, are<span class="Apple-converted-space">&nbsp;</span><em>invariant</em>:
      for any two distinct types<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Type1</code>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Type2</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Type1&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is neither a subtype nor a
      supertype of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Type2&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>[JLS, 4.10; Naftalin07, 2.5].
      You might think this means that generics are deficient, but arguably it is
      arrays that are deficient. This code fragment is legal:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex19a" id="pch5ex19" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Fails at runtime!</strong><br>
      Object[] objectArray = new Long[1];<br>
      objectArray[0] = "I don't fit in";<span class="Apple-converted-space">&nbsp;</span><strong>//
        Throws ArrayStoreException</strong></p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">but
      this one is not:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex20a" id="pch5ex20" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Won't compile!</strong><br>
      List&lt;Object&gt; ol = new ArrayList&lt;Long&gt;();<span class="Apple-converted-space">&nbsp;</span><strong>//
        Incompatible types</strong><br>
      ol.add("I don't fit in");</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Either
      way you can’t put a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>into
      a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Long</code><span
        class="Apple-converted-space">&nbsp;</span>container, but with an array
      you find out that you’ve made a mistake at runtime; with a list, you find
      out at compile time. Of course, you’d rather find out at compile time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      second major difference between arrays and generics is that arrays are<span
        class="Apple-converted-space">&nbsp;</span><em>reified</em><span class="Apple-converted-space">&nbsp;</span>[JLS,
      4.7]. This means that arrays know and enforce their element type at
      runtime. As noted earlier, if you try to put a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>into
      an array of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Long</code>,
      you’ll get an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ArrayStoreException</code>.
      Generics, by contrast, are implemented by<span class="Apple-converted-space">&nbsp;</span><em>erasure</em><span
        class="Apple-converted-space">&nbsp;</span>[JLS, 4.6]. This means that
      they enforce their type constraints only at compile time and discard (or<span
        class="Apple-converted-space">&nbsp;</span><em>erase</em>) their element
      type information at runtime. Erasure is what allowed generic types to
      interoperate freely with legacy code that didn’t use generics (<a href="ch5.xhtml#lev26"
        style="text-decoration: none;">Item 26</a>), ensuring a smooth
      transition to generics in Java 5.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Because
      of these fundamental differences, arrays and generics do not mix well. For
      example, it is illegal to create an array of a generic type, a
      parameterized type, or a type parameter. Therefore, none of these array
      creation expressions are legal:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">new List&lt;E&gt;[]</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">new
        List&lt;String&gt;[]</code>,<code style="font-family: 'Courier New', monospace;">new
        E[]</code>. All will result in<span class="Apple-converted-space">&nbsp;</span><em>generic
        array creation</em><span class="Apple-converted-space">&nbsp;</span>errors
      at compile time.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Why
      is it illegal to create a generic array? Because it isn’t typesafe. If it
      were legal, casts generated by the compiler in an otherwise correct
      program could fail at runtime with a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>.
      This would violate the fundamental guarantee provided by the generic type
      system.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_127"></span>To make this more concrete,
      consider the following code fragment:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex21a" id="pch5ex21" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Why generic array creation is illegal - won't compile!</strong><br>
      List&lt;String&gt;[] stringLists =<span class="Apple-converted-space">&nbsp;</span><strong>new
        List&lt;String&gt;[1]</strong>;&nbsp;&nbsp;// (1)<br>
      List&lt;Integer&gt; intList =
      List.of(42);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      // (2)<br>
      Object[] objects =
      stringLists;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (3)<br>
      objects[0] =
      intList;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (4)<br>
      String s =
      stringLists[0].get(0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//
      (5)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Let’s
      pretend that line 1, which creates a generic array, is legal. Line 2
      creates and initializes a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>containing a single element.
      Line 3 stores the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>array into an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>array
      variable, which is legal because arrays are covariant. Line 4 stores the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>into the sole element of the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>array, which succeeds because
      generics are implemented by erasure: the runtime type of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code>instance
      is simply<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code>,
      and the runtime type of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;[]</code><span
        class="Apple-converted-space">&nbsp;</span>instance is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List[]</code>, so this
      assignment doesn’t generate an<code style="font-family: 'Courier New', monospace;">ArrayStoreException</code>.
      Now we’re in trouble. We’ve stored a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>instance into an array that
      is declared to hold only<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>instances.
      In line 5, we retrieve the sole element from the sole list in this array.
      The compiler automatically casts the retrieved element to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>, but it’s
      an<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code>,
      so we get a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime. In order to
      prevent this from happening, line 1 (which creates a generic array) must
      generate a compile-time error.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Types
      such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>are technically known as<span
        class="Apple-converted-space">&nbsp;</span><em>nonreifiable</em><span class="Apple-converted-space">&nbsp;</span>types
      [JLS, 4.7]. Intuitively speaking, a non-reifiable type is one whose
      runtime representation contains less information than its compile-time
      representation. Because of erasure, the only parameterized types that are
      reifiable are unbounded wildcard types such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map&lt;?,?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev26" style="text-decoration: none;">Item
        26</a>). It is legal, though rarely useful, to create arrays of
      unbounded wildcard types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      prohibition on generic array creation can be annoying. It means, for
      example, that it’s not generally possible for a generic collection to
      return an array of its element type (but see<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev33" style="text-decoration: none;">Item 33</a><span class="Apple-converted-space">&nbsp;</span>for
      a partial solution). It also means that you get confusing warnings when
      using varargs methods (<a href="ch8.xhtml#lev53" style="text-decoration: none;">Item
        53</a>) in combination with generic types. This is because every time
      you invoke a varargs method, an array is created to hold the varargs
      parameters. If the element type of this array is not reifiable, you get a
      warning. The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>annotation can be used to
      address this issue (<a href="ch5.xhtml#lev32" style="text-decoration: none;">Item
        32</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you get a generic array creation error or an unchecked cast warning on a
      cast to an array type, the best solution is often to use the collection
      type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>in preference to the array
      type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E[]</code>.
      You might sacrifice some conciseness or performance, but in exchange you
      get better type safety and interoperability.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_128"></span>For example, suppose you want
      to write a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Chooser</code><span
        class="Apple-converted-space">&nbsp;</span>class with a constructor that
      takes a collection, and a single method that returns an element of the
      collection chosen at random. Depending on what collection you pass to the
      constructor, you could use a chooser as a game die, a magic 8-ball, or a
      data source for a Monte Carlo simulation. Here’s a simplistic
      implementation without generics:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex22a" id="pch5ex22" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Chooser - a class badly in need of generics!</strong><br>
      public class Chooser {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final Object[] choiceArray;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Chooser(Collection choices) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceArray =
      choices.toArray();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Object choose() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Random rnd =
      ThreadLocalRandom.current();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return
      choiceArray[rnd.nextInt(choiceArray.length)];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      use this class, you have to cast the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">choose</code><span class="Apple-converted-space">&nbsp;</span>method’s
      return value from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>to the desired type every
      time you use invoke the method, and the cast will fail at runtime if you
      get the type wrong. Taking the advice of<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev29" style="text-decoration: none;">Item 29</a><span class="Apple-converted-space">&nbsp;</span>to
      heart, we attempt to modify<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Chooser</code><span class="Apple-converted-space">&nbsp;</span>to
      make it generic. Changes are shown in boldface:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex23a" id="pch5ex23" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        A first cut at making Chooser generic - won't compile</strong><br>
      public class Chooser<strong>&lt;T&gt;</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final<span class="Apple-converted-space">&nbsp;</span><strong>T</strong>[]
      choiceArray;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Chooser(Collection<strong>&lt;T&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>choices) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceArray =
      choices.toArray();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;// choose method unchanged<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you try to compile this class, you’ll get this error message:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex24a" id="pch5ex24" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Chooser.java:9:
      error: incompatible types: Object[] cannot be<br>
      converted to T[]<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceArray =
      choices.toArray();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;where T is a type-variable:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;T extends Object declared in class Chooser</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_129"></span>No big deal, you say, I’ll
      cast the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>array to a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>array:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex25a" id="pch5ex25" style="text-decoration: none;">&nbsp;</a></p>
    <p class="prec" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; text-align: center; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">choiceArray
      = (T[]) choices.toArray();</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      gets rid of the error, but instead you get a warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex26a" id="pch5ex26" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Chooser.java:9:
      warning: [unchecked] unchecked cast<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceArray = (T[])
      choices.toArray();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;required: T[], found: Object[]<br>
      &nbsp;&nbsp;where T is a type-variable:<br>
      T extends Object declared in class Chooser</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      compiler is telling you that it can’t vouch for the safety of the cast at
      runtime because the program won’t know what type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>represents—remember,
      element type information is erased from generics at runtime. Will the
      program work? Yes, but the compiler can’t prove it. You could prove it to
      yourself, put the proof in a comment and suppress the warning with an
      annotation, but you’re better off eliminating the cause of warning (<a href="ch5.xhtml#lev27"
        style="text-decoration: none;">Item 27</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      eliminate the unchecked cast warning, use a list instead of an array. Here
      is a version of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Chooser</code><span class="Apple-converted-space">&nbsp;</span>class
      that compiles without error or warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex27a" id="pch5ex27" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        List-based Chooser - typesafe</strong><br>
      public class Chooser&lt;T&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private final<span class="Apple-converted-space">&nbsp;</span><strong>List&lt;T&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>choiceList;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Chooser(Collection&lt;T&gt; choices) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;choiceList =<span class="Apple-converted-space">&nbsp;</span><strong>new
        ArrayList&lt;&gt;(choices)</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public T choose() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Random rnd =
      ThreadLocalRandom.current();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="Apple-converted-space">&nbsp;</span><strong>choiceList.get(rnd.nextInt(choiceList.size()))</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      version is a tad more verbose, and perhaps a tad slower, but it’s worth it
      for the peace of mind that you won’t get a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, arrays and generics have very different type rules. Arrays are
      covariant and reified; generics are invariant and erased. As a
      consequence, arrays provide runtime type safety but not compile-time type
      safety, and vice versa for generics. As a rule, arrays and generics don’t
      mix well. If you find yourself mixing them and getting compile-time errors
      or warnings, your first impulse should be to replace the arrays with
      lists.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev29" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_130"></span><strong>Item 29: Favor generic types</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is generally not too difficult to parameterize your declarations and make
      use of the generic types and methods provided by the JDK. Writing your own
      generic types is a bit more difficult, but it’s worth the effort to learn
      how.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Consider
      the simple (toy) stack implementation from<span class="Apple-converted-space">&nbsp;</span><a
        href="ch2.xhtml#lev7" style="text-decoration: none;">Item 7</a>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex28a" id="pch5ex28" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Object-based collection - a prime candidate for generics</strong><br>
      public class Stack {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private<span class="Apple-converted-space">&nbsp;</span><strong>Object</strong>[]
      elements;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int size = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int DEFAULT_INITIAL_CAPACITY
      = 16;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements = new<span class="Apple-converted-space">&nbsp;</span><strong>Object</strong>[DEFAULT_INITIAL_CAPACITY];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(<strong>Object</strong><span class="Apple-converted-space">&nbsp;</span>e)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensureCapacity();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size++] = e;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public<span class="Apple-converted-space">&nbsp;</span><strong>Object</strong><span
        class="Apple-converted-space">&nbsp;</span>pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Object</strong><span
        class="Apple-converted-space">&nbsp;</span>result = elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size] = null; //
      Eliminate obsolete reference<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean isEmpty() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return size == 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;private void ensureCapacity() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (elements.length ==
      size)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements
      = Arrays.copyOf(elements, 2 * size + 1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      class should have been parameterized to begin with, but since it wasn’t,
      we can<span class="Apple-converted-space">&nbsp;</span><em>generify</em><span
        class="Apple-converted-space">&nbsp;</span>it after the fact. In other
      words, we can parameterize it without harming clients of the original
      non-parameterized version. As it stands, the client has to cast objects
      that are popped off the stack, and those casts might fail at runtime. The
      first step in generifying a class is to add one or more type parameters to
      its<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_131"></span>declaration. In this case there is one type
      parameter, representing the element type of the stack, and the
      conventional name for this type parameter is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch9.xhtml#lev68" style="text-decoration: none;">Item 68</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      next step is to replace all the uses of the type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>with
      the appropriate type parameter and then try to compile the resulting
      program:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex29a" id="pch5ex29" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Initial attempt to generify Stack - won't compile!</strong><br>
      public class Stack<strong>&lt;E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>{<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private<span class="Apple-converted-space">&nbsp;</span><strong>E</strong>[]
      elements;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private int size = 0;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private static final int DEFAULT_INITIAL_CAPACITY
      = 16;<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements = new<span class="Apple-converted-space">&nbsp;</span><strong>E</strong>[DEFAULT_INITIAL_CAPACITY];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(<strong>E</strong><span class="Apple-converted-space">&nbsp;</span>e)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensureCapacity();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size++] = e;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public<span class="Apple-converted-space">&nbsp;</span><strong>E</strong><span
        class="Apple-converted-space">&nbsp;</span>pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw
      new EmptyStackException();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>E</strong><span class="Apple-converted-space">&nbsp;</span>result
      = elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements[size] = null; //
      Eliminate obsolete reference<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;... // no changes in isEmpty or ensureCapacity<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You’ll
      generally get at least one error or warning, and this class is no
      exception. Luckily, this class generates only one error:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex30a" id="pch5ex30" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack.java:8:
      generic array creation<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements =<span class="Apple-converted-space">&nbsp;</span><strong>new
        E[DEFAULT_INITIAL_CAPACITY]</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      explained in<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a>, you can’t create an array of
      a non-reifiable type, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>. This problem
      arises every time you write a generic type that is backed by an array.
      There are two reasonable ways to solve it. The first solution directly
      circumvents the prohibition on generic array creation: create an array of<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code><span
        class="Apple-converted-space">&nbsp;</span>and cast<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_132"></span>it to the generic array type.
      Now in place of an error, the compiler will emit a warning. This usage is
      legal, but it’s not (in general) typesafe:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex31a" id="pch5ex31" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack.java:8:
      warning: [unchecked] unchecked cast<br>
      found: Object[], required: E[]<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elements =<span class="Apple-converted-space">&nbsp;</span><strong>(E[])
        new Object[DEFAULT_INITIAL_CAPACITY]</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      compiler may not be able to prove that your program is typesafe, but you
      can. You must convince yourself that the unchecked cast will not
      compromise the type safety of the program. The array in question (<code style="font-family: 'Courier New', monospace;">elements</code>)
      is stored in a private field and never returned to the client or passed to
      any other method. The only elements stored in the array are those passed
      to the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">push</code><span
        class="Apple-converted-space">&nbsp;</span>method, which are of type<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code>,
      so the unchecked cast can do no harm.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Once
      you’ve proved that an unchecked cast is safe, suppress the warning in as
      narrow a scope as possible (<a href="ch5.xhtml#lev27" style="text-decoration: none;">Item
        27</a>). In this case, the constructor contains only the unchecked array
      creation, so it’s appropriate to suppress the warning in the entire
      constructor. With the addition of an annotation to do this,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>compiles
      cleanly, and you can use it without explicit casts or fear of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex32a" id="pch5ex32" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        The elements array will contain only E instances from push(E).</strong><br>
      <strong>// This is sufficient to ensure type safety, but the runtime</strong><br>
      <strong>// type of the array won't be E[]; it will always be Object[]!</strong><br>
      <strong>@SuppressWarnings("unchecked")</strong><br>
      public Stack() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;elements = (E[]) new
      Object[DEFAULT_INITIAL_CAPACITY];<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      second way to eliminate the generic array creation error in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>is
      to change the type of the field<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">elements</code><span class="Apple-converted-space">&nbsp;</span>from<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E[]</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object[]</code>. If you
      do this, you’ll get a different error:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex33a" id="pch5ex33" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack.java:19:
      incompatible types<br>
      found: Object, required: E<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>E result =
        elements[--size];</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">You
      can change this error into a warning by casting the element retrieved from
      the array to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code>,
      but you will get a warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex34a" id="pch5ex34" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack.java:19:
      warning: [unchecked] unchecked cast<br>
      found: Object, required: E<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;E result =<span class="Apple-converted-space">&nbsp;</span><strong>(E)</strong><span
        class="Apple-converted-space">&nbsp;</span>elements[--size];<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_133"></span>Because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>is
      a non-reifiable type, there’s no way the compiler can check the cast at
      runtime. Again, you can easily prove to yourself that the unchecked cast
      is safe, so it’s appropriate to suppress the warning. In line with the
      advice of<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev27"
        style="text-decoration: none;">Item 27</a>, we suppress the warning only
      on the assignment that contains the unchecked cast, not on the entire<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pop</code><span
        class="Apple-converted-space">&nbsp;</span>method:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex35a" id="pch5ex35" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Appropriate suppression of unchecked warning</strong><br>
      public E pop() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (size == 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      EmptyStackException();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>// push requires elements to be of type E,
        so cast is correct</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>@SuppressWarnings("unchecked")</strong><span
        class="Apple-converted-space">&nbsp;</span>E result =<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(E) elements[--size];<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;elements[size] = null; // Eliminate obsolete
      reference<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Both
      techniques for eliminating the generic array creation have their
      adherents. The first is more readable: the array is declared to be of type<code
        style="font-family: 'Courier New', monospace;">E[]</code>, clearly
      indicating that it contains only<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>instances.
      It is also more concise: in a typical generic class, you read from the
      array at many points in the code; the first technique requires only a
      single cast (where the array is created), while the second requires a
      separate cast each time an array element is read. Thus, the first
      technique is preferable and more commonly used in practice. It does,
      however, cause<span class="Apple-converted-space">&nbsp;</span><em>heap
        pollution</em><span class="Apple-converted-space">&nbsp;</span>(<a href="ch5.xhtml#lev32"
        style="text-decoration: none;">Item 32</a>): the runtime type of the
      array does not match its compile-time type (unless<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>happens
      to be<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object</code>).
      This makes some programmers sufficiently queasy that they opt for the
      second technique, though the heap pollution is harmless in this situation.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      following program demonstrates the use of our generic<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>class.
      The program prints its command line arguments in reverse order and
      converted to uppercase. No explicit cast is necessary to invoke<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toUpperCase</code><span class="Apple-converted-space">&nbsp;</span>method
      on the elements popped from the stack, and the automatically generated
      cast is guaranteed to succeed:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex36a" id="pch5ex36" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Little program to exercise our generic Stack</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Stack&lt;String&gt; stack = new Stack&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (String arg : args)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stack.push(arg);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;while (!stack.isEmpty())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<strong>stack.pop().toUpperCase()</strong>);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_134"></span>The foregoing example may
      appear to contradict<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a>, which encourages the use of
      lists in preference to arrays. It is not always possible or desirable to
      use lists inside your generic types. Java doesn’t support lists natively,
      so some generic types, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ArrayList</code>,<span class="Apple-converted-space">&nbsp;</span><em>must</em><span
        class="Apple-converted-space">&nbsp;</span>be implemented atop arrays.
      Other generic types, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashMap</code>, are
      implemented atop arrays for performance.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      great majority of generic types are like our<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>example
      in that their type parameters have no restrictions: you can create a<code
        style="font-family: 'Courier New', monospace;">Stack&lt;Object&gt;</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack&lt;int[]&gt;</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack&lt;List&lt;String&gt;&gt;</code>,
      or<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>of any other object reference
      type. Note that you can’t create a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>of
      a primitive type: trying to create a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack&lt;int&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack&lt;double&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>will result in a compile-time
      error. This is a fundamental limitation of Java’s generic type system. You
      can work around this restriction by using boxed primitive types (<a href="ch9.xhtml#lev61"
        style="text-decoration: none;">Item 61</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are some generic types that restrict the permissible values of their type
      parameters. For example, consider<code style="font-family: 'Courier New', monospace;">java.util.concurrent.DelayQueue</code>,
      whose declaration looks like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex37a" id="pch5ex37" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">class
      DelayQueue<strong>&lt;E extends Delayed&gt;</strong><span class="Apple-converted-space">&nbsp;</span>implements
      BlockingQueue&lt;E&gt;</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      type parameter list (<code style="font-family: 'Courier New', monospace;">&lt;E
        extends Delayed&gt;</code>) requires that the actual type parameter<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>be a subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.concurrent.Delayed</code>.
      This allows the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">DelayQueue</code><span
        class="Apple-converted-space">&nbsp;</span>implementation and its
      clients to take advantage of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Delayed</code><span class="Apple-converted-space">&nbsp;</span>methods
      on the elements of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">DelayQueue</code>,
      without the need for explicit casting or the risk of a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>.
      The type parameter<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>is known as a<span class="Apple-converted-space">&nbsp;</span><em>bounded
        type parameter</em>. Note that the subtype relation is defined so that
      every type is a subtype of itself [JLS, 4.10], so it is legal to create a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">DelayQueue&lt;Delayed&gt;</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, generic types are safer and easier to use than types that require
      casts in client code. When you design new types, make sure that they can
      be used without such casts. This will often mean making the types generic.
      If you have any existing types that should be generic but aren’t, generify
      them. This will make life easier for new users of these types without
      breaking existing clients (<a href="ch5.xhtml#lev26" style="text-decoration: none;">Item
        26</a>).</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev30" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_135"></span><strong>Item 30: Favor generic methods</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Just
      as classes can be generic, so can methods. Static utility methods that
      operate on parameterized types are usually generic. All of the “algorithm”
      methods in<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collections</code><span
        class="Apple-converted-space">&nbsp;</span>(such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">binarySearch</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">sort</code>) are generic.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Writing
      generic methods is similar to writing generic types. Consider this
      deficient method, which returns the union of two sets:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex38a" id="pch5ex38" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Uses raw types - unacceptable! (<a href="ch5.xhtml#lev26" style="text-decoration: none;">Item
          26</a>)</strong><br>
      public static Set union(Set s1, Set s2) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set result = new HashSet(s1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;result.addAll(s2);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method compiles but with two warnings:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex39a" id="pch5ex39" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Union.java:5:
      warning: [unchecked] unchecked call to<br>
      HashSet(Collection&lt;? extends E&gt;) as a member of raw type HashSet<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set result = new
      HashSet(s1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      Union.java:6: warning: [unchecked] unchecked call to<br>
      addAll(Collection&lt;? extends E&gt;) as a member of raw type Set<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.addAll(s2);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      fix these warnings and make the method typesafe, modify its declaration to
      declare a<span class="Apple-converted-space">&nbsp;</span><em>type
        parameter</em><span class="Apple-converted-space">&nbsp;</span>representing
      the element type for the three sets (the two arguments and the return
      value) and use this type parameter throughout the method.<span class="Apple-converted-space">&nbsp;</span><strong>The
        type parameter list, which declares the type parameters, goes between a
        method’s modifiers and its return type.</strong><span class="Apple-converted-space">&nbsp;</span>In
      this example, the type parameter list is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">&lt;E&gt;</code>, and the
      return type is<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set&lt;E&gt;</code>.
      The naming conventions for type parameters are the same for generic
      methods and generic types (<a href="ch5.xhtml#lev29" style="text-decoration: none;">Items
        29</a>,<span class="Apple-converted-space">&nbsp;</span><a href="ch9.xhtml#lev68"
        style="text-decoration: none;">68</a>):</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex40a" id="pch5ex40" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Generic method</strong><br>
      public static<span class="Apple-converted-space">&nbsp;</span><strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>Set<strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>union(Set<strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>s1, Set<strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>s2) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set<strong>&lt;E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>result
      = new HashSet<strong>&lt;&gt;</strong>(s1);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;result.addAll(s2);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">At
      least for simple generic methods, that’s all there is to it. This method
      compiles without generating any warnings and provides type safety as well
      as ease of<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_136"></span>use. Here’s a simple program to exercise the
      method. This program contains no casts and compiles without errors or
      warnings:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex41a" id="pch5ex41" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Simple program to exercise generic method</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt; guys = Set.of("Tom", "Dick",
      "Harry");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt; stooges = Set.of("Larry", "Moe",
      "Curly");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Set&lt;String&gt; aflCio = union(guys, stooges);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;System.out.println(aflCio);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      you run the program, it prints<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">[Moe, Tom, Harry, Larry,
        Curly, Dick]</code>. (The order of the elements in the output is
      implementation-dependent.)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A
      limitation of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">union</code><span
        class="Apple-converted-space">&nbsp;</span>method is that the types of
      all three sets (both input parameters and the return value) have to be
      exactly the same. You can make the method more flexible by using<span class="Apple-converted-space">&nbsp;</span><em>bounded
        wildcard types</em><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch5.xhtml#lev31" style="text-decoration: none;">Item 31</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">On
      occasion, you will need to create an object that is immutable but
      applicable to many different types. Because generics are implemented by
      erasure (<a href="ch5.xhtml#lev28" style="text-decoration: none;">Item 28</a>),
      you can use a single object for all required type parameterizations, but
      you need to write a static factory method to repeatedly dole out the
      object for each requested type parameterization. This pattern, called the<span
        class="Apple-converted-space">&nbsp;</span><em>generic singleton factory</em>,
      is used for function objects (<a href="ch7.xhtml#lev42" style="text-decoration: none;">Item
        42</a>) such as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collections.reverseOrder</code>,
      and occasionally for collections such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collections.emptySet</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      that you want to write an identity function dispenser. The libraries
      provide<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Function.identity</code>,
      so there’s no reason to write your own (<a href="ch9.xhtml#lev59" style="text-decoration: none;">Item
        59</a>), but it is instructive. It would be wasteful to create a new
      identity function object time one is requested, because it’s stateless. If
      Java’s generics were reified, you would need one identity function per
      type, but since they’re erased a generic singleton will suffice. Here’s
      how it looks:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex42a" id="pch5ex42" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Generic singleton factory pattern</strong><br>
      private static UnaryOperator&lt;Object&gt; IDENTITY_FN = (t) -&gt; t;<br>
      <br>
      <strong>@SuppressWarnings("unchecked")</strong><br>
      public static &lt;T&gt; UnaryOperator&lt;T&gt; identityFunction() {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return<span class="Apple-converted-space">&nbsp;</span><strong>(UnaryOperator&lt;T&gt;)</strong><span
        class="Apple-converted-space">&nbsp;</span>IDENTITY_FN;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      cast of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">IDENTITY_FN</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">(UnaryFunction&lt;T&gt;)</code><span
        class="Apple-converted-space">&nbsp;</span>generates an unchecked cast
      warning, as<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">UnaryOperator&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is not a<code style="font-family: 'Courier New', monospace;">UnaryOperator&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>for every<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>. But the
      identity function is special: it returns its argument unmodified, so we
      know that it is typesafe to use it as a<code style="font-family: 'Courier New', monospace;">UnaryFunction&lt;T&gt;</code>,
      whatever the value of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>.<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_137"></span>Therefore, we can confidently
      suppress the unchecked cast warning generated by this cast. Once we’ve
      done this, the code compiles without error or warning.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a sample program that uses our generic singleton as a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">UnaryOperator&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">UnaryOperator&lt;Number&gt;</code>.
      As usual, it contains no casts and compiles without errors or warnings:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex43a" id="pch5ex43" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Sample program to exercise generic singleton</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;String[] strings = { "jute", "hemp", "nylon" };<br>
      &nbsp;&nbsp;&nbsp;&nbsp;UnaryOperator&lt;String&gt; sameString =
      identityFunction();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (String s : strings)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(sameString.apply(s));<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;Number[] numbers = { 1, 2.0, 3L };<br>
      &nbsp;&nbsp;&nbsp;&nbsp;UnaryOperator&lt;Number&gt; sameNumber =
      identityFunction();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (Number n : numbers)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(sameNumber.apply(n));<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is permissible, though relatively rare, for a type parameter to be bounded
      by some expression involving that type parameter itself. This is what’s
      known as a<span class="Apple-converted-space">&nbsp;</span><em>recursive
        type bound</em>. A common use of recursive type bounds is in connection
      with the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable</code><span
        class="Apple-converted-space">&nbsp;</span>interface, which defines a
      type’s natural ordering (<a href="ch3.xhtml#lev14" style="text-decoration: none;">Item
        14</a>). This interface is shown here:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex44a" id="pch5ex44" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      interface Comparable&lt;T&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int compareTo(T o);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      type parameter<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code><span
        class="Apple-converted-space">&nbsp;</span>defines the type to which
      elements of the type implementing<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>can be compared. In practice,
      nearly all types can be compared only to elements of their own type. So,
      for example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code><span
        class="Apple-converted-space">&nbsp;</span>implements<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable&lt;String&gt;</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code><span
        class="Apple-converted-space">&nbsp;</span>implements<code style="font-family: 'Courier New', monospace;">Comparable&lt;Integer&gt;</code>,
      and so on.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Many
      methods take a collection of elements implementing<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code><span class="Apple-converted-space">&nbsp;</span>to
      sort it, search within it, calculate its minimum or maximum, and the like.
      To do these things, it is required that every element in the collection be
      comparable to every other element in it, in other words, that the elements
      of the list be<span class="Apple-converted-space">&nbsp;</span><em>mutually
        comparable</em>. Here is how to express that constraint:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex45a" id="pch5ex45" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Using a recursive type bound to express mutual comparability</strong><br>
      public static<span class="Apple-converted-space">&nbsp;</span><strong>&lt;E
        extends Comparable&lt;E&gt;&gt;</strong><span class="Apple-converted-space">&nbsp;</span>E
      max(Collection&lt;E&gt; c);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_138"></span>The type bound<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">&lt;E extends
        Comparable&lt;E&gt;&gt;</code><span class="Apple-converted-space">&nbsp;</span>may
      be read as “any type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>that
      can be compared to itself,” which corresponds more or less precisely to
      the notion of mutual comparability.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a method to go with the previous declaration. It calculates the maximum
      value in a collection according to its elements’ natural order, and it
      compiles without errors or warnings:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex46a" id="pch5ex46" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Returns max value in a collection - uses recursive type bound</strong><br>
      public static &lt;E extends Comparable&lt;E&gt;&gt; E
      max(Collection&lt;E&gt; c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;if (c.isEmpty())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      IllegalArgumentException("Empty collection");<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;E result = null;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (E e : c)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (result == null ||
      e.compareTo(result) &gt; 0)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result
      = Objects.requireNonNull(e);<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that this method throws<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">IllegalArgumentException</code><span
        class="Apple-converted-space">&nbsp;</span>if the list is empty. A
      better alternative would be to return an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Optional&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>(<a href="ch8.xhtml#lev55" style="text-decoration: none;">Item
        55</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Recursive
      type bounds can get much more complex, but luckily they rarely do. If you
      understand this idiom, its wildcard variant (<a href="ch5.xhtml#lev31" style="text-decoration: none;">Item
        31</a>), and the<span class="Apple-converted-space">&nbsp;</span><em>simulated
        self-type</em><span class="Apple-converted-space">&nbsp;</span>idiom (<a
        href="ch2.xhtml#lev2" style="text-decoration: none;">Item 2</a>), you’ll
      be able to deal with most of the recursive type bounds you encounter in
      practice.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, generic methods, like generic types, are safer and easier to use
      than methods requiring their clients to put explicit casts on input
      parameters and return values. Like types, you should make sure that your
      methods can be used without casts, which often means making them generic.
      And like types, you should generify existing methods whose use requires
      casts. This makes life easier for new users without breaking existing
      clients (<a href="ch5.xhtml#lev26" style="text-decoration: none;">Item 26</a>).</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev31" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_139"></span><strong>Item 31: Use bounded wildcards to increase
        API flexibility</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      noted in<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a>, parameterized types are<span
        class="Apple-converted-space">&nbsp;</span><em>invariant</em>. In other
      words, for any two distinct types<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Type1</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Type2</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Type1&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is neither a subtype nor a
      supertype of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Type2&gt;</code>.
      Although it is counterintuitive that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is not a subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>,
      it really does make sense. You can put any object into a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code>,
      but you can put only strings into a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>.
      Since a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>can’t do everything a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>can, it isn’t a subtype (by
      the Liskov substitution principal,<span class="Apple-converted-space">&nbsp;</span><a
        href="ch3.xhtml#lev10" style="text-decoration: none;">Item 10</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Sometimes
      you need more flexibility than invariant typing can provide. Consider the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>class from<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev29" style="text-decoration: none;">Item 29</a>. To
      refresh your memory, here is its public API:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex47a" id="pch5ex47" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Stack&lt;E&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public Stack();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public void push(E e);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public E pop();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public boolean isEmpty();<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      we want to add a method that takes a sequence of elements and pushes them
      all onto the stack. Here’s a first attempt:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex48a" id="pch5ex48" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        pushAll method without wildcard type - deficient!</strong><br>
      public void pushAll(Iterable&lt;E&gt; src) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (E e : src)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(e);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method compiles cleanly, but it isn’t entirely satisfactory. If the
      element type of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Iterable src</code><span
        class="Apple-converted-space">&nbsp;</span>exactly matches that of the
      stack, it works fine. But suppose you have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack&lt;Number&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and you invoke<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">push(intVal)</code>,
      where<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">intVal</code><span
        class="Apple-converted-space">&nbsp;</span>is of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code>. This
      works because<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer</code><span
        class="Apple-converted-space">&nbsp;</span>is a subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Number</code>. So
      logically, it seems that this should work, too:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex49a" id="pch5ex49" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack&lt;Number&gt;
      numberStack = new Stack&lt;&gt;();<br>
      Iterable&lt;Integer&gt; integers = ... ;<br>
      numberStack.pushAll(integers);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you try it, however, you’ll get this error message because parameterized
      types are invariant:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex50a" id="pch5ex50" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">StackTest.java:7:
      error: incompatible types: Iterable&lt;Integer&gt;<br>
      cannot be converted to Iterable&lt;Number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numberStack.pushAll(integers);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_140"></span>Luckily, there’s a way out.
      The language provides a special kind of parameterized type call a<span class="Apple-converted-space">&nbsp;</span><em>bounded
        wildcard type</em><span class="Apple-converted-space">&nbsp;</span>to
      deal with situations like this. The type of the input parameter to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pushAll</code><span class="Apple-converted-space">&nbsp;</span>should
      not be “<code style="font-family: 'Courier New', monospace;">Iterable</code><span
        class="Apple-converted-space">&nbsp;</span>of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>” but “<code style="font-family: 'Courier New', monospace;">Iterable</code><span
        class="Apple-converted-space">&nbsp;</span>of some subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>,” and there is a
      wildcard type that means precisely that:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Iterable&lt;? extends
        E&gt;</code>. (The use of the keyword<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">extends</code><span class="Apple-converted-space">&nbsp;</span>is
      slightly misleading: recall from<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev29" style="text-decoration: none;">Item 29</a><span class="Apple-converted-space">&nbsp;</span>that<em>subtype</em><span
        class="Apple-converted-space">&nbsp;</span>is defined so that every type
      is a subtype of itself, even though it does not extend itself.) Let’s
      modify<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pushAll</code><span
        class="Apple-converted-space">&nbsp;</span>to use this type:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex51a" id="pch5ex51" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Wildcard type for a parameter that serves as an E producer</strong><br>
      public void pushAll(<strong>Iterable&lt;? extends E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>src)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (E e : src)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push(e);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">With
      this change, not only does<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>compile
      cleanly, but so does the client code that wouldn’t compile with the
      original<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pushAll</code><span
        class="Apple-converted-space">&nbsp;</span>declaration. Because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code><span class="Apple-converted-space">&nbsp;</span>and
      its client compile cleanly, you know that everything is typesafe.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      suppose you want to write a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code><span class="Apple-converted-space">&nbsp;</span>method
      to go with<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pushAll</code>.
      The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">popAll</code><span
        class="Apple-converted-space">&nbsp;</span>method pops each element off
      the stack and adds the elements to the given collection. Here’s how a
      first attempt at writing the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code><span class="Apple-converted-space">&nbsp;</span>method
      might look:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex52a" id="pch5ex52" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        popAll method without wildcard type - deficient!</strong><br>
      public void popAll(Collection&lt;E&gt; dst) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;while (!isEmpty())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst.add(pop());<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Again,
      this compiles cleanly and works fine if the element type of the
      destination collection exactly matches that of the stack. But again, it
      isn’t entirely satisfactory. Suppose you have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack&lt;Number&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and variable of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>. If you pop
      an element from the stack and store it in the variable, it compiles and
      runs without error. So shouldn’t you be able to do this, too?</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex53a" id="pch5ex53" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Stack&lt;Number&gt;
      numberStack = new Stack&lt;Number&gt;();<br>
      Collection&lt;Object&gt; objects = ... ;<br>
      numberStack.popAll(objects);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">If
      you try to compile this client code against the version of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code><span class="Apple-converted-space">&nbsp;</span>shown
      earlier, you’ll get an error very similar to the one that we got with our
      first version of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pushAll</code>:<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collection&lt;Object&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is not a subtype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection&lt;Number&gt;</code>.
      Once again, wildcard types provide a way out. The type of the input
      parameter to<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
        id="page_141"></span><code style="font-family: 'Courier New', monospace;">popAll</code><span
        class="Apple-converted-space">&nbsp;</span>should not be “collection of<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code>”
      but “collection of some supertype of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>” (where
      supertype is defined such that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>is
      a supertype of itself [JLS, 4.10]). Again, there is a wildcard type that
      means precisely that:<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection&lt;? super
        E&gt;</code>. Let’s modify<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code><span class="Apple-converted-space">&nbsp;</span>to
      use it:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex54a" id="pch5ex54" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Wildcard type for parameter that serves as an E consumer</strong><br>
      public void popAll(<strong>Collection&lt;? super E&gt;</strong><span class="Apple-converted-space">&nbsp;</span>dst)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;while (!isEmpty())<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dst.add(pop());<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">With
      this change, both<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>and the client code compile
      cleanly.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      lesson is clear.<span class="Apple-converted-space">&nbsp;</span><strong>For
        maximum flexibility, use wildcard types on input parameters that
        represent producers or consumers.</strong><span class="Apple-converted-space">&nbsp;</span>If
      an input parameter is both a producer and a consumer, then wildcard types
      will do you no good: you need an exact type match, which is what you get
      without any wildcards.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a mnemonic to help you remember which wildcard type to use:</p>
    <p class="center" style="margin-top: 7.5px; margin-bottom: 7.5px; text-align: center; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>PECS
        stands for producer-</strong><code style="font-family: 'Courier New', monospace;"><strong>extends</strong></code><strong>,
        consumer-</strong><code style="font-family: 'Courier New', monospace;"><strong>super</strong></code><strong>.</strong></p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      other words, if a parameterized type represents a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>producer,
      use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">&lt;?
        extends T&gt;</code>; if it represents a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>consumer,
      use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">&lt;?
        super T&gt;</code>. In our<code style="font-family: 'Courier New', monospace;">Stack</code><span
        class="Apple-converted-space">&nbsp;</span>example,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pushAll</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">src</code><span class="Apple-converted-space">&nbsp;</span>parameter
      produces<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>instances for use by the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Stack</code>,
      so the appropriate type for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">src</code><span class="Apple-converted-space">&nbsp;</span>is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Iterable&lt;?
        extends E&gt;</code>;<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">popAll</code>’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">dst</code><span class="Apple-converted-space">&nbsp;</span>parameter
      consumes<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>instances from the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Stack</code>, so the
      appropriate type for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">dst</code><span class="Apple-converted-space">&nbsp;</span>is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collection&lt;?
        super E&gt;</code>. The PECS mnemonic captures the fundamental principle
      that guides the use of wild-card types. Naftalin and Wadler call it the<span
        class="Apple-converted-space">&nbsp;</span><em>Get and Put Principle</em>[Naftalin07,
      2.4].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">With
      this mnemonic in mind, let’s take a look at some method and constructor
      declarations from previous items in this chapter. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Chooser</code>constructor
      in<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a><span class="Apple-converted-space">&nbsp;</span>has
      this declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex55a" id="pch5ex55" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      Chooser(Collection&lt;T&gt; choices)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      constructor uses the collection<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">choices</code><span class="Apple-converted-space">&nbsp;</span>only
      to<span class="Apple-converted-space">&nbsp;</span><strong>produce</strong><span
        class="Apple-converted-space">&nbsp;</span>values of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>(and
      stores them for later use), so its declaration should use a wildcard type
      that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>extends</strong><span
          class="Apple-converted-space">&nbsp;</span>T</code>. Here’s the
      resulting constructor declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex56a" id="pch5ex56" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Wildcard type for parameter that serves as an T producer</strong><br>
      public Chooser(Collection&lt;<strong>? extends T</strong>&gt; choices)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">And
      would this change make any difference in practice? Yes, it would. Suppose
      you have a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code>,
      and you want to pass it in to the constructor<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_142"></span>for a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Chooser&lt;Number&gt;</code>.
      This would not compile with the original declaration, but it does once you
      add the bounded wildcard type to the declaration.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      let’s look at the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">union</code><span
        class="Apple-converted-space">&nbsp;</span>method from<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev30" style="text-decoration: none;">Item 30</a>. Here
      is the declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex57a" id="pch5ex57" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static &lt;E&gt; Set&lt;E&gt; union(Set&lt;E&gt; s1, Set&lt;E&gt; s2)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Both
      parameters,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">s1</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">s2</code>, are<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code><span class="Apple-converted-space">&nbsp;</span>producers,
      so the PECS mnemonic tells us that the declaration should be as follows:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex58a" id="pch5ex58" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static &lt;E&gt; Set&lt;E&gt; union(Set&lt;? extends E&gt; s1,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;?
      extends E&gt; s2)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that the return type is still<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;E&gt;</code>.<span
        class="Apple-converted-space">&nbsp;</span><strong>Do not use bounded
        wildcard types as return types.</strong><span class="Apple-converted-space">&nbsp;</span>Rather
      than providing additional flexibility for your users, it would force them
      to use wildcard types in client code. With the revised declaration, this
      code will compile cleanly:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex59a" id="pch5ex59" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Set&lt;Integer&gt;&nbsp;&nbsp;integers
      =&nbsp;&nbsp;Set.of(1, 3, 5);<br>
      Set&lt;Double&gt;&nbsp;&nbsp; doubles&nbsp;&nbsp;=&nbsp;&nbsp;Set.of(2.0,
      4.0, 6.0);<br>
      Set&lt;Number&gt;&nbsp;&nbsp;
      numbers&nbsp;&nbsp;=&nbsp;&nbsp;union(integers, doubles);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Properly
      used, wildcard types are nearly invisible to the users of a class. They
      cause methods to accept the parameters they should accept and reject those
      they should reject.<span class="Apple-converted-space">&nbsp;</span><strong>If
        the user of a class has to think about wildcard types, there is probably
        something wrong with its API.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Prior
      to Java 8, the type inference rules were not clever enough to handle the
      previous code fragment, which requires the compiler to use the
      contextually specified return type (or<span class="Apple-converted-space">&nbsp;</span><em>target
        type</em>) to infer the type of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">E</code>. The target type
      of the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">union</code><span
        class="Apple-converted-space">&nbsp;</span>invocation shown earlier is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Set&lt;Number&gt;</code>.
      If you try to compile the fragment in an earlier version of Java (with an
      appropriate replacement for the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set.of</code><span class="Apple-converted-space">&nbsp;</span>factory),
      you’ll get a long, convoluted error message like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex60a" id="pch5ex60" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Union.java:14:
      error: incompatible types<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;Number&gt; numbers
      = union(integers, doubles);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      ^<br>
      &nbsp;&nbsp;required: Set&lt;Number&gt;<br>
      &nbsp;&nbsp;found:&nbsp;&nbsp;&nbsp;&nbsp;Set&lt;INT#1&gt;<br>
      &nbsp;&nbsp;where INT#1,INT#2 are intersection types:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;INT#1 extends Number,Comparable&lt;? extends
      INT#2&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;INT#2 extends Number,Comparable&lt;?&gt;</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Luckily
      there is a way to deal with this sort of error. If the compiler doesn’t
      infer the correct type, you can always tell it what type to use with an<em>explicit
        type<span class="Apple-converted-space">&nbsp;</span><span epub:type="pagebreak"
          id="page_143"></span>argument</em><span class="Apple-converted-space">&nbsp;</span>[JLS,
      15.12]. Even prior to the introduction of target typing in Java 8, this
      isn’t something that you had to do often, which is good because explicit
      type arguments aren’t very pretty. With the addition of an explicit type
      argument, as shown here, the code fragment compiles cleanly in versions
      prior to Java 8:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex61a" id="pch5ex61" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Explicit type parameter - required prior to Java 8</strong><br>
      Set&lt;Number&gt; numbers = Union<strong>.&lt;Number&gt;</strong>union(integers,
      doubles);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Next
      let’s turn our attention to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">max</code><span class="Apple-converted-space">&nbsp;</span>method
      in<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Item 30</a>. Here is the original
      declaration:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex62a" id="pch5ex62" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static &lt;T extends Comparable&lt;T&gt;&gt; T max(List&lt;T&gt; list)</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a revised declaration that uses wildcard types:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex63a" id="pch5ex63" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static &lt;T extends<span class="Apple-converted-space">&nbsp;</span><strong>Comparable&lt;?
        super T&gt;</strong>&gt; T max(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>List&lt;? extends
        T&gt;</strong><span class="Apple-converted-space">&nbsp;</span>list)</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">To
      get the revised declaration from the original, we applied the PECS
      heuristic twice. The straightforward application is to the parameter<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">list</code>.
      It produces<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code><span
        class="Apple-converted-space">&nbsp;</span>instances, so we change the
      type from<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;? extends T&gt;</code>.
      The tricky application is to the type parameter<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>. This is the
      first time we’ve seen a wildcard applied to a type parameter. Originally,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code><span
        class="Apple-converted-space">&nbsp;</span>was specified to extend<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable&lt;T&gt;</code>,
      but a comparable of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>consumes<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>instances
      (and produces integers indicating order relations). Therefore, the
      parameterized type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>is replaced by the bounded
      wildcard type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable&lt;?
        super T&gt;</code>. Comparables are always consumers, so you should
      generally<span class="Apple-converted-space">&nbsp;</span><strong>use</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>Comparable&lt;?
          super T&gt;</strong></code><span class="Apple-converted-space">&nbsp;</span><strong>in
        preference to</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>Comparable&lt;T&gt;</strong></code><strong>.</strong><span
        class="Apple-converted-space">&nbsp;</span>The same is true of
      comparators; therefore, you should generally<span class="Apple-converted-space">&nbsp;</span><strong>use</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>Comparator&lt;?
          super T&gt;</strong></code><span class="Apple-converted-space">&nbsp;</span><strong>in
        preference to</strong><span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;"><strong>Comparator&lt;T&gt;</strong></code><strong>.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      revised<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">max</code><span
        class="Apple-converted-space">&nbsp;</span>declaration is probably the
      most complex method declaration in this book. Does the added complexity
      really buy you anything? Again, it does. Here is a simple example of a
      list that would be excluded by the original declaration but is permitted
      by the revised one:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex64a" id="pch5ex64" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">List&lt;ScheduledFuture&lt;?&gt;&gt;
      scheduledFutures = ... ;</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      reason that you can’t apply the original method declaration to this list
      is that<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ScheduledFuture</code><span
        class="Apple-converted-space">&nbsp;</span>does not implement<code style="font-family: 'Courier New', monospace;">Comparable&lt;ScheduledFuture&gt;</code>.
      Instead, it is a subinterface of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Delayed</code>, which
      extends<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparable&lt;Delayed&gt;</code>.
      In other words, a<code style="font-family: 'Courier New', monospace;">ScheduledFuture</code><span
        class="Apple-converted-space">&nbsp;</span>instance isn’t merely
      comparable to other<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_144"></span><code style="font-family: 'Courier New', monospace;">ScheduledFuture</code><span
        class="Apple-converted-space">&nbsp;</span>instances; it is comparable
      to any<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Delayed</code><span
        class="Apple-converted-space">&nbsp;</span>instance, and that’s enough
      to cause the original declaration to reject it. More generally, the
      wildcard is required to support types that do not implement<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Comparable</code>(or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Comparator</code>)
      directly but extend a type that does.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is one more wildcard-related topic that bears discussing. There is a
      duality between type parameters and wildcards, and many methods can be
      declared using one or the other. For example, here are two possible
      declarations for a static method to swap two indexed items in a list. The
      first uses an unbounded type parameter (<a href="ch5.xhtml#lev30" style="text-decoration: none;">Item
        30</a>) and the second an unbounded wildcard:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex65a" id="pch5ex65" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Two possible declarations for the swap method</strong><br>
      public static<span class="Apple-converted-space">&nbsp;</span><strong>&lt;E&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>void swap(<strong>List&lt;E&gt;
        list</strong>, int i, int j);<br>
      public static void swap(<strong>List&lt;?&gt; list</strong>, int i, int
      j);</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Which
      of these two declarations is preferable, and why? In a public API, the
      second is better because it’s simpler. You pass in a list—any list—and the
      method swaps the indexed elements. There is no type parameter to worry
      about. As a rule,<span class="Apple-converted-space">&nbsp;</span><strong>if
        a type parameter appears only once in a method declaration, replace it
        with a wildcard.</strong><span class="Apple-converted-space">&nbsp;</span>If
      it’s an unbounded type parameter, replace it with an unbounded wildcard;
      if it’s a bounded type parameter, replace it with a bounded wildcard.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There’s
      one problem with the second declaration for<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">swap</code>. The
      straightforward implementation won’t compile:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex66a" id="pch5ex66" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static void swap(List&lt;?&gt; list, int i, int j) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;list.set(i, list.set(j, list.get(i)));<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Trying
      to compile it produces this less-than-helpful error message:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex67a" id="pch5ex67" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Swap.java:5:
      error: incompatible types: Object cannot be<br>
      converted to CAP#1<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.set(i, list.set(j,
      list.get(i)));<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^<br>
      &nbsp;&nbsp;where CAP#1 is a fresh type-variable:<br>
      &nbsp;&nbsp;&nbsp;&nbsp;CAP#1 extends Object from capture of ?</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      doesn’t seem right that we can’t put an element back into the list that we
      just took it out of. The problem is that the type of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">list</code><span class="Apple-converted-space">&nbsp;</span>is<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;?&gt;</code>,
      and you can’t put any value except<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code><span class="Apple-converted-space">&nbsp;</span>into
      a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;?&gt;</code>.
      Fortunately, there is a way to implement this method without resorting to
      an unsafe cast or a raw type. The idea is to write a<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_145"></span>private helper method to<span
        class="Apple-converted-space">&nbsp;</span><em>capture</em><span class="Apple-converted-space">&nbsp;</span>the
      wildcard type. The helper method must be a generic method in order to
      capture the type. Here’s how it looks:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex68a" id="pch5ex68" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static void swap(List&lt;?&gt; list, int i, int j) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;swapHelper(list, i, j);<br>
      }<br>
      <br>
      <strong>// Private helper method for wildcard capture</strong><br>
      private static &lt;E&gt; void swapHelper(List&lt;E&gt; list, int i, int j)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;list.set(i, list.set(j, list.get(i)));<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">swapHelper</code><span
        class="Apple-converted-space">&nbsp;</span>method knows that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">list</code><span class="Apple-converted-space">&nbsp;</span>is
      a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;E&gt;</code>.
      Therefore, it knows that any value it gets out of this list is of type<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>and that it’s safe to put any
      value of type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">E</code><span
        class="Apple-converted-space">&nbsp;</span>into the list. This slightly
      convoluted implementation of<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">swap</code><span class="Apple-converted-space">&nbsp;</span>compiles
      cleanly. It allows us to export the nice wildcard-based declaration, while
      taking advantage of the more complex generic method internally. Clients of
      the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">swap</code><span
        class="Apple-converted-space">&nbsp;</span>method don’t have to confront
      the more complex<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">swapHelper</code><span
        class="Apple-converted-space">&nbsp;</span>declaration, but they do
      benefit from it. It is worth noting that the helper method has precisely
      the signature that we dismissed as too complex for the public method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, using wildcard types in your APIs, while tricky, makes the APIs
      far more flexible. If you write a library that will be widely used, the
      proper use of wildcard types should be considered mandatory. Remember the
      basic rule: producer-<code style="font-family: 'Courier New', monospace;">extends</code>,
      consumer-<code style="font-family: 'Courier New', monospace;">super</code><span
        class="Apple-converted-space">&nbsp;</span>(PECS). Also remember that
      all comparables and comparators are consumers.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev32" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_146"></span><strong>Item 32: Combine generics and varargs
        judiciously</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Varargs
      methods (<a href="ch8.xhtml#lev53" style="text-decoration: none;">Item 53</a>)
      and generics were both added to the platform in Java 5, so you might
      expect them to interact gracefully; sadly, they do not. The purpose of
      varargs is to allow clients to pass a variable number of arguments to a
      method, but it is a<span class="Apple-converted-space">&nbsp;</span><em>leaky
        abstraction</em>: when you invoke a varargs method, an array is created
      to hold the varargs parameters; that array, which should be an
      implementation detail, is visible. As a consequence, you get confusing
      compiler warnings when varargs parameters have generic or parameterized
      types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Recall
      from<span class="Apple-converted-space">&nbsp;</span><a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a><span class="Apple-converted-space">&nbsp;</span>that
      a non-reifiable type is one whose runtime representation has less
      information than its compile-time representation, and that nearly all
      generic and parameterized types are non-reifiable. If a method declares
      its varargs parameter to be of a non-reifiable type, the compiler
      generates a warning on the declaration. If the method is invoked on
      varargs parameters whose inferred type is non-reifiable, the compiler
      generates a warning on the invocation too. The warnings look something
      like this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex69a" id="pch5ex69" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">warning:
      [unchecked] Possible heap pollution from<br>
      &nbsp;&nbsp;&nbsp;&nbsp;parameterized vararg type List&lt;String&gt;</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><em>Heap
        pollution</em><span class="Apple-converted-space">&nbsp;</span>occurs
      when a variable of a parameterized type refers to an object that is not of
      that type [JLS, 4.12.2]. It can cause the compiler’s automatically
      generated casts to fail, violating the fundamental guarantee of the
      generic type system.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">For
      example, consider this method, which is a thinly disguised variant of the
      code fragment on page 127:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex70a" id="pch5ex70" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Mixing generics and varargs can violate type safety!</strong><br>
      static void dangerous(<strong>List&lt;String&gt;... stringLists</strong>)
      {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;List&lt;Integer&gt; intList = List.of(42);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Object[] objects = stringLists;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;objects[0] =
intList;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>//
        Heap pollution</strong><br>
      &nbsp;&nbsp;&nbsp;&nbsp;String s = stringLists[0].get(0);<span class="Apple-converted-space">&nbsp;</span><strong>//
        ClassCastException</strong><br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method has no visible casts yet throws a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>when invoked with one or more
      arguments. Its last line has an invisible cast that is generated by the
      compiler. This cast fails, demonstrating that type safety has been
      compromised, and<span class="Apple-converted-space">&nbsp;</span><strong>it
        is unsafe to store a value in a generic varargs array parameter.</strong></p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      example raises an interesting question: Why is it even legal to declare a
      method with a generic varargs parameter, when it is illegal to create a
      generic array explicitly? In other words, why does the method shown
      previously generate only a warning, while the code fragment on page 127
      generates an error? The<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_147"></span>answer is that methods with
      varargs parameters of generic or parameterized types can be very useful in
      practice, so the language designers opted to live with this inconsistency.
      In fact, the Java libraries export several such methods, including<code style="font-family: 'Courier New', monospace;">Arrays.asList(T...
        a)</code>,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Collections.addAll(Collection&lt;?
        super T&gt; c, T... elements)</code>, and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">EnumSet.of(E first, E...
        rest)</code>. Unlike the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">dangerous</code><span class="Apple-converted-space">&nbsp;</span>method
      shown earlier, these library methods are typesafe.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Prior
      to Java 7, there was nothing the author of a method with a generic varargs
      parameter could do about the warnings at the call sites. This made these
      APIs unpleasant to use. Users had to put up with the warnings or,
      preferably, to eliminate them with<code style="font-family: 'Courier New', monospace;">@SuppressWarnings("unchecked")</code><span
        class="Apple-converted-space">&nbsp;</span>annotations at every call
      site (<a href="ch5.xhtml#lev27" style="text-decoration: none;">Item 27</a>).
      This was tedious, harmed readability, and hid warnings that flagged real
      issues.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      Java 7, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>annotation was added to the
      platform, to allow the author of a method with a generic varargs parameter
      to suppress client warnings automatically. In essence,<span class="Apple-converted-space">&nbsp;</span><strong>the</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>SafeVarargs</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>annotation
        constitutes a promise by the author of a method that it is typesafe.</strong><span
        class="Apple-converted-space">&nbsp;</span>In exchange for this promise,
      the compiler agrees not to warn the users of the method that calls may be
      unsafe.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is critical that you do not annotate a method with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">@SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>unless it actually<span class="Apple-converted-space">&nbsp;</span><em>is</em><span
        class="Apple-converted-space">&nbsp;</span>safe. So what does it take to
      ensure this? Recall that a generic array is created when the method is
      invoked, to hold the varargs parameters. If the method doesn’t store
      anything into the array (which would overwrite the parameters) and doesn’t
      allow a reference to the array to escape (which would enable untrusted
      code to access the array), then it’s safe. In other words, if the varargs
      parameter array is used only to transmit a variable number of arguments
      from the caller to the method—which is, after all, the purpose of
      varargs—then the method is safe.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">It
      is worth noting that you can violate type safety without ever storing
      anything in the varargs parameter array. Consider the following generic
      varargs method, which returns an array containing its parameters. At first
      glance, it may look like a handy little utility:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex71a" id="pch5ex71" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        UNSAFE - Exposes a reference to its generic parameter array!</strong><br>
      static &lt;T&gt; T[] toArray(T... args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return args;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method simply returns its varargs parameter array. The method may not look
      dangerous, but it is! The type of this array is determined by the
      compile-time types of the arguments passed in to the method, and the
      compiler may not have enough information to make an accurate
      determination. Because this method returns its varargs parameter array, it
      can propagate heap pollution up the call stack.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_148"></span>To make this concrete,
      consider the following generic method, which takes three arguments of type<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code><span
        class="Apple-converted-space">&nbsp;</span>and returns an array
      containing two of the arguments, chosen at random:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex72a" id="pch5ex72" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">static
      &lt;T&gt; T[] pickTwo(T a, T b, T c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;switch(ThreadLocalRandom.current().nextInt(3)) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 0: return toArray(a, b);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 1: return toArray(a, c);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 2: return toArray(b, c);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;throw new AssertionError(); // Can't get here<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      method is not, in and of itself, dangerous and would not generate a
      warning except that it invokes the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toArray</code><span class="Apple-converted-space">&nbsp;</span>method,
      which has a generic varargs parameter.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">When
      compiling this method, the compiler generates code to create a varargs
      parameter array in which to pass two<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code><span class="Apple-converted-space">&nbsp;</span>instances
      to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toArray</code>.
      This code allocates an array of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object[]</code>, which is
      the most specific type that is guaranteed to hold these instances, no
      matter what types of objects are passed to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pickTwo</code><span class="Apple-converted-space">&nbsp;</span>at
      the call site. The<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toArray</code><span
        class="Apple-converted-space">&nbsp;</span>method simply returns this
      array to<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">pickTwo</code>,
      which in turn returns it to its caller, so<code style="font-family: 'Courier New', monospace;">pickTwo</code><span
        class="Apple-converted-space">&nbsp;</span>will always return an array
      of type<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Object[]</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Now
      consider this main method, which exercises<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pickTwo</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex73a" id="pch5ex73" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;String[] attributes = pickTwo("Good", "Fast",
      "Cheap");<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      is nothing at all wrong with this method, so it compiles without
      generating any warnings. But when you run it, it throws a<code style="font-family: 'Courier New', monospace;">ClassCastException</code>,
      though it contains no visible casts. What you don’t see is that the
      compiler has generated a hidden cast to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String[]</code><span class="Apple-converted-space">&nbsp;</span>on
      the value returned by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">pickTwo</code><span class="Apple-converted-space">&nbsp;</span>so
      that it can be stored in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">attributes</code>. The
      cast fails, because<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object[]</code><span class="Apple-converted-space">&nbsp;</span>is
      not a subtype of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String[]</code>.
      This failure is quite disconcerting because it is two levels removed from
      the method that actually causes the heap pollution (<code style="font-family: 'Courier New', monospace;">toArray</code>),
      and the varargs parameter array is not modified after the actual
      parameters are stored in it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      example is meant to drive home the point that<span class="Apple-converted-space">&nbsp;</span><strong>it
        is unsafe to give another method access to a generic varargs parameter
        array,</strong>with two exceptions: it is safe to pass the array to
      another varargs method that is correctly annotated with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">@SafeVarargs</code>, and
      it is safe to pass the array to a non-varargs method that merely computes
      some function of the contents of the array.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_149"></span>Here is a typical example of
      a safe use of a generic varargs parameter. This method takes an arbitrary
      number of lists as arguments and returns a single list containing the
      elements of all of the input lists in sequence. Because the method is
      annotated with<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@SafeVarargs</code>,
      it doesn’t generate any warnings, on the declaration or at its call sites:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex74a" id="pch5ex74" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Safe method with a generic varargs parameter</strong><br>
      @SafeVarargs<br>
      static &lt;T&gt; List&lt;T&gt; flatten(List&lt;? extends T&gt;... lists) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;List&lt;T&gt; result = new ArrayList&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (List&lt;? extends T&gt; list : lists)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.addAll(list);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      rule for deciding when to use the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SafeVarargs</code><span class="Apple-converted-space">&nbsp;</span>annotation
      is simple:<span class="Apple-converted-space">&nbsp;</span><strong>Use</strong><span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;"><strong>@SafeVarargs</strong></code><span
        class="Apple-converted-space">&nbsp;</span><strong>on every method with
        a varargs parameter of a generic or parameterized type,</strong><span class="Apple-converted-space">&nbsp;</span>so
      its users won’t be burdened by needless and confusing compiler warnings.
      This implies that you should<em>never</em><span class="Apple-converted-space">&nbsp;</span>write
      unsafe varargs methods like<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">dangerous</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">toArray</code>.
      Every time the compiler warns you of possible heap pollution from a
      generic varargs parameter in a method you control, check that the method
      is safe. As a reminder, a generic varargs methods is safe if:</p>
    <p class="number1" style="margin-top: 2.6666667px; margin-bottom: 2.6666667px; margin-left: 36px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">1.
      it doesn’t store anything in the varargs parameter array, and</p>
    <p class="number1" style="margin-top: 2.6666667px; margin-bottom: 2.6666667px; margin-left: 36px; text-indent: -16px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">2.
      it doesn’t make the array (or a clone) visible to untrusted code. If
      either of these prohibitions is violated, fix it.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Note
      that the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>annotation is legal only on
      methods that can’t be overridden, because it is impossible to guarantee
      that every possible overriding method will be safe. In Java 8, the
      annotation was legal only on static methods and final instance methods; in
      Java 9, it became legal on private instance methods as well.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">An
      alternative to using the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">SafeVarargs</code><span class="Apple-converted-space">&nbsp;</span>annotation
      is to take the advice of<span class="Apple-converted-space">&nbsp;</span><a
        href="ch5.xhtml#lev28" style="text-decoration: none;">Item 28</a><span class="Apple-converted-space">&nbsp;</span>and
      replace the varargs parameter (which is an array in disguise) with a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code><span
        class="Apple-converted-space">&nbsp;</span>parameter. Here’s how this
      approach looks when applied to our<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">flatten</code><span class="Apple-converted-space">&nbsp;</span>method.
      Note that only the parameter declaration has changed:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex75a" id="pch5ex75" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        List as a typesafe alternative to a generic varargs parameter</strong><br>
      static &lt;T&gt; List&lt;T&gt; flatten(<strong>List&lt;List&lt;? extends
        T&gt;&gt; lists</strong>) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;List&lt;T&gt; result = new ArrayList&lt;&gt;();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;for (List&lt;? extends T&gt; list : lists)<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result.addAll(list);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return result;<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_150"></span>This method can then be used
      in conjunction with the static factory method<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List.of</code><span class="Apple-converted-space">&nbsp;</span>to
      allow for a variable number of arguments. Note that this approach relies
      on the fact that the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List.of</code><span class="Apple-converted-space">&nbsp;</span>declaration
      is annotated with<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">@SafeVarargs</code>:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex76a" id="pch5ex76" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">audience
      = flatten(List.of(friends, romans, countrymen));</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      advantage of this approach is that the compiler can<span class="Apple-converted-space">&nbsp;</span><em>prove</em><span
        class="Apple-converted-space">&nbsp;</span>that the method is typesafe.
      You don’t have to vouch for its safety with a<code style="font-family: 'Courier New', monospace;">SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>annotation, and you don’t
      have worry that you might have erred in determining that it was safe. The
      main disadvantage is that the client code is a bit more verbose and may be
      a bit slower.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      trick can also be used in situations where it is impossible to write a
      safe varargs method, as is the case with the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">toArray</code><span class="Apple-converted-space">&nbsp;</span>method
      on page 147. Its<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List</code><span
        class="Apple-converted-space">&nbsp;</span>analogue<span class="Apple-converted-space">&nbsp;</span><em>is</em><span
        class="Apple-converted-space">&nbsp;</span>the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List.of</code><span class="Apple-converted-space">&nbsp;</span>method,
      so we don’t even have to write it; the Java libraries authors have done
      the work for us. The<code style="font-family: 'Courier New', monospace;">pickTwo</code><span
        class="Apple-converted-space">&nbsp;</span>method then becomes this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex77a" id="pch5ex77" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">static
      &lt;T&gt;<span class="Apple-converted-space">&nbsp;</span><strong>List&lt;T&gt;</strong><span
        class="Apple-converted-space">&nbsp;</span>pickTwo(T a, T b, T c) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;switch(rnd.nextInt(3)) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 0: return<span class="Apple-converted-space">&nbsp;</span><strong>List.of(a,
        b)</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 1: return<span class="Apple-converted-space">&nbsp;</span><strong>List.of(a,
        c)</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case 2: return<span class="Apple-converted-space">&nbsp;</span><strong>List.of(b,
        c)</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;throw new AssertionError();<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">and
      the main method becomes this:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex78a" id="pch5ex78" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>List&lt;String&gt;</strong><span class="Apple-converted-space">&nbsp;</span>attributes
      = pickTwo("Good", "Fast", "Cheap");<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      resulting code is typesafe because it uses only generics, and not arrays.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, varargs and generics do not interact well because the varargs
      facility is a leaky abstraction built atop arrays, and arrays have
      different type rules from generics. Though generic varargs parameters are
      not typesafe, they are legal. If you choose to write a method with a
      generic (or parameterized) varargs parameter, first ensure that the method
      is typesafe, and then annotate it with<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">@SafeVarargs</code><span
        class="Apple-converted-space">&nbsp;</span>so it is not unpleasant to
      use.</p>
    <h3 class="h3" style="font-size: 21px; margin-top: 26.666668px; margin-bottom: 13.333334px; page-break-after: avoid; margin-left: 80px; text-indent: -80px; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        id="lev33" style="text-decoration: none;"></a><span epub:type="pagebreak"
        id="page_151"></span><strong>Item 33: Consider typesafe heterogeneous
        containers</strong></h3>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Common
      uses of generics include collections, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set&lt;E&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map&lt;K,V&gt;</code>,
      and single-element containers, such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ThreadLocal&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and<code style="font-family: 'Courier New', monospace;">AtomicReference&lt;T&gt;</code>.
      In all of these uses, it is the container that is parameterized. This
      limits you to a fixed number of type parameters per container. Normally
      that is exactly what you want. A<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Set</code><span class="Apple-converted-space">&nbsp;</span>has
      a single type parameter, representing its element type; a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>has
      two, representing its key and value types; and so forth.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Sometimes,
      however, you need more flexibility. For example, a database row can have
      arbitrarily many columns, and it would be nice to be able to access all of
      them in a typesafe manner. Luckily, there is an easy way to achieve this
      effect. The idea is to parameterize the<span class="Apple-converted-space">&nbsp;</span><em>key</em><span
        class="Apple-converted-space">&nbsp;</span>instead of the<em>container</em>.
      Then present the parameterized key to the container to insert or retrieve
      a value. The generic type system is used to guarantee that the type of the
      value agrees with its key.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      a simple example of this approach, consider a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>class
      that allows its clients to store and retrieve a favorite instance of
      arbitrarily many types. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      for the type will play the part of the parameterized key. The reason this
      works is that class<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>is
      generic. The type of a class literal is not simply<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code>, but<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class&lt;T&gt;</code>.
      For example,<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String.class</code><span
        class="Apple-converted-space">&nbsp;</span>is of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class&lt;String&gt;</code>,
      and<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Integer.class</code><span
        class="Apple-converted-space">&nbsp;</span>is of type<code style="font-family: 'Courier New', monospace;">Class&lt;Integer&gt;</code>.
      When a class literal is passed among methods to communicate both
      compile-time and runtime type information, it is called a<em>type token</em><span
        class="Apple-converted-space">&nbsp;</span>[<a href="ref.xhtml#rBracha04"
        style="text-decoration: none;">Bracha04</a>].</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      API for the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>class is simple. It looks
      just like a simple map, except that the key is parameterized instead of
      the map. The client presents a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      when setting and getting favorites. Here is the API:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex79a" id="pch5ex79" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typesafe heterogeneous container pattern - API</strong><br>
      public class Favorites {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; void putFavorite(Class&lt;T&gt;
      type, T instance);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; T getFavorite(Class&lt;T&gt;
      type);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here
      is a sample program that exercises the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>class,
      storing, retrieving, and printing a favorite<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code>,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code>, and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class</code><span
        class="Apple-converted-space">&nbsp;</span>instance:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex80a" id="pch5ex80" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typesafe heterogeneous container pattern - client</strong><br>
      public static void main(String[] args) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Favorites f = new Favorites();<br>
      &nbsp;&nbsp;&nbsp;&nbsp;f.putFavorite(String.class, "Java");<br>
      &nbsp;&nbsp;&nbsp;&nbsp;f.putFavorite(Integer.class, 0xcafebabe);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;f.putFavorite(Class.class, Favorites.class);<br>
      <span epub:type="pagebreak" id="page_152"></span>&nbsp;&nbsp;&nbsp;&nbsp;String
      favoriteString = f.getFavorite(String.class);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;int favoriteInteger =
      f.getFavorite(Integer.class);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;Class&lt;?&gt; favoriteClass =
      f.getFavorite(Class.class);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;System.out.printf("%s %x %s%n", favoriteString,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;favoriteInteger,
      favoriteClass.getName());<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">As
      you would expect, this program prints<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Java cafebabe Favorites</code>.
      Note, incidentally, that Java’s<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">printf</code><span class="Apple-converted-space">&nbsp;</span>method
      differs from C’s in that you should use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">%n</code><span class="Apple-converted-space">&nbsp;</span>where
      you’d use<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">\n</code><span
        class="Apple-converted-space">&nbsp;</span>in C. The<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">%n</code><span class="Apple-converted-space">&nbsp;</span>generates
      the applicable platform-specific line separator, which is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">\n</code><span class="Apple-converted-space">&nbsp;</span>on
      many but not all platforms.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">A<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>instance is<span class="Apple-converted-space">&nbsp;</span><em>typesafe</em>:
      it will never return an<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Integer</code><span class="Apple-converted-space">&nbsp;</span>when
      you ask it for a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String</code>.
      It is also<span class="Apple-converted-space">&nbsp;</span><em>heterogeneous</em>:
      unlike an ordinary map, all the keys are of different types. Therefore, we
      call<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>a<span class="Apple-converted-space">&nbsp;</span><em>typesafe
        heterogeneous container</em>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      implementation of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>is surprisingly tiny. Here it
      is, in its entirety:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex81a" id="pch5ex81" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Typesafe heterogeneous container pattern - implementation</strong><br>
      public class Favorites {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;private<span class="Apple-converted-space">&nbsp;</span><strong>Map&lt;Class&lt;?&gt;,
        Object&gt; favorites</strong><span class="Apple-converted-space">&nbsp;</span>=
      new HashMap&lt;&gt;();<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; void putFavorite(Class&lt;T&gt;
      type, T instance) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;favorites.put(Objects.requireNonNull(type),
      instance);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      <br>
      &nbsp;&nbsp;&nbsp;&nbsp;public &lt;T&gt; T getFavorite(Class&lt;T&gt;
      type) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<span class="Apple-converted-space">&nbsp;</span><strong>type.cast(favorites.get(type))</strong>;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}порівняння<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are a few subtle things going on here. Each<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>instance
      is backed by a private<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map&lt;Class&lt;?&gt;,
        Object&gt;</code><span class="Apple-converted-space">&nbsp;</span>called<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">favorites</code>.
      You might think that you couldn’t put anything into this<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Map</code><span class="Apple-converted-space">&nbsp;</span>because
      of the unbounded wildcard type, but the truth is quite the opposite. The
      thing to notice is that the wildcard type is nested: it’s not the type of
      the map that’s a wildcard type but the type of its key. This means that
      every key can have a<span class="Apple-converted-space">&nbsp;</span><em>different</em><span
        class="Apple-converted-space">&nbsp;</span>parameterized type: one can
      be<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class&lt;String&gt;</code>,
      the next<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class&lt;Integer&gt;</code>,
      and so on. That’s where the heterogeneity comes from.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      next thing to notice is that the value type of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">favorites Map</code><span
        class="Apple-converted-space">&nbsp;</span>is simply<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code>. In other
      words, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Map</code><span
        class="Apple-converted-space">&nbsp;</span>does not guarantee the type
      relationship between keys and values, which is that every value is of the
      type represented by its key. In<span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_153"></span>fact, Java’s type system is
      not powerful enough to express this. But we know that it’s true, and we
      take advantage of it when the time comes to retrieve a favorite.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">putFavorite</code><span
        class="Apple-converted-space">&nbsp;</span>implementation is trivial: it
      simply puts into<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">favorites</code><span
        class="Apple-converted-space">&nbsp;</span>a mapping from the given<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class</code><span
        class="Apple-converted-space">&nbsp;</span>object to the given favorite
      instance. As noted, this discards the “type linkage” between the key and
      the value; it loses the knowledge that the value is an instance of the
      key. But that’s OK, because the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getFavorites</code><span
        class="Apple-converted-space">&nbsp;</span>method can and does
      reestablish this linkage.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      implementation of<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getFavorite</code><span
        class="Apple-converted-space">&nbsp;</span>is trickier than that of<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">putFavorite</code>.
      First, it gets from the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">favorites</code><span class="Apple-converted-space">&nbsp;</span>map
      the value corresponding to the given<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object.
      This is the correct object reference to return, but it has the wrong
      compile-time type: it is<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Object</code><span class="Apple-converted-space">&nbsp;</span>(the
      value type of the<code style="font-family: 'Courier New', monospace;">favorites</code><span
        class="Apple-converted-space">&nbsp;</span>map) and we need to return a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">T</code>.
      So, the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getFavorite</code><span
        class="Apple-converted-space">&nbsp;</span>implementation<span class="Apple-converted-space">&nbsp;</span><em>dynamically
        casts</em><span class="Apple-converted-space">&nbsp;</span>the object
      reference to the type represented by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object,
      using<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class</code>’s<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">cast</code><span
        class="Apple-converted-space">&nbsp;</span>method.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">cast</code><span
        class="Apple-converted-space">&nbsp;</span>method is the dynamic
      analogue of Java’s cast operator. It simply checks that its argument is an
      instance of the type represented by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object.
      If so, it returns the argument; otherwise it throws a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code>.
      We know that the cast invocation in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getFavorite</code>won’t
      throw<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code>,
      assuming the client code compiled cleanly. That is to say, we know that
      the values in the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">favorites</code><span
        class="Apple-converted-space">&nbsp;</span>map always match the types of
      their keys.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">So
      what does the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">cast</code><span
        class="Apple-converted-space">&nbsp;</span>method do for us, given that
      it simply returns its argument? The signature of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">cast</code><span class="Apple-converted-space">&nbsp;</span>method
      takes full advantage of the fact that class<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>is
      generic. Its return type is the type parameter of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex82a" id="pch5ex82" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      class Class&lt;T&gt; {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;T cast(Object obj);<br>
      }</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">This
      is precisely what’s needed by the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">getFavorite</code><span class="Apple-converted-space">&nbsp;</span>method.
      It is what allows us to make<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>typesafe
      without resorting to an unchecked cast to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">T</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are two limitations to the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>class
      that are worth noting. First, a malicious client could easily corrupt the
      type safety of a<code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>instance, by using a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      in its raw form. But the resulting client code would generate an unchecked
      warning when it was compiled. This is no different from a normal
      collection implementations such as<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>and<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">HashMap</code>.
      You can easily put a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>into
      a<code style="font-family: 'Courier New', monospace;">HashSet&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>by using the raw type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">HashSet</code><span class="Apple-converted-space">&nbsp;</span>(<a
        href="ch5.xhtml#lev26" style="text-decoration: none;">Item 26</a>). That
      said, you can have runtime type safety if you’re willing to pay for it.
      The way to ensure that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>never
      violates its type invariant is to have the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">putFavorite</code><span class="Apple-converted-space">&nbsp;</span><span
        epub:type="pagebreak" id="page_154"></span>method check that<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">instance</code><span class="Apple-converted-space">&nbsp;</span>is
      actually an instance of the type represented by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">type</code>, and we
      already know how to do this. Just use a dynamic cast:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex83a" id="pch5ex83" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Achieving runtime type safety with a dynamic cast</strong><br>
      public &lt;T&gt; void putFavorite(Class&lt;T&gt; type, T instance) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;favorites.put(type, type.cast(instance));<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">There
      are collection wrappers in<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">java.util.Collections</code><span
        class="Apple-converted-space">&nbsp;</span>that play the same trick.
      They are called<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">checkedSet</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">checkedList</code>,<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">checkedMap</code>,
      and so forth. Their static factories take a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      (or two) in addition to a collection (or map). The static factories are
      generic methods, ensuring that the compile-time types of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      and the collection match. The wrappers add reification to the collections
      they wrap. For example, the wrapper throws a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">ClassCastException</code><span
        class="Apple-converted-space">&nbsp;</span>at runtime if someone tries
      to put a<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Coin</code><span
        class="Apple-converted-space">&nbsp;</span>into your<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Collection&lt;Stamp&gt;</code>.
      These wrappers are useful for tracking down client code that adds an
      incorrectly typed element to a collection, in an application that mixes
      generic and raw types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      second limitation of the<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>class
      is that it cannot be used on a non-reifiable type (<a href="ch5.xhtml#lev28"
        style="text-decoration: none;">Item 28</a>). In other words, you can
      store your favorite<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">String</code><span class="Apple-converted-space">&nbsp;</span>or<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">String[]</code>,
      but not your favorite<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>.
      If you try to store your favorite<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>,
      your program won’t compile. The reason is that you can’t get a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      for<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code>.
      The class literal<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>is a syntax error, and it’s a
      good thing, too.<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>share a single<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object,
      which is<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List.class</code>.
      It would wreak havoc with the internals of a<code style="font-family: 'Courier New', monospace;">Favorites</code><span
        class="Apple-converted-space">&nbsp;</span>object if the “type literals”<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">List&lt;String&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">List&lt;Integer&gt;.class</code><span
        class="Apple-converted-space">&nbsp;</span>were legal and returned the
      same object reference. There is no entirely satisfactory workaround for
      this limitation.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      type tokens used by<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Favorites</code><span class="Apple-converted-space">&nbsp;</span>are
      unbounded:<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">getFavorite</code><span
        class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">put-Favorite</code><span
        class="Apple-converted-space">&nbsp;</span>accept any<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object.
      Sometimes you may need to limit the types that can be passed to a method.
      This can be achieved with a<span class="Apple-converted-space">&nbsp;</span><em>bounded
        type token</em>, which is simply a type token that places a bound on
      what type can be represented, using a bounded type parameter (<a href="ch5.xhtml#lev30"
        style="text-decoration: none;">Item 30</a>) or a bounded wildcard (<a href="ch5.xhtml#lev31"
        style="text-decoration: none;">Item 31</a>).</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">The
      annotations API (<a href="ch6.xhtml#lev39" style="text-decoration: none;">Item
        39</a>) makes extensive use of bounded type tokens. For example, here is
      the method to read an annotation at runtime. This method comes from the<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">AnnotatedElement</code><span
        class="Apple-converted-space">&nbsp;</span>interface, which is
      implemented by the reflective types that represent classes, methods,
      fields, and other program elements:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex84a" id="pch5ex84" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">public
      &lt;T extends Annotation&gt;<br>
      &nbsp;&nbsp;&nbsp;&nbsp;T getAnnotation(Class&lt;T&gt; annotationType);</p>
    <p class="noindent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 0.0026666669px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span
        epub:type="pagebreak" id="page_155"></span>The argument,<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">annotationType</code>, is
      a bounded type token representing an annotation type. The method returns
      the element’s annotation of that type, if it has one, or<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">null</code>, if it
      doesn’t. In essence, an annotated element is a typesafe heterogeneous
      container whose keys are annotation types.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Suppose
      you have an object of type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class&lt;?&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>and you want to pass it to a
      method that requires a bounded type token, such as<code style="font-family: 'Courier New', monospace;">getAnnotation</code>.
      You could cast the object to<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class&lt;? extends
        Annotation&gt;</code>, but this cast is unchecked, so it would generate
      a compile-time warning (<a href="ch5.xhtml#lev27" style="text-decoration: none;">Item
        27</a>). Luckily, class<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>provides
      an instance method that performs this sort of cast safely (and
      dynamically). The method is called<code style="font-family: 'Courier New', monospace;">asSubclass</code>,
      and it casts the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">Class</code><span
        class="Apple-converted-space">&nbsp;</span>object on which it is called
      to represent a subclass of the class represented by its argument. If the
      cast succeeds, the method returns its argument; if it fails, it throws a<span
        class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">ClassCastException</code>.</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">Here’s
      how you use the<span class="Apple-converted-space">&nbsp;</span><code style="font-family: 'Courier New', monospace;">asSubclass</code><span
        class="Apple-converted-space">&nbsp;</span>method to read an annotation
      whose type is unknown at compile time. This method compiles without error
      or warning:</p>
    <p class="codelink" style="font-size: 0.88em; margin-top: 8px; margin-bottom: 8px; font-weight: bold; page-break-after: avoid; font-family: sans-serif; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><a
        href="ch5_images.xhtml#pch5ex85a" id="pch5ex85" style="text-decoration: none;">&nbsp;</a></p>
    <p class="pre" style="font-family: 'Courier New', monospace; font-size: 0.88em; margin-top: 13.333334px; margin-bottom: 13.333334px; margin-left: 20px; text-align: justify; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><strong>//
        Use of asSubclass to safely cast to a bounded type token</strong><br>
      static Annotation getAnnotation(AnnotatedElement element,<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String
      annotationTypeName) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;<strong>Class&lt;?&gt; annotationType</strong><span
        class="Apple-converted-space">&nbsp;</span>= null; // Unbounded type
      token<br>
      &nbsp;&nbsp;&nbsp;&nbsp;try {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotationType =
      Class.forName(annotationTypeName);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;} catch (Exception ex) {<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new
      IllegalArgumentException(ex);<br>
      &nbsp;&nbsp;&nbsp;&nbsp;}<br>
      &nbsp;&nbsp;&nbsp;&nbsp;return element.getAnnotation(<br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>annotationType.asSubclass(Annotation.class)</strong>);<br>
      }</p>
    <p class="indent" style="margin-top: 0px; margin-bottom: 0px; text-indent: 20px; font-family: sans-serif; font-size: medium; font-weight: normal; letter-spacing: normal; line-height: 1.6; orphans: auto; text-align: justify; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">In
      summary, the normal use of generics, exemplified by the collections APIs,
      restricts you to a fixed number of type parameters per container. You can
      get around this restriction by placing the type parameter on the key
      rather than the container. You can use<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>objects
      as keys for such typesafe heterogeneous containers. A<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Class</code><span class="Apple-converted-space">&nbsp;</span>object
      used in this fashion is called a type token. You can also use a custom key
      type. For example, you could have a<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">DatabaseRow</code><span class="Apple-converted-space">&nbsp;</span>type
      representing a database row (the container), and a generic type<span class="Apple-converted-space">&nbsp;</span><code
        style="font-family: 'Courier New', monospace;">Column&lt;T&gt;</code><span
        class="Apple-converted-space">&nbsp;</span>as its key.</p>
    <p></p>
    <p>1 </p>
  </body>
</html>
