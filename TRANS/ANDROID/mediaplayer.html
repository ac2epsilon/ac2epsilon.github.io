<!DOCTYPE html>
<!-- saved from url=(0064)http://developer.android.com/guide/topics/media/mediaplayer.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">



<meta name="viewport" content="width=device-width">

<meta name="Description" content="The Android multimedia framework includes support for playing variety of common media types, so that you can easily integrate audio, video and images into your applications. You can play audio or video from media files stored in your application&#39;s…">
<link rel="shortcut icon" type="image/x-icon" href="http://developer.android.com/favicon.ico">
<title>Media Playback | Android Developers</title>

<!-- STYLESHEETS -->
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto+Condensed">
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:light,regular,medium,thin,italic,mediumitalic,bold" title="roboto">
<link href="./mediaplayer_files/default.css" rel="stylesheet" type="text/css">



<!-- JAVASCRIPT -->
<script src="./mediaplayer_files/cb=gapi.loaded_1" async=""></script><script src="./mediaplayer_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="./mediaplayer_files/plusone.js" gapi_processed="true"></script><script async="" src="./mediaplayer_files/analytics.js"></script><script src="./mediaplayer_files/jsapi" type="text/javascript"></script>
<script src="./mediaplayer_files/android_3p-bundle.js" type="text/javascript"></script>
<script type="text/javascript">
  var toRoot = "/";
  var metaTags = ["mediaplayer","soundpool","audiomanager"];
  var devsite = false;
</script>
<script src="./mediaplayer_files/docs.js" type="text/javascript"></script><script type="text/javascript" src="./mediaplayer_files/saved_resource"></script>



<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-5831155-1', 'android.com');
  ga('create', 'UA-49880327-2', 'android.com', {'name': 'universal'});  // New tracker);
  ga('send', 'pageview');
  ga('universal.send', 'pageview'); // Send page view for new tracker.
</script>

<link type="text/css" href="./mediaplayer_files/default+en.css" rel="stylesheet"><script type="text/javascript" src="./mediaplayer_files/default+en.I.js"></script></head>

<body class="gc-documentation

develop guide" itemscope="" itemtype="http://schema.org/Article">

<a name="top"></a>

<!-- dialog to prompt lang pref change when loaded from hardcoded URL 
<div id="langMessage" style="display:none">
  <div>
    <div class="lang en">
      <p>You requested a page in English, would you like to proceed with this language setting?</p>
    </div>
    <div class="lang es">
      <p>You requested a page in Spanish (Español), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ja">
      <p>You requested a page in Japanese (日本語), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ko">
      <p>You requested a page in Korean (한국어), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang ru">
      <p>You requested a page in Russian (Русский), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang zh-cn">
      <p>You requested a page in Simplified Chinese (简体中文), would you like to proceed with this language setting?</p>
    </div>
    <div class="lang zh-tw">
      <p>You requested a page in Traditional Chinese (繁體中文), would you like to proceed with this language setting?</p>
    </div>
    <a href="#" class="button yes" onclick="return false;">
      <span class="lang en">Yes</span>
      <span class="lang es">Sí</span>
      <span class="lang ja">Yes</span>
      <span class="lang ko">Yes</span>
      <span class="lang ru">Yes</span>
      <span class="lang zh-cn">是的</span>
      <span class="lang zh-tw">没有</span>
    </a>
    <a href="#" class="button" onclick="$('#langMessage').hide();return false;">
      <span class="lang en">No</span>
      <span class="lang es">No</span>
      <span class="lang ja">No</span>
      <span class="lang ko">No</span>
      <span class="lang ru">No</span>
      <span class="lang zh-cn">没有</span>
      <span class="lang zh-tw">没有</span>
    </a>
  </div>
</div> -->


  <!-- Header -->
  <div id="header-wrapper">
    <div id="header">

    


      <div class="wrap" id="header-wrap">
        <div class="col-3 logo">
          <a href="http://developer.android.com/index.html">
            <img src="./mediaplayer_files/dac_logo.png" srcset="/assets/images/dac_logo@2x.png 2x" width="123" height="25" alt="Android Developers">
          </a>
          <div class="btn-quicknav" id="btn-quicknav">
            <a href="http://developer.android.com/guide/topics/media/mediaplayer.html#" class="arrow-inactive">Quicknav</a>
            <a href="http://developer.android.com/guide/topics/media/mediaplayer.html#" class="arrow-active">Quicknav</a>
          </div>
        </div>
        <ul class="nav-x col-9">
            <li class="design">
              <a href="http://developer.android.com/design/index.html" zh-tw-lang="設計" zh-cn-lang="设计" ru-lang="Проектирование" ko-lang="디자인" ja-lang="設計" es-lang="Diseñar">Design</a></li>
            <li class="develop"><a href="http://developer.android.com/develop/index.html" zh-tw-lang="開發" zh-cn-lang="开发" ru-lang="Разработка" ko-lang="개발" ja-lang="開発" es-lang="Desarrollar" class="selected">Develop</a></li>
            <li class="distribute last"><a href="http://developer.android.com/distribute/index.html" zh-tw-lang="發佈" zh-cn-lang="分发" ru-lang="Распространение" ko-lang="배포" ja-lang="配布" es-lang="Distribuir">Distribute</a></li>
        </ul>


        
        
<div class="menu-container sticky-menu">
  <div class="moremenu">
    <div id="more-btn"></div>
  </div>
  <div class="morehover" id="moremenu">
    <div class="top"></div>
    <div class="mid">
      <div class="header">Links</div>
      <ul>
        <li><a href="https://play.google.com/apps/publish/" target="_googleplay">Google Play Developer Console</a></li>
        <li><a href="http://android-developers.blogspot.com/">Android Developers Blog</a></li>
        <li><a href="http://developer.android.com/about/index.html">About Android</a></li>
      </ul>
      <div class="header">Android Sites</div>
      <ul>
        <li><a href="http://www.android.com/">Android.com</a></li>
        <li class="active"><a>Android Developers</a></li>
        <li><a href="http://source.android.com/">Android Open Source Project</a></li>
      </ul>

      
      
        <div class="header">Language</div>
          <div id="language" class="locales">
            <select name="language" onchange="changeLangPref(this.value, true)">
                <option value="en" selected="selected">English</option>
                <option value="es">Español</option>
                <option value="ja">日本語</option>
                <option value="ko">한국어</option>
                <option value="ru">Русский</option>
                <option value="zh-cn">中文（简体)</option>
                <option value="zh-tw">中文（繁體)</option>
            </select>
          </div>
        <script type="text/javascript">
          <!--
          loadLangPref();
            //-->
        </script>
      
      
      <br class="clearfix">
    </div><!-- end 'mid' -->
    <div class="bottom"></div>
  </div><!-- end 'moremenu' -->

  <div class="search" id="search-container">
    <div class="search-inner">
      <div id="search-btn"></div>
      <div class="left"></div>
      <form onsubmit="return submit_search()">
        <input id="search_autocomplete" type="text" value="" autocomplete="off" name="q" onfocus="search_focus_changed(this, true)" onblur="search_focus_changed(this, false)" onkeydown="return search_changed(event, true, &#39;/&#39;)" onkeyup="return search_changed(event, false, &#39;/&#39;)">
      </form>
      <div class="right"></div>
      <a class="close hide">close</a>
      <div class="left"></div>
      <div class="right"></div>
    </div><!-- end search-inner -->
  </div><!-- end search-container -->

  <div class="search_filtered_wrapper reference">
    <div class="suggest-card reference no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>

  <div class="search_filtered_wrapper docs">
    <div class="suggest-card dummy no-display">&nbsp;</div>
    <div class="suggest-card develop no-display">
      <ul class="search_filtered">
      </ul>
      <div class="child-card guides no-display">
      </div>
      <div class="child-card training no-display">
      </div>
      <div class="child-card samples no-display">
      </div>
    </div>
    <div class="suggest-card design no-display">
      <ul class="search_filtered">
      </ul>
    </div>
    <div class="suggest-card distribute no-display">
      <ul class="search_filtered">
      </ul>
    </div>
  </div>
</div><!-- end menu-container (search and menu widget) -->



        <!-- Expanded quicknav -->
        <div id="quicknav" class="col-13">
          <ul>
            <li class="about">
              <ul>
                <li><a href="http://developer.android.com/about/index.html">About</a></li>
                <li><a href="http://developer.android.com/wear/index.html">Wear</a></li>
                <li><a href="http://developer.android.com/tv/index.html">TV</a></li>
                <li><a href="http://developer.android.com/auto/index.html">Auto</a></li>
              </ul>
            </li>
            <li class="design">
              <ul>
                <li><a href="http://developer.android.com/design/index.html">Get Started</a></li>
                <li><a href="http://developer.android.com/design/devices.html">Devices</a></li>
                <li><a href="http://developer.android.com/design/style/index.html">Style</a></li>
                <li><a href="http://developer.android.com/design/patterns/index.html">Patterns</a></li>
                <li><a href="http://developer.android.com/design/building-blocks/index.html">Building Blocks</a></li>
                <li><a href="http://developer.android.com/design/downloads/index.html">Downloads</a></li>
                <li><a href="http://developer.android.com/design/videos/index.html">Videos</a></li>
              </ul>
            </li>
            <li class="develop">
              <ul>
                <li><a href="http://developer.android.com/training/index.html" zh-tw-lang="訓練課程" zh-cn-lang="培训" ru-lang="Курсы" ko-lang="교육" ja-lang="トレーニング" es-lang="Capacitación" class="selected">Training</a></li>
                <li><a href="http://developer.android.com/guide/index.html" zh-tw-lang="API 指南" zh-cn-lang="API 指南" ru-lang="Руководства по API" ko-lang="API 가이드" ja-lang="API ガイド" es-lang="Guías de la API" class="selected">API Guides</a></li>
                <li><a href="http://developer.android.com/reference/packages.html" zh-tw-lang="參考資源" zh-cn-lang="参考" ru-lang="Справочник" ko-lang="참조문서" ja-lang="リファレンス" es-lang="Referencia" class="selected">Reference</a></li>
                <li><a href="http://developer.android.com/sdk/index.html" zh-tw-lang="相關工具" zh-cn-lang="工具" ru-lang="Инструменты" ko-lang="도구" ja-lang="ツール" es-lang="Herramientas" class="selected">Tools</a>
                </li>
                <li><a href="http://developer.android.com/google/index.html" class="selected">Google Services</a>
                </li>
                
                  <li><a href="http://developer.android.com/samples/index.html" class="selected">Samples</a>
                  </li>
                
              </ul>
            </li>
            <li class="distribute last">
              <ul>
                <li><a href="http://developer.android.com/distribute/googleplay/index.html">Google Play</a></li>
                <li><a href="http://developer.android.com/distribute/essentials/index.html">Essentials</a></li>
                <li><a href="http://developer.android.com/distribute/users/index.html">Get Users</a></li>
                <li><a href="http://developer.android.com/distribute/engage/index.html">Engage &amp; Retain</a></li>
                <li><a href="http://developer.android.com/distribute/monetize/index.html">Monetize</a></li>
                <li><a href="http://developer.android.com/distribute/analyze/index.html">Analyze</a></li>
                <li><a href="http://developer.android.com/distribute/tools/index.html">Tools &amp; Reference</a></li>
                <li><a href="http://developer.android.com/distribute/stories/index.html">Developer Stories</a></li>
              </ul>
            </li>
          </ul>
        </div><!-- /Expanded quicknav -->
      </div><!-- end header-wrap.wrap -->
    </div><!-- end header -->

  
    <!-- Secondary x-nav -->
    <div id="nav-x">
        <div class="wrap" style="position:relative;z-index:1">

        

            <ul class="nav-x col-9 develop" style="width:100%">
                <li class="training"><a href="http://developer.android.com/training/index.html" zh-tw-lang="訓練課程" zh-cn-lang="培训" ru-lang="Курсы" ko-lang="교육" ja-lang="トレーニング" es-lang="Capacitación">Training</a></li>
                <li class="guide"><a href="http://developer.android.com/guide/index.html" zh-tw-lang="API 指南" zh-cn-lang="API 指南" ru-lang="Руководства по API" ko-lang="API 가이드" ja-lang="API ガイド" es-lang="Guías de la API" class="selected">API Guides</a></li>
                <li class="reference"><a href="http://developer.android.com/reference/packages.html" zh-tw-lang="參考資源" zh-cn-lang="参考" ru-lang="Справочник" ko-lang="참조문서" ja-lang="リファレンス" es-lang="Referencia">Reference</a></li>
                <li class="tools"><a href="http://developer.android.com/sdk/index.html" zh-tw-lang="相關工具" zh-cn-lang="工具" ru-lang="Инструменты" ko-lang="도구" ja-lang="ツール" es-lang="Herramientas">Tools</a></li>
                <li class="google"><a href="http://developer.android.com/google/index.html">Google Services</a>
                </li>
                
                  <li class="samples"><a href="http://developer.android.com/samples/index.html">Samples</a>
                  </li>
                
            </ul>
        </div>
    </div>
    <!-- /Sendondary x-nav DEVELOP -->

  

    <div id="searchResults" class="wrap" style="display: none;">
      <h2 id="searchTitle" style="margin-bottom: 0px;">Results</h2><hr>
      <div id="leftSearchControl" class="search-control">Loading...</div>
    </div>
  </div> <!--end header-wrapper -->

  <div id="sticky-header" class="develop" style="display: block;">
    <div>
      <a class="logo" href="http://developer.android.com/guide/topics/media/mediaplayer.html#top"></a>
      <a class="top" href="http://developer.android.com/guide/topics/media/mediaplayer.html#top"></a>
      <ul class="breadcrumb"><li><a href="http://developer.android.com/develop/index.html" zh-tw-lang="開發" zh-cn-lang="开发" ru-lang="Разработка" ko-lang="개발" ja-lang="開発" es-lang="Desarrollar" class="">Develop</a></li><li><a href="http://developer.android.com/guide/index.html" zh-tw-lang="API 指南" zh-cn-lang="API 指南" ru-lang="Руководства по API" ko-lang="API 가이드" ja-lang="API ガイド" es-lang="Guías de la API" class="">API Guides</a></li>
        
        <li class="current">Media Playback</li>
      </ul>
    </div>
  </div>




  <div class="wrap clearfix" id="body-content"><div id="devdoc-nav" class="scroll-pane jspScrollable fixed" style="overflow: hidden; padding: 0px; height: 467px; left: -22.7272720336914px; width: 220px;">







        

      <div class="jspContainer" style="width: 220px; height: 466px;"><div class="jspPane" style="padding: 0px; top: 0px; width: 216px;"><ul id="nav" style="width: 216px;">

  <li class="nav-section">
    <div class="nav-section-header"><a href="http://developer.android.com/guide/index.html">
        <span class="en">Introduction</span>
      </a></div>
    <ul>
      <li><a href="http://developer.android.com/guide/components/fundamentals.html">
            <span class="en">App Fundamentals</span></a>
      </li>
      <li><a href="http://developer.android.com/guide/practices/compatibility.html">
            <span class="en">Device Compatibility</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/topics/security/permissions.html">
          <span class="en">System Permissions</span>
        </a>
      </li>
    </ul>
  </li>


  <li class="nav-section">
    <div class="nav-section-header"><a href="http://developer.android.com/guide/components/index.html">
        <span class="en">App Components</span>
      </a></div>
    <ul>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/components/intents-filters.html">
            <span class="en">Intents and Intent Filters</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/components/intents-common.html">
            <span class="en">Common Intents</span>
          </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/components/activities.html">
            <span class="en">Activities</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/components/fragments.html">
              <span class="en">Fragments</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/components/loaders.html">
              <span class="en">Loaders</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/components/tasks-and-back-stack.html">
              <span class="en">Tasks and Back Stack</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/components/recents.html">
              <span class="en">Overview Screen</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/components/services.html">
            <span class="en">Services</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/components/bound-services.html">
              <span class="en">Bound Services</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/components/aidl.html">
              <span class="en">AIDL</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/providers/content-providers.html">
            <span class="en">Content Providers</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/providers/content-provider-basics.html">
              <span class="en">Content Provider Basics</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/providers/content-provider-creating.html">
              <span class="en">Creating a Content Provider</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/providers/calendar-provider.html">
              <span class="en">Calendar Provider</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/providers/contacts-provider.html">
              <span class="en">Contacts Provider</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/providers/document-provider.html">
              <span class="en">Storage Access Framework</span>
            </a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/appwidgets/index.html">
            <span class="en">App Widgets</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/appwidgets/host.html">
              <span class="en">App Widget Host</span>
            </a></li>
        </ul>
      </li>
      <li><a href="http://developer.android.com/guide/components/processes-and-threads.html">
          <span class="en">Processes and Threads</span>
        </a>
      </li>
    </ul>
  </li>


  <li class="nav-section">
    <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/resources/index.html">
         <span class="en">App Resources</span>
       </a></div>
    <ul>
      <li><a href="http://developer.android.com/guide/topics/resources/overview.html">
          <span class="en">Overview</span>
        </a></li>
        <li><a href="http://developer.android.com/guide/topics/resources/providing-resources.html">
          <span class="en">Providing Resources</span>
        </a></li>
      <li><a href="http://developer.android.com/guide/topics/resources/accessing-resources.html">
          <span class="en">Accessing Resources</span>
        </a></li>
      <li><a href="http://developer.android.com/guide/topics/resources/runtime-changes.html">
            <span class="en">Handling Runtime Changes</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/topics/resources/localization.html">
          <span class="en">Localization</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/resources/available-resources.html">
            <span class="en">Resource Types</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/resources/animation-resource.html">Animation</a></li>
          <li><a href="http://developer.android.com/guide/topics/resources/color-list-resource.html">Color State List</a></li>
          <li><a href="http://developer.android.com/guide/topics/resources/drawable-resource.html">Drawable</a></li>
          <li><a href="http://developer.android.com/guide/topics/resources/layout-resource.html">Layout</a></li>
          <li><a href="http://developer.android.com/guide/topics/resources/menu-resource.html">Menu</a></li>
          <li><a href="http://developer.android.com/guide/topics/resources/string-resource.html">String</a></li>
          <li><a href="http://developer.android.com/guide/topics/resources/style-resource.html">Style</a></li>
          <li><a href="http://developer.android.com/guide/topics/resources/more-resources.html">More Types</a></li>
        </ul>
      </li><!-- end of resource types -->
    </ul>
  </li><!-- end of app resources -->



  <li class="nav-section">
  <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/manifest/manifest-intro.html">
      <span class="en">App Manifest</span>
    </a></div>
    <ul>
      <li><a href="http://developer.android.com/guide/topics/manifest/action-element.html">&lt;action&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/activity-element.html">&lt;activity&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/activity-alias-element.html">&lt;activity-alias&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/application-element.html">&lt;application&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/category-element.html">&lt;category&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/compatible-screens-element.html">&lt;compatible-screens&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/data-element.html">&lt;data&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/grant-uri-permission-element.html">&lt;grant-uri-permission&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/instrumentation-element.html">&lt;instrumentation&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/intent-filter-element.html">&lt;intent-filter&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/manifest-element.html">&lt;manifest&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/meta-data-element.html">&lt;meta-data&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/path-permission-element.html">&lt;path-permission&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/permission-element.html">&lt;permission&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/permission-group-element.html">&lt;permission-group&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/permission-tree-element.html">&lt;permission-tree&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/provider-element.html">&lt;provider&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/receiver-element.html">&lt;receiver&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/service-element.html">&lt;service&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/supports-gl-texture-element.html">&lt;supports-gl-texture&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/supports-screens-element.html">&lt;supports-screens&gt;</a></li><!-- ##api level 4## -->
      <li><a href="http://developer.android.com/guide/topics/manifest/uses-configuration-element.html">&lt;uses-configuration&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/uses-feature-element.html">&lt;uses-feature&gt;</a></li> <!-- ##api level 4## -->
      <li><a href="http://developer.android.com/guide/topics/manifest/uses-library-element.html">&lt;uses-library&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/uses-permission-element.html">&lt;uses-permission&gt;</a></li>
      <li><a href="http://developer.android.com/guide/topics/manifest/uses-sdk-element.html">&lt;uses-sdk&gt;</a></li>
    </ul>
  </li><!-- end of the manifest file -->



  <li class="nav-section">
    <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/ui/index.html">
        <span class="en">User Interface</span>
      </a></div>
    <ul>
      <li><a href="http://developer.android.com/guide/topics/ui/overview.html">
          <span class="en">Overview</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/ui/declaring-layout.html">
            <span class="en">Layouts</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/ui/layout/linear.html">
              <span class="en">Linear Layout</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/layout/relative.html">
              <span class="en">Relative Layout</span>
            </a></li>
       <!--
          <li><a href="/guide/topics/ui/layout/grid.html">
              <span class="en">Grid Layout</span>
            </a></li>
       -->
          <li><a href="http://developer.android.com/guide/topics/ui/layout/listview.html">
              <span class="en">List View</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/layout/gridview.html">
              <span class="en">Grid View</span>
            </a></li>
        </ul>
      </li>

      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/ui/controls.html">
            <span class="en">Input Controls</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/ui/controls/button.html">
              <span class="en">Buttons</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/controls/text.html">
              <span class="en">Text Fields</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/controls/checkbox.html">
              <span class="en">Checkboxes</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/controls/radiobutton.html">
              <span class="en">Radio Buttons</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/controls/togglebutton.html">
              <span class="en">Toggle Buttons</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/controls/spinner.html">
              <span class="en">Spinners</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/controls/pickers.html">
              <span class="en">Pickers</span>
            </a></li>
<!--
          <li><a href="/guide/topics/ui/controls/progress.html">
              <span class="en">Seek and Progress Bars</span>
            </a></li>
-->
        </ul>
      </li>
      <li><a href="http://developer.android.com/guide/topics/ui/ui-events.html">
          <span class="en">Input Events</span>
        </a></li>
      <li><a href="http://developer.android.com/guide/topics/ui/menus.html">
          <span class="en">Menus</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/topics/ui/actionbar.html">
           <span class="en">Action Bar</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/topics/ui/settings.html">
            <span class="en">Settings</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/topics/ui/dialogs.html">
           <span class="en">Dialogs</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/topics/ui/notifiers/notifications.html">
          <span class="en">Notifications</span>
        </a></li>
      <li><a href="http://developer.android.com/guide/topics/ui/notifiers/toasts.html">
          <span class="en">Toasts</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/search/index.html">
            <span class="en">Search</span>
          </a></div>
          <ul>
            <li><a href="http://developer.android.com/guide/topics/search/search-dialog.html">Creating a Search Interface</a></li>
            <li><a href="http://developer.android.com/guide/topics/search/adding-recent-query-suggestions.html">Adding Recent Query Suggestions</a></li>
            <li><a href="http://developer.android.com/guide/topics/search/adding-custom-suggestions.html">Adding Custom Suggestions</a></li>
            <li><a href="http://developer.android.com/guide/topics/search/searchable-config.html">Searchable Configuration</a></li>
          </ul>
      </li>
      <li><a href="http://developer.android.com/guide/topics/ui/drag-drop.html">
          <span class="en">Drag and Drop</span>
        </a></li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/ui/accessibility/index.html">
            <span class="en">Accessibility</span>
          </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/ui/accessibility/apps.html">
              <span class="en">Making Applications Accessible</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/accessibility/checklist.html">
              <span class="en">Accessibility Developer Checklist</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/ui/accessibility/services.html">
              <span class="en">Building Accessibility Services</span>
            </a></li>
        </ul>
      </li>
      <li><a href="http://developer.android.com/guide/topics/ui/themes.html">
          <span class="en">Styles and Themes</span>
        </a></li>
      <li><a href="http://developer.android.com/guide/topics/ui/custom-components.html">
          <span class="en">Custom Components</span>
        </a></li>
    </ul>
  </li><!-- end of User Interface -->

   <li class="nav-section">
      <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/graphics/index.html">
          <span class="en">Animation and Graphics</span>
        </a></div>
      <ul>
      <li class="nav-section">
        </li><li><a href="http://developer.android.com/guide/topics/graphics/overview.html">
            <span class="en">Overview</span>
          </a></li>
        <li><a href="http://developer.android.com/guide/topics/graphics/prop-animation.html">
            <span class="en">Property Animation</span>
          </a></li>
        <li><a href="http://developer.android.com/guide/topics/graphics/view-animation.html">
            <span class="en">View Animation</span>
          </a></li>
        <li><a href="http://developer.android.com/guide/topics/graphics/drawable-animation.html">
            <span class="en">Drawable Animation</span>
          </a></li>
        <li><a href="http://developer.android.com/guide/topics/graphics/2d-graphics.html">
            <span class="en">Canvas and Drawables</span>
          </a></li>
        <li><a href="http://developer.android.com/guide/topics/graphics/opengl.html">
            <span class="en">OpenGL ES</span>
          </a></li>
        <li><a href="http://developer.android.com/guide/topics/graphics/hardware-accel.html">
            <span class="en">Hardware Acceleration</span>
          </a></li>
       </ul>
    </li><!-- end of graphics and animation-->

   <li class="nav-section">
            <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/renderscript/index.html">
              <span class="en">Computation</span>
            </a></div>
            <ul>
              <li><a href="http://developer.android.com/guide/topics/renderscript/compute.html">
                    <span class="en">RenderScript</span></a>
                  </li>

              <li><a href="http://developer.android.com/guide/topics/renderscript/advanced.html">
                    <span class="en">Advanced RenderScript</span></a>
                  </li>
              <li class="nav-section">
                <div class="nav-section-header">
                  <a href="http://developer.android.com/guide/topics/renderscript/reference/overview.html">
                    <span class="en">Runtime API Reference</span>
                  </a></div>
                <ul>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_value_types.html">
                    <span class="en">Numerical Types</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_object_types.html">
                    <span class="en">Object Types</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_convert.html">
                    <span class="en">Conversion Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_math.html">
                    <span class="en">Mathematical Constants and Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_vector_math.html">
                    <span class="en">Vector Math Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_matrix.html">
                    <span class="en">Matrix Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_quaternion.html">
                    <span class="en">Quaternion Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_atomic.html">
                    <span class="en">Atomic Update Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_time.html">
                    <span class="en">Time Functions and Types</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_allocation_data.html">
                    <span class="en">Allocation Data Access Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_object_info.html">
                    <span class="en">Object Characteristics Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_for_each.html">
                    <span class="en">Kernel Invocation Functions and Types</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_io.html">
                    <span class="en">Input/Output Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_debug.html">
                    <span class="en">Debugging Functions</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/rs_graphics.html">
                    <span class="en">Graphics Functions and Types</span>
                  </a></li>
                  <li><a href="http://developer.android.com/guide/topics/renderscript/reference/index.html">
                    <span class="en">Index</span>
                  </a></li>
                </ul>
              </li>
             </ul>
   </li>
      <li class="nav-section expanded">
          <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/media/index.html">
            <span class="en">Media and Camera</span>
          </a></div>
          <ul style="display: block;">
            <li class="selected"><a href="./mediaplayer_files/mediaplayer.html">
                  <span class="en">Media Playback</span></a>
                </li>
            <li><a href="http://developer.android.com/guide/topics/media/mediarouter.html">
                  <span class="en">Media Router</span></a>
                </li>
            <li><a href="http://developer.android.com/guide/topics/media/mediarouteprovider.html">
                  <span class="en">Media Route Provider</span></a>
                </li>
            <li><a href="http://developer.android.com/guide/topics/media/exoplayer.html">
                  <span class="en">ExoPlayer</span></a>
                </li>
            <li><a href="http://developer.android.com/guide/appendix/media-formats.html">
                   <span class="en">Supported Media Formats</span></a>
                </li>
            <li><a href="http://developer.android.com/guide/topics/media/audio-capture.html">
                  <span class="en">Audio Capture</span></a>
                </li>
            <li><a href="http://developer.android.com/guide/topics/media/jetplayer.html">
                  <span class="en">JetPlayer</span></a>
                </li>
            <li><a href="http://developer.android.com/guide/topics/media/camera.html">
                  <span class="en">Camera</span></a>
                </li>
          </ul>
      </li><!-- end of media and camera -->

      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/sensors/index.html">
              <span class="en">Location and Sensors</span>
              </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/location/index.html">
               <span class="en">Location and Maps</span>
             </a>
          </li><li><a href="http://developer.android.com/guide/topics/location/strategies.html">
               <span class="en">Location Strategies</span>
             </a></li>
          <li><a href="http://developer.android.com/guide/topics/sensors/sensors_overview.html">
              <span class="en">Sensors Overview</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/sensors/sensors_motion.html">
              <span class="en">Motion Sensors</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/sensors/sensors_position.html">
              <span class="en">Position Sensors</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/sensors/sensors_environment.html">
              <span class="en">Environment Sensors</span>
            </a></li>
        </ul>
      </li><!-- end of location and sensors -->



<li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/connectivity/index.html">
               <span class="en">Connectivity</span>
             </a></div>
        <ul>
          <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/connectivity/bluetooth.html">
          <span class="en">Bluetooth</span></a>
        </div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/connectivity/bluetooth-le.html">Bluetooth Low Energy</a></li>
        </ul>
      </li>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/connectivity/nfc/index.html">
          <span class="en">NFC</span></a>
        </div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/connectivity/nfc/nfc.html">NFC Basics</a></li>
          <li><a href="http://developer.android.com/guide/topics/connectivity/nfc/advanced-nfc.html">Advanced NFC</a></li>
          <li><a href="http://developer.android.com/guide/topics/connectivity/nfc/hce.html">Host-based Card Emulation</a></li>
        </ul>
      </li>
      <li><a href="http://developer.android.com/guide/topics/connectivity/wifip2p.html">
            <span class="en">Wi-Fi P2P</span></a>
          </li>
      <li class="nav-section">
          <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/connectivity/usb/index.html">
            <span class="en">USB</span></a>
          </div>
            <ul>
              <li><a href="http://developer.android.com/guide/topics/connectivity/usb/accessory.html">Accessory</a></li>
              <li><a href="http://developer.android.com/guide/topics/connectivity/usb/host.html">Host</a></li>
            </ul>
     </li>
     <li><a href="http://developer.android.com/guide/topics/connectivity/sip.html">
            <span class="en">SIP</span>
          </a>
     </li>

    </ul>
  </li><!-- end of connectivity -->


      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/text/index.html">
            <span class="en">Text and Input</span>
        </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/topics/text/copy-paste.html">
              <span class="en">Copy and Paste</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/text/creating-input-method.html">
              <span class="en">Creating an IME</span>
            </a></li>
          <li><a href="http://developer.android.com/guide/topics/text/spell-checker-framework.html">
              <span class="en">Spelling Checker</span>
            </a></li>
        </ul>
      </li><!-- end of text and input -->

     <li class="nav-section">
      <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/data/index.html">
          <span class="en">Data Storage</span>
        </a></div>
      <ul>
         <li><a href="http://developer.android.com/guide/topics/data/data-storage.html">
            <span class="en">Storage Options</span>
           </a></li>
        <li><a href="http://developer.android.com/guide/topics/data/backup.html">
            <span class="en">Data Backup</span>
          </a></li>
        <li><a href="http://developer.android.com/guide/topics/data/install-location.html">
            <span class="en">App Install Location</span>
          </a></li>
      </ul>
    </li><!-- end of data storage -->


  <li class="nav-section">
           <div class="nav-section-header"><a href="http://developer.android.com/guide/topics/admin/index.html">
               <span class="en">Administration</span>
             </a></div>
           <ul>
              <li>
                <a href="http://developer.android.com/guide/topics/admin/device-admin.html">
                <span class="en">Device Policies</span></a>
              </li>
            <!--
              <li>
                <a href="/guide/topics/admin/keychain.html">
                <span class="en">Certificate Store</span></a>
              </li>
            -->
           </ul>
  </li><!-- end of administration -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="http://developer.android.com/guide/webapps/index.html">
    <span class="en">Web Apps</span>
    </a></div>
    <ul>
      <li><a href="http://developer.android.com/guide/webapps/targeting.html">
            <span class="en">Supporting Different Screens in Web Apps</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/webapps/webview.html">
            <span class="en">Building Web Apps in WebView</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/webapps/migrating.html">
            <span class="en">Migrating to WebView in Android 4.4</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/webapps/debugging.html">
            <span class="en">Debugging Web Apps</span>
          </a></li>
      <li><a href="http://developer.android.com/guide/webapps/best-practices.html">
            <span class="en">Best Practices for Web Apps</span>
          </a></li>
    </ul>
  </li><!-- end of web apps -->

  <li class="nav-section">
    <div class="nav-section-header"><a href="http://developer.android.com/guide/practices/index.html">
      <span class="en">Best Practices</span>
      <span class="de" style="display:none">Bewährte Verfahren</span>
      <span class="es" style="display:none">Prácticas recomendadas</span>
      <span class="fr" style="display:none">Meilleures pratiques</span>
      <span class="it" style="display:none">Best practice</span>
      <span class="ja" style="display:none">ベスト プラクティス</span>
      <span class="zh-cn" style="display:none">最佳实践</span>
      <span class="zh-tw" style="display:none">最佳實務</span>
    </a></div>
    <ul>
      <li class="nav-section">
        <div class="nav-section-header"><a href="http://developer.android.com/guide/practices/screens_support.html">
          <span class="en">Supporting Multiple Screens</span>
        </a></div>
        <ul>
          <li><a href="http://developer.android.com/guide/practices/screens-distribution.html">
            <span class="en">Distributing to Specific Screens</span>
          </a></li>
          <li><a href="http://developer.android.com/guide/practices/screen-compat-mode.html">
            <span class="en">Screen Compatibility Mode</span>
          </a></li>
        </ul>
      </li>
      <li><a href="http://developer.android.com/guide/practices/tablets-and-handsets.html">
            <span class="en">Supporting Tablets and Handsets</span>
          </a></li>
      <li>
        <a href="http://developer.android.com/guide/practices/verifying-apps-art.html">
          <span class="en">Verifying App Behavior on ART</span>
        </a>
      </li>
    </ul>
  </li>


</ul></div><div class="jspVerticalBar"><div class="jspCap jspCapTop"></div><div class="jspTrack" style="height: 457px;"><div class="jspDrag" style="height: 268px;"><div class="jspDragTop"></div><div class="jspDragBottom"></div></div></div><div class="jspCap jspCapBottom"></div></div></div></div>
    <div class="col-4" id="side-nav" itemscope="" itemtype="http://schema.org/SiteNavigationElement">
      
    </div> <!-- end side-nav -->
    <script>
      $(document).ready(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>




<div class="col-12" id="doc-col">


  

  
    
      
        <h1 itemprop="name">Media Playback</h1>
      
    
  


  
  <div id="jd-content">


    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
    <div id="qv">

<h2>In this document</h2>
<ol>
<li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#basics">The Basics</a>
</li><li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#manifest">Manifest Declarations</a></li>
<li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#mediaplayer">Using MediaPlayer</a>
   <ol>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#preparingasync">Asynchronous Preparation</a></li>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#managestate">Managing State</a></li>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#releaseplayer">Releasing the MediaPlayer</a></li>
   </ol>
</li>
<li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#mpandservices">Using a Service with MediaPlayer</a>
   <ol>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#asyncprepare">Running asynchronously</a></li>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#asyncerror">Handling asynchronous errors</a></li>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#wakelocks">Using wake locks</a></li>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#foregroundserv">Running as a foreground service</a></li>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#audiofocus">Handling audio focus</a></li>
      <li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#cleanup">Performing cleanup</a></li>
   </ol>
</li>
<li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#noisyintent">Handling the AUDIO_BECOMING_NOISY Intent</a>
</li><li><a href="http://developer.android.com/guide/topics/media/mediaplayer.html#viacontentresolver">Retrieving Media from a Content Resolver</a>
</li></ol>

<h2>Key classes</h2>
<ol>
<li><code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code></li>
<li><code><a href="http://developer.android.com/reference/android/media/AudioManager.html">AudioManager</a></code></li>
<li><code><a href="http://developer.android.com/reference/android/media/SoundPool.html">SoundPool</a></code></li>
</ol>

<h2>See also</h2>
<ol>
<li><a href="http://developer.android.com/guide/topics/media/jetplayer.html">JetPlayer</a></li>
<li><a href="http://developer.android.com/guide/topics/media/audio-capture.html">Audio Capture</a></li>
<li><a href="http://developer.android.com/guide/appendix/media-formats.html">Android Supported Media Formats</a></li>
<li><a href="http://developer.android.com/guide/topics/data/data-storage.html">Data Storage</a></li>
</ol>

</div>
</div>

<p>The Android multimedia framework includes support for playing variety of common media types, so
that you can easily integrate audio, video and images into your applications. You can play audio or
video from media files stored in your application's resources (raw resources), from standalone files
in the filesystem, or from a data stream arriving over a network connection, all using <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> APIs.</p>

<p>This document shows you how to write a media-playing application that interacts with the user and
the system in order to obtain good performance and a pleasant user experience.</p>

<p class="note"><strong>Note:</strong> You can play back the audio data only to the standard output
device. Currently, that is the mobile device speaker or a Bluetooth headset. You cannot play sound
files in the conversation audio during a call.</p>

<h2 id="basics" style="margin-bottom: 0px;">The Basics</h2><hr>
<p>The following classes are used to play sound and video in the Android framework:</p>

<dl>
  <dt><code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code></dt>
  <dd>This class is the primary API for playing sound and video.</dd>
  <dt><code><a href="http://developer.android.com/reference/android/media/AudioManager.html">AudioManager</a></code></dt>
  <dd>This class manages audio sources and audio output on a device.</dd>
</dl>

<h2 id="manifest" style="margin-bottom: 0px;">Manifest Declarations</h2><hr>
<p>Before starting development on your application using MediaPlayer, make sure your manifest has
the appropriate declarations to allow use of related features.</p>

<ul>
  <li><strong>Internet Permission</strong> - If you are using MediaPlayer to stream network-based
content, your application must request network access.
<pre class="prettyprint"><span class="tag">&lt;uses-permission</span><span class="pln"> </span><span class="atn">android:name</span><span class="pun">=</span><span class="atv">"android.permission.INTERNET"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre>
  </li>
  <li><strong>Wake Lock Permission</strong> - If your player application needs to keep the screen
from dimming or the processor from sleeping, or uses the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#setScreenOnWhilePlaying(boolean)">MediaPlayer.setScreenOnWhilePlaying()</a></code> or
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#setWakeMode(android.content.Context, int)">MediaPlayer.setWakeMode()</a></code> methods, you must request this permission.
<pre class="prettyprint"><span class="tag">&lt;uses-permission</span><span class="pln"> </span><span class="atn">android:name</span><span class="pun">=</span><span class="atv">"android.permission.WAKE_LOCK"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre>
  </li>
</ul>

<h2 id="mediaplayer" style="margin-bottom: 0px;">Using MediaPlayer</h2><hr>
<p>One of the most important components of the media framework is the
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>
class. An object of this class can fetch, decode, and play both audio and video
with minimal setup. It supports several different media sources such as:
</p><ul>
   <li>Local resources</li>
   <li>Internal URIs, such as one you might obtain from a Content Resolver</li>
   <li>External URLs (streaming)</li>
</ul>
<p></p>

<p>For a list of media formats that Android supports,
see the <a href="http://developer.android.com/guide/appendix/media-formats.html">Android Supported Media
Formats</a> document. </p>

<p>Here is an example
of how to play audio that's available as a local raw resource (saved in your application's
<code>res/raw/</code> directory):</p>

<pre class="prettyprint"><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MediaPlayer</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="pln">context</span><span class="pun">,</span><span class="pln"> R</span><span class="pun">.</span><span class="pln">raw</span><span class="pun">.</span><span class="pln">sound_file_1</span><span class="pun">);</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln"> </span><span class="com">// no need to call prepare(); create() does that for you</span></pre>

<p>In this case, a "raw" resource is a file that the system does not
try to parse in any particular way. However, the content of this resource should not
be raw audio. It should be a properly encoded and formatted media file in one
of the supported formats.</p>

<p>And here is how you might play from a URI available locally in the system
(that you obtained through a Content Resolver, for instance):</p>

<pre class="prettyprint"><span class="typ">Uri</span><span class="pln"> myUri </span><span class="pun">=</span><span class="pln"> </span><span class="pun">....;</span><span class="pln"> </span><span class="com">// initialize Uri here</span><span class="pln"><br></span><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaPlayer</span><span class="pun">();</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">setAudioStreamType</span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">);</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> myUri</span><span class="pun">);</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">prepare</span><span class="pun">();</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span></pre>

<p>Playing from a remote URL via HTTP streaming looks like this:</p>

<pre class="prettyprint"><span class="typ">String</span><span class="pln"> url </span><span class="pun">=</span><span class="pln"> </span><span class="str">"http://........"</span><span class="pun">;</span><span class="pln"> </span><span class="com">// your URL here</span><span class="pln"><br></span><span class="typ">MediaPlayer</span><span class="pln"> mediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaPlayer</span><span class="pun">();</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">setAudioStreamType</span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">);</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span class="pln">url</span><span class="pun">);</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">prepare</span><span class="pun">();</span><span class="pln"> </span><span class="com">// might take long! (for buffering, etc)</span><span class="pln"><br>mediaPlayer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span></pre>

<p class="note"><strong>Note:</strong>
If you're passing a URL to stream an online media file, the file must be capable of
progressive download.</p>

<p class="caution"><strong>Caution:</strong> You must either catch or pass
<code><a href="http://developer.android.com/reference/java/lang/IllegalArgumentException.html">IllegalArgumentException</a></code> and <code><a href="http://developer.android.com/reference/java/io/IOException.html">IOException</a></code> when using
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#setDataSource(android.content.Context, android.net.Uri)">setDataSource()</a></code>, because
the file you are referencing might not exist.</p>

<h3 id="preparingasync">Asynchronous Preparation</h3>

<p>Using <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> can be straightforward in
principle. However, it's important to keep in mind that a few more things are
necessary to integrate it correctly with a typical Android application. For
example, the call to <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepare()">prepare()</a></code> can
take a long time to execute, because
it might involve fetching and decoding media data. So, as is the case with any
method that may take long to execute, you should <strong>never call it from your
application's UI thread</strong>. Doing that will cause the UI to hang until the method returns,
which is a very bad user experience and can cause an ANR (Application Not Responding) error. Even if
you expect your resource to load quickly, remember that anything that takes more than a tenth
of a second to respond in the UI will cause a noticeable pause and will give
the user the impression that your application is slow.</p>

<p>To avoid hanging your UI thread, spawn another thread to
prepare the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> and notify the main thread when done. However, while
you could write the threading logic
yourself, this pattern is so common when using <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> that the framework
supplies a convenient way to accomplish this task by using the
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()">prepareAsync()</a></code> method. This method
starts preparing the media in the background and returns immediately. When the media
is done preparing, the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html#onPrepared(android.media.MediaPlayer)">onPrepared()</a></code>
method of the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html">MediaPlayer.OnPreparedListener</a></code>, configured through
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#setOnPreparedListener(android.media.MediaPlayer.OnPreparedListener)">setOnPreparedListener()</a></code> is called.</p>

<h3 id="managestate">Managing State</h3>

<p>Another aspect of a <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> that you should keep in mind is
that it's state-based. That is, the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> has an internal state
that you must always be aware of when writing your code, because certain operations
are only valid when then player is in specific states. If you perform an operation while in the
wrong state, the system may throw an exception or cause other undesireable behaviors.</p>

<p>The documentation in the
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> class shows a complete state diagram,
that clarifies which methods move the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> from one state to another.
For example, when you create a new <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>, it is in the <em>Idle</em>
state. At that point, you should initialize it by calling
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#setDataSource(android.content.Context, android.net.Uri)">setDataSource()</a></code>, bringing it
to the <em>Initialized</em> state. After that, you have to prepare it using either the
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepare()">prepare()</a></code> or
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()">prepareAsync()</a></code> method. When
the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> is done preparing, it will then enter the <em>Prepared</em>
state, which means you can call <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#start()">start()</a></code>
to make it play the media. At that point, as the diagram illustrates,
you can move between the <em>Started</em>, <em>Paused</em> and <em>PlaybackCompleted</em> states by
calling such methods as
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#start()">start()</a></code>,
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#pause()">pause()</a></code>, and
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#seekTo(int)">seekTo()</a></code>,
amongst others. When you
call <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#stop()">stop()</a></code>, however, notice that you
cannot call <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#start()">start()</a></code> again until you
prepare the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> again.</p>

<p>Always keep <a href="http://developer.android.com/images/mediaplayer_state_diagram.gif">the state diagram</a>
in mind when writing code that interacts with a
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> object, because calling its methods from the wrong state is a
common cause of bugs.</p>

<h3 id="releaseplayer">Releasing the MediaPlayer</h3>

<p>A <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> can consume valuable
system resources.
Therefore, you should always take extra precautions to make sure you are not
hanging on to a <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> instance longer than necessary. When you
are done with it, you should always call
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#release()">release()</a></code> to make sure any
system resources allocated to it are properly released. For example, if you are
using a <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> and your activity receives a call to <code><a href="http://developer.android.com/reference/android/app/Activity.html#onStop()">onStop()</a></code>, you must release the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>,
because it
makes little sense to hold on to it while your activity is not interacting with
the user (unless you are playing media in the background, which is discussed in the next section).
When your activity is resumed or restarted, of course, you need to
create a new <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> and prepare it again before resuming playback.</p>

<p>Here's how you should release and then nullify your <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>:</p>
<pre class="prettyprint"><span class="pln">mediaPlayer</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln"><br>mediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span></pre>

<p>As an example, consider the problems that could happen if you
forgot to release the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> when your activity is stopped, but create a
new one when the activity starts again. As you may know, when the user changes the
screen orientation (or changes the device configuration in another way),
the system handles that by restarting the activity (by default), so you might quickly
consume all of the system resources as the user
rotates the device back and forth between portrait and landscape, because at each
orientation change, you create a new <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> that you never
release. (For more information about runtime restarts, see <a href="http://developer.android.com/guide/topics/resources/runtime-changes.html">Handling Runtime Changes</a>.)</p>

<p>You may be wondering what happens if you want to continue playing
"background media" even when the user leaves your activity, much in the same
way that the built-in Music application behaves. In this case, what you need is
a <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> controlled by a <code><a href="http://developer.android.com/reference/android/app/Service.html">Service</a></code>, as
discussed in <a href="http://developer.android.com/guide/topics/media/mediaplayer.html#mpandservices">Using a Service with MediaPlayer</a>.</p>

<h2 id="mpandservices" style="margin-bottom: 0px;">Using a Service with MediaPlayer</h2><hr>

<p>If you want your media to play in the background even when your application
is not onscreen—that is, you want it to continue playing while the user is
interacting with other applications—then you must start a
<code><a href="http://developer.android.com/reference/android/app/Service.html">Service</a></code> and control the
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> instance from there.
You should be careful about this setup, because the user and the system have expectations
about how an application running a background service should interact with the rest of the
system. If your application does not fulfil those expectations, the user may
have a bad experience. This section describes the main issues that you should be
aware of and offers suggestions about how to approach them.</p>


<h3 id="asyncprepare">Running asynchronously</h3>

<p>First of all, like an <code><a href="http://developer.android.com/reference/android/app/Activity.html">Activity</a></code>, all work in a
<code><a href="http://developer.android.com/reference/android/app/Service.html">Service</a></code> is done in a single thread by
default—in fact, if you're running an activity and a service from the same application, they
use the same thread (the "main thread") by default. Therefore, services need to
process incoming intents quickly
and never perform lengthy computations when responding to them. If any heavy
work or blocking calls are expected, you must do those tasks asynchronously: either from
another thread you implement yourself, or using the framework's many facilities
for asynchronous processing.</p>

<p>For instance, when using a <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> from your main thread,
you should call <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()">prepareAsync()</a></code> rather than
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#prepare()">prepare()</a></code>, and implement
a <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html">MediaPlayer.OnPreparedListener</a></code>
in order to be notified when the preparation is complete and you can start playing.
For example:</p>

<pre class="prettyprint"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyService</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MediaPlayer</span><span class="pun">.</span><span class="typ">OnPreparedListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> ACTION_PLAY </span><span class="pun">=</span><span class="pln"> </span><span class="str">"com.example.action.PLAY"</span><span class="pun">;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="typ">MediaPlayer</span><span class="pln"> mMediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> onStartCommand</span><span class="pun">(</span><span class="typ">Intent</span><span class="pln"> intent</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> flags</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> startId</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">...</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">intent</span><span class="pun">.</span><span class="pln">getAction</span><span class="pun">().</span><span class="pln">equals</span><span class="pun">(</span><span class="pln">ACTION_PLAY</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="com">// initialize it here</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span class="pun">.</span><span class="pln">setOnPreparedListener</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span class="pun">.</span><span class="pln">prepareAsync</span><span class="pun">();</span><span class="pln"> </span><span class="com">// prepare async to not block main thread</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">/** Called when MediaPlayer is ready */</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onPrepared</span><span class="pun">(</span><span class="typ">MediaPlayer</span><span class="pln"> player</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; player</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br></span><span class="pun">}</span></pre>


<h3 id="asyncerror">Handling asynchronous errors</h3>

<p>On synchronous operations, errors would normally
be signaled with an exception or an error code, but whenever you use asynchronous
resources, you should make sure your application is notified
of errors appropriately. In the case of a <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>,
you can accomplish this by implementing a
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.OnErrorListener.html">MediaPlayer.OnErrorListener</a></code> and
setting it in your <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> instance:</p>

<pre class="prettyprint"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyService</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">MediaPlayer</span><span class="pun">.</span><span class="typ">OnErrorListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="typ">MediaPlayer</span><span class="pln"> mMediaPlayer</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> initMediaPlayer</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// ...initialize the MediaPlayer here...</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span class="pun">.</span><span class="pln">setOnErrorListener</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="lit">@Override</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> onError</span><span class="pun">(</span><span class="typ">MediaPlayer</span><span class="pln"> mp</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> what</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> extra</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// ... react appropriately ...</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// The MediaPlayer has moved to the Error state, must be reset!</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br></span><span class="pun">}</span></pre>

<p>It's important to remember that when an error occurs, the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>
moves to the <em>Error</em> state (see the documentation for the
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> class for the full state diagram)
and you must reset it before you can use it again.


</p><h3 id="wakelocks">Using wake locks</h3>

<p>When designing applications that play media
in the background, the device may go to sleep
while your service is running. Because the Android system tries to conserve
battery while the device is sleeping, the system tries to shut off any
of the phone's features that are
not necessary, including the CPU and the WiFi hardware.
However, if your service is playing or streaming music, you want to prevent
the system from interfering with your playback.</p>

<p>In order to ensure that your service continues to run under
those conditions, you have to use "wake locks." A wake lock is a way to signal to
the system that your application is using some feature that should
stay available even if the phone is idle.</p>

<p class="caution"><strong>Notice:</strong> You should always use wake locks sparingly and hold them
only for as long as truly necessary, because they significantly reduce the battery life of the
device.</p>

<p>To ensure that the CPU continues running while your <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> is
playing, call the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#setWakeMode(android.content.Context, int)">setWakeMode()</a></code> method when initializing your <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>. Once you do,
the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> holds the specified lock while playing and releases the lock
when paused or stopped:</p>

<pre class="prettyprint"><span class="pln">mMediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaPlayer</span><span class="pun">();</span><span class="pln"><br></span><span class="com">// ... other initialization here ...</span><span class="pln"><br>mMediaPlayer</span><span class="pun">.</span><span class="pln">setWakeMode</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> </span><span class="typ">PowerManager</span><span class="pun">.</span><span class="pln">PARTIAL_WAKE_LOCK</span><span class="pun">);</span></pre>

<p>However, the wake lock acquired in this example guarantees only that the CPU remains awake. If
you are streaming media over the
network and you are using Wi-Fi, you probably want to hold a
<code><a href="http://developer.android.com/reference/android/net/wifi/WifiManager.WifiLock.html">WifiLock</a></code> as
well, which you must acquire and release manually. So, when you start preparing the
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> with the remote URL, you should create and acquire the Wi-Fi lock.
For example:</p>

<pre class="prettyprint"><span class="typ">WifiLock</span><span class="pln"> wifiLock </span><span class="pun">=</span><span class="pln"> </span><span class="pun">((</span><span class="typ">WifiManager</span><span class="pun">)</span><span class="pln"> getSystemService</span><span class="pun">(</span><span class="typ">Context</span><span class="pun">.</span><span class="pln">WIFI_SERVICE</span><span class="pun">))</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">createWifiLock</span><span class="pun">(</span><span class="typ">WifiManager</span><span class="pun">.</span><span class="pln">WIFI_MODE_FULL</span><span class="pun">,</span><span class="pln"> </span><span class="str">"mylock"</span><span class="pun">);</span><span class="pln"><br><br>wifiLock</span><span class="pun">.</span><span class="pln">acquire</span><span class="pun">();</span></pre>

<p>When you pause or stop your media, or when you no longer need the
network, you should release the lock:</p>

<pre class="prettyprint"><span class="pln">wifiLock</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span></pre>


<h3 id="foregroundserv">Running as a foreground service</h3>

<p>Services are often used for performing background tasks, such as fetching emails,
synchronizing data, downloading content, amongst other possibilities. In these
cases, the user is not actively aware of the service's execution, and probably
wouldn't even notice if some of these services were interrupted and later restarted.</p>

<p>But consider the case of a service that is playing music. Clearly this is a service that the user
is actively aware of and the experience would be severely affected by any interruptions.
Additionally, it's a service that the user will likely wish to interact with during its execution.
In this case, the service should run as a "foreground service." A
foreground service holds a higher level of importance within the system—the system will
almost never kill the service, because it is of immediate importance to the user. When running
in the foreground, the service also must provide a status bar notification to ensure that users are
aware of the running service and allow them to open an activity that can interact with the
service.</p>

<p>In order to turn your service into a foreground service, you must create a
<code><a href="http://developer.android.com/reference/android/app/Notification.html">Notification</a></code> for the status bar and call
<code><a href="http://developer.android.com/reference/android/app/Service.html#startForeground(int, android.app.Notification)">startForeground()</a></code> from the <code><a href="http://developer.android.com/reference/android/app/Service.html">Service</a></code>. For example:</p>

<pre class="prettyprint"><span class="typ">String</span><span class="pln"> songName</span><span class="pun">;</span><span class="pln"><br></span><span class="com">// assign the song name to songName</span><span class="pln"><br></span><span class="typ">PendingIntent</span><span class="pln"> pi </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PendingIntent</span><span class="pun">.</span><span class="pln">getActivity</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Intent</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> </span><span class="typ">MainActivity</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">),</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">PendingIntent</span><span class="pun">.</span><span class="pln">FLAG_UPDATE_CURRENT</span><span class="pun">);</span><span class="pln"><br></span><span class="typ">Notification</span><span class="pln"> notification </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Notification</span><span class="pun">();</span><span class="pln"><br>notification</span><span class="pun">.</span><span class="pln">tickerText </span><span class="pun">=</span><span class="pln"> text</span><span class="pun">;</span><span class="pln"><br>notification</span><span class="pun">.</span><span class="pln">icon </span><span class="pun">=</span><span class="pln"> R</span><span class="pun">.</span><span class="pln">drawable</span><span class="pun">.</span><span class="pln">play0</span><span class="pun">;</span><span class="pln"><br>notification</span><span class="pun">.</span><span class="pln">flags </span><span class="pun">|=</span><span class="pln"> </span><span class="typ">Notification</span><span class="pun">.</span><span class="pln">FLAG_ONGOING_EVENT</span><span class="pun">;</span><span class="pln"><br>notification</span><span class="pun">.</span><span class="pln">setLatestEventInfo</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> </span><span class="str">"MusicPlayerSample"</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="str">"Playing: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> songName</span><span class="pun">,</span><span class="pln"> pi</span><span class="pun">);</span><span class="pln"><br>startForeground</span><span class="pun">(</span><span class="pln">NOTIFICATION_ID</span><span class="pun">,</span><span class="pln"> notification</span><span class="pun">);</span></pre>

<p>While your service is running in the foreground, the notification you
configured is visible in the notification area of the device. If the user
selects the notification, the system invokes the <code><a href="http://developer.android.com/reference/android/app/PendingIntent.html">PendingIntent</a></code> you supplied. In
the example above, it opens an activity (<code>MainActivity</code>).</p>

<p>Figure 1 shows how your notification appears to the user:</p>

<img src="./mediaplayer_files/notification1.png">
&nbsp;&nbsp;
<img src="./mediaplayer_files/notification2.png">
<p class="img-caption"><strong>Figure 1.</strong> Screenshots of a foreground service's
notification, showing the notification icon in the status bar (left) and the expanded view
(right).</p>

<p>You should only hold on to the "foreground service" status while your
service is actually performing something the user is actively aware of. Once
that is no longer true, you should release it by calling
<code><a href="http://developer.android.com/reference/android/app/Service.html#stopForeground(boolean)">stopForeground()</a></code>:</p>

<pre class="prettyprint"><span class="pln">stopForeground</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></pre>

<p>For more information, see the documentation about <a href="http://developer.android.com/guide/components/services.html#Foreground">Services</a> and
<a href="http://developer.android.com/guide/topics/ui/notifiers/notifications.html">Status Bar Notifications</a>.</p>


<h3 id="audiofocus">Handling audio focus</h3>

<p>Even though only one activity can run at any given time, Android is a
multi-tasking environment. This poses a particular challenge to applications
that use audio, because there is only one audio output and there may be several
media services competing for its use. Before Android 2.2, there was no built-in
mechanism to address this issue, which could in some cases lead to a bad user
experience. For example, when a user is listening to
music and another application needs to notify the user of something very important,
the user might not hear the notification tone due to the loud music. Starting with
Android 2.2, the platform offers a way for applications to negotiate their
use of the device's audio output. This mechanism is called Audio Focus.</p>

<p>When your application needs to output audio such as music or a notification,
you should always request audio focus. Once it has focus, it can use the sound output freely, but it
should
always listen for focus changes. If it is notified that it has lost the audio
focus, it should immediately either kill the audio or lower it to a quiet level
(known as "ducking"—there is a flag that indicates which one is appropriate) and only resume
loud playback after it receives focus again.</p>

<p>Audio Focus is cooperative in nature. That is, applications are expected
(and highly encouraged) to comply with the audio focus guidelines, but the
rules are not enforced by the system. If an application wants to play loud
music even after losing audio focus, nothing in the system will prevent that.
However, the user is more likely to have a bad experience and will be more
likely to uninstall the misbehaving application.</p>

<p>To request audio focus, you must call
<code><a href="http://developer.android.com/reference/android/media/AudioManager.html#requestAudioFocus(android.media.AudioManager.OnAudioFocusChangeListener, int, int)">requestAudioFocus()</a></code> from the <code><a href="http://developer.android.com/reference/android/media/AudioManager.html">AudioManager</a></code>, as the example below demonstrates:</p>

<pre class="prettyprint"><span class="typ">AudioManager</span><span class="pln"> audioManager </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">)</span><span class="pln"> getSystemService</span><span class="pun">(</span><span class="typ">Context</span><span class="pun">.</span><span class="pln">AUDIO_SERVICE</span><span class="pun">);</span><span class="pln"><br></span><span class="kwd">int</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> audioManager</span><span class="pun">.</span><span class="pln">requestAudioFocus</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_GAIN</span><span class="pun">);</span><span class="pln"><br><br></span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">result </span><span class="pun">!=</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_REQUEST_GRANTED</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com">// could not get audio focus.</span><span class="pln"><br></span><span class="pun">}</span></pre>

<p>The first parameter to <code><a href="http://developer.android.com/reference/android/media/AudioManager.html#requestAudioFocus(android.media.AudioManager.OnAudioFocusChangeListener, int, int)">requestAudioFocus()</a></code>
is an <code><a href="http://developer.android.com/reference/android/media/AudioManager.OnAudioFocusChangeListener.html">AudioManager.OnAudioFocusChangeListener</a></code>,
whose <code><a href="http://developer.android.com/reference/android/media/AudioManager.OnAudioFocusChangeListener.html#onAudioFocusChange(int)">onAudioFocusChange()</a></code> method is called whenever there is a change in audio focus. Therefore, you
should also implement this interface on your service and activities. For example:</p>

<pre class="prettyprint"><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyService</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="typ">OnAudioFocusChangeListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com">// ....</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onAudioFocusChange</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> focusChange</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Do something based on focus change...</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br></span><span class="pun">}</span></pre>

<p>The <code>focusChange</code> parameter tells you how the audio focus has changed, and
can be one of the following values (they are all constants defined in
<code><a href="http://developer.android.com/reference/android/media/AudioManager.html">AudioManager</a></code>):</p>

<ul>
<li><code><a href="http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_GAIN">AUDIOFOCUS_GAIN</a></code>: You have gained the audio focus.</li>

<li><code><a href="http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_LOSS">AUDIOFOCUS_LOSS</a></code>: You have lost the audio focus for a
presumably long time.
You must stop all audio playback. Because you should expect not to have focus back
for a long time, this would be a good place to clean up your resources as much
as possible. For example, you should release the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>.</li>

<li><code><a href="http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_LOSS_TRANSIENT">AUDIOFOCUS_LOSS_TRANSIENT</a></code>: You have
temporarily lost audio focus, but should receive it back shortly. You must stop
all audio playback, but you can keep your resources because you will probably get
focus back shortly.</li>

<li><code><a href="http://developer.android.com/reference/android/media/AudioManager.html#AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK">AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK</a></code>: You have temporarily
lost audio focus,
but you are allowed to continue to play audio quietly (at a low volume) instead
of killing audio completely.</li>
</ul>

<p>Here is an example implementation:</p>

<pre class="prettyprint"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onAudioFocusChange</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> focusChange</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">switch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">focusChange</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_GAIN</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// resume playback</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mMediaPlayer </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> initMediaPlayer</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">mMediaPlayer</span><span class="pun">.</span><span class="pln">isPlaying</span><span class="pun">())</span><span class="pln"> mMediaPlayer</span><span class="pun">.</span><span class="pln">start</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span class="pun">.</span><span class="pln">setVolume</span><span class="pun">(</span><span class="lit">1.0f</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.0f</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_LOSS</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Lost focus for an unbounded amount of time: stop playback and release media player</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mMediaPlayer</span><span class="pun">.</span><span class="pln">isPlaying</span><span class="pun">())</span><span class="pln"> mMediaPlayer</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mMediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_LOSS_TRANSIENT</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Lost focus for a short time, but we have to stop</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// playback. We don't release the media player because playback</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// is likely to resume</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mMediaPlayer</span><span class="pun">.</span><span class="pln">isPlaying</span><span class="pun">())</span><span class="pln"> mMediaPlayer</span><span class="pun">.</span><span class="pln">pause</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">case</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_LOSS_TRANSIENT_CAN_DUCK</span><span class="pun">:</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// Lost focus for a short time, but it's ok to keep playing</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// at an attenuated level</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mMediaPlayer</span><span class="pun">.</span><span class="pln">isPlaying</span><span class="pun">())</span><span class="pln"> mMediaPlayer</span><span class="pun">.</span><span class="pln">setVolume</span><span class="pun">(</span><span class="lit">0.1f</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.1f</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">break</span><span class="pun">;</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br></span><span class="pun">}</span></pre>

<p>Keep in mind that the audio focus APIs are available only with API level 8 (Android 2.2)
and above, so if you want to support previous
versions of Android, you should adopt a backward compatibility strategy that
allows you to use this feature if available, and fall back seamlessly if not.</p>

<p>You can achieve backward compatibility either by calling the audio focus methods by reflection
or by implementing all the audio focus features in a separate class (say,
<code>AudioFocusHelper</code>). Here is an example of such a class:</p>

<pre class="prettyprint"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">AudioFocusHelper</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="typ">OnAudioFocusChangeListener</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="typ">AudioManager</span><span class="pln"> mAudioManager</span><span class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">// other fields here, you'll probably hold a reference to an interface</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com">// that you can use to communicate the focus changes to your Service</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">AudioFocusHelper</span><span class="pun">(</span><span class="typ">Context</span><span class="pln"> ctx</span><span class="pun">,</span><span class="pln"> </span><span class="com">/* other arguments here */</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; mAudioManager </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">)</span><span class="pln"> mContext</span><span class="pun">.</span><span class="pln">getSystemService</span><span class="pun">(</span><span class="typ">Context</span><span class="pun">.</span><span class="pln">AUDIO_SERVICE</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// ...</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> requestFocus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_REQUEST_GRANTED </span><span class="pun">==</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mAudioManager</span><span class="pun">.</span><span class="pln">requestAudioFocus</span><span class="pun">(</span><span class="pln">mContext</span><span class="pun">,</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">,</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_GAIN</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">boolean</span><span class="pln"> abandonFocus</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">AUDIOFOCUS_REQUEST_GRANTED </span><span class="pun">==</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mAudioManager</span><span class="pun">.</span><span class="pln">abandonAudioFocus</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span class="lit">@Override</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onAudioFocusChange</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> focusChange</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// let your service know about the focus change</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br></span><span class="pun">}</span></pre>


<p>You can create an instance of <code>AudioFocusHelper</code> class only if you detect that
the system is running API level 8 or above. For example:</p>

<pre class="prettyprint"><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">android</span><span class="pun">.</span><span class="pln">os</span><span class="pun">.</span><span class="typ">Build</span><span class="pun">.</span><span class="pln">VERSION</span><span class="pun">.</span><span class="pln">SDK_INT </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">8</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; mAudioFocusHelper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">AudioFocusHelper</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">);</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; mAudioFocusHelper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln"><br></span><span class="pun">}</span></pre>


<h3 id="cleanup">Performing cleanup</h3>

<p>As mentioned earlier, a <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> object can consume a significant
amount of system resources, so you should keep it only for as long as you need and call
<code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html#release()">release()</a></code> when you are done with it. It's important
to call this cleanup method explicitly rather than rely on system garbage collection because
it might take some time before the garbage collector reclaims the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>,
as it's only sensitive to memory needs and not to shortage of other media-related resources.
So, in the case when you're using a service, you should always override the
<code><a href="http://developer.android.com/reference/android/app/Service.html#onDestroy()">onDestroy()</a></code> method to make sure you are releasing
the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>:</p>

<pre class="prettyprint"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyService</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">Service</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="typ">MediaPlayer</span><span class="pln"> mMediaPlayer</span><span class="pun">;</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="com">// ...</span><span class="pln"><br><br>&nbsp; &nbsp;</span><span class="lit">@Override</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onDestroy</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">mMediaPlayer </span><span class="pun">!=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> mMediaPlayer</span><span class="pun">.</span><span class="pln">release</span><span class="pun">();</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"><br></span><span class="pun">}</span></pre>

<p>You should always look for other opportunities to release your <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>
as well, apart from releasing it when being shut down. For example, if you expect not
to be able to play media for an extended period of time (after losing audio focus, for example),
you should definitely release your existing <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> and create it again
later. On the
other hand, if you only expect to stop playback for a very short time, you should probably
hold on to your <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code> to avoid the overhead of creating and preparing it
again.</p>



<h2 id="noisyintent" style="margin-bottom: 0px;">Handling the AUDIO_BECOMING_NOISY Intent</h2><hr>

<p>Many well-written applications that play audio automatically stop playback when an event
occurs that causes the audio to become noisy (ouput through external speakers). For instance,
this might happen when a user is listening to music through headphones and accidentally
disconnects the headphones from the device. However, this behavior does not happen automatically.
If you don't implement this feature, audio plays out of the device's external speakers, which
might not be what the user wants.</p>

<p>You can ensure your app stops playing music in these situations by handling
the <code><a href="http://developer.android.com/reference/android/media/AudioManager.html#ACTION_AUDIO_BECOMING_NOISY">ACTION_AUDIO_BECOMING_NOISY</a></code> intent, for which you can
register a receiver by
adding the following to your manifest:</p>

<pre class="prettyprint"><span class="tag">&lt;receiver</span><span class="pln"> </span><span class="atn">android:name</span><span class="pun">=</span><span class="atv">".MusicIntentReceiver"</span><span class="tag">&gt;</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="tag">&lt;intent-filter&gt;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="tag">&lt;action</span><span class="pln"> </span><span class="atn">android:name</span><span class="pun">=</span><span class="atv">"android.media.AUDIO_BECOMING_NOISY"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="tag">&lt;/intent-filter&gt;</span><span class="pln"><br></span><span class="tag">&lt;/receiver&gt;</span></pre>

<p>This registers the <code>MusicIntentReceiver</code> class as a broadcast receiver for that
intent. You should then implement this class:</p>

<pre class="prettyprint"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MusicIntentReceiver</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">content</span><span class="pun">.</span><span class="typ">BroadcastReceiver</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="lit">@Override</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onReceive</span><span class="pun">(</span><span class="typ">Context</span><span class="pln"> ctx</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Intent</span><span class="pln"> intent</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">intent</span><span class="pun">.</span><span class="pln">getAction</span><span class="pun">().</span><span class="pln">equals</span><span class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; android</span><span class="pun">.</span><span class="pln">media</span><span class="pun">.</span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">ACTION_AUDIO_BECOMING_NOISY</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// signal your service to stop playback</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="com">// (via an Intent, for instance)</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br>&nbsp; &nbsp;</span><span class="pun">}</span><span class="pln"><br></span><span class="pun">}</span></pre>




<h2 id="viacontentresolver" style="margin-bottom: 0px;">Retrieving Media from a Content Resolver</h2><hr>

<p>Another feature that may be useful in a media player application is the ability to
retrieve music that the user has on the device. You can do that by querying the <code><a href="http://developer.android.com/reference/android/content/ContentResolver.html">ContentResolver</a></code> for external media:</p>

<pre class="prettyprint"><span class="typ">ContentResolver</span><span class="pln"> contentResolver </span><span class="pun">=</span><span class="pln"> getContentResolver</span><span class="pun">();</span><span class="pln"><br></span><span class="typ">Uri</span><span class="pln"> uri </span><span class="pun">=</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="typ">MediaStore</span><span class="pun">.</span><span class="typ">Audio</span><span class="pun">.</span><span class="typ">Media</span><span class="pun">.</span><span class="pln">EXTERNAL_CONTENT_URI</span><span class="pun">;</span><span class="pln"><br></span><span class="typ">Cursor</span><span class="pln"> cursor </span><span class="pun">=</span><span class="pln"> contentResolver</span><span class="pun">.</span><span class="pln">query</span><span class="pun">(</span><span class="pln">uri</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">);</span><span class="pln"><br></span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cursor </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com">// query failed, handle error.</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">cursor</span><span class="pun">.</span><span class="pln">moveToFirst</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="com">// no media on the device</span><span class="pln"><br></span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> titleColumn </span><span class="pun">=</span><span class="pln"> cursor</span><span class="pun">.</span><span class="pln">getColumnIndex</span><span class="pun">(</span><span class="pln">android</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="typ">MediaStore</span><span class="pun">.</span><span class="typ">Audio</span><span class="pun">.</span><span class="typ">Media</span><span class="pun">.</span><span class="pln">TITLE</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">int</span><span class="pln"> idColumn </span><span class="pun">=</span><span class="pln"> cursor</span><span class="pun">.</span><span class="pln">getColumnIndex</span><span class="pun">(</span><span class="pln">android</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="typ">MediaStore</span><span class="pun">.</span><span class="typ">Audio</span><span class="pun">.</span><span class="typ">Media</span><span class="pun">.</span><span class="pln">_ID</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">do</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="kwd">long</span><span class="pln"> thisId </span><span class="pun">=</span><span class="pln"> cursor</span><span class="pun">.</span><span class="pln">getLong</span><span class="pun">(</span><span class="pln">idColumn</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="typ">String</span><span class="pln"> thisTitle </span><span class="pun">=</span><span class="pln"> cursor</span><span class="pun">.</span><span class="pln">getString</span><span class="pun">(</span><span class="pln">titleColumn</span><span class="pun">);</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="com">// ...process entry...</span><span class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">while</span><span class="pln"> </span><span class="pun">(</span><span class="pln">cursor</span><span class="pun">.</span><span class="pln">moveToNext</span><span class="pun">());</span><span class="pln"><br></span><span class="pun">}</span></pre>

<p>To use this with the <code><a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a></code>, you can do this:</p>

<pre class="prettyprint"><span class="kwd">long</span><span class="pln"> id </span><span class="pun">=</span><span class="pln"> </span><span class="com">/* retrieve it from somewhere */</span><span class="pun">;</span><span class="pln"><br></span><span class="typ">Uri</span><span class="pln"> contentUri </span><span class="pun">=</span><span class="pln"> </span><span class="typ">ContentUris</span><span class="pun">.</span><span class="pln">withAppendedId</span><span class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; android</span><span class="pun">.</span><span class="pln">provider</span><span class="pun">.</span><span class="typ">MediaStore</span><span class="pun">.</span><span class="typ">Audio</span><span class="pun">.</span><span class="typ">Media</span><span class="pun">.</span><span class="pln">EXTERNAL_CONTENT_URI</span><span class="pun">,</span><span class="pln"> id</span><span class="pun">);</span><span class="pln"><br><br>mMediaPlayer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MediaPlayer</span><span class="pun">();</span><span class="pln"><br>mMediaPlayer</span><span class="pun">.</span><span class="pln">setAudioStreamType</span><span class="pun">(</span><span class="typ">AudioManager</span><span class="pun">.</span><span class="pln">STREAM_MUSIC</span><span class="pun">);</span><span class="pln"><br>mMediaPlayer</span><span class="pun">.</span><span class="pln">setDataSource</span><span class="pun">(</span><span class="pln">getApplicationContext</span><span class="pun">(),</span><span class="pln"> contentUri</span><span class="pun">);</span><span class="pln"><br><br></span><span class="com">// ...prepare and start...</span></pre>

    </div>

      <div class="content-footer layout-content-row" itemscope="" itemtype="http://schema.org/SiteNavigationElement">
        
        <div class="paging-links layout-content-col col-10">
          
        </div>
        <div class="layout-content-col plus-container col-2">
          
            <div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 90px; height: 20px; background: transparent;"><iframe frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 90px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" tabindex="0" vspace="0" width="100%" id="I0_1432422693552" name="I0_1432422693552" src="./mediaplayer_files/fastbutton.html" data-gapiattached="true" title="+1"></iframe></div>
          
        </div>
        
      </div>

  </div> <!-- end jd-content -->

<div id="footer" class="wrap">
        

  <div id="copyright">
    
  Except as noted, this content is 
  licensed under <a href="http://creativecommons.org/licenses/by/2.5/">
  Creative Commons Attribution 2.5</a>. For details and 
  restrictions, see the <a href="http://developer.android.com/license.html">Content 
  License</a>.
  </div>


  <div id="footerlinks">
    
  <p>
    <a href="http://developer.android.com/about/index.html">About Android</a>&nbsp;&nbsp;|&nbsp;
    <a href="http://developer.android.com/legal.html">Legal</a>&nbsp;&nbsp;|&nbsp;
    <a href="http://developer.android.com/support.html">Support</a>
  </p>
  </div>

</div> <!-- end footer -->
</div><!-- end doc-content -->

</div> <!-- end body-content --> 





  <script src="./mediaplayer_files/ytblogger_lists_unified.js" type="text/javascript"></script>
  <script src="./mediaplayer_files/jd_lists_unified.js" type="text/javascript"></script>
  <script src="./mediaplayer_files/jd_extras.js" type="text/javascript"></script>
  <script src="./mediaplayer_files/jd_collections.js" type="text/javascript"></script>
  <script src="./mediaplayer_files/jd_tag_helpers.js" type="text/javascript"></script>






<iframe name="oauth2relay582727033" id="oauth2relay582727033" src="./mediaplayer_files/postmessageRelay.html" tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe></body></html>